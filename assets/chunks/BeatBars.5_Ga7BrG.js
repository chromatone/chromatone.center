import{_ as se}from"./trash.x5rnJcyN.js";import{_ as re,a as ie,b as ae,c as ue,d as de}from"./angle-right.C7TANVvU.js";import{m as ce,x as n,y as r,A as o,v as q,c as S,d as L,M as U,E as t,G as _,F as V,B as M,C as w,I as C,b as G,J as me,q as fe,r as J,P as B,T as D,U as P,V as F,aj as ve,u as he,$ as ye,H as xe,z as pe}from"./framework.BjEhsXnI.js";import{an as K,K as O,D as Q,U as be,c as we,ao as ge,ap as ke,aq as $e,ar as Ce}from"./theme.DLKUvQ1N.js";const Ne={style:{"vertical-align":"middle"},viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"};function _e(e,g){return n(),r("svg",Ne,g[0]||(g[0]=[o("path",{fill:"currentColor",d:"M15 4.594L13.281 6.28L8.562 11H4v10h4.563l4.718 4.719L15 27.406zm-2 4.843v13.126L9.719 19.28L9.406 19H6v-6h3.406l.313-.281zm7.219 2.344L18.78 13.22L21.563 16l-2.782 2.781l1.438 1.438L23 17.437l2.781 2.782l1.438-1.438L24.437 16l2.782-2.781l-1.438-1.438L23 14.562z"},null,-1)]))}const Be=ce({name:"la-volume-off",render:_e}),Ve=["transform"],Me=["opacity"],Se=["width","fill"],ze=["stroke","fill"],De=["fill"],Ae=["stroke"],Le=["onDblclick","data-sub"],Re=["transform"],je=["width","x","fill"],Pe=["transform","fill","opacity"],Ee=["x"],Ue=["fill","stroke"],Xe={key:0,class:"transition-all duration-100 ease-out pointer-events-none",cx:0,cy:100,r:"3",fill:"currentColor",opacity:"0.8"},Te={__name:"BeatBarsStep",props:{proportion:{type:Number,default:1},step:{type:Number,default:1},subdivisions:{type:[Array,String],default:""},muted:{type:Boolean,default:!1},total:{type:Number,default:4},current:{type:[Number,String],default:0},mutes:{type:Object,default:{}},accented:{type:Boolean,default:!1},width:{type:Number,default:900},pad:{type:Number,default:50}},emits:["mute","subdivide","accent"],setup(e,{emit:g}){const{isDark:x}=q(),d=e,l=g,y=S(()=>K(d.step+O.pitch/12*d.total,d.total,1));S(()=>d.subdivisions[0].includes("!"));const i=Q(0,40,640),f=S(()=>Math.floor(i.value/40));L(f,(a,c)=>{if(a==c)return;let p=[];for(let s=0;s<a;s++)p.push(`${d.step}-${s}`);l("subdivide",p)});function b(a){if(a.tap){let c=a.event.currentTarget.dataset.sub;d.mutes[c]=!d.mutes[c]}i.value+=a.delta[0]-a.delta[1]}const m=S(()=>{let a=d.subdivisions[0]==d.current,c=d.subdivisions[0].split("-")[0],p=d.current.split("-")[0];return!d.mutes[d.subdivisions[0]]&&(a||c==p)});return(a,c)=>{const p=U("drag");return n(),r("g",{class:"cursor-pointer",transform:`translate(${e.proportion*e.step*e.width+e.pad},0)`},[o("g",{class:"step",opacity:e.muted?.1:1},[o("rect",{class:"transition-fill duration-100",onMousedown:c[0]||(c[0]=s=>a.$emit("mute")),width:e.proportion*e.width,height:"180",rx:"10",fill:m.value?e.muted?"transparent":y.value:"transparent"},null,40,Se),o("circle",{class:"transition-all duration-100 ease-out",onMousedown:c[1]||(c[1]=s=>e.muted?a.$emit("mute"):a.$emit("accent")),cy:"35",cx:"0",r:"25","stroke-width":"4",stroke:y.value,fill:m.value?e.muted?"transparent":"currentColor":e.accented?y.value:t(x)?"#333":"#eee"},null,40,ze),o("text",{class:"pointer-events-none transition-all duration-100 ease-out",y:"48","font-size":"40","text-anchor":"middle",x:"0",fill:m.value?t(x)?"#333":"#eee":"currentColor"},_(e.step+1),9,De),o("line",{class:"pointer-events-none",y1:"60",y2:"100","stroke-width":"8",stroke:y.value},null,8,Ae),(n(!0),r(V,null,M(e.subdivisions,(s,v)=>w((n(),r("g",{class:"sub",key:s,onDblclick:R=>{a.$emit("subdivide",[`${s}-1`]),i.value=40},"data-sub":s},[o("line",{transform:`translate(${v*e.proportion*e.width/e.subdivisions.length}, 0)`,y1:"100",y2:"150","stroke-width":"1",stroke:"currentColor"},null,8,Re),o("rect",{class:"transition-fill duration-100",width:e.proportion*e.width/e.subdivisions.length,height:"80",y:"100",rx:"10",x:v*e.proportion*e.width/e.subdivisions.length,fill:`hsla(0,0%,${90-v*80/e.subdivisions.length}%,${s==e.current?.9:.4})`},null,8,je),o("circle",{class:"transition-all duration-100 ease-out pointer-events-none",transform:`translate(${v*e.proportion*e.width/e.subdivisions.length}, 0)`,cx:0,cy:100,r:6,fill:s==e.current?"currentColor":e.muted?"transparent":y.value,opacity:e.mutes[s]?0:1,"stroke-width":"4","stroke-linecap":"round"},null,8,Pe),e.mutes[s]?C("",!0):(n(),r("text",{key:0,y:"140","font-size":"40","text-anchor":"middle",x:15+v*e.proportion*e.width/e.subdivisions.length,fill:"currentColor"},_(v+1),9,Ee))],40,Le)),[[p,b]])),128)),o("circle",{class:"transition-all duration-100 ease-out pointer-events-none",cx:"0",cy:100,r:"10",fill:y.value,stroke:m.value?"currentColor":"transparent","stroke-width":"4",opacity:"0.8"},null,8,Ue)],8,Me),e.muted?(n(),r("circle",Xe)):C("",!0)],8,Ve)}}},Ie={class:"bar cursor-pointer","font-size":"32px"},Oe=["x1","x2","y1","y2","stroke-width","stroke"],qe=["x2","y1","y2","stroke"],He=["x1","x2","y1","y2","stroke-width","stroke"],Fe={key:0,class:"all"},Ge=["cx","cy","r"],Je=["cx","cy"],Ke=["transform"],Qe=["fill"],We={transform:"translate(0 10)",fill:"currentColor","text-anchor":"middle"},Ye={__name:"BeatControlBar",props:{modelValue:{type:[Number,String],default:.1},step:{type:Number,default:.1},min:{type:Number,default:0},max:{type:Number,default:1},width:{type:Number,default:100},height:{type:Number,default:50},vector:{type:Array,default:[1,-1]},showPositions:{type:Boolean,default:!1},ratio:{type:Number,default:200},every:{type:Number,default:null},showCenter:{type:Boolean,default:!1},inverted:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:g}){const{isDark:x}=q(),d=g,l=e,y=G({inner:Q((Number(l.modelValue)-l.min)/(l.max-l.min),0,1),proportion:S(()=>l.inverted?(Number(l.modelValue)-l.max)/(l.min-l.max):(Number(l.modelValue)-l.min)/(l.max-l.min)),pos:S(()=>y.proportion*l.width)});function i(m){y.inner+=(l.vector[0]*m.delta[0]+l.vector[1]*m.delta[1])/l.ratio}function f(m){y.inner+=m*l.step/(l.max-l.min)}L(()=>y.inner,m=>{let a=m*(l.max-l.min)+l.min;d("update:modelValue",Math.round(a/l.step)*l.step)});const b=S(()=>{let m=(l.max-l.min)/l.step,a=[];for(let c=0;c<=1;c+=1/m)a.push(c*l.width);return a});return(m,a)=>{const c=U("drag");return w((n(),r("g",Ie,[o("line",{class:"add",onMousedown:a[0]||(a[0]=p=>f(1)),x1:e.inverted?0:y.pos,x2:e.inverted?y.pos:e.width,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":e.height,stroke:t(x)?"#1114":"#fff8"},null,40,Oe),o("line",{class:"pointer-events-none",x1:0,x2:e.width,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":18,stroke:t(x)?"#2228":"#eee"},null,8,qe),o("line",{class:"subtract",onMousedown:a[1]||(a[1]=p=>f(-1)),x1:e.inverted?e.width:e.showCenter?e.width/2:0,x2:y.pos,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":e.height,stroke:t(x)?"#3338":"#ddd8"},null,40,He),e.showPositions?(n(),r("g",Fe,[(n(!0),r(V,null,M(b.value,(p,s)=>(n(),r("circle",{key:p,cx:p,cy:e.height/2,r:e.every&&s%e.every==0?4:2,fill:"currentColor",opacity:"0.5"},null,8,Ge))),128))])):C("",!0),e.showCenter?(n(),r("circle",{key:1,cx:e.width/2,cy:e.height/2,r:"4",opacity:"0.5",fill:"currentColor"},null,8,Je)):C("",!0),o("g",{class:"mover",transform:`translate(${y.pos} ${e.height/2})`},[o("circle",{r:"25","stroke-width":"0","stroke-opacity":"0.5",stroke:"currentColor",style:{filter:"url(#shadowButton)"},fill:t(x)?"#333":"#eee"},null,8,Qe),o("g",We,[me(m.$slots,"default",{},()=>[o("text",null,_(e.modelValue),1)])])],8,Ke)])),[[c,i]])}}},Ze={class:"w-full bg-light-300 dark-bg-dark-800",version:"1.1",baseProfile:"full",viewBox:"0 0 1000 350",xmlns:"http://www.w3.org/2000/svg",style:{"user-select":"none","touch-action":"none"}},et={key:0,class:"meter-bars",transform:"translate(40,15)"},tt={class:"info",transform:"translate(500,53)"},ot={class:"signature"},nt={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"end",x:-10},lt={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"start",x:10},st={"text-anchor":"middle",style:{"user-select":"none",transition:"all 300ms ease"}},rt=["opacity"],it={class:"lines",transform:"translate(0,100)"},at=["x1","x2"],ut=["x1","x2","stroke"],dt={class:"arrows pointer-events-none"},ct=["transform"],mt=["cx","r","fill"],ft={class:"bottom",transform:"translate(40,290)"},vt={transform:"translate(-20 -30)"},ht=["fill"],yt=["fill"],xt={__name:"BeatBarsBar",props:{order:{type:Number,default:0},loop:{type:Object,default:{over:4,under:4,sound:"A",volume:1}},maxRatio:{type:Number,default:1},editable:{type:Boolean,default:!1},mute:{type:String,default:null},accents:{type:String,default:null},width:{type:Number,default:920}},emits:["del","sound"],setup(e,{emit:g}){const{isDark:x}=q(),d=e,l=S(()=>(1e3-d.width)/2),{seq:y,meter:i,current:f,steps:b,mutes:m,accents:a,volume:c,activeSteps:p,progress:s,pan:v,isEuclidean:R,reset:E,rotateAccents:X}=be(d.loop,d.order,"bars"),H=["A","B","C","D","E"],T=J(H.findIndex(k=>k==(i==null?void 0:i.sound)));L(T,k=>{i.sound=H[k]});const j=S(()=>{const k=1/i.over;return k>=d.maxRatio?d.maxRatio:k});return L(()=>d.loop,k=>{Object.assign(i,{...d.loop})},{immediate:!0}),L(()=>d.accents,k=>{k&&k.split("").forEach((u,z)=>{m.value[z]=u=="0"||u==".",a.value[z]=u=="2"||u=="X"})},{immediate:!0}),(k,u)=>{const z=Ye,W=re,Y=ie,Z=Te,ee=Be,te=ae,oe=ue,ne=de,le=se,N=U("tooltip");return n(),r("svg",Ze,[u[12]||(u[12]=o("defs",null,[o("filter",{id:"shadowButton",x:"-50%",height:"200%",width:"300%"},[o("feDropShadow",{dx:"0",dy:"3",stdDeviation:"3","flood-color":"#2225"})])],-1)),e.editable?(n(),r("g",et,[w(B(z,{class:"over",modelValue:t(i).over,"onUpdate:modelValue":u[0]||(u[0]=h=>t(i).over=h),width:340,step:1,min:2,max:16,"show-positions":"",ratio:500,every:4},null,8,["modelValue"]),[[N,"Number of steps",void 0,{top:!0}]]),w(B(z,{class:"under",transform:"translate(580,0)",modelValue:t(i).under,"onUpdate:modelValue":u[1]||(u[1]=h=>t(i).under=h),width:340,step:1,min:1,max:16,"show-positions":"",ratio:500,every:4,inverted:"",vector:[-1,-1]},null,8,["modelValue"]),[[N,"Measure subdivision",void 0,{top:!0}]])])):C("",!0),o("g",tt,[w((n(),r("g",ot,[u[9]||(u[9]=o("text",{fill:"currentColor","font-size":"45","text-anchor":"middle",y:"2"},"/",-1)),o("text",nt,_(t(i).over),1),o("text",lt,_(t(i).under),1)])),[[N,"Time signature",void 0,{top:!0}]]),w((n(),r("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(70,-10)",onMousedown:u[2]||(u[2]=h=>t(X)(-1))},[u[10]||(u[10]=o("circle",{r:"18",fill:"#5553"},null,-1)),B(W,{"font-size":"28",x:"-17",y:"-17"})],32)),[[N,"Rotate pattern backward",void 0,{top:!0}]]),w((n(),r("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(-70,-10)",onMousedown:u[3]||(u[3]=h=>t(X)(1))},[u[11]||(u[11]=o("circle",{r:"18",fill:"#5553"},null,-1)),B(Y,{"font-size":"28",x:"-17",y:"-17"})],32)),[[N,"Rotate pattern forward",void 0,{top:!0}]])]),o("g",st,[o("g",{class:"steps",opacity:t(c)*.9+.1,transform:"translate(0,90)"},[o("g",it,[o("line",{x1:l.value,x2:j.value*t(b).length*e.width+l.value,stroke:"currentColor","stroke-width":"2"},null,8,at),(n(!0),r(V,null,M(t(p),(h,$)=>(n(),r("line",{key:$,x1:j.value*Number(h)*e.width+l.value,x2:j.value*(t(p)[$+1]||t(b).length)*e.width+l.value,"stroke-width":"6",stroke:t(K)(Number(h)+Number(t(O).pitch)/12*t(b).length,t(b).length,1)},null,8,ut))),128))]),(n(!0),r(V,null,M(t(b),(h,$)=>(n(),D(Z,{key:$,onMute:I=>t(m)[$]=!t(m)[$],onSubdivide:I=>t(b)[$]=I,onAccent:I=>t(a)[$]=!t(a)[$],muted:t(m)[$],step:$,accented:!!t(a)[$],mutes:t(m),current:t(f),subdivisions:h,proportion:j.value,total:t(b).length,width:e.width,pad:l.value},null,8,["onMute","onSubdivide","onAccent","muted","step","accented","mutes","current","subdivisions","proportion","total","width","pad"]))),128)),o("g",dt,[o("line",{class:"progress",transform:`translate(${l.value+t(s)*e.width*j.value*t(i).over}, 0)`,"stroke-width":"4",stroke:"currentColor","stroke-linecap":"round",y2:180},null,8,ct)]),o("circle",{cx:j.value*t(b).length*e.width+l.value,cy:100,r:t(m)[1]?4:8,fill:t(m)[1]?"currentColor":t(we)(Number(t(O).pitch),4)},null,8,mt)],8,rt),o("g",ft,[w((n(),D(z,{class:"volume",modelValue:t(c),"onUpdate:modelValue":u[4]||(u[4]=h=>F(c)?c.value=h:null),width:200,step:.01},{default:P(()=>[o("g",vt,[t(c)==0?(n(),D(ee,{key:0})):(n(),D(te,{key:1}))])]),_:1},8,["modelValue"])),[[N,"Track volume",void 0,{bottom:!0}]]),w((n(),D(z,{class:"pan",transform:"translate(270,0)",modelValue:t(v),"onUpdate:modelValue":u[5]||(u[5]=h=>F(v)?v.value=h:null),min:-1,max:1,width:200,step:.01,"show-center":""},{default:P(()=>[B(oe,{x:-18,y:-30})]),_:1},8,["modelValue"])),[[N,"Track panning",void 0,{bottom:!0}]]),w((n(),D(z,{class:"sound",transform:"translate(540,0)",modelValue:T.value,"onUpdate:modelValue":u[6]||(u[6]=h=>T.value=h),width:265,step:1,min:0,max:4,"show-positions":"",every:1},{default:P(()=>{var h;return[o("text",null,_((h=t(i))==null?void 0:h.sound),1)]}),_:1},8,["modelValue"])),[[N,"Click sound select",void 0,{bottom:!0}]]),B(ve,{name:"fade"},{default:P(()=>[e.editable&&!t(R)?w((n(),r("g",{key:0,class:"reset cursor-pointer",onMousedown:u[7]||(u[7]=h=>t(E)()),transform:"translate(840, 0)"},[o("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:t(x)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,ht),B(ne,{"stroke-width":"0",y:"9",x:"9","font-size":"26"})],32)),[[N,"Reset to Euclidean pattern",void 0,{bottom:!0}]]):C("",!0)]),_:1}),e.editable?w((n(),r("g",{key:0,class:"del cursor-pointer",onMousedown:u[8]||(u[8]=h=>k.$emit("del")),transform:"translate(900, 0)"},[o("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:t(x)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,yt),B(le,{color:"hsla(0,25%,50%,1)","stroke-width":"0",y:"9",x:"9","font-size":"26"})],32)),[[N,"Remove track",void 0,{bottom:!0}]]):C("",!0)])])])}}},pt=fe(xt,[["__scopeId","data-v-e31215ad"]]),A=he("tempo-bar-loops-object",{0:{over:8,under:8,volume:1,sound:"A"},1:{over:3,under:3,volume:.5,sound:"B"}}),bt={class:"flex flex-wrap items-center w-full p-4 has-bg rounded-xl relative gap-6 bg-light-600 dark-bg-dark-500",id:"screen"},wt={key:1,class:"flex flex-col p-2 my-2 is-group w-full"},gt={class:"flex flex"},kt={class:"flex flex-wrap justify-center"},$t={class:"font-bold mx-2"},Ct={key:0},Nt={class:"flex flex-wrap justify-center is-group m-1 text-xl p-2",style:{flex:"1 1 100%"}},_t={key:1,class:"is-group m-2"},Bt=["onClick"],Vt=["onClick"],At={__name:"BeatBars",props:{meters:{type:Array,default:null},patterns:{type:Object,default:null},accents:{type:String,default:"XxXxXxXx"},mute:{type:String,delault:""},secondary:{type:Boolean,default:!1}},setup(e){const g=e,x=J(g.accents),d=G({over:4,under:4,volume:1,sound:"A"});L(()=>g.meters,i=>{if(i){let f=i[0].split("/");A.value={0:{over:Number(f[0]),under:Number(f[1]),volume:g.secondary?0:1,sound:"A"}}}},{immediate:!0}),L(()=>g.patterns,i=>{i&&(x.value=Object.keys(i)[0])},{immediate:!0});function l(i,f){A.value={0:{over:i.length,under:Number(f?f.split("/")[1]:i.length),volume:g.secondary?0:1,sound:"A"}},x.value=i,console.log(A.value)}function y(){A.value[Math.floor(Math.random()*1e4)]={...d}}return(i,f)=>{const b=Ce,m=pt,a=ye("client-only"),c=U("tooltip");return n(),r("div",bt,[B(a,null,{default:P(()=>{var p;return[e.secondary?C("",!0):(n(),D(b,{key:0,secondary:!0})),(n(!0),r(V,null,M(t(A),(s,v)=>(n(),D(m,{class:"my-1 rounded-3xl shadow-lg min-h-36 max-h-30vh",style:{flex:"1 1 420px"},key:v,order:Number(v),loop:s,maxRatio:t(ge),onDel:R=>delete t(A)[v],editable:!e.meters,accents:x.value,mute:e.mute},null,8,["order","loop","maxRatio","onDel","editable","accents","mute"]))),128)),e.patterns?(n(),r("div",wt,[o("div",gt,[(n(!0),r(V,null,M(x.value,(s,v)=>(n(),r("div",{class:"flex-1 p-1 border-1 border-current rounded-lg m-1 opacity-50",key:v,style:xe({opacity:s=="X"?1:.5,backgroundColor:s=="1"||s=="X"||s=="x"?"currentColor":"transparent"})},null,4))),128))]),o("div",kt,[(n(!0),r(V,null,M((p=e.patterns[x.value])==null?void 0:p.names,s=>(n(),r("div",{class:"p-1",key:s},[o("span",$t,_(s.name),1),s.place?(n(),r("span",Ct,"("+_(s.place)+")",1)):C("",!0)]))),128))])])):C("",!0),o("div",Nt,[e.meters?C("",!0):w((n(),r("button",{key:0,class:"text-button",onClick:f[0]||(f[0]=s=>y())},f[2]||(f[2]=[o("div",{class:"i-la-plus"},null,-1)]))),[[c,"Add new track",void 0,{bottom:!0}]]),w((n(),r("button",{class:"text-button flex items-center",onClick:f[1]||(f[1]=s=>t(ke)(t($e)))},f[3]||(f[3]=[o("div",{class:"i-la-file-download"},null,-1)]))),[[c,"Export MIDI file",void 0,{bottom:!0}]]),e.meters&&e.meters.length>1?(n(),r("div",_t,[(n(!0),r(V,null,M(e.meters,s=>(n(),r("button",{class:"text-button",onClick:v=>A.value=[{over:s.split("/")[0],under:s.split("/")[1],sound:"A",volume:1}]},_(s),9,Bt))),256))])):C("",!0),(n(!0),r(V,null,M(e.patterns,(s,v)=>{var R,E;return n(),r("button",{class:pe(["text-button",{active:x.value==v}]),onClick:X=>l(v,s.meter)},_(((E=(R=s==null?void 0:s.names)==null?void 0:R[0])==null?void 0:E.name)||v),11,Vt)}),256))])]}),_:1})])}}};export{At as _};
