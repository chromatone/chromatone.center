import{_ as G}from"./trash.DalJzOjN.js";import{_ as K,a as W,b as Z,c as Q,d as Y}from"./angle-right.CjjJJR54.js";import{m as ee,x as s,y as i,A as l,v as E,c as V,d as z,W as R,E as o,G as C,F as _,B,C as x,I as g,b as T,J as U,q as te,r as q,X as N,M as S,N as D,al as oe,K as ne,L as se,u as le,a1 as re,H as ae,z as ie}from"./framework.Bi_5INRF.js";import{ax as O,aq as j,J as H,Z as ue,c as de,ay as ce,az as me,aA as he,aB as fe}from"./theme.d7JcQ2cC.js";const ve={style:{"vertical-align":"middle"},viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"},ye=l("path",{fill:"currentColor",d:"M15 4.594L13.281 6.28L8.562 11H4v10h4.563l4.718 4.719L15 27.406zm-2 4.843v13.126L9.719 19.28L9.406 19H6v-6h3.406l.313-.281zm7.219 2.344L18.78 13.22L21.563 16l-2.782 2.781l1.438 1.438L23 17.437l2.781 2.782l1.438-1.438L24.437 16l2.782-2.781l-1.438-1.438L23 14.562z"},null,-1),pe=[ye];function xe(e,k){return s(),i("svg",ve,[...pe])}const be=ee({name:"la-volume-off",render:xe}),we=["transform"],ge=["opacity"],ke=["width","fill"],$e=["stroke","fill"],_e=["fill"],Ce=["stroke"],Ne=["onDblclick","data-sub"],Be=["transform"],Ve=["width","x","fill"],Se=["transform","fill","opacity"],Me=["x"],ze=["fill","stroke"],Ae={key:0,class:"transition-all duration-100 ease-out pointer-events-none",cx:0,cy:100,r:"3",fill:"currentColor",opacity:"0.8"},De={__name:"BeatBarsStep",props:{proportion:{type:Number,default:1},step:{type:Number,default:1},subdivisions:{type:[Array,String],default:""},muted:{type:Boolean,default:!1},total:{type:Number,default:4},current:{type:[Number,String],default:0},mutes:{type:Object,default:{}},accented:{type:Boolean,default:!1},width:{type:Number,default:900},pad:{type:Number,default:50}},emits:["mute","subdivide","accent"],setup(e,{emit:k}){const{isDark:y}=E(),c=e,r=k,t=V(()=>O(c.step+j.pitch/12*c.total,c.total,1));V(()=>c.subdivisions[0].includes("!"));const h=H(0,40,640),f=V(()=>Math.floor(h.value/40));z(f,(n,d)=>{if(n==d)return;let p=[];for(let a=0;a<n;a++)p.push(`${c.step}-${a}`);r("subdivide",p)});function b(n){if(n.tap){let d=n.event.currentTarget.dataset.sub;c.mutes[d]=!c.mutes[d]}h.value+=n.delta[0]-n.delta[1]}const u=V(()=>{let n=c.subdivisions[0]==c.current,d=c.subdivisions[0].split("-")[0],p=c.current.split("-")[0];return!c.mutes[c.subdivisions[0]]&&(n||d==p)});return(n,d)=>{const p=R("drag");return s(),i("g",{class:"cursor-pointer",transform:`translate(${e.proportion*e.step*e.width+e.pad},0)`},[l("g",{class:"step",opacity:e.muted?.1:1},[l("rect",{class:"transition-fill duration-100",onMousedown:d[0]||(d[0]=a=>n.$emit("mute")),width:e.proportion*e.width,height:"180",rx:"10",fill:u.value?e.muted?"transparent":t.value:"transparent"},null,40,ke),l("circle",{class:"transition-all duration-100 ease-out",onMousedown:d[1]||(d[1]=a=>e.muted?n.$emit("mute"):n.$emit("accent")),cy:"35",cx:"0",r:"25","stroke-width":"4",stroke:t.value,fill:u.value?e.muted?"transparent":"currentColor":e.accented?t.value:o(y)?"#333":"#eee"},null,40,$e),l("text",{class:"pointer-events-none transition-all duration-100 ease-out",y:"48","font-size":"40","text-anchor":"middle",x:"0",fill:u.value?o(y)?"#333":"#eee":"currentColor"},C(e.step+1),9,_e),l("line",{class:"pointer-events-none",y1:"60",y2:"100","stroke-width":"8",stroke:t.value},null,8,Ce),(s(!0),i(_,null,B(e.subdivisions,(a,v)=>x((s(),i("g",{class:"sub",key:a,onDblclick:A=>{n.$emit("subdivide",[`${a}-1`]),h.value=40},"data-sub":a},[l("line",{transform:`translate(${v*e.proportion*e.width/e.subdivisions.length}, 0)`,y1:"100",y2:"150","stroke-width":"1",stroke:"currentColor"},null,8,Be),l("rect",{class:"transition-fill duration-100",width:e.proportion*e.width/e.subdivisions.length,height:"80",y:"100",rx:"10",x:v*e.proportion*e.width/e.subdivisions.length,fill:`hsla(0,0%,${90-v*80/e.subdivisions.length}%,${a==e.current?.9:.4})`},null,8,Ve),l("circle",{class:"transition-all duration-100 ease-out pointer-events-none",transform:`translate(${v*e.proportion*e.width/e.subdivisions.length}, 0)`,cx:0,cy:100,r:6,fill:a==e.current?"currentColor":e.muted?"transparent":t.value,opacity:e.mutes[a]?0:1,"stroke-width":"4","stroke-linecap":"round"},null,8,Se),e.mutes[a]?g("",!0):(s(),i("text",{key:0,y:"140","font-size":"40","text-anchor":"middle",x:15+v*e.proportion*e.width/e.subdivisions.length,fill:"currentColor"},C(v+1),9,Me))],40,Ne)),[[p,b]])),128)),l("circle",{class:"transition-all duration-100 ease-out pointer-events-none",cx:"0",cy:100,r:"10",fill:t.value,stroke:u.value?"currentColor":"transparent","stroke-width":"4",opacity:"0.8"},null,8,ze)],8,ge),e.muted?(s(),i("circle",Ae)):g("",!0)],8,we)}}},Le={class:"bar cursor-pointer","font-size":"32px"},Re=["x1","x2","y1","y2","stroke-width","stroke"],Ie=["x2","y1","y2","stroke"],Xe=["x1","x2","y1","y2","stroke-width","stroke"],je={key:0,class:"all"},Ee=["cx","cy","r"],Pe=["cx","cy"],Te=["transform"],Ue=["fill"],qe={transform:"translate(0 10)",fill:"currentColor","text-anchor":"middle"},Oe={__name:"BeatControlBar",props:{modelValue:{type:[Number,String],default:.1},step:{type:Number,default:.1},min:{type:Number,default:0},max:{type:Number,default:1},width:{type:Number,default:100},height:{type:Number,default:50},vector:{type:Array,default:[1,-1]},showPositions:{type:Boolean,default:!1},ratio:{type:Number,default:200},every:{type:Number,default:null},showCenter:{type:Boolean,default:!1},inverted:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:k}){const{isDark:y}=E(),c=k,r=e,t=T({inner:H((Number(r.modelValue)-r.min)/(r.max-r.min),0,1),proportion:V(()=>r.inverted?(Number(r.modelValue)-r.max)/(r.min-r.max):(Number(r.modelValue)-r.min)/(r.max-r.min)),pos:V(()=>t.proportion*r.width)});function h(u){t.inner+=(r.vector[0]*u.delta[0]+r.vector[1]*u.delta[1])/r.ratio}function f(u){t.inner+=u*r.step/(r.max-r.min)}z(()=>t.inner,u=>{let n=u*(r.max-r.min)+r.min;c("update:modelValue",Math.round(n/r.step)*r.step)});const b=V(()=>{let u=(r.max-r.min)/r.step,n=[];for(let d=0;d<=1;d+=1/u)n.push(d*r.width);return n});return(u,n)=>{const d=R("drag");return x((s(),i("g",Le,[l("line",{class:"add",onMousedown:n[0]||(n[0]=p=>f(1)),x1:e.inverted?0:t.pos,x2:e.inverted?t.pos:e.width,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":e.height,stroke:o(y)?"#1114":"#fff8"},null,40,Re),l("line",{class:"pointer-events-none",x1:0,x2:e.width,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":18,stroke:o(y)?"#2228":"#eee"},null,8,Ie),l("line",{class:"subtract",onMousedown:n[1]||(n[1]=p=>f(-1)),x1:e.inverted?e.width:e.showCenter?e.width/2:0,x2:t.pos,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":e.height,stroke:o(y)?"#3338":"#ddd8"},null,40,Xe),e.showPositions?(s(),i("g",je,[(s(!0),i(_,null,B(b.value,(p,a)=>(s(),i("circle",{key:p,cx:p,cy:e.height/2,r:e.every&&a%e.every==0?4:2,fill:"currentColor",opacity:"0.5"},null,8,Ee))),128))])):g("",!0),e.showCenter?(s(),i("circle",{key:1,cx:e.width/2,cy:e.height/2,r:"4",opacity:"0.5",fill:"currentColor"},null,8,Pe)):g("",!0),l("g",{class:"mover",transform:`translate(${t.pos} ${e.height/2})`},[l("circle",{r:"25","stroke-width":"0","stroke-opacity":"0.5",stroke:"currentColor",style:{filter:"url(#shadowButton)"},fill:o(y)?"#333":"#eee"},null,8,Ue),l("g",qe,[U(u.$slots,"default",{},()=>[l("text",null,C(e.modelValue),1)])])],8,Te)])),[[d,h]])}}},I=e=>(ne("data-v-28dbaefe"),e=e(),se(),e),He={class:"w-full bg-light-300 dark-bg-dark-800",version:"1.1",baseProfile:"full",viewBox:"0 0 1000 350",xmlns:"http://www.w3.org/2000/svg",style:{"user-select":"none","touch-action":"none"}},Fe=I(()=>l("defs",null,[l("filter",{id:"shadowButton",x:"-50%",height:"200%",width:"300%"},[l("feDropShadow",{dx:"0",dy:"3",stdDeviation:"3","flood-color":"#2225"})])],-1)),Je={key:0,class:"meter-bars",transform:"translate(40,15)"},Ge={class:"info",transform:"translate(500,53)"},Ke={class:"signature"},We=I(()=>l("text",{fill:"currentColor","font-size":"45","text-anchor":"middle",y:"2"},"/",-1)),Ze={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"end",x:-10},Qe={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"start",x:10},Ye=I(()=>l("circle",{r:"18",fill:"#5553"},null,-1)),et=I(()=>l("circle",{r:"18",fill:"#5553"},null,-1)),tt={"text-anchor":"middle",style:{"user-select":"none",transition:"all 300ms ease"}},ot=["opacity"],nt={class:"lines",transform:"translate(0,100)"},st=["x1","x2"],lt=["x1","x2","stroke"],rt={class:"arrows pointer-events-none"},at=["transform"],it=["cx","r","fill"],ut={class:"bottom",transform:"translate(40,290)"},dt={transform:"translate(-20 -30)"},ct=["fill"],mt=["fill"],ht={__name:"BeatBarsBar",props:{order:{type:Number,default:0},loop:{type:Object,default:{over:4,under:4,sound:"A",volume:1}},maxRatio:{type:Number,default:1},editable:{type:Boolean,default:!1},mute:{type:String,default:null},accents:{type:String,default:null},width:{type:Number,default:920}},emits:["del","sound"],setup(e,{emit:k}){const{isDark:y}=E(),c=e,r=V(()=>(1e3-c.width)/2),{seq:t}=ue(c.loop,c.order,"bars"),h=["A","B","C","D","E"],f=q(h.findIndex(u=>{var n;return u==((n=t.meter)==null?void 0:n.sound)}));z(f,u=>{t.meter.sound=h[u]});const b=V(()=>{const u=1/t.meter.over;return u>=c.maxRatio?c.maxRatio:u});return z(()=>c.loop,u=>{t.meter={...c.loop}},{immediate:!0}),z(()=>c.accents,u=>{u&&u.split("").forEach((n,d)=>{t.mutes[d]=n=="0"||n==".",t.accents[d]=n=="2"||n=="X"})},{immediate:!0}),(u,n)=>{const d=Oe,p=K,a=W,v=De,A=be,L=Z,P=Q,F=Y,J=G,$=R("tooltip");return s(),i(_,null,[U(u.$slots,"default",{},void 0,!0),(s(),i("svg",He,[Fe,e.editable?(s(),i("g",Je,[x(N(d,{class:"over",modelValue:o(t).meter.over,"onUpdate:modelValue":n[0]||(n[0]=m=>o(t).meter.over=m),width:340,step:1,min:2,max:16,"show-positions":"",ratio:500,every:4},null,8,["modelValue"]),[[$,"Number of steps",void 0,{top:!0}]]),x(N(d,{class:"under",transform:"translate(580,0)",modelValue:o(t).meter.under,"onUpdate:modelValue":n[1]||(n[1]=m=>o(t).meter.under=m),width:340,step:1,min:1,max:16,"show-positions":"",ratio:500,every:4,inverted:"",vector:[-1,-1]},null,8,["modelValue"]),[[$,"Measure subdivision",void 0,{top:!0}]])])):g("",!0),l("g",Ge,[x((s(),i("g",Ke,[We,l("text",Ze,C(o(t).meter.over),1),l("text",Qe,C(o(t).meter.under),1)])),[[$,"Time signature",void 0,{top:!0}]]),x((s(),i("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(70,-10)",onMousedown:n[2]||(n[2]=m=>o(t).rotateAccents(-1))},[Ye,N(p,{"font-size":"28",x:"-17",y:"-17"})],32)),[[$,"Rotate pattern backward",void 0,{top:!0}]]),x((s(),i("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(-70,-10)",onMousedown:n[3]||(n[3]=m=>o(t).rotateAccents(1))},[et,N(a,{"font-size":"28",x:"-17",y:"-17"})],32)),[[$,"Rotate pattern forward",void 0,{top:!0}]])]),l("g",tt,[l("g",{class:"steps",opacity:o(t).volume*.9+.1,transform:"translate(0,90)"},[l("g",nt,[l("line",{x1:r.value,x2:b.value*o(t).steps.length*e.width+r.value,stroke:"currentColor","stroke-width":"2"},null,8,st),(s(!0),i(_,null,B(o(t).activeSteps,(m,w)=>(s(),i("line",{key:w,x1:b.value*Number(m)*e.width+r.value,x2:b.value*(o(t).activeSteps[w+1]||o(t).steps.length)*e.width+r.value,"stroke-width":"6",stroke:o(O)(Number(m)+Number(o(j).pitch)/12*o(t).steps.length,o(t).steps.length,1)},null,8,lt))),128))]),(s(!0),i(_,null,B(o(t).steps,(m,w)=>(s(),S(v,{key:w,onMute:X=>o(t).mutes[w]=!o(t).mutes[w],onSubdivide:X=>o(t).steps[w]=X,onAccent:X=>o(t).accents[w]=!o(t).accents[w],muted:o(t).mutes[w],step:w,accented:!!o(t).accents[w],mutes:o(t).mutes,current:o(t).current,subdivisions:m,proportion:b.value,total:o(t).steps.length,width:e.width,pad:r.value},null,8,["onMute","onSubdivide","onAccent","muted","step","accented","mutes","current","subdivisions","proportion","total","width","pad"]))),128)),l("g",rt,[l("line",{class:"progress",transform:`translate(${r.value+o(t).progress*e.width*b.value*o(t).meter.over}, 0)`,"stroke-width":"4",stroke:"currentColor","stroke-linecap":"round",y2:180},null,8,at)]),l("circle",{cx:b.value*o(t).steps.length*e.width+r.value,cy:100,r:o(t).mutes[1]?4:8,fill:o(t).mutes[1]?"currentColor":o(de)(Number(o(j).pitch),4)},null,8,it)],8,ot),l("g",ut,[x((s(),S(d,{class:"volume",modelValue:o(t).volume,"onUpdate:modelValue":n[4]||(n[4]=m=>o(t).volume=m),width:200,step:.01},{default:D(()=>[l("g",dt,[o(t).volume==0?(s(),S(A,{key:0})):(s(),S(L,{key:1}))])]),_:1},8,["modelValue"])),[[$,"Track volume",void 0,{bottom:!0}]]),x((s(),S(d,{class:"pan",transform:"translate(270,0)",modelValue:o(t).pan,"onUpdate:modelValue":n[5]||(n[5]=m=>o(t).pan=m),min:-1,max:1,width:200,step:.01,"show-center":""},{default:D(()=>[N(P,{x:-18,y:-30})]),_:1},8,["modelValue"])),[[$,"Track panning",void 0,{bottom:!0}]]),x((s(),S(d,{class:"sound",transform:"translate(540,0)",modelValue:f.value,"onUpdate:modelValue":n[6]||(n[6]=m=>f.value=m),width:265,step:1,min:0,max:4,"show-positions":"",every:1},{default:D(()=>{var m;return[l("text",null,C((m=o(t).meter)==null?void 0:m.sound),1)]}),_:1},8,["modelValue"])),[[$,"Click sound select",void 0,{bottom:!0}]]),N(oe,{name:"fade"},{default:D(()=>[e.editable&&!o(t).isEuclidean?x((s(),i("g",{key:0,class:"reset cursor-pointer",onMousedown:n[7]||(n[7]=m=>o(t).reset()),transform:"translate(840, 0)"},[l("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:o(y)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,ct),N(F,{"stroke-width":"0",y:"9",x:"9","font-size":"26"})],32)),[[$,"Reset to Euclidean pattern",void 0,{bottom:!0}]]):g("",!0)]),_:1}),e.editable?x((s(),i("g",{key:0,class:"del cursor-pointer",onMousedown:n[8]||(n[8]=m=>u.$emit("del")),transform:"translate(900, 0)"},[l("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:o(y)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,mt),N(J,{color:"hsla(0,25%,50%,1)","stroke-width":"0",y:"9",x:"9","font-size":"26"})],32)),[[$,"Remove track",void 0,{bottom:!0}]]):g("",!0)])])]))],64)}}},ft=te(ht,[["__scopeId","data-v-28dbaefe"]]),M=le("tempo-bar-loops-object",{0:{over:8,under:8,volume:1,sound:"A"},1:{over:3,under:3,volume:.5,sound:"B"}}),vt={class:"flex flex-wrap items-center w-full p-4 has-bg rounded-xl relative gap-6 bg-light-600 dark-bg-dark-500",id:"screen"},yt={key:1,class:"flex flex-col p-2 my-2 is-group"},pt={class:"flex flex"},xt={class:"flex flex-wrap justify-center"},bt={class:"font-bold mx-2"},wt={key:0},gt={class:"flex flex-wrap justify-center is-group m-1 text-xl p-2",style:{flex:"1 1 100%"}},kt=l("div",{class:"i-la-plus"},null,-1),$t=[kt],_t=l("div",{class:"i-la-file-download"},null,-1),Ct=[_t],Nt={key:1,class:"is-group m-2"},Bt=["onClick"],Vt=["onClick"],Dt={__name:"BeatBars",props:{meters:{type:Array,default:null},patterns:{type:Object,default:null},accents:{type:String,default:"XxXxXxXx"},mute:{type:String,delault:""},secondary:{type:Boolean,default:!1}},setup(e){const k=e,y=q(k.accents),c=T({over:4,under:4,volume:1,sound:"A"});z(()=>k.meters,h=>{if(h){let f=h[0].split("/");M.value={0:{over:Number(f[0]),under:Number(f[1]),volume:k.secondary?0:1,sound:"A"}}}},{immediate:!0}),z(()=>k.patterns,h=>{h&&(y.value=Object.keys(h)[0])},{immediate:!0});function r(h,f){M.value[0].over=h.length,M.value[0].under=f?f.split("/")[1]:h.length,y.value=h}function t(){M.value[Math.floor(Math.random()*1e4)]={...c}}return(h,f)=>{const b=fe,u=ft,n=re("client-only"),d=R("tooltip");return s(),i("div",vt,[N(n,null,{default:D(()=>{var p;return[e.secondary?g("",!0):(s(),S(b,{key:0,secondary:!0})),(s(!0),i(_,null,B(o(M),(a,v)=>(s(),S(u,{class:"my-1 rounded-3xl shadow-lg min-h-36 max-h-30vh",style:{flex:"1 1 420px"},key:v,order:v,loop:a,maxRatio:o(ce),onDel:A=>delete o(M)[v],editable:!e.meters,accents:y.value,mute:e.mute},null,8,["order","loop","maxRatio","onDel","editable","accents","mute"]))),128)),e.patterns?(s(),i("div",yt,[l("div",pt,[(s(!0),i(_,null,B(y.value,(a,v)=>(s(),i("div",{class:"flex-1 p-1 border-1 border-current rounded-lg m-1 opacity-50",key:v,style:ae({opacity:a=="X"?1:.5,backgroundColor:a=="1"||a=="X"||a=="x"?"currentColor":"transparent"})},null,4))),128))]),l("div",xt,[(s(!0),i(_,null,B((p=e.patterns[y.value])==null?void 0:p.names,a=>(s(),i("div",{class:"p-1",key:a},[l("span",bt,C(a.name),1),a.place?(s(),i("span",wt,"("+C(a.place)+")",1)):g("",!0)]))),128))])])):g("",!0),l("div",gt,[e.meters?g("",!0):x((s(),i("button",{key:0,class:"text-button",onClick:f[0]||(f[0]=a=>t())},$t)),[[d,"Add new track",void 0,{bottom:!0}]]),x((s(),i("button",{class:"text-button flex items-center",onClick:f[1]||(f[1]=a=>o(me)(o(he)))},Ct)),[[d,"Export MIDI file",void 0,{bottom:!0}]]),e.meters&&e.meters.length>1?(s(),i("div",Nt,[(s(!0),i(_,null,B(e.meters,a=>(s(),i("button",{class:"text-button",onClick:v=>M.value=[{over:a.split("/")[0],under:a.split("/")[1],sound:"A",volume:1}]},C(a),9,Bt))),256))])):g("",!0),(s(!0),i(_,null,B(e.patterns,(a,v)=>{var A,L;return s(),i("button",{class:ie(["text-button",{active:y.value==v}]),onClick:P=>r(v,a.meter)},C(((L=(A=a==null?void 0:a.names)==null?void 0:A[0])==null?void 0:L.name)||v),11,Vt)}),256))])]}),_:1})])}}};export{Dt as _};
