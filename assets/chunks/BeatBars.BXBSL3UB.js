import{_ as F}from"./trash.sjpWDxes.js";import{_ as G,a as J,b as K,c as Q,d as W}from"./angle-right.DYjdFWp6.js";import{E as Y,f as s,g as a,h as l,e as E,c as V,d as z,P as R,l as n,m as C,F as N,j as B,k as x,q as k,b as U,x as Z,_ as ee,r as T,R as _,z as M,A,am as te,u as oe,$ as ne,p as le,n as se}from"./framework.BX1Y-ISu.js";import{ar as I,ak as P,H as O,U as re,c as ie,as as ae,at as ue,au as de,av as ce}from"./theme.rTQmAKbR.js";const me={style:{"vertical-align":"middle"},viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"};function fe(e,b){return s(),a("svg",me,b[0]||(b[0]=[l("path",{fill:"currentColor",d:"M15 4.594L13.281 6.28L8.562 11H4v10h4.563l4.718 4.719L15 27.406zm-2 4.843v13.126L9.719 19.28L9.406 19H6v-6h3.406l.313-.281zm7.219 2.344L18.78 13.22L21.563 16l-2.782 2.781l1.438 1.438L23 17.437l2.781 2.782l1.438-1.438L24.437 16l2.782-2.781l-1.438-1.438L23 14.562z"},null,-1)]))}const ve=Y({name:"la-volume-off",render:fe}),he=["transform"],ye=["opacity"],pe=["width","fill"],xe=["stroke","fill"],be=["fill"],we=["stroke"],ge=["onDblclick","data-sub"],ke=["transform"],$e=["width","x","fill"],Ce=["transform","fill","opacity"],_e=["x"],Ne=["fill","stroke"],Be={key:0,class:"transition-all duration-100 ease-out pointer-events-none",cx:0,cy:100,r:"3",fill:"currentColor",opacity:"0.8"},Ve={__name:"BeatBarsStep",props:{proportion:{type:Number,default:1},step:{type:Number,default:1},subdivisions:{type:[Array,String],default:""},muted:{type:Boolean,default:!1},total:{type:Number,default:4},current:{type:[Number,String],default:0},mutes:{type:Object,default:{}},accented:{type:Boolean,default:!1},width:{type:Number,default:900},pad:{type:Number,default:50}},emits:["mute","subdivide","accent"],setup(e,{emit:b}){const{isDark:y}=E(),c=e,r=b,t=V(()=>I(c.step+P.pitch/12*c.total,c.total,1));V(()=>c.subdivisions[0].includes("!"));const v=O(0,40,640),m=V(()=>Math.floor(v.value/40));z(m,(o,d)=>{if(o==d)return;let p=[];for(let i=0;i<o;i++)p.push(`${c.step}-${i}`);r("subdivide",p)});function w(o){if(o.tap){let d=o.event.currentTarget.dataset.sub;c.mutes[d]=!c.mutes[d]}v.value+=o.delta[0]-o.delta[1]}const u=V(()=>{let o=c.subdivisions[0]==c.current,d=c.subdivisions[0].split("-")[0],p=c.current.split("-")[0];return!c.mutes[c.subdivisions[0]]&&(o||d==p)});return(o,d)=>{const p=R("drag");return s(),a("g",{class:"cursor-pointer",transform:`translate(${e.proportion*e.step*e.width+e.pad},0)`},[l("g",{class:"step",opacity:e.muted?.1:1},[l("rect",{class:"transition-fill duration-100",onMousedown:d[0]||(d[0]=i=>o.$emit("mute")),width:e.proportion*e.width,height:"180",rx:"10",fill:u.value?e.muted?"transparent":t.value:"transparent"},null,40,pe),l("circle",{class:"transition-all duration-100 ease-out",onMousedown:d[1]||(d[1]=i=>e.muted?o.$emit("mute"):o.$emit("accent")),cy:"35",cx:"0",r:"25","stroke-width":"4",stroke:t.value,fill:u.value?e.muted?"transparent":"currentColor":e.accented?t.value:n(y)?"#333":"#eee"},null,40,xe),l("text",{class:"pointer-events-none transition-all duration-100 ease-out",y:"48","font-size":"40","text-anchor":"middle",x:"0",fill:u.value?n(y)?"#333":"#eee":"currentColor"},C(e.step+1),9,be),l("line",{class:"pointer-events-none",y1:"60",y2:"100","stroke-width":"8",stroke:t.value},null,8,we),(s(!0),a(N,null,B(e.subdivisions,(i,h)=>x((s(),a("g",{class:"sub",key:i,onDblclick:D=>{o.$emit("subdivide",[`${i}-1`]),v.value=40},"data-sub":i},[l("line",{transform:`translate(${h*e.proportion*e.width/e.subdivisions.length}, 0)`,y1:"100",y2:"150","stroke-width":"1",stroke:"currentColor"},null,8,ke),l("rect",{class:"transition-fill duration-100",width:e.proportion*e.width/e.subdivisions.length,height:"80",y:"100",rx:"10",x:h*e.proportion*e.width/e.subdivisions.length,fill:`hsla(0,0%,${90-h*80/e.subdivisions.length}%,${i==e.current?.9:.4})`},null,8,$e),l("circle",{class:"transition-all duration-100 ease-out pointer-events-none",transform:`translate(${h*e.proportion*e.width/e.subdivisions.length}, 0)`,cx:0,cy:100,r:6,fill:i==e.current?"currentColor":e.muted?"transparent":t.value,opacity:e.mutes[i]?0:1,"stroke-width":"4","stroke-linecap":"round"},null,8,Ce),e.mutes[i]?k("",!0):(s(),a("text",{key:0,y:"140","font-size":"40","text-anchor":"middle",x:15+h*e.proportion*e.width/e.subdivisions.length,fill:"currentColor"},C(h+1),9,_e))],40,ge)),[[p,w]])),128)),l("circle",{class:"transition-all duration-100 ease-out pointer-events-none",cx:"0",cy:100,r:"10",fill:t.value,stroke:u.value?"currentColor":"transparent","stroke-width":"4",opacity:"0.8"},null,8,Ne)],8,ye),e.muted?(s(),a("circle",Be)):k("",!0)],8,he)}}},Me={class:"bar cursor-pointer","font-size":"32px"},Se=["x1","x2","y1","y2","stroke-width","stroke"],ze=["x2","y1","y2","stroke"],De=["x1","x2","y1","y2","stroke-width","stroke"],Ae={key:0,class:"all"},Le=["cx","cy","r"],Re=["cx","cy"],je=["transform"],Pe=["fill"],Ee={transform:"translate(0 10)",fill:"currentColor","text-anchor":"middle"},Xe={__name:"BeatControlBar",props:{modelValue:{type:[Number,String],default:.1},step:{type:Number,default:.1},min:{type:Number,default:0},max:{type:Number,default:1},width:{type:Number,default:100},height:{type:Number,default:50},vector:{type:Array,default:[1,-1]},showPositions:{type:Boolean,default:!1},ratio:{type:Number,default:200},every:{type:Number,default:null},showCenter:{type:Boolean,default:!1},inverted:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:b}){const{isDark:y}=E(),c=b,r=e,t=U({inner:O((Number(r.modelValue)-r.min)/(r.max-r.min),0,1),proportion:V(()=>r.inverted?(Number(r.modelValue)-r.max)/(r.min-r.max):(Number(r.modelValue)-r.min)/(r.max-r.min)),pos:V(()=>t.proportion*r.width)});function v(u){t.inner+=(r.vector[0]*u.delta[0]+r.vector[1]*u.delta[1])/r.ratio}function m(u){t.inner+=u*r.step/(r.max-r.min)}z(()=>t.inner,u=>{let o=u*(r.max-r.min)+r.min;c("update:modelValue",Math.round(o/r.step)*r.step)});const w=V(()=>{let u=(r.max-r.min)/r.step,o=[];for(let d=0;d<=1;d+=1/u)o.push(d*r.width);return o});return(u,o)=>{const d=R("drag");return x((s(),a("g",Me,[l("line",{class:"add",onMousedown:o[0]||(o[0]=p=>m(1)),x1:e.inverted?0:t.pos,x2:e.inverted?t.pos:e.width,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":e.height,stroke:n(y)?"#1114":"#fff8"},null,40,Se),l("line",{class:"pointer-events-none",x1:0,x2:e.width,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":18,stroke:n(y)?"#2228":"#eee"},null,8,ze),l("line",{class:"subtract",onMousedown:o[1]||(o[1]=p=>m(-1)),x1:e.inverted?e.width:e.showCenter?e.width/2:0,x2:t.pos,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":e.height,stroke:n(y)?"#3338":"#ddd8"},null,40,De),e.showPositions?(s(),a("g",Ae,[(s(!0),a(N,null,B(w.value,(p,i)=>(s(),a("circle",{key:p,cx:p,cy:e.height/2,r:e.every&&i%e.every==0?4:2,fill:"currentColor",opacity:"0.5"},null,8,Le))),128))])):k("",!0),e.showCenter?(s(),a("circle",{key:1,cx:e.width/2,cy:e.height/2,r:"4",opacity:"0.5",fill:"currentColor"},null,8,Re)):k("",!0),l("g",{class:"mover",transform:`translate(${t.pos} ${e.height/2})`},[l("circle",{r:"25","stroke-width":"0","stroke-opacity":"0.5",stroke:"currentColor",style:{filter:"url(#shadowButton)"},fill:n(y)?"#333":"#eee"},null,8,Pe),l("g",Ee,[Z(u.$slots,"default",{},()=>[l("text",null,C(e.modelValue),1)])])],8,je)])),[[d,v]])}}},Ue={class:"w-full bg-light-300 dark-bg-dark-800",version:"1.1",baseProfile:"full",viewBox:"0 0 1000 350",xmlns:"http://www.w3.org/2000/svg",style:{"user-select":"none","touch-action":"none"}},Te={key:0,class:"meter-bars",transform:"translate(40,15)"},Ie={class:"info",transform:"translate(500,53)"},Oe={class:"signature"},qe={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"end",x:-10},He={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"start",x:10},Fe={"text-anchor":"middle",style:{"user-select":"none",transition:"all 300ms ease"}},Ge=["opacity"],Je={class:"lines",transform:"translate(0,100)"},Ke=["x1","x2"],Qe=["x1","x2","stroke"],We={class:"arrows pointer-events-none"},Ye=["transform"],Ze=["cx","r","fill"],et={class:"bottom",transform:"translate(40,290)"},tt={transform:"translate(-20 -30)"},ot=["fill"],nt=["fill"],lt={__name:"BeatBarsBar",props:{order:{type:Number,default:0},loop:{type:Object,default:{over:4,under:4,sound:"A",volume:1}},maxRatio:{type:Number,default:1},editable:{type:Boolean,default:!1},mute:{type:String,default:null},accents:{type:String,default:null},width:{type:Number,default:920}},emits:["del","sound"],setup(e,{emit:b}){const{isDark:y}=E(),c=e,r=V(()=>(1e3-c.width)/2),{seq:t}=re(c.loop,c.order,"bars"),v=["A","B","C","D","E"],m=T(v.findIndex(u=>{var o;return u==((o=t.meter)==null?void 0:o.sound)}));z(m,u=>{t.meter.sound=v[u]});const w=V(()=>{const u=1/t.meter.over;return u>=c.maxRatio?c.maxRatio:u});return z(()=>c.loop,u=>{t.meter={...c.loop}},{immediate:!0}),z(()=>c.accents,u=>{u&&u.split("").forEach((o,d)=>{t.mutes[d]=o=="0"||o==".",t.accents[d]=o=="2"||o=="X"})},{immediate:!0}),(u,o)=>{const d=Xe,p=G,i=J,h=Ve,D=ve,L=K,X=Q,q=W,H=F,$=R("tooltip");return s(),a("svg",Ue,[o[12]||(o[12]=l("defs",null,[l("filter",{id:"shadowButton",x:"-50%",height:"200%",width:"300%"},[l("feDropShadow",{dx:"0",dy:"3",stdDeviation:"3","flood-color":"#2225"})])],-1)),e.editable?(s(),a("g",Te,[x(_(d,{class:"over",modelValue:n(t).meter.over,"onUpdate:modelValue":o[0]||(o[0]=f=>n(t).meter.over=f),width:340,step:1,min:2,max:16,"show-positions":"",ratio:500,every:4},null,8,["modelValue"]),[[$,"Number of steps",void 0,{top:!0}]]),x(_(d,{class:"under",transform:"translate(580,0)",modelValue:n(t).meter.under,"onUpdate:modelValue":o[1]||(o[1]=f=>n(t).meter.under=f),width:340,step:1,min:1,max:16,"show-positions":"",ratio:500,every:4,inverted:"",vector:[-1,-1]},null,8,["modelValue"]),[[$,"Measure subdivision",void 0,{top:!0}]])])):k("",!0),l("g",Ie,[x((s(),a("g",Oe,[o[9]||(o[9]=l("text",{fill:"currentColor","font-size":"45","text-anchor":"middle",y:"2"},"/",-1)),l("text",qe,C(n(t).meter.over),1),l("text",He,C(n(t).meter.under),1)])),[[$,"Time signature",void 0,{top:!0}]]),x((s(),a("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(70,-10)",onMousedown:o[2]||(o[2]=f=>n(t).rotateAccents(-1))},[o[10]||(o[10]=l("circle",{r:"18",fill:"#5553"},null,-1)),_(p,{"font-size":"28",x:"-17",y:"-17"})],32)),[[$,"Rotate pattern backward",void 0,{top:!0}]]),x((s(),a("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(-70,-10)",onMousedown:o[3]||(o[3]=f=>n(t).rotateAccents(1))},[o[11]||(o[11]=l("circle",{r:"18",fill:"#5553"},null,-1)),_(i,{"font-size":"28",x:"-17",y:"-17"})],32)),[[$,"Rotate pattern forward",void 0,{top:!0}]])]),l("g",Fe,[l("g",{class:"steps",opacity:n(t).volume*.9+.1,transform:"translate(0,90)"},[l("g",Je,[l("line",{x1:r.value,x2:w.value*n(t).steps.length*e.width+r.value,stroke:"currentColor","stroke-width":"2"},null,8,Ke),(s(!0),a(N,null,B(n(t).activeSteps,(f,g)=>(s(),a("line",{key:g,x1:w.value*Number(f)*e.width+r.value,x2:w.value*(n(t).activeSteps[g+1]||n(t).steps.length)*e.width+r.value,"stroke-width":"6",stroke:n(I)(Number(f)+Number(n(P).pitch)/12*n(t).steps.length,n(t).steps.length,1)},null,8,Qe))),128))]),(s(!0),a(N,null,B(n(t).steps,(f,g)=>(s(),M(h,{key:g,onMute:j=>n(t).mutes[g]=!n(t).mutes[g],onSubdivide:j=>n(t).steps[g]=j,onAccent:j=>n(t).accents[g]=!n(t).accents[g],muted:n(t).mutes[g],step:g,accented:!!n(t).accents[g],mutes:n(t).mutes,current:n(t).current,subdivisions:f,proportion:w.value,total:n(t).steps.length,width:e.width,pad:r.value},null,8,["onMute","onSubdivide","onAccent","muted","step","accented","mutes","current","subdivisions","proportion","total","width","pad"]))),128)),l("g",We,[l("line",{class:"progress",transform:`translate(${r.value+n(t).progress*e.width*w.value*n(t).meter.over}, 0)`,"stroke-width":"4",stroke:"currentColor","stroke-linecap":"round",y2:180},null,8,Ye)]),l("circle",{cx:w.value*n(t).steps.length*e.width+r.value,cy:100,r:n(t).mutes[1]?4:8,fill:n(t).mutes[1]?"currentColor":n(ie)(Number(n(P).pitch),4)},null,8,Ze)],8,Ge),l("g",et,[x((s(),M(d,{class:"volume",modelValue:n(t).volume,"onUpdate:modelValue":o[4]||(o[4]=f=>n(t).volume=f),width:200,step:.01},{default:A(()=>[l("g",tt,[n(t).volume==0?(s(),M(D,{key:0})):(s(),M(L,{key:1}))])]),_:1},8,["modelValue"])),[[$,"Track volume",void 0,{bottom:!0}]]),x((s(),M(d,{class:"pan",transform:"translate(270,0)",modelValue:n(t).pan,"onUpdate:modelValue":o[5]||(o[5]=f=>n(t).pan=f),min:-1,max:1,width:200,step:.01,"show-center":""},{default:A(()=>[_(X,{x:-18,y:-30})]),_:1},8,["modelValue"])),[[$,"Track panning",void 0,{bottom:!0}]]),x((s(),M(d,{class:"sound",transform:"translate(540,0)",modelValue:m.value,"onUpdate:modelValue":o[6]||(o[6]=f=>m.value=f),width:265,step:1,min:0,max:4,"show-positions":"",every:1},{default:A(()=>{var f;return[l("text",null,C((f=n(t).meter)==null?void 0:f.sound),1)]}),_:1},8,["modelValue"])),[[$,"Click sound select",void 0,{bottom:!0}]]),_(te,{name:"fade"},{default:A(()=>[e.editable&&!n(t).isEuclidean?x((s(),a("g",{key:0,class:"reset cursor-pointer",onMousedown:o[7]||(o[7]=f=>n(t).reset()),transform:"translate(840, 0)"},[l("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:n(y)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,ot),_(q,{"stroke-width":"0",y:"9",x:"9","font-size":"26"})],32)),[[$,"Reset to Euclidean pattern",void 0,{bottom:!0}]]):k("",!0)]),_:1}),e.editable?x((s(),a("g",{key:0,class:"del cursor-pointer",onMousedown:o[8]||(o[8]=f=>u.$emit("del")),transform:"translate(900, 0)"},[l("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:n(y)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,nt),_(H,{color:"hsla(0,25%,50%,1)","stroke-width":"0",y:"9",x:"9","font-size":"26"})],32)),[[$,"Remove track",void 0,{bottom:!0}]]):k("",!0)])])])}}},st=ee(lt,[["__scopeId","data-v-92ba6367"]]),S=oe("tempo-bar-loops-object",{0:{over:8,under:8,volume:1,sound:"A"},1:{over:3,under:3,volume:.5,sound:"B"}}),rt={class:"flex flex-wrap items-center w-full p-4 has-bg rounded-xl relative gap-6 bg-light-600 dark-bg-dark-500",id:"screen"},it={key:1,class:"flex flex-col p-2 my-2 is-group"},at={class:"flex flex"},ut={class:"flex flex-wrap justify-center"},dt={class:"font-bold mx-2"},ct={key:0},mt={class:"flex flex-wrap justify-center is-group m-1 text-xl p-2",style:{flex:"1 1 100%"}},ft={key:1,class:"is-group m-2"},vt=["onClick"],ht=["onClick"],wt={__name:"BeatBars",props:{meters:{type:Array,default:null},patterns:{type:Object,default:null},accents:{type:String,default:"XxXxXxXx"},mute:{type:String,delault:""},secondary:{type:Boolean,default:!1}},setup(e){const b=e,y=T(b.accents),c=U({over:4,under:4,volume:1,sound:"A"});z(()=>b.meters,v=>{if(v){let m=v[0].split("/");S.value={0:{over:Number(m[0]),under:Number(m[1]),volume:b.secondary?0:1,sound:"A"}}}},{immediate:!0}),z(()=>b.patterns,v=>{v&&(y.value=Object.keys(v)[0])},{immediate:!0});function r(v,m){S.value[0].over=v.length,S.value[0].under=m?m.split("/")[1]:v.length,y.value=v}function t(){S.value[Math.floor(Math.random()*1e4)]={...c}}return(v,m)=>{const w=ce,u=st,o=ne("client-only"),d=R("tooltip");return s(),a("div",rt,[_(o,null,{default:A(()=>{var p;return[e.secondary?k("",!0):(s(),M(w,{key:0,secondary:!0})),(s(!0),a(N,null,B(n(S),(i,h)=>(s(),M(u,{class:"my-1 rounded-3xl shadow-lg min-h-36 max-h-30vh",style:{flex:"1 1 420px"},key:h,order:h,loop:i,maxRatio:n(ae),onDel:D=>delete n(S)[h],editable:!e.meters,accents:y.value,mute:e.mute},null,8,["order","loop","maxRatio","onDel","editable","accents","mute"]))),128)),e.patterns?(s(),a("div",it,[l("div",at,[(s(!0),a(N,null,B(y.value,(i,h)=>(s(),a("div",{class:"flex-1 p-1 border-1 border-current rounded-lg m-1 opacity-50",key:h,style:le({opacity:i=="X"?1:.5,backgroundColor:i=="1"||i=="X"||i=="x"?"currentColor":"transparent"})},null,4))),128))]),l("div",ut,[(s(!0),a(N,null,B((p=e.patterns[y.value])==null?void 0:p.names,i=>(s(),a("div",{class:"p-1",key:i},[l("span",dt,C(i.name),1),i.place?(s(),a("span",ct,"("+C(i.place)+")",1)):k("",!0)]))),128))])])):k("",!0),l("div",mt,[e.meters?k("",!0):x((s(),a("button",{key:0,class:"text-button",onClick:m[0]||(m[0]=i=>t())},m[2]||(m[2]=[l("div",{class:"i-la-plus"},null,-1)]))),[[d,"Add new track",void 0,{bottom:!0}]]),x((s(),a("button",{class:"text-button flex items-center",onClick:m[1]||(m[1]=i=>n(ue)(n(de)))},m[3]||(m[3]=[l("div",{class:"i-la-file-download"},null,-1)]))),[[d,"Export MIDI file",void 0,{bottom:!0}]]),e.meters&&e.meters.length>1?(s(),a("div",ft,[(s(!0),a(N,null,B(e.meters,i=>(s(),a("button",{class:"text-button",onClick:h=>S.value=[{over:i.split("/")[0],under:i.split("/")[1],sound:"A",volume:1}]},C(i),9,vt))),256))])):k("",!0),(s(!0),a(N,null,B(e.patterns,(i,h)=>{var D,L;return s(),a("button",{class:se(["text-button",{active:y.value==h}]),onClick:X=>r(h,i.meter)},C(((L=(D=i==null?void 0:i.names)==null?void 0:D[0])==null?void 0:L.name)||h),11,ht)}),256))])]}),_:1})])}}};export{wt as _};
