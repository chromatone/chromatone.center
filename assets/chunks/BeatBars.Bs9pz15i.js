import{_ as G}from"./trash.DuzvxccD.js";import{_ as J,a as K,b as Q,c as W,d as Y}from"./angle-right.BT3HSK16.js";import{E as Z,f as l,g as u,h as s,e as E,c as V,d as z,P as R,l as e,m as $,F as N,j as B,k as x,q as w,b as U,x as tt,_ as et,r as O,R as _,z as M,A,aj as ot,u as nt,$ as st,p as lt,n as rt}from"./framework.BH4RfCYQ.js";import{ar as T,aj as P,H as I,U as it,c as at,as as ut,at as dt,au as ct,av as mt}from"./theme.BS6USJaW.js";const ft={style:{"vertical-align":"middle"},viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"};function vt(t,b){return l(),u("svg",ft,b[0]||(b[0]=[s("path",{fill:"currentColor",d:"M15 4.594L13.281 6.28L8.562 11H4v10h4.563l4.718 4.719L15 27.406zm-2 4.843v13.126L9.719 19.28L9.406 19H6v-6h3.406l.313-.281zm7.219 2.344L18.78 13.22L21.563 16l-2.782 2.781l1.438 1.438L23 17.437l2.781 2.782l1.438-1.438L24.437 16l2.782-2.781l-1.438-1.438L23 14.562z"},null,-1)]))}const ht=Z({name:"la-volume-off",render:vt}),yt=["transform"],pt=["opacity"],xt=["width","fill"],bt=["stroke","fill"],gt=["fill"],wt=["stroke"],kt=["onDblclick","data-sub"],$t=["transform"],Ct=["width","x","fill"],_t=["transform","fill","opacity"],Nt=["x"],Bt=["fill","stroke"],Vt={key:0,class:"transition-all duration-100 ease-out pointer-events-none",cx:0,cy:100,r:"3",fill:"currentColor",opacity:"0.8"},Mt={__name:"BeatBarsStep",props:{proportion:{type:Number,default:1},step:{type:Number,default:1},subdivisions:{type:[Array,String],default:""},muted:{type:Boolean,default:!1},total:{type:Number,default:4},current:{type:[Number,String],default:0},mutes:{type:Object,default:{}},accented:{type:Boolean,default:!1},width:{type:Number,default:900},pad:{type:Number,default:50}},emits:["mute","subdivide","accent"],setup(t,{emit:b}){const{isDark:p}=E(),c=t,r=b,n=V(()=>T(c.step+P.pitch/12*c.total,c.total,1));V(()=>c.subdivisions[0].includes("!"));const d=I(0,40,640),v=V(()=>Math.floor(d.value/40));z(v,(a,o)=>{if(a==o)return;let f=[];for(let i=0;i<a;i++)f.push(`${c.step}-${i}`);r("subdivide",f)});function C(a){if(a.tap){let o=a.event.currentTarget.dataset.sub;c.mutes[o]=!c.mutes[o]}d.value+=a.delta[0]-a.delta[1]}const m=V(()=>{let a=c.subdivisions[0]==c.current,o=c.subdivisions[0].split("-")[0],f=c.current.split("-")[0];return!c.mutes[c.subdivisions[0]]&&(a||o==f)});return(a,o)=>{const f=R("drag");return l(),u("g",{class:"cursor-pointer",transform:`translate(${t.proportion*t.step*t.width+t.pad},0)`},[s("g",{class:"step",opacity:t.muted?.1:1},[s("rect",{class:"transition-fill duration-100",onMousedown:o[0]||(o[0]=i=>a.$emit("mute")),width:t.proportion*t.width,height:"180",rx:"10",fill:m.value?t.muted?"transparent":n.value:"transparent"},null,40,xt),s("circle",{class:"transition-all duration-100 ease-out",onMousedown:o[1]||(o[1]=i=>t.muted?a.$emit("mute"):a.$emit("accent")),cy:"35",cx:"0",r:"25","stroke-width":"4",stroke:n.value,fill:m.value?t.muted?"transparent":"currentColor":t.accented?n.value:e(p)?"#333":"#eee"},null,40,bt),s("text",{class:"pointer-events-none transition-all duration-100 ease-out",y:"48","font-size":"40","text-anchor":"middle",x:"0",fill:m.value?e(p)?"#333":"#eee":"currentColor"},$(t.step+1),9,gt),s("line",{class:"pointer-events-none",y1:"60",y2:"100","stroke-width":"8",stroke:n.value},null,8,wt),(l(!0),u(N,null,B(t.subdivisions,(i,y)=>x((l(),u("g",{class:"sub",key:i,onDblclick:D=>{a.$emit("subdivide",[`${i}-1`]),d.value=40},"data-sub":i},[s("line",{transform:`translate(${y*t.proportion*t.width/t.subdivisions.length}, 0)`,y1:"100",y2:"150","stroke-width":"1",stroke:"currentColor"},null,8,$t),s("rect",{class:"transition-fill duration-100",width:t.proportion*t.width/t.subdivisions.length,height:"80",y:"100",rx:"10",x:y*t.proportion*t.width/t.subdivisions.length,fill:`hsla(0,0%,${90-y*80/t.subdivisions.length}%,${i==t.current?.9:.4})`},null,8,Ct),s("circle",{class:"transition-all duration-100 ease-out pointer-events-none",transform:`translate(${y*t.proportion*t.width/t.subdivisions.length}, 0)`,cx:0,cy:100,r:6,fill:i==t.current?"currentColor":t.muted?"transparent":n.value,opacity:t.mutes[i]?0:1,"stroke-width":"4","stroke-linecap":"round"},null,8,_t),t.mutes[i]?w("",!0):(l(),u("text",{key:0,y:"140","font-size":"40","text-anchor":"middle",x:15+y*t.proportion*t.width/t.subdivisions.length,fill:"currentColor"},$(y+1),9,Nt))],40,kt)),[[f,C]])),128)),s("circle",{class:"transition-all duration-100 ease-out pointer-events-none",cx:"0",cy:100,r:"10",fill:n.value,stroke:m.value?"currentColor":"transparent","stroke-width":"4",opacity:"0.8"},null,8,Bt)],8,pt),t.muted?(l(),u("circle",Vt)):w("",!0)],8,yt)}}},St={class:"bar cursor-pointer","font-size":"32px"},zt=["x1","x2","y1","y2","stroke-width","stroke"],Dt=["x2","y1","y2","stroke"],At=["x1","x2","y1","y2","stroke-width","stroke"],Lt={key:0,class:"all"},Rt=["cx","cy","r"],jt=["cx","cy"],Pt=["transform"],Et=["fill"],Xt={transform:"translate(0 10)",fill:"currentColor","text-anchor":"middle"},Ut={__name:"BeatControlBar",props:{modelValue:{type:[Number,String],default:.1},step:{type:Number,default:.1},min:{type:Number,default:0},max:{type:Number,default:1},width:{type:Number,default:100},height:{type:Number,default:50},vector:{type:Array,default:[1,-1]},showPositions:{type:Boolean,default:!1},ratio:{type:Number,default:200},every:{type:Number,default:null},showCenter:{type:Boolean,default:!1},inverted:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:b}){const{isDark:p}=E(),c=b,r=t,n=U({inner:I((Number(r.modelValue)-r.min)/(r.max-r.min),0,1),proportion:V(()=>r.inverted?(Number(r.modelValue)-r.max)/(r.min-r.max):(Number(r.modelValue)-r.min)/(r.max-r.min)),pos:V(()=>n.proportion*r.width)});function d(m){n.inner+=(r.vector[0]*m.delta[0]+r.vector[1]*m.delta[1])/r.ratio}function v(m){n.inner+=m*r.step/(r.max-r.min)}z(()=>n.inner,m=>{let a=m*(r.max-r.min)+r.min;c("update:modelValue",Math.round(a/r.step)*r.step)});const C=V(()=>{let m=(r.max-r.min)/r.step,a=[];for(let o=0;o<=1;o+=1/m)a.push(o*r.width);return a});return(m,a)=>{const o=R("drag");return x((l(),u("g",St,[s("line",{class:"add",onMousedown:a[0]||(a[0]=f=>v(1)),x1:t.inverted?0:n.pos,x2:t.inverted?n.pos:t.width,y1:t.height/2,y2:t.height/2,"stroke-linecap":"round","stroke-width":t.height,stroke:e(p)?"#1114":"#fff8"},null,40,zt),s("line",{class:"pointer-events-none",x1:0,x2:t.width,y1:t.height/2,y2:t.height/2,"stroke-linecap":"round","stroke-width":18,stroke:e(p)?"#2228":"#eee"},null,8,Dt),s("line",{class:"subtract",onMousedown:a[1]||(a[1]=f=>v(-1)),x1:t.inverted?t.width:t.showCenter?t.width/2:0,x2:n.pos,y1:t.height/2,y2:t.height/2,"stroke-linecap":"round","stroke-width":t.height,stroke:e(p)?"#3338":"#ddd8"},null,40,At),t.showPositions?(l(),u("g",Lt,[(l(!0),u(N,null,B(C.value,(f,i)=>(l(),u("circle",{key:f,cx:f,cy:t.height/2,r:t.every&&i%t.every==0?4:2,fill:"currentColor",opacity:"0.5"},null,8,Rt))),128))])):w("",!0),t.showCenter?(l(),u("circle",{key:1,cx:t.width/2,cy:t.height/2,r:"4",opacity:"0.5",fill:"currentColor"},null,8,jt)):w("",!0),s("g",{class:"mover",transform:`translate(${n.pos} ${t.height/2})`},[s("circle",{r:"25","stroke-width":"0","stroke-opacity":"0.5",stroke:"currentColor",style:{filter:"url(#shadowButton)"},fill:e(p)?"#333":"#eee"},null,8,Et),s("g",Xt,[tt(m.$slots,"default",{},()=>[s("text",null,$(t.modelValue),1)])])],8,Pt)])),[[o,d]])}}},Ot={class:"w-full bg-light-300 dark-bg-dark-800",version:"1.1",baseProfile:"full",viewBox:"0 0 1000 350",xmlns:"http://www.w3.org/2000/svg",style:{"user-select":"none","touch-action":"none"}},Tt={key:0,class:"meter-bars",transform:"translate(40,15)"},It={class:"info",transform:"translate(500,53)"},qt={class:"signature"},Ht={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"end",x:-10},Ft={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"start",x:10},Gt={"text-anchor":"middle",style:{"user-select":"none",transition:"all 300ms ease"}},Jt=["opacity"],Kt={class:"lines",transform:"translate(0,100)"},Qt=["x1","x2"],Wt=["x1","x2","stroke"],Yt={class:"arrows pointer-events-none"},Zt=["transform"],te=["cx","r","fill"],ee={class:"bottom",transform:"translate(40,290)"},oe={transform:"translate(-20 -30)"},ne=["fill"],se=["fill"],le={__name:"BeatBarsBar",props:{order:{type:Number,default:0},loop:{type:Object,default:{over:4,under:4,sound:"A",volume:1}},maxRatio:{type:Number,default:1},editable:{type:Boolean,default:!1},mute:{type:String,default:null},accents:{type:String,default:null},width:{type:Number,default:920}},emits:["del","sound"],setup(t,{emit:b}){const{isDark:p}=E(),c=t,r=V(()=>(1e3-c.width)/2),{seq:n,meter:d}=it(c.loop,c.order,"bars"),v=["A","B","C","D","E"],C=O(v.findIndex(a=>a==(d==null?void 0:d.sound)));z(C,a=>{d.sound=v[a]});const m=V(()=>{const a=1/d.over;return a>=c.maxRatio?c.maxRatio:a});return z(()=>c.loop,a=>{Object.assign(d,{...c.loop})},{immediate:!0}),z(()=>c.accents,a=>{a&&a.split("").forEach((o,f)=>{n.mutes[f]=o=="0"||o==".",n.accents[f]=o=="2"||o=="X"})},{immediate:!0}),(a,o)=>{const f=Ut,i=J,y=K,D=Mt,L=ht,X=Q,q=W,H=Y,F=G,k=R("tooltip");return l(),u("svg",Ot,[o[12]||(o[12]=s("defs",null,[s("filter",{id:"shadowButton",x:"-50%",height:"200%",width:"300%"},[s("feDropShadow",{dx:"0",dy:"3",stdDeviation:"3","flood-color":"#2225"})])],-1)),t.editable?(l(),u("g",Tt,[x(_(f,{class:"over",modelValue:e(d).over,"onUpdate:modelValue":o[0]||(o[0]=h=>e(d).over=h),width:340,step:1,min:2,max:16,"show-positions":"",ratio:500,every:4},null,8,["modelValue"]),[[k,"Number of steps",void 0,{top:!0}]]),x(_(f,{class:"under",transform:"translate(580,0)",modelValue:e(d).under,"onUpdate:modelValue":o[1]||(o[1]=h=>e(d).under=h),width:340,step:1,min:1,max:16,"show-positions":"",ratio:500,every:4,inverted:"",vector:[-1,-1]},null,8,["modelValue"]),[[k,"Measure subdivision",void 0,{top:!0}]])])):w("",!0),s("g",It,[x((l(),u("g",qt,[o[9]||(o[9]=s("text",{fill:"currentColor","font-size":"45","text-anchor":"middle",y:"2"},"/",-1)),s("text",Ht,$(e(d).over),1),s("text",Ft,$(e(d).under),1)])),[[k,"Time signature",void 0,{top:!0}]]),x((l(),u("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(70,-10)",onMousedown:o[2]||(o[2]=h=>e(n).rotateAccents(-1))},[o[10]||(o[10]=s("circle",{r:"18",fill:"#5553"},null,-1)),_(i,{"font-size":"28",x:"-17",y:"-17"})],32)),[[k,"Rotate pattern backward",void 0,{top:!0}]]),x((l(),u("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(-70,-10)",onMousedown:o[3]||(o[3]=h=>e(n).rotateAccents(1))},[o[11]||(o[11]=s("circle",{r:"18",fill:"#5553"},null,-1)),_(y,{"font-size":"28",x:"-17",y:"-17"})],32)),[[k,"Rotate pattern forward",void 0,{top:!0}]])]),s("g",Gt,[s("g",{class:"steps",opacity:e(n).volume*.9+.1,transform:"translate(0,90)"},[s("g",Kt,[s("line",{x1:r.value,x2:m.value*e(n).steps.length*t.width+r.value,stroke:"currentColor","stroke-width":"2"},null,8,Qt),(l(!0),u(N,null,B(e(n).activeSteps,(h,g)=>(l(),u("line",{key:g,x1:m.value*Number(h)*t.width+r.value,x2:m.value*(e(n).activeSteps[g+1]||e(n).steps.length)*t.width+r.value,"stroke-width":"6",stroke:e(T)(Number(h)+Number(e(P).pitch)/12*e(n).steps.length,e(n).steps.length,1)},null,8,Wt))),128))]),(l(!0),u(N,null,B(e(n).steps,(h,g)=>(l(),M(D,{key:g,onMute:j=>e(n).mutes[g]=!e(n).mutes[g],onSubdivide:j=>e(n).steps[g]=j,onAccent:j=>e(n).accents[g]=!e(n).accents[g],muted:e(n).mutes[g],step:g,accented:!!e(n).accents[g],mutes:e(n).mutes,current:e(n).current,subdivisions:h,proportion:m.value,total:e(n).steps.length,width:t.width,pad:r.value},null,8,["onMute","onSubdivide","onAccent","muted","step","accented","mutes","current","subdivisions","proportion","total","width","pad"]))),128)),s("g",Yt,[s("line",{class:"progress",transform:`translate(${r.value+e(n).progress*t.width*m.value*e(d).over}, 0)`,"stroke-width":"4",stroke:"currentColor","stroke-linecap":"round",y2:180},null,8,Zt)]),s("circle",{cx:m.value*e(n).steps.length*t.width+r.value,cy:100,r:e(n).mutes[1]?4:8,fill:e(n).mutes[1]?"currentColor":e(at)(Number(e(P).pitch),4)},null,8,te)],8,Jt),s("g",ee,[x((l(),M(f,{class:"volume",modelValue:e(n).volume,"onUpdate:modelValue":o[4]||(o[4]=h=>e(n).volume=h),width:200,step:.01},{default:A(()=>[s("g",oe,[e(n).volume==0?(l(),M(L,{key:0})):(l(),M(X,{key:1}))])]),_:1},8,["modelValue"])),[[k,"Track volume",void 0,{bottom:!0}]]),x((l(),M(f,{class:"pan",transform:"translate(270,0)",modelValue:e(n).pan,"onUpdate:modelValue":o[5]||(o[5]=h=>e(n).pan=h),min:-1,max:1,width:200,step:.01,"show-center":""},{default:A(()=>[_(q,{x:-18,y:-30})]),_:1},8,["modelValue"])),[[k,"Track panning",void 0,{bottom:!0}]]),x((l(),M(f,{class:"sound",transform:"translate(540,0)",modelValue:C.value,"onUpdate:modelValue":o[6]||(o[6]=h=>C.value=h),width:265,step:1,min:0,max:4,"show-positions":"",every:1},{default:A(()=>{var h;return[s("text",null,$((h=e(d))==null?void 0:h.sound),1)]}),_:1},8,["modelValue"])),[[k,"Click sound select",void 0,{bottom:!0}]]),_(ot,{name:"fade"},{default:A(()=>[t.editable&&!e(n).isEuclidean?x((l(),u("g",{key:0,class:"reset cursor-pointer",onMousedown:o[7]||(o[7]=h=>e(n).reset()),transform:"translate(840, 0)"},[s("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:e(p)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,ne),_(H,{"stroke-width":"0",y:"9",x:"9","font-size":"26"})],32)),[[k,"Reset to Euclidean pattern",void 0,{bottom:!0}]]):w("",!0)]),_:1}),t.editable?x((l(),u("g",{key:0,class:"del cursor-pointer",onMousedown:o[8]||(o[8]=h=>a.$emit("del")),transform:"translate(900, 0)"},[s("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:e(p)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,se),_(F,{color:"hsla(0,25%,50%,1)","stroke-width":"0",y:"9",x:"9","font-size":"26"})],32)),[[k,"Remove track",void 0,{bottom:!0}]]):w("",!0)])])])}}},re=et(le,[["__scopeId","data-v-530caabf"]]),S=nt("tempo-bar-loops-object",{0:{over:8,under:8,volume:1,sound:"A"},1:{over:3,under:3,volume:.5,sound:"B"}}),ie={class:"flex flex-wrap items-center w-full p-4 has-bg rounded-xl relative gap-6 bg-light-600 dark-bg-dark-500",id:"screen"},ae={key:1,class:"flex flex-col p-2 my-2 is-group"},ue={class:"flex flex"},de={class:"flex flex-wrap justify-center"},ce={class:"font-bold mx-2"},me={key:0},fe={class:"flex flex-wrap justify-center is-group m-1 text-xl p-2",style:{flex:"1 1 100%"}},ve={key:1,class:"is-group m-2"},he=["onClick"],ye=["onClick"],we={__name:"BeatBars",props:{meters:{type:Array,default:null},patterns:{type:Object,default:null},accents:{type:String,default:"XxXxXxXx"},mute:{type:String,delault:""},secondary:{type:Boolean,default:!1}},setup(t){const b=t,p=O(b.accents),c=U({over:4,under:4,volume:1,sound:"A"});z(()=>b.meters,d=>{if(d){let v=d[0].split("/");S.value={0:{over:Number(v[0]),under:Number(v[1]),volume:b.secondary?0:1,sound:"A"}}}},{immediate:!0}),z(()=>b.patterns,d=>{d&&(p.value=Object.keys(d)[0])},{immediate:!0});function r(d,v){S.value[0].over=d.length,S.value[0].under=v?v.split("/")[1]:d.length,p.value=d}function n(){S.value[Math.floor(Math.random()*1e4)]={...c}}return(d,v)=>{const C=mt,m=re,a=st("client-only"),o=R("tooltip");return l(),u("div",ie,[_(a,null,{default:A(()=>{var f;return[t.secondary?w("",!0):(l(),M(C,{key:0,secondary:!0})),(l(!0),u(N,null,B(e(S),(i,y)=>(l(),M(m,{class:"my-1 rounded-3xl shadow-lg min-h-36 max-h-30vh",style:{flex:"1 1 420px"},key:y,order:y,loop:i,maxRatio:e(ut),onDel:D=>delete e(S)[y],editable:!t.meters,accents:p.value,mute:t.mute},null,8,["order","loop","maxRatio","onDel","editable","accents","mute"]))),128)),t.patterns?(l(),u("div",ae,[s("div",ue,[(l(!0),u(N,null,B(p.value,(i,y)=>(l(),u("div",{class:"flex-1 p-1 border-1 border-current rounded-lg m-1 opacity-50",key:y,style:lt({opacity:i=="X"?1:.5,backgroundColor:i=="1"||i=="X"||i=="x"?"currentColor":"transparent"})},null,4))),128))]),s("div",de,[(l(!0),u(N,null,B((f=t.patterns[p.value])==null?void 0:f.names,i=>(l(),u("div",{class:"p-1",key:i},[s("span",ce,$(i.name),1),i.place?(l(),u("span",me,"("+$(i.place)+")",1)):w("",!0)]))),128))])])):w("",!0),s("div",fe,[t.meters?w("",!0):x((l(),u("button",{key:0,class:"text-button",onClick:v[0]||(v[0]=i=>n())},v[2]||(v[2]=[s("div",{class:"i-la-plus"},null,-1)]))),[[o,"Add new track",void 0,{bottom:!0}]]),x((l(),u("button",{class:"text-button flex items-center",onClick:v[1]||(v[1]=i=>e(dt)(e(ct)))},v[3]||(v[3]=[s("div",{class:"i-la-file-download"},null,-1)]))),[[o,"Export MIDI file",void 0,{bottom:!0}]]),t.meters&&t.meters.length>1?(l(),u("div",ve,[(l(!0),u(N,null,B(t.meters,i=>(l(),u("button",{class:"text-button",onClick:y=>S.value=[{over:i.split("/")[0],under:i.split("/")[1],sound:"A",volume:1}]},$(i),9,he))),256))])):w("",!0),(l(!0),u(N,null,B(t.patterns,(i,y)=>{var D,L;return l(),u("button",{class:rt(["text-button",{active:p.value==y}]),onClick:X=>r(y,i.meter)},$(((L=(D=i==null?void 0:i.names)==null?void 0:D[0])==null?void 0:L.name)||y),11,ye)}),256))])]}),_:1})])}}};export{we as _};
