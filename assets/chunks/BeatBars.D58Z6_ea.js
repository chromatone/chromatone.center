import{_ as st}from"./trash.DuzvxccD.js";import{_ as rt,a as it,b as at,c as ut,d as dt}from"./angle-right.BT3HSK16.js";import{E as ct,f as n,g as r,h as o,e as q,c as S,d as L,P as X,l as e,m as N,F as V,j as M,k as g,q as C,b as G,x as mt,_ as ft,r as J,R as B,z as D,A as P,V as F,aj as vt,u as ht,$ as yt,p as xt,n as pt}from"./framework.BH4RfCYQ.js";import{ar as K,aj as I,H as Q,U as bt,c as gt,as as wt,at as kt,au as $t,av as Ct}from"./theme.DroiMV_E.js";const _t={style:{"vertical-align":"middle"},viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"};function Nt(t,w){return n(),r("svg",_t,w[0]||(w[0]=[o("path",{fill:"currentColor",d:"M15 4.594L13.281 6.28L8.562 11H4v10h4.563l4.718 4.719L15 27.406zm-2 4.843v13.126L9.719 19.28L9.406 19H6v-6h3.406l.313-.281zm7.219 2.344L18.78 13.22L21.563 16l-2.782 2.781l1.438 1.438L23 17.437l2.781 2.782l1.438-1.438L24.437 16l2.782-2.781l-1.438-1.438L23 14.562z"},null,-1)]))}const Bt=ct({name:"la-volume-off",render:Nt}),Vt=["transform"],Mt=["opacity"],St=["width","fill"],zt=["stroke","fill"],Dt=["fill"],At=["stroke"],Lt=["onDblclick","data-sub"],Rt=["transform"],jt=["width","x","fill"],Pt=["transform","fill","opacity"],Et=["x"],Xt=["fill","stroke"],Ut={key:0,class:"transition-all duration-100 ease-out pointer-events-none",cx:0,cy:100,r:"3",fill:"currentColor",opacity:"0.8"},Ot={__name:"BeatBarsStep",props:{proportion:{type:Number,default:1},step:{type:Number,default:1},subdivisions:{type:[Array,String],default:""},muted:{type:Boolean,default:!1},total:{type:Number,default:4},current:{type:[Number,String],default:0},mutes:{type:Object,default:{}},accented:{type:Boolean,default:!1},width:{type:Number,default:900},pad:{type:Number,default:50}},emits:["mute","subdivide","accent"],setup(t,{emit:w}){const{isDark:x}=q(),d=t,l=w,y=S(()=>K(d.step+I.pitch/12*d.total,d.total,1));S(()=>d.subdivisions[0].includes("!"));const i=Q(0,40,640),f=S(()=>Math.floor(i.value/40));L(f,(a,c)=>{if(a==c)return;let p=[];for(let s=0;s<a;s++)p.push(`${d.step}-${s}`);l("subdivide",p)});function b(a){if(a.tap){let c=a.event.currentTarget.dataset.sub;d.mutes[c]=!d.mutes[c]}i.value+=a.delta[0]-a.delta[1]}const m=S(()=>{let a=d.subdivisions[0]==d.current,c=d.subdivisions[0].split("-")[0],p=d.current.split("-")[0];return!d.mutes[d.subdivisions[0]]&&(a||c==p)});return(a,c)=>{const p=X("drag");return n(),r("g",{class:"cursor-pointer",transform:`translate(${t.proportion*t.step*t.width+t.pad},0)`},[o("g",{class:"step",opacity:t.muted?.1:1},[o("rect",{class:"transition-fill duration-100",onMousedown:c[0]||(c[0]=s=>a.$emit("mute")),width:t.proportion*t.width,height:"180",rx:"10",fill:m.value?t.muted?"transparent":y.value:"transparent"},null,40,St),o("circle",{class:"transition-all duration-100 ease-out",onMousedown:c[1]||(c[1]=s=>t.muted?a.$emit("mute"):a.$emit("accent")),cy:"35",cx:"0",r:"25","stroke-width":"4",stroke:y.value,fill:m.value?t.muted?"transparent":"currentColor":t.accented?y.value:e(x)?"#333":"#eee"},null,40,zt),o("text",{class:"pointer-events-none transition-all duration-100 ease-out",y:"48","font-size":"40","text-anchor":"middle",x:"0",fill:m.value?e(x)?"#333":"#eee":"currentColor"},N(t.step+1),9,Dt),o("line",{class:"pointer-events-none",y1:"60",y2:"100","stroke-width":"8",stroke:y.value},null,8,At),(n(!0),r(V,null,M(t.subdivisions,(s,v)=>g((n(),r("g",{class:"sub",key:s,onDblclick:R=>{a.$emit("subdivide",[`${s}-1`]),i.value=40},"data-sub":s},[o("line",{transform:`translate(${v*t.proportion*t.width/t.subdivisions.length}, 0)`,y1:"100",y2:"150","stroke-width":"1",stroke:"currentColor"},null,8,Rt),o("rect",{class:"transition-fill duration-100",width:t.proportion*t.width/t.subdivisions.length,height:"80",y:"100",rx:"10",x:v*t.proportion*t.width/t.subdivisions.length,fill:`hsla(0,0%,${90-v*80/t.subdivisions.length}%,${s==t.current?.9:.4})`},null,8,jt),o("circle",{class:"transition-all duration-100 ease-out pointer-events-none",transform:`translate(${v*t.proportion*t.width/t.subdivisions.length}, 0)`,cx:0,cy:100,r:6,fill:s==t.current?"currentColor":t.muted?"transparent":y.value,opacity:t.mutes[s]?0:1,"stroke-width":"4","stroke-linecap":"round"},null,8,Pt),t.mutes[s]?C("",!0):(n(),r("text",{key:0,y:"140","font-size":"40","text-anchor":"middle",x:15+v*t.proportion*t.width/t.subdivisions.length,fill:"currentColor"},N(v+1),9,Et))],40,Lt)),[[p,b]])),128)),o("circle",{class:"transition-all duration-100 ease-out pointer-events-none",cx:"0",cy:100,r:"10",fill:y.value,stroke:m.value?"currentColor":"transparent","stroke-width":"4",opacity:"0.8"},null,8,Xt)],8,Mt),t.muted?(n(),r("circle",Ut)):C("",!0)],8,Vt)}}},Tt={class:"bar cursor-pointer","font-size":"32px"},It=["x1","x2","y1","y2","stroke-width","stroke"],qt=["x2","y1","y2","stroke"],Ht=["x1","x2","y1","y2","stroke-width","stroke"],Ft={key:0,class:"all"},Gt=["cx","cy","r"],Jt=["cx","cy"],Kt=["transform"],Qt=["fill"],Wt={transform:"translate(0 10)",fill:"currentColor","text-anchor":"middle"},Yt={__name:"BeatControlBar",props:{modelValue:{type:[Number,String],default:.1},step:{type:Number,default:.1},min:{type:Number,default:0},max:{type:Number,default:1},width:{type:Number,default:100},height:{type:Number,default:50},vector:{type:Array,default:[1,-1]},showPositions:{type:Boolean,default:!1},ratio:{type:Number,default:200},every:{type:Number,default:null},showCenter:{type:Boolean,default:!1},inverted:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:w}){const{isDark:x}=q(),d=w,l=t,y=G({inner:Q((Number(l.modelValue)-l.min)/(l.max-l.min),0,1),proportion:S(()=>l.inverted?(Number(l.modelValue)-l.max)/(l.min-l.max):(Number(l.modelValue)-l.min)/(l.max-l.min)),pos:S(()=>y.proportion*l.width)});function i(m){y.inner+=(l.vector[0]*m.delta[0]+l.vector[1]*m.delta[1])/l.ratio}function f(m){y.inner+=m*l.step/(l.max-l.min)}L(()=>y.inner,m=>{let a=m*(l.max-l.min)+l.min;d("update:modelValue",Math.round(a/l.step)*l.step)});const b=S(()=>{let m=(l.max-l.min)/l.step,a=[];for(let c=0;c<=1;c+=1/m)a.push(c*l.width);return a});return(m,a)=>{const c=X("drag");return g((n(),r("g",Tt,[o("line",{class:"add",onMousedown:a[0]||(a[0]=p=>f(1)),x1:t.inverted?0:y.pos,x2:t.inverted?y.pos:t.width,y1:t.height/2,y2:t.height/2,"stroke-linecap":"round","stroke-width":t.height,stroke:e(x)?"#1114":"#fff8"},null,40,It),o("line",{class:"pointer-events-none",x1:0,x2:t.width,y1:t.height/2,y2:t.height/2,"stroke-linecap":"round","stroke-width":18,stroke:e(x)?"#2228":"#eee"},null,8,qt),o("line",{class:"subtract",onMousedown:a[1]||(a[1]=p=>f(-1)),x1:t.inverted?t.width:t.showCenter?t.width/2:0,x2:y.pos,y1:t.height/2,y2:t.height/2,"stroke-linecap":"round","stroke-width":t.height,stroke:e(x)?"#3338":"#ddd8"},null,40,Ht),t.showPositions?(n(),r("g",Ft,[(n(!0),r(V,null,M(b.value,(p,s)=>(n(),r("circle",{key:p,cx:p,cy:t.height/2,r:t.every&&s%t.every==0?4:2,fill:"currentColor",opacity:"0.5"},null,8,Gt))),128))])):C("",!0),t.showCenter?(n(),r("circle",{key:1,cx:t.width/2,cy:t.height/2,r:"4",opacity:"0.5",fill:"currentColor"},null,8,Jt)):C("",!0),o("g",{class:"mover",transform:`translate(${y.pos} ${t.height/2})`},[o("circle",{r:"25","stroke-width":"0","stroke-opacity":"0.5",stroke:"currentColor",style:{filter:"url(#shadowButton)"},fill:e(x)?"#333":"#eee"},null,8,Qt),o("g",Wt,[mt(m.$slots,"default",{},()=>[o("text",null,N(t.modelValue),1)])])],8,Kt)])),[[c,i]])}}},Zt={class:"w-full bg-light-300 dark-bg-dark-800",version:"1.1",baseProfile:"full",viewBox:"0 0 1000 350",xmlns:"http://www.w3.org/2000/svg",style:{"user-select":"none","touch-action":"none"}},te={key:0,class:"meter-bars",transform:"translate(40,15)"},ee={class:"info",transform:"translate(500,53)"},oe={class:"signature"},ne={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"end",x:-10},le={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"start",x:10},se={"text-anchor":"middle",style:{"user-select":"none",transition:"all 300ms ease"}},re=["opacity"],ie={class:"lines",transform:"translate(0,100)"},ae=["x1","x2"],ue=["x1","x2","stroke"],de={class:"arrows pointer-events-none"},ce=["transform"],me=["cx","r","fill"],fe={class:"bottom",transform:"translate(40,290)"},ve={transform:"translate(-20 -30)"},he=["fill"],ye=["fill"],xe={__name:"BeatBarsBar",props:{order:{type:Number,default:0},loop:{type:Object,default:{over:4,under:4,sound:"A",volume:1}},maxRatio:{type:Number,default:1},editable:{type:Boolean,default:!1},mute:{type:String,default:null},accents:{type:String,default:null},width:{type:Number,default:920}},emits:["del","sound"],setup(t,{emit:w}){const{isDark:x}=q(),d=t,l=S(()=>(1e3-d.width)/2),{seq:y,meter:i,current:f,steps:b,mutes:m,accents:a,volume:c,activeSteps:p,progress:s,pan:v,isEuclidean:R,reset:E,rotateAccents:U}=bt(d.loop,d.order,"bars"),H=["A","B","C","D","E"],O=J(H.findIndex(k=>k==(i==null?void 0:i.sound)));L(O,k=>{i.sound=H[k]});const j=S(()=>{const k=1/i.over;return k>=d.maxRatio?d.maxRatio:k});return L(()=>d.loop,k=>{Object.assign(i,{...d.loop})},{immediate:!0}),L(()=>d.accents,k=>{k&&k.split("").forEach((u,z)=>{m.value[z]=u=="0"||u==".",a.value[z]=u=="2"||u=="X"})},{immediate:!0}),(k,u)=>{const z=Yt,W=rt,Y=it,Z=Ot,tt=Bt,et=at,ot=ut,nt=dt,lt=st,_=X("tooltip");return n(),r("svg",Zt,[u[12]||(u[12]=o("defs",null,[o("filter",{id:"shadowButton",x:"-50%",height:"200%",width:"300%"},[o("feDropShadow",{dx:"0",dy:"3",stdDeviation:"3","flood-color":"#2225"})])],-1)),t.editable?(n(),r("g",te,[g(B(z,{class:"over",modelValue:e(i).over,"onUpdate:modelValue":u[0]||(u[0]=h=>e(i).over=h),width:340,step:1,min:2,max:16,"show-positions":"",ratio:500,every:4},null,8,["modelValue"]),[[_,"Number of steps",void 0,{top:!0}]]),g(B(z,{class:"under",transform:"translate(580,0)",modelValue:e(i).under,"onUpdate:modelValue":u[1]||(u[1]=h=>e(i).under=h),width:340,step:1,min:1,max:16,"show-positions":"",ratio:500,every:4,inverted:"",vector:[-1,-1]},null,8,["modelValue"]),[[_,"Measure subdivision",void 0,{top:!0}]])])):C("",!0),o("g",ee,[g((n(),r("g",oe,[u[9]||(u[9]=o("text",{fill:"currentColor","font-size":"45","text-anchor":"middle",y:"2"},"/",-1)),o("text",ne,N(e(i).over),1),o("text",le,N(e(i).under),1)])),[[_,"Time signature",void 0,{top:!0}]]),g((n(),r("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(70,-10)",onMousedown:u[2]||(u[2]=h=>e(U)(-1))},[u[10]||(u[10]=o("circle",{r:"18",fill:"#5553"},null,-1)),B(W,{"font-size":"28",x:"-17",y:"-17"})],32)),[[_,"Rotate pattern backward",void 0,{top:!0}]]),g((n(),r("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(-70,-10)",onMousedown:u[3]||(u[3]=h=>e(U)(1))},[u[11]||(u[11]=o("circle",{r:"18",fill:"#5553"},null,-1)),B(Y,{"font-size":"28",x:"-17",y:"-17"})],32)),[[_,"Rotate pattern forward",void 0,{top:!0}]])]),o("g",se,[o("g",{class:"steps",opacity:e(c)*.9+.1,transform:"translate(0,90)"},[o("g",ie,[o("line",{x1:l.value,x2:j.value*e(b).length*t.width+l.value,stroke:"currentColor","stroke-width":"2"},null,8,ae),(n(!0),r(V,null,M(e(p),(h,$)=>(n(),r("line",{key:$,x1:j.value*Number(h)*t.width+l.value,x2:j.value*(e(p)[$+1]||e(b).length)*t.width+l.value,"stroke-width":"6",stroke:e(K)(Number(h)+Number(e(I).pitch)/12*e(b).length,e(b).length,1)},null,8,ue))),128))]),(n(!0),r(V,null,M(e(b),(h,$)=>(n(),D(Z,{key:$,onMute:T=>e(m)[$]=!e(m)[$],onSubdivide:T=>e(b)[$]=T,onAccent:T=>e(a)[$]=!e(a)[$],muted:e(m)[$],step:$,accented:!!e(a)[$],mutes:e(m),current:e(f),subdivisions:h,proportion:j.value,total:e(b).length,width:t.width,pad:l.value},null,8,["onMute","onSubdivide","onAccent","muted","step","accented","mutes","current","subdivisions","proportion","total","width","pad"]))),128)),o("g",de,[o("line",{class:"progress",transform:`translate(${l.value+e(s)*t.width*j.value*e(i).over}, 0)`,"stroke-width":"4",stroke:"currentColor","stroke-linecap":"round",y2:180},null,8,ce)]),o("circle",{cx:j.value*e(b).length*t.width+l.value,cy:100,r:e(m)[1]?4:8,fill:e(m)[1]?"currentColor":e(gt)(Number(e(I).pitch),4)},null,8,me)],8,re),o("g",fe,[g((n(),D(z,{class:"volume",modelValue:e(c),"onUpdate:modelValue":u[4]||(u[4]=h=>F(c)?c.value=h:null),width:200,step:.01},{default:P(()=>[o("g",ve,[e(c)==0?(n(),D(tt,{key:0})):(n(),D(et,{key:1}))])]),_:1},8,["modelValue"])),[[_,"Track volume",void 0,{bottom:!0}]]),g((n(),D(z,{class:"pan",transform:"translate(270,0)",modelValue:e(v),"onUpdate:modelValue":u[5]||(u[5]=h=>F(v)?v.value=h:null),min:-1,max:1,width:200,step:.01,"show-center":""},{default:P(()=>[B(ot,{x:-18,y:-30})]),_:1},8,["modelValue"])),[[_,"Track panning",void 0,{bottom:!0}]]),g((n(),D(z,{class:"sound",transform:"translate(540,0)",modelValue:O.value,"onUpdate:modelValue":u[6]||(u[6]=h=>O.value=h),width:265,step:1,min:0,max:4,"show-positions":"",every:1},{default:P(()=>{var h;return[o("text",null,N((h=e(i))==null?void 0:h.sound),1)]}),_:1},8,["modelValue"])),[[_,"Click sound select",void 0,{bottom:!0}]]),B(vt,{name:"fade"},{default:P(()=>[t.editable&&!e(R)?g((n(),r("g",{key:0,class:"reset cursor-pointer",onMousedown:u[7]||(u[7]=h=>e(E)()),transform:"translate(840, 0)"},[o("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:e(x)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,he),B(nt,{"stroke-width":"0",y:"9",x:"9","font-size":"26"})],32)),[[_,"Reset to Euclidean pattern",void 0,{bottom:!0}]]):C("",!0)]),_:1}),t.editable?g((n(),r("g",{key:0,class:"del cursor-pointer",onMousedown:u[8]||(u[8]=h=>k.$emit("del")),transform:"translate(900, 0)"},[o("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:e(x)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,ye),B(lt,{color:"hsla(0,25%,50%,1)","stroke-width":"0",y:"9",x:"9","font-size":"26"})],32)),[[_,"Remove track",void 0,{bottom:!0}]]):C("",!0)])])])}}},pe=ft(xe,[["__scopeId","data-v-e31215ad"]]),A=ht("tempo-bar-loops-object",{0:{over:8,under:8,volume:1,sound:"A"},1:{over:3,under:3,volume:.5,sound:"B"}}),be={class:"flex flex-wrap items-center w-full p-4 has-bg rounded-xl relative gap-6 bg-light-600 dark-bg-dark-500",id:"screen"},ge={key:1,class:"flex flex-col p-2 my-2 is-group"},we={class:"flex flex"},ke={class:"flex flex-wrap justify-center"},$e={class:"font-bold mx-2"},Ce={key:0},_e={class:"flex flex-wrap justify-center is-group m-1 text-xl p-2",style:{flex:"1 1 100%"}},Ne={key:1,class:"is-group m-2"},Be=["onClick"],Ve=["onClick"],Ae={__name:"BeatBars",props:{meters:{type:Array,default:null},patterns:{type:Object,default:null},accents:{type:String,default:"XxXxXxXx"},mute:{type:String,delault:""},secondary:{type:Boolean,default:!1}},setup(t){const w=t,x=J(w.accents),d=G({over:4,under:4,volume:1,sound:"A"});L(()=>w.meters,i=>{if(i){let f=i[0].split("/");A.value={0:{over:Number(f[0]),under:Number(f[1]),volume:w.secondary?0:1,sound:"A"}}}},{immediate:!0}),L(()=>w.patterns,i=>{i&&(x.value=Object.keys(i)[0])},{immediate:!0});function l(i,f){A.value[0].over=i.length,A.value[0].under=f?f.split("/")[1]:i.length,x.value=i}function y(){A.value[Math.floor(Math.random()*1e4)]={...d}}return(i,f)=>{const b=Ct,m=pe,a=yt("client-only"),c=X("tooltip");return n(),r("div",be,[B(a,null,{default:P(()=>{var p;return[t.secondary?C("",!0):(n(),D(b,{key:0,secondary:!0})),(n(!0),r(V,null,M(e(A),(s,v)=>(n(),D(m,{class:"my-1 rounded-3xl shadow-lg min-h-36 max-h-30vh",style:{flex:"1 1 420px"},key:v,order:v,loop:s,maxRatio:e(wt),onDel:R=>delete e(A)[v],editable:!t.meters,accents:x.value,mute:t.mute},null,8,["order","loop","maxRatio","onDel","editable","accents","mute"]))),128)),t.patterns?(n(),r("div",ge,[o("div",we,[(n(!0),r(V,null,M(x.value,(s,v)=>(n(),r("div",{class:"flex-1 p-1 border-1 border-current rounded-lg m-1 opacity-50",key:v,style:xt({opacity:s=="X"?1:.5,backgroundColor:s=="1"||s=="X"||s=="x"?"currentColor":"transparent"})},null,4))),128))]),o("div",ke,[(n(!0),r(V,null,M((p=t.patterns[x.value])==null?void 0:p.names,s=>(n(),r("div",{class:"p-1",key:s},[o("span",$e,N(s.name),1),s.place?(n(),r("span",Ce,"("+N(s.place)+")",1)):C("",!0)]))),128))])])):C("",!0),o("div",_e,[t.meters?C("",!0):g((n(),r("button",{key:0,class:"text-button",onClick:f[0]||(f[0]=s=>y())},f[2]||(f[2]=[o("div",{class:"i-la-plus"},null,-1)]))),[[c,"Add new track",void 0,{bottom:!0}]]),g((n(),r("button",{class:"text-button flex items-center",onClick:f[1]||(f[1]=s=>e(kt)(e($t)))},f[3]||(f[3]=[o("div",{class:"i-la-file-download"},null,-1)]))),[[c,"Export MIDI file",void 0,{bottom:!0}]]),t.meters&&t.meters.length>1?(n(),r("div",Ne,[(n(!0),r(V,null,M(t.meters,s=>(n(),r("button",{class:"text-button",onClick:v=>A.value=[{over:s.split("/")[0],under:s.split("/")[1],sound:"A",volume:1}]},N(s),9,Be))),256))])):C("",!0),(n(!0),r(V,null,M(t.patterns,(s,v)=>{var R,E;return n(),r("button",{class:pt(["text-button",{active:x.value==v}]),onClick:U=>l(v,s.meter)},N(((E=(R=s==null?void 0:s.names)==null?void 0:R[0])==null?void 0:E.name)||v),11,Ve)}),256))])]}),_:1})])}}};export{Ae as _};
