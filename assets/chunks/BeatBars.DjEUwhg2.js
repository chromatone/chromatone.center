import{_ as F}from"./trash.vTBX-w-p.js";import{_ as J,a as G,b as K,c as Q,d as W}from"./angle-right.r1TdbibT.js";import{J as Y,f as l,g as a,h as s,e as U,c as V,d as z,S as R,l as n,m as C,F as N,j as B,k as x,q as g,b as E,x as Z,_ as ee,r as T,U as _,z as M,A,an as te,u as oe,a2 as ne,p as se,n as le}from"./framework.DqjO8Koj.js";import{ar as I,ak as P,H as O,U as re,c as ie,as as ae,at as ue,au as de,av as ce}from"./theme.C1B78J4N.js";const me={style:{"vertical-align":"middle"},viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"},fe=s("path",{fill:"currentColor",d:"M15 4.594L13.281 6.28L8.562 11H4v10h4.563l4.718 4.719L15 27.406zm-2 4.843v13.126L9.719 19.28L9.406 19H6v-6h3.406l.313-.281zm7.219 2.344L18.78 13.22L21.563 16l-2.782 2.781l1.438 1.438L23 17.437l2.781 2.782l1.438-1.438L24.437 16l2.782-2.781l-1.438-1.438L23 14.562z"},null,-1),ve=[fe];function he(e,k){return l(),a("svg",me,[...ve])}const ye=Y({name:"la-volume-off",render:he}),pe=["transform"],xe=["opacity"],be=["width","fill"],we=["stroke","fill"],ge=["fill"],ke=["stroke"],$e=["onDblclick","data-sub"],Ce=["transform"],_e=["width","x","fill"],Ne=["transform","fill","opacity"],Be=["x"],Ve=["fill","stroke"],Me={key:0,class:"transition-all duration-100 ease-out pointer-events-none",cx:0,cy:100,r:"3",fill:"currentColor",opacity:"0.8"},Se={__name:"BeatBarsStep",props:{proportion:{type:Number,default:1},step:{type:Number,default:1},subdivisions:{type:[Array,String],default:""},muted:{type:Boolean,default:!1},total:{type:Number,default:4},current:{type:[Number,String],default:0},mutes:{type:Object,default:{}},accented:{type:Boolean,default:!1},width:{type:Number,default:900},pad:{type:Number,default:50}},emits:["mute","subdivide","accent"],setup(e,{emit:k}){const{isDark:y}=U(),c=e,r=k,t=V(()=>I(c.step+P.pitch/12*c.total,c.total,1));V(()=>c.subdivisions[0].includes("!"));const v=O(0,40,640),m=V(()=>Math.floor(v.value/40));z(m,(o,d)=>{if(o==d)return;let p=[];for(let i=0;i<o;i++)p.push(`${c.step}-${i}`);r("subdivide",p)});function b(o){if(o.tap){let d=o.event.currentTarget.dataset.sub;c.mutes[d]=!c.mutes[d]}v.value+=o.delta[0]-o.delta[1]}const u=V(()=>{let o=c.subdivisions[0]==c.current,d=c.subdivisions[0].split("-")[0],p=c.current.split("-")[0];return!c.mutes[c.subdivisions[0]]&&(o||d==p)});return(o,d)=>{const p=R("drag");return l(),a("g",{class:"cursor-pointer",transform:`translate(${e.proportion*e.step*e.width+e.pad},0)`},[s("g",{class:"step",opacity:e.muted?.1:1},[s("rect",{class:"transition-fill duration-100",onMousedown:d[0]||(d[0]=i=>o.$emit("mute")),width:e.proportion*e.width,height:"180",rx:"10",fill:u.value?e.muted?"transparent":t.value:"transparent"},null,40,be),s("circle",{class:"transition-all duration-100 ease-out",onMousedown:d[1]||(d[1]=i=>e.muted?o.$emit("mute"):o.$emit("accent")),cy:"35",cx:"0",r:"25","stroke-width":"4",stroke:t.value,fill:u.value?e.muted?"transparent":"currentColor":e.accented?t.value:n(y)?"#333":"#eee"},null,40,we),s("text",{class:"pointer-events-none transition-all duration-100 ease-out",y:"48","font-size":"40","text-anchor":"middle",x:"0",fill:u.value?n(y)?"#333":"#eee":"currentColor"},C(e.step+1),9,ge),s("line",{class:"pointer-events-none",y1:"60",y2:"100","stroke-width":"8",stroke:t.value},null,8,ke),(l(!0),a(N,null,B(e.subdivisions,(i,h)=>x((l(),a("g",{class:"sub",key:i,onDblclick:D=>{o.$emit("subdivide",[`${i}-1`]),v.value=40},"data-sub":i},[s("line",{transform:`translate(${h*e.proportion*e.width/e.subdivisions.length}, 0)`,y1:"100",y2:"150","stroke-width":"1",stroke:"currentColor"},null,8,Ce),s("rect",{class:"transition-fill duration-100",width:e.proportion*e.width/e.subdivisions.length,height:"80",y:"100",rx:"10",x:h*e.proportion*e.width/e.subdivisions.length,fill:`hsla(0,0%,${90-h*80/e.subdivisions.length}%,${i==e.current?.9:.4})`},null,8,_e),s("circle",{class:"transition-all duration-100 ease-out pointer-events-none",transform:`translate(${h*e.proportion*e.width/e.subdivisions.length}, 0)`,cx:0,cy:100,r:6,fill:i==e.current?"currentColor":e.muted?"transparent":t.value,opacity:e.mutes[i]?0:1,"stroke-width":"4","stroke-linecap":"round"},null,8,Ne),e.mutes[i]?g("",!0):(l(),a("text",{key:0,y:"140","font-size":"40","text-anchor":"middle",x:15+h*e.proportion*e.width/e.subdivisions.length,fill:"currentColor"},C(h+1),9,Be))],40,$e)),[[p,b]])),128)),s("circle",{class:"transition-all duration-100 ease-out pointer-events-none",cx:"0",cy:100,r:"10",fill:t.value,stroke:u.value?"currentColor":"transparent","stroke-width":"4",opacity:"0.8"},null,8,Ve)],8,xe),e.muted?(l(),a("circle",Me)):g("",!0)],8,pe)}}},ze={class:"bar cursor-pointer","font-size":"32px"},De=["x1","x2","y1","y2","stroke-width","stroke"],Ae=["x2","y1","y2","stroke"],Le=["x1","x2","y1","y2","stroke-width","stroke"],Re={key:0,class:"all"},je=["cx","cy","r"],Pe=["cx","cy"],Ue=["transform"],Xe=["fill"],Ee={transform:"translate(0 10)",fill:"currentColor","text-anchor":"middle"},Te={__name:"BeatControlBar",props:{modelValue:{type:[Number,String],default:.1},step:{type:Number,default:.1},min:{type:Number,default:0},max:{type:Number,default:1},width:{type:Number,default:100},height:{type:Number,default:50},vector:{type:Array,default:[1,-1]},showPositions:{type:Boolean,default:!1},ratio:{type:Number,default:200},every:{type:Number,default:null},showCenter:{type:Boolean,default:!1},inverted:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:k}){const{isDark:y}=U(),c=k,r=e,t=E({inner:O((Number(r.modelValue)-r.min)/(r.max-r.min),0,1),proportion:V(()=>r.inverted?(Number(r.modelValue)-r.max)/(r.min-r.max):(Number(r.modelValue)-r.min)/(r.max-r.min)),pos:V(()=>t.proportion*r.width)});function v(u){t.inner+=(r.vector[0]*u.delta[0]+r.vector[1]*u.delta[1])/r.ratio}function m(u){t.inner+=u*r.step/(r.max-r.min)}z(()=>t.inner,u=>{let o=u*(r.max-r.min)+r.min;c("update:modelValue",Math.round(o/r.step)*r.step)});const b=V(()=>{let u=(r.max-r.min)/r.step,o=[];for(let d=0;d<=1;d+=1/u)o.push(d*r.width);return o});return(u,o)=>{const d=R("drag");return x((l(),a("g",ze,[s("line",{class:"add",onMousedown:o[0]||(o[0]=p=>m(1)),x1:e.inverted?0:t.pos,x2:e.inverted?t.pos:e.width,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":e.height,stroke:n(y)?"#1114":"#fff8"},null,40,De),s("line",{class:"pointer-events-none",x1:0,x2:e.width,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":18,stroke:n(y)?"#2228":"#eee"},null,8,Ae),s("line",{class:"subtract",onMousedown:o[1]||(o[1]=p=>m(-1)),x1:e.inverted?e.width:e.showCenter?e.width/2:0,x2:t.pos,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":e.height,stroke:n(y)?"#3338":"#ddd8"},null,40,Le),e.showPositions?(l(),a("g",Re,[(l(!0),a(N,null,B(b.value,(p,i)=>(l(),a("circle",{key:p,cx:p,cy:e.height/2,r:e.every&&i%e.every==0?4:2,fill:"currentColor",opacity:"0.5"},null,8,je))),128))])):g("",!0),e.showCenter?(l(),a("circle",{key:1,cx:e.width/2,cy:e.height/2,r:"4",opacity:"0.5",fill:"currentColor"},null,8,Pe)):g("",!0),s("g",{class:"mover",transform:`translate(${t.pos} ${e.height/2})`},[s("circle",{r:"25","stroke-width":"0","stroke-opacity":"0.5",stroke:"currentColor",style:{filter:"url(#shadowButton)"},fill:n(y)?"#333":"#eee"},null,8,Xe),s("g",Ee,[Z(u.$slots,"default",{},()=>[s("text",null,C(e.modelValue),1)])])],8,Ue)])),[[d,v]])}}},Ie={class:"w-full bg-light-300 dark-bg-dark-800",version:"1.1",baseProfile:"full",viewBox:"0 0 1000 350",xmlns:"http://www.w3.org/2000/svg",style:{"user-select":"none","touch-action":"none"}},Oe={key:0,class:"meter-bars",transform:"translate(40,15)"},qe={class:"info",transform:"translate(500,53)"},He={class:"signature"},Fe={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"end",x:-10},Je={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"start",x:10},Ge={"text-anchor":"middle",style:{"user-select":"none",transition:"all 300ms ease"}},Ke=["opacity"],Qe={class:"lines",transform:"translate(0,100)"},We=["x1","x2"],Ye=["x1","x2","stroke"],Ze={class:"arrows pointer-events-none"},et=["transform"],tt=["cx","r","fill"],ot={class:"bottom",transform:"translate(40,290)"},nt={transform:"translate(-20 -30)"},st=["fill"],lt=["fill"],rt={__name:"BeatBarsBar",props:{order:{type:Number,default:0},loop:{type:Object,default:{over:4,under:4,sound:"A",volume:1}},maxRatio:{type:Number,default:1},editable:{type:Boolean,default:!1},mute:{type:String,default:null},accents:{type:String,default:null},width:{type:Number,default:920}},emits:["del","sound"],setup(e,{emit:k}){const{isDark:y}=U(),c=e,r=V(()=>(1e3-c.width)/2),{seq:t}=re(c.loop,c.order,"bars"),v=["A","B","C","D","E"],m=T(v.findIndex(u=>{var o;return u==((o=t.meter)==null?void 0:o.sound)}));z(m,u=>{t.meter.sound=v[u]});const b=V(()=>{const u=1/t.meter.over;return u>=c.maxRatio?c.maxRatio:u});return z(()=>c.loop,u=>{t.meter={...c.loop}},{immediate:!0}),z(()=>c.accents,u=>{u&&u.split("").forEach((o,d)=>{t.mutes[d]=o=="0"||o==".",t.accents[d]=o=="2"||o=="X"})},{immediate:!0}),(u,o)=>{const d=Te,p=J,i=G,h=Se,D=ye,L=K,X=Q,q=W,H=F,$=R("tooltip");return l(),a("svg",Ie,[o[12]||(o[12]=s("defs",null,[s("filter",{id:"shadowButton",x:"-50%",height:"200%",width:"300%"},[s("feDropShadow",{dx:"0",dy:"3",stdDeviation:"3","flood-color":"#2225"})])],-1)),e.editable?(l(),a("g",Oe,[x(_(d,{class:"over",modelValue:n(t).meter.over,"onUpdate:modelValue":o[0]||(o[0]=f=>n(t).meter.over=f),width:340,step:1,min:2,max:16,"show-positions":"",ratio:500,every:4},null,8,["modelValue"]),[[$,"Number of steps",void 0,{top:!0}]]),x(_(d,{class:"under",transform:"translate(580,0)",modelValue:n(t).meter.under,"onUpdate:modelValue":o[1]||(o[1]=f=>n(t).meter.under=f),width:340,step:1,min:1,max:16,"show-positions":"",ratio:500,every:4,inverted:"",vector:[-1,-1]},null,8,["modelValue"]),[[$,"Measure subdivision",void 0,{top:!0}]])])):g("",!0),s("g",qe,[x((l(),a("g",He,[o[9]||(o[9]=s("text",{fill:"currentColor","font-size":"45","text-anchor":"middle",y:"2"},"/",-1)),s("text",Fe,C(n(t).meter.over),1),s("text",Je,C(n(t).meter.under),1)])),[[$,"Time signature",void 0,{top:!0}]]),x((l(),a("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(70,-10)",onMousedown:o[2]||(o[2]=f=>n(t).rotateAccents(-1))},[o[10]||(o[10]=s("circle",{r:"18",fill:"#5553"},null,-1)),_(p,{"font-size":"28",x:"-17",y:"-17"})],32)),[[$,"Rotate pattern backward",void 0,{top:!0}]]),x((l(),a("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(-70,-10)",onMousedown:o[3]||(o[3]=f=>n(t).rotateAccents(1))},[o[11]||(o[11]=s("circle",{r:"18",fill:"#5553"},null,-1)),_(i,{"font-size":"28",x:"-17",y:"-17"})],32)),[[$,"Rotate pattern forward",void 0,{top:!0}]])]),s("g",Ge,[s("g",{class:"steps",opacity:n(t).volume*.9+.1,transform:"translate(0,90)"},[s("g",Qe,[s("line",{x1:r.value,x2:b.value*n(t).steps.length*e.width+r.value,stroke:"currentColor","stroke-width":"2"},null,8,We),(l(!0),a(N,null,B(n(t).activeSteps,(f,w)=>(l(),a("line",{key:w,x1:b.value*Number(f)*e.width+r.value,x2:b.value*(n(t).activeSteps[w+1]||n(t).steps.length)*e.width+r.value,"stroke-width":"6",stroke:n(I)(Number(f)+Number(n(P).pitch)/12*n(t).steps.length,n(t).steps.length,1)},null,8,Ye))),128))]),(l(!0),a(N,null,B(n(t).steps,(f,w)=>(l(),M(h,{key:w,onMute:j=>n(t).mutes[w]=!n(t).mutes[w],onSubdivide:j=>n(t).steps[w]=j,onAccent:j=>n(t).accents[w]=!n(t).accents[w],muted:n(t).mutes[w],step:w,accented:!!n(t).accents[w],mutes:n(t).mutes,current:n(t).current,subdivisions:f,proportion:b.value,total:n(t).steps.length,width:e.width,pad:r.value},null,8,["onMute","onSubdivide","onAccent","muted","step","accented","mutes","current","subdivisions","proportion","total","width","pad"]))),128)),s("g",Ze,[s("line",{class:"progress",transform:`translate(${r.value+n(t).progress*e.width*b.value*n(t).meter.over}, 0)`,"stroke-width":"4",stroke:"currentColor","stroke-linecap":"round",y2:180},null,8,et)]),s("circle",{cx:b.value*n(t).steps.length*e.width+r.value,cy:100,r:n(t).mutes[1]?4:8,fill:n(t).mutes[1]?"currentColor":n(ie)(Number(n(P).pitch),4)},null,8,tt)],8,Ke),s("g",ot,[x((l(),M(d,{class:"volume",modelValue:n(t).volume,"onUpdate:modelValue":o[4]||(o[4]=f=>n(t).volume=f),width:200,step:.01},{default:A(()=>[s("g",nt,[n(t).volume==0?(l(),M(D,{key:0})):(l(),M(L,{key:1}))])]),_:1},8,["modelValue"])),[[$,"Track volume",void 0,{bottom:!0}]]),x((l(),M(d,{class:"pan",transform:"translate(270,0)",modelValue:n(t).pan,"onUpdate:modelValue":o[5]||(o[5]=f=>n(t).pan=f),min:-1,max:1,width:200,step:.01,"show-center":""},{default:A(()=>[_(X,{x:-18,y:-30})]),_:1},8,["modelValue"])),[[$,"Track panning",void 0,{bottom:!0}]]),x((l(),M(d,{class:"sound",transform:"translate(540,0)",modelValue:m.value,"onUpdate:modelValue":o[6]||(o[6]=f=>m.value=f),width:265,step:1,min:0,max:4,"show-positions":"",every:1},{default:A(()=>{var f;return[s("text",null,C((f=n(t).meter)==null?void 0:f.sound),1)]}),_:1},8,["modelValue"])),[[$,"Click sound select",void 0,{bottom:!0}]]),_(te,{name:"fade"},{default:A(()=>[e.editable&&!n(t).isEuclidean?x((l(),a("g",{key:0,class:"reset cursor-pointer",onMousedown:o[7]||(o[7]=f=>n(t).reset()),transform:"translate(840, 0)"},[s("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:n(y)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,st),_(q,{"stroke-width":"0",y:"9",x:"9","font-size":"26"})],32)),[[$,"Reset to Euclidean pattern",void 0,{bottom:!0}]]):g("",!0)]),_:1}),e.editable?x((l(),a("g",{key:0,class:"del cursor-pointer",onMousedown:o[8]||(o[8]=f=>u.$emit("del")),transform:"translate(900, 0)"},[s("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:n(y)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,lt),_(H,{color:"hsla(0,25%,50%,1)","stroke-width":"0",y:"9",x:"9","font-size":"26"})],32)),[[$,"Remove track",void 0,{bottom:!0}]]):g("",!0)])])])}}},it=ee(rt,[["__scopeId","data-v-92ba6367"]]),S=oe("tempo-bar-loops-object",{0:{over:8,under:8,volume:1,sound:"A"},1:{over:3,under:3,volume:.5,sound:"B"}}),at={class:"flex flex-wrap items-center w-full p-4 has-bg rounded-xl relative gap-6 bg-light-600 dark-bg-dark-500",id:"screen"},ut={key:1,class:"flex flex-col p-2 my-2 is-group"},dt={class:"flex flex"},ct={class:"flex flex-wrap justify-center"},mt={class:"font-bold mx-2"},ft={key:0},vt={class:"flex flex-wrap justify-center is-group m-1 text-xl p-2",style:{flex:"1 1 100%"}},ht={key:1,class:"is-group m-2"},yt=["onClick"],pt=["onClick"],kt={__name:"BeatBars",props:{meters:{type:Array,default:null},patterns:{type:Object,default:null},accents:{type:String,default:"XxXxXxXx"},mute:{type:String,delault:""},secondary:{type:Boolean,default:!1}},setup(e){const k=e,y=T(k.accents),c=E({over:4,under:4,volume:1,sound:"A"});z(()=>k.meters,v=>{if(v){let m=v[0].split("/");S.value={0:{over:Number(m[0]),under:Number(m[1]),volume:k.secondary?0:1,sound:"A"}}}},{immediate:!0}),z(()=>k.patterns,v=>{v&&(y.value=Object.keys(v)[0])},{immediate:!0});function r(v,m){S.value[0].over=v.length,S.value[0].under=m?m.split("/")[1]:v.length,y.value=v}function t(){S.value[Math.floor(Math.random()*1e4)]={...c}}return(v,m)=>{const b=ce,u=it,o=ne("client-only"),d=R("tooltip");return l(),a("div",at,[_(o,null,{default:A(()=>{var p;return[e.secondary?g("",!0):(l(),M(b,{key:0,secondary:!0})),(l(!0),a(N,null,B(n(S),(i,h)=>(l(),M(u,{class:"my-1 rounded-3xl shadow-lg min-h-36 max-h-30vh",style:{flex:"1 1 420px"},key:h,order:h,loop:i,maxRatio:n(ae),onDel:D=>delete n(S)[h],editable:!e.meters,accents:y.value,mute:e.mute},null,8,["order","loop","maxRatio","onDel","editable","accents","mute"]))),128)),e.patterns?(l(),a("div",ut,[s("div",dt,[(l(!0),a(N,null,B(y.value,(i,h)=>(l(),a("div",{class:"flex-1 p-1 border-1 border-current rounded-lg m-1 opacity-50",key:h,style:se({opacity:i=="X"?1:.5,backgroundColor:i=="1"||i=="X"||i=="x"?"currentColor":"transparent"})},null,4))),128))]),s("div",ct,[(l(!0),a(N,null,B((p=e.patterns[y.value])==null?void 0:p.names,i=>(l(),a("div",{class:"p-1",key:i},[s("span",mt,C(i.name),1),i.place?(l(),a("span",ft,"("+C(i.place)+")",1)):g("",!0)]))),128))])])):g("",!0),s("div",vt,[e.meters?g("",!0):x((l(),a("button",{key:0,class:"text-button",onClick:m[0]||(m[0]=i=>t())},m[2]||(m[2]=[s("div",{class:"i-la-plus"},null,-1)]))),[[d,"Add new track",void 0,{bottom:!0}]]),x((l(),a("button",{class:"text-button flex items-center",onClick:m[1]||(m[1]=i=>n(ue)(n(de)))},m[3]||(m[3]=[s("div",{class:"i-la-file-download"},null,-1)]))),[[d,"Export MIDI file",void 0,{bottom:!0}]]),e.meters&&e.meters.length>1?(l(),a("div",ht,[(l(!0),a(N,null,B(e.meters,i=>(l(),a("button",{class:"text-button",onClick:h=>S.value=[{over:i.split("/")[0],under:i.split("/")[1],sound:"A",volume:1}]},C(i),9,yt))),256))])):g("",!0),(l(!0),a(N,null,B(e.patterns,(i,h)=>{var D,L;return l(),a("button",{class:le(["text-button",{active:y.value==h}]),onClick:X=>r(h,i.meter)},C(((L=(D=i==null?void 0:i.names)==null?void 0:D[0])==null?void 0:L.name)||h),11,pt)}),256))])]}),_:1})])}}};export{kt as _};
