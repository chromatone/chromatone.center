import{_ as G}from"./trash.a96329ac.js";import{_ as J,a as Q,b as W,c as Y,d as Z}from"./angle-right.50f83ff4.js";import{o as l,c as i,a as r,u as X,j as V,w as z,x as R,h as o,t as C,F as _,r as N,y as p,d as g,k as T,K as U,_ as ee,i as O,g as B,f as S,n as A,a0 as te,p as oe,e as ne,v as se,m as le,A as re,z as ae}from"./framework.2f46aeb8.js";import{j as q,n as ie}from"./colors.93330ee5.js";import{t as P}from"./tempo.a46486f1.js";import{u as F}from"./index.3012fc8f.js";import{u as ue,m as de,t as ce}from"./sequence.cfe1e93c.js";import{_ as me}from"./StateTransport.7eea3ec3.js";import{r as he}from"./midiRender.ed5d5da0.js";const fe={style:{"vertical-align":"middle"},viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"},ve=r("path",{fill:"currentColor",d:"M15 4.594L13.281 6.28L8.562 11H4v10h4.563l4.718 4.719L15 27.406zm-2 4.843v13.126L9.719 19.28L9.406 19H6v-6h3.406l.313-.281zm7.219 2.344L18.78 13.22L21.563 16l-2.782 2.781l1.438 1.438L23 17.437l2.781 2.782l1.438-1.438L24.437 16l2.782-2.781l-1.438-1.438L23 14.562z"},null,-1),ye=[ve];function pe(e,k){return l(),i("svg",fe,ye)}const xe={name:"la-volume-off",render:pe},be=["transform"],we=["opacity"],ge=["width","fill"],ke=["stroke","fill"],$e=["fill"],_e=["stroke"],Ce=["onDblclick","data-sub"],Be=["transform"],Ne=["width","x","fill"],Ve=["transform","fill","opacity"],Se=["x"],Me=["fill","stroke"],ze={key:0,class:"transition-all duration-100 ease-out pointer-events-none",cx:0,cy:100,r:"3",fill:"currentColor",opacity:"0.8"},De={__name:"BeatBarsStep",props:{proportion:{type:Number,default:1},step:{type:Number,default:1},subdivisions:{type:[Array,String],default:""},muted:{type:Boolean,default:!1},total:{type:Number,default:4},current:{type:[Number,String],default:0},mutes:{type:Object,default:{}},accented:{type:Boolean,default:!1},width:{type:Number,default:900},pad:{type:Number,default:50}},emits:["mute","subdivide","accent"],setup(e,{emit:k}){const t=e,{isDark:b}=X(),d=V(()=>q(t.step+P.pitch/12*t.total,t.total,1));V(()=>t.subdivisions[0].includes("!"));const n=F(0,40,640),v=V(()=>Math.floor(n.value/40));z(v,(a,s)=>{if(a==s)return;let m=[];for(let h=0;h<a;h++)m.push(`${t.step}-${h}`);k("subdivide",m)});function y(a){if(a.tap){let s=a.event.currentTarget.dataset.sub;t.mutes[s]=!t.mutes[s]}n.value+=a.delta[0]-a.delta[1]}const c=V(()=>{let a=t.subdivisions[0]==t.current,s=t.subdivisions[0].split("-")[0],m=t.current.split("-")[0];return!t.mutes[t.subdivisions[0]]&&(a||s==m)});return(a,s)=>{const m=R("drag");return l(),i("g",{class:"cursor-pointer",transform:`translate(${e.proportion*e.step*e.width+e.pad},0)`},[r("g",{class:"step",opacity:e.muted?.1:1},[r("rect",{class:"transition-fill duration-100",onMousedown:s[0]||(s[0]=h=>a.$emit("mute")),width:e.proportion*e.width,height:"180",rx:"10",fill:c.value?e.muted?"transparent":d.value:"transparent"},null,40,ge),r("circle",{class:"transition-all duration-100 ease-out",onMousedown:s[1]||(s[1]=h=>e.muted?a.$emit("mute"):a.$emit("accent")),cy:"35",cx:"0",r:"25","stroke-width":"4",stroke:d.value,fill:c.value?e.muted?"transparent":"currentColor":e.accented?d.value:o(b)?"#333":"#eee"},null,40,ke),r("text",{class:"pointer-events-none transition-all duration-100 ease-out",y:"48","font-size":"40","text-anchor":"middle",x:"0",fill:c.value?o(b)?"#333":"#eee":"currentColor"},C(e.step+1),9,$e),r("line",{class:"pointer-events-none",y1:"60",y2:"100","stroke-width":"8",stroke:d.value},null,8,_e),(l(!0),i(_,null,N(e.subdivisions,(h,u)=>p((l(),i("g",{class:"sub",key:h,onDblclick:x=>{a.$emit("subdivide",[`${h}-1`]),n.value=40},"data-sub":h},[r("line",{transform:`translate(${u*e.proportion*e.width/e.subdivisions.length}, 0)`,y1:"100",y2:"150","stroke-width":"1",stroke:"currentColor"},null,8,Be),r("rect",{class:"transition-fill duration-100",width:e.proportion*e.width/e.subdivisions.length,height:"80",y:"100",rx:"10",x:u*e.proportion*e.width/e.subdivisions.length,fill:`hsla(0,0%,${90-u*80/e.subdivisions.length}%,${h==e.current?.9:.4})`},null,8,Ne),r("circle",{class:"transition-all duration-100 ease-out pointer-events-none",transform:`translate(${u*e.proportion*e.width/e.subdivisions.length}, 0)`,cx:0,cy:100,r:6,fill:h==e.current?"currentColor":e.muted?"transparent":d.value,opacity:e.mutes[h]?0:1,"stroke-width":"4","stroke-linecap":"round"},null,8,Ve),e.mutes[h]?g("",!0):(l(),i("text",{key:0,y:"140","font-size":"40","text-anchor":"middle",x:15+u*e.proportion*e.width/e.subdivisions.length,fill:"currentColor"},C(u+1),9,Se))],40,Ce)),[[m,y]])),128)),r("circle",{class:"transition-all duration-100 ease-out pointer-events-none",cx:"0",cy:100,r:"10",fill:d.value,stroke:c.value?"currentColor":"transparent","stroke-width":"4",opacity:"0.8"},null,8,Me)],8,we),e.muted?(l(),i("circle",ze)):g("",!0)],8,be)}}},Ae={class:"bar cursor-pointer","font-size":"32px"},Le=["x1","x2","y1","y2","stroke-width","stroke"],Re=["x2","y1","y2","stroke"],je=["x1","x2","y1","y2","stroke-width","stroke"],Ie={key:0,class:"all"},Pe=["cx","cy","r"],Xe=["cx","cy"],Ee=["transform"],Te=["fill"],Ue={transform:"translate(0 10)",fill:"currentColor","text-anchor":"middle"},Oe={__name:"BeatControlBar",props:{modelValue:{type:[Number,String],default:.1},step:{type:Number,default:.1},min:{type:Number,default:0},max:{type:Number,default:1},width:{type:Number,default:100},height:{type:Number,default:50},vector:{type:Array,default:[1,-1]},showPositions:{type:Boolean,default:!1},ratio:{type:Number,default:200},every:{type:Number,default:null},showCenter:{type:Boolean,default:!1},inverted:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:k}){const t=e,{isDark:b}=X(),d=T({inner:F((Number(t.modelValue)-t.min)/(t.max-t.min),0,1),proportion:V(()=>t.inverted?(Number(t.modelValue)-t.max)/(t.min-t.max):(Number(t.modelValue)-t.min)/(t.max-t.min)),pos:V(()=>d.proportion*t.width)});function n(c){d.inner+=(t.vector[0]*c.delta[0]+t.vector[1]*c.delta[1])/t.ratio}function v(c){d.inner+=c*t.step/(t.max-t.min)}z(()=>d.inner,c=>{let a=c*(t.max-t.min)+t.min;k("update:modelValue",Math.round(a/t.step)*t.step)});const y=V(()=>{let c=(t.max-t.min)/t.step,a=[];for(let s=0;s<=1;s+=1/c)a.push(s*t.width);return a});return(c,a)=>{const s=R("drag");return p((l(),i("g",Ae,[r("line",{class:"add",onMousedown:a[0]||(a[0]=m=>v(1)),x1:e.inverted?0:d.pos,x2:e.inverted?d.pos:e.width,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":e.height,stroke:o(b)?"#1114":"#fff8"},null,40,Le),r("line",{class:"pointer-events-none",x1:0,x2:e.width,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":18,stroke:o(b)?"#2228":"#eee"},null,8,Re),r("line",{class:"subtract",onMousedown:a[1]||(a[1]=m=>v(-1)),x1:e.inverted?e.width:e.showCenter?e.width/2:0,x2:d.pos,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":e.height,stroke:o(b)?"#3338":"#ddd8"},null,40,je),e.showPositions?(l(),i("g",Ie,[(l(!0),i(_,null,N(y.value,(m,h)=>(l(),i("circle",{key:m,cx:m,cy:e.height/2,r:e.every&&h%e.every==0?4:2,fill:"currentColor",opacity:"0.5"},null,8,Pe))),128))])):g("",!0),e.showCenter?(l(),i("circle",{key:1,cx:e.width/2,cy:e.height/2,r:"4",opacity:"0.5",fill:"currentColor"},null,8,Xe)):g("",!0),r("g",{class:"mover",transform:`translate(${d.pos} ${e.height/2})`},[r("circle",{r:"25","stroke-width":"0","stroke-opacity":"0.5",stroke:"currentColor",style:{filter:"url(#shadowButton)"},fill:o(b)?"#333":"#eee"},null,8,Te),r("g",Ue,[U(c.$slots,"default",{},()=>[r("text",null,C(e.modelValue),1)])])],8,Ee)])),[[s,n]])}}};const j=e=>(oe("data-v-28dbaefe"),e=e(),ne(),e),qe={class:"w-full bg-light-300 dark-bg-dark-800",version:"1.1",baseProfile:"full",viewBox:"0 0 1000 350",xmlns:"http://www.w3.org/2000/svg",style:{"user-select":"none","touch-action":"none"}},Fe=j(()=>r("defs",null,[r("filter",{id:"shadowButton",x:"-50%",height:"200%",width:"300%"},[r("feDropShadow",{dx:"0",dy:"3",stdDeviation:"3","flood-color":"#2225"})])],-1)),He={key:0,class:"meter-bars",transform:"translate(40,15)"},Ke=["transform"],Ge={class:"signature"},Je=j(()=>r("text",{fill:"currentColor","font-size":"45","text-anchor":"middle",y:"2"},"/",-1)),Qe={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"end",x:-10},We={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"start",x:10},Ye=j(()=>r("circle",{r:"18",fill:"#5553"},null,-1)),Ze=j(()=>r("circle",{r:"18",fill:"#5553"},null,-1)),et={"text-anchor":"middle",style:{"user-select":"none",transition:"all 300ms ease"}},tt=["opacity"],ot={class:"lines",transform:"translate(0,100)"},nt=["x1","x2"],st=["x1","x2","stroke"],lt={class:"arrows pointer-events-none"},rt=["transform"],at=["cx","r","fill"],it={class:"bottom",transform:"translate(40,290)"},ut={transform:"translate(-20 -30)"},dt=["transform"],ct=["fill"],mt=["transform"],ht=["fill"],ft={__name:"BeatBarsBar",props:{order:{type:Number,default:0},loop:{type:Object,default:{over:4,under:4,sound:"A",volume:1}},maxRatio:{type:Number,default:1},editable:{type:Boolean,default:!1},mute:{type:String,default:null},accents:{type:String,default:null},width:{type:Number,default:920}},emits:["del","sound"],setup(e,{emit:k}){const t=e,{isDark:b}=X(),d=V(()=>(1e3-t.width)/2),{seq:n}=ue(t.loop,t.order,"bars"),v=["A","B","C","D","E"],y=O(v.findIndex(a=>{var s;return a==((s=n.meter)==null?void 0:s.sound)}));z(y,a=>{n.meter.sound=v[a]});const c=V(()=>{const a=1/n.meter.over;return a>=t.maxRatio?t.maxRatio:a});return z(()=>t.loop,a=>{n.meter={...t.loop}},{immediate:!0}),z(()=>t.accents,a=>{a&&a.split("").forEach((s,m)=>{n.mutes[m]=s=="0"||s==".",n.accents[m]=s=="2"||s=="X"})},{immediate:!0}),(a,s)=>{const m=Oe,h=J,u=Q,x=De,D=xe,L=W,E=Y,H=Z,K=G,$=R("tooltip");return l(),i(_,null,[U(a.$slots,"default",{},void 0,!0),(l(),i("svg",qe,[Fe,e.editable?(l(),i("g",He,[p(B(m,{class:"over",modelValue:o(n).meter.over,"onUpdate:modelValue":s[0]||(s[0]=f=>o(n).meter.over=f),width:340,step:1,min:2,max:16,"show-positions":"",ratio:500,every:4},null,8,["modelValue"]),[[$,"Number of steps",void 0,{top:!0}]]),p(B(m,{class:"under",transform:"translate(580,0)",modelValue:o(n).meter.under,"onUpdate:modelValue":s[1]||(s[1]=f=>o(n).meter.under=f),width:340,step:1,min:1,max:16,"show-positions":"",ratio:500,every:4,inverted:"",vector:[-1,-1]},null,8,["modelValue"]),[[$,"Measure subdivision",void 0,{top:!0}]])])):g("",!0),r("g",{class:"info",transform:"translate(500,53)"},[p((l(),i("g",Ge,[Je,r("text",Qe,C(o(n).meter.over),1),r("text",We,C(o(n).meter.under),1)])),[[$,"Time signature",void 0,{top:!0}]]),p((l(),i("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(70,-10)",onMousedown:s[2]||(s[2]=f=>o(n).rotateAccents(-1))},[Ye,B(h,{"font-size":"28",x:"-17",y:"-17"})],32)),[[$,"Rotate pattern backward",void 0,{top:!0}]]),p((l(),i("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(-70,-10)",onMousedown:s[3]||(s[3]=f=>o(n).rotateAccents(1))},[Ze,B(u,{"font-size":"28",x:"-17",y:"-17"})],32)),[[$,"Rotate pattern forward",void 0,{top:!0}]])],8,Ke),r("g",et,[r("g",{class:"steps",opacity:o(n).volume*.9+.1,transform:"translate(0,90)"},[r("g",ot,[r("line",{x1:d.value,x2:c.value*o(n).steps.length*e.width+d.value,stroke:"currentColor","stroke-width":"2"},null,8,nt),(l(!0),i(_,null,N(o(n).activeSteps,(f,w)=>(l(),i("line",{key:w,x1:c.value*Number(f)*e.width+d.value,x2:c.value*(o(n).activeSteps[w+1]||o(n).steps.length)*e.width+d.value,"stroke-width":"6",stroke:o(q)(Number(f)+Number(o(P).pitch)/12*o(n).steps.length,o(n).steps.length,1)},null,8,st))),128))]),(l(!0),i(_,null,N(o(n).steps,(f,w)=>(l(),S(x,{key:w,onMute:I=>o(n).mutes[w]=!o(n).mutes[w],onSubdivide:I=>o(n).steps[w]=I,onAccent:I=>o(n).accents[w]=!o(n).accents[w],muted:o(n).mutes[w],step:w,accented:!!o(n).accents[w],mutes:o(n).mutes,current:o(n).current,subdivisions:f,proportion:c.value,total:o(n).steps.length,width:e.width,pad:d.value},null,8,["onMute","onSubdivide","onAccent","muted","step","accented","mutes","current","subdivisions","proportion","total","width","pad"]))),128)),r("g",lt,[r("line",{class:"progress",transform:`translate(${d.value+o(n).progress*e.width*c.value*o(n).meter.over}, 0)`,"stroke-width":"4",stroke:"currentColor","stroke-linecap":"round",y2:180},null,8,rt)]),r("circle",{cx:c.value*o(n).steps.length*e.width+d.value,cy:100,r:o(n).mutes[1]?4:8,fill:o(n).mutes[1]?"currentColor":o(ie)(Number(o(P).pitch),4)},null,8,at)],8,tt),r("g",it,[p((l(),S(m,{class:"volume",modelValue:o(n).volume,"onUpdate:modelValue":s[4]||(s[4]=f=>o(n).volume=f),width:200,step:.01},{default:A(()=>[r("g",ut,[o(n).volume==0?(l(),S(D,{key:0})):(l(),S(L,{key:1}))])]),_:1},8,["modelValue"])),[[$,"Track volume",void 0,{bottom:!0}]]),p((l(),S(m,{class:"pan",transform:"translate(270,0)",modelValue:o(n).pan,"onUpdate:modelValue":s[5]||(s[5]=f=>o(n).pan=f),min:-1,max:1,width:200,step:.01,"show-center":""},{default:A(()=>[B(E,{x:-18,y:-30})]),_:1},8,["modelValue"])),[[$,"Track panning",void 0,{bottom:!0}]]),p((l(),S(m,{class:"sound",transform:"translate(540,0)",modelValue:y.value,"onUpdate:modelValue":s[6]||(s[6]=f=>y.value=f),width:265,step:1,min:0,max:4,"show-positions":"",every:1},{default:A(()=>{var f;return[r("text",null,C((f=o(n).meter)==null?void 0:f.sound),1)]}),_:1},8,["modelValue"])),[[$,"Click sound select",void 0,{bottom:!0}]]),B(te,{name:"fade"},{default:A(()=>[e.editable&&!o(n).isEuclidean?p((l(),i("g",{key:0,class:"reset cursor-pointer",onMousedown:s[7]||(s[7]=f=>o(n).reset()),transform:"translate(840, 0)"},[r("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:o(b)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,ct),B(H,{"stroke-width":"0",y:"9",x:"9","font-size":"26"})],40,dt)),[[$,"Reset to Euclidean pattern",void 0,{bottom:!0}]]):g("",!0)]),_:1}),e.editable?p((l(),i("g",{key:0,class:"del cursor-pointer",onMousedown:s[8]||(s[8]=f=>a.$emit("del")),transform:"translate(900, 0)"},[r("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:o(b)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,ht),B(K,{color:"hsla(0,25%,50%,1)","stroke-width":"0",y:"9",x:"9","font-size":"26"})],40,mt)),[[$,"Remove track",void 0,{bottom:!0}]]):g("",!0)])])]))],64)}}},vt=ee(ft,[["__scopeId","data-v-28dbaefe"]]),M=se("tempo-bar-loops-object",{0:{over:8,under:8,volume:1,sound:"A"},1:{over:3,under:3,volume:.5,sound:"B"}}),yt={class:"flex flex-wrap items-center w-full p-4 has-bg rounded-xl relative gap-6 bg-light-600 dark-bg-dark-500",id:"screen"},pt={key:1,class:"flex flex-col p-2 my-2 is-group"},xt={class:"flex flex"},bt={class:"flex flex-wrap justify-center"},wt={class:"font-bold mx-2"},gt={key:0},kt={class:"flex flex-wrap justify-center is-group m-1 text-xl p-2",style:{flex:"1 1 100%"}},$t=r("div",{class:"i-la-plus"},null,-1),_t=[$t],Ct=r("div",{class:"i-la-file-download"},null,-1),Bt=[Ct],Nt={key:1,class:"is-group m-2"},Vt=["onClick"],St=["onClick"],Xt={__name:"BeatBars",props:{meters:{type:Array,default:null},patterns:{type:Object,default:null},accents:{type:String,default:"XxXxXxXx"},mute:{type:String,delault:""},secondary:{type:Boolean,default:!1}},setup(e){const k=e,t=O(k.accents),b=T({over:4,under:4,volume:1,sound:"A"});z(()=>k.meters,v=>{if(v){let y=v[0].split("/");M.value={0:{over:Number(y[0]),under:Number(y[1]),volume:k.secondary?0:1,sound:"A"}}}},{immediate:!0}),z(()=>k.patterns,v=>{v&&(t.value=Object.keys(v)[0])},{immediate:!0});function d(v,y){M.value[0].over=v.length,M.value[0].under=y?y.split("/")[1]:v.length,t.value=v}function n(){M.value[Math.floor(Math.random()*1e4)]={...b}}return(v,y)=>{const c=me,a=vt,s=le("client-only"),m=R("tooltip");return l(),i("div",yt,[B(s,null,{default:A(()=>{var h;return[e.secondary?g("",!0):(l(),S(c,{key:0,secondary:!0})),(l(!0),i(_,null,N(o(M),(u,x)=>(l(),S(a,{class:"my-1 rounded-3xl shadow-lg min-h-36 max-h-30vh",style:{flex:"1 1 420px"},key:x,order:x,loop:u,maxRatio:o(de),onDel:D=>delete o(M)[x],editable:!e.meters,accents:t.value,mute:e.mute},null,8,["order","loop","maxRatio","onDel","editable","accents","mute"]))),128)),e.patterns?(l(),i("div",pt,[r("div",xt,[(l(!0),i(_,null,N(t.value,(u,x)=>(l(),i("div",{class:"flex-1 p-1 border-1 border-current rounded-lg m-1 opacity-50",key:x,style:re({opacity:u=="X"?1:.5,backgroundColor:u=="1"||u=="X"||u=="x"?"currentColor":"transparent"})},null,4))),128))]),r("div",bt,[(l(!0),i(_,null,N((h=e.patterns[t.value])==null?void 0:h.names,u=>(l(),i("div",{class:"p-1",key:u},[r("span",wt,C(u.name),1),u.place?(l(),i("span",gt,"("+C(u.place)+")",1)):g("",!0)]))),128))])])):g("",!0),r("div",kt,[e.meters?g("",!0):p((l(),i("button",{key:0,class:"text-button",onClick:y[0]||(y[0]=u=>n())},_t)),[[m,"Add new track",void 0,{bottom:!0}]]),p((l(),i("button",{class:"text-button flex items-center",onClick:y[1]||(y[1]=u=>o(he)(o(ce)))},Bt)),[[m,"Export MIDI file",void 0,{bottom:!0}]]),e.meters&&e.meters.length>1?(l(),i("div",Nt,[(l(!0),i(_,null,N(e.meters,u=>(l(),i("button",{class:"text-button",onClick:x=>M.value=[{over:u.split("/")[0],under:u.split("/")[1],sound:"A",volume:1}]},C(u),9,Vt))),256))])):g("",!0),(l(!0),i(_,null,N(e.patterns,(u,x)=>{var D,L;return l(),i("button",{class:ae(["text-button",{active:t.value==x}]),onClick:E=>d(x,u.meter)},C(((L=(D=u==null?void 0:u.names)==null?void 0:D[0])==null?void 0:L.name)||x),11,St)}),256))])]}),_:1})])}}};export{Xt as _};
