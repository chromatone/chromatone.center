import{r as m,H as $,aV as B,G as N,E as D,J as F,V as S,a0 as z,q as n,f as c,s as o,R as E,u as s,aI as I,z as k,F as y,Q as C,t as L}from"./framework.D01lOa8K.js";import{g as u,aU as O,aV as T,D as q,K as v,c as p,k as _,e as A,az as G}from"./theme.CwHwVffe.js";const H={class:"absolute flex flex-wrap gap-1 w-full p-1 select-none"},J={key:0,class:"i-la-play"},K={key:1,class:"i-la-pause"},Q={class:"cursor-pointer p-2 border-1 border-dark-100 dark-border-light-300"},U={class:"px-4 text-sm font-mono border-1 border-dark-100 dark-border-light-300 flex items-center"},j=["width","height"],W=["x","width","height","rx","fill"],X=["onClick","stroke","x","y","width","rx","fill"],Y=["opacity","x","y"],Z=["transform"],ee=["transform","y2"],te=["stroke","x1","y1","x2","y2"],se=["cx","cy","fill"],ce={__name:"Bounce",setup(le){const x=m(),e=$({w:1e3,h:1e3});B(x,t=>{const a=t[0];e.w=a.contentRect.width,e.h=a.contentRect.height});const b=N(()=>u.pcs.length),i=N(()=>O([-b.value,b.value]).map(T(u.full.name))),w=q(D("bounce-shift",1),0,16),h=m([]),f=m({}),d=m([]),V=(t,a)=>({x:(t+1)/(a+2),y:0,note:i.value[t],midi:G(i.value[t]),fresh:!0});F(()=>i.value.length,()=>{const t=i.value.map((a,g)=>V(g,i.value.length));d.value=t},{immediate:!0}),S(()=>{d.value.forEach((t,a)=>{let g=v.ticks/(768+w.value*a*8);t.y=Math.abs(Math.sin(Math.PI/2+Math.PI*g)),t.y<.02&&!h.value[a]?(t.fresh&&M(t.note),t.fresh=!1):t.y>.5&&(t.fresh=!0)})});const M=t=>{f.value[t]=!0,A(t),setTimeout(()=>{f.value[t]=!1},120)},P=t=>{h.value[t]=!h.value[t]},R=t=>{w.value+=t.delta[0]/100-t.delta[1]/100};return(t,a)=>{const g=z("drag");return c(),n(y,null,[o("div",H,[o("button",{class:"p-2 border-1 border-dark-100 dark-border-light-300",onClick:a[0]||(a[0]=l=>s(v).stopped=!0)},a[2]||(a[2]=[o("div",{class:"i-la-stop"},null,-1)])),o("button",{class:"p-2 border-1 border-dark-100 dark-border-light-300",onClick:a[1]||(a[1]=l=>s(v).playing=!s(v).playing)},[s(v).playing?(c(),n("div",K)):(c(),n("div",J))]),E((c(),n("div",Q,[I(k(s(w).toFixed(2)),1)])),[[g,R]]),a[3]||(a[3]=o("div",{class:"flex-1"},null,-1)),o("div",U,k(s(v).ticks),1)]),(c(),n("svg",{class:"select-none min-h-100svh min-w-full",id:"bounce",ref_key:"svg",ref:x,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"user-select":"none","touch-action":"none"},"dominant-baseline":"middle","text-anchor":"middle"},[o("rect",{width:e.w,height:e.h,stroke:"white",fill:"#2222"},null,8,j),(c(!0),n(y,null,C(d.value,(l,r)=>(c(),n("g",{key:l.note},[o("rect",{class:"op-80 transition-fill duration-200","stroke-width":"0",x:l.x*e.w,y:100,width:e.w/(i.value.length+2)-10,height:e.h-200,rx:e.w/(i.value.length*8),fill:s(p)(l.midi+3,0,void 0,f.value[l.note]?.9:h.value[r]?0:.2)},null,8,W),o("rect",{class:"op-80 transition cursor-pointer","stroke-width":"1",onClick:re=>P(r),stroke:s(p)(s(_)[s(u).pcs[r%s(u).pcs.length]],2,1,.5),x:l.x*e.w,y:e.h-100,width:e.w/(i.value.length+2)-10,height:40,rx:e.w/(i.value.length*8),fill:f.value[l.note]?s(p)(l.midi+3,2):h.value[r]?s(p)(l.midi+3,1,0,.2):"transparent"},null,8,X),o("text",{opacity:f.value[l.note]?1:.25,x:l.x*e.w+25,y:e.h-78},k(l.note),9,Y)]))),128)),o("g",{transform:`translate(${e.w/(i.value.length+4)/2} 0)`},[(c(!0),n(y,null,C(d.value,(l,r)=>(c(),n(y,{key:l.note},[o("line",{class:"op-20",transform:`translate(${l.x*e.w} 0)`,y1:100,y2:e.h-100,stroke:"currentColor"},null,8,ee),r>0?(c(),n("line",{key:0,"stroke-width":"1",stroke:s(p)(s(_)[s(u).pcs[r%s(u).pcs.length]],5),x1:d.value[r-1].x*e.w,y1:e.h-100-d.value[r-1].y*(e.h-200),x2:l.x*e.w,y2:e.h-100-l.y*(e.h-200)},null,8,te)):L("",!0),o("circle",{cx:l.x*e.w,cy:e.h-100-l.y*(e.h-200),r:8,fill:s(p)(s(_)[s(u).pcs[r%s(u).pcs.length]],5,h.value[r]?0:1)},null,8,se)],64))),128))],8,Z)],512))],64)}}};export{ce as default};
