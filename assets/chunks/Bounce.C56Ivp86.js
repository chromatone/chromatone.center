import{r as m,b as D,aW as F,c as N,u as R,d as S,g as V,M as A,x as n,y as c,A as o,E as s,C as E,au as I,G as k,F as y,B as C,I as L}from"./framework.CQBrk0Ry.js";import{g as u,aU as O,aV as T,D as z,K as v,c as p,k as _,e as G,aA as K}from"./theme.Dd_Fb62b.js";const U={class:"absolute flex flex-wrap gap-1 w-full p-1 select-none"},W={key:0,class:"i-la-play"},j={key:1,class:"i-la-pause"},q={class:"cursor-pointer p-2 border-1 border-dark-100 dark-border-light-300"},H={class:"px-4 text-sm font-mono border-1 border-dark-100 dark-border-light-300 flex items-center"},J=["width","height"],Q=["x","width","height","rx","fill"],X=["onClick","stroke","x","y","width","rx","fill"],Y=["opacity","x","y"],Z=["transform"],ee=["transform","y2"],te=["stroke","x1","y1","x2","y2"],se=["cx","cy","fill"],ce={__name:"Bounce",setup(le){const x=m(),e=D({w:1e3,h:1e3});F(x,t=>{const a=t[0];e.w=a.contentRect.width,e.h=a.contentRect.height});const b=N(()=>u.pcs.length),i=N(()=>O([-b.value,b.value]).map(T(u.full.name))),w=z(R("bounce-shift",1),0,16),h=m([]),f=m({}),d=m([]),M=(t,a)=>({x:(t+1)/(a+2),y:0,note:i.value[t],midi:K(i.value[t]),fresh:!0});S(()=>i.value.length,()=>{const t=i.value.map((a,g)=>M(g,i.value.length));d.value=t},{immediate:!0}),V(()=>{d.value.forEach((t,a)=>{let g=v.ticks/(768+w.value*a*8);t.y=Math.abs(Math.sin(Math.PI/2+Math.PI*g)),t.y<.02&&!h.value[a]?(t.fresh&&B(t.note),t.fresh=!1):t.y>.5&&(t.fresh=!0)})});const B=t=>{f.value[t]=!0,G(t),setTimeout(()=>{f.value[t]=!1},120)},P=t=>{h.value[t]=!h.value[t]},$=t=>{w.value+=t.delta[0]/100-t.delta[1]/100};return(t,a)=>{const g=A("drag");return n(),c(y,null,[o("div",U,[o("button",{class:"p-2 border-1 border-dark-100 dark-border-light-300",onClick:a[0]||(a[0]=l=>s(v).stopped=!0)},a[2]||(a[2]=[o("div",{class:"i-la-stop"},null,-1)])),o("button",{class:"p-2 border-1 border-dark-100 dark-border-light-300",onClick:a[1]||(a[1]=l=>s(v).playing=!s(v).playing)},[s(v).playing?(n(),c("div",j)):(n(),c("div",W))]),E((n(),c("div",q,[I(k(s(w).toFixed(2)),1)])),[[g,$]]),a[3]||(a[3]=o("div",{class:"flex-1"},null,-1)),o("div",H,k(s(v).ticks),1)]),(n(),c("svg",{class:"select-none min-h-100svh min-w-full",id:"bounce",ref_key:"svg",ref:x,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"user-select":"none","touch-action":"none"},"dominant-baseline":"middle","text-anchor":"middle"},[o("rect",{width:e.w,height:e.h,stroke:"white",fill:"#2222"},null,8,J),(n(!0),c(y,null,C(d.value,(l,r)=>(n(),c("g",{key:l.note},[o("rect",{class:"op-80 transition-fill duration-200","stroke-width":"0",x:l.x*e.w,y:100,width:e.w/(i.value.length+2)-10,height:e.h-200,rx:e.w/(i.value.length*8),fill:s(p)(l.midi+3,0,void 0,f.value[l.note]?.9:h.value[r]?0:.2)},null,8,Q),o("rect",{class:"op-80 transition cursor-pointer","stroke-width":"1",onClick:re=>P(r),stroke:s(p)(s(_)[s(u).pcs[r%s(u).pcs.length]],2,1,.5),x:l.x*e.w,y:e.h-100,width:e.w/(i.value.length+2)-10,height:40,rx:e.w/(i.value.length*8),fill:f.value[l.note]?s(p)(l.midi+3,2):h.value[r]?s(p)(l.midi+3,1,0,.2):"transparent"},null,8,X),o("text",{opacity:f.value[l.note]?1:.25,x:l.x*e.w+25,y:e.h-78},k(l.note),9,Y)]))),128)),o("g",{transform:`translate(${e.w/(i.value.length+4)/2} 0)`},[(n(!0),c(y,null,C(d.value,(l,r)=>(n(),c(y,{key:l.note},[o("line",{class:"op-20",transform:`translate(${l.x*e.w} 0)`,y1:100,y2:e.h-100,stroke:"currentColor"},null,8,ee),r>0?(n(),c("line",{key:0,"stroke-width":"1",stroke:s(p)(s(_)[s(u).pcs[r%s(u).pcs.length]],5),x1:d.value[r-1].x*e.w,y1:e.h-100-d.value[r-1].y*(e.h-200),x2:l.x*e.w,y2:e.h-100-l.y*(e.h-200)},null,8,te)):L("",!0),o("circle",{cx:l.x*e.w,cy:e.h-100-l.y*(e.h-200),r:8,fill:s(p)(s(_)[s(u).pcs[r%s(u).pcs.length]],5,h.value[r]?0:1)},null,8,se)],64))),128))],8,Z)],512))],64)}}};export{ce as default};
