import{r as m,b as F,aX as R,c as N,u as S,d as V,G as D,P as j,f as n,g as c,h as o,l as s,k as E,au as I,m as k,F as y,j as C,q as L}from"./framework.DBqT_UJK.js";import{g as u,aV as O,b0 as T,H as q,aj as v,c as p,k as _,e as z,b1 as A}from"./theme.CmnwaAF3.js";const G={class:"absolute flex flex-wrap gap-1 w-full p-1 select-none"},H={key:0,class:"i-la-play"},X={key:1,class:"i-la-pause"},J={class:"cursor-pointer p-2 border-1 border-dark-100 dark-border-light-300"},K={class:"px-4 text-sm font-mono border-1 border-dark-100 dark-border-light-300 flex items-center"},Q=["width","height"],U=["x","width","height","rx","fill"],W=["onClick","stroke","x","y","width","rx","fill"],Y=["opacity","x","y"],Z=["transform"],ee=["transform","y2"],te=["stroke","x1","y1","x2","y2"],se=["cx","cy","fill"],ce={__name:"Bounce",setup(le){const b=m(),e=F({w:1e3,h:1e3});R(b,t=>{const a=t[0];e.w=a.contentRect.width,e.h=a.contentRect.height});const x=N(()=>u.pcs.length),i=N(()=>O([-x.value,x.value]).map(T(u.full.name))),w=q(S("bounce-shift",1),0,16),h=m([]),f=m({}),d=m([]),P=(t,a)=>({x:(t+1)/(a+2),y:0,note:i.value[t],midi:A(i.value[t]),fresh:!0});V(()=>i.value.length,()=>{const t=i.value.map((a,g)=>P(g,i.value.length));d.value=t},{immediate:!0}),D(()=>{d.value.forEach((t,a)=>{let g=v.ticks/(768+w.value*a*8);t.y=Math.abs(Math.sin(Math.PI/2+Math.PI*g)),t.y<.02&&!h.value[a]?(t.fresh&&M(t.note),t.fresh=!1):t.y>.5&&(t.fresh=!0)})});const M=t=>{f.value[t]=!0,z(t),setTimeout(()=>{f.value[t]=!1},120)},$=t=>{h.value[t]=!h.value[t]},B=t=>{w.value+=t.delta[0]/100-t.delta[1]/100};return(t,a)=>{const g=j("drag");return n(),c(y,null,[o("div",G,[o("button",{class:"p-2 border-1 border-dark-100 dark-border-light-300",onClick:a[0]||(a[0]=l=>s(v).stopped=!0)},a[2]||(a[2]=[o("div",{class:"i-la-stop"},null,-1)])),o("button",{class:"p-2 border-1 border-dark-100 dark-border-light-300",onClick:a[1]||(a[1]=l=>s(v).playing=!s(v).playing)},[s(v).playing?(n(),c("div",X)):(n(),c("div",H))]),E((n(),c("div",J,[I(k(s(w).toFixed(2)),1)])),[[g,B]]),a[3]||(a[3]=o("div",{class:"flex-1"},null,-1)),o("div",K,k(s(v).ticks),1)]),(n(),c("svg",{class:"select-none min-h-100svh min-w-full",id:"bounce",ref_key:"svg",ref:b,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"user-select":"none","touch-action":"none"},"dominant-baseline":"middle","text-anchor":"middle"},[o("rect",{width:e.w,height:e.h,stroke:"white",fill:"#2222"},null,8,Q),(n(!0),c(y,null,C(d.value,(l,r)=>(n(),c("g",{key:l.note},[o("rect",{class:"op-80 transition-fill duration-200","stroke-width":"0",x:l.x*e.w,y:100,width:e.w/(i.value.length+2)-10,height:e.h-200,rx:e.w/(i.value.length*8),fill:s(p)(l.midi+3,0,void 0,f.value[l.note]?.9:h.value[r]?0:.2)},null,8,U),o("rect",{class:"op-80 transition cursor-pointer","stroke-width":"1",onClick:re=>$(r),stroke:s(p)(s(_)[s(u).pcs[r%s(u).pcs.length]],2,1,.5),x:l.x*e.w,y:e.h-100,width:e.w/(i.value.length+2)-10,height:40,rx:e.w/(i.value.length*8),fill:f.value[l.note]?s(p)(l.midi+3,2):h.value[r]?s(p)(l.midi+3,1,0,.2):"transparent"},null,8,W),o("text",{opacity:f.value[l.note]?1:.25,x:l.x*e.w+25,y:e.h-78},k(l.note),9,Y)]))),128)),o("g",{transform:`translate(${e.w/(i.value.length+4)/2} 0)`},[(n(!0),c(y,null,C(d.value,(l,r)=>(n(),c(y,{key:l.note},[o("line",{class:"op-20",transform:`translate(${l.x*e.w} 0)`,y1:100,y2:e.h-100,stroke:"currentColor"},null,8,ee),r>0?(n(),c("line",{key:0,"stroke-width":"1",stroke:s(p)(s(_)[s(u).pcs[r%s(u).pcs.length]],5),x1:d.value[r-1].x*e.w,y1:e.h-100-d.value[r-1].y*(e.h-200),x2:l.x*e.w,y2:e.h-100-l.y*(e.h-200)},null,8,te)):L("",!0),o("circle",{cx:l.x*e.w,cy:e.h-100-l.y*(e.h-200),r:8,fill:s(p)(s(_)[s(u).pcs[r%s(u).pcs.length]],5,h.value[r]?0:1)},null,8,se)],64))),128))],8,Z)],512))],64)}}};export{ce as default};
