import{r as F,b as y,aV as R,c as w,d as T,W as E,x as o,y as i,A as n,E as s,C as L,af as O,G as N,F as _,B as k,I as W}from"./framework.nFF1SKKu.js";import{g as h,aP as j,aU as q,J as z,aq as g,aV as I,aW as $,aT as B,v as A,y as G,I as f,k as x}from"./theme.DLCahNyy.js";const J={class:"absolute flex flex-wrap gap-1 w-full p-1 select-none"},K=n("div",{class:"i-la-stop"},null,-1),U=[K],H={key:0,class:"i-la-play"},Q={key:1,class:"i-la-pause"},X={class:"cursor-pointer p-2 border-1 border-dark-100 dark-border-light-300"},Y=n("div",{class:"flex-1"},null,-1),Z={class:"px-4 text-sm font-mono border-1 border-dark-100 dark-border-light-300 flex items-center"},tt=["width","height"],et=["x","width","height","rx","fill"],st=["onClick","stroke","x","y","y2","width","rx","fill"],lt=["transform"],rt=["transform","y2"],at=["stroke","x1","y1","x2","y2"],ot=["transform"],it=["cx","cy","fill"],ut={__name:"Bounce",setup(nt){const b=F(),t=y({w:1e3,h:1e3});R(b,e=>{t.w=e[0].contentRect.width,t.h=e[0].contentRect.height});const C=w(()=>h.pcs.length),c=w(()=>j([-C.value,C.value]).map(q(h.full.name))),d=y([]),v=z(1,0,16);function M(e){v.value+=e.delta[0]/100-e.delta[1]/100}const p=y([]),m=y({}),u={x:0,y:0,note:"",midi:0},P=w(()=>{const e=[];for(let r=0;r<c.value.length;r++)u.x=(r+1)/(c.value.length+2),u.y=Math.abs(Math.sin(Math.PI/2+Math.PI*g.ticks/(192*4+v.value*r*8))),u.note=c.value[r],u.midi=I(c.value[r]),u.y<.02&&!p[r]&&V(u.note),e.push({...u});return e});T(P,e=>{d.splice(0,d.length,...e)});function V(e){$(()=>{const r=I(e);m[e]||(m[e]=!0,B(e.slice(0,-1),parseInt(e.slice(-1))-4,!1,.5,.5),A(r,{attack:1}),$(()=>{m[e]=!1,B(e.slice(0,-1),parseInt(e.slice(-1))-4,!0),G(r)},120))},2)}function S(e){p[e]=!p[e]}return(e,r)=>{const D=E("drag");return o(),i(_,null,[n("div",J,[n("button",{class:"p-2 border-1 border-dark-100 dark-border-light-300",onClick:r[0]||(r[0]=l=>s(g).stopped=!0)},U),n("button",{class:"p-2 border-1 border-dark-100 dark-border-light-300",onClick:r[1]||(r[1]=l=>s(g).playing=!s(g).playing)},[s(g).playing?(o(),i("div",Q)):(o(),i("div",H))]),L((o(),i("div",X,[O(N(s(v).toFixed(2)),1)])),[[D,M]]),Y,n("div",Z,N(s(g).ticks),1)]),(o(),i("svg",{class:"select-none min-h-100svh min-w-full",id:"bounce",ref_key:"svg",ref:b,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"user-select":"none","touch-action":"none"}},[n("rect",{width:t.w,height:t.h,stroke:"white",fill:"#2222"},null,8,tt),(o(!0),i(_,null,k(d,(l,a)=>(o(),i("g",{key:a},[n("rect",{class:"op-80 transition-fill duration-200","stroke-width":"0",x:l.x*t.w,y:100,width:t.w/(c.value.length+2)-10,height:t.h-200,rx:t.w/(c.value.length*8),fill:s(f)(l.midi+3,4,void 0,m[l.note]?.9:p[a]?0:.2)},null,8,et),n("rect",{class:"op-80 transition cursor-pointer","stroke-width":"1",onClick:ct=>S(a),stroke:s(f)(s(x)[s(h).pcs[a%s(h).pcs.length]],5,1,.5),x:l.x*t.w,y:t.h-100,y2:t.h-100,width:t.w/(c.value.length+2)-10,height:40,rx:t.w/(c.value.length*8),fill:m[l.note]?s(f)(l.midi+3,4):p[a]?s(f)(l.midi+3,3,0,.2):"transparent"},null,8,st)]))),128)),(o(!0),i(_,null,k(d,(l,a)=>(o(),i("g",{key:a,transform:`translate(${t.w/(c.value.length+4)/2} 0)`},[n("line",{class:"op-20",transform:`translate(${l.x*t.w} 0)`,y1:100,y2:t.h-100,stroke:"currentColor"},null,8,rt),a>0?(o(),i("line",{key:0,"stroke-width":"1",stroke:s(f)(s(x)[s(h).pcs[a%s(h).pcs.length]],5),x1:d[a-1].x*t.w,y1:t.h-100-d[a-1].y*(t.h-200),x2:l.x*t.w,y2:t.h-100-l.y*(t.h-200)},null,8,at)):W("",!0)],8,lt))),128)),(o(!0),i(_,null,k(d,(l,a)=>(o(),i("g",{key:a,transform:`translate(${t.w/(c.value.length+4)/2} 0)`},[n("circle",{cx:l.x*t.w,cy:t.h-100-l.y*(t.h-200),r:8,fill:s(f)(s(x)[s(h).pcs[a%s(h).pcs.length]],5,p[a]?0:1)},null,8,it)],8,ot))),128))],512))],64)}}};export{ut as default};
