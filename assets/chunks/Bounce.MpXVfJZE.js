import{bg as F,g as h,a_ as O,bh as R,J as V,ap as g,bi as N,bj as $,b4 as B,x as j,z as L,I as f,k as x}from"./theme.C1cSeBFq.js";import{a as T,r as v,d as k,w as A,O as E,v as a,x as i,z as n,u as s,B as G,a5 as J,D as I,F as y,A as _,G as K}from"./framework.BMHKg3V0.js";const q={class:"absolute flex flex-wrap gap-1 w-full p-1 select-none"},H={key:0,class:"i-la-play"},Q={key:1,class:"i-la-pause"},U={class:"cursor-pointer p-2 border-1 border-dark-100 dark-border-light-300"},W={class:"px-4 text-sm font-mono border-1 border-dark-100 dark-border-light-300 flex items-center"},X=["width","height"],Y=["x","width","height","rx","fill"],Z=["onClick","stroke","x","y","y2","width","rx","fill"],tt=["transform"],et=["transform","y2"],st=["stroke","x1","y1","x2","y2"],lt=["transform"],rt=["cx","cy","fill"],ct={__name:"Bounce",setup(ot){const b=T(),t=v({w:1e3,h:1e3});F(b,e=>{t.w=e[0].contentRect.width,t.h=e[0].contentRect.height});const C=k(()=>h.pcs.length),c=k(()=>O([-C.value,C.value]).map(R(h.full.name))),u=v([]),w=V(1,0,16);function M(e){w.value+=e.delta[0]/100-e.delta[1]/100}const p=v([]),m=v({}),d={x:0,y:0,note:"",midi:0},D=k(()=>{const e=[];for(let l=0;l<c.value.length;l++)d.x=(l+1)/(c.value.length+2),d.y=Math.abs(Math.sin(Math.PI/2+Math.PI*g.ticks/(192*4+w.value*l*8))),d.note=c.value[l],d.midi=N(c.value[l]),d.y<.02&&!p[l]&&P(d.note),e.push({...d});return e});A(D,e=>{u.splice(0,u.length,...e)});function P(e){$(()=>{const l=N(e);m[e]||(m[e]=!0,B(e.slice(0,-1),parseInt(e.slice(-1))-4,!1,.5,.5),j(l,{attack:1}),$(()=>{m[e]=!1,B(e.slice(0,-1),parseInt(e.slice(-1))-4,!0),L(l)},120))},2)}function S(e){p[e]=!p[e]}return(e,l)=>{const z=E("drag");return a(),i(y,null,[n("div",q,[n("button",{class:"p-2 border-1 border-dark-100 dark-border-light-300",onClick:l[0]||(l[0]=r=>s(g).stopped=!0)},l[2]||(l[2]=[n("div",{class:"i-la-stop"},null,-1)])),n("button",{class:"p-2 border-1 border-dark-100 dark-border-light-300",onClick:l[1]||(l[1]=r=>s(g).playing=!s(g).playing)},[s(g).playing?(a(),i("div",Q)):(a(),i("div",H))]),G((a(),i("div",U,[J(I(s(w).toFixed(2)),1)])),[[z,M]]),l[3]||(l[3]=n("div",{class:"flex-1"},null,-1)),n("div",W,I(s(g).ticks),1)]),(a(),i("svg",{class:"select-none min-h-100svh min-w-full",id:"bounce",ref_key:"svg",ref:b,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"user-select":"none","touch-action":"none"}},[n("rect",{width:t.w,height:t.h,stroke:"white",fill:"#2222"},null,8,X),(a(!0),i(y,null,_(u,(r,o)=>(a(),i("g",{key:o},[n("rect",{class:"op-80 transition-fill duration-200","stroke-width":"0",x:r.x*t.w,y:100,width:t.w/(c.value.length+2)-10,height:t.h-200,rx:t.w/(c.value.length*8),fill:s(f)(r.midi+3,4,void 0,m[r.note]?.9:p[o]?0:.2)},null,8,Y),n("rect",{class:"op-80 transition cursor-pointer","stroke-width":"1",onClick:at=>S(o),stroke:s(f)(s(x)[s(h).pcs[o%s(h).pcs.length]],5,1,.5),x:r.x*t.w,y:t.h-100,y2:t.h-100,width:t.w/(c.value.length+2)-10,height:40,rx:t.w/(c.value.length*8),fill:m[r.note]?s(f)(r.midi+3,4):p[o]?s(f)(r.midi+3,3,0,.2):"transparent"},null,8,Z)]))),128)),(a(!0),i(y,null,_(u,(r,o)=>(a(),i("g",{key:o,transform:`translate(${t.w/(c.value.length+4)/2} 0)`},[n("line",{class:"op-20",transform:`translate(${r.x*t.w} 0)`,y1:100,y2:t.h-100,stroke:"currentColor"},null,8,et),o>0?(a(),i("line",{key:0,"stroke-width":"1",stroke:s(f)(s(x)[s(h).pcs[o%s(h).pcs.length]],5),x1:u[o-1].x*t.w,y1:t.h-100-u[o-1].y*(t.h-200),x2:r.x*t.w,y2:t.h-100-r.y*(t.h-200)},null,8,st)):K("",!0)],8,tt))),128)),(a(!0),i(y,null,_(u,(r,o)=>(a(),i("g",{key:o,transform:`translate(${t.w/(c.value.length+4)/2} 0)`},[n("circle",{cx:r.x*t.w,cy:t.h-100-r.y*(t.h-200),r:8,fill:s(f)(s(x)[s(h).pcs[o%s(h).pcs.length]],5,p[o]?0:1)},null,8,rt)],8,lt))),128))],512))],64)}}};export{ct as default};
