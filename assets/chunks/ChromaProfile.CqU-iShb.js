import{_ as J}from"./ChromaRow.CUTq8cPn.js";import{_ as K}from"./ChromaCode.CTCb8-dG.js";import{F as O,u as j,G as Y,H as Q,I as X,r as Z,g,d as L,s as S,p as V,c as ee,b as q,a as A,J as te,K as E,n as oe,_ as ae}from"./theme.DKUtGHOP.js";import{_ as ne}from"./ChromaCircle.C8ugGIXc.js";import{_ as se}from"./AbcRender.BzoZ0fh4.js";import{_ as R,a4 as le,r as _,S as re,M as i,q as y,f as d,a3 as ie,u as s,s as f,z as k,F as ce,Y as ue,D as me,l as b,e as fe,t as D,v as de}from"./framework.Bbwy4zmA.js";const he=["viewBox"],ve=["transform"],pe=["fill"],ge={class:"select-none",opacity:"0.7","font-size":"80",y:"25",x:"50",fill:"currentColor"},ye=["stroke","points"],_e=["stroke","points"],F=4e3,P=300,T=2e3,$e={__name:"ChromaProfileWaveform",props:{chroma:{type:String,default:"100010001000"},mix:{type:Boolean,default:!1}},setup(o){const{isDark:M}=le(),c=[];for(let t=0;t<13;t++)c[t]=Math.pow(2,t/12);const C=o,$=F/T,r=_(!1),h=_(0),v=_(0),l=_(2e3),a=_(),u=_(1e3),m=O(j("waveform-speed",1e3),0,l);Y(t=>{const e=t.delta[0]-t.delta[1];m.value+=e},{domTarget:a});const B=Q(v,{duration:u,transition:[.87,-.04,.69,1.13],onFinished:()=>{v.value==0&&z()}}),{resume:N,pause:z}=X(()=>{h.value+=B.value},{immediate:!1});re(()=>{r.value?(N(),v.value>0&&(u.value=10),v.value=m.value):(v.value=0,u.value=1e3)});const w=i(()=>{let t=[],e=Z(C.chroma.split(""),-g.tonic);for(let n=0;n<12;n++)e[n]==1?t[n]=!0:delete t[n];return t}),p=j("chord-zoom",400);function I(t,e){return Math.sin((e+h.value)*(Math.PI*2*c[t])/p.value)}const W=i(()=>{let t={};for(let e in w.value){t[e]=[];for(let n=0;n<T;n++)t[e].push(`${n*$},${I(Number(e),n)*100+P/2}`)}return t}),G=i(()=>{let t=[];for(let e=0;e<T;e++){t[e]=0;for(let n in w.value){let x=Number(n);t[e]+=I(x,e)}}return t}),H=i(()=>G.value.map((t,e)=>`${e*$},${t*30+P/2}`).join(" ")),U=i(()=>L(C.chroma,g.tonic));return(t,e)=>(d(),y("div",{class:"waveform",ref_key:"waveContainer",ref:a},[(d(),y("svg",{class:"min-h-4em w-full cursor-pointer",version:"1.1",baseProfile:"full",viewBox:`0 0 ${F} ${P}`,xmlns:"http://www.w3.org/2000/svg",onMousedown:e[0]||(e[0]=n=>{s(V)(o.chroma),r.value=!0}),onTouchstart:e[1]||(e[1]=ie(n=>{s(V)(o.chroma),r.value=!0},["prevent","stop"])),onTouchend:e[2]||(e[2]=n=>{s(S)(o.chroma),r.value=!1}),onTouchcancel:e[3]||(e[3]=n=>{s(S)(o.chroma),r.value=!1}),onMouseup:e[4]||(e[4]=n=>{s(S)(o.chroma),r.value=!1}),onMouseleave:e[5]||(e[5]=n=>{s(S)(o.chroma),r.value=!1})},[f("g",{transform:`translate(${s(m)/l.value*F} 10)`},[f("circle",{r:"40",fill:U.value.hsl},null,8,pe),f("text",ge,k(s(m)*60)+" px/sec",1)],8,ve),e[6]||(e[6]=f("line",{x1:"0",x2:"1200",y1:"400",y2:"400",stroke:"gray","stroke-width":"1"},null,-1)),(d(!0),y(ce,null,ue(w.value,(n,x)=>(d(),y("g",{key:x},[f("polyline",{stroke:s(ee)(x,s(M)?8:2),points:W.value[x],"stroke-width":"4",fill:"none",opacity:"0.9"},null,8,ye)]))),128)),f("polyline",{stroke:U.value?.hsl,points:H.value,"stroke-width":"24",fill:"none"},null,8,_e)],40,he))],512))}},we=R($e,[["__scopeId","data-v-b7d07ef8"]]),xe={class:"flex w-full relative px-4"},be=["href"],ke={class:"text-2xl font-bold capitalize mb-2"},Ce={class:"flex items-center mx-2 w-full gap-4 flex-wrap"},Se={key:1,class:"p-4"},Me={__name:"ChromaProfile",props:{title:{type:String,default:null},chroma:{type:String,default:"1001000100000"},abc:{type:String,default:null},link:{type:String,default:null},description:{type:String,default:""},editable:{type:Boolean,default:!1}},emits:["update:chroma"],setup(o,{emit:M}){const c=o,C=M;me({chord:i(()=>A(c.chroma)),scale:i(()=>q(c.chroma))});const $=i(()=>A(c.chroma)),r=i(()=>q(c.chroma)),h=i(()=>te(c.chroma));i(()=>{let l=[];if(!h.value)return[];for(let a=1;a<h.value.length;a++)l[a-1]=E(h.value[a])-E(h.value[a-1]);return l});function v(l){console.log(l,c.chroma,g.tonic);let a=c.chroma;const u=(12-g.tonic+l)%12;if(console.log(u),u==0)return;let m=a.split("");m[u]=m[u]=="0"?"1":"0",C("update:chroma",m.join(""))}return(l,a)=>{const u=we,m=se,B=ne,N=ae,z=K,w=J;return d(),y("div",{class:"profile",style:de({borderColor:s(L)(o.chroma,s(g).tonic).hsl})},[b(u,{chroma:o.chroma},null,8,["chroma"]),f("div",xe,[o.link?(d(),y("a",{key:0,class:"p-2 absolute top-8px right-2em",href:o.link,target:"_blank"},a[3]||(a[3]=[f("div",{class:"i-la-wikipedia-w"},null,-1)]),8,be)):D("",!0),f("div",ke,k(s(oe)[s(g).tonic])+" "+k($.value.aliases[0]||$.value.name||r.value.name||o.title)+" "+k(r.value.aliases[0]?`(${r.value.aliases[0]})`:""),1)]),o.abc?(d(),fe(m,{key:0,abc:o.abc},null,8,["abc"])):D("",!0),f("div",Ce,[b(B,{style:{flex:"1 0 120px"},chroma:o.chroma},null,8,["chroma"]),b(N,{style:{flex:"1 0 200px"},chroma:o.chroma,"onUpdate:chroma":a[0]||(a[0]=p=>l.$emit("update:chroma",p)),pitch:s(g).tonic,title:!1,"onUpdate:pitch":v,playAll:!0},null,8,["chroma","pitch"]),b(z,{style:{flex:"1 0 120px"},chroma:o.chroma,"onUpdate:chroma":a[1]||(a[1]=p=>l.$emit("update:chroma",p))},null,8,["chroma"])]),b(w,{class:"mx-2 mb-2",chroma:o.chroma,"onUpdate:chroma":a[2]||(a[2]=p=>l.$emit("update:chroma",p)),editable:o.editable},null,8,["chroma","editable"]),o.description?(d(),y("div",Se,k(o.description),1)):D("",!0)],4)}}},Te=R(Me,[["__scopeId","data-v-2f5ff41a"]]);export{Te as _};
