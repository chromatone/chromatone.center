import{_ as K}from"./ChromaRow.BiI41p23.js";import{_ as O}from"./ChromaCode.BKN-xf5c.js";import{_ as Q}from"./ChromaCircle.D3cNre2o.js";import{H as X,I as Y,r as Z,g,d as L,p as I,s as S,c as ee,a as R,b as V,J as te,K as q,n as oe,_ as ae}from"./theme.Bn3b-GmA.js";import{_ as ne}from"./AbcRender.lVelfSkC.js";import{_ as W,e as se,r as y,u as A,av as le,G as re,w as ie,c as i,f as _,g as $,l as s,U as ce,h as c,m as k,F as ue,j as me,b as fe,R as b,q as E,z as de,p as he}from"./framework.DBqT_UJK.js";const ve=["viewBox"],pe=["transform"],ge=["fill"],_e={class:"select-none",opacity:"0.7","font-size":"80",y:"25",x:"50",fill:"currentColor"},ye=["stroke","points"],$e=["stroke","points"],P=4e3,T=300,U=2e3,we={__name:"ChromaProfileWaveform",props:{chroma:{type:String,default:"100010001000"},mix:{type:Boolean,default:!1}},setup(o){const{isDark:B}=se(),u=[];for(let t=0;t<13;t++)u[t]=Math.pow(2,t/12);const C=o,w=P/U,r=y(!1),h=y(0),v=y(0),l=y(2e3),a=y(),m=y(1e3),f=X(A("waveform-speed",1e3),0,l);Y(t=>{const e=t.delta[0]-t.delta[1];f.value+=e},{domTarget:a});const M=le(v,{duration:m,transition:[.87,-.04,.69,1.13],onFinished:()=>{v.value==0&&z()}}),{resume:N,pause:z}=re(()=>{h.value+=M.value},{immediate:!1});ie(()=>{r.value?(N(),v.value>0&&(m.value=10),v.value=f.value):(v.value=0,m.value=1e3)});const x=i(()=>{let t=[],e=Z(C.chroma.split(""),-g.tonic);for(let n=0;n<12;n++)e[n]==1?t[n]=!0:delete t[n];return t}),p=A("chord-zoom",400);function j(t,e){return Math.sin((e+h.value)*(Math.PI*2*u[t])/p.value)}const G=i(()=>{let t={};for(let e in x.value){t[e]=[];for(let n=0;n<U;n++)t[e].push(`${n*w},${j(Number(e),n)*100+T/2}`)}return t}),H=i(()=>{let t=[];for(let e=0;e<U;e++){t[e]=0;for(let n in x.value){let d=Number(n);t[e]+=j(d,e)}}return t}),J=i(()=>H.value.map((t,e)=>`${e*w},${t*30+T/2}`).join(" ")),F=i(()=>L(C.chroma,g.tonic));return(t,e)=>{var n;return _(),$("div",{class:"waveform",ref_key:"waveContainer",ref:a},[(_(),$("svg",{class:"min-h-4em w-full cursor-pointer",version:"1.1",baseProfile:"full",viewBox:`0 0 ${P} ${T}`,xmlns:"http://www.w3.org/2000/svg",onMousedown:e[0]||(e[0]=d=>{s(I)(o.chroma),r.value=!0}),onTouchstart:e[1]||(e[1]=ce(d=>{s(I)(o.chroma),r.value=!0},["prevent","stop"])),onTouchend:e[2]||(e[2]=d=>{s(S)(o.chroma),r.value=!1}),onTouchcancel:e[3]||(e[3]=d=>{s(S)(o.chroma),r.value=!1}),onMouseup:e[4]||(e[4]=d=>{s(S)(o.chroma),r.value=!1}),onMouseleave:e[5]||(e[5]=d=>{s(S)(o.chroma),r.value=!1})},[c("g",{transform:`translate(${s(f)/l.value*P} 10)`},[c("circle",{r:"40",fill:F.value.hsl},null,8,ge),c("text",_e,k(s(f)*60)+" px/sec",1)],8,pe),e[6]||(e[6]=c("line",{x1:"0",x2:"1200",y1:"400",y2:"400",stroke:"gray","stroke-width":"1"},null,-1)),(_(!0),$(ue,null,me(x.value,(d,D)=>(_(),$("g",{key:D},[c("polyline",{stroke:s(ee)(D,s(B)?8:2),points:G.value[D],"stroke-width":"4",fill:"none",opacity:"0.9"},null,8,ye)]))),128)),c("polyline",{stroke:(n=F.value)==null?void 0:n.hsl,points:J.value,"stroke-width":"24",fill:"none"},null,8,$e)],40,ve))],512)}}},xe=W(we,[["__scopeId","data-v-2d3d565a"]]),be={class:"flex w-full relative px-4"},ke=["href"],Ce={class:"text-2xl font-bold capitalize mb-2"},Se={class:"flex items-center mx-2 w-full gap-2"},Be={class:"p-4"},Me={__name:"ChromaProfile",props:{title:{type:String,default:null},chroma:{type:String,default:"1001000100000"},abc:{type:String,default:null},link:{type:String,default:null},description:{type:String,default:""},editable:{type:Boolean,default:!1}},emits:["update:chroma"],setup(o,{emit:B}){const u=o,C=B;fe({chord:i(()=>R(u.chroma)),scale:i(()=>V(u.chroma))});const w=i(()=>R(u.chroma)),r=i(()=>V(u.chroma)),h=i(()=>te(u.chroma));i(()=>{let l=[];if(!h.value)return[];for(let a=1;a<h.value.length;a++)l[a-1]=q(h.value[a])-q(h.value[a-1]);return l});function v(l){console.log(l,u.chroma,g.tonic);let a=u.chroma;const m=(12-g.tonic+l)%12;if(console.log(m),m==0)return;let f=a.split("");f[m]=f[m]=="0"?"1":"0",C("update:chroma",f.join(""))}return(l,a)=>{const m=xe,f=ne,M=ae,N=Q,z=O,x=K;return _(),$("div",{class:"profile",style:he({borderColor:s(L)(o.chroma,s(g).tonic).hsl})},[b(m,{chroma:o.chroma},null,8,["chroma"]),c("div",be,[o.link?(_(),$("a",{key:0,class:"p-2 absolute top-8px right-2em",href:o.link,target:"_blank"},a[3]||(a[3]=[c("div",{class:"i-la-wikipedia-w"},null,-1)]),8,ke)):E("",!0),c("div",Ce,k(s(oe)[s(g).tonic])+" "+k(w.value.aliases[0]||w.value.name||r.value.name||o.title)+" "+k(r.value.aliases[0]?`(${r.value.aliases[0]})`:""),1)]),o.abc?(_(),de(f,{key:0,abc:o.abc},null,8,["abc"])):E("",!0),c("div",Se,[b(M,{style:{flex:"1 1 400px"},chroma:o.chroma,"onUpdate:chroma":a[0]||(a[0]=p=>l.$emit("update:chroma",p)),pitch:s(g).tonic,title:!1,"onUpdate:pitch":v,playAll:!0},null,8,["chroma","pitch"]),b(N,{style:{flex:"1 1 250px"},chroma:o.chroma},null,8,["chroma"]),b(z,{chroma:o.chroma,"onUpdate:chroma":a[1]||(a[1]=p=>l.$emit("update:chroma",p))},null,8,["chroma"])]),b(x,{class:"mx-2 mb-2",chroma:o.chroma,"onUpdate:chroma":a[2]||(a[2]=p=>l.$emit("update:chroma",p)),editable:o.editable},null,8,["chroma","editable"]),c("div",Be,k(o.description),1)],4)}}},je=W(Me,[["__scopeId","data-v-2041c4a4"]]);export{je as _};
