import{g as v,r as S,c as P,aD as I,n as O,aZ as V,y as F,v as j}from"./theme.BH05JkjQ.js";import{q as r,f as u,l as _,j as q,t as A,v as E,u as s,z as B,_ as G,a4 as L,r as w,D as R,M as W,I as Y,s as d,F as T,Y as p,n as Z}from"./framework.DprnlfsI.js";import{_ as H}from"./SvgRing.D7BQEMz6.js";const J={class:"sector"},K={__name:"ChromaTouchSector",props:{pressed:{type:Boolean,default:!1},octave:{type:Number,default:0},octaves:{type:Number,default:4},startOctave:{type:Number,default:1},size:{type:Number,default:50},n:{type:Number,default:0},note:{type:String,default:""}},setup(e){return(N,y)=>{const g=H;return u(),r("g",J,[_(g,{cx:0,cy:0,radius:e.size-e.octave*(e.size/e.octaves),thickness:e.size/e.octaves,from:e.n*30-15,to:(e.n+1)*30-15,fill:s(P)(e.n,e.octave+e.startOctave,s(S)(s(v).chroma,-s(v).tonic)[e.n]==1?1:.1,s(I)[e.n+(e.octave+e.startOctave+2)*12+9]?1:.6)},{default:q(()=>[e.octave==0?(u(),r("text",{key:0,class:"fill-black text-4px",style:E({fontWeight:s(S)(s(v).chroma,-s(v).tonic)[e.n]==1?"bold":"normal",fontSize:s(v).tonic==e.n?"8px":"4px"}),y:"1"},B(e.note),5)):A("",!0)]),_:1},8,["radius","thickness","from","to","fill"])])}}},Q=["viewBox"],U={class:"octaves"},X={class:"touches"},ee=["stroke","x2","y2"],te=["transform"],oe=["fill"],ae={class:"fill-black text-6px"},ne={__name:"ChromaTouch",setup(e){const{isDark:N}=L(),y=w(4),g=w(1),f={pad:2,r:50},b=w(),i=R({}),D=W(()=>{const t={};for(let o in i){const{angle:c,distance:a}=i[o],n=Math.ceil((c-15)/30)%12,m=Math.floor((1-a)*y.value+g.value-2),l=(m+4)*12+n-3;t[o]={pitch:n,octave:m,num:l}}return t});function M({clientX:t,clientY:o}){const c=b.value.createSVGPoint();c.x=t,c.y=o;let{x:a,y:n}=c.matrixTransform(b.value.getScreenCTM().inverse());return{x:a,y:n,angle:180*(Math.PI-Math.atan2(a,n))/Math.PI,distance:Math.hypot(a,n)/f.r}}function h(t){t.type=="mousedown"?i.mouse=M(t):["mouseup","mouseleave","mouseout"].includes(t.type)?delete i.mouse:i.mouse&&t.type=="mousemove"&&(i.mouse=M(t))}function x(t){for(let o of t.changedTouches)["touchend","touchcancel"].includes(t.type)?delete i[o.identifier]:i[o.identifier]=M(o)}return Y(D,(t,o)=>{var c,a,n,m;for(let l in t)((c=t[l])==null?void 0:c.num)!=((a=o[l])==null?void 0:a.num)&&F(((n=t[l])==null?void 0:n.pitch)+57+((m=t[l])==null?void 0:m.octave)*12);Z(()=>{var l,$,z,C;for(let k in o)((l=o[k])==null?void 0:l.num)!=(($=t[k])==null?void 0:$.num)&&j(((z=o[k])==null?void 0:z.pitch)+57+((C=o[k])==null?void 0:C.octave)*12)})}),(t,o)=>{var c;return u(),r("svg",{class:"select-none touch-action-none max-h-full",ref_key:"svg",ref:b,version:"1.1",baseProfile:"full",viewBox:`${-50-f.pad} ${-50-f.pad} ${f.r*2+2*f.pad} ${f.r*2+2*f.pad}`,xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none","-webkit-user-select":"none !important","-webkit-touch-callout":"none"},"font-family":"Commissioner, sans-serif","text-anchor":"middle","dominant-baseline":"middle",onTouchstart:x,onTouchmove:x,onTouchend:x,onTouchcancel:x,onMouseenter:h,onMousemove:h,onMousedown:h,onMouseup:h,onMouseleave:h},[d("g",U,[(u(!0),r(T,null,p(y.value,(a,n)=>(u(),r("g",{class:"octave op-90",key:n},[(u(!0),r(T,null,p(s(O),(m,l)=>(u(),r("g",{key:m},[_(K,{n:l,note:m,octave:n,octaves:y.value,"start-octave":g.value,size:f.r},null,8,["n","note","octave","octaves","start-octave","size"])]))),128))]))),128)),d("g",X,[(u(!0),r(T,null,p(i,(a,n)=>(u(),r("g",{class:"touch",key:n},[d("line",{"stroke-linecap":"round",stroke:`hsl(${a.angle}deg, 50%,50%)`,x2:a.x,y2:a.y},null,8,ee),d("g",{transform:`translate(${a.x} ${a.y})`},[d("circle",{r:"2",fill:s(N)?"#fff3":"#3333"},null,8,oe)],8,te)]))),128))])]),d("text",ae,B((c=s(V))==null?void 0:c[0]),1)],40,Q)}}},ie=G(ne,[["__scopeId","data-v-df0b979c"]]);export{ie as default};
