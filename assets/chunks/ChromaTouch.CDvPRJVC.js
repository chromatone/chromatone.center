import{r as z,g as v,c as O,ax as V,v as D,y as I,n as F,aR as G}from"./theme.Cc8uQkq-.js";import{c as u,h as f,t as B,s as R,l as A,u as s,B as _,k as E,_ as H,a8 as J,r as w,H as L,G as Q,J as W,n as j,i as d,F as T,Q as p}from"./framework.DqGUeSFU.js";import{_ as q}from"./SvgRing.Cz6wJ4FG.js";const K={class:"sector"},U={__name:"ChromaTouchSector",props:{pressed:{type:Boolean,default:!1},octave:{type:Number,default:0},octaves:{type:Number,default:4},startOctave:{type:Number,default:1},size:{type:Number,default:50},n:{type:Number,default:0},note:{type:String,default:""}},setup(e){return(N,y)=>{const x=q;return u(),f("g",K,[B(x,{cx:0,cy:0,radius:e.size-e.octave*(e.size/e.octaves),thickness:e.size/e.octaves,from:e.n*30-15,to:(e.n+1)*30-15,fill:s(O)(e.n,e.octave+e.startOctave,s(z)(s(v).chroma,-s(v).tonic)[e.n]==1?1:.1,s(V)[e.n+(e.octave+e.startOctave+2)*12+9]?1:.6)},{default:R(()=>[e.octave==0?(u(),f("text",{key:0,class:"fill-black text-4px",style:A({fontWeight:s(z)(s(v).chroma,-s(v).tonic)[e.n]==1?"bold":"normal",fontSize:s(v).tonic==e.n?"8px":"4px"}),y:"1"},_(e.note),5)):E("",!0)]),_:1},8,["radius","thickness","from","to","fill"])])}}},X=["viewBox"],Y={class:"octaves"},Z={class:"touches"},ee=["stroke","x2","y2"],te=["transform"],oe=["fill"],ae={class:"fill-black text-6px"},ne={__name:"ChromaTouch",setup(e){const{isDark:N}=J(),y=w(4),x=w(1),i={pad:2,r:50},b=w(),r=L({}),P=Q(()=>{const t={};for(let o in r){const{angle:c,distance:a}=r[o],n=Math.ceil((c-15)/30)%12,m=Math.floor((1-a)*y.value+x.value-2),l=(m+4)*12+n-3;t[o]={pitch:n,octave:m,num:l}}return t});function M({clientX:t,clientY:o}){const c=b.value.createSVGPoint();c.x=t,c.y=o;let{x:a,y:n}=c.matrixTransform(b.value.getScreenCTM().inverse());return{x:a,y:n,angle:180*(Math.PI-Math.atan2(a,n))/Math.PI,distance:Math.hypot(a,n)/i.r}}function h(t){t.type=="mousedown"?r.mouse=M(t):["mouseup","mouseleave","mouseout"].includes(t.type)?delete r.mouse:r.mouse&&t.type=="mousemove"&&(r.mouse=M(t))}function g(t){for(let o of t.changedTouches)["touchend","touchcancel"].includes(t.type)?delete r[o.identifier]:r[o.identifier]=M(o)}return W(P,(t,o)=>{var c,a,n,m;for(let l in t)((c=t[l])==null?void 0:c.num)!=((a=o[l])==null?void 0:a.num)&&D(((n=t[l])==null?void 0:n.pitch)+57+((m=t[l])==null?void 0:m.octave)*12);j(()=>{var l,$,C,S;for(let k in o)((l=o[k])==null?void 0:l.num)!=(($=t[k])==null?void 0:$.num)&&I(((C=o[k])==null?void 0:C.pitch)+57+((S=o[k])==null?void 0:S.octave)*12)})}),(t,o)=>{var c;return u(),f("svg",{class:"select-none touch-action-none max-h-full",ref_key:"svg",ref:b,version:"1.1",baseProfile:"full",viewBox:`${-i.r-i.pad} ${-i.r-i.pad} ${i.r*2+2*i.pad} ${i.r*2+2*i.pad}`,xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none","-webkit-user-select":"none !important","-webkit-touch-callout":"none"},"font-family":"Commissioner, sans-serif","text-anchor":"middle","dominant-baseline":"middle",onTouchstart:g,onTouchmove:g,onTouchend:g,onTouchcancel:g,onMouseenter:h,onMousemove:h,onMousedown:h,onMouseup:h,onMouseleave:h},[d("g",Y,[(u(!0),f(T,null,p(y.value,(a,n)=>(u(),f("g",{class:"octave op-90",key:n},[(u(!0),f(T,null,p(s(F),(m,l)=>(u(),f("g",{key:m},[B(U,{n:l,note:m,octave:n,octaves:y.value,"start-octave":x.value,size:i.r},null,8,["n","note","octave","octaves","start-octave","size"])]))),128))]))),128)),d("g",Z,[(u(!0),f(T,null,p(r,(a,n)=>(u(),f("g",{class:"touch",key:n},[d("line",{"stroke-linecap":"round",stroke:`hsl(${a.angle}deg, 50%,50%)`,x2:a.x,y2:a.y},null,8,ee),d("g",{transform:`translate(${a.x} ${a.y})`},[d("circle",{r:"2",fill:s(N)?"#fff3":"#3333"},null,8,oe)],8,te)]))),128))])]),d("text",ae,_((c=s(G))==null?void 0:c[0]),1)],40,X)}}},ie=H(ne,[["__scopeId","data-v-df0b979c"]]);export{ie as default};
