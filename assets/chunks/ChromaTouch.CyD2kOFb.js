import{aU as V,n as $,af as R,ag as U,r as A,g as _,c as j,ap as D,_ as q}from"./theme.DSsKat3F.js";import{_ as H}from"./JamScale.CpgdTLFu.js";import{_ as K}from"./SvgRing.CihY_G4O.js";import{q as L,v as O,r as C,b as W,c as X,d as J,n as Q,x as m,y as f,A as p,F as M,B as S,E as s,X as B,N as z,H as Y,G as E,I as Z}from"./framework.BY0U24KH.js";import"./ChromaCode.Cb7MGjsD.js";const ee={class:"w-full max-w-full h-100vh"},te=["viewBox"],oe={class:"octaves"},se={class:"touches"},ne=["stroke","x2","y2"],ae=["transform"],ce=["fill"],le={class:"fill-black text-6px"},ie={__name:"ChromaTouch",setup(re){const{isDark:F}=O(),k=C(4),g=C(2),n={pad:.5,r:50},b=C(),u=W({}),G=X(()=>{const e={};for(let t in u){const{angle:l,distance:i}=u[t],c=Math.ceil((l-15)/30)%12,d=Math.floor((1-i)*k.value+g.value-2),h=(d+4)*12+c-3;e[t]={pitch:c,octave:d,num:h}}return e});function T({clientX:e,clientY:t}){const l=b.value.createSVGPoint();l.x=e,l.y=t;let{x:i,y:c}=l.matrixTransform(b.value.getScreenCTM().inverse());return{x:i,y:c,angle:180*(Math.PI-Math.atan2(i,c))/Math.PI,distance:Math.hypot(i,c)/n.r}}function y(e){e.type=="mousedown"?u.mouse=T(e):["mouseup","mouseleave","mouseout"].includes(e.type)?delete u.mouse:u.mouse&&e.type=="mousemove"&&(u.mouse=T(e))}function w(e){for(let t of e.changedTouches)["touchend","touchcancel"].includes(e.type)?delete u[t.identifier]:u[t.identifier]=T(t)}return J(G,(e,t)=>{var l,i,c,d,h,a;for(let o in e)((l=e[o])==null?void 0:l.num)!=((i=t[o])==null?void 0:i.num)&&(V($[(c=e[o])==null?void 0:c.pitch],((d=e[o])==null?void 0:d.octave)-g.value+(((h=e[o])==null?void 0:h.pitch)>=3?1:0)),R({number:(a=e[o])==null?void 0:a.num}));Q(()=>{var o,v,r,N,P,I;for(let x in t)((o=t[x])==null?void 0:o.num)!=((v=e[x])==null?void 0:v.num)&&(V($[(r=t[x])==null?void 0:r.pitch],((N=t[x])==null?void 0:N.octave)-g.value+(((P=t[x])==null?void 0:P.pitch)>=3?1:0),!0),U({number:(I=t[x])==null?void 0:I.num}))})}),(e,t)=>{var d,h;const l=K,i=H,c=q;return m(),f(M,null,[p("div",ee,[(m(),f("svg",{class:"select-none touch-action-none max-h-full",ref_key:"svg",ref:b,version:"1.1",baseProfile:"full",viewBox:`${-n.r-n.pad} ${-n.r-n.pad} ${n.r*2+2*n.pad} ${n.r*2+2*n.pad}`,xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none","-webkit-user-select":"none !important","-webkit-touch-callout":"none"},"font-family":"Commissioner, sans-serif","text-anchor":"middle","dominant-baseline":"middle",onTouchstart:w,onTouchmove:w,onTouchend:w,onTouchcancel:w,onMouseenter:y,onMousemove:y,onMousedown:y,onMouseup:y,onMouseleave:y},[p("g",oe,[(m(!0),f(M,null,S(k.value,(a,o)=>(m(),f("g",{class:"octave op-90",key:a},[(m(!0),f(M,null,S(s($),(v,r)=>(m(),f("g",{key:v},[B(l,{cx:0,cy:0,radius:n.r-o*(n.r/k.value),thickness:n.r/k.value,from:r*30-15,to:(r+1)*30-15,fill:s(j)(r,o+g.value,s(A)(s(_).chroma,-s(_).tonic)[r]==1?1:.5,s(D).activeNotes[r+(o+g.value+1)*12+9]?1:.8)},{default:z(()=>[o==0?(m(),f("text",{key:0,class:"fill-black text-4px",style:Y({fontWeight:s(A)(s(_).chroma,-s(_).tonic)[r]==1?"bold":"normal",fontSize:s(_).tonic==r?"8px":"4px"}),y:"1"},E(v),5)):Z("",!0)]),_:2},1032,["radius","thickness","from","to","fill"])]))),128))]))),128)),p("g",se,[(m(!0),f(M,null,S(u,(a,o)=>(m(),f("g",{class:"touch",key:o},[p("line",{"stroke-linecap":"round",stroke:`hsl(${a.angle}deg, 50%,50%)`,x2:a.x,y2:a.y},null,8,ne),p("g",{transform:`translate(${a.x} ${a.y})`},[p("circle",{r:"2",fill:s(F)?"#fff3":"#3333"},null,8,ce)],8,ae)]))),128))])]),p("text",le,E((h=(d=s(D))==null?void 0:d.guessChords)==null?void 0:h[0]),1)],40,te))]),B(c,{class:"max-w-100 mt-10",pitch:s(_).tonic,"onUpdate:pitch":t[0]||(t[0]=a=>s(_).tonic=a)},{default:z(()=>[B(i,{class:"min-w-full"})]),_:1},8,["pitch"])],64)}}},_e=L(ie,[["__scopeId","data-v-1defc610"]]);export{_e as default};
