import{g as v,r as S,c as O,ax as V,n as D,aR as I,x as F,u as G}from"./theme.CwHwVffe.js";import{q as u,f as r,l as _,j as R,t as j,v as q,u as s,z as B,_ as A,a8 as E,r as w,H,G as J,J as L,s as d,F as T,Q as p,n as Q}from"./framework.D01lOa8K.js";import{_ as W}from"./SvgRing.CEiuM9yf.js";const K={class:"sector"},U={__name:"ChromaTouchSector",props:{pressed:{type:Boolean,default:!1},octave:{type:Number,default:0},octaves:{type:Number,default:4},startOctave:{type:Number,default:1},size:{type:Number,default:50},n:{type:Number,default:0},note:{type:String,default:""}},setup(e){return(N,y)=>{const x=W;return r(),u("g",K,[_(x,{cx:0,cy:0,radius:e.size-e.octave*(e.size/e.octaves),thickness:e.size/e.octaves,from:e.n*30-15,to:(e.n+1)*30-15,fill:s(O)(e.n,e.octave+e.startOctave,s(S)(s(v).chroma,-s(v).tonic)[e.n]==1?1:.1,s(V)[e.n+(e.octave+e.startOctave+2)*12+9]?1:.6)},{default:R(()=>[e.octave==0?(r(),u("text",{key:0,class:"fill-black text-4px",style:q({fontWeight:s(S)(s(v).chroma,-s(v).tonic)[e.n]==1?"bold":"normal",fontSize:s(v).tonic==e.n?"8px":"4px"}),y:"1"},B(e.note),5)):j("",!0)]),_:1},8,["radius","thickness","from","to","fill"])])}}},X=["viewBox"],Y={class:"octaves"},Z={class:"touches"},ee=["stroke","x2","y2"],te=["transform"],oe=["fill"],ae={class:"fill-black text-6px"},ne={__name:"ChromaTouch",setup(e){const{isDark:N}=E(),y=w(4),x=w(1),f={pad:2,r:50},b=w(),i=H({}),P=J(()=>{const t={};for(let o in i){const{angle:c,distance:a}=i[o],n=Math.ceil((c-15)/30)%12,m=Math.floor((1-a)*y.value+x.value-2),l=(m+4)*12+n-3;t[o]={pitch:n,octave:m,num:l}}return t});function M({clientX:t,clientY:o}){const c=b.value.createSVGPoint();c.x=t,c.y=o;let{x:a,y:n}=c.matrixTransform(b.value.getScreenCTM().inverse());return{x:a,y:n,angle:180*(Math.PI-Math.atan2(a,n))/Math.PI,distance:Math.hypot(a,n)/f.r}}function h(t){t.type=="mousedown"?i.mouse=M(t):["mouseup","mouseleave","mouseout"].includes(t.type)?delete i.mouse:i.mouse&&t.type=="mousemove"&&(i.mouse=M(t))}function g(t){for(let o of t.changedTouches)["touchend","touchcancel"].includes(t.type)?delete i[o.identifier]:i[o.identifier]=M(o)}return L(P,(t,o)=>{var c,a,n,m;for(let l in t)((c=t[l])==null?void 0:c.num)!=((a=o[l])==null?void 0:a.num)&&F(((n=t[l])==null?void 0:n.pitch)+57+((m=t[l])==null?void 0:m.octave)*12);Q(()=>{var l,$,z,C;for(let k in o)((l=o[k])==null?void 0:l.num)!=(($=t[k])==null?void 0:$.num)&&G(((z=o[k])==null?void 0:z.pitch)+57+((C=o[k])==null?void 0:C.octave)*12)})}),(t,o)=>{var c;return r(),u("svg",{class:"select-none touch-action-none max-h-full",ref_key:"svg",ref:b,version:"1.1",baseProfile:"full",viewBox:`${-50-f.pad} ${-50-f.pad} ${f.r*2+2*f.pad} ${f.r*2+2*f.pad}`,xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none","-webkit-user-select":"none !important","-webkit-touch-callout":"none"},"font-family":"Commissioner, sans-serif","text-anchor":"middle","dominant-baseline":"middle",onTouchstart:g,onTouchmove:g,onTouchend:g,onTouchcancel:g,onMouseenter:h,onMousemove:h,onMousedown:h,onMouseup:h,onMouseleave:h},[d("g",Y,[(r(!0),u(T,null,p(y.value,(a,n)=>(r(),u("g",{class:"octave op-90",key:n},[(r(!0),u(T,null,p(s(D),(m,l)=>(r(),u("g",{key:m},[_(U,{n:l,note:m,octave:n,octaves:y.value,"start-octave":x.value,size:f.r},null,8,["n","note","octave","octaves","start-octave","size"])]))),128))]))),128)),d("g",Z,[(r(!0),u(T,null,p(i,(a,n)=>(r(),u("g",{class:"touch",key:n},[d("line",{"stroke-linecap":"round",stroke:`hsl(${a.angle}deg, 50%,50%)`,x2:a.x,y2:a.y},null,8,ee),d("g",{transform:`translate(${a.x} ${a.y})`},[d("circle",{r:"2",fill:s(N)?"#fff3":"#3333"},null,8,oe)],8,te)]))),128))])]),d("text",ae,B((c=s(I))==null?void 0:c[0]),1)],40,X)}}},ie=A(ne,[["__scopeId","data-v-df0b979c"]]);export{ie as default};
