import{aK as D,n as $,a9 as K,aa as L,r as V,g as _,a as R,A as z,_ as j}from"./theme.Bj3aPUQN.js";import{_ as q}from"./JamScale.C82vWVw1.js";import{_ as H}from"./SvgRing.0rHiG-zt.js";import{q as O,L as U,r as C,b as W,c as X,d as J,n as Q,v as m,x as f,z as p,F as M,A as S,D as s,X as B,N as I,G as Y,E,H as Z}from"./framework.CBUNEF-3.js";import"./ChromaCode.D75ohut-.js";const ee={class:"w-full max-w-full h-100vh"},te=["viewBox"],oe={class:"octaves"},se={class:"touches"},ae=["stroke","x2","y2"],ne=["transform"],ce=["fill"],le={class:"fill-black text-6px"},ie={__name:"ChromaTouch",setup(re){const{isDark:F}=U(),k=C(4),g=C(2),a={pad:.5,r:50},b=C(),u=W({}),G=X(()=>{const e={};for(let t in u){const{angle:l,distance:i}=u[t],c=Math.ceil((l-15)/30)%12,d=Math.floor((1-i)*k.value+g.value-2),h=(d+4)*12+c-3;e[t]={pitch:c,octave:d,num:h}}return e});function T({clientX:e,clientY:t}){const l=b.value.createSVGPoint();l.x=e,l.y=t;let{x:i,y:c}=l.matrixTransform(b.value.getScreenCTM().inverse());return{x:i,y:c,angle:180*(Math.PI-Math.atan2(i,c))/Math.PI,distance:Math.hypot(i,c)/a.r}}function y(e){e.type=="mousedown"?u.mouse=T(e):["mouseup","mouseleave","mouseout"].includes(e.type)?delete u.mouse:u.mouse&&e.type=="mousemove"&&(u.mouse=T(e))}function w(e){for(let t of e.changedTouches)["touchend","touchcancel"].includes(e.type)?delete u[t.identifier]:u[t.identifier]=T(t)}return J(G,(e,t)=>{var l,i,c,d,h,n;for(let o in e)((l=e[o])==null?void 0:l.num)!=((i=t[o])==null?void 0:i.num)&&(D($[(c=e[o])==null?void 0:c.pitch],((d=e[o])==null?void 0:d.octave)-g.value+(((h=e[o])==null?void 0:h.pitch)>=3?1:0)),K({number:(n=e[o])==null?void 0:n.num}));Q(()=>{var o,v,r,N,P,A;for(let x in t)((o=t[x])==null?void 0:o.num)!=((v=e[x])==null?void 0:v.num)&&(D($[(r=t[x])==null?void 0:r.pitch],((N=t[x])==null?void 0:N.octave)-g.value+(((P=t[x])==null?void 0:P.pitch)>=3?1:0),!0),L({number:(A=t[x])==null?void 0:A.num}))})}),(e,t)=>{var d,h;const l=H,i=q,c=j;return m(),f(M,null,[p("div",ee,[(m(),f("svg",{class:"select-none touch-action-none max-h-full",ref_key:"svg",ref:b,version:"1.1",baseProfile:"full",viewBox:`${-a.r-a.pad} ${-a.r-a.pad} ${a.r*2+2*a.pad} ${a.r*2+2*a.pad}`,xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none","-webkit-user-select":"none !important","-webkit-touch-callout":"none"},"font-family":"Commissioner, sans-serif","text-anchor":"middle","dominant-baseline":"middle",onTouchstart:w,onTouchmove:w,onTouchend:w,onTouchcancel:w,onMouseenter:y,onMousemove:y,onMousedown:y,onMouseup:y,onMouseleave:y},[p("g",oe,[(m(!0),f(M,null,S(k.value,(n,o)=>(m(),f("g",{class:"octave op-90",key:n},[(m(!0),f(M,null,S(s($),(v,r)=>(m(),f("g",{key:v},[B(l,{cx:0,cy:0,radius:a.r-o*(a.r/k.value),thickness:a.r/k.value,from:r*30-15,to:(r+1)*30-15,fill:s(R)(r,o+g.value,s(V)(s(_).chroma,-s(_).tonic)[r]==1?1:.5,s(z).activeNotes[r+(o+g.value+1)*12+9]?1:.8)},{default:I(()=>[o==0?(m(),f("text",{key:0,class:"fill-black text-4px",style:Y({fontWeight:s(V)(s(_).chroma,-s(_).tonic)[r]==1?"bold":"normal",fontSize:s(_).tonic==r?"8px":"4px"}),y:"1"},E(v),5)):Z("",!0)]),_:2},1032,["radius","thickness","from","to","fill"])]))),128))]))),128)),p("g",se,[(m(!0),f(M,null,S(u,(n,o)=>(m(),f("g",{class:"touch",key:o},[p("line",{"stroke-linecap":"round",stroke:`hsl(${n.angle}deg, 50%,50%)`,x2:n.x,y2:n.y},null,8,ae),p("g",{transform:`translate(${n.x} ${n.y})`},[p("circle",{r:"2",fill:s(F)?"#fff3":"#3333"},null,8,ce)],8,ne)]))),128))])]),p("text",le,E((h=(d=s(z))==null?void 0:d.guessChords)==null?void 0:h[0]),1)],40,te))]),B(c,{class:"max-w-100 mt-10",pitch:s(_).tonic,"onUpdate:pitch":t[0]||(t[0]=n=>s(_).tonic=n)},{default:I(()=>[B(i,{class:"min-w-full"})]),_:1},8,["pitch"])],64)}}},_e=O(ie,[["__scopeId","data-v-1defc610"]]);export{_e as default};
