import{g as d,r as p,c as S,aD as _,n as B,aZ as D,y as P,v as I}from"./theme.DLCqlVTm.js";import{q as i,f as r,l as N,j as O,t as V,v as F,u as n,z as $,_ as j,a4 as q,r as b,D as A,M as E,I as G,s as f,F as M,Y as w,n as L}from"./framework.CxSiiyCs.js";import{_ as R}from"./SvgRing.Bjebp0vE.js";const W={class:"sector"},Y={__name:"ChromaTouchSector",props:{pressed:{type:Boolean,default:!1},octave:{type:Number,default:0},octaves:{type:Number,default:4},startOctave:{type:Number,default:1},size:{type:Number,default:50},n:{type:Number,default:0},note:{type:String,default:""}},setup(t){return(T,h)=>{const v=R;return r(),i("g",W,[N(v,{cx:0,cy:0,radius:t.size-t.octave*(t.size/t.octaves),thickness:t.size/t.octaves,from:t.n*30-15,to:(t.n+1)*30-15,fill:n(S)(t.n,t.octave+t.startOctave,n(p)(n(d).chroma,-n(d).tonic)[t.n]==1?1:.1,n(_)[t.n+(t.octave+t.startOctave+2)*12+9]?1:.6)},{default:O(()=>[t.octave==0?(r(),i("text",{key:0,class:"fill-black text-4px",style:F({fontWeight:n(p)(n(d).chroma,-n(d).tonic)[t.n]==1?"bold":"normal",fontSize:n(d).tonic==t.n?"8px":"4px"}),y:"1"},$(t.note),5)):V("",!0)]),_:1},8,["radius","thickness","from","to","fill"])])}}},Z=["viewBox"],H={class:"octaves"},J={class:"touches"},K=["stroke","x2","y2"],Q=["transform"],U=["fill"],X={class:"fill-black text-6px"},ee={__name:"ChromaTouch",setup(t){const{isDark:T}=q(),h=b(4),v=b(1),u={pad:2,r:50},x=b(),c=A({}),z=E(()=>{const o={};for(let a in c){const{angle:e,distance:s}=c[a],l=Math.ceil((e-15)/30)%12,g=Math.floor((1-s)*h.value+v.value-2),C=(g+4)*12+l-3;o[a]={pitch:l,octave:g,num:C}}return o});function k({clientX:o,clientY:a}){const e=x.value.createSVGPoint();e.x=o,e.y=a;let{x:s,y:l}=e.matrixTransform(x.value.getScreenCTM().inverse());return{x:s,y:l,angle:180*(Math.PI-Math.atan2(s,l))/Math.PI,distance:Math.hypot(s,l)/u.r}}function m(o){o.type=="mousedown"?c.mouse=k(o):["mouseup","mouseleave","mouseout"].includes(o.type)?delete c.mouse:c.mouse&&o.type=="mousemove"&&(c.mouse=k(o))}function y(o){for(let a of o.changedTouches)["touchend","touchcancel"].includes(o.type)?delete c[a.identifier]:c[a.identifier]=k(a)}return G(z,(o,a)=>{for(let e in o)o[e]?.num!=a[e]?.num&&P(o[e]?.pitch+57+o[e]?.octave*12);L(()=>{for(let e in a)a[e]?.num!=o[e]?.num&&I(a[e]?.pitch+57+a[e]?.octave*12)})}),(o,a)=>(r(),i("svg",{class:"select-none touch-action-none max-h-full",ref_key:"svg",ref:x,version:"1.1",baseProfile:"full",viewBox:`${-50-u.pad} ${-50-u.pad} ${u.r*2+2*u.pad} ${u.r*2+2*u.pad}`,xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none","-webkit-user-select":"none !important","-webkit-touch-callout":"none"},"font-family":"Commissioner, sans-serif","text-anchor":"middle","dominant-baseline":"middle",onTouchstart:y,onTouchmove:y,onTouchend:y,onTouchcancel:y,onMouseenter:m,onMousemove:m,onMousedown:m,onMouseup:m,onMouseleave:m},[f("g",H,[(r(!0),i(M,null,w(h.value,(e,s)=>(r(),i("g",{class:"octave op-90",key:s},[(r(!0),i(M,null,w(n(B),(l,g)=>(r(),i("g",{key:l},[N(Y,{n:g,note:l,octave:s,octaves:h.value,"start-octave":v.value,size:u.r},null,8,["n","note","octave","octaves","start-octave","size"])]))),128))]))),128)),f("g",J,[(r(!0),i(M,null,w(c,(e,s)=>(r(),i("g",{class:"touch",key:s},[f("line",{"stroke-linecap":"round",stroke:`hsl(${e.angle}deg, 50%,50%)`,x2:e.x,y2:e.y},null,8,K),f("g",{transform:`translate(${e.x} ${e.y})`},[f("circle",{r:"2",fill:n(T)?"#fff3":"#3333"},null,8,U)],8,Q)]))),128))])]),f("text",X,$(n(D)?.[0]),1)],40,Z))}},ne=j(ee,[["__scopeId","data-v-df0b979c"]]);export{ne as default};
