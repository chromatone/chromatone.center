import{r as O,g as x,c as R,aj as I,aT as D,n as p,aU as q,aV as E}from"./theme.DO9Zxf3P.js";import{f as m,g as f,V as j,C as G,p as K,l as n,m as A,q as L,_ as U,e as W,r as C,b as H,c as J,d as Q,y as X,h as y,F as N,j as $}from"./framework.B7TlvOs3.js";import{_ as Y}from"./SvgRing.D_AsrGJl.js";const Z={class:"sector"},ee={__name:"ChromaTouchSector",props:{pressed:{type:Boolean,default:!1},octave:{type:Number,default:0},octaves:{type:Number,default:4},startOctave:{type:Number,default:1},size:{type:Number,default:50},n:{type:Number,default:0},note:{type:Number,default:0}},setup(t){return(z,b)=>{const h=Y;return m(),f("g",Z,[j(h,{cx:0,cy:0,radius:t.size-t.octave*(t.size/t.octaves),thickness:t.size/t.octaves,from:t.n*30-15,to:(t.n+1)*30-15,fill:n(R)(t.n,t.octave+t.startOctave,n(O)(n(x).chroma,-n(x).tonic)[t.n]==1?1:.1,n(I).activeNotes[t.n+(t.octave+t.startOctave+2)*12+9]?1:.6)},{default:G(()=>[t.octave==0?(m(),f("text",{key:0,class:"fill-black text-4px",style:K({fontWeight:n(O)(n(x).chroma,-n(x).tonic)[t.n]==1?"bold":"normal",fontSize:n(x).tonic==t.n?"8px":"4px"}),y:"1"},A(t.note),5)):L("",!0)]),_:1},8,["radius","thickness","from","to","fill"])])}}},te=["viewBox"],oe={class:"octaves"},ae={class:"touches"},ne=["stroke","x2","y2"],se=["transform"],ce=["fill"],le={class:"fill-black text-6px"},ie={__name:"ChromaTouch",setup(t){const{isDark:z}=W(),b=C(4),h=C(1),l={pad:2,r:50},T=C(),u=H({}),F=J(()=>{const e={};for(let o in u){const{angle:s,distance:c}=u[o],a=Math.ceil((s-15)/30)%12,i=Math.floor((1-c)*b.value+h.value-2),d=(i+4)*12+a-3;e[o]={pitch:a,octave:i,num:d}}return e});function w({clientX:e,clientY:o}){const s=T.value.createSVGPoint();s.x=e,s.y=o;let{x:c,y:a}=s.matrixTransform(T.value.getScreenCTM().inverse());return{x:c,y:a,angle:180*(Math.PI-Math.atan2(c,a))/Math.PI,distance:Math.hypot(c,a)/l.r}}function g(e){e.type=="mousedown"?u.mouse=w(e):["mouseup","mouseleave","mouseout"].includes(e.type)?delete u.mouse:u.mouse&&e.type=="mousemove"&&(u.mouse=w(e))}function k(e){for(let o of e.changedTouches)["touchend","touchcancel"].includes(e.type)?delete u[o.identifier]:u[o.identifier]=w(o)}return Q(F,(e,o)=>{var s,c,a,i,d,M;for(let r in e)((s=e[r])==null?void 0:s.num)!=((c=o[r])==null?void 0:c.num)&&(D(p[(a=e[r])==null?void 0:a.pitch],((i=e[r])==null?void 0:i.octave)-h.value+(((d=e[r])==null?void 0:d.pitch)>=3?1:0)),q({number:(M=e[r])==null?void 0:M.num}));X(()=>{var r,S,_,B,V,P;for(let v in o)((r=o[v])==null?void 0:r.num)!=((S=e[v])==null?void 0:S.num)&&(D(p[(_=o[v])==null?void 0:_.pitch],((B=o[v])==null?void 0:B.octave)-h.value+(((V=o[v])==null?void 0:V.pitch)>=3?1:0),!0),E({number:(P=o[v])==null?void 0:P.num}))})}),(e,o)=>{var s,c;return m(),f("svg",{class:"select-none touch-action-none max-h-full",ref_key:"svg",ref:T,version:"1.1",baseProfile:"full",viewBox:`${-l.r-l.pad} ${-l.r-l.pad} ${l.r*2+2*l.pad} ${l.r*2+2*l.pad}`,xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none","-webkit-user-select":"none !important","-webkit-touch-callout":"none"},"font-family":"Commissioner, sans-serif","text-anchor":"middle","dominant-baseline":"middle",onTouchstart:k,onTouchmove:k,onTouchend:k,onTouchcancel:k,onMouseenter:g,onMousemove:g,onMousedown:g,onMouseup:g,onMouseleave:g},[y("g",oe,[(m(!0),f(N,null,$(b.value,(a,i)=>(m(),f("g",{class:"octave op-90",key:i},[(m(!0),f(N,null,$(n(p),(d,M)=>(m(),f("g",{key:d},[j(ee,{n:M,note:d,octave:i,octaves:b.value,"start-octave":h.value,size:l.r},null,8,["n","note","octave","octaves","start-octave","size"])]))),128))]))),128)),y("g",ae,[(m(!0),f(N,null,$(u,(a,i)=>(m(),f("g",{class:"touch",key:i},[y("line",{"stroke-linecap":"round",stroke:`hsl(${a.angle}deg, 50%,50%)`,x2:a.x,y2:a.y},null,8,ne),y("g",{transform:`translate(${a.x} ${a.y})`},[y("circle",{r:"2",fill:n(z)?"#fff3":"#3333"},null,8,ce)],8,se)]))),128))])]),y("text",le,A((c=(s=n(I))==null?void 0:s.guessChords)==null?void 0:c[0]),1)],40,te)}}},fe=U(ie,[["__scopeId","data-v-75b935fe"]]);export{fe as default};
