import{r as O,g,c as G,ap as A,aU as V,n as p,af as R,ag as q}from"./theme.dQYKTFz5.js";import{x as u,y as r,X as D,N as H,H as K,E as n,G as E,I as L,q as U,v as W,r as N,b as X,c as j,d as J,n as Q,A as y,F as $,B as C}from"./framework.Bi_5INRF.js";import{_ as Y}from"./SvgRing.Ccz_U2bQ.js";const Z={class:"sector"},ee={__name:"ChromaTouchSector",props:{pressed:{type:Boolean,default:!1},octave:{type:Number,default:0},octaves:{type:Number,default:4},startOctave:{type:Number,default:1},size:{type:Number,default:50},n:{type:Number,default:0},note:{type:Number,default:0}},setup(t){return(z,b)=>{const h=Y;return u(),r("g",Z,[D(h,{cx:0,cy:0,radius:t.size-t.octave*(t.size/t.octaves),thickness:t.size/t.octaves,from:t.n*30-15,to:(t.n+1)*30-15,fill:n(G)(t.n,t.octave+t.startOctave,n(O)(n(g).chroma,-n(g).tonic)[t.n]==1?1:.1,n(A).activeNotes[t.n+(t.octave+t.startOctave+2)*12+9]?1:.6)},{default:H(()=>[t.octave==0?(u(),r("text",{key:0,class:"fill-black text-4px",style:K({fontWeight:n(O)(n(g).chroma,-n(g).tonic)[t.n]==1?"bold":"normal",fontSize:n(g).tonic==t.n?"8px":"4px"}),y:"1"},E(t.note),5)):L("",!0)]),_:1},8,["radius","thickness","from","to","fill"])])}}},te={class:"w-full max-w-full h-100vh"},ae=["viewBox"],oe={class:"octaves"},ne={class:"touches"},se=["stroke","x2","y2"],ce=["transform"],le=["fill"],ie={class:"fill-black text-6px"},ue={__name:"ChromaTouch",setup(t){const{isDark:z}=W(),b=N(4),h=N(1),l={pad:2,r:50},M=N(),m=X({}),F=j(()=>{const e={};for(let a in m){const{angle:s,distance:c}=m[a],o=Math.ceil((s-15)/30)%12,i=Math.floor((1-c)*b.value+h.value-2),f=(i+4)*12+o-3;e[a]={pitch:o,octave:i,num:f}}return e});function T({clientX:e,clientY:a}){const s=M.value.createSVGPoint();s.x=e,s.y=a;let{x:c,y:o}=s.matrixTransform(M.value.getScreenCTM().inverse());return{x:c,y:o,angle:180*(Math.PI-Math.atan2(c,o))/Math.PI,distance:Math.hypot(c,o)/l.r}}function x(e){e.type=="mousedown"?m.mouse=T(e):["mouseup","mouseleave","mouseout"].includes(e.type)?delete m.mouse:m.mouse&&e.type=="mousemove"&&(m.mouse=T(e))}function k(e){for(let a of e.changedTouches)["touchend","touchcancel"].includes(e.type)?delete m[a.identifier]:m[a.identifier]=T(a)}return J(F,(e,a)=>{var s,c,o,i,f,w;for(let d in e)((s=e[d])==null?void 0:s.num)!=((c=a[d])==null?void 0:c.num)&&(V(p[(o=e[d])==null?void 0:o.pitch],((i=e[d])==null?void 0:i.octave)-h.value+(((f=e[d])==null?void 0:f.pitch)>=3?1:0)),R({number:(w=e[d])==null?void 0:w.num}));Q(()=>{var d,S,_,B,P,I;for(let v in a)((d=a[v])==null?void 0:d.num)!=((S=e[v])==null?void 0:S.num)&&(V(p[(_=a[v])==null?void 0:_.pitch],((B=a[v])==null?void 0:B.octave)-h.value+(((P=a[v])==null?void 0:P.pitch)>=3?1:0),!0),q({number:(I=a[v])==null?void 0:I.num}))})}),(e,a)=>{var s,c;return u(),r("div",te,[(u(),r("svg",{class:"select-none touch-action-none max-h-full",ref_key:"svg",ref:M,version:"1.1",baseProfile:"full",viewBox:`${-l.r-l.pad} ${-l.r-l.pad} ${l.r*2+2*l.pad} ${l.r*2+2*l.pad}`,xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none","-webkit-user-select":"none !important","-webkit-touch-callout":"none"},"font-family":"Commissioner, sans-serif","text-anchor":"middle","dominant-baseline":"middle",onTouchstart:k,onTouchmove:k,onTouchend:k,onTouchcancel:k,onMouseenter:x,onMousemove:x,onMousedown:x,onMouseup:x,onMouseleave:x},[y("g",oe,[(u(!0),r($,null,C(b.value,(o,i)=>(u(),r("g",{class:"octave op-90",key:i},[(u(!0),r($,null,C(n(p),(f,w)=>(u(),r("g",{key:f},[D(ee,{n:w,note:f,octave:i,octaves:b.value,"start-octave":h.value,size:l.r},null,8,["n","note","octave","octaves","start-octave","size"])]))),128))]))),128)),y("g",ne,[(u(!0),r($,null,C(m,(o,i)=>(u(),r("g",{class:"touch",key:i},[y("line",{"stroke-linecap":"round",stroke:`hsl(${o.angle}deg, 50%,50%)`,x2:o.x,y2:o.y},null,8,se),y("g",{transform:`translate(${o.x} ${o.y})`},[y("circle",{r:"2",fill:n(z)?"#fff3":"#3333"},null,8,le)],8,ce)]))),128))])]),y("text",ie,E((c=(s=n(A))==null?void 0:s.guessChords)==null?void 0:c[0]),1)],40,ae))])}}},fe=U(ue,[["__scopeId","data-v-ab88d688"]]);export{fe as default};
