import{r as _,g as x,c as D,az as A,u as E,n as p,x as F,aT as G}from"./theme.FO-BRpn0.js";import{x as r,y as u,P as I,U as q,H,E as s,G as O,I as K,q as L,v as R,r as w,b as U,c as W,d as j,K as J,A as h,F as N,B as $}from"./framework.BjEhsXnI.js";import{_ as Q}from"./SvgRing.Buwv6j2s.js";const X={class:"sector"},Y={__name:"ChromaTouchSector",props:{pressed:{type:Boolean,default:!1},octave:{type:Number,default:0},octaves:{type:Number,default:4},startOctave:{type:Number,default:1},size:{type:Number,default:50},n:{type:Number,default:0},note:{type:String,default:""}},setup(t){return(z,g)=>{const k=Q;return r(),u("g",X,[I(k,{cx:0,cy:0,radius:t.size-t.octave*(t.size/t.octaves),thickness:t.size/t.octaves,from:t.n*30-15,to:(t.n+1)*30-15,fill:s(D)(t.n,t.octave+t.startOctave,s(_)(s(x).chroma,-s(x).tonic)[t.n]==1?1:.1,s(A)[t.n+(t.octave+t.startOctave+2)*12+9]?1:.6)},{default:q(()=>[t.octave==0?(r(),u("text",{key:0,class:"fill-black text-4px",style:H({fontWeight:s(_)(s(x).chroma,-s(x).tonic)[t.n]==1?"bold":"normal",fontSize:s(x).tonic==t.n?"8px":"4px"}),y:"1"},O(t.note),5)):K("",!0)]),_:1},8,["radius","thickness","from","to","fill"])])}}},Z=["viewBox"],ee={class:"octaves"},te={class:"touches"},oe=["stroke","x2","y2"],ae=["transform"],ne=["fill"],se={class:"fill-black text-6px"},ce={__name:"ChromaTouch",setup(t){const{isDark:z}=R(),g=w(4),k=w(1),l={pad:2,r:50},M=w(),i=U({}),V=W(()=>{const e={};for(let o in i){const{angle:c,distance:a}=i[o],n=Math.ceil((c-15)/30)%12,f=Math.floor((1-a)*g.value+k.value-2),d=(f+4)*12+n-3;e[o]={pitch:n,octave:f,num:d}}return e});function T({clientX:e,clientY:o}){const c=M.value.createSVGPoint();c.x=e,c.y=o;let{x:a,y:n}=c.matrixTransform(M.value.getScreenCTM().inverse());return{x:a,y:n,angle:180*(Math.PI-Math.atan2(a,n))/Math.PI,distance:Math.hypot(a,n)/l.r}}function v(e){e.type=="mousedown"?i.mouse=T(e):["mouseup","mouseleave","mouseout"].includes(e.type)?delete i.mouse:i.mouse&&e.type=="mousemove"&&(i.mouse=T(e))}function b(e){for(let o of e.changedTouches)["touchend","touchcancel"].includes(e.type)?delete i[o.identifier]:i[o.identifier]=T(o)}return j(V,(e,o)=>{var c,a,n,f,d;for(let m in e)((c=e[m])==null?void 0:c.num)!=((a=o[m])==null?void 0:a.num)&&E(p[(n=e[m])==null?void 0:n.pitch]+(((f=e[m])==null?void 0:f.octave)+(((d=e[m])==null?void 0:d.pitch)>=3?4:3)));J(()=>{var m,C,S,B,P;for(let y in o)((m=o[y])==null?void 0:m.num)!=((C=e[y])==null?void 0:C.num)&&F(p[(S=o[y])==null?void 0:S.pitch]+(((B=o[y])==null?void 0:B.octave)+(((P=o[y])==null?void 0:P.pitch)>=3?4:3)))})}),(e,o)=>{var c;return r(),u("svg",{class:"select-none touch-action-none max-h-full",ref_key:"svg",ref:M,version:"1.1",baseProfile:"full",viewBox:`${-l.r-l.pad} ${-l.r-l.pad} ${l.r*2+2*l.pad} ${l.r*2+2*l.pad}`,xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none","-webkit-user-select":"none !important","-webkit-touch-callout":"none"},"font-family":"Commissioner, sans-serif","text-anchor":"middle","dominant-baseline":"middle",onTouchstart:b,onTouchmove:b,onTouchend:b,onTouchcancel:b,onMouseenter:v,onMousemove:v,onMousedown:v,onMouseup:v,onMouseleave:v},[h("g",ee,[(r(!0),u(N,null,$(g.value,(a,n)=>(r(),u("g",{class:"octave op-90",key:n},[(r(!0),u(N,null,$(s(p),(f,d)=>(r(),u("g",{key:f},[I(Y,{n:d,note:f,octave:n,octaves:g.value,"start-octave":k.value,size:l.r},null,8,["n","note","octave","octaves","start-octave","size"])]))),128))]))),128)),h("g",te,[(r(!0),u(N,null,$(i,(a,n)=>(r(),u("g",{class:"touch",key:n},[h("line",{"stroke-linecap":"round",stroke:`hsl(${a.angle}deg, 50%,50%)`,x2:a.x,y2:a.y},null,8,oe),h("g",{transform:`translate(${a.x} ${a.y})`},[h("circle",{r:"2",fill:s(z)?"#fff3":"#3333"},null,8,ne)],8,ae)]))),128))])]),h("text",se,O((c=s(G))==null?void 0:c[0]),1)],40,Z)}}},ue=L(ce,[["__scopeId","data-v-f55699a8"]]);export{ue as default};
