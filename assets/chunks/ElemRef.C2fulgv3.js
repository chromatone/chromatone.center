import{a$ as V,a0 as w,u as E,aO as h,b0 as s,J as A,aX as N}from"./theme.BmY6844e.js";import{b as P,r as _,d as b,K as r,C as m,D as f,F as R,G as k,H as $,R as B,a0 as F}from"./framework.BmjQO8gg.js";const C={"osc:frequency":{value:110,min:30,max:5e3,step:1},"osc:playing":{value:0,min:0,max:1,step:1},"osc:volume":{value:.2,min:0,max:1,step:.01},"fx:pingPong":{value:.1,min:0,max:1,step:.01},"fx:feedback":{value:.1,min:0,max:1,step:.01},"fx:shift":{value:.4,min:0,max:1,step:.01},"fx:bpm":{value:120,min:10,max:500,step:1,hidden:!0}};function M(p=12){const a=P(Array(p).fill(!0).map((u,t)=>({key:`v${t}`,gate:0,midi:69,vel:0}))),e=_(0),l=_(0);function c(u=60,t=0){if(t){do if(e.value++,e.value>=a.length&&(e.value=0,l.value++),l.value>3)break;while(a[e.value].gate==1);l.value=0,a[e.value].gate=1,a[e.value].midi=u,a[e.value].vel=t/127}else a.forEach(o=>{o.midi==u&&(o.gate=0)})}function d(u){a.forEach(t=>t.gate=0)}return{voices:a,cycleNote:c,stopAll:d}}function q(){const p=_(!1),{controls:a,cv:e,groups:l}=V(C,"ref"),c=w();b(()=>c.bpm,n=>{a["fx:bpm"]=n});const{midi:d}=E(),{voices:u,cycleNote:t}=M();b(()=>d.note,n=>t(n.number,n.velocity));const{audio:o,render:g}=h();b(()=>o.initiated,()=>{o.initiated&&(o.layers.saw={volume:.7,signal:v(i())})},{immediate:!0});function i(){return s.mul(e["osc:playing"],e["osc:volume"],s.blepsaw(e["osc:frequency"]))}function v(n){return Array(2).fill(null).map((x,y)=>s.add(n,s.mul(e["fx:pingPong"],e["fx:feedback"],s.delay({size:44100},s.ms2samps(s.mul(s.div(6e4,e["fx:bpm"]),s.add(1,s.mul(y==0?-.5:.5,e["fx:shift"])))),e["fx:feedback"],n))))}return{controls:a,cv:e,groups:l,audio:o,render:g,started:p,voices:u,cycleNote:t}}const D={key:1,class:"flex flex-col gap-4"},z={__name:"ElemRef",setup(p){const{controls:a,groups:e,started:l,render:c,voices:d}=q();return(u,t)=>{const o=A,g=N;return r(l)?(m(),f("div",D,[R("button",{class:"text-button",onMousedown:t[1]||(t[1]=i=>r(a)["osc:playing"]=1),onMouseup:t[2]||(t[2]=i=>r(a)["osc:playing"]=0)},"Play",32),(m(!0),f(k,null,$(r(e),(i,v)=>(m(),f("div",{class:"flex flex-wrap gap-2 is-group p-2",key:i},[(m(!0),f(k,null,$(i,(n,x)=>(m(),B(o,{modelValue:r(a)[`${v}:${x}`],"onUpdate:modelValue":y=>r(a)[`${v}:${x}`]=y,min:n.min,max:n.max,step:n.step,param:x},null,8,["modelValue","onUpdate:modelValue","min","max","step","param"]))),256))]))),128)),F(g)])):(m(),f("button",{key:0,class:"text-button",onClick:t[0]||(t[0]=i=>{r(c)(),l.value=!0})},"RENDER "))}}};export{z as default};
