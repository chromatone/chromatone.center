import{a$ as h,a0 as w,u as E,aO as A,b0 as o,S as C,J as N,aX as P}from"./theme.D8bEcdRX.js";import{b as R,r as $,d as b,K as u,C as r,D as c,F as V,G as _,H as k,M as B,R as F,a0 as M}from"./framework.BmjQO8gg.js";const S={"osc:frequency":{value:110,min:30,max:5e3,step:1},"osc:playing":{value:0,min:0,max:1,step:1},"osc:volume":{value:.2,min:0,max:1,step:.01},"fx:pingPong":{value:.1,min:0,max:1,step:.01},"fx:feedback":{value:.1,min:0,max:1,step:.01},"fx:shift":{value:.4,min:0,max:1,step:.01},"fx:bpm":{value:120,min:10,max:500,step:1,hidden:!0}};function q(f=12){const a=R(Array(f).fill(!0).map((m,t)=>({key:`v${t}`,gate:0,midi:69,vel:0}))),e=$(0),i=$(0);function p(m=60,t=0){if(t){do if(e.value++,e.value>=a.length&&(e.value=0,i.value++),i.value>3)break;while(a[e.value].gate==1);i.value=0,a[e.value].gate=1,a[e.value].midi=m,a[e.value].vel=t/127}else a.forEach(l=>{l.midi==m&&(l.gate=0)})}function d(m){a.forEach(t=>t.gate=0)}return{voices:a,cycleNote:p,stopAll:d}}function z(){const f=$(!1),{controls:a,cv:e,groups:i}=h(S,"ref"),p=w();b(()=>p.bpm,s=>{a["fx:bpm"]=s});const{midi:d}=E(),{voices:m,cycleNote:t}=q();b(()=>d.note,s=>t(s.number,s.velocity));const{audio:l,render:g}=A();b(()=>l.initiated,()=>{l.initiated&&(l.layers.saw={volume:.7,signal:v(n())})},{immediate:!0});function n(){return o.mul(e["osc:playing"],e["osc:volume"],o.blepsaw(e["osc:frequency"]))}function v(s){return Array(2).fill(null).map((x,y)=>o.add(s,o.mul(e["fx:pingPong"],o.delay({size:44100},o.ms2samps(o.mul(o.div(6e4,e["fx:bpm"]),o.add(1,o.mul(y==0?-.5:.5,e["fx:shift"])))),e["fx:feedback"],s))))}return{controls:a,cv:e,groups:i,audio:l,render:g,started:f,voices:m,cycleNote:t}}const D={key:1,class:"flex flex-col gap-4"},T={class:"flex gap-1"},H={__name:"ElemRef",setup(f){const{controls:a,groups:e,started:i,render:p,voices:d}=z();return(m,t)=>{const l=N,g=P;return u(i)?(r(),c("div",D,[V("button",{class:"text-button",onMousedown:t[1]||(t[1]=n=>u(a)["osc:playing"]=1),onMouseup:t[2]||(t[2]=n=>u(a)["osc:playing"]=0)},"Play",32),V("div",T,[(r(!0),c(_,null,k(u(d),n=>(r(),c("div",{class:"p-1 flex-1 rounded-xl",key:n,style:B({backgroundColor:u(C)(n.midi-3,3,n.gate?1:0)})},null,4))),128))]),(r(!0),c(_,null,k(u(e),(n,v)=>(r(),c("div",{class:"flex flex-wrap gap-2 is-group p-2",key:n},[(r(!0),c(_,null,k(n,(s,x)=>(r(),F(l,{modelValue:u(a)[`${v}:${x}`],"onUpdate:modelValue":y=>u(a)[`${v}:${x}`]=y,min:s.min,max:s.max,step:s.step,param:x},null,8,["modelValue","onUpdate:modelValue","min","max","step","param"]))),256))]))),128)),M(g)])):(r(),c("button",{key:0,class:"text-button",onClick:t[0]||(t[0]=n=>{u(p)(),i.value=!0})},"RENDER "))}}};export{H as default};
