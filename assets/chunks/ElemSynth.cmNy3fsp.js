import{L as T,D as ee,au as a,aG as me,bg as ye,bh as ke,V as be,N as fe,bi as R,C as te,g as X,am as we}from"./theme.DWS7mSVx.js";import{Q as he,R as D,c as L,r as Y,x as z,y as E,A as m,G as q,q as $e,b as Me,d as Z,u as Ce,aq as Fe,z as ne,E as l,H as Q,S as ae,F as G,B as W,P as B,I as K}from"./framework.BjEhsXnI.js";function Ne(e,t){return Object.keys(e.values).forEach(i=>e.values[i]=e.values[i]&&parseFloat(e.values[i].toFixed(t))),e}function ve(e,t,i){const n=t-1,o=i[pe(n,i.length)];return o.marker!=="Z"?o:ve(e,n,i)}function xe(e,t,i){const n=t+1,o=i[pe(n,i.length)];return o.marker==="Z"?xe(e,n,i):o}function Se(e,t,i){let n=i[t-1]||{values:{x:0,y:0}};if(e.marker===e.marker.toLowerCase())switch(e.marker=e.marker.toUpperCase(),e.marker){case"M":e.values.x+=n.values.x,e.values.y+=n.values.y;break;case"L":case"A":e.values.x+=n.values.x,e.values.y+=n.values.y;break;case"H":e.marker="L",e.values.x+=n.values.x,e.values.y=n.values.y;break;case"V":e.marker="L",e.values.x=n.values.x,e.values.y+=n.values.y;break;case"C":e.values.x+=n.values.x,e.values.y+=n.values.y,e.values.x1+=n.values.x,e.values.y1+=n.values.y,e.values.x2+=n.values.x,e.values.y2+=n.values.y;break;case"S":e.values.x+=n.values.x,e.values.y+=n.values.y,e.values.x2+=n.values.x,e.values.y2+=n.values.y;break;case"Q":e.values.x+=n.values.x,e.values.y+=n.values.y,e.values.x1+=n.values.x,e.values.y1+=n.values.y;break;case"T":e.values.x+=n.values.x,e.values.y+=n.values.y;break}else if(e.marker===e.marker.toUpperCase())switch(e.marker){case"H":e.marker="L",e.values.y=n.values.y;break;case"V":e.marker="L",e.values.x=n.values.x;break}if(e.marker==="Z"){let o=function(v,r){return v[r].marker==="M"?v[r]:o(v,r-1)},s=o(i,t);e.values.x=s.values.x,e.values.y=s.values.y}return e}function ze(e,t){const i=[];switch(e.toUpperCase()){case"M":for(let n=0;n<t.length;n+=2){let o;e===e.toUpperCase()?o=n===0?"M":"L":o=n===0?"m":"l",i.push({marker:o,values:{x:t[n],y:t[n+1]}})}break;case"L":for(let n=0;n<t.length;n+=2)i.push({marker:e,values:{x:t[n],y:t[n+1]}});break;case"H":for(let n=0;n<t.length;n++)i.push({marker:e,values:{x:t[n],y:0}});break;case"V":for(let n=0;n<t.length;n++)i.push({marker:e,values:{x:0,y:t[n]}});break;case"C":for(let n=0;n<t.length;n+=6)i.push({marker:e,values:{x1:t[n],y1:t[n+1],x2:t[n+2],y2:t[n+3],x:t[n+4],y:t[n+5]}});break;case"S":for(let n=0;n<t.length;n+=4)i.push({marker:e,values:{x2:t[n],y2:t[n+1],x:t[n+2],y:t[n+3]}});break;case"Q":for(let n=0;n<t.length;n+=4)i.push({marker:e,values:{x1:t[n],y1:t[n+1],x:t[n+2],y:t[n+3]}});break;case"T":for(let n=0;n<t.length;n+=2)i.push({marker:e,values:{x:t[n],y:t[n+1]}});break;case"A":for(let n=0;n<t.length;n+=7)i.push({marker:e,values:{radiusX:t[n],radiusY:t[n+1],rotation:t[n+2],largeArc:t[n+3],sweep:t[n+4],x:t[n+5],y:t[n+6]}});break;case"Z":i.push({marker:e,values:{x:0,y:0}});break}return i}function pe(e,t){return(e%t+t)%t}function Ee(e,t,i){if(t!==0&&e.marker==="L"){let n=i[t-1];["x","y"].every(s=>Math.round(Math.abs(n.values[s]-e.values[s]))===0)&&(e.overlap=!0)}return e}function _(e,t){const i=["x","y"].every(n=>Math.round(Math.abs(e[t].values[n]-e[0].values[n]))===0);e[t].marker==="L"&&i&&(e[t].overlap=!0,_(e,t-1)),e[t].marker==="Z"&&_(e,t-1)}function Pe(e,t,i){const n=ie(e.values,i.values),o=ie(t.values,e.values);return Math.min(o,n)}function se(e,t){return Math.atan2(t.x-e.x,t.y-e.y)}function ie(e,t){const i=e.x-t.x,n=e.y-t.y;return Math.sqrt(Math.pow(i,2)+Math.pow(n,2))}function oe(e,t){return Math.sin(e)*t}function re(e,t){return Math.cos(e)*t}function le(e,t){const i=t/Math.tan(e);return i===1/0||i===-1/0||isNaN(i)?t:i}function Ae(e,t){return t*Math.tan(e)}function qe(e,t){let i,n=0,o=e*(180/Math.PI);return o<0&&o>=-180||o>180&&o<360?i=le(e/2,-t):(i=le(e/2,t),n=1,i===1/0&&(i=t)),{offset:i,sweepFlag:n}}function Ue(e){const t=["radiusX","radiusY","rotation","largeArc","sweep","x1","y1","x2","y2","x","y"];return e.map(i=>{let n="";if(i.marker!=="Z"){const o=Object.keys(i.values);n=t.filter(s=>o.indexOf(s)!==-1).map(s=>i.values[s]).join()}return`${i.marker}${n}`}).join("").trim()}function Ve(e){const t=/[MmLlSsQqLlHhVvCcSsQqTtAaZz]/g,i=/-?[0-9]*\.?\d+/g;return[...e.matchAll(t)].map(n=>({marker:n[0],index:n.index})).reduceRight((n,o)=>{const s=e.substring(o.index,n.length?n[n.length-1].index:e.length);return n.concat([{marker:o.marker,index:o.index,chunk:s.length>0?s.substr(1,s.length-1):s}])},[]).reverse().flatMap(n=>{const o=n.chunk.match(i),s=o?o.map(parseFloat):[];return ze(n.marker,s)}).map(Se)}function Ye(e,t,i){let n=[],o=[];return e.forEach(s=>Ne(s,i)),e.forEach(s=>{s.marker==="M"&&n.push([]),n[n.length-1].push(s)}),n.forEach(s=>{s.map(Ee),_(s,s.length-1);const v=s[s.length-1].marker=="Z";s.filter(r=>!r.overlap).map((r,h,C)=>{const d=ve(r,h,C),y=xe(r,h,C),b=se(r.values,d.values),w=se(r.values,y.values),x=w-b,u=x*(180/Math.PI),f=Pe(r,d,y),p=Math.abs(Ae(x/2,f/2)),F=Math.min(t,p),V=qe(x,F),c=V.offset,g=V.sweepFlag,k=(h==0||h==C.length-1)&&!v;switch(r.marker){case"M":case"L":const $=[r.values.x+oe(b,c),r.values.y+re(b,c)],M=[r.values.x+oe(w,c),r.values.y+re(w,c)];k?o.push({marker:r.marker,values:r.values}):o.push({marker:r.marker,values:{x:parseFloat($[0].toFixed(3)),y:parseFloat($[1].toFixed(3))}}),!k&&(y.marker==="L"||y.marker==="M")&&o.push({marker:"A",radius:F,values:{radiusX:parseFloat(F.toFixed(3)),radiusY:parseFloat(F.toFixed(3)),rotation:u,largeArc:0,sweep:g,x:parseFloat(M[0].toFixed(3)),y:parseFloat(M[1].toFixed(3))}});break;case"C":case"S":case"Q":case"T":case"A":case"Z":o.push({marker:r.marker,values:r.values});break}})}),{path:Ue(o),commands:o}}function Le(e,t,i){return Ye([...Ve(e)],t,i)}const Xe=["viewBox"],De=["width","height","transform"],Ie=["font-size","transform"],Oe=["transform"],Te=["x"],Re=["x"],Be=["x"],Ze=["x"],je=["transform"],He=["x"],Qe=["x"],Ge=["x"],We=["x"],Ke=["d","stroke-width"],Je={class:"levels op-50",stroke:"currentColor","stroke-linecap":"round","stroke-width":"0.5"},_e=["x2","transform"],et=["x2","transform"],tt=["x2","transform"],nt=["x2","transform"],at={class:"controls op-50",stroke:"currentColor",fill:"transparent","stroke-dasharray":"0.05 1","stroke-linecap":"round","stroke-width":"0.5"},st=["width","height"],it=["width","height","transform"],ot=["width","height","transform"],rt=["width","height","transform"],lt={__name:"ControlAdsr",props:he({width:{type:Number,default:60},height:{type:Number,default:20},pad:{type:Number,default:3},title:{type:String,default:"Envelope"}},{a:{type:Number,default:1},aModifiers:{},d:{type:Number,default:1},dModifiers:{},s:{type:Number,default:.7},sModifiers:{},r:{type:Number,default:1},rModifiers:{}}),emits:["update:a","update:d","update:s","update:r"],setup(e){const t=e,i=D(e,"a"),n=D(e,"d"),o=D(e,"s"),s=D(e,"r"),v=L(()=>Le(`
M 0 ${t.height}
l ${t.width/4*i.value/10} ${-t.height}
l ${t.width/4*n.value/10} ${t.height*(1-o.value)}
L ${t.width-t.width/2*(s.value/10)} ${t.height*(1-o.value)}
L ${t.width} ${t.height}
`,2,2).path),r=Y(),h=Y(),C=Y(),S=Y(),d=f(i),y=f(n),b=f(o,.01),w=f(s),x={wheel:{preventWindowScrollY:!0},eventOptions:{capture:!1,passive:!1}};T({onDrag:d,onWheel:d},{...x,domTarget:r}),T({onDrag:y,onWheel:y},{...x,domTarget:h}),T({onDrag:b,onWheel:b},{...x,domTarget:C}),T({onDrag:w,onWheel:w},{...x,domTarget:S});const u=Y(!1);function f(p,F=.1){return function(c){const{delta:[g,k],dragging:$,wheeling:M,shiftKey:N,event:P}=c;if(P&&P.preventDefault(),u.value=$||M,!u.value)return;const A=N?12:P.type==="wheel"?-8:2;let U=k/A-g/A;p.value+=-U*F}}return(p,F)=>(z(),E("svg",{class:"min-w-45 max-w-55 m-1 touch-none",ref:"knob",version:"1.1",baseProfile:"full",viewBox:`${-e.pad} ${-e.pad*2} ${e.width+e.pad*2} ${e.height+e.pad*3}`,xmlns:"http://www.w3.org/2000/svg"},[m("rect",{width:e.width+e.pad*2,height:e.height+e.pad*2,rx:"2",transform:`translate(${-e.pad} ${-e.pad})`,fill:"transparent"},null,8,De),m("text",{"text-anchor":"start","font-size":e.pad*1.4,"dominant-baseline":"middle",fill:"currentColor",transform:`translate(0 ${-e.pad})`},q(e.title),9,Ie),m("g",{class:"numbers","text-anchor":"middle","font-size":"6","dominant-baseline":"middle",fill:"currentColor",transform:`translate(0 ${e.height*.25})`},[m("text",{x:e.width/8},q(i.value.toFixed(2)),9,Te),m("text",{x:3*e.width/8},q(n.value.toFixed(2)),9,Re),m("text",{x:5*e.width/8},q(o.value.toFixed(2)),9,Be),m("text",{x:7*e.width/8},q(s.value.toFixed(2)),9,Ze)],8,Oe),m("g",{class:"titles","text-anchor":"middle","font-size":"6","dominant-baseline":"middle",fill:"currentColor",transform:`translate(0 ${e.height*.75})`},[m("text",{x:e.width/8},"ATT",8,He),m("text",{x:3*e.width/8},"DEC",8,Qe),m("text",{x:5*e.width/8},"SUS",8,Ge),m("text",{x:7*e.width/8},"REL",8,We)],8,je),m("path",{fill:"currentColor","fill-opacity":"0.2",stroke:"currentColor",d:v.value,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":u.value?1:.5},null,8,Ke),m("g",Je,[m("line",{x2:e.width/4,transform:`translate(${0*e.width/4} ${e.height*(1-i.value/10)})`},null,8,_e),m("line",{x2:e.width/4,transform:`translate(${1*e.width/4} ${e.height*(1-n.value/10)})`},null,8,et),m("line",{x2:e.width/4,transform:`translate(${2*e.width/4} ${e.height*(1-o.value)})`},null,8,tt),m("line",{x2:e.width/4,transform:`translate(${3*e.width/4} ${e.height*(1-s.value/10)})`},null,8,nt)]),m("g",at,[m("rect",{ref_key:"attPan",ref:r,width:e.width/4,height:e.height},null,8,st),m("rect",{ref_key:"decPan",ref:h,width:e.width/4,height:e.height,transform:`translate(${e.width/4} 0)`},null,8,it),m("rect",{ref_key:"susPan",ref:C,width:e.width/4,height:e.height,transform:`translate(${e.width/2} 0)`},null,8,ot),m("rect",{ref_key:"relPan",ref:S,width:e.width/4,height:e.height,transform:`translate(${3*e.width/4} 0)`},null,8,rt)])],8,Xe))}},ut=["viewBox"],dt=["x","y","width","height","transform"],ct=["y","font-size"],mt=["y1","x2","y2"],ft=["x1","x2","y2"],ht=["cx","cy","r"],vt=["y","font-size"],xt=["y","font-size"],pt={__name:"ControlXY",props:he({width:{type:Number,default:30},height:{type:Number,default:30},pad:{type:Number,default:3},title:{type:String,default:"Filter XY Pad"},rangeX:{type:Array,default:()=>[20,2e4]},rangeY:{type:Array,default:()=>[0,20]},stepX:{type:Number,default:10},stepY:{type:Number,default:.1}},{x:{type:Number,default:.5},xModifiers:{},y:{type:Number,default:.5},yModifiers:{}}),emits:["update:x","update:y"],setup(e){const t=e,i=D(e,"x"),n=D(e,"y"),o=Y(),s=Y(!1),v=ee(i.value,t.rangeX[0],t.rangeX[1]),r=ee(n.value,t.rangeY[0],t.rangeY[1]),h=L(()=>(v.value-t.rangeX[0])/(t.rangeX[1]-t.rangeX[0])),C=L(()=>1-(r.value-t.rangeY[0])/(t.rangeY[1]-t.rangeY[0])),S=L(()=>Math.round(v.value)),d=L(()=>r.value.toFixed(2)),y=L(()=>h.value*t.width),b=L(()=>C.value*t.height);T({onWheel:x,onDrag:x,onDragStart:()=>s.value=!0,onDragEnd:()=>s.value=!1},{...{drag:{preventWindowScrollY:!0},eventOptions:{capture:!1,passive:!1}},domTarget:o});function x(u){const{delta:f,dragging:p,wheeling:F,shiftKey:V,event:c}=u;if(c&&c.preventDefault(),s.value=p||F,!s.value)return;const g=c.type==="wheel"?-8:2;let k=f[0]/g,$=-f[1]/g;v.value+=k*t.stepX,i.value=v.value,r.value+=$*t.stepY,n.value=r.value}return(u,f)=>(z(),E("svg",{class:"m-1 touch-none",ref_key:"xyPad",ref:o,version:"1.1",baseProfile:"full","text-anchor":"start","font-size":"6","dominant-baseline":"middle",fill:"currentColor",viewBox:`${-e.pad} ${-e.pad} ${e.width+e.pad*2} ${e.height+e.pad*2}`,xmlns:"http://www.w3.org/2000/svg"},[m("rect",{stroke:"currentColor",fill:"transparent","stroke-dasharray":"0.05 1","stroke-linecap":"round","stroke-width":"0.5",x:e.pad,y:e.pad,width:e.width,height:e.height,transform:`translate(${-e.pad} ${-e.pad})`,rx:"3"},null,8,dt),m("text",{x:2,y:-e.pad/2,"font-size":e.pad*1.2,fill:"currentColor"},q(e.title),9,ct),m("line",{x1:0,y1:b.value,x2:e.width,y2:b.value,stroke:"currentColor","stroke-width":"0.5","stroke-dasharray":"0.1 1","stroke-linecap":"round"},null,8,mt),m("line",{x1:y.value,y1:0,x2:y.value,y2:e.height,stroke:"currentColor","stroke-width":"0.5","stroke-dasharray":"0.1 1","stroke-linecap":"round"},null,8,ft),m("circle",{class:"transition",cx:y.value,cy:b.value,r:s.value?2:1,fill:"currentColor"},null,8,ht),m("text",{x:1,y:e.pad+2,"font-size":e.pad*1.2,fill:"currentColor"},"FREQ: "+q(S.value)+" Hz",9,vt),m("text",{x:1,y:3*e.pad+4,"font-size":e.pad*1.2,fill:"currentColor"},"Q: "+q(d.value),9,xt)],8,ut))}},gt=$e(pt,[["__scopeId","data-v-9ff7e7fb"]]),ge=[[1,1,1,1,1,1,1,1],[1,-1,1,-1,1,-1,1,-1],[1,1,-1,-1,1,1,-1,-1],[1,-1,-1,1,1,-1,-1,1],[1,1,1,1,-1,-1,-1,-1],[1,-1,1,-1,-1,1,-1,1],[1,1,-1,-1,-1,-1,1,1],[1,-1,-1,1,-1,1,1,-1]];function J(e,...t){const i=t.length,n=Math.sqrt(1/i),o=t.map(function(s,v){const r=e*((v+1)/i);return a.sdelay({size:r},s)});return ge.map(function(s,v){return a.add(...s.map(function(r,h){return a.mul(r*n,o[h])}))})}function ue(e,t,i,n,o,...s){const v=s.length,r=Math.sqrt(1/v),h=a.mul(o,.02);if(v!==8)throw new Error("Invalid FDN step!");const C=s.map(function(d,y){return a.add(d,a.mul(n,a.smooth(.105,a.tapIn({name:`${e}:fdn${y}`}))))});return ge.map(function(d,y){return a.add(...d.map(function(b,w){return a.mul(b*r,C[w])}))}).map(function(d,y){const b=(f,p,F)=>a.add(f,a.mul(F,a.cycle(p))),w=f=>t*(f/1e3),x=a.mul(a.add(1,a.mul(3,i)),w((y+1)*17)),u=b(x,a.add(.1,a.mul(y,h)),w(2.5));return a.tapOut({name:`${e}:fdn${y}`},a.delay({size:w(750)},u,0,d))})}function yt(e,t,i){const n=e.key,o=e.sampleRate,s=a.sm(e.size),v=a.sm(e.decay),r=a.sm(e.mod),h=a.sm(e.mix),C=a.mul(.5,a.add(t,i)),S=a.mul(.5,a.sub(t,i)),d=[t,i,C,S],y=[...d,...d.map(c=>a.mul(-1,c))],b=c=>o*(c/1e3),w=J(b(43),...y),x=J(b(97),...w),u=J(b(117),...x),f=ue(`${n}:d4`,o,s,.004,r,...u),p=ue(`${n}:r0`,o,s,v,r,...f),F=a.mul(.25,a.add(p[0],p[2],p[4],p[6])),V=a.mul(.25,a.add(p[1],p[3],p[5],p[7]));return[a.select(h,F,t),a.select(h,V,i)]}function kt(e=12){const{audio:t}=me(),i=Me(Array(e).fill(null).map(()=>bt())),n=Y(0);Z(()=>t.initiated,r=>wt(r,t,i),{immediate:!0});function o(r,h){if(h>0){const C=$t(i,n);j(i,C,{gate:1,midi:r,vel:h})}else Mt(i,r)}function s(){i.forEach((r,h)=>j(i,h,{gate:0}))}function v(r,h){return a.meter({name:`synth-voice-${r}-${h}`},i[r][h].ref||a.const({value:i[r][h].value}))}return{voiceRefs:i,updateVoice:(r,h)=>j(i,r,h),getVoiceParam:v,cycleNote:o,stopAll:s}}function bt(){return{gate:{value:0,ref:null,setter:null},midi:{value:0,ref:null,setter:null},vel:{value:0,ref:null,setter:null}}}function wt(e,t,i){e&&i.forEach(n=>{["gate","midi","vel"].forEach(o=>{const[s,v]=t.core.createRef("const",{value:n[o].value},[]);n[o].ref=s,n[o].setter=v})})}function $t(e,t){const i=t.value;let n=i;do{if(e[n].gate.value===0)return t.value=(n+1)%e.length,n;n=(n+1)%e.length}while(n!==i);return t.value=(i+1)%e.length,i}function j(e,t,i){const n=e[t];Object.entries(i).forEach(([o,s])=>{var v,r;o in n&&s!==void 0&&(n[o].value=s,(r=(v=n[o]).setter)==null||r.call(v,{value:s}))})}function Mt(e,t){e.forEach((i,n)=>{i.midi.value===t&&j(e,n,{gate:0})})}const de={"osc:on":{value:1,min:0,max:1,step:1,hidden:!0},"osc:gain":{value:.8,min:0,max:2,step:.01},"osc:shape":{value:.2,min:0,max:1,step:.01},"osc:cut-off":{value:200,min:10,max:2e4,step:1,hidden:!0},"osc:cut-q":{value:1.1,min:0,max:5,step:.1,hidden:!0},"osc:attack":{value:1,min:.01,max:10,step:.01,hidden:!0},"osc:decay":{value:1,min:.1,max:10,step:.1,hidden:!0},"osc:sustain":{value:.5,min:0,max:1,step:.01,hidden:!0},"osc:release":{value:1,min:.1,max:10,step:.1,hidden:!0},"osc:f-env":{value:.5,min:0,max:1,step:.01},"osc:f-attack":{value:1,min:.01,max:10,step:.01,hidden:!0},"osc:f-decay":{value:1,min:.1,max:10,step:.1,hidden:!0},"osc:f-sustain":{value:.5,min:0,max:1,step:.01,hidden:!0},"osc:f-release":{value:1,min:.01,max:10,step:.1,hidden:!0},"noise:on":{value:1,min:0,max:1,step:1,hidden:!0},"noise:gain":{value:.5,min:0,max:2,step:.01},"noise:color":{value:0,min:0,max:1,step:.01},"noise:band-q":{value:5,min:0,max:10,step:.1},"noise:cut-off":{value:300,min:10,max:2e4,step:1,hidden:!0},"noise:cut-q":{value:1.1,min:0,max:5,step:.1,hidden:!0},"noise:attack":{value:1,min:.01,max:10,step:.01,hidden:!0},"noise:decay":{value:1,min:.1,max:10,step:.1,hidden:!0},"noise:sustain":{value:.5,min:0,max:1,step:.01,hidden:!0},"noise:release":{value:1,min:.1,max:10,step:.1,hidden:!0},"noise:f-env":{value:.5,min:0,max:1,step:.01},"noise:f-attack":{value:1,min:.01,max:10,step:.01,hidden:!0},"noise:f-decay":{value:1,min:.001,max:10,step:.01,hidden:!0},"noise:f-sustain":{value:.5,min:0,max:1,step:.01,hidden:!0},"noise:f-release":{value:1,min:.001,max:10,step:.01,hidden:!0},"string:on":{value:1,min:0,max:1,step:1,hidden:!0},"string:gain":{value:.8,min:0,max:2,step:.01},"string:noise":{value:.95,min:0,max:2,step:.001},"string:q":{value:1,min:0,max:50,step:.1},"string:cut-off":{value:300,min:10,max:2e4,step:1,hidden:!0},"string:cut-q":{value:1.1,min:0,max:5,step:.1,hidden:!0},"string:feedback":{value:.95,min:.8,max:.99,step:.001},"string:attack":{value:1,min:.01,max:10,step:.01,hidden:!0},"string:decay":{value:1,min:.1,max:10,step:.1,hidden:!0},"string:sustain":{value:.5,min:0,max:1,step:.01,hidden:!0},"string:release":{value:1,min:.1,max:10,step:.1,hidden:!0},"string:f-env":{value:.5,min:0,max:1,step:.01},"string:f-attack":{value:1,min:.01,max:10,step:.01,hidden:!0},"string:f-decay":{value:1,min:.001,max:10,step:.01,hidden:!0},"string:f-sustain":{value:.5,min:0,max:1,step:.01,hidden:!0},"string:f-release":{value:1,min:.001,max:10,step:.01,hidden:!0},"sample:on":{value:0,min:0,max:1,step:1,hidden:!0},"sample:gain":{value:.4,min:0,max:2,step:.01},"sample:attack":{value:1,min:.01,max:10,step:.01,hidden:!0},"sample:decay":{value:1,min:.1,max:10,step:.1,hidden:!0},"sample:sustain":{value:.5,min:0,max:1,step:.01,hidden:!0},"sample:release":{value:1,min:.1,max:10,step:.1,hidden:!0},"ping-pong:on":{value:1,min:0,max:1,step:1,hidden:!0},"ping-pong:gain":{value:.1,min:0,max:1,step:.01},"ping-pong:feedback":{value:.1,min:0,max:1,step:.01},"ping-pong:shift":{value:.4,min:0,max:1,step:.01},"fx:bpm":{value:120,min:10,max:500,step:1,hidden:!0},"reverb:on":{value:1,min:0,max:1,step:1,hidden:!0},"reverb:size":{value:.2,min:0,max:1,step:.01},"reverb:decay":{value:.5,min:0,max:1,step:.01},"reverb:mod":{value:.5,min:0,max:1,step:.01},"reverb:mix":{value:.5,min:0,max:1,step:.01}},ce=Ce("el-synth-enabled",!0);function Ct(e=12){const{audio:t,render:i,meters:n}=me(),{controls:o,cv:s,groups:v}=ye(de,"ref"),{voiceRefs:r,cycleNote:h,stopAll:C,getVoiceParam:S}=kt();Z(()=>t.initiated,async c=>{c&&(await x(),ke.synth={volume:1,signal:b()})},{immediate:!0});const d=be();Z(()=>d.bpm,c=>o["fx:bpm"]=c,{immediate:!0});const{midi:y}=fe();Z(()=>y.note,c=>{ce.value&&h(c.number,c.velocity)});function b(){var $;const c=a.scope({name:"synth",size:512},a.tanh(a.mul(a.sqrt(a.div(1,a.const({key:"voice-count",value:r.length}))),a.add(...r.map((M,N)=>w(N)))))),g=V(c);return yt({key:"srvb",sampleRate:(($=n["main:sample-rate"])==null?void 0:$.max)||44100,size:s["reverb:size"],decay:s["reverb:decay"],mod:s["reverb:mod"],mix:a.mul(s["reverb:mix"],s["reverb:on"])},...g)}function w(c){const g=S(c,"gate"),k=S(c,"midi"),$=S(c,"vel"),M=a.div($,127),N=f(g,k,M),P=F(g,k,M),A=p(g,k,M),U=u(g,k,M);return a.scope({name:`synth-voice-${c}`,size:1024},a.add(N,P,A,U))}async function x(){let c=await fetch("/audio/piano/A4.mp3"),g=await t.ctx.decodeAudioData(await c.arrayBuffer());t.core.updateVirtualFileSystem({piano:g.getChannelData(0)})}function u(c,g,k){const $=a.adsr(a.div(a.mul(15,s["sample:attack"]),s["fx:bpm"]),a.div(a.mul(15,s["sample:decay"]),s["fx:bpm"]),s["sample:sustain"],a.div(a.mul(15,s["sample:release"]),s["fx:bpm"]),c),M=a.sample({path:"piano"},c,a.div(R(g),440)),N=a.mul(M,k,$,s["sample:on"],s["sample:gain"]);return a.mul(48,a.compress(10,100,-48,2,N,N))}function f(c,g,k){const $=a.blepsquare(R(g)),M=a.blepsaw(R(g)),N=a.adsr(a.div(a.mul(15,s["osc:attack"]),s["fx:bpm"]),a.div(a.mul(15,s["osc:decay"]),s["fx:bpm"]),s["osc:sustain"],a.div(a.mul(15,s["osc:release"]),s["fx:bpm"]),c),P=a.adsr(a.div(a.mul(15,s["osc:f-attack"]),s["fx:bpm"]),a.div(a.mul(15,s["osc:f-decay"]),s["fx:bpm"]),s["osc:f-sustain"],a.div(a.mul(15,s["osc:f-release"]),s["fx:bpm"]),c),A=a.cos(a.mul(s["osc:shape"],Math.PI/2)),U=a.sin(a.mul(s["osc:shape"],Math.PI/2)),I=a.add(a.mul(A,$),a.mul(U,M)),O=a.add(s["osc:cut-off"],a.mul(a.mul(s["osc:f-env"],2e4),P)),H=a.lowpass(a.max(20,a.min(2e4,O)),s["osc:cut-q"],I);return a.tanh(a.mul(s["osc:on"],s["osc:gain"],N,k,H))}function p(c,g,k){let $=a.mul(440,a.pow(2,a.div(a.sub(g,69),12))),M=a.div(a.sr(),$),N=a.adsr(s["string:attack"],s["string:decay"],s["string:sustain"],s["string:release"],c),P=a.mul(N,a.noise(),s["string:noise"]),A=a.bandpass($,s["string:q"],P);const U=a.adsr(a.div(a.mul(15,s["string:f-attack"]),s["fx:bpm"]),a.div(a.mul(15,s["string:f-decay"]),s["fx:bpm"]),s["string:f-sustain"],a.div(a.mul(15,s["string:f-release"]),s["fx:bpm"]),c),I=a.add(s["string:cut-off"],a.mul(a.mul(s["string:f-env"],2e4),U)),O=a.lowpass(a.max(20,a.min(2e4,I)),s["string:cut-q"],A);let H=a.delay({size:44100},M,s["string:feedback"],O);return a.mul(s["string:on"],s["string:gain"],k,a.tanh(H))}function F(c,g,k){const $=a.adsr(a.div(a.mul(15,s["noise:attack"]),s["fx:bpm"]),a.div(a.mul(15,s["noise:decay"]),s["fx:bpm"]),s["noise:sustain"],a.div(a.mul(15,s["noise:release"]),s["fx:bpm"]),c),M=a.adsr(a.div(a.mul(15,s["noise:f-attack"]),s["fx:bpm"]),a.div(a.mul(15,s["noise:f-decay"]),s["fx:bpm"]),s["noise:f-sustain"],a.div(a.mul(15,s["noise:f-release"]),s["fx:bpm"]),c),N=a.cos(a.mul(s["noise:color"],Math.PI/2)),P=a.sin(a.mul(s["noise:color"],Math.PI/2)),A=a.add(a.mul(N,a.noise()),a.mul(P,a.pinknoise())),U=a.bandpass(R(g),s["noise:band-q"],A),I=a.add(s["noise:cut-off"],a.mul(a.mul(s["noise:f-env"],2e4),M)),O=a.lowpass(a.max(20,a.min(2e4,I)),s["noise:cut-q"],U);return a.tanh(a.mul(s["noise:on"],s["noise:gain"],k,$,O))}function V(c,g){return[0,1].map(k=>a.add(c,a.mul(s["ping-pong:on"],s["ping-pong:gain"],a.delay({size:44100},a.ms2samps(a.mul(a.div(6e4,s["fx:bpm"]),a.add(1,a.mul(k===0?-.5:.5,s["ping-pong:shift"])))),s["ping-pong:feedback"],c))))}return{params:de,controls:o,cv:s,groups:v,audio:t,render:i,voiceRefs:r,cycleNote:h,stopAll:C,synthEnabled:ce}}const Ft={class:"flex flex-wrap gap-4 relative p-4"},Nt={class:"flex is-group p-2 items-center"},St={class:"text-button"},zt={class:"flex flex-wrap gap-2 items-center"},Et={class:"text-sm uppercase absolute -top-4 bg-light-300 dark-bg-dark-300 p-1 rounded"},Pt=["onClick"],At={key:0,class:"p-0 flex h-30",style:{order:"5",flex:"10"}},qt={key:1,class:"p-0 flex",style:{order:"5",flex:"10"}},Ut={key:2,class:"p-0",style:{order:"20",flex:"10"}},Xt={__name:"ElemSynth",setup(e){const{controls:t,groups:i,voiceRefs:n,stopAll:o,cycleNote:s,synthEnabled:v,params:r}=Ct();Fe("Escape",()=>{o()});const{midi:h,activeNotes:C}=fe();return(S,d)=>{const y=we,b=gt,w=lt;return z(),E("div",Ft,[m("div",Nt,[m("button",{class:ne(["text-button",{active:l(v)}]),onClick:d[0]||(d[0]=x=>v.value=!l(v))},d[9]||(d[9]=[m("div",{class:"i-la-power-off"},null,-1)]),2),m("button",{class:"text-button",style:Q({backgroundColor:l(te)(l(X).tonic,5)}),onMousedownPassive:d[1]||(d[1]=x=>l(s)(57+l(X).tonic+12*l(h).offset,120)),onMouseupPassive:d[2]||(d[2]=x=>l(s)(57+l(X).tonic+12*l(h).offset)),onTouchstart:d[3]||(d[3]=ae(x=>l(s)(57+l(X).tonic+12*l(h).offset,120),["prevent","stop"])),onTouchend:d[4]||(d[4]=ae(x=>l(s)(57+l(X).tonic+12*l(h).offset),["prevent","stop"])),onMouseleave:d[5]||(d[5]=x=>l(s)(57+l(X).tonic+12*l(h).offset))},d[10]||(d[10]=[m("div",{class:"i-la-check"},null,-1)]),36),m("button",{class:"text-button",onClick:d[6]||(d[6]=x=>l(h).offset--)},d[11]||(d[11]=[m("div",{class:"i-la-minus"},null,-1)])),m("div",St,q(l(h).offset),1),m("button",{class:"text-button",onClick:d[7]||(d[7]=x=>l(h).offset++)},d[12]||(d[12]=[m("div",{class:"i-la-plus"},null,-1)])),m("button",{class:"text-button",onClick:d[8]||(d[8]=x=>l(o)())},d[13]||(d[13]=[m("div",{class:"i-la-times"},null,-1)]))]),m("div",zt,[(z(!0),E(G,null,W(l(n),x=>(z(),E("div",{class:"p-2 flex-1 rounded-xl",key:x,style:Q({backgroundColor:l(te)(x.midi.value-9,3,void 0,x.gate.value?1:.1)})},null,4))),128))]),(z(!0),E(G,null,W(l(i),(x,u)=>(z(),E("div",{class:"flex flex-wrap is-group p-2 relative items-center",key:x},[m("div",Et,q(u),1),m("button",{class:ne(["text-button",{active:l(t)[`${u}:on`]==1}]),onClick:f=>l(t)[`${u}:on`]==1?l(t)[`${u}:on`]=0:l(t)[`${u}:on`]=1},d[14]||(d[14]=[m("div",{class:"i-la-power-off"},null,-1)]),10,Pt),(z(!0),E(G,null,W(x,(f,p)=>(z(),E("div",{class:"p-0 flex items-center flex-1 justify-center",key:p,style:Q({order:p=="f-env"?20:1})},[B(y,{modelValue:l(t)[`${u}:${p}`],"onUpdate:modelValue":F=>l(t)[`${u}:${p}`]=F,min:f.min,max:f.max,step:f.step,param:p,interpolation:p=="cut-off"?"log2":"linear"},null,8,["modelValue","onUpdate:modelValue","min","max","step","param","interpolation"])],4))),128)),["osc","noise","string"].includes(u)?(z(),E("div",At,[B(b,{class:"w-25",x:l(t)[`${u}:cut-off`],"onUpdate:x":f=>l(t)[`${u}:cut-off`]=f,rangeX:[l(r)[`${u}:cut-off`].min,l(r)[`${u}:cut-off`].max],stepX:50,y:l(t)[`${u}:cut-q`],"onUpdate:y":f=>l(t)[`${u}:cut-q`]=f,rangeY:[l(r)[`${u}:cut-q`].min,l(r)[`${u}:cut-q`].max],stepY:.01},null,8,["x","onUpdate:x","rangeX","y","onUpdate:y","rangeY"])])):K("",!0),["osc","noise","string","sample"].includes(u)?(z(),E("div",qt,[B(w,{class:"bg-light-400 dark-bg-dark-400 bg-op-30 dark-bg-op-30 rounded-lg",title:"Amplitude Envelope",a:l(t)[`${u}:attack`],"onUpdate:a":f=>l(t)[`${u}:attack`]=f,d:l(t)[`${u}:decay`],"onUpdate:d":f=>l(t)[`${u}:decay`]=f,s:l(t)[`${u}:sustain`],"onUpdate:s":f=>l(t)[`${u}:sustain`]=f,r:l(t)[`${u}:release`],"onUpdate:r":f=>l(t)[`${u}:release`]=f},null,8,["a","onUpdate:a","d","onUpdate:d","s","onUpdate:s","r","onUpdate:r"])])):K("",!0),u=="osc"||u=="noise"||u=="string"?(z(),E("div",Ut,[B(w,{class:"bg-light-400 dark-bg-dark-400 bg-op-30 dark-bg-op-30 rounded-lg",title:"Filter Envelope",a:l(t)[`${u}:f-attack`],"onUpdate:a":f=>l(t)[`${u}:f-attack`]=f,d:l(t)[`${u}:f-decay`],"onUpdate:d":f=>l(t)[`${u}:f-decay`]=f,s:l(t)[`${u}:f-sustain`],"onUpdate:s":f=>l(t)[`${u}:f-sustain`]=f,r:l(t)[`${u}:f-release`],"onUpdate:r":f=>l(t)[`${u}:f-release`]=f},null,8,["a","onUpdate:a","d","onUpdate:d","s","onUpdate:s","r","onUpdate:r"])])):K("",!0)]))),128))])}}};export{Xt as default};
