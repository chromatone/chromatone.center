import{G as ht,u as T,bb as dt,bc as _t,av as gt,bd as mt}from"./theme.C1cSeBFq.js";import{v as p,x as b,z as l,Q as pt,u as _,i as bt,G as P,F as G,A as H,E as $,D as O,a as E,d as ft,w as vt}from"./framework.BMHKg3V0.js";class I{constructor(t,e,n,a=t<<16|e<<8|n){this._count=1,this.__saturation=-1,this.__hue=-1,this.__lightness=-1,this.__intensity=-1,this._red=t,this._green=e,this._blue=n,this._hex=a}static distance(t,e){return(Math.abs(e._red-t._red)+Math.abs(e._green-t._green)+Math.abs(e._blue-t._blue))/(3*255)}clone(){const t=new I(this._red,this._green,this._blue,this._hex);return t._count=this._count,t}updateHSL(){const t=this._red/255,e=this._green/255,n=this._blue/255,a=Math.max(t,e,n),o=Math.min(t,e,n);if(this.__lightness=(a+o)/2,a===o)this.__hue=0,this.__saturation=0,this.__intensity=0;else{const r=a-o;switch(this.__saturation=this.__lightness>.5?r/(2-a-o):r/(a+o),this.__intensity=this.__saturation*((.5-Math.abs(.5-this.__lightness))*2),a){case t:this.__hue=((e-n)/r+(e<n?6:0))/6;break;case e:this.__hue=((n-t)/r+2)/6;break;case n:this.__hue=((t-e)/r+4)/6;break}}}get _hue(){return this.__hue===-1&&this.updateHSL(),this.__hue}get _saturation(){return this.__saturation===-1&&this.updateHSL(),this.__saturation}get _lightness(){return this.__lightness===-1&&this.updateHSL(),this.__lightness}get _intensity(){return this.__intensity===-1&&this.updateHSL(),this.__intensity}}const F=(s,t)=>Math.abs(s-t),xt=(s,t)=>Math.min(F(s,t),F((s+.5)%1,(t+.5)%1));class wt{constructor(){this.colors=[],this._average=null}addColor(t){this.colors.push(t),this._average=null}isSamePalette(t,e,n,a){for(let o=0;o<this.colors.length;o++){const r=this.colors[o];if(!(xt(r._hue,t._hue)<e&&F(r._saturation,t._saturation)<n&&F(r._lightness,t._lightness)<a))return!1}return!0}get average(){if(!this._average){const{r:t,g:e,b:n}=this.colors.reduce((o,r)=>(o.r+=r._red,o.g+=r._green,o.b+=r._blue,o),{r:0,g:0,b:0}),a=this.colors.reduce((o,r)=>o+r._count,0);this._average=new I(Math.round(t/this.colors.length),Math.round(e/this.colors.length),Math.round(n/this.colors.length)),this._average._count=a}return this._average}}class yt{constructor(t,e,n){this._groups=[],this._hue=t,this._saturation=e,this._lightness=n}addColor(t){const e=this._groups.find(n=>n.isSamePalette(t,this._hue,this._saturation,this._lightness));if(e)e.addColor(t);else{const n=new wt;n.addColor(t),this._groups.push(n)}}getGroups(){return this._groups.map(t=>t.average)}}const Ct=(s,t,e,n,a)=>{const o=new yt(e,n,a);s.forEach(c=>o.addColor(c));const r=o.getGroups();return r.sort((c,g)=>{const u=(g._intensity+.1)*(.9-g._count/t),m=(c._intensity+.1)*(.9-c._count/t);return u-m}),r},Mt=(s,t)=>({hex:`#${"0".repeat(6-s._hex.toString(16).length)}${s._hex.toString(16)}`,red:s._red,green:s._green,blue:s._blue,area:s._count/t,hue:s._hue,saturation:s._saturation,lightness:s._lightness,intensity:s._intensity}),B=({pixels:s=64e3,distance:t=.22,colorValidator:e=(c,g,u,m)=>(m??255)>250,hueDistance:n=.08333333333333333,saturationDistance:a=.2,lightnessDistance:o=.2,crossOrigin:r=null}={})=>[Math.max(s,1),Math.min(Math.max(t,0),1),e,Math.min(Math.max(n,0),1),Math.min(Math.max(a,0),1),Math.min(Math.max(o,0),1),r];class Dt{constructor(){this._count=0,this._children={}}addColor(t,e,n,a){return this._count++,this._children[t]?this._children[t]._count++:this._children[t]=new I(e,n,a,t),this._children[t]}getList(){return Object.keys(this._children).map(t=>this._children[t])}createMainColor(){const n=this.getList().reduce((a,o)=>a._count>=o._count?a:o).clone();return n._count=this._count,n}}class Lt{constructor(){this._count=0,this._children={}}getList(){return Object.keys(this._children).map(t=>this._children[t])}addColor(t,e,n){const a=t<<16|e<<8|n,o=(t>>4&15)<<8|(e>>4&15)<<4|n>>4&15;return this._count++,this.getLeafGroup(o).addColor(a,t,e,n)}getLeafGroup(t){return this._children[t]||(this._children[t]=new Dt),this._children[t]}getColors(t){const e=this.getList().map(a=>a.createMainColor());e.sort((a,o)=>o._count-a._count);const n=[];for(;e.length;){const a=e.shift();e.filter(o=>I.distance(a,o)<t).forEach(o=>{a._count+=o._count;const r=e.findIndex(c=>c===o);e.splice(r,1)}),n.push(a)}return n}}const z=({data:s,width:t,height:e},n,a,o)=>{const r=new Lt,c=t&&e&&Math.floor(t*e/n)||1;let g=0;for(let u=0;u<s.length;u+=4*c){const m=s[u],f=s[u+1],k=s[u+2],v=s[u+3];o(m,f,k,v)?r.addColor(m,f,k):g++}return{colors:r.getColors(a),count:r._count+g}},V=()=>typeof window<"u",Q=(s,t,e,n,a)=>Ct(s,t,e,n,a).map(r=>Mt(r,t)),kt=(s,t)=>{const e=s.width*s.height,n=e<t?s.width:Math.round(s.width*Math.sqrt(t/e)),a=e<t?s.height:Math.round(s.height*Math.sqrt(t/e)),o=document.createElement("canvas");o.width=n,o.height=a;const r=o.getContext("2d");return r.drawImage(s,0,0,s.width,s.height,0,0,n,a),r.getImageData(0,0,n,a)},q=(s,t={})=>{const[e,n,a,o,r,c]=B(t),{colors:g,count:u}=z(s,e,n,a);return Q(g,u,o,r,c)},X=(s,t={})=>{if(V()){const[e,n,a,o,r,c,g]=B(t);return s.crossOrigin=g,new Promise(u=>{const m=f=>{const k=kt(f,e),{colors:v,count:R}=z(k,e,n,a);u(Q(v,R,o,r,c))};if(s.complete)m(s);else{const f=()=>{s.removeEventListener("load",f),m(s)};s.addEventListener("load",f)}})}},St=(s,t={})=>{if(V()){const e=new Image;return e.src=s,X(e,t)}},Ut=(s,t)=>{if(V()){if(s instanceof Image)return X(s,t);if(s instanceof ImageData||s instanceof Object&&s.data)return new Promise(e=>{e(q(s,t))});if(typeof s=="string")return St(s,t)}else return new Promise(e=>{e(q(s,t))});throw new Error("Can not analyse picture")},It={class:"container mx-auto p-4"},Pt={class:"mb-4 flex items-center flex-wrap gap-4"},Et={key:0,class:"mt-4"},Ft=["src"],Rt={key:1,class:"mt-4"},Gt={key:2,class:"mt-4"},Ht={class:"flex flex-wrap gap-4"},Ot={class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover-opacity-100 transition-opacity"},Vt=["onClick"],jt={class:"bg-white bg-opacity-75 p-1 text-xs"},At={class:"mt-8"},Nt={class:"flex gap-2 mb-4"},Tt=["disabled"],$t=["disabled"],qt={class:"flex flex-wrap"},Bt={class:"flex items-center gap-4 h-32"},zt=["src"],Qt={class:"flex flex-wrap gap-1 z-10"},Xt={class:"text-sm text-gray-500"},Yt={__name:"ExtractColors",setup(s){const t=(d=7)=>{const i=E(null),M=E([]),h=E([]),x=E(!1),y=T("color-extracts",d),D=T("color-palettes",[]),{history:tt,undo:et,redo:st,canUndo:nt,canRedo:ot}=dt(D,{deep:!0,debounce:1e3}),at=async(w,C=32)=>new Promise(U=>{const A=new FileReader;A.onload=ct=>{const L=new Image;L.onload=()=>{const S=document.createElement("canvas"),ut=S.getContext("2d"),N=C/Math.max(L.width,L.height);S.width=Math.min(C,L.width*N),S.height=Math.min(C,L.height*N),ut.drawImage(L,0,0,S.width,S.height),U(S.toDataURL("image/jpeg",.7))},L.src=ct.target.result},A.readAsDataURL(w)}),rt=async w=>{if(!w)return;x.value=!0,i.value=URL.createObjectURL(w);const C=await at(w);try{h.value=await Ut(i.value,{pixels:64e3,distance:.12,saturationDistance:.2,lightnessDistance:.2,hueDistance:.1}),j();const U={colors:M.value,timestamp:Date.now(),amount:y.value,thumbnail:C};D.value.unshift(U)}catch(U){console.error("Error extracting colors:",U)}finally{x.value=!1}},j=()=>{M.value=h.value.slice(0,y.value)},it=mt(()=>{var C;j();const w={colors:M.value,timestamp:Date.now(),amount:y.value,thumbnail:(C=D.value[0])==null?void 0:C.thumbnail};D.value.unshift(w)},300),lt=ft(()=>M.value.map(w=>({backgroundColor:w.hex})));return vt(y,()=>{h.value.length>0&&it()}),{imageUrl:i,colors:M,isLoading:x,extractColorsFromImage:rt,colorStyles:lt,storedPalettes:D,history:tt,undo:et,redo:st,canUndo:nt,canRedo:ot,amount:y}},{imageUrl:e,colors:n,isLoading:a,extractColorsFromImage:o,colorStyles:r,storedPalettes:c,history:g,undo:u,redo:m,canUndo:f,canRedo:k,amount:v}=t(),R=d=>{const i=d.target.files[0];i&&o(i)};function J(){c.value=[]}const{copy:K,copied:Jt}=ht(),W=d=>_t(d).value,Y=()=>{if(u(),c.value.length>0){const d=c.value[0];n.value=d.colors,v.value=d.amount}},Z=()=>{if(m(),c.value.length>0){const d=c.value[0];n.value=d.colors,v.value=d.amount}};return(d,i)=>{const M=gt;return p(),b("div",It,[l("div",Pt,[i[1]||(i[1]=l("label",{class:"block mb-2",for:"imageUpload"},"Upload an image",-1)),l("input",{class:"hidden",id:"imageUpload",type:"file",accept:"image/*",onChange:R},null,32),i[2]||(i[2]=l("label",{class:"bg-blue-500 hover-bg-blue-600 text-white font-bold py-2 px-4 rounded cursor-pointer",for:"imageUpload"},"Select Image",-1)),i[3]||(i[3]=l("div",{class:"mt-4 space-y-4"},null,-1)),pt(M,{modelValue:_(v),"onUpdate:modelValue":i[0]||(i[0]=h=>bt(v)?v.value=h:null),min:2,max:12,step:1,param:"COLORS",fixed:0},null,8,["modelValue"])]),_(e)?(p(),b("div",Et,[l("img",{class:"max-w-100 h-auto rounded shadow-lg",src:_(e),alt:"Uploaded image"},null,8,Ft)])):P("",!0),_(a)?(p(),b("div",Rt,i[4]||(i[4]=[l("p",{class:"text-gray-600"},"Extracting colors...",-1)]))):P("",!0),_(n).length?(p(),b("div",Gt,[i[5]||(i[5]=l("h2",{class:"text-xl font-bold mb-2"},"Extracted Colors",-1)),l("div",Ht,[(p(!0),b(G,null,H(_(r),(h,x)=>(p(),b("div",{class:"w-24 h-24 rounded shadow-md relative group",key:x,style:$(h)},[l("div",Ot,[l("button",{class:"text-white bg-gray-800 px-2 py-1 rounded",onClick:y=>_(K)(_(n)[x].hex)},"Copy HEX",8,Vt)]),l("div",jt,O(_(n)[x].hex),1)],4))),128))])])):P("",!0),l("div",At,[i[6]||(i[6]=l("h2",{class:"text-xl font-bold mb-2"},"Color Palette History",-1)),l("div",Nt,[l("button",{class:"bg-blue-500 hover-bg-blue-600 text-white font-bold py-1 px-3 rounded",disabled:!_(f),onClick:Y},"Undo",8,Tt),l("button",{class:"bg-blue-500 hover-bg-blue-600 text-white font-bold py-1 px-3 rounded",disabled:!_(k),onClick:Z},"Redo",8,$t),l("button",{class:"bg-red-500 hover-bg-blue-600 text-white font-bold py-1 px-3 rounded",onClick:J},"Clear")]),l("div",qt,[(p(!0),b(G,null,H(_(c),(h,x)=>(p(),b("div",{class:"flex flex-col gap-2",key:x},[l("div",Bt,[h.thumbnail?(p(),b("img",{key:0,class:"max-w-16 max-h-16 blur-2px object-cover rounded",src:h.thumbnail,alt:"Palette thumbnail"},null,8,zt)):P("",!0),l("div",Qt,[(p(!0),b(G,null,H(h.colors,(y,D)=>(p(),b("div",{class:"p-4 rounded shadow-sm",key:D,style:$({backgroundColor:y.hex})},null,4))),128))])]),l("div",Xt,O(W(h.timestamp))+" - Amount: "+O(h.amount),1)]))),128))])])])}}};export{Yt as default};
