import{ar as ut}from"./theme.t-3cbqQx.js";import{af as dt,f as m,g as p,h as i,V as _t,l as d,$ as gt,q as P,F as G,j as V,p as $,m as j,r as E,u as q,aT as mt,c as pt,d as ft,ad as bt,aU as vt}from"./framework.B7TlvOs3.js";class I{constructor(t,e,o,a=t<<16|e<<8|o){this._count=1,this.__saturation=-1,this.__hue=-1,this.__lightness=-1,this.__intensity=-1,this._red=t,this._green=e,this._blue=o,this._hex=a}static distance(t,e){return(Math.abs(e._red-t._red)+Math.abs(e._green-t._green)+Math.abs(e._blue-t._blue))/(3*255)}clone(){const t=new I(this._red,this._green,this._blue,this._hex);return t._count=this._count,t}updateHSL(){const t=this._red/255,e=this._green/255,o=this._blue/255,a=Math.max(t,e,o),n=Math.min(t,e,o);if(this.__lightness=(a+n)/2,a===n)this.__hue=0,this.__saturation=0,this.__intensity=0;else{const r=a-n;switch(this.__saturation=this.__lightness>.5?r/(2-a-n):r/(a+n),this.__intensity=this.__saturation*((.5-Math.abs(.5-this.__lightness))*2),a){case t:this.__hue=((e-o)/r+(e<o?6:0))/6;break;case e:this.__hue=((o-t)/r+2)/6;break;case o:this.__hue=((t-e)/r+4)/6;break}}}get _hue(){return this.__hue===-1&&this.updateHSL(),this.__hue}get _saturation(){return this.__saturation===-1&&this.updateHSL(),this.__saturation}get _lightness(){return this.__lightness===-1&&this.updateHSL(),this.__lightness}get _intensity(){return this.__intensity===-1&&this.updateHSL(),this.__intensity}}const F=(s,t)=>Math.abs(s-t),xt=(s,t)=>Math.min(F(s,t),F((s+.5)%1,(t+.5)%1));class wt{constructor(){this.colors=[],this._average=null}addColor(t){this.colors.push(t),this._average=null}isSamePalette(t,e,o,a){for(let n=0;n<this.colors.length;n++){const r=this.colors[n];if(!(xt(r._hue,t._hue)<e&&F(r._saturation,t._saturation)<o&&F(r._lightness,t._lightness)<a))return!1}return!0}get average(){if(!this._average){const{r:t,g:e,b:o}=this.colors.reduce((n,r)=>(n.r+=r._red,n.g+=r._green,n.b+=r._blue,n),{r:0,g:0,b:0}),a=this.colors.reduce((n,r)=>n+r._count,0);this._average=new I(Math.round(t/this.colors.length),Math.round(e/this.colors.length),Math.round(o/this.colors.length)),this._average._count=a}return this._average}}class yt{constructor(t,e,o){this._groups=[],this._hue=t,this._saturation=e,this._lightness=o}addColor(t){const e=this._groups.find(o=>o.isSamePalette(t,this._hue,this._saturation,this._lightness));if(e)e.addColor(t);else{const o=new wt;o.addColor(t),this._groups.push(o)}}getGroups(){return this._groups.map(t=>t.average)}}const Ct=(s,t,e,o,a)=>{const n=new yt(e,o,a);s.forEach(c=>n.addColor(c));const r=n.getGroups();return r.sort((c,_)=>{const l=(_._intensity+.1)*(.9-_._count/t),g=(c._intensity+.1)*(.9-c._count/t);return l-g}),r},Mt=(s,t)=>({hex:`#${"0".repeat(6-s._hex.toString(16).length)}${s._hex.toString(16)}`,red:s._red,green:s._green,blue:s._blue,area:s._count/t,hue:s._hue,saturation:s._saturation,lightness:s._lightness,intensity:s._intensity}),B=({pixels:s=64e3,distance:t=.22,colorValidator:e=(c,_,l,g)=>(g??255)>250,hueDistance:o=.08333333333333333,saturationDistance:a=.2,lightnessDistance:n=.2,crossOrigin:r=null}={})=>[Math.max(s,1),Math.min(Math.max(t,0),1),e,Math.min(Math.max(o,0),1),Math.min(Math.max(a,0),1),Math.min(Math.max(n,0),1),r];class Dt{constructor(){this._count=0,this._children={}}addColor(t,e,o,a){return this._count++,this._children[t]?this._children[t]._count++:this._children[t]=new I(e,o,a,t),this._children[t]}getList(){return Object.keys(this._children).map(t=>this._children[t])}createMainColor(){const o=this.getList().reduce((a,n)=>a._count>=n._count?a:n).clone();return o._count=this._count,o}}class Lt{constructor(){this._count=0,this._children={}}getList(){return Object.keys(this._children).map(t=>this._children[t])}addColor(t,e,o){const a=t<<16|e<<8|o,n=(t>>4&15)<<8|(e>>4&15)<<4|o>>4&15;return this._count++,this.getLeafGroup(n).addColor(a,t,e,o)}getLeafGroup(t){return this._children[t]||(this._children[t]=new Dt),this._children[t]}getColors(t){const e=this.getList().map(a=>a.createMainColor());e.sort((a,n)=>n._count-a._count);const o=[];for(;e.length;){const a=e.shift();e.filter(n=>I.distance(a,n)<t).forEach(n=>{a._count+=n._count;const r=e.findIndex(c=>c===n);e.splice(r,1)}),o.push(a)}return o}}const X=({data:s,width:t,height:e},o,a,n)=>{const r=new Lt,c=t&&e&&Math.floor(t*e/o)||1;let _=0;for(let l=0;l<s.length;l+=4*c){const g=s[l],b=s[l+1],k=s[l+2],v=s[l+3];n(g,b,k,v)?r.addColor(g,b,k):_++}return{colors:r.getColors(a),count:r._count+_}},H=()=>typeof window<"u",z=(s,t,e,o,a)=>Ct(s,t,e,o,a).map(r=>Mt(r,t)),kt=(s,t)=>{const e=s.width*s.height,o=e<t?s.width:Math.round(s.width*Math.sqrt(t/e)),a=e<t?s.height:Math.round(s.height*Math.sqrt(t/e)),n=document.createElement("canvas");n.width=o,n.height=a;const r=n.getContext("2d");return r.drawImage(s,0,0,s.width,s.height,0,0,o,a),r.getImageData(0,0,o,a)},N=(s,t={})=>{const[e,o,a,n,r,c]=B(t),{colors:_,count:l}=X(s,e,o,a);return z(_,l,n,r,c)},J=(s,t={})=>{if(H()){const[e,o,a,n,r,c,_]=B(t);return s.crossOrigin=_,new Promise(l=>{const g=b=>{const k=kt(b,e),{colors:v,count:R}=X(k,e,o,a);l(z(v,R,n,r,c))};if(s.complete)g(s);else{const b=()=>{s.removeEventListener("load",b),g(s)};s.addEventListener("load",b)}})}},St=(s,t={})=>{if(H()){const e=new Image;return e.src=s,J(e,t)}},Ut=(s,t)=>{if(H()){if(s instanceof Image)return J(s,t);if(s instanceof ImageData||s instanceof Object&&s.data)return new Promise(e=>{e(N(s,t))});if(typeof s=="string")return St(s,t)}else return new Promise(e=>{e(N(s,t))});throw new Error("Can not analyse picture")},It={class:"container mx-auto p-4"},Pt={class:"mb-4 flex items-center flex-wrap gap-4"},Et=i("label",{class:"block mb-2",for:"imageUpload"},"Upload an image",-1),Ft=i("label",{class:"bg-blue-500 hover-bg-blue-600 text-white font-bold py-2 px-4 rounded cursor-pointer",for:"imageUpload"},"Select Image",-1),Rt=i("div",{class:"mt-4 space-y-4"},null,-1),Gt={key:0,class:"mt-4"},Vt=["src"],jt={key:1,class:"mt-4"},Ht=i("p",{class:"text-gray-600"},"Extracting colors...",-1),Ot=[Ht],At={key:2,class:"mt-4"},Tt=i("h2",{class:"text-xl font-bold mb-2"},"Extracted Colors",-1),$t={class:"flex flex-wrap gap-4"},qt={class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover-opacity-100 transition-opacity"},Nt=["onClick"],Bt={class:"bg-white bg-opacity-75 p-1 text-xs"},Xt={class:"mt-8"},zt=i("h2",{class:"text-xl font-bold mb-2"},"Color Palette History",-1),Jt={class:"flex gap-2 mb-4"},Kt=["disabled"],Qt=["disabled"],Wt={class:"flex flex-wrap"},Yt={class:"flex items-center gap-4 h-32"},Zt=["src"],te={class:"flex flex-wrap gap-1 z-10"},ee={class:"text-sm text-gray-500"},ae={__name:"ExtractColors",setup(s){const t=(u=7)=>{const f=E(null),M=E([]),h=E([]),x=E(!1),y=q("color-extracts",u),D=q("color-palettes",[]),{history:tt,undo:et,redo:st,canUndo:ot,canRedo:nt}=mt(D,{deep:!0,debounce:1e3}),at=async(w,C=32)=>new Promise(U=>{const A=new FileReader;A.onload=lt=>{const L=new Image;L.onload=()=>{const S=document.createElement("canvas"),ht=S.getContext("2d"),T=C/Math.max(L.width,L.height);S.width=Math.min(C,L.width*T),S.height=Math.min(C,L.height*T),ht.drawImage(L,0,0,S.width,S.height),U(S.toDataURL("image/jpeg",.7))},L.src=lt.target.result},A.readAsDataURL(w)}),rt=async w=>{if(!w)return;x.value=!0,f.value=URL.createObjectURL(w);const C=await at(w);try{h.value=await Ut(f.value,{pixels:64e3,distance:.12,saturationDistance:.2,lightnessDistance:.2,hueDistance:.1}),O();const U={colors:M.value,timestamp:Date.now(),amount:y.value,thumbnail:C};D.value.unshift(U)}catch(U){console.error("Error extracting colors:",U)}finally{x.value=!1}},O=()=>{M.value=h.value.slice(0,y.value)},it=vt(()=>{var C;O();const w={colors:M.value,timestamp:Date.now(),amount:y.value,thumbnail:(C=D.value[0])==null?void 0:C.thumbnail};D.value.unshift(w)},300),ct=pt(()=>M.value.map(w=>({backgroundColor:w.hex})));return ft(y,()=>{h.value.length>0&&it()}),{imageUrl:f,colors:M,isLoading:x,extractColorsFromImage:rt,colorStyles:ct,storedPalettes:D,history:tt,undo:et,redo:st,canUndo:ot,canRedo:nt,amount:y}},{imageUrl:e,colors:o,isLoading:a,extractColorsFromImage:n,colorStyles:r,storedPalettes:c,history:_,undo:l,redo:g,canUndo:b,canRedo:k,amount:v}=t(),R=u=>{const f=u.target.files[0];f&&n(f)};function K(){c.value=[]}const{copy:Q,copied:se}=dt(),W=u=>bt(u).value,Y=()=>{if(l(),c.value.length>0){const u=c.value[0];o.value=u.colors,v.value=u.amount}},Z=()=>{if(g(),c.value.length>0){const u=c.value[0];o.value=u.colors,v.value=u.amount}};return(u,f)=>{const M=ut;return m(),p("div",It,[i("div",Pt,[Et,i("input",{class:"hidden",id:"imageUpload",type:"file",accept:"image/*",onChange:R},null,32),Ft,Rt,_t(M,{modelValue:d(v),"onUpdate:modelValue":f[0]||(f[0]=h=>gt(v)?v.value=h:null),min:2,max:12,step:1,param:"COLORS",fixed:0},null,8,["modelValue"])]),d(e)?(m(),p("div",Gt,[i("img",{class:"max-w-100 h-auto rounded shadow-lg",src:d(e),alt:"Uploaded image"},null,8,Vt)])):P("",!0),d(a)?(m(),p("div",jt,Ot)):P("",!0),d(o).length?(m(),p("div",At,[Tt,i("div",$t,[(m(!0),p(G,null,V(d(r),(h,x)=>(m(),p("div",{class:"w-24 h-24 rounded shadow-md relative group",key:x,style:$(h)},[i("div",qt,[i("button",{class:"text-white bg-gray-800 px-2 py-1 rounded",onClick:y=>d(Q)(d(o)[x].hex)},"Copy HEX",8,Nt)]),i("div",Bt,j(d(o)[x].hex),1)],4))),128))])])):P("",!0),i("div",Xt,[zt,i("div",Jt,[i("button",{class:"bg-blue-500 hover-bg-blue-600 text-white font-bold py-1 px-3 rounded",disabled:!d(b),onClick:Y},"Undo",8,Kt),i("button",{class:"bg-blue-500 hover-bg-blue-600 text-white font-bold py-1 px-3 rounded",disabled:!d(k),onClick:Z},"Redo",8,Qt),i("button",{class:"bg-red-500 hover-bg-blue-600 text-white font-bold py-1 px-3 rounded",onClick:K},"Clear")]),i("div",Wt,[(m(!0),p(G,null,V(d(c),(h,x)=>(m(),p("div",{class:"flex flex-col gap-2",key:x},[i("div",Yt,[h.thumbnail?(m(),p("img",{key:0,class:"max-w-16 max-h-16 blur-2px object-cover rounded",src:h.thumbnail,alt:"Palette thumbnail"},null,8,Zt)):P("",!0),i("div",te,[(m(!0),p(G,null,V(h.colors,(y,D)=>(m(),p("div",{class:"p-4 rounded shadow-sm",key:D,style:$({backgroundColor:y.hex})},null,4))),128))])]),i("div",ee,j(W(h.timestamp))+" - Amount: "+j(h.amount),1)]))),128))])])])}}};export{ae as default};
