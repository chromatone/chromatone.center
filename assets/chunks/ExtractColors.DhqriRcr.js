import{am as gt}from"./theme.Cc8uQkq-.js";import{a9 as mt,c as p,h as b,i as l,t as ft,u as m,aj as pt,k as U,F as G,Q as O,l as J,B as V,r as A,E as Q,aR as bt,G as vt,J as xt,a6 as wt,aS as yt}from"./framework.DqGUeSFU.js";const Ct=64e3,Dt=.22,Et=1/12,Mt=1/5,Lt=1/5,F=({pixels:e=Ct,distance:t=Dt,colorValidator:s=(h,u,_,f)=>(f??255)>250,hueDistance:n=Et,saturationDistance:o=Lt,lightnessDistance:a=Mt,crossOrigin:r="",requestMode:i="cors"}={})=>[Math.max(e,1),Math.min(Math.max(t,0),1),s,Math.min(Math.max(n,0),1),Math.min(Math.max(o,0),1),Math.min(Math.max(a,0),1),r,i];class S{constructor(t,s,n,o=t<<16|s<<8|n){this._count=1,this.__saturation=-1,this.__hue=-1,this.__lightness=-1,this.__intensity=-1,this._red=t,this._green=s,this._blue=n,this._hex=o}static distance(t,s){return(Math.abs(s._red-t._red)+Math.abs(s._green-t._green)+Math.abs(s._blue-t._blue))/(3*255)}clone(){const t=new S(this._red,this._green,this._blue,this._hex);return t._count=this._count,t}updateHSL(){const t=this._red/255,s=this._green/255,n=this._blue/255,o=Math.max(t,s,n),a=Math.min(t,s,n);if(this.__lightness=(o+a)/2,o===a)this.__hue=0,this.__saturation=0,this.__intensity=0;else{const r=o-a;switch(this.__saturation=this.__lightness>.5?r/(2-o-a):r/(o+a),this.__intensity=this.__saturation*((.5-Math.abs(.5-this.__lightness))*2),o){case t:this.__hue=((s-n)/r+(s<n?6:0))/6;break;case s:this.__hue=((n-t)/r+2)/6;break;case n:this.__hue=((t-s)/r+4)/6;break}}}get _hue(){return this.__hue===-1&&this.updateHSL(),this.__hue}get _saturation(){return this.__saturation===-1&&this.updateHSL(),this.__saturation}get _lightness(){return this.__lightness===-1&&this.updateHSL(),this.__lightness}get _intensity(){return this.__intensity===-1&&this.updateHSL(),this.__intensity}}class kt{constructor(){this._count=0,this._children={}}addColor(t,s,n,o){return this._count++,this._children[t]?this._children[t]._count++:this._children[t]=new S(s,n,o,t),this._children[t]}getList(){return Object.keys(this._children).map(t=>this._children[t])}createMainColor(){const n=this.getList().reduce((o,a)=>o._count>=a._count?o:a).clone();return n._count=this._count,n}}class It{constructor(){this._count=0,this._children={}}getList(){return Object.keys(this._children).map(t=>this._children[t])}addColor(t,s,n){const o=t<<16|s<<8|n,a=(t>>4&15)<<8|(s>>4&15)<<4|n>>4&15;return this._count++,this.getLeafGroup(a).addColor(o,t,s,n)}getLeafGroup(t){return this._children[t]||(this._children[t]=new kt),this._children[t]}getColors(t){const s=this.getList().map(o=>o.createMainColor());s.sort((o,a)=>a._count-o._count);const n=[];for(;s.length;){const o=s.shift();s.filter(a=>S.distance(o,a)<t).forEach(a=>{o._count+=a._count;const r=s.findIndex(i=>i===a);s.splice(r,1)}),n.push(o)}return n}}const N=({data:e,width:t,height:s},n,o,a)=>{const r=new It,i=t&&s&&Math.floor(t*s/n)||1;let h=0;for(let u=0;u<e.length;u+=4*i){const _=e[u],f=e[u+1],L=e[u+2],v=e[u+3];a(_,f,L,v)?r.addColor(_,f,L):h++}return{colors:r.getColors(o),count:r._count+h}},R=(e,t)=>Math.abs(e-t),St=(e,t)=>Math.min(R(e,t),R((e+.5)%1,(t+.5)%1));class Ut{constructor(){this.colors=[],this._average=null}addColor(t){this.colors.push(t),this._average=null}isSamePalette(t,s,n,o){for(const a of this.colors)if(!(St(a._hue,t._hue)<s&&R(a._saturation,t._saturation)<n&&R(a._lightness,t._lightness)<o))return!1;return!0}get average(){if(!this._average){const{r:t,g:s,b:n}=this.colors.reduce((a,r)=>(a.r+=r._red,a.g+=r._green,a.b+=r._blue,a),{r:0,g:0,b:0}),o=this.colors.reduce((a,r)=>a+r._count,0);this._average=new S(Math.round(t/this.colors.length),Math.round(s/this.colors.length),Math.round(n/this.colors.length)),this._average._count=o}return this._average}}class At{constructor(t,s,n){this._groups=[],this._hue=t,this._saturation=s,this._lightness=n}addColor(t){const s=this._groups.find(n=>n.isSamePalette(t,this._hue,this._saturation,this._lightness));if(s)s.addColor(t);else{const n=new Ut;n.addColor(t),this._groups.push(n)}}getGroups(){return this._groups.map(t=>t.average)}}const Rt=(e,t,s,n,o)=>{const a=new At(s,n,o);e.forEach(i=>a.addColor(i));const r=a.getGroups();return r.sort((i,h)=>{const u=(h._intensity+.1)*(.9-h._count/t),_=(i._intensity+.1)*(.9-i._count/t);return u-_}),r},Ft=(e,t)=>({hex:`#${"0".repeat(6-e._hex.toString(16).length)}${e._hex.toString(16)}`,red:e._red,green:e._green,blue:e._blue,area:e._count/t,hue:e._hue,saturation:e._saturation,lightness:e._lightness,intensity:e._intensity}),Pt=()=>typeof window<"u"&&typeof window.document<"u",B=()=>typeof self=="object"&&self.constructor&&self.constructor.name==="DedicatedWorkerGlobalScope",P=()=>typeof window>"u"&&typeof process<"u"&&process.versions!=null&&process.versions.node!=null,X=(e,t,s,n,o)=>Rt(e,t,s,n,o).map(r=>Ft(r,t)),z=(e,t)=>{const s=e.width*e.height,n=s<t?e.width:Math.round(e.width*Math.sqrt(t/s)),o=s<t?e.height:Math.round(e.height*Math.sqrt(t/s)),r=((i,h)=>{if(B())return new OffscreenCanvas(i,h);const u=document.createElement("canvas");return u.width=i,u.height=h,u})(n,o).getContext("2d");return r.drawImage(e,0,0,e.width,e.height,0,0,n,o),r.getImageData(0,0,n,o)},j=(e,t={})=>{const[s,n,o,a,r,i]=F(t),{colors:h,count:u}=N(e,s,n,o);return X(h,u,a,r,i)},K=async(e,t={})=>{if(P())return[];const[s,n,o,a,r,i,h]=F(t);return e.crossOrigin=h,new Promise(u=>{const _=f=>{const L=z(f,s),{colors:v,count:T}=N(L,s,n,o);u(X(v,T,a,r,i))};if(e.complete)_(e);else{const f=()=>{e.removeEventListener("load",f),_(e)};e.addEventListener("load",f)}})},Tt=async(e,t={})=>{if(P())return[];const[s,n,o,a,r,i]=F(t),h=z(e,s),{colors:u,count:_}=N(h,s,n,o);return X(u,_,a,r,i)},H=async(e,t={})=>{if(P())return[];if(B()){const n=F(t),a=await(await fetch(e,{mode:n[7]})).blob(),r=await createImageBitmap(a),i=await Tt(r,t);return r.close(),i}const s=new Image;return s.src=e,K(s,t)},Gt=(e,t)=>{if(Pt()){if(e instanceof Image)return K(e,t);if(e instanceof ImageData||e instanceof Object&&e.data)return new Promise(s=>{s(j(e,t))});if(typeof e=="string")return H(e,t)}if(B()){if(e instanceof ImageData||e instanceof Object&&e.data)return new Promise(s=>{s(j(e,t))});if(typeof e=="string")return H(e,t);if(e.src)return H(e.src,t)}if(P())return new Promise(s=>{s(j(e,t))});throw new Error("Can not analyse picture")},Ot={class:"container mx-auto p-4"},Vt={class:"mb-4 flex items-center flex-wrap gap-4"},jt={key:0,class:"mt-4"},Ht=["src"],Nt={key:1,class:"mt-4"},Bt={key:2,class:"mt-4"},Xt={class:"flex flex-wrap gap-4"},$t={class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover-opacity-100 transition-opacity"},qt=["onClick"],Wt={class:"bg-white bg-opacity-75 p-1 text-xs"},Jt={class:"mt-8"},Qt={class:"flex gap-2 mb-4"},zt=["disabled"],Kt=["disabled"],Yt={class:"flex flex-wrap"},Zt={class:"flex items-center gap-4 h-32"},te=["src"],ee={class:"flex flex-wrap gap-1 z-10"},se={class:"text-sm text-gray-500"},re={__name:"ExtractColors",setup(e){const t=(g=7)=>{const c=A(null),D=A([]),d=A([]),x=A(!1),y=Q("color-extracts",g),E=Q("color-palettes",[]),{history:nt,undo:ot,redo:at,canUndo:rt,canRedo:it}=bt(E,{deep:!0,debounce:1e3}),ct=async(w,C=32)=>new Promise(I=>{const q=new FileReader;q.onload=dt=>{const M=new Image;M.onload=()=>{const k=document.createElement("canvas"),_t=k.getContext("2d"),W=C/Math.max(M.width,M.height);k.width=Math.min(C,M.width*W),k.height=Math.min(C,M.height*W),_t.drawImage(M,0,0,k.width,k.height),I(k.toDataURL("image/jpeg",.7))},M.src=dt.target.result},q.readAsDataURL(w)}),lt=async w=>{if(!w)return;x.value=!0,c.value=URL.createObjectURL(w);const C=await ct(w);try{d.value=await Gt(c.value,{pixels:64e3,distance:.12,saturationDistance:.2,lightnessDistance:.2,hueDistance:.1}),$();const I={colors:D.value,timestamp:Date.now(),amount:y.value,thumbnail:C};E.value.unshift(I)}catch(I){console.error("Error extracting colors:",I)}finally{x.value=!1}},$=()=>{D.value=d.value.slice(0,y.value)},ut=yt(()=>{var C;$();const w={colors:D.value,timestamp:Date.now(),amount:y.value,thumbnail:(C=E.value[0])==null?void 0:C.thumbnail};E.value.unshift(w)},300),ht=vt(()=>D.value.map(w=>({backgroundColor:w.hex})));return xt(y,()=>{d.value.length>0&&ut()}),{imageUrl:c,colors:D,isLoading:x,extractColorsFromImage:lt,colorStyles:ht,storedPalettes:E,history:nt,undo:ot,redo:at,canUndo:rt,canRedo:it,amount:y}},{imageUrl:s,colors:n,isLoading:o,extractColorsFromImage:a,colorStyles:r,storedPalettes:i,history:h,undo:u,redo:_,canUndo:f,canRedo:L,amount:v}=t(),T=g=>{const c=g.target.files[0];c&&a(c)};function Y(){i.value=[]}const{copy:Z,copied:ne}=mt(),tt=g=>wt(g).value,et=()=>{if(u(),i.value.length>0){const g=i.value[0];n.value=g.colors,v.value=g.amount}},st=()=>{if(_(),i.value.length>0){const g=i.value[0];n.value=g.colors,v.value=g.amount}};return(g,c)=>{const D=gt;return p(),b("div",Ot,[l("div",Vt,[c[1]||(c[1]=l("label",{class:"block mb-2",for:"imageUpload"},"Upload an image",-1)),l("input",{class:"hidden",id:"imageUpload",type:"file",accept:"image/*",onChange:T},null,32),c[2]||(c[2]=l("label",{class:"bg-blue-500 hover-bg-blue-600 text-white font-bold py-2 px-4 rounded cursor-pointer",for:"imageUpload"},"Select Image",-1)),c[3]||(c[3]=l("div",{class:"mt-4 space-y-4"},null,-1)),ft(D,{modelValue:m(v),"onUpdate:modelValue":c[0]||(c[0]=d=>pt(v)?v.value=d:null),min:2,max:12,step:1,param:"COLORS",fixed:0},null,8,["modelValue"])]),m(s)?(p(),b("div",jt,[l("img",{class:"max-w-100 h-auto rounded shadow-lg",src:m(s),alt:"Uploaded image"},null,8,Ht)])):U("",!0),m(o)?(p(),b("div",Nt,c[4]||(c[4]=[l("p",{class:"text-gray-600"},"Extracting colors...",-1)]))):U("",!0),m(n).length?(p(),b("div",Bt,[c[5]||(c[5]=l("h2",{class:"text-xl font-bold mb-2"},"Extracted Colors",-1)),l("div",Xt,[(p(!0),b(G,null,O(m(r),(d,x)=>(p(),b("div",{class:"w-24 h-24 rounded shadow-md relative group",key:x,style:J(d)},[l("div",$t,[l("button",{class:"text-white bg-gray-800 px-2 py-1 rounded",onClick:y=>m(Z)(m(n)[x].hex)},"Copy HEX",8,qt)]),l("div",Wt,V(m(n)[x].hex),1)],4))),128))])])):U("",!0),l("div",Jt,[c[6]||(c[6]=l("h2",{class:"text-xl font-bold mb-2"},"Color Palette History",-1)),l("div",Qt,[l("button",{class:"bg-blue-500 hover-bg-blue-600 text-white font-bold py-1 px-3 rounded",disabled:!m(f),onClick:et},"Undo",8,zt),l("button",{class:"bg-blue-500 hover-bg-blue-600 text-white font-bold py-1 px-3 rounded",disabled:!m(L),onClick:st},"Redo",8,Kt),l("button",{class:"bg-red-500 hover-bg-blue-600 text-white font-bold py-1 px-3 rounded",onClick:Y},"Clear")]),l("div",Yt,[(p(!0),b(G,null,O(m(i),(d,x)=>(p(),b("div",{class:"flex flex-col gap-2",key:x},[l("div",Zt,[d.thumbnail?(p(),b("img",{key:0,class:"max-w-16 max-h-16 blur-2px object-cover rounded",src:d.thumbnail,alt:"Palette thumbnail"},null,8,te)):U("",!0),l("div",ee,[(p(!0),b(G,null,O(d.colors,(y,E)=>(p(),b("div",{class:"p-4 rounded shadow-sm",key:E,style:J({backgroundColor:y.hex})},null,4))),128))])]),l("div",se,V(tt(d.timestamp))+" - Amount: "+V(d.amount),1)]))),128))])])])}}};export{re as default};
