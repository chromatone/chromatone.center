import{C as _t,ar as gt,u as z,b5 as mt,b6 as ft,b7 as bt}from"./theme.BUIsQubF.js";import{q as b,f as p,s as l,t as U,l as pt,u as m,C as vt,F as G,Y as O,v as Y,z as V,r as A,M as xt,I as wt}from"./framework.DprnlfsI.js";const yt=64e3,Ct=.22,Dt=1/12,Mt=1/5,Et=1/5,F=({pixels:e=yt,distance:t=Ct,colorValidator:s=(h,u,_,f)=>(f??255)>250,hueDistance:n=Dt,saturationDistance:o=Et,lightnessDistance:a=Mt,crossOrigin:r="",requestMode:i="cors"}={})=>[Math.max(e,1),Math.min(Math.max(t,0),1),s,Math.min(Math.max(n,0),1),Math.min(Math.max(o,0),1),Math.min(Math.max(a,0),1),r,i];class S{constructor(t,s,n,o=t<<16|s<<8|n){this._count=1,this.__saturation=-1,this.__hue=-1,this.__lightness=-1,this.__intensity=-1,this._red=t,this._green=s,this._blue=n,this._hex=o}static distance(t,s){return(Math.abs(s._red-t._red)+Math.abs(s._green-t._green)+Math.abs(s._blue-t._blue))/(3*255)}clone(){const t=new S(this._red,this._green,this._blue,this._hex);return t._count=this._count,t}updateHSL(){const t=this._red/255,s=this._green/255,n=this._blue/255,o=Math.max(t,s,n),a=Math.min(t,s,n);if(this.__lightness=(o+a)/2,o===a)this.__hue=0,this.__saturation=0,this.__intensity=0;else{const r=o-a;switch(this.__saturation=this.__lightness>.5?r/(2-o-a):r/(o+a),this.__intensity=this.__saturation*((.5-Math.abs(.5-this.__lightness))*2),o){case t:this.__hue=((s-n)/r+(s<n?6:0))/6;break;case s:this.__hue=((n-t)/r+2)/6;break;case n:this.__hue=((t-s)/r+4)/6;break}}}get _hue(){return this.__hue===-1&&this.updateHSL(),this.__hue}get _saturation(){return this.__saturation===-1&&this.updateHSL(),this.__saturation}get _lightness(){return this.__lightness===-1&&this.updateHSL(),this.__lightness}get _intensity(){return this.__intensity===-1&&this.updateHSL(),this.__intensity}}class Lt{constructor(){this._count=0,this._children={}}addColor(t,s,n,o){return this._count++,this._children[t]?this._children[t]._count++:this._children[t]=new S(s,n,o,t),this._children[t]}getList(){return Object.keys(this._children).map(t=>this._children[t])}createMainColor(){const n=this.getList().reduce((o,a)=>o._count>=a._count?o:a).clone();return n._count=this._count,n}}class It{constructor(){this._count=0,this._children={}}getList(){return Object.keys(this._children).map(t=>this._children[t])}addColor(t,s,n){const o=t<<16|s<<8|n,a=(t>>4&15)<<8|(s>>4&15)<<4|n>>4&15;return this._count++,this.getLeafGroup(a).addColor(o,t,s,n)}getLeafGroup(t){return this._children[t]||(this._children[t]=new Lt),this._children[t]}getColors(t){const s=this.getList().map(o=>o.createMainColor());s.sort((o,a)=>a._count-o._count);const n=[];for(;s.length;){const o=s.shift();s.filter(a=>S.distance(o,a)<t).forEach(a=>{o._count+=a._count;const r=s.findIndex(i=>i===a);s.splice(r,1)}),n.push(o)}return n}}const N=({data:e,width:t,height:s},n,o,a)=>{const r=new It,i=t&&s&&Math.floor(t*s/n)||1;let h=0;for(let u=0;u<e.length;u+=4*i){const _=e[u],f=e[u+1],v=e[u+2],I=e[u+3];a(_,f,v,I)?r.addColor(_,f,v):h++}return{colors:r.getColors(o),count:r._count+h}},R=(e,t)=>Math.abs(e-t),kt=(e,t)=>Math.min(R(e,t),R((e+.5)%1,(t+.5)%1));class St{constructor(){this.colors=[],this._average=null}addColor(t){this.colors.push(t),this._average=null}isSamePalette(t,s,n,o){for(const a of this.colors)if(!(kt(a._hue,t._hue)<s&&R(a._saturation,t._saturation)<n&&R(a._lightness,t._lightness)<o))return!1;return!0}get average(){if(!this._average){const{r:t,g:s,b:n}=this.colors.reduce((a,r)=>(a.r+=r._red,a.g+=r._green,a.b+=r._blue,a),{r:0,g:0,b:0}),o=this.colors.reduce((a,r)=>a+r._count,0);this._average=new S(Math.round(t/this.colors.length),Math.round(s/this.colors.length),Math.round(n/this.colors.length)),this._average._count=o}return this._average}}class Ut{constructor(t,s,n){this._groups=[],this._hue=t,this._saturation=s,this._lightness=n}addColor(t){const s=this._groups.find(n=>n.isSamePalette(t,this._hue,this._saturation,this._lightness));if(s)s.addColor(t);else{const n=new St;n.addColor(t),this._groups.push(n)}}getGroups(){return this._groups.map(t=>t.average)}}const At=(e,t,s,n,o)=>{const a=new Ut(s,n,o);e.forEach(i=>a.addColor(i));const r=a.getGroups();return r.sort((i,h)=>{const u=(h._intensity+.1)*(.9-h._count/t),_=(i._intensity+.1)*(.9-i._count/t);return u-_}),r},Rt=(e,t)=>({hex:`#${"0".repeat(6-e._hex.toString(16).length)}${e._hex.toString(16)}`,red:e._red,green:e._green,blue:e._blue,area:e._count/t,hue:e._hue,saturation:e._saturation,lightness:e._lightness,intensity:e._intensity}),Ft=()=>typeof window<"u"&&typeof window.document<"u",B=()=>typeof self=="object"&&self.constructor&&self.constructor.name==="DedicatedWorkerGlobalScope",P=()=>typeof window>"u"&&typeof process<"u"&&process.versions!=null&&process.versions.node!=null,X=(e,t,s,n,o)=>At(e,t,s,n,o).map(r=>Rt(r,t)),J=(e,t)=>{const s=e.width*e.height,n=s<t?e.width:Math.round(e.width*Math.sqrt(t/s)),o=s<t?e.height:Math.round(e.height*Math.sqrt(t/s)),r=((i,h)=>{if(B())return new OffscreenCanvas(i,h);const u=document.createElement("canvas");return u.width=i,u.height=h,u})(n,o).getContext("2d");return r.drawImage(e,0,0,e.width,e.height,0,0,n,o),r.getImageData(0,0,n,o)},H=(e,t={})=>{const[s,n,o,a,r,i]=F(t),{colors:h,count:u}=N(e,s,n,o);return X(h,u,a,r,i)},K=async(e,t={})=>{if(P())return[];const[s,n,o,a,r,i,h]=F(t);return e.crossOrigin=h,new Promise(u=>{const _=f=>{const v=J(f,s),{colors:I,count:T}=N(v,s,n,o);u(X(I,T,a,r,i))};if(e.complete)_(e);else{const f=()=>{e.removeEventListener("load",f),_(e)};e.addEventListener("load",f)}})},Pt=async(e,t={})=>{if(P())return[];const[s,n,o,a,r,i]=F(t),h=J(e,s),{colors:u,count:_}=N(h,s,n,o);return X(u,_,a,r,i)},j=async(e,t={})=>{if(P())return[];if(B()){const n=F(t),a=await(await fetch(e,{mode:n[7]})).blob(),r=await createImageBitmap(a),i=await Pt(r,t);return r.close(),i}const s=new Image;return s.src=e,K(s,t)},Tt=(e,t)=>{if(Ft()){if(e instanceof Image)return K(e,t);if(e instanceof ImageData||e instanceof Object&&e.data)return new Promise(s=>{s(H(e,t))});if(typeof e=="string")return j(e,t)}if(B()){if(e instanceof ImageData||e instanceof Object&&e.data)return new Promise(s=>{s(H(e,t))});if(typeof e=="string")return j(e,t);if(e.src)return j(e.src,t)}if(P())return new Promise(s=>{s(H(e,t))});throw new Error("Can not analyse picture")},Gt={class:"container mx-auto p-4"},Ot={class:"mb-4 flex items-center flex-wrap gap-4"},Vt={key:0,class:"mt-4"},Ht=["src"],jt={key:1,class:"mt-4"},Nt={key:2,class:"mt-4"},Bt={class:"flex flex-wrap gap-4"},Xt={class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover-opacity-100 transition-opacity"},qt=["onClick"],$t={class:"bg-white bg-opacity-75 p-1 text-xs"},Wt={class:"mt-8"},zt={class:"flex gap-2 mb-4"},Yt=["disabled"],Jt=["disabled"],Kt={class:"flex flex-wrap"},Qt={class:"flex items-center gap-4 h-32"},Zt=["src"],te={class:"flex flex-wrap gap-1 z-10"},ee={class:"text-sm text-gray-500"},oe={__name:"ExtractColors",setup(e){const t=(g=7)=>{const c=A(null),D=A([]),d=A([]),x=A(!1),y=z("color-extracts",g),M=z("color-palettes",[]),{history:st,undo:nt,redo:ot,canUndo:at,canRedo:rt}=mt(M,{deep:!0,debounce:1e3}),it=async(w,C=32)=>new Promise(k=>{const $=new FileReader;$.onload=ht=>{const E=new Image;E.onload=()=>{const L=document.createElement("canvas"),dt=L.getContext("2d"),W=C/Math.max(E.width,E.height);L.width=Math.min(C,E.width*W),L.height=Math.min(C,E.height*W),dt.drawImage(E,0,0,L.width,L.height),k(L.toDataURL("image/jpeg",.7))},E.src=ht.target.result},$.readAsDataURL(w)}),ct=async w=>{if(!w)return;x.value=!0,c.value=URL.createObjectURL(w);const C=await it(w);try{d.value=await Tt(c.value,{pixels:64e3,distance:.12,saturationDistance:.2,lightnessDistance:.2,hueDistance:.1}),q();const k={colors:D.value,timestamp:Date.now(),amount:y.value,thumbnail:C};M.value.unshift(k)}catch(k){console.error("Error extracting colors:",k)}finally{x.value=!1}},q=()=>{D.value=d.value.slice(0,y.value)},lt=bt(()=>{var C;q();const w={colors:D.value,timestamp:Date.now(),amount:y.value,thumbnail:(C=M.value[0])==null?void 0:C.thumbnail};M.value.unshift(w)},300),ut=xt(()=>D.value.map(w=>({backgroundColor:w.hex})));return wt(y,()=>{d.value.length>0&&lt()}),{imageUrl:c,colors:D,isLoading:x,extractColorsFromImage:ct,colorStyles:ut,storedPalettes:M,history:st,undo:nt,redo:ot,canUndo:at,canRedo:rt,amount:y}},{imageUrl:s,colors:n,isLoading:o,extractColorsFromImage:a,colorStyles:r,storedPalettes:i,undo:h,redo:u,canUndo:_,canRedo:f,amount:v}=t(),I=g=>{const c=g.target.files[0];c&&a(c)};function T(){i.value=[]}const{copy:Q}=_t(),Z=g=>ft(g).value,tt=()=>{if(h(),i.value.length>0){const g=i.value[0];n.value=g.colors,v.value=g.amount}},et=()=>{if(u(),i.value.length>0){const g=i.value[0];n.value=g.colors,v.value=g.amount}};return(g,c)=>{const D=gt;return p(),b("div",Gt,[l("div",Ot,[c[1]||(c[1]=l("label",{class:"block mb-2",for:"imageUpload"},"Upload an image",-1)),l("input",{class:"hidden",id:"imageUpload",type:"file",accept:"image/*",onChange:I},null,32),c[2]||(c[2]=l("label",{class:"bg-blue-500 hover-bg-blue-600 text-white font-bold py-2 px-4 rounded cursor-pointer",for:"imageUpload"},"Select Image",-1)),c[3]||(c[3]=l("div",{class:"mt-4 space-y-4"},null,-1)),pt(D,{modelValue:m(v),"onUpdate:modelValue":c[0]||(c[0]=d=>vt(v)?v.value=d:null),min:2,max:12,step:1,param:"COLORS",fixed:0},null,8,["modelValue"])]),m(s)?(p(),b("div",Vt,[l("img",{class:"max-w-100 h-auto rounded shadow-lg",src:m(s),alt:"Uploaded image"},null,8,Ht)])):U("",!0),m(o)?(p(),b("div",jt,c[4]||(c[4]=[l("p",{class:"text-gray-600"},"Extracting colors...",-1)]))):U("",!0),m(n).length?(p(),b("div",Nt,[c[5]||(c[5]=l("h2",{class:"text-xl font-bold mb-2"},"Extracted Colors",-1)),l("div",Bt,[(p(!0),b(G,null,O(m(r),(d,x)=>(p(),b("div",{class:"w-24 h-24 rounded shadow-md relative group",key:x,style:Y(d)},[l("div",Xt,[l("button",{class:"text-white bg-gray-800 px-2 py-1 rounded",onClick:y=>m(Q)(m(n)[x].hex)},"Copy HEX",8,qt)]),l("div",$t,V(m(n)[x].hex),1)],4))),128))])])):U("",!0),l("div",Wt,[c[6]||(c[6]=l("h2",{class:"text-xl font-bold mb-2"},"Color Palette History",-1)),l("div",zt,[l("button",{class:"bg-blue-500 hover-bg-blue-600 text-white font-bold py-1 px-3 rounded",disabled:!m(_),onClick:tt},"Undo",8,Yt),l("button",{class:"bg-blue-500 hover-bg-blue-600 text-white font-bold py-1 px-3 rounded",disabled:!m(f),onClick:et},"Redo",8,Jt),l("button",{class:"bg-red-500 hover-bg-blue-600 text-white font-bold py-1 px-3 rounded",onClick:T},"Clear")]),l("div",Kt,[(p(!0),b(G,null,O(m(i),(d,x)=>(p(),b("div",{class:"flex flex-col gap-2",key:x},[l("div",Qt,[d.thumbnail?(p(),b("img",{key:0,class:"max-w-16 max-h-16 blur-2px object-cover rounded",src:d.thumbnail,alt:"Palette thumbnail"},null,8,Zt)):U("",!0),l("div",te,[(p(!0),b(G,null,O(d.colors,(y,M)=>(p(),b("div",{class:"p-4 rounded shadow-sm",key:M,style:Y({backgroundColor:y.hex})},null,4))),128))])]),l("div",ee,V(Z(d.timestamp))+" - Amount: "+V(d.amount),1)]))),128))])])])}}};export{oe as default};
