import{r as tt,d as Ot,b as Dt,c as At,f as q,g as Y,h as W,F as at,j as ut,n as _t,au as $t,m as et,k as st,ag as ct}from"./framework.BH4RfCYQ.js";var ft={},z=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ft<"u"?ft:typeof self<"u"?self:{};function xt(J){return J&&J.__esModule&&Object.prototype.hasOwnProperty.call(J,"default")?J.default:J}var lt;function Tt(){return lt||(lt={"/gun.js":L})}function nt(J){function x(O){var d=pt(O,J);if(d!==null)return Tt()[d]();throw new Error('Could not dynamically require "'+O+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}return x.resolve=function(O){var d=pt(O,J);return d!==null?d:require.resolve(O)},x}function pt(J,x){var O=Ct(J);J=Z(J);var d;J[0]==="/"&&(x="");for(var i=Tt(),a=["",".js",".json"];O?d=Z(x+"/node_modules/"+J):d=Z(x+"/"+J),!d.endsWith("/..");){for(var p=0;p<a.length;p++){var y=d+a[p];if(i[y])return y}if(!O)break;var h=Z(x+"/..");if(h===x)break;x=h}return null}function Ct(J){var x=J[0];if(x==="/"||x==="\\")return!1;var O=J[1],d=J[2];return!(x==="."&&(!O||O==="/"||O==="\\")||x==="."&&O==="."&&(!d||d==="/"||d==="\\")||O===":"&&(d==="/"||d==="\\"))}function Z(J){J=J.replace(/\\/g,"/");for(var x=J.split("/"),O=x[0]==="",d=1;d<x.length;d++)(x[d]==="."||x[d]==="")&&x.splice(d--,1);for(var d=1;d<x.length;d++)x[d]===".."&&d>0&&x[d-1]!==".."&&x[d-1]!=="."&&(x.splice(--d,2),d--);return J=x.join("/"),O&&J[0]!=="/"?J="/"+J:J.length===0&&(J="."),J}var ht={exports:{}},dt;function L(){return dt||(dt=1,function(J){(function(){function x(d,i){return i?nt("/")(d):d.slice?x[a(d)]:function(p,y){d(p={exports:{}}),x[a(y)]=p.exports};function a(p){return p.split("/").slice(-1).toString().replace(".js","")}}var O=J;x(function(d){String.random=function(a,p){var y="";for(a=a||24,p=p||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";a-- >0;)y+=p.charAt(Math.floor(Math.random()*p.length));return y},String.match=function(a,p){var y,h;return typeof a!="string"?!1:(typeof p=="string"&&(p={"=":p}),p=p||{},y=p["="]||p["*"]||p[">"]||p["<"],a===y?!0:h!==p["="]?!1:(y=p["*"]||p[">"],a.slice(0,(y||"").length)===y?!0:h!==p["*"]?!1:h!==p[">"]&&h!==p["<"]?a>=p[">"]&&a<=p["<"]:h!==p[">"]&&a>=p[">"]||h!==p["<"]&&a<=p["<"]))},String.hash=function(a,p){if(typeof a=="string"){if(p=p||0,!a.length)return p;for(var y=0,h=a.length,t;y<h;++y)t=a.charCodeAt(y),p=(p<<5)-p+t,p|=0;return p}};var i=Object.prototype.hasOwnProperty;Object.plain=function(a){return a?a instanceof Object&&a.constructor===Object||Object.prototype.toString.call(a).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(a,p){for(var y in a)if(i.call(a,y)&&(!p||p.indexOf(y)==-1))return!1;return!0},Object.keys=Object.keys||function(a){var p=[];for(var y in a)i.call(a,y)&&p.push(y);return p},function(){var a,p=setTimeout,y=0,h=0,t=typeof setImmediate!=""+a&&setImmediate||function(o,u){return typeof MessageChannel==""+a?p:((o=new MessageChannel).port1.onmessage=function(S){S.data==""&&u()},function(S){u=S,o.port2.postMessage("")})}(),s=p.check=p.check||typeof performance!=""+a&&performance||{now:function(){return+new Date}};p.hold=p.hold||9,p.poll=p.poll||function(o){if(p.hold>=s.now()-y&&h++<3333){o();return}t(function(){y=s.now(),o()},h=0)}}(),function(){var a=setTimeout,p=a.turn=a.turn||function(u){y.push(u)==1&&h(o)},y=p.s=[],h=a.poll,t=0,s,o=function(){(s=y[t++])&&s(),(t==y.length||t==99)&&(y=p.s=y.slice(t),t=0),y.length&&h(o)}}(),function(){var a,p=setTimeout,y=p.turn;(p.each=p.each||function(h,t,s,o){o=o||9,function u(S,r,v){if(r=(S=(h||[]).splice(0,o)).length){for(var g=0;g<r&&a===(v=t(S[g]));g++);if(a===v){y(u);return}}s&&s(v)}()})()}()})(x,"./shim"),x(function(d){d.exports=function i(s,p,y){if(!s)return{to:i};var h,t=typeof p=="function",s=(this.tag||(this.tag={}))[s]||t&&(this.tag[s]={tag:s,to:i._={next:function(u){var S;(S=this.to)&&S.next(u)}}});if(t){var o={off:i.off||(i.off=function(){if(this.next===i._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=i._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:i._,next:p,the:s,on:this,as:y};return(o.back=s.last||s).to=o,s.last=o}return(s=s.to)&&h!==p&&s.next(p),s}})(x,"./onto"),x(function(d){d.exports=function(i){return i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"&&i!=1/0&&i!=-1/0&&i===i||!!i&&typeof i["#"]=="string"&&Object.keys(i).length===1&&i["#"]}})(x,"./valid"),x(function(d){x("./shim");function i(){var s=+new Date;return h<s?(p=0,h=s+i.drift):h=s+(p+=1)/y+i.drift}i.drift=0;var a=-1/0,p=0,y=999,h=a,t;i.is=function(s,o,u){var S=o&&s&&s._&&s._[">"]||u;if(S)return typeof(S=S[o])=="number"?S:a},i.ify=function(s,o,u,S,r){(s=s||{})._=s._||{},r&&(s._["#"]=r);var v=s._[">"]||(s._[">"]={});return t!==o&&o!=="_"&&(typeof u=="number"&&(v[o]=u),t!==S&&(s[o]=S)),s},d.exports=i})(x,"./state"),x(function(d){x("./shim");function i(a){var p={s:{}},y=p.s;a=a||{max:999,age:1e3*9},p.check=function(t){return y[t]?h(t):!1};var h=p.track=function(t){var s=y[t]||(y[t]={});return s.was=p.now=+new Date,p.to||(p.to=setTimeout(p.drop,a.age+9)),h.ed&&h.ed(t),s};return p.drop=function(t){p.to=null,p.now=+new Date;var s=Object.keys(y);console.STAT&&console.STAT(p.now,+new Date-p.now,"dup drop keys"),setTimeout.each(s,function(o){var u=y[o];u&&(t||a.age)>p.now-u.was||delete y[o]},0,99)},p}d.exports=i})(x,"./dup"),x(function(d){x("./onto"),d.exports=function(a,p){if(this.on){var y=(this.opt||{}).lack||9e3;if(typeof a!="function"){if(!a)return;var t=a["#"]||a,h=(this.tag||"")[t];return h?(p&&(h=this.on(t,p),clearTimeout(h.err),h.err=setTimeout(function(){h.off()},y)),!0):void 0}var t=p&&p["#"]||i(9);if(!a)return t;var s=this.on(t,a,p);return s.err=s.err||setTimeout(function(){s.off(),s.next({err:"Error: No ACK yet.",lack:!0})},y),t}};var i=String.random||function(){return Math.random().toString(36).slice(2)}})(x,"./ask"),x(function(d){function i(r){return r instanceof i?(this._={$:this}).$:this instanceof i?i.create(this._={$:this,opt:r}):new i(r)}i.is=function(r){return r instanceof i||r&&r._&&r===r._.$||!1},i.version=.202,i.chain=i.prototype,i.chain.toJSON=function(){},x("./shim"),i.valid=x("./valid"),i.state=x("./state"),i.on=x("./onto"),i.dup=x("./dup"),i.ask=x("./ask"),function(){i.create=function(c){c.root=c.root||c,c.graph=c.graph||{},c.on=c.on||i.on,c.ask=c.ask||i.ask,c.dup=c.dup||i.dup();var T=c.$.opt(c.opt);return c.once||(c.on("in",r,c),c.on("out",r,c),c.on("put",w,c),i.on("create",c),c.on("create",c)),c.once=1,T};function r(c){if(c){if(c.out===r){this.to.next(c);return}var T=this,j=T.as,A=j.at||j,B=A.$,N=A.dup,G,E=c.DBG;if((G=c["#"])||(G=c["#"]=p(9)),!N.check(G)){if(N.track(G),G=c._,c._=typeof G=="function"?G:function(){},c.$&&c.$===(c.$._||"").$||(c.$=B),c["@"]&&!c.put&&n(c),!A.ask(c["@"],c))if(E&&(E.u=+new Date),c.put){v(c);return}else c.get&&i.on.get(c,B);E&&(E.uc=+new Date),T.to.next(c),E&&(E.ua=+new Date),!(c.nts||c.NTS)&&(c.out=r,A.on("out",c),E&&(E.ue=+new Date))}}}function v(c){if(c){var T=c._||"",j=T.root=((T.$=c.$||"")._||"").root;if(c["@"]&&T.faith&&!T.miss){c.out=r,j.on("out",c);return}T.latch=j.hatch,T.match=j.hatch=[];var A=c.put,B=T.DBG=c.DBG,N=+new Date;if($=$||N,!(A["#"]&&A["."])){B&&(B.p=N),T["#"]=c["#"],T.msg=c,T.all=0,T.stun=1;var G=Object.keys(A);console.STAT&&console.STAT(N,((B||T).pk=+new Date)-N,"put sort");var E=0,U,P,R,M,I,K,V;(function H(Q){if(U!=E){if(U=E,!(R=G[E])){console.STAT&&console.STAT(N,((B||T).pd=+new Date)-N,"put"),e(T);return}(M=A[R])?(V=M._)?R!==V["#"]?K=l+m(R)+"soul not same.":(I=V[">"])||(K=l+m(R)+"no state."):K=l+m(R)+"no meta.":K=l+m(R)+"no node.",P=Object.keys(M||{})}if(K){c.err=T.err=K,e(T);return}var ot=0,F;for(Q=Q||0;Q++<9&&(F=P[ot++]);)if(F!=="_"){var X=M[F],it=I[F];if(o===it){K=l+m(F)+"on"+m(R)+"no state.";break}if(!h(X)){K=l+m(F)+"on"+m(R)+"bad "+typeof X+m(X);break}g(X,F,R,it,c),++C}if((P=P.slice(ot)).length){y(H);return}++E,P=null,H(Q)})()}}}i.on.put=v;function g(c,T,j,A,B){var N=B._||"",G=N.root,E=G.graph,U,P=E[j]||u,R=t(P,T,1),M=P[T],I=N.DBG;(U=console.STAT)&&(!E[j]||!M)&&(U.has=(U.has||0)+1);var K=D();if(A>K){setTimeout(function(){g(c,T,j,A,B)},(U=A-K)>k?k:U),console.STAT&&console.STAT((I||N).Hf=+new Date,U,"future");return}if(!(A<R)&&!(!N.faith&&A===R&&(c===M||b(c)<=b(M))&&!N.miss)){N.stun++;var V=B["#"]+N.all++,H={toString:function(){return V},_:N};H.toJSON=H.toString,G.dup.track(H)["#"]=B["#"],I&&(I.ph=I.ph||+new Date),G.on("put",{"#":H,"@":B["@"],put:{"#":j,".":T,":":c,">":A},ok:B.ok,_:N})}}function w(c){var T;(T=(c._||"").DBG)&&(T.pa=+new Date,T.pm=T.pm||+new Date);var j=this,A=j.as,B=A.graph,N=c._,G=c.put,E=G["#"],U=G["."],P=G[":"],R=G[">"];c["#"];var M;(M=N.msg)&&(M=M.put)&&(M=M[E])&&s(M,U,R,P,E),B[E]=s(B[E],U,R,P,E),(M=(A.next||"")[E])&&M.on("in",c),e(N),j.to.next(c)}function e(c,T){var j;if(!c.stop&&!(!c.err&&0<--c.stun)&&(c.stop=1,!!(j=c.root))){var A=c.match;A.end=1,A===j.hatch&&(!(A=c.latch)||A.end?delete j.hatch:j.hatch=A),c.hatch&&c.hatch(),setTimeout.each(c.match,function(B){B&&B()}),!(!(T=c.msg)||c.err||T.err)&&(T.out=r,c.root.on("out",T),_())}}function n(c){var T=c["@"]||"",j;if(!(j=T._)){var A=(A=c.$)&&(A=A._)&&(A=A.root)&&(A=A.dup);if(!(A=A.check(T)))return;c["@"]=A["#"]||c["@"];return}j.acks=(j.acks||0)+1,(j.err=c.err)&&(c["@"]=j["#"],e(j)),j.ok=c.ok||j.ok,!j.stop&&!j.crack&&(j.crack=j.match&&j.match.push(function(){f(j)})),f(j)}function f(c){!c||!c.root||c.stun||c.acks!==c.all||c.root.on("in",{"@":c["#"],err:c.err,ok:c.err?o:c.ok||{"":1}})}var l="Error: Invalid graph!",m=function(c){return" '"+(""+c).slice(0,9)+"...' "},b=JSON.stringify,k=2147483647,D=i.state,C=0,$,_=function(){C>999&&C/-($-($=+new Date))>1&&(i.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),_=function(){C=0})}}(),function(){i.on.get=function(v,g){var w=g._,e=v.get,n=e["#"],f=w.graph[n],l=e["."],m=w.next||(w.next={}),b=m[n],k=v._||{},D=k.DBG=v.DBG;if(D&&(D.g=+new Date),!f)return w.on("get",v);if(l){if((typeof l!="string"||o===f[l])&&!((b||"").next||"")[l]){w.on("get",v);return}f=s({},l,t(f,l),f[l],n)}f&&r(v,f),w.on("get",v)};function r(v,g){var w=+new Date,e=v._||{},n=e.DBG=v.DBG,f=v["#"],l=p(9),m=Object.keys(g||"").sort(),b=((g||"")._||"")["#"];m.length;var k=v.$._.root,D=g===k.graph[b];console.STAT&&console.STAT(w,((n||e).gk=+new Date)-w,"got keys"),g&&function C(){w=+new Date;for(var $=0,_,c={},T;$<9&&(_=m[$++]);)s(c,_,t(g,_),g[_],b);m=m.slice($),(T={})[b]=c,c=T;var j;D&&(j=function(){},j.ram=j.faith=!0),T=m.length,console.STAT&&console.STAT(w,-(w-(w=+new Date)),"got copied some"),n&&(n.ga=+new Date),k.on("in",{"@":f,"#":l,put:c,"%":T?l=p(9):o,$:k.$,_:j,DBG:n,FOO:1}),console.STAT&&console.STAT(w,+new Date-w,"got in"),T&&setTimeout.turn(C)}(),g||k.on("in",{"@":v["#"]})}i.on.get.ack=r}(),function(){i.chain.opt=function(r){r=r||{};var v=this,g=v._,w=r.peers||r;return Object.plain(r)||(r={}),Object.plain(g.opt)||(g.opt=r),typeof w=="string"&&(w=[w]),Object.plain(g.opt.peers)||(g.opt.peers={}),w instanceof Array&&(r.peers={},w.forEach(function(e){var n={};n.id=n.url=e,r.peers[e]=g.opt.peers[e]=g.opt.peers[e]||n})),a(r,function e(n){var f=this[n];if(this&&this.hasOwnProperty(n)||typeof f=="string"||Object.empty(f)){this[n]=f;return}f&&f.constructor!==Object&&!(f instanceof Array)||a(f,e)}),g.opt.from=r,i.on("opt",g),g.opt.uuid=g.opt.uuid||function(e){return i.state().toString(36).replace(".","")+String.random(e||12)},v}}();var a=function(r,v){Object.keys(r).forEach(v,r)},p=String.random,y=setTimeout.turn,h=i.valid,t=i.state.is,s=i.state.ify,o,u={},S;i.log=function(){return!i.log.off&&S.log.apply(S,arguments),[].slice.call(arguments).join(" ")},i.log.once=function(r,v,g){return(g=i.log.once)[r]=g[r]||0,g[r]++||i.log(v)},typeof window<"u"&&((window.GUN=window.Gun=i).window=window);try{typeof O<"u"&&(O.exports=i)}catch{}d.exports=i,(i.window||{}).console=(i.window||{}).console||{log:function(){}},(S=console).only=function(r,v){return S.only.i&&r===S.only.i&&S.only.i++&&(S.log.apply(S,arguments)||v)},i.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(x,"./root"),x(function(d){var i=x("./root");i.chain.back=function(y,h){var t;if(y=y||1,y===-1||y===1/0)return this._.root.$;if(y===1)return(this._.back||this._).$;var s=this,o=s._;if(typeof y=="string"&&(y=y.split(".")),y instanceof Array){var u=0,S=y.length,t=o;for(u;u<S;u++)t=(t||a)[y[u]];return p!==t?h?s:t:(t=o.back)?t.$.back(y,h):void 0}if(typeof y=="function"){for(var r,t={back:o};(t=t.back)&&p===(r=y(t,h)););return r}return typeof y=="number"?(o.back||o).$.back(y-1):this};var a={},p})(x,"./back"),x(function(d){var i=x("./root");i.chain.chain=function(e){var n=this,f=n._,l=new(e||n).constructor(n),m=l._,b;return m.root=b=f.root,m.id=++b.once,m.back=n._,m.on=i.on,m.on("in",i.on.in,m),m.on("out",i.on.out,m),l};function a(e){var n,f=this.as,l=f.back,m=f.root,b;if(e.$||(e.$=f.$),this.to.next(e),f.err){f.on("in",{put:f.put=o,$:f.$});return}if(n=e.get){if(m.pass&&(m.pass[f.id]=f),f.lex&&Object.keys(f.lex).forEach(function(k){b[k]=f.lex[k]},b=e.get=e.get||{}),n["#"]||f.soul){if(n["#"]=n["#"]||f.soul,e["#"]||(e["#"]=u(9)),l=m.$.get(n["#"])._,n=n["."]){if(r(l.put,n)&&(b=l.ask&&l.ask[n],(l.ask||(l.ask={}))[n]=l.$.get(n)._,l.on("in",{get:n,put:{"#":l.soul,".":n,":":l.put[n],">":g(m.graph[l.soul],n)}}),b))return}else{if(b=l.ask&&l.ask[""],(l.ask||(l.ask={}))[""]=l,o!==l.put&&(l.on("in",l),b))return;e.$=l.$}return m.ask(t,e),m.on("in",e)}if(n["."])return f.get?(e={get:{".":f.get},$:f.$},(l.ask||(l.ask={}))[f.get]=e.$._,l.on("out",e)):(e={get:f.lex?e.get:{},$:f.$},l.on("out",e));if((f.ask||(f.ask={}))[""]=f,f.get)return n["."]=f.get,(l.ask||(l.ask={}))[f.get]=e.$._,l.on("out",e)}return l.on("out",e)}i.on.out=a;function p(e,n){n=n||this.as;var f=n.root,l=e.$||(e.$=n.$),m=(l||"")._||s,b=e.put||"",k=b["#"],D=b["."],C=o!==b["="]?b["="]:b[":"],$=b[">"]||-1/0,_;if(o!==e.put&&(o===b["#"]||o===b["."]||o===b[":"]&&o===b["="]||o===b[">"])){if(!S(b)){if(!(k=((b||"")._||"")["#"])){console.log("chain not yet supported for",b,"...",e,n);return}return l=n.root.$.get(k),setTimeout.each(Object.keys(b).sort(),function(c){c=="_"||o===($=g(b,c))||n.on("in",{$:l,put:{"#":k,".":c,"=":b[c],">":$},VIA:e})})}n.on("in",{$:m.back.$,put:{"#":k=m.back.soul,".":D=m.has||m.get,"=":b,">":g(m.back.put,D)},via:e});return}(e.seen||"")[n.id]||((e.seen||(e.seen=function(){}))[n.id]=n,n!==m&&(Object.keys(e).forEach(function(c){b[c]=e[c]},b={}),b.get=n.get||b.get,!n.soul&&!n.has?b.$$$=b.$$$||n.$:m.soul&&(b.$=n.$,b.$$=b.$$||m.$),e=b),h(e,n),(n.soul||e.$$)&&$>=g(f.graph[k],D)&&((b=f.$.get(k)._).put=w(b.put,D,$,C,k)),!m.soul&&$>=g(f.graph[k],D)&&(_=(f.$.get(k)._.next||"")[D])&&(_.put=C,typeof(b=S(C))=="string"&&(_.put=f.$.get(b)._.put||C)),this.to&&this.to.next(e),n.any&&setTimeout.each(Object.keys(n.any),function(c){(c=n.any[c])&&c(e)},0,99),n.echo&&setTimeout.each(Object.keys(n.echo),function(c){(c=n.echo[c])&&c.on("in",e)},0,99),((e.$$||"")._||m).soul&&(_=n.next)&&(_=_[D])&&(b={},Object.keys(e).forEach(function(c){b[c]=e[c]}),b.$=(e.$$||e.$).get(b.get=D),delete b.$$,delete b.$$$,_.on("in",b)),y(e,n))}i.on.in=p;function y(e,n){if(n=n||this.as||e.$._,!(e.$$&&this!==i.on)&&!(!e.put||n.soul)){var f=e.put||"",l=f["="]||f[":"],m,b=n.root,k=b.$.get(f["#"]).get(f["."])._;if(typeof(l=S(l))!="string"){this===i.on&&((k.echo||(k.echo={}))[n.id]=n);return}if(!((k.echo||(k.echo={}))[n.id]&&!(b.pass||"")[n.id])){if(m=b.pass){if(m[l+n.id])return;m[l+n.id]=1}(k.echo||(k.echo={}))[n.id]=n,n.has&&(n.link=l);var D=b.$.get(k.link=l)._;(D.echo||(D.echo={}))[k.id]=k;var m=n.ask||"";(m[""]||n.lex)&&D.on("out",{get:{"#":l}}),setTimeout.each(Object.keys(m),function($,_){!$||!(_=m[$])||_.on("out",{get:{"#":l,".":$}})},0,99)}}}i.on.link=y;function h(e,n){var f=e.put||"",l=o!==f["="]?f["="]:f[":"],m=n.root,b,k;if(o===l){if(n.soul&&o!==n.put||(k=(e.$$||e.$||"")._||"",e["@"]&&(o!==k.put||o!==n.put)))return;(b=n.link||e.linked)&&delete(m.$.get(b)._.echo||"")[n.id],n.has&&(n.link=null),n.put=o,setTimeout.each(Object.keys(n.next||""),function(D,C){(C=n.next[D])&&(b&&delete(m.$.get(b).get(D)._.echo||"")[C.id],C.on("in",{get:D,put:o,$:C.$}))},0,99);return}n.soul||e.$$||(b=S(l),k=e.$._||"",!((b===k.link||n.has&&!k.link)&&!((m.pass||"")[n.id]&&typeof b!="string"))&&(delete(k.echo||"")[n.id],h({get:n.get,put:o,$:e.$,linked:e.linked=e.linked||k.link},n)))}i.on.unlink=h;function t(e,n){var f=this.as,l=f.$._;l.root;var m=f.get||"",b=(e.put||"")[m["#"]]||"";if(!e.put||typeof m["."]=="string"&&o===b[m["."]]){if(o!==l.put||!l.soul&&!l.has)return;l.ack=(l.ack||0)+1,l.on("in",{get:l.get,put:l.put=o,$:l.$,"@":e["@"]});return}(e._||{}).miss=1,i.on.put(e)}var s={},o,u=String.random,S=i.valid,r=function(e,n){return e&&Object.prototype.hasOwnProperty.call(e,n)},v=i.state,g=v.is,w=v.ify})(x,"./chain"),x(function(d){var i=x("./root");i.chain.get=function(o,u,S){var r,v;if(typeof o=="string"){if(o.length==0)return(r=this.chain())._.err={err:i.log("0 length key!",o)},u&&u.call(r,r._.err),r;var g=this,w=g._,e=w.next||h;(r=e[o])||(r=o&&a(o,g)),r=r&&r.$}else if(typeof o=="function"){let b=function(D,C,$){if(!b.stun&&!((B=f.pass)&&!B[l])){var _=D.$._,c=(D.$$||"")._,T=(c||_).put,j=!_.has&&!_.soul,A={},B;if((j||s===T)&&(T=s===((B=D.put)||"")["="]?s===(B||"")[":"]?B:B[":"]:B["="]),typeof(B=i.valid(T))=="string"&&(T=s===(B=f.$.get(B)._.put)?n.not?s:T:B),!(n.not&&s===T)){if(s===n.stun){if((B=f.stun)&&B.on&&(w.$.back(function(N){if(B.on(""+N.id,A={}),(A.run||0)<b.id)return A}),!A.run&&B.on(""+_.id,A={}),!A.run&&c&&B.on(""+c.id,A={}),b.id>A.run&&((!A.stun||A.stun.end)&&(A.stun=B.on("stun"),A.stun=A.stun&&A.stun.last),A.stun&&!A.stun.end))){(A.stun.add||(A.stun.add={}))[l]=function(){b(D,C,1)};return}if(s===T&&($=0),(B=f.hatch)&&!B.end&&s===n.hatch&&!$){if(m[_.$._.id])return;m[_.$._.id]=1,B.push(function(){b(D,C,1)});return}m={}}if(f.pass){if(f.pass[l+_.id])return;f.pass[l+_.id]=1}if(n.on){n.ok.call(_.$,T,_.get,D,C||b);return}if(n.v2020){n.ok(D,C||b);return}Object.keys(D).forEach(function(N){B[N]=D[N]},B={}),D=B,D.put=T,n.ok.call(n.as,D,C||b)}}};if(u===!0)return p(this,o,u,S),this;r=this;var w=r._,n=u||{},f=w.root,l;n.at=w,n.ok=o;var m={};return b.at=w,(w.any||(w.any={}))[l=String.random(7)]=b,b.off=function(){b.stun=1,w.any&&delete w.any[l]},b.rid=y,b.id=n.run||++f.once,v=f.pass,(f.pass={})[l]=1,n.out=n.out||{get:{}},w.on("out",n.out),f.pass=v,r}else{if(typeof o=="number")return this.get(""+o,u,S);if(typeof(v=t(o))=="string")return this.get(v,u,S);(v=this.get.next)&&(r=v(this,o))}return r?(u&&typeof u=="function"&&r.get(u,S),r):((r=this.chain())._.err={err:i.log("Invalid get request!",o)},u&&u.call(r,r._.err),r)};function a(o,u){var S=u._,r=S.next,v=u.chain(),g=v._;return r||(r=S.next={}),r[g.get=o]=g,u===S.root.$?g.soul=o:(S.soul||S.has)&&(g.has=o),g}function p(o,u,S,r){var v=o._,g=0,w;return(w=v.soul||v.link)?u(w,r,v):v.jam?v.jam.push([u,r]):(v.jam=[[u,r]],o.get(function(e,n){if(!(s===e.put&&!v.root.opt.super&&(w=Object.keys(v.root.opt.peers).length)&&++g<=w)){n.rid(e);var f=(f=e.$)&&f._||{},l=0,m;for(w=v.jam,delete v.jam;m=w[l++];){var b=m[0];m=m[1],b&&b(f.link||f.soul||i.valid(e.put)||((e.put||{})._||{})["#"],m,e,n)}}},{out:{get:{".":!0}}}),o)}function y(o){var u=this.at||this.on;if(!o||u.soul||u.has)return this.off();if(o=(o=(o=o.$||o)._||o).id){u.map;var S;if((S=this.seen||(this.seen={}))[o])return!0;S[o]=!0}}var h={},t=i.valid,s})(x,"./get"),x(function(d){var i=x("./root");i.chain.put=function(r,v,g){var w=this,e=w._,n=e.root;g=g||{},g.root=e.root,g.run||(g.run=n.once),a(g,e.id),g.ack=g.ack||v,g.via=g.via||w,g.data=g.data||r,g.soul||(g.soul=e.soul||typeof v=="string"&&v);var f=g.state=g.state||i.state();return typeof r=="function"?(r(function(l){g.data=l,w.put(t,t,g)}),w):g.soul?(g.$=n.$.get(g.soul),g.todo=[{it:g.data,ref:g.$}],g.turn=g.turn||o,g.ran=g.ran||p,function l(){var m=g.todo,b=m.pop(),k=b.it;b.ref&&b.ref._.id;var D,C,$,_,c;if(a(g,b.ref),(_=b.todo)&&(C=_.pop(),k=k[C],_.length&&m.push(b)),C&&(m.path||(m.path=[])).push(C),!(D=u(k))&&!(c=i.is(k))){if(!Object.plain(k)){p.err(g,"Invalid data: "+h(k)+" at "+(g.via.back(function(B){B.get&&_.push(B.get)},_=[])||_.join("."))+"."+(m.path||[]).join("."));return}for(var T=g.seen||(g.seen=[]),j=T.length;j--;)if(k===(_=T[j]).it){D=k=_.link;break}}if(C&&D)b.node=S(b.node,C,f,k);else{let B=function(N,G){var E=$.link["#"];G&&(G.off(),G.rid(N));var U=E||N.soul||(_=(N.$$||N.$)._||"").soul||_.link||((_=_.put||"")._||"")["#"]||_["#"]||((_=N.put||"")&&N.$$?_["#"]:(_["="]||_[":"]||"")["#"]);if(!E&&a(g,N.$),!U&&!b.link["#"]){(b.wait||(b.wait=[])).push(function(){B(N,G)});return}U||(U=[],(N.$$||N.$).back(function(P){if(_=P.soul||P.link)return U.push(_);U.push(P.get)}),U=U.reverse().join("/")),$.link["#"]=U,!c&&(((g.graph||(g.graph={}))[U]=$.node||($.node={_:{}}))._["#"]=U),delete g.wait[A],$.wait&&setTimeout.each($.wait,function(P){P&&P()}),g.ran(g)};if(!g.seen){p.err(g,"Data at root of graph must be a node (an object).");return}g.seen.push($={it:k,link:{},todo:c?[]:Object.keys(k).sort().reverse(),path:(m.path||[]).slice(),up:b}),b.node=S(b.node,C,f,$.link),!c&&$.todo.length&&m.push($);var A=g.seen.length;(g.wait||(g.wait={}))[A]="",_=($.ref=c?k:C?b.ref.get(C):b.ref)._,(_=k&&(k._||"")["#"]||_.soul||_.link)?B({soul:_}):$.ref.get(B,{run:g.run,v2020:1,out:{get:{".":" "}}})}if(!m.length)return g.ran(g);g.turn(l)}(),w):(y(g),w)};function a(r,v){if(v){v=(v._||"").id||v;var g=r.root.stun||(r.root.stun={on:i.on}),w={},e;r.stun||(r.stun=g.on("stun",function(){})),(e=g.on(""+v))&&e.the.last.next(w),!(w.run>=r.run)&&g.on(""+v,function(n){if(r.stun.end){this.off(),this.to.next(n);return}n.run=n.run||r.run,n.stun=n.stun||r.stun})}}function p(r){if(r.err){p.end(r.stun,r.root);return}if(!(r.todo.length||r.end||!Object.empty(r.wait))){r.end=1;var v=r.$.back(-1)._,g=v.root,w=v.ask(function(l){g.on("ack",l),l.err&&!l.lack&&i.log(l),++e>(r.acks||0)&&this.off(),r.ack&&r.ack(l,this)},r.opt),e=0,n=r.stun,f;(f=function(){n&&(p.end(n,g),setTimeout.each(Object.keys(n=n.add||""),function(l){(l=n[l])&&l()}))}).hatch=f,r.ack&&!r.ok&&(r.ok=r.acks||9),r.via._.on("out",{put:r.out=r.graph,ok:r.ok&&{"@":r.ok+1},opt:r.opt,"#":w,_:f})}}p.end=function(r,v){r.end=s,r.the.to===r&&r===r.the.last&&delete v.stun,r.off()},p.err=function(r,v){(r.ack||s).call(r,r.out={err:r.err=i.log(v)}),r.ran(r)};function y(r){var v=r.via._,g;r.via=r.via.back(function(w){if(w.soul||!w.get)return w.$;g=r.data,(r.data={})[w.get]=g}),(!r.via||!r.via._.soul)&&(r.via=v.root.$.get(((r.data||"")._||"")["#"]||v.$.back("opt.uuid")())),r.via.put(r.data,r.ack,r)}function h(r,v){return r&&(v=r.constructor)&&v.name||typeof r}var t,s=function(){},o=setTimeout.turn,u=i.valid,S=i.state.ify})(x,"./put"),x(function(d){var i=x("./root");x("./chain"),x("./back"),x("./put"),x("./get"),d.exports=i})(x,"./index"),x(function(d){var i=x("./index");i.chain.on=function(y,h,t,s){var o=this,u=o._;u.root;var S;if(typeof y=="string")return h?(S=u.on(y,h,t||u,s),t&&t.$&&(t.subs||(t.subs=[])).push(S),o):u.on(y);var r=h;return(r=r===!0?{change:!0}:r||{}).not=1,r.on=1,o.get(y,r),o},i.chain.once=function(y,h){if(h=h||{},!y)return a(this);var t=this,s=t._,o=s.root;s.put;var u=String.random(7),S;return t.get(function(r,v,g,w){var e=this,n=e._,f=n.one||(n.one={});if(w.stun||f[u]==="")return;if((S=i.valid(r))===!0){l();return}if(typeof S=="string")return;clearTimeout((s.one||"")[u]),clearTimeout(f[u]),f[u]=setTimeout(l,h.wait||99);function l(m){if(!n.has&&!n.soul&&(n={put:r,get:v}),p===(S=n.put)&&(S=((g.$$||"")._||"").put),typeof i.valid(S)=="string"&&(S=o.$.get(S)._.put,S===p&&!m)){f[u]=setTimeout(function(){l(1)},h.wait||99);return}w.stun||f[u]!==""&&(f[u]="",(s.soul||s.has)&&w.off(),y.call(e,S,n.get),clearTimeout(f[u]))}},{on:1}),t};function a(y,h,t){return i.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(t=y.chain())._.nix=y.once(function(s,o){t._.on("in",this._)}),t._.lex=y._.lex,t}i.chain.off=function(){var y=this,h=y._,t,s=h.back;if(s)return h.ack=0,(t=s.next)&&t[h.get]&&delete t[h.get],(t=s.any)&&(delete s.any,s.any={}),(t=s.ask)&&delete t[h.get],(t=s.put)&&delete t[h.get],(t=h.soul)&&delete s.root.graph[t],(t=h.map)&&Object.keys(t).forEach(function(o,u){u=t[o],u.link&&s.root.$.get(u.link).off()}),(t=h.next)&&Object.keys(t).forEach(function(o,u){u=t[o],u.$.off()}),h.on("off",{}),y};var p})(x,"./on"),x(function(d){var i=x("./index"),a=i.chain.get.next;i.chain.get.next=function(t,s){var o;return Object.plain(s)?(o=((o=s["#"])||"")["="]||o)?t.get(o):((o=t.chain()._).lex=s,t.on("in",function(u){String.match(u.get||(u.put||"")["."],s["."]||s["#"]||s)&&o.on("in",u),this.to.next(u)}),o.$):(a||y)(t,s)},i.chain.map=function(t,s,o){var u=this,S=u._,r,v;return Object.plain(t)&&(r=t["."]?t:{".":t},t=h),t?(i.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),v=u.chain(),u.map().on(function(g,w,e,n){var f=(t||y).call(this,g,w,e,n);if(h!==f){if(g===f)return v._.on("in",e);if(i.is(f))return v._.on("in",f._);var l={};Object.keys(e.put).forEach(function(m){l[m]=e.put[m]},l),l["="]=f,v._.on("in",{get:w,put:l})}}),v):((v=S.each)||((S.each=v=u.chain())._.lex=r||v._.lex||S.lex,v._.nix=u.back("nix"),u.on("in",p,v._)),v)};function p(t){this.to.next(t);var s=this.as,o=t.$,u=o._,S=t.put,r;!u.soul&&!t.$$||(r=s.lex)&&!String.match(t.get||(S||"")["."],r["."]||r["#"]||r)||i.on.link(t,s)}var y=function(){},h})(x,"./map"),x(function(d){var i=x("./index");i.chain.set=function(a,p,y){var h=this,t=h.back(-1),s,o;return p=p||function(){},y=y||{},y.item=y.item||a,(s=((a||"")._||"")["#"])&&((a={})["#"]=s),typeof(o=i.valid(a))=="string"?h.get(s=o).put(a,p,y):i.is(a)?(h.put(function(u){a.get(function(S,r,v){if(!S)return p.call(h,{err:i.log('Only a node can be linked! Not "'+v.put+'"!')});(o={})[S]={"#":S},u(o)},!0)}),a):(Object.plain(a)&&(a=t.get(s=h.back("opt.uuid")()).put(a)),h.get(s||t.back("opt.uuid")(7)).put(a,p,y))}})(x,"./set"),x(function(d){x("./shim");var i=function(){},a=JSON.parseAsync||function(t,s,o){var u,S=+new Date;try{s(u,JSON.parse(t,o),p.sucks(+new Date-S))}catch(r){s(r)}},p=JSON.stringifyAsync||function(t,s,o,u){var S,r=+new Date;try{s(S,JSON.stringify(t,o,u),p.sucks(+new Date-r))}catch(v){s(v)}};p.sucks=function(t){t>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),p.sucks=i)};function y(t){var s=function(){},o=t.opt||{};o.log=o.log||console.log,o.gap=o.gap||o.wait||0,o.max=o.max||(o.memory?o.memory*999*999:3e8)*.3,o.pack=o.pack||o.max*.01*.01,o.puff=o.puff||9;var u=setTimeout.turn||setTimeout,S=t.dup,r=S.check,v=S.track,g=s.hear=function(n,f){if(n){if(o.max<=n.length)return s.say({dam:"!",err:"Message too big!"},f);s===this&&(g.d+=n.length||0,++g.c);var l=f.SH=+new Date,m=n[0],b;if(m==="["){a(n,function(k,D){if(k||!D)return s.say({dam:"!",err:"DAM JSON parse error."},f);console.STAT&&console.STAT(+new Date,D.length,"# on hear batch");var C=o.puff;(function $(){for(var _=+new Date,c=0,T;c<C&&(T=D[c++]);)s.hear(T,f);D=D.slice(c),console.STAT&&console.STAT(_,+new Date-_,"hear loop"),w(f),D.length&&u($,0)})()}),n="";return}if(m==="{"||(n["#"]||Object.plain(n))&&(b=n)){if(b)return g.one(b,f,l);a(n,function(k,D){if(k||!D)return s.say({dam:"!",err:"DAM JSON parse error."},f);g.one(D,f,l)});return}}};g.one=function(n,f,l){var m,b,k,D,C;if(n.DBG&&(n.DBG=C={DBG:n.DBG}),C&&(C.h=l),C&&(C.hp=+new Date),(m=n["#"])||(m=n["#"]=String.random(9)),!(k=r(m))&&(b=n["##"],!(b&&(k=n["@"]||n.get&&m)&&S.check(D=k+b)))){if((n._=function(){}).via=s.leap=f,(k=n["><"])&&typeof k=="string"&&k.slice(0,99).split(",").forEach(function(_){this[_]=1},n._.yo={}),k=n.dam){(k=s.hear[k])&&k(n,f,t),v(m);return}(k=n.ok)&&(n._.near=k["/"]);var l=+new Date;C&&(C.is=l),f.SI=m,v.ed=function(_){m===_&&(v.ed=0,(_=S.s[m])&&(_.via=f,n.get&&(_.it=n)))},t.on("in",s.last=n),C&&(C.hd=+new Date),console.STAT&&console.STAT(l,+new Date-l,n.get?"msg get":n.put?"msg put":"msg"),v(m),D&&v(D),s.leap=s.last=null}},g.c=g.d=0,function(){var n=0,f;s.hash=function(b,k){var D,C,$,_=+new Date;p(b.put,function c(T,j){var A=(C||(C=$=j||"")).slice(0,32768);if(D=String.hash(A,D),C=C.slice(32768),C){u(c,0);return}console.STAT&&console.STAT(_,+new Date-_,"say json+hash"),b._.$put=$,b["##"]=D,s.say(b,k),delete b._.$put},l)};function l(b,k){var D;return k instanceof Object?(Object.keys(k).sort().forEach(m,{to:D={},on:k}),D):k}function m(b){this.to[b]=this.on[b]}s.say=function(b,k){var D;if((D=this)&&(D=D.to)&&D.next&&D.next(b),!b)return!1;var C,$,_,c=b["@"],T=b._||(b._=function(){}),j=b.DBG,A=+new Date;if(T.y=T.y||A,k||j&&(j.y=A),(C=b["#"])||(C=b["#"]=String.random(9)),!f&&v(C),!($=b["##"])&&h!==b.put&&!T.via&&c){s.hash(b,k);return}if(!k&&c&&(k=(D=S.s[c])&&(D.via||(D=D.it)&&(D=D._)&&D.via)||(D=s.last)&&c===D["#"]&&s.leap),!k&&c)return S.s[c]?void 0:(console.STAT&&console.STAT(+new Date,++n,"total no peer to ack to"),!1);if(c&&!b.put&&!$&&((S.s[c]||"").it||"")["##"])return!1;if(!k&&s.way)return s.way(b);if(j&&(j.yh=+new Date),!(_=T.raw)){s.raw(b,k);return}if(j&&(j.yr=+new Date),!k||!k.id){if(!Object.plain(k||o.peers))return!1;var A=+new Date;o.puff;var B=o.peers,N=Object.keys(k||o.peers||{});console.STAT&&console.STAT(A,+new Date-A,"peer keys"),function U(){var P=+new Date;f=1;var R=T.raw;T.raw=_;for(var M=0,I;M<9&&(I=(N||"")[M++]);)(I=B[I]||(k||"")[I])&&s.say(b,I);T.raw=R,f=0,N=N.slice(M),console.STAT&&console.STAT(P,+new Date-P,"say loop"),N.length&&(u(U,0),c&&v(c))}();return}if(!k.wire&&s.wire&&s.wire(k),C!==k.last){if(k.last=C,k===T.via||(D=T.yo)&&(D[k.url]||D[k.pid]||D[k.id]))return!1;if(console.STAT&&console.STAT(A,((j||T).yp=+new Date)-(T.y||A),"say prep"),!f&&c&&v(c),k.batch){if(k.tail=(D=k.tail||0)+_.length,k.tail<=o.pack){k.batch+=(D?",":"")+_;return}w(k)}k.batch="[";var G=+new Date;setTimeout(function(){console.STAT&&console.STAT(G,+new Date-G,"0ms TO"),w(k)},o.gap),e(_,k),console.STAT&&c===k.SI&&console.STAT(A,+new Date-k.SH,"say ack")}},s.say.c=s.say.d=0,s.raw=function(b,k){if(!b)return"";var D=b._||{},C,$;if($=D.raw)return $;if(typeof b=="string")return b;var _=b["##"],c=b["@"];if(_&&c){if(!D.via&&r(c+_))return!1;if($=(S.s[c]||"").it){if(_===$["##"])return!1;$["##"]||($["##"]=_)}}if(!b.dam&&!b["@"]){var T=0,j=[];$=o.peers;for(var A in $){var B=$[A];if(j.push(B.url||B.pid||B.id),++T>6)break}T>1&&(b["><"]=j.join())}if(b.put&&($=b.ok)&&(b.ok={"@":($["@"]||1)-1,"/":$["/"]==b._.near?s.near:$["/"]}),C=D.$put){$={},Object.keys(b).forEach(function(G){$[G]=b[G]}),$.put=":])([:",p($,function(G,E){if(!G){var U=+new Date;$=E.indexOf('"put":":])([:"'),N(h,E=E.slice(0,$+6)+C+E.slice($+14)),console.STAT&&console.STAT(U,+new Date-U,"say slice")}});return}p(b,N);function N(G,E){G||(D.raw=E,s.say(b,k))}}}();function w(n){var f=n.batch,l=typeof f=="string";if(l&&(f+="]"),n.batch=n.tail=null,!!f&&!(l?3>f.length:!f.length)){if(!l)try{f=f.length===1?f[0]:JSON.stringify(f)}catch(m){return o.log("DAM JSON stringify error",m)}f&&e(f,n)}}function e(n,f){try{var l=f.wire;f.say?f.say(n):l.send&&l.send(n),s.say.d+=n.length||0,++s.say.c}catch{(f.queue=f.queue||[]).push(n)}}return s.near=0,s.hi=function(n){var f=n.wire,l;if(!f){s.wire(n.length&&{url:n,id:n}||n);return}n.id?o.peers[n.url||n.id]=n:(l=n.id=n.id||n.url||String.random(9),s.say({dam:"?",pid:t.opt.pid},o.peers[l]=n),delete S.s[n.last]),n.met||(s.near++,n.met=+new Date,t.on("hi",n)),l=n.queue,n.queue=[],setTimeout.each(l||[],function(m){e(m,n)},0,9)},s.bye=function(n){n.met&&--s.near,delete n.met,t.on("bye",n);var f=+new Date;f=f-(n.met||f),s.bye.time=((s.bye.time||f)+f)/2},s.hear["!"]=function(n,f){o.log("Error:",n.err)},s.hear["?"]=function(n,f){n.pid&&(f.pid||(f.pid=n.pid),n["@"])||(s.say({dam:"?",pid:o.pid,"@":n["#"]},f),delete S.s[f.last])},s.hear.mob=function(n,f){if(n.peers){var l=Object.keys(n.peers),m=l[Math.random()*l.length>>0];m&&(s.bye(f),s.hi(m))}},t.on("create",function(n){n.opt.pid=n.opt.pid||String.random(9),this.to.next(n),n.on("out",s.say)}),t.on("bye",function(n,f){n=o.peers[n.id||n]||n,this.to.next(n),n.bye?n.bye():(f=n.wire)&&f.close&&f.close(),delete o.peers[n.id],n.wire=null}),t.on("bye",function(n,f){this.to.next(n),(f=console.STAT)&&(f.peers=s.near),(f=n.url)&&setTimeout(function(){},o.lack||9e3)}),t.on("hi",function(n,f){if(this.to.next(n),(f=console.STAT)&&(f.peers=s.near),!o.super){var l=Object.keys(t.next||"");l.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(l,function(m){var b=t.next[m];if(o.super||(b.ask||"")[""]){s.say({get:{"#":m}},n);return}setTimeout.each(Object.keys(b.ask||""),function(k){k&&s.say({"##":String.hash((t.graph[m]||"")[k]),get:{"#":m,".":k}},n)})})}}),s}var h;try{d.exports=y}catch{}})(x,"./mesh"),x(function(d){var i=x("./index");i.Mesh=x("./mesh"),i.on("opt",function(p){if(this.to.next(p),p.once)return;var y=p.opt;if(y.WebSocket===!1)return;var h=i.window||{},t=y.WebSocket||h.WebSocket||h.webkitWebSocket||h.mozWebSocket;if(!t)return;y.WebSocket=t;var s=y.mesh=y.mesh||i.Mesh(p);s.wire||y.wire,s.wire=y.wire=o;function o(v){try{if(!v||!v.url)return w&&w(v);var g=v.url.replace(/^http/,"ws"),w=v.wire=new y.WebSocket(g);return w.onclose=function(){S(v),y.mesh.bye(v)},w.onerror=function(e){S(v)},w.onopen=function(){y.mesh.hi(v)},w.onmessage=function(e){e&&y.mesh.hear(e.data||e,v)},w}catch{y.mesh.bye(v)}}setTimeout(function(){!y.super&&p.on("out",{dam:"hi"})},1);var u=2*999;function S(v){clearTimeout(v.defer),y.peers[v.url]&&(r&&v.retry<=0||(v.retry=(v.retry||y.retry+1||60)-(-v.tried+(v.tried=+new Date)<u*4?1:0),v.defer=setTimeout(function g(){if(r&&r.hidden)return setTimeout(g,u);o(v)},u)))}var r=""+a!=typeof document&&document});var a})(x,"./websocket"),x(function(d){if(!(typeof Gun>"u")){var i=function(){},a;try{a=(Gun.window||i).localStorage}catch{}a||(Gun.log("Warning: No localStorage exists to persist data to!"),a={setItem:function(y,h){this[y]=h},removeItem:function(y){delete this[y]},getItem:function(y){return this[y]}});var p=JSON.stringifyAsync||function(y,h,t,s){var o;try{h(o,JSON.stringify(y,t,s))}catch(u){h(u)}};Gun.on("create",function y(h){this.to.next(h);var t=h.opt;h.graph;var s=[],o,u,S,r;if(t.localStorage===!1)return;t.prefix=t.file||"gun/";try{o=y[t.prefix]=y[t.prefix]||JSON.parse(S=a.getItem(t.prefix))||{}}catch{o=y[t.prefix]={}}S=(S||"").length,h.on("get",function(g){this.to.next(g);var w=g.get,e,n,f,l;!w||!(e=w["#"])||(n=o[e]||l,n&&(f=w["."])&&!Object.plain(f)&&(n=Gun.state.ify({},f,Gun.state.is(n,f),n[f],e)),Gun.on.get.ack(g,n))}),h.on("put",function(g){this.to.next(g);var w=g.put,e=w["#"],n=w["."],f=g["#"],l=g.ok||"";if(o[e]=Gun.state.ify(o[e],n,w[">"],w[":"],e),r&&S>4999880){h.on("in",{"@":f,err:"localStorage max!"});return}!g["@"]&&(!g._.via||Math.random()<l["@"]/l["/"])&&s.push(f),!u&&(u=setTimeout(v,9+S/333))});function v(){if(!s.length&&((setTimeout.turn||"").s||"").length){setTimeout(v,99);return}var g=s;clearTimeout(u),u=!1,s=[],p(o,function(w,e){try{!w&&a.setItem(t.prefix,e)}catch(n){w=r=n||"localStorage failure"}w&&(Gun.log(w+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),h.on("localStorage:error",{err:w,get:t.prefix,put:o})),S=e.length,setTimeout.each(g,function(n){h.on("in",{"@":n,err:w,ok:0})},0,99)})}})}})(x,"./localStorage")})(),function(){var x;if(""+x!=typeof Gun){var O=function(c){console.warn("Warning! Deprecated internal utility will break in next version:",c)},d=Gun;d.fn=d.fn||{is:function(c){return O("fn"),!!c&&typeof c=="function"}},d.bi=d.bi||{is:function(c){return O("bi"),c instanceof Boolean||typeof c=="boolean"}},d.num=d.num||{is:function(c){return O("num"),!i(c)&&(c-parseFloat(c)+1>=0||c===1/0||c===-1/0)}},d.text=d.text||{is:function(c){return O("text"),typeof c=="string"}},d.text.ify=d.text.ify||function(c){return O("text.ify"),d.text.is(c)?c:typeof JSON<"u"?JSON.stringify(c):c&&c.toString?c.toString():c},d.text.random=d.text.random||function(c,T){O("text.random");var j="";for(c=c||24,T=T||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";c>0;)j+=T.charAt(Math.floor(Math.random()*T.length)),c--;return j},d.text.match=d.text.match||function(c,T){var j,A;return O("text.match"),typeof c!="string"?!1:(typeof T=="string"&&(T={"=":T}),T=T||{},j=T["="]||T["*"]||T[">"]||T["<"],c===j?!0:A!==T["="]?!1:(j=T["*"]||T[">"]||T["<"],c.slice(0,(j||"").length)===j?!0:A!==T["*"]?!1:A!==T[">"]&&A!==T["<"]?c>=T[">"]&&c<=T["<"]:A!==T[">"]&&c>=T[">"]||A!==T["<"]&&c<=T["<"]))},d.text.hash=d.text.hash||function(c,T){if(O("text.hash"),typeof c=="string"){if(T=T||0,!c.length)return T;for(var j=0,A=c.length,B;j<A;++j)B=c.charCodeAt(j),T=(T<<5)-T+B,T|=0;return T}},d.list=d.list||{is:function(c){return O("list"),c instanceof Array}},d.list.slit=d.list.slit||Array.prototype.slice,d.list.sort=d.list.sort||function(c){return O("list.sort"),function(T,j){return!T||!j?0:(T=T[c],j=j[c],T<j?-1:T>j?1:0)}},d.list.map=d.list.map||function(c,T,j){return O("list.map"),C(c,T,j)},d.list.index=1,d.obj=d.boj||{is:function(c){return O("obj"),c?c instanceof Object&&c.constructor===Object||Object.prototype.toString.call(c).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},d.obj.put=d.obj.put||function(c,T,j){return O("obj.put"),(c||{})[T]=j,c},d.obj.has=d.obj.has||function(c,T){return O("obj.has"),c&&Object.prototype.hasOwnProperty.call(c,T)},d.obj.del=d.obj.del||function(c,T){if(O("obj.del"),!!c)return c[T]=null,delete c[T],c},d.obj.as=d.obj.as||function(c,T,j,A){return O("obj.as"),c[T]=c[T]||(A===j?{}:j)},d.obj.ify=d.obj.ify||function(c){if(O("obj.ify"),l(c))return c;try{c=JSON.parse(c)}catch{c={}}return c},function(){var c;function T(j,A){b(this,A)&&c!==this[A]||(this[A]=j)}d.obj.to=d.obj.to||function(j,A){return O("obj.to"),A=A||{},C(j,T,A),A}}(),d.obj.copy=d.obj.copy||function(c){return O("obj.copy"),c&&JSON.parse(JSON.stringify(c))},function(){function c(T,j){var A=this.n,B;if(!(A&&(j===A||l(A)&&b(A,j)))&&B!==j)return!0}d.obj.empty=d.obj.empty||function(T,j){return O("obj.empty"),T?!C(T,c,{n:j}):!0}}(),function(){function c(A,B){if(arguments.length===2){c.r=c.r||{},c.r[A]=B;return}c.r=c.r||[],c.r.push(A)}var T=Object.keys,j;Object.keys=Object.keys||function(A){return j(A,function(B,N,G){G(N)})},d.obj.map=j=d.obj.map||function(A,B,N){O("obj.map");var G,E=0,U,P,R,M,I=typeof B=="function";if(c.r=G,T&&l(A)&&(R=T(A),M=!0),N=N||{},i(A)||R)for(U=(R||A).length;E<U;E++){var K=E+d.list.index;if(I){if(P=M?B.call(N,A[R[E]],R[E],c):B.call(N,A[E],K,c),P!==G)return P}else if(B===A[M?R[E]:E])return R?R[E]:K}else for(E in A)if(I){if(b(A,E)&&(P=N?B.call(N,A[E],E,c):B(A[E],E,c),P!==G))return P}else if(B===A[E])return E;return I?c.r:d.list.index?0:-1}}(),d.time=d.time||{},d.time.is=d.time.is||function(c){return O("time"),c?c instanceof Date:+new Date().getTime()};var n=d.fn.is,i=d.list.is,f=d.obj,l=f.is,b=f.has,C=f.map,a={};a.is=function(c){return O("val.is"),c===x?!1:c===null?!0:c===1/0?!1:h(c)||y(c)||v(c)?!0:a.link.is(c)||!1},a.link=a.rel={_:"#"},function(){a.link.is=function(T){if(O("val.link.is"),T&&T[p]&&!T._&&l(T)){var j={};if(C(T,c,j),j.id)return j.id}return!1};function c(T,j){var A=this;if(A.id)return A.id=!1;if(j==p&&h(T))A.id=T;else return A.id=!1}}(),a.link.ify=function(c){return O("val.link.ify"),D({},p,c)},d.obj.has._=".";var p=a.link._,x,y=d.bi.is,v=d.num.is,h=d.text.is,f=d.obj,l=f.is,D=f.put,C=f.map;d.val=d.val||a;var t={_:"_"};t.soul=function(c,T){return O("node.soul"),c&&c._&&c._[T||u]},t.soul.ify=function(c,T){return O("node.soul.ify"),T=typeof T=="string"?{soul:T}:T||{},c=c||{},c._=c._||{},c._[u]=T.soul||c._[u]||o(),c},t.soul._=a.link._,function(){t.is=function(T,j,A){O("node.is");var B;return l(T)&&(B=t.soul(T))?!C(T,c,{as:A,cb:j,s:B,n:T}):!1};function c(T,j){if(j!==t._){if(!a.is(T))return!0;this.cb&&this.cb.call(this.as,T,j,this.n,this.s)}}}(),function(){t.ify=function(T,j,A){return O("node.ify"),j?typeof j=="string"?j={soul:j}:typeof j=="function"&&(j={map:j}):j={},j.map&&(j.node=j.map.call(A,T,x,j.node||{})),(j.node=t.soul.ify(j.node||{},j))&&C(T,c,{o:j,as:A}),j.node};function c(T,j){var A=this.o,B,N;if(A.map){B=A.map.call(this.as,T,""+j,A.node),N===B?m(A.node,j):A.node&&(A.node[j]=B);return}a.is(T)&&(A.node[j]=T)}}();var f=d.obj,l=f.is,m=f.del,C=f.map,s=d.text,o=s.random,u=t.soul._,x;d.node=d.node||t;var S=d.state;S.lex=function(){return O("state.lex"),S().toString(36).replace(".","")},S.to=function(c,T,j){O("state.to");var A=(c||{})[T];return l(A)&&(A=$(A)),S.ify(j,T,S.is(c,T),A,t.soul(c))},function(){S.map=function(T,j,A){O("state.map");var B,N=l(N=T||j)?N:null;return T=n(T=T||j)?T:null,N&&!T?(j=v(j)?j:S(),N[w]=N[w]||{},C(N,c,{o:N,s:j}),N):(A=A||l(j)?j:B,j=v(j)?j:S(),function(G,E,U,P){if(!T)return c.call({o:U,s:j},G,E),G;T.call(A||this||{},G,E,U,P),!(b(U,E)&&B===U[E])&&c.call({o:U,s:j},G,E)})};function c(T,j){w!==j&&S.ify(this.o,j,this.s)}}();var f=d.obj;f.as;var b=f.has,l=f.is,C=f.map,$=f.copy,r=d.num,v=r.is,g=d.fn,n=g.is,w=t._,x,e={};(function(){e.is=function(j,A,B,N){return O("graph.is"),!j||!l(j)||k(j)?!1:!C(j,c,{cb:A,fn:B,as:N})};function c(j,A){if(!j||A!==t.soul(j)||!t.is(j,this.fn,this.as))return!0;this.cb&&(T.n=j,T.as=this.as,this.cb.call(T.as,j,A,T))}function T(j){j&&t.is(T.n,j,T.as)}})(),function(){e.ify=function(N,G,E){O("graph.ify");var U={path:[],obj:N};return G?typeof G=="string"?G={soul:G}:typeof G=="function"&&(G.map=G):G={},typeof E=="string"&&(G.soul=G.soul||E,E=x),G.soul&&(U.link=a.link.ify(G.soul)),G.shell=(E||{}).shell,G.graph=G.graph||{},G.seen=G.seen||[],G.as=G.as||E,c(G,U),G.root=U.node,G.graph};function c(N,G){var E;return(E=B(N,G))?E:(G.env=N,G.soul=j,t.ify(G.obj,T,G)&&(G.link=G.link||a.link.ify(t.soul(G.node)),G.obj!==N.shell&&(N.graph[a.link.is(G.link)]=G.node)),G)}function T(N,G,E){var U=this,P=U.env,R,M;if(t._===G&&b(N,a.link._))return E._;if(R=A(N,G,E,U,P)){if(G||(U.node=U.node||E||{},b(N,t._)&&t.soul(N)&&(U.node._=$(N._)),U.node=t.soul.ify(U.node,a.link.is(U.link)),U.link=U.link||a.link.ify(t.soul(U.node))),(M=P.map)&&(M.call(P.as||{},N,G,E,U),b(E,G))){if(N=E[G],x===N){m(E,G);return}if(!(R=A(N,G,E,U,P)))return}if(!G)return U.node;if(R===!0)return N;if(M=c(P,{obj:N,path:U.path.concat(G)}),!!M.node)return M.link}}function j(N){var G=this,E=a.link.is(G.link),U=G.env.graph;G.link=G.link||a.link.ify(N),G.link[a.link._]=N,G.node&&G.node[t._]&&(G.node[t._][a.link._]=N),b(U,E)&&(U[N]=U[E],m(U,E))}function A(N,G,E,U,P){var R;if(a.is(N))return!0;if(l(N))return 1;if(R=P.invalid)return N=R.call(P.as||{},N,G,E),A(N,G,E,U,P);P.err="Invalid value at '"+U.path.concat(G).join(".")+"'!",d.list.is(N)&&(P.err+=" Use `.set(item)` instead of an Array.")}function B(N,G){for(var E=N.seen,U=E.length,P;U--;)if(P=E[U],G.obj===P.obj)return P;E.push(G)}}(),e.node=function(c){O("graph.node");var T=t.soul(c);if(T)return D({},T,c)},function(){e.to=function(T,j,A){if(O("graph.to"),!!T){var B={};return A=A||{seen:{}},C(T[j],c,{obj:B,graph:T,opt:A}),B}};function c(T,j){var A,B;if(t._===j){if(k(T,a.link._))return;this.obj[j]=$(T);return}if(!(A=a.link.is(T))){this.obj[j]=T;return}if(B=this.opt.seen[A]){this.obj[j]=B;return}this.obj[j]=this.opt.seen[A]=e.to(this.graph,A,this.opt)}}();var n=d.fn.is,f=d.obj,l=f.is,m=f.del,b=f.has,k=f.empty,D=f.put,C=f.map,$=f.copy,x;d.graph=d.graph||e}}()}(ht)),ht.exports}var Bt=L();const Nt=xt(Bt);var St=typeof window<"u"?window.Gun:L();St.chain.promise=function(O){var x=this,O=O||function(d){return d};return new Promise(function(d,i){x.once(function(a,p){d({put:a,get:p,gun:this})})}).then(O)};St.chain.then=function(J){var x=this,O=new Promise((d,i)=>{x.once(function(a,p){d(a,p)})});return J?O.then(J):O};var gt={exports:{}},yt;function rt(){return yt||(yt=1,function(){function J(){var a=function(p,y,h){if(a.unit=0,!h&&d!==y&&(a.last=""+p<a.last?a.last:""+p,delete(a.$||{})[i]),h=h||a.$||(a.$={}),!p&&Object.keys(h).length)return h;p=""+p;for(var t=0,s=p.length-1,o=p[t],u,S;!(u=h[o])&&t<s;)o+=p[++t];if(u)if(t==s){if(d===y)return d===(S=u[""])?u:(a.unit=1)&&S;u[""]=y}else return d!==y&&delete u[i],a(p.slice(++t),y,u||(u={}));else{if(!x(h,function(r,v){var g=0,w="";if((v||"").length)for(;v[g]==p[g];)w+=v[g++];if(w){if(d===y)return g<=s?void 0:((S||(S={}))[v.slice(g)]=r,r);var e={};if(e[v.slice(g)]=r,g=p.slice(g),g===""?e[""]=y:(e[g]={})[""]=y,h[w]=e,J.debug&&""+w=="undefined"){console.log(0,w);debugger}return delete h[v],!0}})){if(d===y)return;if((h[o]||(h[o]={}))[""]=y,J.debug&&""+o=="undefined"){console.log(1,o);debugger}}if(d===y)return S}};return a}if(J.map=function a(p,y,h,t){try{t=t||[];var s=typeof p=="function"?p.$||{}:p;//!opt && console.log("WHAT IS T?", JSON.stringify(t).length);
if(!s)return;if(typeof s=="string"){if(J.debug)throw["BUG:",p,y,h,t];return}var o=(s[i]||O).sort||(s[i]=function k(){return k.sort=Object.keys(s).sort(),k}()).sort,u;h=h===!0?{branch:!0}:h||{},(u=h.reverse)&&(o=o.slice(0).reverse());for(var S=h.start,r=h.end,v="ï¿¿",g=0,w=o.length;g<w;g++){var e=o[g],n=s[e],f,l,m;if(!(!n||e===""||i===e||e==="undefined")&&(l=t.slice(0),l.push(e),m=l.join(""),!(d!==S&&m<(S||"").slice(0,m.length))&&!(d!==r&&(r||v)<m))){if(u&&(f=a(n,y,h,l),d!==f))return f;if(d!==(f=n[""])){var b=1;if(d!==S&&m<(S||"")&&(b=0),d!==r&&m>(r||v)&&(b=0),b&&(f=y(f,m,e,t),d!==f))return f}else if(h.branch&&(f=y(d,m,e,t),d!==f))return f;if(t=l,!u&&(f=a(n,y,h,t),d!==f))return f;t.pop()}}}catch(k){console.error(k)}},typeof window<"u")window.Radix=J;else try{gt.exports=J}catch{}var x=J.object=function(a,p,y){for(var h in a)if(a.hasOwnProperty(h)&&(y=p(a[h],h))!==d)return y},O={},d,i=""}()),gt.exports}rt();var Gt={exports:{}},vt={exports:{}},wt;function Et(){return wt||(wt=1,function(J){(function(){var x={},O,d=setTimeout.turn||typeof setImmediate!=""+O&&setImmediate||setTimeout;x.parseAsync=function(a,p,y,h){if(typeof a!="string"){try{p(O,JSON.parse(a))}catch(o){p(o)}return}var t={i:0,text:a,done:p,l:a.length,up:[]};h=h||1024*32,s();function s(){for(var o=t.text,u=t.i,S=t.l,r=0,v=t.w,g,w;r++<h;){var e=o[u++];if(u>S){t.end=!0;break}if(v){for(u=o.indexOf('"',u-1),e=o[u],w=0;o[u-++w]=="\\";);w=!(w%2),g=g||w,e=='"'&&!w&&(v=O,w=t.s,t.a?(w=o.slice(t.sl,u),(g||1+w.indexOf("\\"))&&(w=JSON.parse('"'+w+'"')),t.at instanceof Array?t.at.push(t.s=w):(t.at||(t.end=r=h,w=O),(t.at||{})[t.s]=t.s=w),t.s=O):(t.s=o.slice(t.sl,u),(g||1+t.s.indexOf("\\"))&&(t.s=JSON.parse('"'+t.s+'"'))),t.a=g=O),++u}else switch(e){case'"':t.sl=u,v=!0;break;case":":t.ai=u,t.a=!0;break;case",":(t.a||t.at instanceof Array)&&(w=o.slice(t.ai,u-1))&&O!==(w=i(w))&&(t.at instanceof Array?t.at.push(w):t.at[t.s]=w),t.a=O,t.at instanceof Array&&(t.a=!0,t.ai=u);break;case"{":t.up.push(t.at||(t.at={})),t.at instanceof Array?t.at.push(t.at={}):O!==(w=t.s)&&(t.at[w]=t.at={}),t.a=O;break;case"}":t.a&&(w=o.slice(t.ai,u-1))&&O!==(w=i(w))&&(t.at instanceof Array?t.at.push(w):(t.at||(t.end=r=h,w=O),(t.at||{})[t.s]=w)),t.a=O,t.at=t.up.pop();break;case"[":O!==(w=t.s)?(t.up.push(t.at),t.at[w]=t.at=[]):t.at||t.up.push(t.at=[]),t.a=!0,t.ai=u;break;case"]":t.a&&(w=o.slice(t.ai,u-1))&&O!==(w=i(w))&&(t.at instanceof Array?t.at.push(w):t.at[t.s]=w),t.a=O,t.at=t.up.pop();break}}if(t.s=O,t.i=u,t.w=v,t.end){if(w=t.at,O===w)try{w=JSON.parse(a)}catch(n){return t.done(n)}t.done(O,w)}else d(s)}};function i(a){var p=parseFloat(a);if(!isNaN(p))return p;if(a=a.trim(),a=="true")return!0;if(a=="false")return!1;if(a=="null")return null}x.stringifyAsync=function(a,p,y,h,t){t=t||{},t.text=t.text||"",t.up=[t.at={d:a}],t.done=p,t.i=0;var s=0;o();function o(){var u=t.at,S=u.d,r="",v;switch(u.i&&u.i-u.j>0&&(r+=","),O!==(v=u.k)&&(r+=JSON.stringify(v)+":"),typeof S){case"boolean":r+=""+S;break;case"string":r+=JSON.stringify(S);break;case"number":r+=isNaN(S)?"null":S;break;case"object":if(!S){r+="null";break}if(S instanceof Array){r+="[",u={i:-1,as:S,up:u,j:0},u.l=S.length,t.up.push(t.at=u);break}if(typeof(S||"").toJSON!="function"){r+="{",u={i:-1,ok:Object.keys(S).sort(),as:S,up:u,j:0},u.l=u.ok.length,t.up.push(t.at=u);break}if(v=S.toJSON()){r+=v;break}case"function":if(u.as instanceof Array){r+="null";break}default:r="",u.j++}for(t.text+=r;1+u.i>=u.l;)t.text+=u.ok?"}":"]",u=t.at=u.up;if(++u.i<u.l){if((v=u.ok)?u.d=u.as[u.k=v[u.i]]:u.d=u.as[u.i],++s<9)return o();s=0,d(o);return}t.done(O,t.text)}},typeof window!=""+O&&(window.YSON=x);try{""+O!="object"&&(J.exports=x)}catch{}typeof JSON!=""+O&&(JSON.parseAsync=x.parseAsync,JSON.stringifyAsync=x.stringifyAsync)})()}(vt)),vt.exports}var bt,mt;function Jt(){return mt||(mt=1,bt=function(J){var x=rt();J.find("a",function(){var O=[];x.map(J.list,function(a,p){p.indexOf("%1B")+1&&a&&O.push([p,a])}),O.length&&console.log(`
! ! ! WARNING ! ! !
RAD v0.2020.x has detected OLD v0.2019.x data & automatically migrating. Automatic migration will be turned OFF in future versions! If you are just developing/testing, we recommend you reset your data. Please contact us if you have any concerns.
This message should only log once.`);var d,i;O.forEach(function(a){d=a[0],i=a[1],J.list(decodeURIComponent(d),i),J.list(d,0)}),d&&J.find.bad(d)})}),bt}(function(){function J(d){d=d||{},d.log=d.log||console.log,d.file=String(d.file||"radata");var i=(J.has||(J.has={}))[d.file];if(i)return i;d.max=d.max||(d.memory?d.memory*999*999:3e8)*.3,d.until=d.until||d.wait||250,d.batch=d.batch||10*1e3,d.chunk=d.chunk||1024*1024*1,d.code=d.code||{},d.code.from=d.code.from||"!",d.jsonify=!0;function a(g){return encodeURIComponent(g).replace(/\*/g,"%2A")}function p(g){return v!==g&&(!g||typeof g!="object")}var y=""+v==typeof setImmediate?setTimeout:setImmediate,h=setTimeout.turn||y,v,t=O.object,s=0;if(!d.store)return d.log("ERROR: Radisk needs `opt.store` interface with `{get: fn, put: fn (, list: fn)}`!");if(!d.store.put)return d.log("ERROR: Radisk needs `store.put` interface with `(file, data, cb)`!");if(!d.store.get)return d.log("ERROR: Radisk needs `store.get` interface with `(file, cb)`!");d.store.list,""+v!=typeof nt("/lib")&&Et();var o=JSON.parseAsync||function(g,w,e){var n;try{w(n,JSON.parse(g,e))}catch(f){w(f)}},u=function(g,w,e,n,f){if(typeof w=="function"){var l=e||{};e=w,u.read(g,e,l,f||n);return}u.save(g,w,e,n,f)};u.save=function(g,w,e,n,f){var l={key:g},m,b;l.find=function(k){var D;if(l.file=k||(k=d.code.from),f&&(f=f[k]=f[k]||{}),f&&(f.sf=f.sf||+new Date),D=u.disk[k]){l.mix(v,D);return}u.parse(k,l.mix,v,f)},l.mix=function(k,D){if(f&&(f.sml=+new Date),f&&(f.sm=f.sm||+new Date),l.err=k||l.err){e(k);return}var C=l.file=(D||"").file||l.file,$;if(!D&&C!==d.code.from){u.find.bad(C),u.save(g,w,e,n);return}if((D=u.disk[C]||(u.disk[C]=D||O())).file||(D.file=C),d.compare&&(w=d.compare(D(g),w,g,C),v===w)){e(k,-1);return}if((l.disk=D)(g,w),n&&(($=($=D.tags||(D.tags={}))[n]||($[n]=u.tags[n]||(u.tags[n]={})))[C]||($[C]=u.one[n]||(u.one[n]=e)),e=null),f&&(f.st=f.st||+new Date),D.Q){e&&D.Q.push(e);return}D.Q=e?[e]:[],D.to=setTimeout(l.write,d.until)},l.write=function(){f&&(f.sto=f.sto||+new Date);var k=m=l.file,D=l.disk;b=l.q=D.Q,l.tags=D.tags,delete D.Q,delete u.disk[k],delete D.tags,u.write(k,D,l.ack,v,f)},l.ack=function(k,D){f&&(f.sa=f.sa||+new Date),f&&(f.sal=b.length);var C,$;for(var _ in u.tags)if(u.tags.hasOwnProperty(_)){var c=u.tags[_];if(!(($=u.disk[m])&&($=$.tags)&&$[c])){C=c[m],delete c[m];var T;for(var j in c)if(c.hasOwnProperty(j)){T=!0;break}T||(delete u.tags[c],C&&C(k,D))}}!b&&(b="");for(var A=b.length,B=0,N=+new Date;B<A;B++)(C=b[B])&&C(k,D);console.STAT&&console.STAT(N,+new Date-N,"rad acks",a(l.file)),console.STAT&&console.STAT(N,b.length,"rad acks #",a(l.file))},e||(e=function(k,D){}),u.find(g,l.find)},u.disk={},u.one={},u.tags={};var S=0;u.write=function(g,w,e,n,f){if(!w){e("No radix!");return}n=typeof n=="object"?n:{force:n};var l=function(){},m,b;if(l.text="",l.file=g=w.file||(w.file=g),!g){e("What file?");return}if(l.write=function(){var k=w.raw=l.text;u.disk[g=w.file||l.file||g]=w;var D=+new Date;f&&(f.wd=D),u.find.add(g,function(C){if(f&&(f.wa=+new Date),C){e(C);return}d.store.put(a(g),k,function($,_){f&&(f.wp=+new Date),console.STAT&&console.STAT(D,s=+new Date-D,"wrote disk",JSON.stringify(g),++S,"total all writes."),e($,_||1),w.Q||delete u.disk[g]})})},l.split=function(){var k=+new Date;f&&(f.wf=k),l.text="",l.count||(l.count=0,O.map(w,function(){l.count++})),f&&(f.wfc=l.count),l.limit=Math.ceil(l.count/2);var D=l.count;return l.count=0,f&&(f.wf1=+new Date),l.sub=O(),O.map(w,l.slice,{reverse:1}),f&&(f.wf2=+new Date),u.write(l.end,l.sub,l.both,n),f&&(f.wf3=+new Date),l.hub=O(),O.map(w,l.stop),f&&(f.wf4=+new Date),u.write(w.file,l.hub,l.both,n),f&&(f.wf5=+new Date),console.STAT&&console.STAT(k,+new Date-k,"rad split",a(w.file),D),!0},l.slice=function(k,D){if(l.sub(l.end=D,k),l.limit<=++l.count)return!0},l.stop=function(k,D){if(D>=l.end)return!0;l.hub(D,k)},l.both=function(k,D){if(f&&(f.wfd=+new Date),b){e(k||b);return}if(m){e(k,D);return}m=!0,b=k},l.each=function(k,D,C,$){if(v!==k&&l.count++,d.max<=(k||"").length)return e("Data too big!"),!0;var _=J.encode($.length)+"#"+J.encode(C)+(v===k?"":":"+J.encode(k))+`
`;if(d.chunk<l.text.length+_.length&&1<l.count&&!n.force)return l.split();l.text+=_},d.jsonify){u.write.jsonify(l,w,e,n,f);return}O.map(w,l.each,!0)||l.write()},u.write.jsonify=function(g,w,e,n,f){var l,m=+new Date;f&&(f.w=m);try{l=JSON.stringify(w.$)}catch{e("Cannot radisk!");return}if(f&&(f.ws=+new Date),console.STAT&&console.STAT(m,+new Date-m,"rad stringified JSON"),d.chunk<l.length&&!n.force){var b=0;if(O.map(w,function(){if(b++)return!0}),b>1)return g.split()}g.text=l,g.write()},u.range=function(g,w){if(!(!g||!w)){if(v===w.start&&v===w.end||p(g))return g;var e=O();return O.map(g,function(n,f){e(f,n)},w),e("")}},function(){u.read=function(g,w,e,n){e=e||{};var f={key:g};f.find=function(l){var m;if(f.file=l||(l=d.code.from),n&&(n=n[l]=n[l]||{}),n&&(n.rf=n.rf||+new Date),m=u.disk[f.file=l]){f.check(v,m);return}u.parse(l,f.check,v,n)},f.get=function(l,m,b){if(n&&(n.rgl=+new Date),n&&(n.rg=n.rg||+new Date),f.err=l||f.err){w(l);return}var k=f.file=(m||"").file||f.file;if(!m&&k!==d.code.from){u.find.bad(k),u.read(g,w,e);return}if(m=u.disk[k]||(u.disk[k]=m),!m){w(k===d.code.from?v:"No file!");return}m.file||(m.file=k);var D=u.range(m(g),e);if(n&&(n.rr=+new Date),e.unit=m.unit,e.chunks=(e.chunks||0)+1,e.parsed=(e.parsed||0)+((b||"").parsed||e.chunks*d.chunk),e.more=1,e.next=v,O.map(u.list,function(_,c){if(!(!_||k===c))return e.next=c,1},e.reverse?{reverse:1,end:k}:{start:k}),n&&(n.rl=+new Date),e.next||(e.more=0),e.next&&(!e.reverse&&(g<e.next&&e.next.indexOf(g)!=0||v!==e.end&&(e.end||"ï¿¿")<e.next)&&(e.more=0),e.reverse&&(g>e.next&&g.indexOf(e.next)!=0||v!==e.start&&(e.start||"")>e.next&&k<=e.start)&&(e.more=0)),!e.more){w(f.err,D,e);return}if(D&&w(f.err,D,e),!(e.parsed>=e.limit)){var C=+new Date;n&&(n.rm=C);var $=e.next;y(function(){console.STAT&&console.STAT(C,+new Date-C,"rad more"),u.parse($,f.check)},0)}},f.check=function(l,m,b){if(f.get(l,m,b),!(!m||m.check)){m.check=1;var k=+new Date;(b||(b={})).file||(b.file=f.file),O.map(m,function(D,C){u.find(C,function($){if(($||($=d.code.from))!==b.file){var _=(""+Math.random()).slice(-3);h(function(){u.save(C,D,function c(T,j){if(T){u.save(C,D,c);return}console.STAT&&console.STAT("MISLOCATED DATA CORRECTED",_,a(C),a(b.file),a($))})},0)}})}),console.STAT&&console.STAT(k,+new Date-k,"rad check")}},u.find(g||(e.reverse?e.end||"":e.start||""),f.find)}}(),function(){var g=0,w={},e="";u.parse=function(n,f,l,m){var b;if(!n)return f();if(b=w[n]){b.push(f);return}b=w[n]=[f];var k=function(){},D={file:n};(k.disk=O()).file=n,k.read=function($,_){if(m&&(m.rpg=+new Date),console.STAT&&console.STAT(C,+new Date-C,"read disk",JSON.stringify(n),++g,"total all parses."),(k.err=$)||(k.not=!_)){delete w[n],k.map(b,k.ack);return}if(typeof _!="string"){try{d.max<=_.length?k.err="Chunk too big!":_=_.toString()}catch(c){k.err=c}if(k.err){delete w[n],k.map(b,k.ack);return}}if(D.parsed=_.length,m&&(m.rpl=D.parsed),m&&(m.rpa=b.length),C=+new Date,!(d.jsonify||_[0]==="{")){k.radec($,_);return}o(_,function(c,T){if(!c){delete w[n],k.disk.$=T,console.STAT&&(s=+new Date-C)>9&&console.STAT(C,s,"rad parsed JSON"),m&&(m.rpd=+new Date),k.map(b,k.ack);return}if(_[0]==="{"){delete w[n],k.err="JSON error!",k.map(b,k.ack);return}k.radec(c,_)})},k.map=function(){if(!(!b||!b.length)){for(var $=+new Date,_=k.err,c=k.not?v:k.disk,T=0,j;T<9&&(j=b[T++]);)j(_,c,D);console.STAT&&console.STAT($,+new Date-$,"rad packs",a(n)),console.STAT&&console.STAT($,T,"rad packs #",a(n)),(b=b.slice(T)).length&&h(k.map,0)}},k.ack=function($){if($){if(k.err||k.not){$(k.err,v,D);return}$(v,k.disk,D)}},k.radec=function($,_){delete w[n],C=+new Date;var c=k.split(_),T=[],j,A,B;if(!c||c[1]!==0){k.err="File '"+n+"' does not have root radix! ",k.map(b,k.ack);return}for(;c;)A=B=v,j=c[1],c=k.split(c[2])||"",c[0]=="#"&&(A=c[1],T=T.slice(0,j),j<=T.length&&T.push(A)),c=k.split(c[2])||"",c[0]!=`
`&&((c[0]=="="||c[0]==":")&&(B=c[1]),v!==A&&v!==B&&k.disk(T.join(""),B),c=k.split(c[2]));console.STAT&&console.STAT(C,+new Date-C,"parsed RAD"),k.map(b,k.ack)},k.split=function($){if($){var _=[],c={},T=-1,j="";if(T=$.indexOf(e),!!$[T])return j=$.slice(0,T),_[0]=j,_[1]=J.decode($.slice(T),c),_[2]=$.slice(T+c.i),_}},u.disk&&(l||(l=(u.disk[n]||"").raw));var C=+new Date;if(m&&(m.rp=C),l)return h(function(){k.read(v,l)},0);d.store.get(a(n),k.read)}}(),function(){var g,w="",e;u.find=function(l,m){if(!g){if(e){e.push([l,m]);return}e=[[l,m]],u.parse(w,n);return}O.map(u.list=g,function(b,k){if(b)return m(k)||!0},{reverse:1,end:l})||m(d.code.from)},u.find.add=function(l,m){var b=g(l);if(b||l===w){m(v,1);return}g(l,1),m.found=(m.found||0)+1,u.write(w,g,function(k,D){if(k){m(k);return}m.found=(m.found||0)-1,m.found===0&&m(v,1)},!0)},u.find.bad=function(l,m){g(l,0),u.write(w,g,m||r)};function n(l,m){if(l){d.log("list",l),setTimeout(function(){u.parse(w,n)},1e3);return}if(m){f(m);return}if(g=g||m||O(),!d.store.list){f(g);return}d.store.list(function(b){if(!b){f(g);return}u.find.add(b,r)})}function f(l,m){g=g||l,g.file=w,m=e,e=null,t(m,function(b){u.find(b[0],b[1])})}}();try{!x.window&&Jt()(u)}catch{}var r=function(){},v;return J.has[d.file]=u,u}if(function(){var d="";J.encode=function(i,a,p){p=p||d;var y=p,h;if(typeof i=="string"){for(var t=i.indexOf(p);t!=-1;)y+=p,t=i.indexOf(p,t+1);return y+'"'+i+p}else{if(i&&i["#"]&&Object.keys(i).length==1)return y+"#"+h+y;if(typeof i=="number")return y+"+"+(i||0)+y;if(i===null)return y+" "+y;if(i===!0)return y+"+"+y;if(i===!1)return y+"-"+y}},J.decode=function(i,a,p){p=p||d;var y="",h=-1,t=0,s,o;if(p===i[0]){for(;p===i[++h];)++t;for(o=i[s=t]||!0;--t>=0;)h=i.indexOf(p,h+1);if(h==-1&&(h=i.length),y=i.slice(s+1,h),a&&(a.i=h+1),o==='"')return y;if(o==="#")return{"#":y};if(o==="+")return y.length===0?!0:parseFloat(y);if(o===" ")return null;if(o==="-")return!1}}}(),typeof window<"u"){var x=window.Gun,O=window.Radix;window.Radisk=J}else{var x=L(),O=rt();try{Gt.exports=J}catch{}}J.Radix=O})();var Ut={exports:{}};(function(){function J(O){O=O||{},O.file=String(O.file||"radata");var d=J[O.file],i=null,a;if(d)return console.log("Warning: reusing same IndexedDB store and options as 1st."),J[O.file];d=J[O.file]=function(){};try{O.indexedDB=O.indexedDB||J.indexedDB||indexedDB}catch{}try{if(!O.indexedDB||location.protocol=="file:"){var p=d.d||(d.d={});return d.put=function(y,h,t){p[y]=h,setTimeout(function(){t(null,1)},250)},d.get=function(y,h){setTimeout(function(){h(null,p[y]||a)},5)},console.log("Warning: No indexedDB exists to persist data to!"),d}}catch{}return d.start=function(){var y=indexedDB.open(O.file,1);y.onupgradeneeded=function(h){h.target.result.createObjectStore(O.file)},y.onsuccess=function(){i=y.result},y.onerror=function(h){console.log(h||1)}},d.start(),d.put=function(y,h,t){if(!i){setTimeout(function(){d.put(y,h,t)},1);return}var s=i.transaction([O.file],"readwrite"),o=s.objectStore(O.file),u=o.put(h,""+y);u.onsuccess=o.onsuccess=s.onsuccess=function(){t(null,1)},u.onabort=o.onabort=s.onabort=function(S){t(S||"put.tx.abort")},u.onerror=o.onerror=s.onerror=function(S){t(S||"put.tx.error")}},d.get=function(y,h){if(!i){setTimeout(function(){d.get(y,h)},9);return}var t=i.transaction([O.file],"readonly"),s=t.objectStore(O.file),o=s.get(""+y);o.onsuccess=function(){h(null,o.result)},o.onabort=function(u){h(u||4)},o.onerror=function(u){h(u||5)}},setInterval(function(){i&&i.close(),i=null,d.start()},1e3*15),d}if(typeof window<"u")(J.window=window).RindexedDB=J,J.indexedDB=window.indexedDB;else try{Ut.exports=J}catch{}try{var x=J.window.Gun||L();x.on("create",function(O){this.to.next(O),O.opt.store=O.opt.store||J(O.opt)})}catch{}})();(function(){var J=typeof window<"u"?window.Gun:L();J.on("opt",function(x){this.to.next(x);var O=x.opt;if(x.once||!J.Mesh||O.RTCPeerConnection===!1)return;var d;typeof window<"u"&&(d=window),typeof z<"u"&&(d=z),d=d||{};var i=O.RTCPeerConnection||d.RTCPeerConnection||d.webkitRTCPeerConnection||d.mozRTCPeerConnection,a=O.RTCSessionDescription||d.RTCSessionDescription||d.webkitRTCSessionDescription||d.mozRTCSessionDescription,p=O.RTCIceCandidate||d.RTCIceCandidate||d.webkitRTCIceCandidate||d.mozRTCIceCandidate;if(!i||!a||!p)return;O.RTCPeerConnection=i,O.RTCSessionDescription=a,O.RTCIceCandidate=p,O.rtc=O.rtc||{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.sipgate.net:3478"}]},O.rtc.dataChannel=O.rtc.dataChannel||{ordered:!1,maxRetransmits:2},O.rtc.sdp=O.rtc.sdp||{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},O.rtc.max=O.rtc.max||55,O.rtc.room=O.rtc.room||J.window&&(location.hash.slice(1)||location.pathname.slice(1)),O.announce=function(t){O.rtc.start=+new Date,x.$.get("/RTC/"+O.rtc.room+"<?99").get("+").put(O.pid,function(s){!s.ok||!s.ok.rtc||h(s)},{acks:O.rtc.max}).on(function(s,o,u){s===O.pid||O.rtc.start>u.put[">"]||h({"#":""+u["#"],ok:{rtc:{id:s}}})})};var y=O.mesh=O.mesh||J.Mesh(x);x.on("create",function(t){this.to.next(t),setTimeout(O.announce,1)});function h(t){if(this&&this.off&&this.off(),!!t.ok){var s=t.ok.rtc,o,u;if(!(!s||!s.id||s.id===O.pid)){if(u=s.answer)return!(o=O.peers[s.id]||h[s.id])||o.remoteSet?void 0:(u.sdp=u.sdp.replace(/\\r\\n/g,`\r
`),o.setRemoteDescription(o.remoteSet=new O.RTCSessionDescription(u)));if(u=s.candidate)return o=O.peers[s.id]||h[s.id]||h({ok:{rtc:{id:s.id}}}),o.addIceCandidate(new O.RTCIceCandidate(u));if(!h[s.id]){(o=new O.RTCPeerConnection(O.rtc)).id=s.id;var S=o.wire=o.createDataChannel("dc",O.rtc.dataChannel);if(h[s.id]=o,S.to=setTimeout(function(){delete h[s.id]},1e3*60),S.onclose=function(){y.bye(o)},S.onerror=function(r){},S.onopen=function(r){delete h[s.id],y.hi(o)},S.onmessage=function(r){r&&y.hear(r.data||r,o)},o.onicecandidate=function(r){r.candidate&&x.on("out",{"@":t["#"],ok:{rtc:{candidate:r.candidate,id:O.pid}}})},o.ondatachannel=function(r){var v=r.channel;v.onmessage=S.onmessage,v.onopen=S.onopen,v.onclose=S.onclose},u=s.offer){s.offer.sdp=s.offer.sdp.replace(/\\r\\n/g,`\r
`),o.setRemoteDescription(new O.RTCSessionDescription(u)),o.createAnswer(function(r){o.setLocalDescription(r),x.on("out",{"@":t["#"],ok:{rtc:{answer:r,id:O.pid}}})},function(){},O.rtc.sdp);return}return o.createOffer(function(r){o.setLocalDescription(r),x.on("out",{"@":t["#"],"#":x.ask(h),ok:{rtc:{offer:r,id:O.pid}}})},function(){},O.rtc.sdp),o}}}}})})();var jt={exports:{}};(function(J){(function(){function x(d,i){return i?nt("/")(d):d.slice?x[a(d)]:function(p,y){d(p={exports:{}}),x[a(y)]=p.exports};function a(p){return p.split("/").slice(-1).toString().replace(".js","")}}var O=J;x(function(d){typeof self<"u"&&(d.window=self),typeof window<"u"&&(d.window=window);var i=d.window||d,a,p=i.SEA||{};(p.window=d.window)&&(p.window.SEA=p);try{a+""!=typeof O&&(O.exports=p)}catch{}d.exports=p})(x,"./root"),x(function(d){var i=x("./root");try{i.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(x,"./https"),x(function(d){var i;if(i+""==typeof btoa){if(i+""==typeof Buffer)try{z.Buffer=x("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}z.btoa=function(a){return Buffer.from(a,"binary").toString("base64")},z.atob=function(a){return Buffer.from(a,"base64").toString("binary")}}})(x,"./base64"),x(function(d){x("./base64");function i(){}Object.assign(i,{from:Array.from}),i.prototype=Object.create(Array.prototype),i.prototype.toString=function(a,p,y){a=a||"utf8",p=p||0;const h=this.length;if(a==="hex"){const t=new Uint8Array(this);return[...Array((y&&y+1||h)-p).keys()].map(s=>t[s+p].toString(16).padStart(2,"0")).join("")}if(a==="utf8")return Array.from({length:(y||h)-p},(t,s)=>String.fromCharCode(this[s+p])).join("");if(a==="base64")return btoa(this)},d.exports=i})(x,"./array"),x(function(d){x("./base64");var i=x("./array");function a(...p){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),a.from(...p)}a.prototype=Object.create(Array.prototype),Object.assign(a,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const p=arguments[0];let y;if(typeof p=="string"){const h=arguments[1]||"utf8";if(h==="hex"){const t=p.match(/([\da-fA-F]{2})/g).map(s=>parseInt(s,16));if(!t||!t.length)throw new TypeError("Invalid first argument for type 'hex'.");y=i.from(t)}else if(h==="utf8"||h==="binary"){const t=p.length,s=new Uint16Array(t);Array.from({length:t},(o,u)=>s[u]=p.charCodeAt(u)),y=i.from(s)}else if(h==="base64"){const t=atob(p),s=t.length,o=new Uint8Array(s);Array.from({length:s},(u,S)=>o[S]=t.charCodeAt(S)),y=i.from(o)}else h==="binary"?y=i.from(p):console.info("SafeBuffer.from unknown encoding: "+h);return y}if(p.byteLength,p.byteLength?p.byteLength:p.length){let h;return p instanceof ArrayBuffer&&(h=new Uint8Array(p)),i.from(h||p)}},alloc(p,y=0){return i.from(new Uint8Array(Array.from({length:p},()=>y)))},allocUnsafe(p){return i.from(new Uint8Array(Array.from({length:p})))},concat(p){if(!Array.isArray(p))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return i.from(p.reduce((y,h)=>y.concat(Array.from(h)),[]))}}),a.prototype.from=a.from,a.prototype.toString=i.prototype.toString,d.exports=a})(x,"./buffer"),x(function(d){const i=x("./root"),a={Buffer:x("./buffer")};var p={},y;if(JSON.parseAsync=JSON.parseAsync||function(t,s,o){var u;try{s(u,JSON.parse(t,o))}catch(S){s(S)}},JSON.stringifyAsync=JSON.stringifyAsync||function(t,s,o,u){var S;try{s(S,JSON.stringify(t,o,u))}catch(r){s(r)}},a.parse=function(t,s){return new Promise(function(o,u){JSON.parseAsync(t,function(S,r){S?u(S):o(r)},s)})},a.stringify=function(t,s,o){return new Promise(function(u,S){JSON.stringifyAsync(t,function(r,v){r?S(r):u(v)},s,o)})},i.window&&(a.crypto=i.window.crypto||i.window.msCrypto,a.subtle=(a.crypto||p).subtle||(a.crypto||p).webkitSubtle,a.TextEncoder=i.window.TextEncoder,a.TextDecoder=i.window.TextDecoder,a.random=t=>a.Buffer.from(a.crypto.getRandomValues(new Uint8Array(a.Buffer.alloc(t))))),!a.TextDecoder){const{TextEncoder:t,TextDecoder:s}=x((y+""==typeof O?".":"")+"./lib/text-encoding",1);a.TextDecoder=s,a.TextEncoder=t}if(!a.crypto)try{var h=x("crypto",1);Object.assign(a,{crypto:h,random:s=>a.Buffer.from(h.randomBytes(s))});const{Crypto:t}=x("@peculiar/webcrypto",1);a.ossl=a.subtle=new t({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}d.exports=a})(x,"./shim"),x(function(d){var i=x("./root"),a=x("./shim"),p={};p.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},p.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},p.ecdh={name:"ECDH",namedCurve:"P-256"},p.jwk=function(y,h){y=y.split(".");var t=y[0],s=y[1],o={kty:"EC",crv:"P-256",x:t,y:s,ext:!0};return o.key_ops=h?["sign"]:["verify"],h&&(o.d=h),o},p.keyToJwk=function(y){return{kty:"oct",k:y.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},p.recall={validity:12*60*60,hook:function(y){return y}},p.check=function(y){return typeof y=="string"&&y.slice(0,4)==="SEA{"},p.parse=async function(y){try{var h=typeof y=="string";return h&&y.slice(0,4)==="SEA{"&&(y=y.slice(3)),h?await a.parse(y):y}catch{}return y},i.opt=p,d.exports=p})(x,"./settings"),x(function(d){var i=x("./shim");d.exports=async function(a,p){var y=typeof a=="string"?a:await i.stringify(a),h=await i.subtle.digest({name:p||"SHA-256"},new i.TextEncoder().encode(y));return i.Buffer.from(h)}})(x,"./sha256"),x(function(d){const i=x("./shim"),a=i.subtle,p=i.ossl?i.ossl:a,y=h=>p.digest({name:"SHA-1"},new ArrayBuffer(h));d.exports=y})(x,"./sha1"),x(function(d){var i=x("./root"),a=x("./shim"),p=x("./settings"),y=x("./sha256"),h;i.work=i.work||(async(t,s,o,u)=>{try{var S=(s||{}).epub||s;if(u=u||{},S instanceof Function&&(o=S,S=h),t=typeof t=="string"?t:await a.stringify(t),(u.name||"").toLowerCase().slice(0,3)==="sha"){var r=a.Buffer.from(await y(t,u.name),"binary").toString(u.encode||"base64");if(o)try{o(r)}catch(e){console.log(e)}return r}S=S||a.random(9);var v=await(a.ossl||a.subtle).importKey("raw",new a.TextEncoder().encode(t),{name:u.name||"PBKDF2"},!1,["deriveBits"]),g=await(a.ossl||a.subtle).deriveBits({name:u.name||"PBKDF2",iterations:u.iterations||p.pbkdf2.iter,salt:new a.TextEncoder().encode(u.salt||S),hash:u.hash||p.pbkdf2.hash},v,u.length||p.pbkdf2.ks*8);t=a.random(t.length);var w=a.Buffer.from(g,"binary").toString(u.encode||"base64");if(o)try{o(w)}catch(e){console.log(e)}return w}catch(e){if(console.log(e),i.err=e,i.throw)throw e;o&&o();return}}),d.exports=i.work})(x,"./work"),x(function(d){var i=x("./root"),a=x("./shim");x("./settings"),i.name=i.name||(async(p,y)=>{try{if(p)try{p()}catch(h){console.log(h)}return}catch(h){if(console.log(h),i.err=h,i.throw)throw h;p&&p();return}}),i.pair=i.pair||(async(p,y)=>{try{var h=a.ossl||a.subtle,t=await a.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async u=>{var S={};S.priv=(await a.subtle.exportKey("jwk",u.privateKey)).d;var r=await a.subtle.exportKey("jwk",u.publicKey);return S.pub=r.x+"."+r.y,S});try{var s=await h.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async u=>{var S={};S.epriv=(await h.exportKey("jwk",u.privateKey)).d;var r=await h.exportKey("jwk",u.publicKey);return S.epub=r.x+"."+r.y,S})}catch(u){if(i.window)throw u;if(u=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw u}s=s||{};var o={pub:t.pub,priv:t.priv,epub:s.epub,epriv:s.epriv};if(p)try{p(o)}catch(u){console.log(u)}return o}catch(u){if(console.log(u),i.err=u,i.throw)throw u;p&&p();return}}),d.exports=i.pair})(x,"./pair"),x(function(d){var i=x("./root"),a=x("./shim"),p=x("./settings"),y=x("./sha256"),h;i.sign=i.sign||(async(t,s,o,u)=>{try{if(u=u||{},!(s||u).priv){if(!i.I)throw"No signing key.";s=await i.I(null,{what:t,how:"sign",why:u.why})}if(h===t)throw"`undefined` not allowed.";var S=await p.parse(t),r=u.check=u.check||S;if(i.verify&&(i.opt.check(r)||r&&r.s&&r.m)&&h!==await i.verify(r,s)){var f=await p.parse(r);if(u.raw||(f="SEA"+await a.stringify(f)),o)try{o(f)}catch(m){console.log(m)}return f}var v=s.pub,g=s.priv,w=p.jwk(v,g),e=await y(S),n=await(a.ossl||a.subtle).importKey("jwk",w,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(l=>(a.ossl||a.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},l,new Uint8Array(e))),f={m:S,s:a.Buffer.from(n,"binary").toString(u.encode||"base64")};if(u.raw||(f="SEA"+await a.stringify(f)),o)try{o(f)}catch(l){console.log(l)}return f}catch(l){if(console.log(l),i.err=l,i.throw)throw l;o&&o();return}}),d.exports=i.sign})(x,"./sign"),x(function(d){var i=x("./root"),a=x("./shim"),p=x("./settings"),y=x("./sha256"),h;i.verify=i.verify||(async(o,u,S,r)=>{try{var v=await p.parse(o);if(u===!1){var g=await p.parse(v.m);if(S)try{S(g)}catch(D){console.log(D)}return g}r=r||{};var w=u.pub||u,e=i.opt.slow_leak?await i.opt.slow_leak(w):await(a.ossl||a.subtle).importKey("jwk",p.jwk(w),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),n=await y(v.m),f,l,m,b;try{if(f=a.Buffer.from(v.s,r.encode||"base64"),l=new Uint8Array(f),m=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},e,l,new Uint8Array(n)),!m)throw"Signature did not match."}catch{if(i.opt.fallback)return await i.opt.fall_verify(o,u,S,r)}var k=m?await p.parse(v.m):h;if(S)try{S(k)}catch(D){console.log(D)}return k}catch(D){if(console.log(D),i.err=D,i.throw)throw D;S&&S();return}}),d.exports=i.verify;var t={};i.opt.slow_leak=o=>{if(t[o])return t[o];var u=p.jwk(o);return t[o]=(a.ossl||a.subtle).importKey("jwk",u,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),t[o]};var s=i.opt;i.opt.fall_verify=async function(o,u,S,r,v){if(v===i.opt.fallback)throw"Signature did not match";v=v||1;var g=o||"";o=i.opt.unpack(o)||o;var w=await p.parse(o),e=u.pub||u,n=await i.opt.slow_leak(e),f=v<=i.opt.fallback?a.Buffer.from(await a.subtle.digest({name:"SHA-256"},new a.TextEncoder().encode(await p.parse(w.m)))):await y(w.m),l,m,b;try{if(l=a.Buffer.from(w.s,r.encode||"base64"),m=new Uint8Array(l),b=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},n,m,new Uint8Array(f)),!b)throw"Signature did not match."}catch{try{l=a.Buffer.from(w.s,"utf8"),m=new Uint8Array(l),b=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},n,m,new Uint8Array(f))}catch{if(!b)throw"Signature did not match."}}var k=b?await p.parse(w.m):h;if(s.fall_soul=g["#"],s.fall_key=g["."],s.fall_val=o,s.fall_state=g[">"],S)try{S(k)}catch(D){console.log(D)}return k},i.opt.fallback=2})(x,"./verify"),x(function(d){var i=x("./shim"),a=x("./settings"),p=x("./sha256");const y=async(h,t,s)=>{const o=h+(t||i.random(8)).toString("utf8"),u=i.Buffer.from(await p(o),"binary"),S=a.keyToJwk(u);return await i.subtle.importKey("jwk",S,{name:"AES-GCM"},!1,["encrypt","decrypt"])};d.exports=y})(x,"./aeskey"),x(function(d){var i=x("./root"),a=x("./shim");x("./settings");var p=x("./aeskey"),y;i.encrypt=i.encrypt||(async(h,t,s,o)=>{try{o=o||{};var u=(t||o).epriv||t;if(y===h)throw"`undefined` not allowed.";if(!u){if(!i.I)throw"No encryption key.";t=await i.I(null,{what:h,how:"encrypt",why:o.why}),u=t.epriv||t}var S=typeof h=="string"?h:await a.stringify(h),r={s:a.random(9),iv:a.random(15)},v=await p(u,r.s,o).then(w=>a.subtle.encrypt({name:o.name||"AES-GCM",iv:new Uint8Array(r.iv)},w,new a.TextEncoder().encode(S))),g={ct:a.Buffer.from(v,"binary").toString(o.encode||"base64"),iv:r.iv.toString(o.encode||"base64"),s:r.s.toString(o.encode||"base64")};if(o.raw||(g="SEA"+await a.stringify(g)),s)try{s(g)}catch(w){console.log(w)}return g}catch(w){if(console.log(w),i.err=w,i.throw)throw w;s&&s();return}}),d.exports=i.encrypt})(x,"./encrypt"),x(function(d){var i=x("./root"),a=x("./shim"),p=x("./settings"),y=x("./aeskey");i.decrypt=i.decrypt||(async(h,t,s,o)=>{try{o=o||{};var u=(t||o).epriv||t;if(!u){if(!i.I)throw"No decryption key.";t=await i.I(null,{what:h,how:"decrypt",why:o.why}),u=t.epriv||t}var S=await p.parse(h),r,v,g;try{r=a.Buffer.from(S.s,o.encode||"base64"),v=a.Buffer.from(S.iv,o.encode||"base64"),g=a.Buffer.from(S.ct,o.encode||"base64");var w=await y(u,r,o).then(n=>a.subtle.decrypt({name:o.name||"AES-GCM",iv:new Uint8Array(v),tagLength:128},n,new Uint8Array(g)))}catch{if(o.encode==="utf8")throw"Could not decrypt";if(i.opt.fallback)return o.encode="utf8",await i.decrypt(h,t,s,o)}var e=await p.parse(new a.TextDecoder("utf8").decode(w));if(s)try{s(e)}catch(n){console.log(n)}return e}catch(n){if(console.log(n),i.err=n,i.throw)throw n;s&&s();return}}),d.exports=i.decrypt})(x,"./decrypt"),x(function(d){var i=x("./root"),a=x("./shim");x("./settings"),i.secret=i.secret||(async(y,h,t,s)=>{try{if(s=s||{},!h||!h.epriv||!h.epub){if(!i.I)throw"No secret mix.";h=await i.I(null,{what:y,how:"secret",why:s.why})}var o=y.epub||y,u=h.epub,S=h.epriv,r=a.ossl||a.subtle,v=p(o),g=Object.assign({public:await r.importKey(...v,!0,[])},{name:"ECDH",namedCurve:"P-256"}),w=p(u,S),e=await r.importKey(...w,!1,["deriveBits"]).then(async f=>{var l=await r.deriveBits(g,f,256),m=new Uint8Array(l),b=await r.importKey("raw",m,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return r.exportKey("jwk",b).then(({k})=>k)}),n=e;if(t)try{t(n)}catch(f){console.log(f)}return n}catch(f){if(console.log(f),i.err=f,i.throw)throw f;t&&t();return}});var p=(y,h)=>{var[t,s]=y.split("."),o=h?{d:h}:{};return["jwk",Object.assign(o,{x:t,y:s,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};d.exports=i.secret})(x,"./secret"),x(function(d){var i=x("./root");i.certify=i.certify||(async(a,p={},y,h,t={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),a=(()=>{var e=[];if(a){if((typeof a=="string"||Array.isArray(a))&&a.indexOf("*")>-1)return"*";if(typeof a=="string")return a;if(Array.isArray(a)){if(a.length===1&&a[0])return typeof a[0]=="object"&&a[0].pub?a[0].pub:typeof a[0]=="string"?a[0]:null;a.map(n=>{typeof n=="string"?e.push(n):typeof n=="object"&&n.pub&&e.push(n.pub)})}return typeof a=="object"&&a.pub?a.pub:e.length>0?e:null}})(),!a)return console.log("No certificant found.");const o=t.expiry&&(typeof t.expiry=="number"||typeof t.expiry=="string")?parseFloat(t.expiry):null,u=(p||{}).read?p.read:null,S=(p||{}).write?p.write:typeof p=="string"||Array.isArray(p)||p["+"]||p["#"]||p["."]||p["="]||p["*"]||p[">"]||p["<"]?p:null,r=(t||{}).block||(t||{}).blacklist||(t||{}).ban||{},v=r.read&&(typeof r.read=="string"||(r.read||{})["#"])?r.read:null,g=typeof r=="string"?r:r.write&&(typeof r.write=="string"||r.write["#"])?r.write:null;if(!u&&!S)return console.log("No policy found.");const w=JSON.stringify({c:a,...o?{e:o}:{},...u?{r:u}:{},...S?{w:S}:{},...v?{rb:v}:{},...g?{wb:g}:{}});var s=await i.sign(w,y,null,{raw:1});if(t.raw||(s="SEA"+JSON.stringify(s)),h)try{h(s)}catch(e){console.log(e)}return s}catch(o){if(i.err=o,i.throw)throw o;h&&h();return}}),d.exports=i.certify})(x,"./certify"),x(function(d){var i=x("./shim"),a=x("./root");a.work=x("./work"),a.sign=x("./sign"),a.verify=x("./verify"),a.encrypt=x("./encrypt"),a.decrypt=x("./decrypt"),a.certify=x("./certify"),a.random=a.random||i.random,a.Buffer=a.Buffer||x("./buffer"),a.keyid=a.keyid||(async p=>{try{const y=i.Buffer.concat(p.replace(/-/g,"+").replace(/_/g,"/").split(".").map(o=>i.Buffer.from(o,"base64"))),h=i.Buffer.concat([i.Buffer.from([153,y.length/256,y.length%256]),y]),t=await sha1hash(h),s=i.Buffer.from(t,"binary");return s.toString("hex",s.length-8)}catch(y){throw console.log(y),y}}),((a.window||{}).GUN||{}).SEA=a,d.exports=a})(x,"./sea"),x(function(d){var i=x("./sea"),a,p;i.window?a=i.window.GUN||{chain:{}}:a=x((p+""==typeof O?".":"")+"./gun",1),i.GUN=a;function y(t){this._={$:this}}y.prototype=function(){function t(){}return t.prototype=a.chain,new t}(),y.prototype.constructor=y,a.chain.user=function(t){var s=this,u=s.back(-1),o;if(t)return t=i.opt.pub((t._||"")["#"])||t,u.get("~"+t);if(o=u.back("user"))return o;var u=u._,S=u,r=S.opt.uuid||h;return(S=(o=S.user=s.chain(new y))._).opt={},S.opt.uuid=function(v){var g=r(),w=u.user;return!w||!(w=w.is)||!(w=w.pub)||(g="~"+w+"/"+g,v&&v.call&&v(null,g)),g},o};function h(){return a.state().toString(36).replace(".","")}a.User=y,y.GUN=a,y.SEA=a.SEA=i,d.exports=y})(x,"./user"),x(function(d){var i,a=""+i!=typeof GUN?GUN||{chain:{}}:x((""+i==typeof O?".":"")+"./gun",1);a.chain.then=function(p,y){var h=this,t=new Promise(function(s,o){h.once(s,y)});return p?t.then(p):t}})(x,"./then"),x(function(d){var i=x("./user"),a=i.SEA,p=i.GUN,y=function(){};i.prototype.create=function(...h){var t=typeof h[0]=="object"&&(h[0].pub||h[0].epub)?h[0]:typeof h[1]=="object"&&(h[1].pub||h[1].epub)?h[1]:null,s=t&&(t.pub||t.epub)?t.pub:typeof h[0]=="string"?h[0]:null,o=t&&(t.pub||t.epub)?t:s&&typeof h[1]=="string"?h[1]:null,u=h.filter(n=>typeof n=="function")[0]||null,S=h&&h.length>1&&typeof h[h.length-1]=="object"?h[h.length-1]:{},r=this,v=r._,g=r.back(-1);if(u=u||y,S=S||{},S.check!==!1){var w;if(s||(w="No user."),(o||"").length<8&&(w="Password too short!"),w)return u({err:p.log(w)}),r}if(v.ing)return(u||y)({err:p.log("User is already being created or authenticated!"),wait:!0}),r;v.ing=!0;var e={};return e.a=function(n){if(e.pubs=n,n&&!S.already){var f={err:p.log("User already created!")};v.ing=!1,(u||y)(f),r.leave();return}e.salt=String.random(64),a.work(o,e.salt,e.b)},e.b=function(n){e.proof=n,t?e.c(t):a.pair(e.c)},e.c=function(n){var f;e.pair=n||{},(f=v.root.user)&&(f._.sea=n,f.is={pub:n.pub,epub:n.epub,alias:s}),e.data={pub:n.pub},e.d()},e.d=function(){e.data.alias=s,e.e()},e.e=function(){e.data.epub=e.pair.epub,a.encrypt({priv:e.pair.priv,epriv:e.pair.epriv},e.proof,e.f,{raw:1})},e.f=function(n){e.data.auth=JSON.stringify({ek:n,s:e.salt}),e.g(e.data.auth)},e.g=function(n){var f;e.data.auth=e.data.auth||n,g.get(f="~"+e.pair.pub).put(e.data).on(e.h);var l={};l[f]={"#":f},g.get("~@"+s).put(l).get(f).on(e.i)},e.h=function(n,f,l,m){m.off(),e.h.ok=1,e.i()},e.i=function(n,f,l,m){m&&(e.i.ok=1,m.off()),!(!e.h.ok||!e.i.ok)&&(v.ing=!1,u({ok:0,pub:e.pair.pub}),y===u&&(t?r.auth(t):r.auth(s,o)))},g.get("~@"+s).once(e.a),r},i.prototype.leave=function(h,t){var s=this,o=s.back(-1)._.user;if(o&&(delete o.is,delete o._.is,delete o._.sea),a.window)try{var u={};u=a.window.sessionStorage,delete u.recall,delete u.pair}catch{}return s}})(x,"./create"),x(function(d){var i=x("./user"),a=i.SEA,p=i.GUN,y=function(){};i.prototype.auth=function(...t){var s=typeof t[0]=="object"&&(t[0].pub||t[0].epub)?t[0]:typeof t[1]=="object"&&(t[1].pub||t[1].epub)?t[1]:null,o=!s&&typeof t[0]=="string"?t[0]:null,u=(o||s&&!(s.priv&&s.epriv))&&typeof t[1]=="string"?t[1]:null,S=t.filter(l=>typeof l=="function")[0]||null,r=t&&t.length>1&&typeof t[t.length-1]=="object"?t[t.length-1]:{},v=this,g=v._,w=v.back(-1);if(g.ing)return(S||y)({err:p.log("User is already being created or authenticated!"),wait:!0}),v;g.ing=!0;var e={},n,f=9;return e.a=function(l){if(!l)return e.b();if(!l.pub){var m=[];return Object.keys(l).forEach(function(b){b!="_"&&m.push(l[b])}),e.b(m)}if(e.name)return e.f(l);e.c((e.data=l).auth)},e.b=function(l){var m=(e.list=(e.list||[]).concat(l||[])).shift();if(n===m){if(e.name)return e.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(o&&f--){w.get("~@"+o).once(e.a);return}return e.err("Wrong user or password.")}w.get(m).once(e.a)},e.c=function(l){if(n===l)return e.b();if(typeof l=="string")return e.c(h(l));a.work(u,(e.auth=l).s,e.d,e.enc)},e.d=function(l){a.decrypt(e.auth.ek,l,e.e,e.enc)},e.e=function(l){if(n===l)return e.enc?(e.enc=null,e.b()):(e.enc={encode:"utf8"},e.c(e.auth));e.half=l,e.f(e.data)},e.f=function(l){var m=e.half||{},b=e.data||{};e.g(e.lol={pub:l.pub||b.pub,epub:l.epub||b.epub,priv:l.priv||m.priv,epriv:l.epriv||m.epriv})},e.g=function(l){if(!l||!l.pub||!l.epub)return e.b();e.pair=l;var m=w._.user,b=m._;b.tag;var k=b.opt;b=m._=w.get("~"+l.pub)._,b.opt=k,m.is={pub:l.pub,epub:l.epub,alias:o||l.pub},b.sea=e.pair,g.ing=!1;try{u&&n==(h(g.root.graph["~"+l.pub].auth)||"")[":"]&&(r.shuffle=r.change=u)}catch{}if(r.change?e.z():(S||y)(b),a.window&&(v.back("user")._.opt||r).remember)try{var D={};D=a.window.sessionStorage,D.recall=!0,D.pair=JSON.stringify(l)}catch{}try{w._.tag.auth?w._.on("auth",b):setTimeout(function(){w._.on("auth",b)},1)}catch(C){p.log("Your 'auth' callback crashed with:",C)}},e.h=function(l){if(!l)return e.b();if(o=l.alias,o||(o=l.alias="~"+s.pub),!l.auth)return e.g(s);s=null,e.c((e.data=l).auth)},e.z=function(){e.salt=String.random(64),a.work(r.change,e.salt,e.y)},e.y=function(l){a.encrypt({priv:e.pair.priv,epriv:e.pair.epriv},l,e.x,{raw:1})},e.x=function(l){e.w(JSON.stringify({ek:l,s:e.salt}))},e.w=function(l){if(r.shuffle){console.log("migrate core account from UTF8 & shuffle");var m={};Object.keys(e.data).forEach(function(b){m[b]=e.data[b]}),delete m._,m.auth=l,w.get("~"+e.pair.pub).put(m)}w.get("~"+e.pair.pub).get("auth").put(l,S||y)},e.err=function(l){var m={err:p.log(l||"User cannot be found!")};g.ing=!1,(S||y)(m)},e.plugin=function(l){if(!(e.name=l))return e.err();var m=[l];l[0]!=="~"&&(m[1]="~"+l,m[2]="~@"+l),e.b(m)},s?s.priv&&s.epriv?e.g(s):w.get("~"+s.pub).once(e.h):o?w.get("~@"+o).once(e.a):!o&&!u&&a.name(e.plugin),v};function h(t){if(typeof t!="string")return t;try{t=JSON.parse(t)}catch{t={}}return t}})(x,"./auth"),x(function(d){var i=x("./user"),a=i.SEA;i.GUN,i.prototype.recall=function(p,y){var h=this,t=h.back(-1);if(p=p||{},p&&p.sessionStorage){if(a.window)try{var s={};s=a.window.sessionStorage,s&&(t._.opt.remember=!0,(h.back("user")._.opt||p).remember=!0,(s.recall||s.pair)&&t.user().auth(JSON.parse(s.pair),y))}catch{}return h}return h}})(x,"./recall"),x(function(d){var i=x("./user"),a=i.SEA,p=i.GUN,y=function(){};i.prototype.pair=function(){var h=this,t;try{t=new Proxy({DANGER:"â "},{get:function(s,o,u){if(!(!h.is||!(h._||"").sea))return h._.sea[o]}})}catch{}return t},i.prototype.delete=async function(h,t,s){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var o=this;o.back(-1);var u=o.back("user");try{u.auth(h,t,function(S){var r=(u.is||{}).pub;u.map().once(function(){this.put(null)}),u.leave(),(s||y)({ok:0})})}catch(S){p.log("User.delete failed! Error:",S)}return o},i.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const h=this.back(-1);try{return await authRecall(h),h._.user._}catch{const t="No session!";throw p.log(t),{err:t}}},i.prototype.trust=async function(h){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),p.is(h)&&h.get("pub").get((t,s)=>{console.log(t,s)}),h.get("trust").get(path).put(theirPubkey)},i.prototype.grant=function(h,t){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var s=this,o=s.back(-1).user(),u=o._.sea,S="";return s.back(function(r){r.is||(S+=r.get||"")}),async function(){var r,v=await o.get("grant").get(u.pub).get(S).then();v=await a.decrypt(v,u),v||(v=a.random(16).toString(),r=await a.encrypt(v,u),o.get("grant").get(u.pub).get(S).put(r));var g=h.get("pub").then(),w=h.get("epub").then();g=await g,w=await w;var e=await a.secret(w,u);r=await a.encrypt(v,e),o.get("grant").get(g).get(S).put(r,t)}(),s},i.prototype.secret=function(h,t){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var s=this,o=s.back(-1).user(),u=o.pair(),S="";return s.back(function(r){r.is||(S+=r.get||"")}),async function(){var r,v=await o.get("trust").get(u.pub).get(S).then();v=await a.decrypt(v,u),v||(v=a.random(16).toString(),r=await a.encrypt(v,u),o.get("trust").get(u.pub).get(S).put(r)),r=await a.encrypt(h,v),s.put(r,t)}(),s},d.exports=i})(x,"./share"),x(function(d){var i=x("./sea"),a=x("./settings"),p,y=(i.window||"").GUN||x((""+p==typeof O?".":"")+"./gun",1);y.on("opt",function(r){r.sea||(r.sea={own:{}},r.on("put",h,r)),this.to.next(r)});function h(r){var v=this,g=v.as,w=r.put,e=w["#"],n=w["."],f=w[":"],l=w[">"],m=r["#"],b;if(!(!e||!n)){if((r._||"").faith&&(g.opt||"").faith&&typeof r._=="function"){i.opt.pack(w,function(D){i.verify(D,!1,function(C){w["="]=i.opt.unpack(C),v.to.next(r)})});return}var k=function(D){g.on("in",{"@":m,err:r.err=D})};if((r._||"").DBG&&((r._||"").DBG.c=+new Date),0<=e.indexOf("<?")&&(b=parseFloat(e.split("<?")[1]||""),b&&l<y.state()-b*1e3)){(b=r._)&&b.stun&&b.stun--;return}if(e==="~@"){h.alias(v,r,f,n,e,g,k);return}if(e.slice(0,2)==="~@"){h.pubs(v,r,f,n,e,g,k);return}if(b=i.opt.pub(e)){h.pub(v,r,f,n,e,g,k,g.user||"",b);return}if(0<=e.indexOf("#")){h.hash(v,r,f,n,e,g,k);return}h.any(v,r,f,n,e,g,k,g.user||"")}}h.hash=function(r,v,g,w,e,n,f){i.work(g,null,function(l){function m(b){let k="";for(let D=0;D<b.length;D++)k+=D-1&1?"":String.fromCharCode(parseInt(b.substring(D-1,D+1),16));return btoa(k)}if(l&&l===w.split("#").slice(-1)[0]||l&&l===m(w.split("#").slice(-1)[0]))return r.to.next(v);f("Data hash not same as hash!")},{name:"SHA-256"})},h.alias=function(r,v,g,w,e,n,f){if(!g)return f("Data must exist!");if("~@"+w===s(g))return r.to.next(v);f("Alias not same!")},h.pubs=function(r,v,g,w,e,n,f){if(!g)return f("Alias must exist!");if(w===s(g))return r.to.next(v);f("Alias not same!")},h.pub=async function(r,v,g,w,e,n,f,l,m){var b;const k=await a.parse(g)||{},D=(C,$,_)=>{if(C.m&&C.s&&$&&m)return i.verify(C,m,c=>{if(p!==c&&p!==c.e&&v.put[">"]&&v.put[">"]>parseFloat(c.e))return f("Certificate expired.");if(p!==c&&c.c&&c.w&&(c.c===$||c.c.indexOf("*")>-1)){let j=e.indexOf("/")>-1?e.replace(e.substring(0,e.indexOf("/")+1),""):"";String.match=String.match||y.text.match;const A=Array.isArray(c.w)?c.w:typeof c.w=="object"||typeof c.w=="string"?[c.w]:[];for(const B of A)if(String.match(j,B["#"])&&String.match(w,B["."])||!B["."]&&String.match(j,B["#"])||!B["#"]&&String.match(w,B["."])||String.match(j?j+"/"+w:w,B["#"]||B)){if(B["+"]&&B["+"].indexOf("*")>-1&&j&&j.indexOf($)==-1&&w.indexOf($)==-1)return f(`Path "${j}" or key "${w}" must contain string "${$}".`);if(c.wb&&(typeof c.wb=="string"||(c.wb||{})["#"])){var T=r.as.root.$.back(-1);return typeof c.wb=="string"&&c.wb.slice(0,1)!=="~"&&(T=T.get("~"+m)),T.get(c.wb).get($).once(N=>N&&(N===1||N===!0)?f(`Certificant ${$} blocked.`):_(c))}return _(c)}return f("Certificate verification fail.")}})};if(w==="pub"&&"~"+m===e)return g===m?r.to.next(v):f("Account not same!");if((b=l.is)&&b.pub&&!k["*"]&&!k["+"]&&(m===b.pub||m!==b.pub&&((v._.msg||{}).opt||{}).cert)){i.opt.pack(v.put,C=>{i.sign(C,l._.sea,async function($){if(p===$)return f(i.err||"Signature fail.");if(v.put[":"]={":":b=i.opt.unpack($.m),"~":$.s},v.put["="]=b,m===l.is.pub){(b=s(g))&&((n.sea.own[b]=n.sea.own[b]||{})[m]=1),JSON.stringifyAsync(v.put[":"],function(_,c){return _?f(_||"Stringify error."):(v.put[":"]=c,r.to.next(v))});return}if(m!==l.is.pub&&((v._.msg||{}).opt||{}).cert){const _=await a.parse(v._.msg.opt.cert);_&&_.m&&_.s&&D(_,l.is.pub,c=>{v.put[":"]["+"]=_,v.put[":"]["*"]=l.is.pub,JSON.stringifyAsync(v.put[":"],function(T,j){return T?f(T||"Stringify error."):(v.put[":"]=j,r.to.next(v))})})}},{raw:1})});return}i.opt.pack(v.put,C=>{i.verify(C,k["*"]||m,function($){var _;if($=i.opt.unpack($),p===$)return f("Unverified data.");if((_=s($))&&m===i.opt.pub(_)&&((n.sea.own[_]=n.sea.own[_]||{})[m]=1),k["+"]&&k["+"].m&&k["+"].s&&k["*"])D(k["+"],k["*"],c=>(v.put["="]=$,r.to.next(v)));else return v.put["="]=$,r.to.next(v)})})},h.any=function(r,v,g,w,e,n,f,l){if(n.opt.secure)return f("Soul missing public key at '"+w+"'.");n.on("secure",function(m){if(this.off(),!n.opt.secure)return r.to.next(m);f("Data cannot be changed.")}).on.on("secure",v)};var t=y.valid,s=function(r,v){return typeof(v=t(r))=="string"&&v};(y.state||"").ify;var o=/[^\w_-]/;i.opt.pub=function(r){if(r&&(r=r.split("~"),!(!r||!(r=r[1]))&&(r=r.split(o).slice(0,2),!(!r||r.length!=2)&&(r[0]||"")[0]!=="@")))return r=r.slice(0,2).join("."),r},i.opt.stringy=function(r){},i.opt.pack=function(r,v,g,w,e){var n,f;if(i.opt.check(r))return v(r);r&&r["#"]&&r["."]&&r[">"]&&(n=r[":"],f=1),JSON.parseAsync(f?n:r,function(l,m){var b=p!==(m||"")[":"]&&(m||"")["~"];if(!b){v(r);return}v({m:{"#":e||r["#"],".":g||r["."],":":(m||"")[":"],">":r[">"]||y.state.is(w,g)},s:b})})};var u=i.opt;i.opt.unpack=function(r,v,g){var w;if(p!==r){if(r&&p!==(w=r[":"]))return w;if(v=v||u.fall_key,!g&&u.fall_val&&(g={},g[v]=u.fall_val),!(!v||!g)){if(r===g[v]||!i.opt.check(g[v]))return r;var e=g&&g._&&g._["#"]||u.fall_soul,n=y.state.is(g,v)||u.fall_state;if(r&&r.length===4&&e===r[0]&&v===r[1]&&S(n)===S(r[3]))return r[2];if(n<i.opt.shuffle_attack)return r}}},i.opt.shuffle_attack=15463296e5;var S=Math.floor})(x,"./index")})()})(jt);var Pt=jt.exports;const Rt=xt(Pt),Mt={class:"flex flex-col p-2 gap-2"},It={class:"flex flex-wrap gap-0"},Kt=["onClick"],Wt={class:"rounded-full w-5 h-5 absolute right-0 top-0 bg-gray-600"},Ht={class:"flex flex-col gap-2 items-start max-w-45ch"},Ft={class:"flex flex-col max-w-45ch rounded-xl is-group p-2 gap-2"},kt="test13542",Vt={__name:"GunP2p",setup(J){const x=Nt({peers:["https://peer.wallie.io/gun"]}),O=tt(""),d=tt(""),i=tt("");Ot(i,t=>O.value=t);const a=Dt({}),p=At(()=>a["#"+i.value]||[]);x.get(kt).map().once(function(t,s){a[s]=a[s]||[],this.map().once((o,u)=>{a[s].push(o)})});async function y(t,s){if(t&&s){const o=await h(s);return x.get(kt).get(`#${t}`).get(`${o}`).put(s),o}else return s}async function h(t){return await Rt.work(t,null,null,{name:"SHA-256"})}return(t,s)=>(q(),Y("div",Mt,[s[3]||(s[3]=W("div",{class:"text-2xl"},"GUN P2P",-1)),W("div",It,[(q(!0),Y(at,null,ut(a,(o,u)=>(q(),Y("button",{class:_t(["text-button flex-1 relative",{active:i.value==u.slice(1)}]),onClick:S=>i.value=u.slice(1),key:o},[$t(et(u)+" ",1),W("div",Wt,et(Object.keys(o).length),1)],10,Kt))),128))]),W("div",Ht,[(q(!0),Y(at,null,ut(p.value,(o,u)=>(q(),Y("div",{class:"p-1 flex-1",key:o},et(o),1))),128))]),W("div",Ft,[st(W("input",{class:"p-2 rounded","onUpdate:modelValue":s[0]||(s[0]=o=>O.value=o)},null,512),[[ct,O.value]]),st(W("textarea",{class:"p-2 rounded","onUpdate:modelValue":s[1]||(s[1]=o=>d.value=o)},null,512),[[ct,d.value]]),W("button",{class:"text-button",onClick:s[2]||(s[2]=o=>{y(O.value,d.value),d.value=""})},"Add")])]))}};export{Vt as default};
