import{r as rt,d as ot,c as ft,o as Bt,s as Nt,f as Y,g as Q,h as L,au as Et,k as Gt,ag as Jt,F as Ut,j as Pt,l as tt,m as lt,p as Rt}from"./framework.DBqT_UJK.js";import{ak as pt,e as Mt,aH as It,n as Ht}from"./theme.DVRQnRLg.js";var ht={},X=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ht<"u"?ht:typeof self<"u"?self:{};function jt(N){return N&&N.__esModule&&Object.prototype.hasOwnProperty.call(N,"default")?N.default:N}var dt;function $t(){return dt||(dt={"/gun.js":V})}function at(N){function v(O){var g=gt(O,N);if(g!==null)return $t()[g]();throw new Error('Could not dynamically require "'+O+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}return v.resolve=function(O){var g=gt(O,N);return g!==null?g:require.resolve(O)},v}function gt(N,v){var O=Lt(N);N=et(N);var g;N[0]==="/"&&(v="");for(var i=$t(),a=["",".js",".json"];O?g=et(v+"/node_modules/"+N):g=et(v+"/"+N),!g.endsWith("/..");){for(var c=0;c<a.length;c++){var h=g+a[c];if(i[h])return h}if(!O)break;var d=et(v+"/..");if(d===v)break;v=d}return null}function Lt(N){var v=N[0];if(v==="/"||v==="\\")return!1;var O=N[1],g=N[2];return!(v==="."&&(!O||O==="/"||O==="\\")||v==="."&&O==="."&&(!g||g==="/"||g==="\\")||O===":"&&(g==="/"||g==="\\"))}function et(N){N=N.replace(/\\/g,"/");for(var v=N.split("/"),O=v[0]==="",g=1;g<v.length;g++)(v[g]==="."||v[g]==="")&&v.splice(g--,1);for(var g=1;g<v.length;g++)v[g]===".."&&g>0&&v[g-1]!==".."&&v[g-1]!=="."&&(v.splice(--g,2),g--);return N=v.join("/"),O&&N[0]!=="/"?N="/"+N:N.length===0&&(N="."),N}var yt={exports:{}},vt;function V(){return vt||(vt=1,function(N){(function(){function v(g,i){return i?at("/")(g):g.slice?v[a(g)]:function(c,h){g(c={exports:{}}),v[a(h)]=c.exports};function a(c){return c.split("/").slice(-1).toString().replace(".js","")}}var O=N;v(function(g){String.random=function(a,c){var h="";for(a=a||24,c=c||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";a-- >0;)h+=c.charAt(Math.floor(Math.random()*c.length));return h},String.match=function(a,c){var h,d;return typeof a!="string"?!1:(typeof c=="string"&&(c={"=":c}),c=c||{},h=c["="]||c["*"]||c[">"]||c["<"],a===h?!0:d!==c["="]?!1:(h=c["*"]||c[">"],a.slice(0,(h||"").length)===h?!0:d!==c["*"]?!1:d!==c[">"]&&d!==c["<"]?a>=c[">"]&&a<=c["<"]:d!==c[">"]&&a>=c[">"]||d!==c["<"]&&a<=c["<"]))},String.hash=function(a,c){if(typeof a=="string"){if(c=c||0,!a.length)return c;for(var h=0,d=a.length,t;h<d;++h)t=a.charCodeAt(h),c=(c<<5)-c+t,c|=0;return c}};var i=Object.prototype.hasOwnProperty;Object.plain=function(a){return a?a instanceof Object&&a.constructor===Object||Object.prototype.toString.call(a).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(a,c){for(var h in a)if(i.call(a,h)&&(!c||c.indexOf(h)==-1))return!1;return!0},Object.keys=Object.keys||function(a){var c=[];for(var h in a)i.call(a,h)&&c.push(h);return c},function(){var a,c=setTimeout,h=0,d=0,t=typeof setImmediate!=""+a&&setImmediate||function(u,r){return typeof MessageChannel==""+a?c:((u=new MessageChannel).port1.onmessage=function(k){k.data==""&&r()},function(k){r=k,u.port2.postMessage("")})}(),s=c.check=c.check||typeof performance!=""+a&&performance||{now:function(){return+new Date}};c.hold=c.hold||9,c.poll=c.poll||function(u){if(c.hold>=s.now()-h&&d++<3333){u();return}t(function(){h=s.now(),u()},d=0)}}(),function(){var a=setTimeout,c=a.turn=a.turn||function(r){h.push(r)==1&&d(u)},h=c.s=[],d=a.poll,t=0,s,u=function(){(s=h[t++])&&s(),(t==h.length||t==99)&&(h=c.s=h.slice(t),t=0),h.length&&d(u)}}(),function(){var a,c=setTimeout,h=c.turn;(c.each=c.each||function(d,t,s,u){u=u||9,function r(k,o,m){if(o=(k=(d||[]).splice(0,u)).length){for(var y=0;y<o&&a===(m=t(k[y]));y++);if(a===m){h(r);return}}s&&s(m)}()})()}()})(v,"./shim"),v(function(g){g.exports=function i(s,c,h){if(!s)return{to:i};var d,t=typeof c=="function",s=(this.tag||(this.tag={}))[s]||t&&(this.tag[s]={tag:s,to:i._={next:function(r){var k;(k=this.to)&&k.next(r)}}});if(t){var u={off:i.off||(i.off=function(){if(this.next===i._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=i._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:i._,next:c,the:s,on:this,as:h};return(u.back=s.last||s).to=u,s.last=u}return(s=s.to)&&d!==c&&s.next(c),s}})(v,"./onto"),v(function(g){g.exports=function(i){return i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"&&i!=1/0&&i!=-1/0&&i===i||!!i&&typeof i["#"]=="string"&&Object.keys(i).length===1&&i["#"]}})(v,"./valid"),v(function(g){v("./shim");function i(){var s=+new Date;return d<s?(c=0,d=s+i.drift):d=s+(c+=1)/h+i.drift}i.drift=0;var a=-1/0,c=0,h=999,d=a,t;i.is=function(s,u,r){var k=u&&s&&s._&&s._[">"]||r;if(k)return typeof(k=k[u])=="number"?k:a},i.ify=function(s,u,r,k,o){(s=s||{})._=s._||{},o&&(s._["#"]=o);var m=s._[">"]||(s._[">"]={});return t!==u&&u!=="_"&&(typeof r=="number"&&(m[u]=r),t!==k&&(s[u]=k)),s},g.exports=i})(v,"./state"),v(function(g){v("./shim");function i(a){var c={s:{}},h=c.s;a=a||{max:999,age:1e3*9},c.check=function(t){return h[t]?d(t):!1};var d=c.track=function(t){var s=h[t]||(h[t]={});return s.was=c.now=+new Date,c.to||(c.to=setTimeout(c.drop,a.age+9)),d.ed&&d.ed(t),s};return c.drop=function(t){c.to=null,c.now=+new Date;var s=Object.keys(h);console.STAT&&console.STAT(c.now,+new Date-c.now,"dup drop keys"),setTimeout.each(s,function(u){var r=h[u];r&&(t||a.age)>c.now-r.was||delete h[u]},0,99)},c}g.exports=i})(v,"./dup"),v(function(g){v("./onto"),g.exports=function(a,c){if(this.on){var h=(this.opt||{}).lack||9e3;if(typeof a!="function"){if(!a)return;var t=a["#"]||a,d=(this.tag||"")[t];return d?(c&&(d=this.on(t,c),clearTimeout(d.err),d.err=setTimeout(function(){d.off()},h)),!0):void 0}var t=c&&c["#"]||i(9);if(!a)return t;var s=this.on(t,a,c);return s.err=s.err||setTimeout(function(){s.off(),s.next({err:"Error: No ACK yet.",lack:!0})},h),t}};var i=String.random||function(){return Math.random().toString(36).slice(2)}})(v,"./ask"),v(function(g){function i(o){return o instanceof i?(this._={$:this}).$:this instanceof i?i.create(this._={$:this,opt:o}):new i(o)}i.is=function(o){return o instanceof i||o&&o._&&o===o._.$||!1},i.version=.202,i.chain=i.prototype,i.chain.toJSON=function(){},v("./shim"),i.valid=v("./valid"),i.state=v("./state"),i.on=v("./onto"),i.dup=v("./dup"),i.ask=v("./ask"),function(){i.create=function(l){l.root=l.root||l,l.graph=l.graph||{},l.on=l.on||i.on,l.ask=l.ask||i.ask,l.dup=l.dup||i.dup();var S=l.$.opt(l.opt);return l.once||(l.on("in",o,l),l.on("out",o,l),l.on("put",w,l),i.on("create",l),l.on("create",l)),l.once=1,S};function o(l){if(l){if(l.out===o){this.to.next(l);return}var S=this,j=S.as,D=j.at||j,B=D.$,E=D.dup,G,J=l.DBG;if((G=l["#"])||(G=l["#"]=c(9)),!E.check(G)){if(E.track(G),G=l._,l._=typeof G=="function"?G:function(){},l.$&&l.$===(l.$._||"").$||(l.$=B),l["@"]&&!l.put&&n(l),!D.ask(l["@"],l))if(J&&(J.u=+new Date),l.put){m(l);return}else l.get&&i.on.get(l,B);J&&(J.uc=+new Date),S.to.next(l),J&&(J.ua=+new Date),!(l.nts||l.NTS)&&(l.out=o,D.on("out",l),J&&(J.ue=+new Date))}}}function m(l){if(l){var S=l._||"",j=S.root=((S.$=l.$||"")._||"").root;if(l["@"]&&S.faith&&!S.miss){l.out=o,j.on("out",l);return}S.latch=j.hatch,S.match=j.hatch=[];var D=l.put,B=S.DBG=l.DBG,E=+new Date;if(A=A||E,!(D["#"]&&D["."])){B&&(B.p=E),S["#"]=l["#"],S.msg=l,S.all=0,S.stun=1;var G=Object.keys(D);console.STAT&&console.STAT(E,((B||S).pk=+new Date)-E,"put sort");var J=0,U,P,R,M,I,H,q;(function K(Z){if(U!=J){if(U=J,!(R=G[J])){console.STAT&&console.STAT(E,((B||S).pd=+new Date)-E,"put"),e(S);return}(M=D[R])?(q=M._)?R!==q["#"]?H=p+x(R)+"soul not same.":(I=q[">"])||(H=p+x(R)+"no state."):H=p+x(R)+"no meta.":H=p+x(R)+"no node.",P=Object.keys(M||{})}if(H){l.err=S.err=H,e(S);return}var st=0,W;for(Z=Z||0;Z++<9&&(W=P[st++]);)if(W!=="_"){var z=M[W],ct=I[W];if(u===ct){H=p+x(W)+"on"+x(R)+"no state.";break}if(!d(z)){H=p+x(W)+"on"+x(R)+"bad "+typeof z+x(z);break}y(z,W,R,ct,l),++C}if((P=P.slice(st)).length){h(K);return}++J,P=null,K(Z)})()}}}i.on.put=m;function y(l,S,j,D,B){var E=B._||"",G=E.root,J=G.graph,U,P=J[j]||r,R=t(P,S,1),M=P[S],I=E.DBG;(U=console.STAT)&&(!J[j]||!M)&&(U.has=(U.has||0)+1);var H=$();if(D>H){setTimeout(function(){y(l,S,j,D,B)},(U=D-H)>T?T:U),console.STAT&&console.STAT((I||E).Hf=+new Date,U,"future");return}if(!(D<R)&&!(!E.faith&&D===R&&(l===M||b(l)<=b(M))&&!E.miss)){E.stun++;var q=B["#"]+E.all++,K={toString:function(){return q},_:E};K.toJSON=K.toString,G.dup.track(K)["#"]=B["#"],I&&(I.ph=I.ph||+new Date),G.on("put",{"#":K,"@":B["@"],put:{"#":j,".":S,":":l,">":D},ok:B.ok,_:E})}}function w(l){var S;(S=(l._||"").DBG)&&(S.pa=+new Date,S.pm=S.pm||+new Date);var j=this,D=j.as,B=D.graph,E=l._,G=l.put,J=G["#"],U=G["."],P=G[":"],R=G[">"];l["#"];var M;(M=E.msg)&&(M=M.put)&&(M=M[J])&&s(M,U,R,P,J),B[J]=s(B[J],U,R,P,J),(M=(D.next||"")[J])&&M.on("in",l),e(E),j.to.next(l)}function e(l,S){var j;if(!l.stop&&!(!l.err&&0<--l.stun)&&(l.stop=1,!!(j=l.root))){var D=l.match;D.end=1,D===j.hatch&&(!(D=l.latch)||D.end?delete j.hatch:j.hatch=D),l.hatch&&l.hatch(),setTimeout.each(l.match,function(B){B&&B()}),!(!(S=l.msg)||l.err||S.err)&&(S.out=o,l.root.on("out",S),_())}}function n(l){var S=l["@"]||"",j;if(!(j=S._)){var D=(D=l.$)&&(D=D._)&&(D=D.root)&&(D=D.dup);if(!(D=D.check(S)))return;l["@"]=D["#"]||l["@"];return}j.acks=(j.acks||0)+1,(j.err=l.err)&&(l["@"]=j["#"],e(j)),j.ok=l.ok||j.ok,!j.stop&&!j.crack&&(j.crack=j.match&&j.match.push(function(){f(j)})),f(j)}function f(l){!l||!l.root||l.stun||l.acks!==l.all||l.root.on("in",{"@":l["#"],err:l.err,ok:l.err?u:l.ok||{"":1}})}var p="Error: Invalid graph!",x=function(l){return" '"+(""+l).slice(0,9)+"...' "},b=JSON.stringify,T=2147483647,$=i.state,C=0,A,_=function(){C>999&&C/-(A-(A=+new Date))>1&&(i.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),_=function(){C=0})}}(),function(){i.on.get=function(m,y){var w=y._,e=m.get,n=e["#"],f=w.graph[n],p=e["."],x=w.next||(w.next={}),b=x[n],T=m._||{},$=T.DBG=m.DBG;if($&&($.g=+new Date),!f)return w.on("get",m);if(p){if((typeof p!="string"||u===f[p])&&!((b||"").next||"")[p]){w.on("get",m);return}f=s({},p,t(f,p),f[p],n)}f&&o(m,f),w.on("get",m)};function o(m,y){var w=+new Date,e=m._||{},n=e.DBG=m.DBG,f=m["#"],p=c(9),x=Object.keys(y||"").sort(),b=((y||"")._||"")["#"];x.length;var T=m.$._.root,$=y===T.graph[b];console.STAT&&console.STAT(w,((n||e).gk=+new Date)-w,"got keys"),y&&function C(){w=+new Date;for(var A=0,_,l={},S;A<9&&(_=x[A++]);)s(l,_,t(y,_),y[_],b);x=x.slice(A),(S={})[b]=l,l=S;var j;$&&(j=function(){},j.ram=j.faith=!0),S=x.length,console.STAT&&console.STAT(w,-(w-(w=+new Date)),"got copied some"),n&&(n.ga=+new Date),T.on("in",{"@":f,"#":p,put:l,"%":S?p=c(9):u,$:T.$,_:j,DBG:n,FOO:1}),console.STAT&&console.STAT(w,+new Date-w,"got in"),S&&setTimeout.turn(C)}(),y||T.on("in",{"@":m["#"]})}i.on.get.ack=o}(),function(){i.chain.opt=function(o){o=o||{};var m=this,y=m._,w=o.peers||o;return Object.plain(o)||(o={}),Object.plain(y.opt)||(y.opt=o),typeof w=="string"&&(w=[w]),Object.plain(y.opt.peers)||(y.opt.peers={}),w instanceof Array&&(o.peers={},w.forEach(function(e){var n={};n.id=n.url=e,o.peers[e]=y.opt.peers[e]=y.opt.peers[e]||n})),a(o,function e(n){var f=this[n];if(this&&this.hasOwnProperty(n)||typeof f=="string"||Object.empty(f)){this[n]=f;return}f&&f.constructor!==Object&&!(f instanceof Array)||a(f,e)}),y.opt.from=o,i.on("opt",y),y.opt.uuid=y.opt.uuid||function(e){return i.state().toString(36).replace(".","")+String.random(e||12)},m}}();var a=function(o,m){Object.keys(o).forEach(m,o)},c=String.random,h=setTimeout.turn,d=i.valid,t=i.state.is,s=i.state.ify,u,r={},k;i.log=function(){return!i.log.off&&k.log.apply(k,arguments),[].slice.call(arguments).join(" ")},i.log.once=function(o,m,y){return(y=i.log.once)[o]=y[o]||0,y[o]++||i.log(m)},typeof window<"u"&&((window.GUN=window.Gun=i).window=window);try{typeof O<"u"&&(O.exports=i)}catch{}g.exports=i,(i.window||{}).console=(i.window||{}).console||{log:function(){}},(k=console).only=function(o,m){return k.only.i&&o===k.only.i&&k.only.i++&&(k.log.apply(k,arguments)||m)},i.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(v,"./root"),v(function(g){var i=v("./root");i.chain.back=function(h,d){var t;if(h=h||1,h===-1||h===1/0)return this._.root.$;if(h===1)return(this._.back||this._).$;var s=this,u=s._;if(typeof h=="string"&&(h=h.split(".")),h instanceof Array){var r=0,k=h.length,t=u;for(r;r<k;r++)t=(t||a)[h[r]];return c!==t?d?s:t:(t=u.back)?t.$.back(h,d):void 0}if(typeof h=="function"){for(var o,t={back:u};(t=t.back)&&c===(o=h(t,d)););return o}return typeof h=="number"?(u.back||u).$.back(h-1):this};var a={},c})(v,"./back"),v(function(g){var i=v("./root");i.chain.chain=function(e){var n=this,f=n._,p=new(e||n).constructor(n),x=p._,b;return x.root=b=f.root,x.id=++b.once,x.back=n._,x.on=i.on,x.on("in",i.on.in,x),x.on("out",i.on.out,x),p};function a(e){var n,f=this.as,p=f.back,x=f.root,b;if(e.$||(e.$=f.$),this.to.next(e),f.err){f.on("in",{put:f.put=u,$:f.$});return}if(n=e.get){if(x.pass&&(x.pass[f.id]=f),f.lex&&Object.keys(f.lex).forEach(function(T){b[T]=f.lex[T]},b=e.get=e.get||{}),n["#"]||f.soul){if(n["#"]=n["#"]||f.soul,e["#"]||(e["#"]=r(9)),p=x.$.get(n["#"])._,n=n["."]){if(o(p.put,n)&&(b=p.ask&&p.ask[n],(p.ask||(p.ask={}))[n]=p.$.get(n)._,p.on("in",{get:n,put:{"#":p.soul,".":n,":":p.put[n],">":y(x.graph[p.soul],n)}}),b))return}else{if(b=p.ask&&p.ask[""],(p.ask||(p.ask={}))[""]=p,u!==p.put&&(p.on("in",p),b))return;e.$=p.$}return x.ask(t,e),x.on("in",e)}if(n["."])return f.get?(e={get:{".":f.get},$:f.$},(p.ask||(p.ask={}))[f.get]=e.$._,p.on("out",e)):(e={get:f.lex?e.get:{},$:f.$},p.on("out",e));if((f.ask||(f.ask={}))[""]=f,f.get)return n["."]=f.get,(p.ask||(p.ask={}))[f.get]=e.$._,p.on("out",e)}return p.on("out",e)}i.on.out=a;function c(e,n){n=n||this.as;var f=n.root,p=e.$||(e.$=n.$),x=(p||"")._||s,b=e.put||"",T=b["#"],$=b["."],C=u!==b["="]?b["="]:b[":"],A=b[">"]||-1/0,_;if(u!==e.put&&(u===b["#"]||u===b["."]||u===b[":"]&&u===b["="]||u===b[">"])){if(!k(b)){if(!(T=((b||"")._||"")["#"])){console.log("chain not yet supported for",b,"...",e,n);return}return p=n.root.$.get(T),setTimeout.each(Object.keys(b).sort(),function(l){l=="_"||u===(A=y(b,l))||n.on("in",{$:p,put:{"#":T,".":l,"=":b[l],">":A},VIA:e})})}n.on("in",{$:x.back.$,put:{"#":T=x.back.soul,".":$=x.has||x.get,"=":b,">":y(x.back.put,$)},via:e});return}(e.seen||"")[n.id]||((e.seen||(e.seen=function(){}))[n.id]=n,n!==x&&(Object.keys(e).forEach(function(l){b[l]=e[l]},b={}),b.get=n.get||b.get,!n.soul&&!n.has?b.$$$=b.$$$||n.$:x.soul&&(b.$=n.$,b.$$=b.$$||x.$),e=b),d(e,n),(n.soul||e.$$)&&A>=y(f.graph[T],$)&&((b=f.$.get(T)._).put=w(b.put,$,A,C,T)),!x.soul&&A>=y(f.graph[T],$)&&(_=(f.$.get(T)._.next||"")[$])&&(_.put=C,typeof(b=k(C))=="string"&&(_.put=f.$.get(b)._.put||C)),this.to&&this.to.next(e),n.any&&setTimeout.each(Object.keys(n.any),function(l){(l=n.any[l])&&l(e)},0,99),n.echo&&setTimeout.each(Object.keys(n.echo),function(l){(l=n.echo[l])&&l.on("in",e)},0,99),((e.$$||"")._||x).soul&&(_=n.next)&&(_=_[$])&&(b={},Object.keys(e).forEach(function(l){b[l]=e[l]}),b.$=(e.$$||e.$).get(b.get=$),delete b.$$,delete b.$$$,_.on("in",b)),h(e,n))}i.on.in=c;function h(e,n){if(n=n||this.as||e.$._,!(e.$$&&this!==i.on)&&!(!e.put||n.soul)){var f=e.put||"",p=f["="]||f[":"],x,b=n.root,T=b.$.get(f["#"]).get(f["."])._;if(typeof(p=k(p))!="string"){this===i.on&&((T.echo||(T.echo={}))[n.id]=n);return}if(!((T.echo||(T.echo={}))[n.id]&&!(b.pass||"")[n.id])){if(x=b.pass){if(x[p+n.id])return;x[p+n.id]=1}(T.echo||(T.echo={}))[n.id]=n,n.has&&(n.link=p);var $=b.$.get(T.link=p)._;($.echo||($.echo={}))[T.id]=T;var x=n.ask||"";(x[""]||n.lex)&&$.on("out",{get:{"#":p}}),setTimeout.each(Object.keys(x),function(A,_){!A||!(_=x[A])||_.on("out",{get:{"#":p,".":A}})},0,99)}}}i.on.link=h;function d(e,n){var f=e.put||"",p=u!==f["="]?f["="]:f[":"],x=n.root,b,T;if(u===p){if(n.soul&&u!==n.put||(T=(e.$$||e.$||"")._||"",e["@"]&&(u!==T.put||u!==n.put)))return;(b=n.link||e.linked)&&delete(x.$.get(b)._.echo||"")[n.id],n.has&&(n.link=null),n.put=u,setTimeout.each(Object.keys(n.next||""),function($,C){(C=n.next[$])&&(b&&delete(x.$.get(b).get($)._.echo||"")[C.id],C.on("in",{get:$,put:u,$:C.$}))},0,99);return}n.soul||e.$$||(b=k(p),T=e.$._||"",!((b===T.link||n.has&&!T.link)&&!((x.pass||"")[n.id]&&typeof b!="string"))&&(delete(T.echo||"")[n.id],d({get:n.get,put:u,$:e.$,linked:e.linked=e.linked||T.link},n)))}i.on.unlink=d;function t(e,n){var f=this.as,p=f.$._;p.root;var x=f.get||"",b=(e.put||"")[x["#"]]||"";if(!e.put||typeof x["."]=="string"&&u===b[x["."]]){if(u!==p.put||!p.soul&&!p.has)return;p.ack=(p.ack||0)+1,p.on("in",{get:p.get,put:p.put=u,$:p.$,"@":e["@"]});return}(e._||{}).miss=1,i.on.put(e)}var s={},u,r=String.random,k=i.valid,o=function(e,n){return e&&Object.prototype.hasOwnProperty.call(e,n)},m=i.state,y=m.is,w=m.ify})(v,"./chain"),v(function(g){var i=v("./root");i.chain.get=function(u,r,k){var o,m;if(typeof u=="string"){if(u.length==0)return(o=this.chain())._.err={err:i.log("0 length key!",u)},r&&r.call(o,o._.err),o;var y=this,w=y._,e=w.next||d;(o=e[u])||(o=u&&a(u,y)),o=o&&o.$}else if(typeof u=="function"){let b=function($,C,A){if(!b.stun&&!((B=f.pass)&&!B[p])){var _=$.$._,l=($.$$||"")._,S=(l||_).put,j=!_.has&&!_.soul,D={},B;if((j||s===S)&&(S=s===((B=$.put)||"")["="]?s===(B||"")[":"]?B:B[":"]:B["="]),typeof(B=i.valid(S))=="string"&&(S=s===(B=f.$.get(B)._.put)?n.not?s:S:B),!(n.not&&s===S)){if(s===n.stun){if((B=f.stun)&&B.on&&(w.$.back(function(E){if(B.on(""+E.id,D={}),(D.run||0)<b.id)return D}),!D.run&&B.on(""+_.id,D={}),!D.run&&l&&B.on(""+l.id,D={}),b.id>D.run&&((!D.stun||D.stun.end)&&(D.stun=B.on("stun"),D.stun=D.stun&&D.stun.last),D.stun&&!D.stun.end))){(D.stun.add||(D.stun.add={}))[p]=function(){b($,C,1)};return}if(s===S&&(A=0),(B=f.hatch)&&!B.end&&s===n.hatch&&!A){if(x[_.$._.id])return;x[_.$._.id]=1,B.push(function(){b($,C,1)});return}x={}}if(f.pass){if(f.pass[p+_.id])return;f.pass[p+_.id]=1}if(n.on){n.ok.call(_.$,S,_.get,$,C||b);return}if(n.v2020){n.ok($,C||b);return}Object.keys($).forEach(function(E){B[E]=$[E]},B={}),$=B,$.put=S,n.ok.call(n.as,$,C||b)}}};if(r===!0)return c(this,u,r,k),this;o=this;var w=o._,n=r||{},f=w.root,p;n.at=w,n.ok=u;var x={};return b.at=w,(w.any||(w.any={}))[p=String.random(7)]=b,b.off=function(){b.stun=1,w.any&&delete w.any[p]},b.rid=h,b.id=n.run||++f.once,m=f.pass,(f.pass={})[p]=1,n.out=n.out||{get:{}},w.on("out",n.out),f.pass=m,o}else{if(typeof u=="number")return this.get(""+u,r,k);if(typeof(m=t(u))=="string")return this.get(m,r,k);(m=this.get.next)&&(o=m(this,u))}return o?(r&&typeof r=="function"&&o.get(r,k),o):((o=this.chain())._.err={err:i.log("Invalid get request!",u)},r&&r.call(o,o._.err),o)};function a(u,r){var k=r._,o=k.next,m=r.chain(),y=m._;return o||(o=k.next={}),o[y.get=u]=y,r===k.root.$?y.soul=u:(k.soul||k.has)&&(y.has=u),y}function c(u,r,k,o){var m=u._,y=0,w;return(w=m.soul||m.link)?r(w,o,m):m.jam?m.jam.push([r,o]):(m.jam=[[r,o]],u.get(function(e,n){if(!(s===e.put&&!m.root.opt.super&&(w=Object.keys(m.root.opt.peers).length)&&++y<=w)){n.rid(e);var f=(f=e.$)&&f._||{},p=0,x;for(w=m.jam,delete m.jam;x=w[p++];){var b=x[0];x=x[1],b&&b(f.link||f.soul||i.valid(e.put)||((e.put||{})._||{})["#"],x,e,n)}}},{out:{get:{".":!0}}}),u)}function h(u){var r=this.at||this.on;if(!u||r.soul||r.has)return this.off();if(u=(u=(u=u.$||u)._||u).id){r.map;var k;if((k=this.seen||(this.seen={}))[u])return!0;k[u]=!0}}var d={},t=i.valid,s})(v,"./get"),v(function(g){var i=v("./root");i.chain.put=function(o,m,y){var w=this,e=w._,n=e.root;y=y||{},y.root=e.root,y.run||(y.run=n.once),a(y,e.id),y.ack=y.ack||m,y.via=y.via||w,y.data=y.data||o,y.soul||(y.soul=e.soul||typeof m=="string"&&m);var f=y.state=y.state||i.state();return typeof o=="function"?(o(function(p){y.data=p,w.put(t,t,y)}),w):y.soul?(y.$=n.$.get(y.soul),y.todo=[{it:y.data,ref:y.$}],y.turn=y.turn||u,y.ran=y.ran||c,function p(){var x=y.todo,b=x.pop(),T=b.it;b.ref&&b.ref._.id;var $,C,A,_,l;if(a(y,b.ref),(_=b.todo)&&(C=_.pop(),T=T[C],_.length&&x.push(b)),C&&(x.path||(x.path=[])).push(C),!($=r(T))&&!(l=i.is(T))){if(!Object.plain(T)){c.err(y,"Invalid data: "+d(T)+" at "+(y.via.back(function(B){B.get&&_.push(B.get)},_=[])||_.join("."))+"."+(x.path||[]).join("."));return}for(var S=y.seen||(y.seen=[]),j=S.length;j--;)if(T===(_=S[j]).it){$=T=_.link;break}}if(C&&$)b.node=k(b.node,C,f,T);else{let B=function(E,G){var J=A.link["#"];G&&(G.off(),G.rid(E));var U=J||E.soul||(_=(E.$$||E.$)._||"").soul||_.link||((_=_.put||"")._||"")["#"]||_["#"]||((_=E.put||"")&&E.$$?_["#"]:(_["="]||_[":"]||"")["#"]);if(!J&&a(y,E.$),!U&&!b.link["#"]){(b.wait||(b.wait=[])).push(function(){B(E,G)});return}U||(U=[],(E.$$||E.$).back(function(P){if(_=P.soul||P.link)return U.push(_);U.push(P.get)}),U=U.reverse().join("/")),A.link["#"]=U,!l&&(((y.graph||(y.graph={}))[U]=A.node||(A.node={_:{}}))._["#"]=U),delete y.wait[D],A.wait&&setTimeout.each(A.wait,function(P){P&&P()}),y.ran(y)};if(!y.seen){c.err(y,"Data at root of graph must be a node (an object).");return}y.seen.push(A={it:T,link:{},todo:l?[]:Object.keys(T).sort().reverse(),path:(x.path||[]).slice(),up:b}),b.node=k(b.node,C,f,A.link),!l&&A.todo.length&&x.push(A);var D=y.seen.length;(y.wait||(y.wait={}))[D]="",_=(A.ref=l?T:C?b.ref.get(C):b.ref)._,(_=T&&(T._||"")["#"]||_.soul||_.link)?B({soul:_}):A.ref.get(B,{run:y.run,v2020:1,out:{get:{".":" "}}})}if(!x.length)return y.ran(y);y.turn(p)}(),w):(h(y),w)};function a(o,m){if(m){m=(m._||"").id||m;var y=o.root.stun||(o.root.stun={on:i.on}),w={},e;o.stun||(o.stun=y.on("stun",function(){})),(e=y.on(""+m))&&e.the.last.next(w),!(w.run>=o.run)&&y.on(""+m,function(n){if(o.stun.end){this.off(),this.to.next(n);return}n.run=n.run||o.run,n.stun=n.stun||o.stun})}}function c(o){if(o.err){c.end(o.stun,o.root);return}if(!(o.todo.length||o.end||!Object.empty(o.wait))){o.end=1;var m=o.$.back(-1)._,y=m.root,w=m.ask(function(p){y.on("ack",p),p.err&&!p.lack&&i.log(p),++e>(o.acks||0)&&this.off(),o.ack&&o.ack(p,this)},o.opt),e=0,n=o.stun,f;(f=function(){n&&(c.end(n,y),setTimeout.each(Object.keys(n=n.add||""),function(p){(p=n[p])&&p()}))}).hatch=f,o.ack&&!o.ok&&(o.ok=o.acks||9),o.via._.on("out",{put:o.out=o.graph,ok:o.ok&&{"@":o.ok+1},opt:o.opt,"#":w,_:f})}}c.end=function(o,m){o.end=s,o.the.to===o&&o===o.the.last&&delete m.stun,o.off()},c.err=function(o,m){(o.ack||s).call(o,o.out={err:o.err=i.log(m)}),o.ran(o)};function h(o){var m=o.via._,y;o.via=o.via.back(function(w){if(w.soul||!w.get)return w.$;y=o.data,(o.data={})[w.get]=y}),(!o.via||!o.via._.soul)&&(o.via=m.root.$.get(((o.data||"")._||"")["#"]||m.$.back("opt.uuid")())),o.via.put(o.data,o.ack,o)}function d(o,m){return o&&(m=o.constructor)&&m.name||typeof o}var t,s=function(){},u=setTimeout.turn,r=i.valid,k=i.state.ify})(v,"./put"),v(function(g){var i=v("./root");v("./chain"),v("./back"),v("./put"),v("./get"),g.exports=i})(v,"./index"),v(function(g){var i=v("./index");i.chain.on=function(h,d,t,s){var u=this,r=u._;r.root;var k;if(typeof h=="string")return d?(k=r.on(h,d,t||r,s),t&&t.$&&(t.subs||(t.subs=[])).push(k),u):r.on(h);var o=d;return(o=o===!0?{change:!0}:o||{}).not=1,o.on=1,u.get(h,o),u},i.chain.once=function(h,d){if(d=d||{},!h)return a(this);var t=this,s=t._,u=s.root;s.put;var r=String.random(7),k;return t.get(function(o,m,y,w){var e=this,n=e._,f=n.one||(n.one={});if(w.stun||f[r]==="")return;if((k=i.valid(o))===!0){p();return}if(typeof k=="string")return;clearTimeout((s.one||"")[r]),clearTimeout(f[r]),f[r]=setTimeout(p,d.wait||99);function p(x){if(!n.has&&!n.soul&&(n={put:o,get:m}),c===(k=n.put)&&(k=((y.$$||"")._||"").put),typeof i.valid(k)=="string"&&(k=u.$.get(k)._.put,k===c&&!x)){f[r]=setTimeout(function(){p(1)},d.wait||99);return}w.stun||f[r]!==""&&(f[r]="",(s.soul||s.has)&&w.off(),h.call(e,k,n.get),clearTimeout(f[r]))}},{on:1}),t};function a(h,d,t){return i.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(t=h.chain())._.nix=h.once(function(s,u){t._.on("in",this._)}),t._.lex=h._.lex,t}i.chain.off=function(){var h=this,d=h._,t,s=d.back;if(s)return d.ack=0,(t=s.next)&&t[d.get]&&delete t[d.get],(t=s.any)&&(delete s.any,s.any={}),(t=s.ask)&&delete t[d.get],(t=s.put)&&delete t[d.get],(t=d.soul)&&delete s.root.graph[t],(t=d.map)&&Object.keys(t).forEach(function(u,r){r=t[u],r.link&&s.root.$.get(r.link).off()}),(t=d.next)&&Object.keys(t).forEach(function(u,r){r=t[u],r.$.off()}),d.on("off",{}),h};var c})(v,"./on"),v(function(g){var i=v("./index"),a=i.chain.get.next;i.chain.get.next=function(t,s){var u;return Object.plain(s)?(u=((u=s["#"])||"")["="]||u)?t.get(u):((u=t.chain()._).lex=s,t.on("in",function(r){String.match(r.get||(r.put||"")["."],s["."]||s["#"]||s)&&u.on("in",r),this.to.next(r)}),u.$):(a||h)(t,s)},i.chain.map=function(t,s,u){var r=this,k=r._,o,m;return Object.plain(t)&&(o=t["."]?t:{".":t},t=d),t?(i.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),m=r.chain(),r.map().on(function(y,w,e,n){var f=(t||h).call(this,y,w,e,n);if(d!==f){if(y===f)return m._.on("in",e);if(i.is(f))return m._.on("in",f._);var p={};Object.keys(e.put).forEach(function(x){p[x]=e.put[x]},p),p["="]=f,m._.on("in",{get:w,put:p})}}),m):((m=k.each)||((k.each=m=r.chain())._.lex=o||m._.lex||k.lex,m._.nix=r.back("nix"),r.on("in",c,m._)),m)};function c(t){this.to.next(t);var s=this.as,u=t.$,r=u._,k=t.put,o;!r.soul&&!t.$$||(o=s.lex)&&!String.match(t.get||(k||"")["."],o["."]||o["#"]||o)||i.on.link(t,s)}var h=function(){},d})(v,"./map"),v(function(g){var i=v("./index");i.chain.set=function(a,c,h){var d=this,t=d.back(-1),s,u;return c=c||function(){},h=h||{},h.item=h.item||a,(s=((a||"")._||"")["#"])&&((a={})["#"]=s),typeof(u=i.valid(a))=="string"?d.get(s=u).put(a,c,h):i.is(a)?(d.put(function(r){a.get(function(k,o,m){if(!k)return c.call(d,{err:i.log('Only a node can be linked! Not "'+m.put+'"!')});(u={})[k]={"#":k},r(u)},!0)}),a):(Object.plain(a)&&(a=t.get(s=d.back("opt.uuid")()).put(a)),d.get(s||t.back("opt.uuid")(7)).put(a,c,h))}})(v,"./set"),v(function(g){v("./shim");var i=function(){},a=JSON.parseAsync||function(t,s,u){var r,k=+new Date;try{s(r,JSON.parse(t,u),c.sucks(+new Date-k))}catch(o){s(o)}},c=JSON.stringifyAsync||function(t,s,u,r){var k,o=+new Date;try{s(k,JSON.stringify(t,u,r),c.sucks(+new Date-o))}catch(m){s(m)}};c.sucks=function(t){t>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),c.sucks=i)};function h(t){var s=function(){},u=t.opt||{};u.log=u.log||console.log,u.gap=u.gap||u.wait||0,u.max=u.max||(u.memory?u.memory*999*999:3e8)*.3,u.pack=u.pack||u.max*.01*.01,u.puff=u.puff||9;var r=setTimeout.turn||setTimeout,k=t.dup,o=k.check,m=k.track,y=s.hear=function(n,f){if(n){if(u.max<=n.length)return s.say({dam:"!",err:"Message too big!"},f);s===this&&(y.d+=n.length||0,++y.c);var p=f.SH=+new Date,x=n[0],b;if(x==="["){a(n,function(T,$){if(T||!$)return s.say({dam:"!",err:"DAM JSON parse error."},f);console.STAT&&console.STAT(+new Date,$.length,"# on hear batch");var C=u.puff;(function A(){for(var _=+new Date,l=0,S;l<C&&(S=$[l++]);)s.hear(S,f);$=$.slice(l),console.STAT&&console.STAT(_,+new Date-_,"hear loop"),w(f),$.length&&r(A,0)})()}),n="";return}if(x==="{"||(n["#"]||Object.plain(n))&&(b=n)){if(b)return y.one(b,f,p);a(n,function(T,$){if(T||!$)return s.say({dam:"!",err:"DAM JSON parse error."},f);y.one($,f,p)});return}}};y.one=function(n,f,p){var x,b,T,$,C;if(n.DBG&&(n.DBG=C={DBG:n.DBG}),C&&(C.h=p),C&&(C.hp=+new Date),(x=n["#"])||(x=n["#"]=String.random(9)),!(T=o(x))&&(b=n["##"],!(b&&(T=n["@"]||n.get&&x)&&k.check($=T+b)))){if((n._=function(){}).via=s.leap=f,(T=n["><"])&&typeof T=="string"&&T.slice(0,99).split(",").forEach(function(_){this[_]=1},n._.yo={}),T=n.dam){(T=s.hear[T])&&T(n,f,t),m(x);return}(T=n.ok)&&(n._.near=T["/"]);var p=+new Date;C&&(C.is=p),f.SI=x,m.ed=function(_){x===_&&(m.ed=0,(_=k.s[x])&&(_.via=f,n.get&&(_.it=n)))},t.on("in",s.last=n),C&&(C.hd=+new Date),console.STAT&&console.STAT(p,+new Date-p,n.get?"msg get":n.put?"msg put":"msg"),m(x),$&&m($),s.leap=s.last=null}},y.c=y.d=0,function(){var n=0,f;s.hash=function(b,T){var $,C,A,_=+new Date;c(b.put,function l(S,j){var D=(C||(C=A=j||"")).slice(0,32768);if($=String.hash(D,$),C=C.slice(32768),C){r(l,0);return}console.STAT&&console.STAT(_,+new Date-_,"say json+hash"),b._.$put=A,b["##"]=$,s.say(b,T),delete b._.$put},p)};function p(b,T){var $;return T instanceof Object?(Object.keys(T).sort().forEach(x,{to:$={},on:T}),$):T}function x(b){this.to[b]=this.on[b]}s.say=function(b,T){var $;if(($=this)&&($=$.to)&&$.next&&$.next(b),!b)return!1;var C,A,_,l=b["@"],S=b._||(b._=function(){}),j=b.DBG,D=+new Date;if(S.y=S.y||D,T||j&&(j.y=D),(C=b["#"])||(C=b["#"]=String.random(9)),!f&&m(C),!(A=b["##"])&&d!==b.put&&!S.via&&l){s.hash(b,T);return}if(!T&&l&&(T=($=k.s[l])&&($.via||($=$.it)&&($=$._)&&$.via)||($=s.last)&&l===$["#"]&&s.leap),!T&&l)return k.s[l]?void 0:(console.STAT&&console.STAT(+new Date,++n,"total no peer to ack to"),!1);if(l&&!b.put&&!A&&((k.s[l]||"").it||"")["##"])return!1;if(!T&&s.way)return s.way(b);if(j&&(j.yh=+new Date),!(_=S.raw)){s.raw(b,T);return}if(j&&(j.yr=+new Date),!T||!T.id){if(!Object.plain(T||u.peers))return!1;var D=+new Date;u.puff;var B=u.peers,E=Object.keys(T||u.peers||{});console.STAT&&console.STAT(D,+new Date-D,"peer keys"),function U(){var P=+new Date;f=1;var R=S.raw;S.raw=_;for(var M=0,I;M<9&&(I=(E||"")[M++]);)(I=B[I]||(T||"")[I])&&s.say(b,I);S.raw=R,f=0,E=E.slice(M),console.STAT&&console.STAT(P,+new Date-P,"say loop"),E.length&&(r(U,0),l&&m(l))}();return}if(!T.wire&&s.wire&&s.wire(T),C!==T.last){if(T.last=C,T===S.via||($=S.yo)&&($[T.url]||$[T.pid]||$[T.id]))return!1;if(console.STAT&&console.STAT(D,((j||S).yp=+new Date)-(S.y||D),"say prep"),!f&&l&&m(l),T.batch){if(T.tail=($=T.tail||0)+_.length,T.tail<=u.pack){T.batch+=($?",":"")+_;return}w(T)}T.batch="[";var G=+new Date;setTimeout(function(){console.STAT&&console.STAT(G,+new Date-G,"0ms TO"),w(T)},u.gap),e(_,T),console.STAT&&l===T.SI&&console.STAT(D,+new Date-T.SH,"say ack")}},s.say.c=s.say.d=0,s.raw=function(b,T){if(!b)return"";var $=b._||{},C,A;if(A=$.raw)return A;if(typeof b=="string")return b;var _=b["##"],l=b["@"];if(_&&l){if(!$.via&&o(l+_))return!1;if(A=(k.s[l]||"").it){if(_===A["##"])return!1;A["##"]||(A["##"]=_)}}if(!b.dam&&!b["@"]){var S=0,j=[];A=u.peers;for(var D in A){var B=A[D];if(j.push(B.url||B.pid||B.id),++S>6)break}S>1&&(b["><"]=j.join())}if(b.put&&(A=b.ok)&&(b.ok={"@":(A["@"]||1)-1,"/":A["/"]==b._.near?s.near:A["/"]}),C=$.$put){A={},Object.keys(b).forEach(function(G){A[G]=b[G]}),A.put=":])([:",c(A,function(G,J){if(!G){var U=+new Date;A=J.indexOf('"put":":])([:"'),E(d,J=J.slice(0,A+6)+C+J.slice(A+14)),console.STAT&&console.STAT(U,+new Date-U,"say slice")}});return}c(b,E);function E(G,J){G||($.raw=J,s.say(b,T))}}}();function w(n){var f=n.batch,p=typeof f=="string";if(p&&(f+="]"),n.batch=n.tail=null,!!f&&!(p?3>f.length:!f.length)){if(!p)try{f=f.length===1?f[0]:JSON.stringify(f)}catch(x){return u.log("DAM JSON stringify error",x)}f&&e(f,n)}}function e(n,f){try{var p=f.wire;f.say?f.say(n):p.send&&p.send(n),s.say.d+=n.length||0,++s.say.c}catch{(f.queue=f.queue||[]).push(n)}}return s.near=0,s.hi=function(n){var f=n.wire,p;if(!f){s.wire(n.length&&{url:n,id:n}||n);return}n.id?u.peers[n.url||n.id]=n:(p=n.id=n.id||n.url||String.random(9),s.say({dam:"?",pid:t.opt.pid},u.peers[p]=n),delete k.s[n.last]),n.met||(s.near++,n.met=+new Date,t.on("hi",n)),p=n.queue,n.queue=[],setTimeout.each(p||[],function(x){e(x,n)},0,9)},s.bye=function(n){n.met&&--s.near,delete n.met,t.on("bye",n);var f=+new Date;f=f-(n.met||f),s.bye.time=((s.bye.time||f)+f)/2},s.hear["!"]=function(n,f){u.log("Error:",n.err)},s.hear["?"]=function(n,f){n.pid&&(f.pid||(f.pid=n.pid),n["@"])||(s.say({dam:"?",pid:u.pid,"@":n["#"]},f),delete k.s[f.last])},s.hear.mob=function(n,f){if(n.peers){var p=Object.keys(n.peers),x=p[Math.random()*p.length>>0];x&&(s.bye(f),s.hi(x))}},t.on("create",function(n){n.opt.pid=n.opt.pid||String.random(9),this.to.next(n),n.on("out",s.say)}),t.on("bye",function(n,f){n=u.peers[n.id||n]||n,this.to.next(n),n.bye?n.bye():(f=n.wire)&&f.close&&f.close(),delete u.peers[n.id],n.wire=null}),t.on("bye",function(n,f){this.to.next(n),(f=console.STAT)&&(f.peers=s.near),(f=n.url)&&setTimeout(function(){},u.lack||9e3)}),t.on("hi",function(n,f){if(this.to.next(n),(f=console.STAT)&&(f.peers=s.near),!u.super){var p=Object.keys(t.next||"");p.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(p,function(x){var b=t.next[x];if(u.super||(b.ask||"")[""]){s.say({get:{"#":x}},n);return}setTimeout.each(Object.keys(b.ask||""),function(T){T&&s.say({"##":String.hash((t.graph[x]||"")[T]),get:{"#":x,".":T}},n)})})}}),s}var d;try{g.exports=h}catch{}})(v,"./mesh"),v(function(g){var i=v("./index");i.Mesh=v("./mesh"),i.on("opt",function(c){if(this.to.next(c),c.once)return;var h=c.opt;if(h.WebSocket===!1)return;var d=i.window||{},t=h.WebSocket||d.WebSocket||d.webkitWebSocket||d.mozWebSocket;if(!t)return;h.WebSocket=t;var s=h.mesh=h.mesh||i.Mesh(c);s.wire||h.wire,s.wire=h.wire=u;function u(m){try{if(!m||!m.url)return w&&w(m);var y=m.url.replace(/^http/,"ws"),w=m.wire=new h.WebSocket(y);return w.onclose=function(){k(m),h.mesh.bye(m)},w.onerror=function(e){k(m)},w.onopen=function(){h.mesh.hi(m)},w.onmessage=function(e){e&&h.mesh.hear(e.data||e,m)},w}catch{h.mesh.bye(m)}}setTimeout(function(){!h.super&&c.on("out",{dam:"hi"})},1);var r=2*999;function k(m){clearTimeout(m.defer),h.peers[m.url]&&(o&&m.retry<=0||(m.retry=(m.retry||h.retry+1||60)-(-m.tried+(m.tried=+new Date)<r*4?1:0),m.defer=setTimeout(function y(){if(o&&o.hidden)return setTimeout(y,r);u(m)},r)))}var o=""+a!=typeof document&&document});var a})(v,"./websocket"),v(function(g){if(!(typeof Gun>"u")){var i=function(){},a;try{a=(Gun.window||i).localStorage}catch{}a||(Gun.log("Warning: No localStorage exists to persist data to!"),a={setItem:function(h,d){this[h]=d},removeItem:function(h){delete this[h]},getItem:function(h){return this[h]}});var c=JSON.stringifyAsync||function(h,d,t,s){var u;try{d(u,JSON.stringify(h,t,s))}catch(r){d(r)}};Gun.on("create",function h(d){this.to.next(d);var t=d.opt;d.graph;var s=[],u,r,k,o;if(t.localStorage===!1)return;t.prefix=t.file||"gun/";try{u=h[t.prefix]=h[t.prefix]||JSON.parse(k=a.getItem(t.prefix))||{}}catch{u=h[t.prefix]={}}k=(k||"").length,d.on("get",function(y){this.to.next(y);var w=y.get,e,n,f,p;!w||!(e=w["#"])||(n=u[e]||p,n&&(f=w["."])&&!Object.plain(f)&&(n=Gun.state.ify({},f,Gun.state.is(n,f),n[f],e)),Gun.on.get.ack(y,n))}),d.on("put",function(y){this.to.next(y);var w=y.put,e=w["#"],n=w["."],f=y["#"],p=y.ok||"";if(u[e]=Gun.state.ify(u[e],n,w[">"],w[":"],e),o&&k>4999880){d.on("in",{"@":f,err:"localStorage max!"});return}!y["@"]&&(!y._.via||Math.random()<p["@"]/p["/"])&&s.push(f),!r&&(r=setTimeout(m,9+k/333))});function m(){if(!s.length&&((setTimeout.turn||"").s||"").length){setTimeout(m,99);return}var y=s;clearTimeout(r),r=!1,s=[],c(u,function(w,e){try{!w&&a.setItem(t.prefix,e)}catch(n){w=o=n||"localStorage failure"}w&&(Gun.log(w+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),d.on("localStorage:error",{err:w,get:t.prefix,put:u})),k=e.length,setTimeout.each(y,function(n){d.on("in",{"@":n,err:w,ok:0})},0,99)})}})}})(v,"./localStorage")})(),function(){var v;if(""+v!=typeof Gun){var O=function(l){console.warn("Warning! Deprecated internal utility will break in next version:",l)},g=Gun;g.fn=g.fn||{is:function(l){return O("fn"),!!l&&typeof l=="function"}},g.bi=g.bi||{is:function(l){return O("bi"),l instanceof Boolean||typeof l=="boolean"}},g.num=g.num||{is:function(l){return O("num"),!i(l)&&(l-parseFloat(l)+1>=0||l===1/0||l===-1/0)}},g.text=g.text||{is:function(l){return O("text"),typeof l=="string"}},g.text.ify=g.text.ify||function(l){return O("text.ify"),g.text.is(l)?l:typeof JSON<"u"?JSON.stringify(l):l&&l.toString?l.toString():l},g.text.random=g.text.random||function(l,S){O("text.random");var j="";for(l=l||24,S=S||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";l>0;)j+=S.charAt(Math.floor(Math.random()*S.length)),l--;return j},g.text.match=g.text.match||function(l,S){var j,D;return O("text.match"),typeof l!="string"?!1:(typeof S=="string"&&(S={"=":S}),S=S||{},j=S["="]||S["*"]||S[">"]||S["<"],l===j?!0:D!==S["="]?!1:(j=S["*"]||S[">"]||S["<"],l.slice(0,(j||"").length)===j?!0:D!==S["*"]?!1:D!==S[">"]&&D!==S["<"]?l>=S[">"]&&l<=S["<"]:D!==S[">"]&&l>=S[">"]||D!==S["<"]&&l<=S["<"]))},g.text.hash=g.text.hash||function(l,S){if(O("text.hash"),typeof l=="string"){if(S=S||0,!l.length)return S;for(var j=0,D=l.length,B;j<D;++j)B=l.charCodeAt(j),S=(S<<5)-S+B,S|=0;return S}},g.list=g.list||{is:function(l){return O("list"),l instanceof Array}},g.list.slit=g.list.slit||Array.prototype.slice,g.list.sort=g.list.sort||function(l){return O("list.sort"),function(S,j){return!S||!j?0:(S=S[l],j=j[l],S<j?-1:S>j?1:0)}},g.list.map=g.list.map||function(l,S,j){return O("list.map"),C(l,S,j)},g.list.index=1,g.obj=g.boj||{is:function(l){return O("obj"),l?l instanceof Object&&l.constructor===Object||Object.prototype.toString.call(l).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},g.obj.put=g.obj.put||function(l,S,j){return O("obj.put"),(l||{})[S]=j,l},g.obj.has=g.obj.has||function(l,S){return O("obj.has"),l&&Object.prototype.hasOwnProperty.call(l,S)},g.obj.del=g.obj.del||function(l,S){if(O("obj.del"),!!l)return l[S]=null,delete l[S],l},g.obj.as=g.obj.as||function(l,S,j,D){return O("obj.as"),l[S]=l[S]||(D===j?{}:j)},g.obj.ify=g.obj.ify||function(l){if(O("obj.ify"),p(l))return l;try{l=JSON.parse(l)}catch{l={}}return l},function(){var l;function S(j,D){b(this,D)&&l!==this[D]||(this[D]=j)}g.obj.to=g.obj.to||function(j,D){return O("obj.to"),D=D||{},C(j,S,D),D}}(),g.obj.copy=g.obj.copy||function(l){return O("obj.copy"),l&&JSON.parse(JSON.stringify(l))},function(){function l(S,j){var D=this.n,B;if(!(D&&(j===D||p(D)&&b(D,j)))&&B!==j)return!0}g.obj.empty=g.obj.empty||function(S,j){return O("obj.empty"),S?!C(S,l,{n:j}):!0}}(),function(){function l(D,B){if(arguments.length===2){l.r=l.r||{},l.r[D]=B;return}l.r=l.r||[],l.r.push(D)}var S=Object.keys,j;Object.keys=Object.keys||function(D){return j(D,function(B,E,G){G(E)})},g.obj.map=j=g.obj.map||function(D,B,E){O("obj.map");var G,J=0,U,P,R,M,I=typeof B=="function";if(l.r=G,S&&p(D)&&(R=S(D),M=!0),E=E||{},i(D)||R)for(U=(R||D).length;J<U;J++){var H=J+g.list.index;if(I){if(P=M?B.call(E,D[R[J]],R[J],l):B.call(E,D[J],H,l),P!==G)return P}else if(B===D[M?R[J]:J])return R?R[J]:H}else for(J in D)if(I){if(b(D,J)&&(P=E?B.call(E,D[J],J,l):B(D[J],J,l),P!==G))return P}else if(B===D[J])return J;return I?l.r:g.list.index?0:-1}}(),g.time=g.time||{},g.time.is=g.time.is||function(l){return O("time"),l?l instanceof Date:+new Date().getTime()};var n=g.fn.is,i=g.list.is,f=g.obj,p=f.is,b=f.has,C=f.map,a={};a.is=function(l){return O("val.is"),l===v?!1:l===null?!0:l===1/0?!1:d(l)||h(l)||m(l)?!0:a.link.is(l)||!1},a.link=a.rel={_:"#"},function(){a.link.is=function(S){if(O("val.link.is"),S&&S[c]&&!S._&&p(S)){var j={};if(C(S,l,j),j.id)return j.id}return!1};function l(S,j){var D=this;if(D.id)return D.id=!1;if(j==c&&d(S))D.id=S;else return D.id=!1}}(),a.link.ify=function(l){return O("val.link.ify"),$({},c,l)},g.obj.has._=".";var c=a.link._,v,h=g.bi.is,m=g.num.is,d=g.text.is,f=g.obj,p=f.is,$=f.put,C=f.map;g.val=g.val||a;var t={_:"_"};t.soul=function(l,S){return O("node.soul"),l&&l._&&l._[S||r]},t.soul.ify=function(l,S){return O("node.soul.ify"),S=typeof S=="string"?{soul:S}:S||{},l=l||{},l._=l._||{},l._[r]=S.soul||l._[r]||u(),l},t.soul._=a.link._,function(){t.is=function(S,j,D){O("node.is");var B;return p(S)&&(B=t.soul(S))?!C(S,l,{as:D,cb:j,s:B,n:S}):!1};function l(S,j){if(j!==t._){if(!a.is(S))return!0;this.cb&&this.cb.call(this.as,S,j,this.n,this.s)}}}(),function(){t.ify=function(S,j,D){return O("node.ify"),j?typeof j=="string"?j={soul:j}:typeof j=="function"&&(j={map:j}):j={},j.map&&(j.node=j.map.call(D,S,v,j.node||{})),(j.node=t.soul.ify(j.node||{},j))&&C(S,l,{o:j,as:D}),j.node};function l(S,j){var D=this.o,B,E;if(D.map){B=D.map.call(this.as,S,""+j,D.node),E===B?x(D.node,j):D.node&&(D.node[j]=B);return}a.is(S)&&(D.node[j]=S)}}();var f=g.obj,p=f.is,x=f.del,C=f.map,s=g.text,u=s.random,r=t.soul._,v;g.node=g.node||t;var k=g.state;k.lex=function(){return O("state.lex"),k().toString(36).replace(".","")},k.to=function(l,S,j){O("state.to");var D=(l||{})[S];return p(D)&&(D=A(D)),k.ify(j,S,k.is(l,S),D,t.soul(l))},function(){k.map=function(S,j,D){O("state.map");var B,E=p(E=S||j)?E:null;return S=n(S=S||j)?S:null,E&&!S?(j=m(j)?j:k(),E[w]=E[w]||{},C(E,l,{o:E,s:j}),E):(D=D||p(j)?j:B,j=m(j)?j:k(),function(G,J,U,P){if(!S)return l.call({o:U,s:j},G,J),G;S.call(D||this||{},G,J,U,P),!(b(U,J)&&B===U[J])&&l.call({o:U,s:j},G,J)})};function l(S,j){w!==j&&k.ify(this.o,j,this.s)}}();var f=g.obj;f.as;var b=f.has,p=f.is,C=f.map,A=f.copy,o=g.num,m=o.is,y=g.fn,n=y.is,w=t._,v,e={};(function(){e.is=function(j,D,B,E){return O("graph.is"),!j||!p(j)||T(j)?!1:!C(j,l,{cb:D,fn:B,as:E})};function l(j,D){if(!j||D!==t.soul(j)||!t.is(j,this.fn,this.as))return!0;this.cb&&(S.n=j,S.as=this.as,this.cb.call(S.as,j,D,S))}function S(j){j&&t.is(S.n,j,S.as)}})(),function(){e.ify=function(E,G,J){O("graph.ify");var U={path:[],obj:E};return G?typeof G=="string"?G={soul:G}:typeof G=="function"&&(G.map=G):G={},typeof J=="string"&&(G.soul=G.soul||J,J=v),G.soul&&(U.link=a.link.ify(G.soul)),G.shell=(J||{}).shell,G.graph=G.graph||{},G.seen=G.seen||[],G.as=G.as||J,l(G,U),G.root=U.node,G.graph};function l(E,G){var J;return(J=B(E,G))?J:(G.env=E,G.soul=j,t.ify(G.obj,S,G)&&(G.link=G.link||a.link.ify(t.soul(G.node)),G.obj!==E.shell&&(E.graph[a.link.is(G.link)]=G.node)),G)}function S(E,G,J){var U=this,P=U.env,R,M;if(t._===G&&b(E,a.link._))return J._;if(R=D(E,G,J,U,P)){if(G||(U.node=U.node||J||{},b(E,t._)&&t.soul(E)&&(U.node._=A(E._)),U.node=t.soul.ify(U.node,a.link.is(U.link)),U.link=U.link||a.link.ify(t.soul(U.node))),(M=P.map)&&(M.call(P.as||{},E,G,J,U),b(J,G))){if(E=J[G],v===E){x(J,G);return}if(!(R=D(E,G,J,U,P)))return}if(!G)return U.node;if(R===!0)return E;if(M=l(P,{obj:E,path:U.path.concat(G)}),!!M.node)return M.link}}function j(E){var G=this,J=a.link.is(G.link),U=G.env.graph;G.link=G.link||a.link.ify(E),G.link[a.link._]=E,G.node&&G.node[t._]&&(G.node[t._][a.link._]=E),b(U,J)&&(U[E]=U[J],x(U,J))}function D(E,G,J,U,P){var R;if(a.is(E))return!0;if(p(E))return 1;if(R=P.invalid)return E=R.call(P.as||{},E,G,J),D(E,G,J,U,P);P.err="Invalid value at '"+U.path.concat(G).join(".")+"'!",g.list.is(E)&&(P.err+=" Use `.set(item)` instead of an Array.")}function B(E,G){for(var J=E.seen,U=J.length,P;U--;)if(P=J[U],G.obj===P.obj)return P;J.push(G)}}(),e.node=function(l){O("graph.node");var S=t.soul(l);if(S)return $({},S,l)},function(){e.to=function(S,j,D){if(O("graph.to"),!!S){var B={};return D=D||{seen:{}},C(S[j],l,{obj:B,graph:S,opt:D}),B}};function l(S,j){var D,B;if(t._===j){if(T(S,a.link._))return;this.obj[j]=A(S);return}if(!(D=a.link.is(S))){this.obj[j]=S;return}if(B=this.opt.seen[D]){this.obj[j]=B;return}this.obj[j]=this.opt.seen[D]=e.to(this.graph,D,this.opt)}}();var n=g.fn.is,f=g.obj,p=f.is,x=f.del,b=f.has,T=f.empty,$=f.put,C=f.map,A=f.copy,v;g.graph=g.graph||e}}()}(yt)),yt.exports}var Kt=V();const Wt=jt(Kt);var Dt=typeof window<"u"?window.Gun:V();Dt.chain.promise=function(O){var v=this,O=O||function(g){return g};return new Promise(function(g,i){v.once(function(a,c){g({put:a,get:c,gun:this})})}).then(O)};Dt.chain.then=function(N){var v=this,O=new Promise((g,i)=>{v.once(function(a,c){g(a,c)})});return N?O.then(N):O};var mt={exports:{}},wt;function ut(){return wt||(wt=1,function(){function N(){var a=function(c,h,d){if(a.unit=0,!d&&g!==h&&(a.last=""+c<a.last?a.last:""+c,delete(a.$||{})[i]),d=d||a.$||(a.$={}),!c&&Object.keys(d).length)return d;c=""+c;for(var t=0,s=c.length-1,u=c[t],r,k;!(r=d[u])&&t<s;)u+=c[++t];if(r)if(t==s){if(g===h)return g===(k=r[""])?r:(a.unit=1)&&k;r[""]=h}else return g!==h&&delete r[i],a(c.slice(++t),h,r||(r={}));else{if(!v(d,function(o,m){var y=0,w="";if((m||"").length)for(;m[y]==c[y];)w+=m[y++];if(w){if(g===h)return y<=s?void 0:((k||(k={}))[m.slice(y)]=o,o);var e={};if(e[m.slice(y)]=o,y=c.slice(y),y===""?e[""]=h:(e[y]={})[""]=h,d[w]=e,N.debug&&""+w=="undefined"){console.log(0,w);debugger}return delete d[m],!0}})){if(g===h)return;if((d[u]||(d[u]={}))[""]=h,N.debug&&""+u=="undefined"){console.log(1,u);debugger}}if(g===h)return k}};return a}if(N.map=function a(c,h,d,t){try{t=t||[];var s=typeof c=="function"?c.$||{}:c;//!opt && console.log("WHAT IS T?", JSON.stringify(t).length);
if(!s)return;if(typeof s=="string"){if(N.debug)throw["BUG:",c,h,d,t];return}var u=(s[i]||O).sort||(s[i]=function T(){return T.sort=Object.keys(s).sort(),T}()).sort,r;d=d===!0?{branch:!0}:d||{},(r=d.reverse)&&(u=u.slice(0).reverse());for(var k=d.start,o=d.end,m="￿",y=0,w=u.length;y<w;y++){var e=u[y],n=s[e],f,p,x;if(!(!n||e===""||i===e||e==="undefined")&&(p=t.slice(0),p.push(e),x=p.join(""),!(g!==k&&x<(k||"").slice(0,x.length))&&!(g!==o&&(o||m)<x))){if(r&&(f=a(n,h,d,p),g!==f))return f;if(g!==(f=n[""])){var b=1;if(g!==k&&x<(k||"")&&(b=0),g!==o&&x>(o||m)&&(b=0),b&&(f=h(f,x,e,t),g!==f))return f}else if(d.branch&&(f=h(g,x,e,t),g!==f))return f;if(t=p,!r&&(f=a(n,h,d,t),g!==f))return f;t.pop()}}}catch(T){console.error(T)}},typeof window<"u")window.Radix=N;else try{mt.exports=N}catch{}var v=N.object=function(a,c,h){for(var d in a)if(a.hasOwnProperty(d)&&(h=c(a[d],d))!==g)return h},O={},g,i=""}()),mt.exports}ut();var Ft={exports:{}},bt={exports:{}},kt;function Vt(){return kt||(kt=1,function(N){(function(){var v={},O,g=setTimeout.turn||typeof setImmediate!=""+O&&setImmediate||setTimeout;v.parseAsync=function(a,c,h,d){if(typeof a!="string"){try{c(O,JSON.parse(a))}catch(u){c(u)}return}var t={i:0,text:a,done:c,l:a.length,up:[]};d=d||1024*32,s();function s(){for(var u=t.text,r=t.i,k=t.l,o=0,m=t.w,y,w;o++<d;){var e=u[r++];if(r>k){t.end=!0;break}if(m){for(r=u.indexOf('"',r-1),e=u[r],w=0;u[r-++w]=="\\";);w=!(w%2),y=y||w,e=='"'&&!w&&(m=O,w=t.s,t.a?(w=u.slice(t.sl,r),(y||1+w.indexOf("\\"))&&(w=JSON.parse('"'+w+'"')),t.at instanceof Array?t.at.push(t.s=w):(t.at||(t.end=o=d,w=O),(t.at||{})[t.s]=t.s=w),t.s=O):(t.s=u.slice(t.sl,r),(y||1+t.s.indexOf("\\"))&&(t.s=JSON.parse('"'+t.s+'"'))),t.a=y=O),++r}else switch(e){case'"':t.sl=r,m=!0;break;case":":t.ai=r,t.a=!0;break;case",":(t.a||t.at instanceof Array)&&(w=u.slice(t.ai,r-1))&&O!==(w=i(w))&&(t.at instanceof Array?t.at.push(w):t.at[t.s]=w),t.a=O,t.at instanceof Array&&(t.a=!0,t.ai=r);break;case"{":t.up.push(t.at||(t.at={})),t.at instanceof Array?t.at.push(t.at={}):O!==(w=t.s)&&(t.at[w]=t.at={}),t.a=O;break;case"}":t.a&&(w=u.slice(t.ai,r-1))&&O!==(w=i(w))&&(t.at instanceof Array?t.at.push(w):(t.at||(t.end=o=d,w=O),(t.at||{})[t.s]=w)),t.a=O,t.at=t.up.pop();break;case"[":O!==(w=t.s)?(t.up.push(t.at),t.at[w]=t.at=[]):t.at||t.up.push(t.at=[]),t.a=!0,t.ai=r;break;case"]":t.a&&(w=u.slice(t.ai,r-1))&&O!==(w=i(w))&&(t.at instanceof Array?t.at.push(w):t.at[t.s]=w),t.a=O,t.at=t.up.pop();break}}if(t.s=O,t.i=r,t.w=m,t.end){if(w=t.at,O===w)try{w=JSON.parse(a)}catch(n){return t.done(n)}t.done(O,w)}else g(s)}};function i(a){var c=parseFloat(a);if(!isNaN(c))return c;if(a=a.trim(),a=="true")return!0;if(a=="false")return!1;if(a=="null")return null}v.stringifyAsync=function(a,c,h,d,t){t=t||{},t.text=t.text||"",t.up=[t.at={d:a}],t.done=c,t.i=0;var s=0;u();function u(){var r=t.at,k=r.d,o="",m;switch(r.i&&r.i-r.j>0&&(o+=","),O!==(m=r.k)&&(o+=JSON.stringify(m)+":"),typeof k){case"boolean":o+=""+k;break;case"string":o+=JSON.stringify(k);break;case"number":o+=isNaN(k)?"null":k;break;case"object":if(!k){o+="null";break}if(k instanceof Array){o+="[",r={i:-1,as:k,up:r,j:0},r.l=k.length,t.up.push(t.at=r);break}if(typeof(k||"").toJSON!="function"){o+="{",r={i:-1,ok:Object.keys(k).sort(),as:k,up:r,j:0},r.l=r.ok.length,t.up.push(t.at=r);break}if(m=k.toJSON()){o+=m;break}case"function":if(r.as instanceof Array){o+="null";break}default:o="",r.j++}for(t.text+=o;1+r.i>=r.l;)t.text+=r.ok?"}":"]",r=t.at=r.up;if(++r.i<r.l){if((m=r.ok)?r.d=r.as[r.k=m[r.i]]:r.d=r.as[r.i],++s<9)return u();s=0,g(u);return}t.done(O,t.text)}},typeof window!=""+O&&(window.YSON=v);try{""+O!="object"&&(N.exports=v)}catch{}typeof JSON!=""+O&&(JSON.parseAsync=v.parseAsync,JSON.stringifyAsync=v.stringifyAsync)})()}(bt)),bt.exports}var xt,Tt;function qt(){return Tt||(Tt=1,xt=function(N){var v=ut();N.find("a",function(){var O=[];v.map(N.list,function(a,c){c.indexOf("%1B")+1&&a&&O.push([c,a])}),O.length&&console.log(`
! ! ! WARNING ! ! !
RAD v0.2020.x has detected OLD v0.2019.x data & automatically migrating. Automatic migration will be turned OFF in future versions! If you are just developing/testing, we recommend you reset your data. Please contact us if you have any concerns.
This message should only log once.`);var g,i;O.forEach(function(a){g=a[0],i=a[1],N.list(decodeURIComponent(g),i),N.list(g,0)}),g&&N.find.bad(g)})}),xt}(function(){function N(g){g=g||{},g.log=g.log||console.log,g.file=String(g.file||"radata");var i=(N.has||(N.has={}))[g.file];if(i)return i;g.max=g.max||(g.memory?g.memory*999*999:3e8)*.3,g.until=g.until||g.wait||250,g.batch=g.batch||10*1e3,g.chunk=g.chunk||1024*1024*1,g.code=g.code||{},g.code.from=g.code.from||"!",g.jsonify=!0;function a(y){return encodeURIComponent(y).replace(/\*/g,"%2A")}function c(y){return m!==y&&(!y||typeof y!="object")}var h=""+m==typeof setImmediate?setTimeout:setImmediate,d=setTimeout.turn||h,m,t=O.object,s=0;if(!g.store)return g.log("ERROR: Radisk needs `opt.store` interface with `{get: fn, put: fn (, list: fn)}`!");if(!g.store.put)return g.log("ERROR: Radisk needs `store.put` interface with `(file, data, cb)`!");if(!g.store.get)return g.log("ERROR: Radisk needs `store.get` interface with `(file, cb)`!");g.store.list,""+m!=typeof at("/lib")&&Vt();var u=JSON.parseAsync||function(y,w,e){var n;try{w(n,JSON.parse(y,e))}catch(f){w(f)}},r=function(y,w,e,n,f){if(typeof w=="function"){var p=e||{};e=w,r.read(y,e,p,f||n);return}r.save(y,w,e,n,f)};r.save=function(y,w,e,n,f){var p={key:y},x,b;p.find=function(T){var $;if(p.file=T||(T=g.code.from),f&&(f=f[T]=f[T]||{}),f&&(f.sf=f.sf||+new Date),$=r.disk[T]){p.mix(m,$);return}r.parse(T,p.mix,m,f)},p.mix=function(T,$){if(f&&(f.sml=+new Date),f&&(f.sm=f.sm||+new Date),p.err=T||p.err){e(T);return}var C=p.file=($||"").file||p.file,A;if(!$&&C!==g.code.from){r.find.bad(C),r.save(y,w,e,n);return}if(($=r.disk[C]||(r.disk[C]=$||O())).file||($.file=C),g.compare&&(w=g.compare($(y),w,y,C),m===w)){e(T,-1);return}if((p.disk=$)(y,w),n&&((A=(A=$.tags||($.tags={}))[n]||(A[n]=r.tags[n]||(r.tags[n]={})))[C]||(A[C]=r.one[n]||(r.one[n]=e)),e=null),f&&(f.st=f.st||+new Date),$.Q){e&&$.Q.push(e);return}$.Q=e?[e]:[],$.to=setTimeout(p.write,g.until)},p.write=function(){f&&(f.sto=f.sto||+new Date);var T=x=p.file,$=p.disk;b=p.q=$.Q,p.tags=$.tags,delete $.Q,delete r.disk[T],delete $.tags,r.write(T,$,p.ack,m,f)},p.ack=function(T,$){f&&(f.sa=f.sa||+new Date),f&&(f.sal=b.length);var C,A;for(var _ in r.tags)if(r.tags.hasOwnProperty(_)){var l=r.tags[_];if(!((A=r.disk[x])&&(A=A.tags)&&A[l])){C=l[x],delete l[x];var S;for(var j in l)if(l.hasOwnProperty(j)){S=!0;break}S||(delete r.tags[l],C&&C(T,$))}}!b&&(b="");for(var D=b.length,B=0,E=+new Date;B<D;B++)(C=b[B])&&C(T,$);console.STAT&&console.STAT(E,+new Date-E,"rad acks",a(p.file)),console.STAT&&console.STAT(E,b.length,"rad acks #",a(p.file))},e||(e=function(T,$){}),r.find(y,p.find)},r.disk={},r.one={},r.tags={};var k=0;r.write=function(y,w,e,n,f){if(!w){e("No radix!");return}n=typeof n=="object"?n:{force:n};var p=function(){},x,b;if(p.text="",p.file=y=w.file||(w.file=y),!y){e("What file?");return}if(p.write=function(){var T=w.raw=p.text;r.disk[y=w.file||p.file||y]=w;var $=+new Date;f&&(f.wd=$),r.find.add(y,function(C){if(f&&(f.wa=+new Date),C){e(C);return}g.store.put(a(y),T,function(A,_){f&&(f.wp=+new Date),console.STAT&&console.STAT($,s=+new Date-$,"wrote disk",JSON.stringify(y),++k,"total all writes."),e(A,_||1),w.Q||delete r.disk[y]})})},p.split=function(){var T=+new Date;f&&(f.wf=T),p.text="",p.count||(p.count=0,O.map(w,function(){p.count++})),f&&(f.wfc=p.count),p.limit=Math.ceil(p.count/2);var $=p.count;return p.count=0,f&&(f.wf1=+new Date),p.sub=O(),O.map(w,p.slice,{reverse:1}),f&&(f.wf2=+new Date),r.write(p.end,p.sub,p.both,n),f&&(f.wf3=+new Date),p.hub=O(),O.map(w,p.stop),f&&(f.wf4=+new Date),r.write(w.file,p.hub,p.both,n),f&&(f.wf5=+new Date),console.STAT&&console.STAT(T,+new Date-T,"rad split",a(w.file),$),!0},p.slice=function(T,$){if(p.sub(p.end=$,T),p.limit<=++p.count)return!0},p.stop=function(T,$){if($>=p.end)return!0;p.hub($,T)},p.both=function(T,$){if(f&&(f.wfd=+new Date),b){e(T||b);return}if(x){e(T,$);return}x=!0,b=T},p.each=function(T,$,C,A){if(m!==T&&p.count++,g.max<=(T||"").length)return e("Data too big!"),!0;var _=N.encode(A.length)+"#"+N.encode(C)+(m===T?"":":"+N.encode(T))+`
`;if(g.chunk<p.text.length+_.length&&1<p.count&&!n.force)return p.split();p.text+=_},g.jsonify){r.write.jsonify(p,w,e,n,f);return}O.map(w,p.each,!0)||p.write()},r.write.jsonify=function(y,w,e,n,f){var p,x=+new Date;f&&(f.w=x);try{p=JSON.stringify(w.$)}catch{e("Cannot radisk!");return}if(f&&(f.ws=+new Date),console.STAT&&console.STAT(x,+new Date-x,"rad stringified JSON"),g.chunk<p.length&&!n.force){var b=0;if(O.map(w,function(){if(b++)return!0}),b>1)return y.split()}y.text=p,y.write()},r.range=function(y,w){if(!(!y||!w)){if(m===w.start&&m===w.end||c(y))return y;var e=O();return O.map(y,function(n,f){e(f,n)},w),e("")}},function(){r.read=function(y,w,e,n){e=e||{};var f={key:y};f.find=function(p){var x;if(f.file=p||(p=g.code.from),n&&(n=n[p]=n[p]||{}),n&&(n.rf=n.rf||+new Date),x=r.disk[f.file=p]){f.check(m,x);return}r.parse(p,f.check,m,n)},f.get=function(p,x,b){if(n&&(n.rgl=+new Date),n&&(n.rg=n.rg||+new Date),f.err=p||f.err){w(p);return}var T=f.file=(x||"").file||f.file;if(!x&&T!==g.code.from){r.find.bad(T),r.read(y,w,e);return}if(x=r.disk[T]||(r.disk[T]=x),!x){w(T===g.code.from?m:"No file!");return}x.file||(x.file=T);var $=r.range(x(y),e);if(n&&(n.rr=+new Date),e.unit=x.unit,e.chunks=(e.chunks||0)+1,e.parsed=(e.parsed||0)+((b||"").parsed||e.chunks*g.chunk),e.more=1,e.next=m,O.map(r.list,function(_,l){if(!(!_||T===l))return e.next=l,1},e.reverse?{reverse:1,end:T}:{start:T}),n&&(n.rl=+new Date),e.next||(e.more=0),e.next&&(!e.reverse&&(y<e.next&&e.next.indexOf(y)!=0||m!==e.end&&(e.end||"￿")<e.next)&&(e.more=0),e.reverse&&(y>e.next&&y.indexOf(e.next)!=0||m!==e.start&&(e.start||"")>e.next&&T<=e.start)&&(e.more=0)),!e.more){w(f.err,$,e);return}if($&&w(f.err,$,e),!(e.parsed>=e.limit)){var C=+new Date;n&&(n.rm=C);var A=e.next;h(function(){console.STAT&&console.STAT(C,+new Date-C,"rad more"),r.parse(A,f.check)},0)}},f.check=function(p,x,b){if(f.get(p,x,b),!(!x||x.check)){x.check=1;var T=+new Date;(b||(b={})).file||(b.file=f.file),O.map(x,function($,C){r.find(C,function(A){if((A||(A=g.code.from))!==b.file){var _=(""+Math.random()).slice(-3);d(function(){r.save(C,$,function l(S,j){if(S){r.save(C,$,l);return}console.STAT&&console.STAT("MISLOCATED DATA CORRECTED",_,a(C),a(b.file),a(A))})},0)}})}),console.STAT&&console.STAT(T,+new Date-T,"rad check")}},r.find(y||(e.reverse?e.end||"":e.start||""),f.find)}}(),function(){var y=0,w={},e="";r.parse=function(n,f,p,x){var b;if(!n)return f();if(b=w[n]){b.push(f);return}b=w[n]=[f];var T=function(){},$={file:n};(T.disk=O()).file=n,T.read=function(A,_){if(x&&(x.rpg=+new Date),console.STAT&&console.STAT(C,+new Date-C,"read disk",JSON.stringify(n),++y,"total all parses."),(T.err=A)||(T.not=!_)){delete w[n],T.map(b,T.ack);return}if(typeof _!="string"){try{g.max<=_.length?T.err="Chunk too big!":_=_.toString()}catch(l){T.err=l}if(T.err){delete w[n],T.map(b,T.ack);return}}if($.parsed=_.length,x&&(x.rpl=$.parsed),x&&(x.rpa=b.length),C=+new Date,!(g.jsonify||_[0]==="{")){T.radec(A,_);return}u(_,function(l,S){if(!l){delete w[n],T.disk.$=S,console.STAT&&(s=+new Date-C)>9&&console.STAT(C,s,"rad parsed JSON"),x&&(x.rpd=+new Date),T.map(b,T.ack);return}if(_[0]==="{"){delete w[n],T.err="JSON error!",T.map(b,T.ack);return}T.radec(l,_)})},T.map=function(){if(!(!b||!b.length)){for(var A=+new Date,_=T.err,l=T.not?m:T.disk,S=0,j;S<9&&(j=b[S++]);)j(_,l,$);console.STAT&&console.STAT(A,+new Date-A,"rad packs",a(n)),console.STAT&&console.STAT(A,S,"rad packs #",a(n)),(b=b.slice(S)).length&&d(T.map,0)}},T.ack=function(A){if(A){if(T.err||T.not){A(T.err,m,$);return}A(m,T.disk,$)}},T.radec=function(A,_){delete w[n],C=+new Date;var l=T.split(_),S=[],j,D,B;if(!l||l[1]!==0){T.err="File '"+n+"' does not have root radix! ",T.map(b,T.ack);return}for(;l;)D=B=m,j=l[1],l=T.split(l[2])||"",l[0]=="#"&&(D=l[1],S=S.slice(0,j),j<=S.length&&S.push(D)),l=T.split(l[2])||"",l[0]!=`
`&&((l[0]=="="||l[0]==":")&&(B=l[1]),m!==D&&m!==B&&T.disk(S.join(""),B),l=T.split(l[2]));console.STAT&&console.STAT(C,+new Date-C,"parsed RAD"),T.map(b,T.ack)},T.split=function(A){if(A){var _=[],l={},S=-1,j="";if(S=A.indexOf(e),!!A[S])return j=A.slice(0,S),_[0]=j,_[1]=N.decode(A.slice(S),l),_[2]=A.slice(S+l.i),_}},r.disk&&(p||(p=(r.disk[n]||"").raw));var C=+new Date;if(x&&(x.rp=C),p)return d(function(){T.read(m,p)},0);g.store.get(a(n),T.read)}}(),function(){var y,w="",e;r.find=function(p,x){if(!y){if(e){e.push([p,x]);return}e=[[p,x]],r.parse(w,n);return}O.map(r.list=y,function(b,T){if(b)return x(T)||!0},{reverse:1,end:p})||x(g.code.from)},r.find.add=function(p,x){var b=y(p);if(b||p===w){x(m,1);return}y(p,1),x.found=(x.found||0)+1,r.write(w,y,function(T,$){if(T){x(T);return}x.found=(x.found||0)-1,x.found===0&&x(m,1)},!0)},r.find.bad=function(p,x){y(p,0),r.write(w,y,x||o)};function n(p,x){if(p){g.log("list",p),setTimeout(function(){r.parse(w,n)},1e3);return}if(x){f(x);return}if(y=y||x||O(),!g.store.list){f(y);return}g.store.list(function(b){if(!b){f(y);return}r.find.add(b,o)})}function f(p,x){y=y||p,y.file=w,x=e,e=null,t(x,function(b){r.find(b[0],b[1])})}}();try{!v.window&&qt()(r)}catch{}var o=function(){},m;return N.has[g.file]=r,r}if(function(){var g="";N.encode=function(i,a,c){c=c||g;var h=c,d;if(typeof i=="string"){for(var t=i.indexOf(c);t!=-1;)h+=c,t=i.indexOf(c,t+1);return h+'"'+i+c}else{if(i&&i["#"]&&Object.keys(i).length==1)return h+"#"+d+h;if(typeof i=="number")return h+"+"+(i||0)+h;if(i===null)return h+" "+h;if(i===!0)return h+"+"+h;if(i===!1)return h+"-"+h}},N.decode=function(i,a,c){c=c||g;var h="",d=-1,t=0,s,u;if(c===i[0]){for(;c===i[++d];)++t;for(u=i[s=t]||!0;--t>=0;)d=i.indexOf(c,d+1);if(d==-1&&(d=i.length),h=i.slice(s+1,d),a&&(a.i=d+1),u==='"')return h;if(u==="#")return{"#":h};if(u==="+")return h.length===0?!0:parseFloat(h);if(u===" ")return null;if(u==="-")return!1}}}(),typeof window<"u"){var v=window.Gun,O=window.Radix;window.Radisk=N}else{var v=V(),O=ut();try{Ft.exports=N}catch{}}N.Radix=O})();var Yt={exports:{}};(function(){function N(O){O=O||{},O.file=String(O.file||"radata");var g=N[O.file],i=null,a;if(g)return console.log("Warning: reusing same IndexedDB store and options as 1st."),N[O.file];g=N[O.file]=function(){};try{O.indexedDB=O.indexedDB||N.indexedDB||indexedDB}catch{}try{if(!O.indexedDB||location.protocol=="file:"){var c=g.d||(g.d={});return g.put=function(h,d,t){c[h]=d,setTimeout(function(){t(null,1)},250)},g.get=function(h,d){setTimeout(function(){d(null,c[h]||a)},5)},console.log("Warning: No indexedDB exists to persist data to!"),g}}catch{}return g.start=function(){var h=indexedDB.open(O.file,1);h.onupgradeneeded=function(d){d.target.result.createObjectStore(O.file)},h.onsuccess=function(){i=h.result},h.onerror=function(d){console.log(d||1)}},g.start(),g.put=function(h,d,t){if(!i){setTimeout(function(){g.put(h,d,t)},1);return}var s=i.transaction([O.file],"readwrite"),u=s.objectStore(O.file),r=u.put(d,""+h);r.onsuccess=u.onsuccess=s.onsuccess=function(){t(null,1)},r.onabort=u.onabort=s.onabort=function(k){t(k||"put.tx.abort")},r.onerror=u.onerror=s.onerror=function(k){t(k||"put.tx.error")}},g.get=function(h,d){if(!i){setTimeout(function(){g.get(h,d)},9);return}var t=i.transaction([O.file],"readonly"),s=t.objectStore(O.file),u=s.get(""+h);u.onsuccess=function(){d(null,u.result)},u.onabort=function(r){d(r||4)},u.onerror=function(r){d(r||5)}},setInterval(function(){i&&i.close(),i=null,g.start()},1e3*15),g}if(typeof window<"u")(N.window=window).RindexedDB=N,N.indexedDB=window.indexedDB;else try{Yt.exports=N}catch{}try{var v=N.window.Gun||V();v.on("create",function(O){this.to.next(O),O.opt.store=O.opt.store||N(O.opt)})}catch{}})();(function(){var N=typeof window<"u"?window.Gun:V();N.on("opt",function(v){this.to.next(v);var O=v.opt;if(v.once||!N.Mesh||O.RTCPeerConnection===!1)return;var g;typeof window<"u"&&(g=window),typeof X<"u"&&(g=X),g=g||{};var i=O.RTCPeerConnection||g.RTCPeerConnection||g.webkitRTCPeerConnection||g.mozRTCPeerConnection,a=O.RTCSessionDescription||g.RTCSessionDescription||g.webkitRTCSessionDescription||g.mozRTCSessionDescription,c=O.RTCIceCandidate||g.RTCIceCandidate||g.webkitRTCIceCandidate||g.mozRTCIceCandidate;if(!i||!a||!c)return;O.RTCPeerConnection=i,O.RTCSessionDescription=a,O.RTCIceCandidate=c,O.rtc=O.rtc||{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.sipgate.net:3478"}]},O.rtc.dataChannel=O.rtc.dataChannel||{ordered:!1,maxRetransmits:2},O.rtc.sdp=O.rtc.sdp||{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},O.rtc.max=O.rtc.max||55,O.rtc.room=O.rtc.room||N.window&&(location.hash.slice(1)||location.pathname.slice(1)),O.announce=function(t){O.rtc.start=+new Date,v.$.get("/RTC/"+O.rtc.room+"<?99").get("+").put(O.pid,function(s){!s.ok||!s.ok.rtc||d(s)},{acks:O.rtc.max}).on(function(s,u,r){s===O.pid||O.rtc.start>r.put[">"]||d({"#":""+r["#"],ok:{rtc:{id:s}}})})};var h=O.mesh=O.mesh||N.Mesh(v);v.on("create",function(t){this.to.next(t),setTimeout(O.announce,1)});function d(t){if(this&&this.off&&this.off(),!!t.ok){var s=t.ok.rtc,u,r;if(!(!s||!s.id||s.id===O.pid)){if(r=s.answer)return!(u=O.peers[s.id]||d[s.id])||u.remoteSet?void 0:(r.sdp=r.sdp.replace(/\\r\\n/g,`\r
`),u.setRemoteDescription(u.remoteSet=new O.RTCSessionDescription(r)));if(r=s.candidate)return u=O.peers[s.id]||d[s.id]||d({ok:{rtc:{id:s.id}}}),u.addIceCandidate(new O.RTCIceCandidate(r));if(!d[s.id]){(u=new O.RTCPeerConnection(O.rtc)).id=s.id;var k=u.wire=u.createDataChannel("dc",O.rtc.dataChannel);if(d[s.id]=u,k.to=setTimeout(function(){delete d[s.id]},1e3*60),k.onclose=function(){h.bye(u)},k.onerror=function(o){},k.onopen=function(o){delete d[s.id],h.hi(u)},k.onmessage=function(o){o&&h.hear(o.data||o,u)},u.onicecandidate=function(o){o.candidate&&v.on("out",{"@":t["#"],ok:{rtc:{candidate:o.candidate,id:O.pid}}})},u.ondatachannel=function(o){var m=o.channel;m.onmessage=k.onmessage,m.onopen=k.onopen,m.onclose=k.onclose},r=s.offer){s.offer.sdp=s.offer.sdp.replace(/\\r\\n/g,`\r
`),u.setRemoteDescription(new O.RTCSessionDescription(r)),u.createAnswer(function(o){u.setLocalDescription(o),v.on("out",{"@":t["#"],ok:{rtc:{answer:o,id:O.pid}}})},function(){},O.rtc.sdp);return}return u.createOffer(function(o){u.setLocalDescription(o),v.on("out",{"@":t["#"],"#":v.ask(d),ok:{rtc:{offer:o,id:O.pid}}})},function(){},O.rtc.sdp),u}}}}})})();var _t={exports:{}};(function(N){(function(){function v(g,i){return i?at("/")(g):g.slice?v[a(g)]:function(c,h){g(c={exports:{}}),v[a(h)]=c.exports};function a(c){return c.split("/").slice(-1).toString().replace(".js","")}}var O=N;v(function(g){typeof self<"u"&&(g.window=self),typeof window<"u"&&(g.window=window);var i=g.window||g,a,c=i.SEA||{};(c.window=g.window)&&(c.window.SEA=c);try{a+""!=typeof O&&(O.exports=c)}catch{}g.exports=c})(v,"./root"),v(function(g){var i=v("./root");try{i.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(v,"./https"),v(function(g){var i;if(i+""==typeof btoa){if(i+""==typeof Buffer)try{X.Buffer=v("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}X.btoa=function(a){return Buffer.from(a,"binary").toString("base64")},X.atob=function(a){return Buffer.from(a,"base64").toString("binary")}}})(v,"./base64"),v(function(g){v("./base64");function i(){}Object.assign(i,{from:Array.from}),i.prototype=Object.create(Array.prototype),i.prototype.toString=function(a,c,h){a=a||"utf8",c=c||0;const d=this.length;if(a==="hex"){const t=new Uint8Array(this);return[...Array((h&&h+1||d)-c).keys()].map(s=>t[s+c].toString(16).padStart(2,"0")).join("")}if(a==="utf8")return Array.from({length:(h||d)-c},(t,s)=>String.fromCharCode(this[s+c])).join("");if(a==="base64")return btoa(this)},g.exports=i})(v,"./array"),v(function(g){v("./base64");var i=v("./array");function a(...c){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),a.from(...c)}a.prototype=Object.create(Array.prototype),Object.assign(a,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const c=arguments[0];let h;if(typeof c=="string"){const d=arguments[1]||"utf8";if(d==="hex"){const t=c.match(/([\da-fA-F]{2})/g).map(s=>parseInt(s,16));if(!t||!t.length)throw new TypeError("Invalid first argument for type 'hex'.");h=i.from(t)}else if(d==="utf8"||d==="binary"){const t=c.length,s=new Uint16Array(t);Array.from({length:t},(u,r)=>s[r]=c.charCodeAt(r)),h=i.from(s)}else if(d==="base64"){const t=atob(c),s=t.length,u=new Uint8Array(s);Array.from({length:s},(r,k)=>u[k]=t.charCodeAt(k)),h=i.from(u)}else d==="binary"?h=i.from(c):console.info("SafeBuffer.from unknown encoding: "+d);return h}if(c.byteLength,c.byteLength?c.byteLength:c.length){let d;return c instanceof ArrayBuffer&&(d=new Uint8Array(c)),i.from(d||c)}},alloc(c,h=0){return i.from(new Uint8Array(Array.from({length:c},()=>h)))},allocUnsafe(c){return i.from(new Uint8Array(Array.from({length:c})))},concat(c){if(!Array.isArray(c))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return i.from(c.reduce((h,d)=>h.concat(Array.from(d)),[]))}}),a.prototype.from=a.from,a.prototype.toString=i.prototype.toString,g.exports=a})(v,"./buffer"),v(function(g){const i=v("./root"),a={Buffer:v("./buffer")};var c={},h;if(JSON.parseAsync=JSON.parseAsync||function(t,s,u){var r;try{s(r,JSON.parse(t,u))}catch(k){s(k)}},JSON.stringifyAsync=JSON.stringifyAsync||function(t,s,u,r){var k;try{s(k,JSON.stringify(t,u,r))}catch(o){s(o)}},a.parse=function(t,s){return new Promise(function(u,r){JSON.parseAsync(t,function(k,o){k?r(k):u(o)},s)})},a.stringify=function(t,s,u){return new Promise(function(r,k){JSON.stringifyAsync(t,function(o,m){o?k(o):r(m)},s,u)})},i.window&&(a.crypto=i.window.crypto||i.window.msCrypto,a.subtle=(a.crypto||c).subtle||(a.crypto||c).webkitSubtle,a.TextEncoder=i.window.TextEncoder,a.TextDecoder=i.window.TextDecoder,a.random=t=>a.Buffer.from(a.crypto.getRandomValues(new Uint8Array(a.Buffer.alloc(t))))),!a.TextDecoder){const{TextEncoder:t,TextDecoder:s}=v((h+""==typeof O?".":"")+"./lib/text-encoding",1);a.TextDecoder=s,a.TextEncoder=t}if(!a.crypto)try{var d=v("crypto",1);Object.assign(a,{crypto:d,random:s=>a.Buffer.from(d.randomBytes(s))});const{Crypto:t}=v("@peculiar/webcrypto",1);a.ossl=a.subtle=new t({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}g.exports=a})(v,"./shim"),v(function(g){var i=v("./root"),a=v("./shim"),c={};c.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},c.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},c.ecdh={name:"ECDH",namedCurve:"P-256"},c.jwk=function(h,d){h=h.split(".");var t=h[0],s=h[1],u={kty:"EC",crv:"P-256",x:t,y:s,ext:!0};return u.key_ops=d?["sign"]:["verify"],d&&(u.d=d),u},c.keyToJwk=function(h){return{kty:"oct",k:h.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},c.recall={validity:12*60*60,hook:function(h){return h}},c.check=function(h){return typeof h=="string"&&h.slice(0,4)==="SEA{"},c.parse=async function(h){try{var d=typeof h=="string";return d&&h.slice(0,4)==="SEA{"&&(h=h.slice(3)),d?await a.parse(h):h}catch{}return h},i.opt=c,g.exports=c})(v,"./settings"),v(function(g){var i=v("./shim");g.exports=async function(a,c){var h=typeof a=="string"?a:await i.stringify(a),d=await i.subtle.digest({name:c||"SHA-256"},new i.TextEncoder().encode(h));return i.Buffer.from(d)}})(v,"./sha256"),v(function(g){const i=v("./shim"),a=i.subtle,c=i.ossl?i.ossl:a,h=d=>c.digest({name:"SHA-1"},new ArrayBuffer(d));g.exports=h})(v,"./sha1"),v(function(g){var i=v("./root"),a=v("./shim"),c=v("./settings"),h=v("./sha256"),d;i.work=i.work||(async(t,s,u,r)=>{try{var k=(s||{}).epub||s;if(r=r||{},k instanceof Function&&(u=k,k=d),t=typeof t=="string"?t:await a.stringify(t),(r.name||"").toLowerCase().slice(0,3)==="sha"){var o=a.Buffer.from(await h(t,r.name),"binary").toString(r.encode||"base64");if(u)try{u(o)}catch(e){console.log(e)}return o}k=k||a.random(9);var m=await(a.ossl||a.subtle).importKey("raw",new a.TextEncoder().encode(t),{name:r.name||"PBKDF2"},!1,["deriveBits"]),y=await(a.ossl||a.subtle).deriveBits({name:r.name||"PBKDF2",iterations:r.iterations||c.pbkdf2.iter,salt:new a.TextEncoder().encode(r.salt||k),hash:r.hash||c.pbkdf2.hash},m,r.length||c.pbkdf2.ks*8);t=a.random(t.length);var w=a.Buffer.from(y,"binary").toString(r.encode||"base64");if(u)try{u(w)}catch(e){console.log(e)}return w}catch(e){if(console.log(e),i.err=e,i.throw)throw e;u&&u();return}}),g.exports=i.work})(v,"./work"),v(function(g){var i=v("./root"),a=v("./shim");v("./settings"),i.name=i.name||(async(c,h)=>{try{if(c)try{c()}catch(d){console.log(d)}return}catch(d){if(console.log(d),i.err=d,i.throw)throw d;c&&c();return}}),i.pair=i.pair||(async(c,h)=>{try{var d=a.ossl||a.subtle,t=await a.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async r=>{var k={};k.priv=(await a.subtle.exportKey("jwk",r.privateKey)).d;var o=await a.subtle.exportKey("jwk",r.publicKey);return k.pub=o.x+"."+o.y,k});try{var s=await d.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async r=>{var k={};k.epriv=(await d.exportKey("jwk",r.privateKey)).d;var o=await d.exportKey("jwk",r.publicKey);return k.epub=o.x+"."+o.y,k})}catch(r){if(i.window)throw r;if(r=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw r}s=s||{};var u={pub:t.pub,priv:t.priv,epub:s.epub,epriv:s.epriv};if(c)try{c(u)}catch(r){console.log(r)}return u}catch(r){if(console.log(r),i.err=r,i.throw)throw r;c&&c();return}}),g.exports=i.pair})(v,"./pair"),v(function(g){var i=v("./root"),a=v("./shim"),c=v("./settings"),h=v("./sha256"),d;i.sign=i.sign||(async(t,s,u,r)=>{try{if(r=r||{},!(s||r).priv){if(!i.I)throw"No signing key.";s=await i.I(null,{what:t,how:"sign",why:r.why})}if(d===t)throw"`undefined` not allowed.";var k=await c.parse(t),o=r.check=r.check||k;if(i.verify&&(i.opt.check(o)||o&&o.s&&o.m)&&d!==await i.verify(o,s)){var f=await c.parse(o);if(r.raw||(f="SEA"+await a.stringify(f)),u)try{u(f)}catch(x){console.log(x)}return f}var m=s.pub,y=s.priv,w=c.jwk(m,y),e=await h(k),n=await(a.ossl||a.subtle).importKey("jwk",w,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(p=>(a.ossl||a.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},p,new Uint8Array(e))),f={m:k,s:a.Buffer.from(n,"binary").toString(r.encode||"base64")};if(r.raw||(f="SEA"+await a.stringify(f)),u)try{u(f)}catch(p){console.log(p)}return f}catch(p){if(console.log(p),i.err=p,i.throw)throw p;u&&u();return}}),g.exports=i.sign})(v,"./sign"),v(function(g){var i=v("./root"),a=v("./shim"),c=v("./settings"),h=v("./sha256"),d;i.verify=i.verify||(async(u,r,k,o)=>{try{var m=await c.parse(u);if(r===!1){var y=await c.parse(m.m);if(k)try{k(y)}catch($){console.log($)}return y}o=o||{};var w=r.pub||r,e=i.opt.slow_leak?await i.opt.slow_leak(w):await(a.ossl||a.subtle).importKey("jwk",c.jwk(w),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),n=await h(m.m),f,p,x,b;try{if(f=a.Buffer.from(m.s,o.encode||"base64"),p=new Uint8Array(f),x=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},e,p,new Uint8Array(n)),!x)throw"Signature did not match."}catch{if(i.opt.fallback)return await i.opt.fall_verify(u,r,k,o)}var T=x?await c.parse(m.m):d;if(k)try{k(T)}catch($){console.log($)}return T}catch($){if(console.log($),i.err=$,i.throw)throw $;k&&k();return}}),g.exports=i.verify;var t={};i.opt.slow_leak=u=>{if(t[u])return t[u];var r=c.jwk(u);return t[u]=(a.ossl||a.subtle).importKey("jwk",r,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),t[u]};var s=i.opt;i.opt.fall_verify=async function(u,r,k,o,m){if(m===i.opt.fallback)throw"Signature did not match";m=m||1;var y=u||"";u=i.opt.unpack(u)||u;var w=await c.parse(u),e=r.pub||r,n=await i.opt.slow_leak(e),f=m<=i.opt.fallback?a.Buffer.from(await a.subtle.digest({name:"SHA-256"},new a.TextEncoder().encode(await c.parse(w.m)))):await h(w.m),p,x,b;try{if(p=a.Buffer.from(w.s,o.encode||"base64"),x=new Uint8Array(p),b=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},n,x,new Uint8Array(f)),!b)throw"Signature did not match."}catch{try{p=a.Buffer.from(w.s,"utf8"),x=new Uint8Array(p),b=await(a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},n,x,new Uint8Array(f))}catch{if(!b)throw"Signature did not match."}}var T=b?await c.parse(w.m):d;if(s.fall_soul=y["#"],s.fall_key=y["."],s.fall_val=u,s.fall_state=y[">"],k)try{k(T)}catch($){console.log($)}return T},i.opt.fallback=2})(v,"./verify"),v(function(g){var i=v("./shim"),a=v("./settings"),c=v("./sha256");const h=async(d,t,s)=>{const u=d+(t||i.random(8)).toString("utf8"),r=i.Buffer.from(await c(u),"binary"),k=a.keyToJwk(r);return await i.subtle.importKey("jwk",k,{name:"AES-GCM"},!1,["encrypt","decrypt"])};g.exports=h})(v,"./aeskey"),v(function(g){var i=v("./root"),a=v("./shim");v("./settings");var c=v("./aeskey"),h;i.encrypt=i.encrypt||(async(d,t,s,u)=>{try{u=u||{};var r=(t||u).epriv||t;if(h===d)throw"`undefined` not allowed.";if(!r){if(!i.I)throw"No encryption key.";t=await i.I(null,{what:d,how:"encrypt",why:u.why}),r=t.epriv||t}var k=typeof d=="string"?d:await a.stringify(d),o={s:a.random(9),iv:a.random(15)},m=await c(r,o.s,u).then(w=>a.subtle.encrypt({name:u.name||"AES-GCM",iv:new Uint8Array(o.iv)},w,new a.TextEncoder().encode(k))),y={ct:a.Buffer.from(m,"binary").toString(u.encode||"base64"),iv:o.iv.toString(u.encode||"base64"),s:o.s.toString(u.encode||"base64")};if(u.raw||(y="SEA"+await a.stringify(y)),s)try{s(y)}catch(w){console.log(w)}return y}catch(w){if(console.log(w),i.err=w,i.throw)throw w;s&&s();return}}),g.exports=i.encrypt})(v,"./encrypt"),v(function(g){var i=v("./root"),a=v("./shim"),c=v("./settings"),h=v("./aeskey");i.decrypt=i.decrypt||(async(d,t,s,u)=>{try{u=u||{};var r=(t||u).epriv||t;if(!r){if(!i.I)throw"No decryption key.";t=await i.I(null,{what:d,how:"decrypt",why:u.why}),r=t.epriv||t}var k=await c.parse(d),o,m,y;try{o=a.Buffer.from(k.s,u.encode||"base64"),m=a.Buffer.from(k.iv,u.encode||"base64"),y=a.Buffer.from(k.ct,u.encode||"base64");var w=await h(r,o,u).then(n=>a.subtle.decrypt({name:u.name||"AES-GCM",iv:new Uint8Array(m),tagLength:128},n,new Uint8Array(y)))}catch{if(u.encode==="utf8")throw"Could not decrypt";if(i.opt.fallback)return u.encode="utf8",await i.decrypt(d,t,s,u)}var e=await c.parse(new a.TextDecoder("utf8").decode(w));if(s)try{s(e)}catch(n){console.log(n)}return e}catch(n){if(console.log(n),i.err=n,i.throw)throw n;s&&s();return}}),g.exports=i.decrypt})(v,"./decrypt"),v(function(g){var i=v("./root"),a=v("./shim");v("./settings"),i.secret=i.secret||(async(h,d,t,s)=>{try{if(s=s||{},!d||!d.epriv||!d.epub){if(!i.I)throw"No secret mix.";d=await i.I(null,{what:h,how:"secret",why:s.why})}var u=h.epub||h,r=d.epub,k=d.epriv,o=a.ossl||a.subtle,m=c(u),y=Object.assign({public:await o.importKey(...m,!0,[])},{name:"ECDH",namedCurve:"P-256"}),w=c(r,k),e=await o.importKey(...w,!1,["deriveBits"]).then(async f=>{var p=await o.deriveBits(y,f,256),x=new Uint8Array(p),b=await o.importKey("raw",x,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return o.exportKey("jwk",b).then(({k:T})=>T)}),n=e;if(t)try{t(n)}catch(f){console.log(f)}return n}catch(f){if(console.log(f),i.err=f,i.throw)throw f;t&&t();return}});var c=(h,d)=>{var[t,s]=h.split("."),u=d?{d}:{};return["jwk",Object.assign(u,{x:t,y:s,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};g.exports=i.secret})(v,"./secret"),v(function(g){var i=v("./root");i.certify=i.certify||(async(a,c={},h,d,t={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),a=(()=>{var e=[];if(a){if((typeof a=="string"||Array.isArray(a))&&a.indexOf("*")>-1)return"*";if(typeof a=="string")return a;if(Array.isArray(a)){if(a.length===1&&a[0])return typeof a[0]=="object"&&a[0].pub?a[0].pub:typeof a[0]=="string"?a[0]:null;a.map(n=>{typeof n=="string"?e.push(n):typeof n=="object"&&n.pub&&e.push(n.pub)})}return typeof a=="object"&&a.pub?a.pub:e.length>0?e:null}})(),!a)return console.log("No certificant found.");const u=t.expiry&&(typeof t.expiry=="number"||typeof t.expiry=="string")?parseFloat(t.expiry):null,r=(c||{}).read?c.read:null,k=(c||{}).write?c.write:typeof c=="string"||Array.isArray(c)||c["+"]||c["#"]||c["."]||c["="]||c["*"]||c[">"]||c["<"]?c:null,o=(t||{}).block||(t||{}).blacklist||(t||{}).ban||{},m=o.read&&(typeof o.read=="string"||(o.read||{})["#"])?o.read:null,y=typeof o=="string"?o:o.write&&(typeof o.write=="string"||o.write["#"])?o.write:null;if(!r&&!k)return console.log("No policy found.");const w=JSON.stringify({c:a,...u?{e:u}:{},...r?{r}:{},...k?{w:k}:{},...m?{rb:m}:{},...y?{wb:y}:{}});var s=await i.sign(w,h,null,{raw:1});if(t.raw||(s="SEA"+JSON.stringify(s)),d)try{d(s)}catch(e){console.log(e)}return s}catch(u){if(i.err=u,i.throw)throw u;d&&d();return}}),g.exports=i.certify})(v,"./certify"),v(function(g){var i=v("./shim"),a=v("./root");a.work=v("./work"),a.sign=v("./sign"),a.verify=v("./verify"),a.encrypt=v("./encrypt"),a.decrypt=v("./decrypt"),a.certify=v("./certify"),a.random=a.random||i.random,a.Buffer=a.Buffer||v("./buffer"),a.keyid=a.keyid||(async c=>{try{const h=i.Buffer.concat(c.replace(/-/g,"+").replace(/_/g,"/").split(".").map(u=>i.Buffer.from(u,"base64"))),d=i.Buffer.concat([i.Buffer.from([153,h.length/256,h.length%256]),h]),t=await sha1hash(d),s=i.Buffer.from(t,"binary");return s.toString("hex",s.length-8)}catch(h){throw console.log(h),h}}),((a.window||{}).GUN||{}).SEA=a,g.exports=a})(v,"./sea"),v(function(g){var i=v("./sea"),a,c;i.window?a=i.window.GUN||{chain:{}}:a=v((c+""==typeof O?".":"")+"./gun",1),i.GUN=a;function h(t){this._={$:this}}h.prototype=function(){function t(){}return t.prototype=a.chain,new t}(),h.prototype.constructor=h,a.chain.user=function(t){var s=this,r=s.back(-1),u;if(t)return t=i.opt.pub((t._||"")["#"])||t,r.get("~"+t);if(u=r.back("user"))return u;var r=r._,k=r,o=k.opt.uuid||d;return(k=(u=k.user=s.chain(new h))._).opt={},k.opt.uuid=function(m){var y=o(),w=r.user;return!w||!(w=w.is)||!(w=w.pub)||(y="~"+w+"/"+y,m&&m.call&&m(null,y)),y},u};function d(){return a.state().toString(36).replace(".","")}a.User=h,h.GUN=a,h.SEA=a.SEA=i,g.exports=h})(v,"./user"),v(function(g){var i,a=""+i!=typeof GUN?GUN||{chain:{}}:v((""+i==typeof O?".":"")+"./gun",1);a.chain.then=function(c,h){var d=this,t=new Promise(function(s,u){d.once(s,h)});return c?t.then(c):t}})(v,"./then"),v(function(g){var i=v("./user"),a=i.SEA,c=i.GUN,h=function(){};i.prototype.create=function(...d){var t=typeof d[0]=="object"&&(d[0].pub||d[0].epub)?d[0]:typeof d[1]=="object"&&(d[1].pub||d[1].epub)?d[1]:null,s=t&&(t.pub||t.epub)?t.pub:typeof d[0]=="string"?d[0]:null,u=t&&(t.pub||t.epub)?t:s&&typeof d[1]=="string"?d[1]:null,r=d.filter(n=>typeof n=="function")[0]||null,k=d&&d.length>1&&typeof d[d.length-1]=="object"?d[d.length-1]:{},o=this,m=o._,y=o.back(-1);if(r=r||h,k=k||{},k.check!==!1){var w;if(s||(w="No user."),(u||"").length<8&&(w="Password too short!"),w)return r({err:c.log(w)}),o}if(m.ing)return(r||h)({err:c.log("User is already being created or authenticated!"),wait:!0}),o;m.ing=!0;var e={};return e.a=function(n){if(e.pubs=n,n&&!k.already){var f={err:c.log("User already created!")};m.ing=!1,(r||h)(f),o.leave();return}e.salt=String.random(64),a.work(u,e.salt,e.b)},e.b=function(n){e.proof=n,t?e.c(t):a.pair(e.c)},e.c=function(n){var f;e.pair=n||{},(f=m.root.user)&&(f._.sea=n,f.is={pub:n.pub,epub:n.epub,alias:s}),e.data={pub:n.pub},e.d()},e.d=function(){e.data.alias=s,e.e()},e.e=function(){e.data.epub=e.pair.epub,a.encrypt({priv:e.pair.priv,epriv:e.pair.epriv},e.proof,e.f,{raw:1})},e.f=function(n){e.data.auth=JSON.stringify({ek:n,s:e.salt}),e.g(e.data.auth)},e.g=function(n){var f;e.data.auth=e.data.auth||n,y.get(f="~"+e.pair.pub).put(e.data).on(e.h);var p={};p[f]={"#":f},y.get("~@"+s).put(p).get(f).on(e.i)},e.h=function(n,f,p,x){x.off(),e.h.ok=1,e.i()},e.i=function(n,f,p,x){x&&(e.i.ok=1,x.off()),!(!e.h.ok||!e.i.ok)&&(m.ing=!1,r({ok:0,pub:e.pair.pub}),h===r&&(t?o.auth(t):o.auth(s,u)))},y.get("~@"+s).once(e.a),o},i.prototype.leave=function(d,t){var s=this,u=s.back(-1)._.user;if(u&&(delete u.is,delete u._.is,delete u._.sea),a.window)try{var r={};r=a.window.sessionStorage,delete r.recall,delete r.pair}catch{}return s}})(v,"./create"),v(function(g){var i=v("./user"),a=i.SEA,c=i.GUN,h=function(){};i.prototype.auth=function(...t){var s=typeof t[0]=="object"&&(t[0].pub||t[0].epub)?t[0]:typeof t[1]=="object"&&(t[1].pub||t[1].epub)?t[1]:null,u=!s&&typeof t[0]=="string"?t[0]:null,r=(u||s&&!(s.priv&&s.epriv))&&typeof t[1]=="string"?t[1]:null,k=t.filter(p=>typeof p=="function")[0]||null,o=t&&t.length>1&&typeof t[t.length-1]=="object"?t[t.length-1]:{},m=this,y=m._,w=m.back(-1);if(y.ing)return(k||h)({err:c.log("User is already being created or authenticated!"),wait:!0}),m;y.ing=!0;var e={},n,f=9;return e.a=function(p){if(!p)return e.b();if(!p.pub){var x=[];return Object.keys(p).forEach(function(b){b!="_"&&x.push(p[b])}),e.b(x)}if(e.name)return e.f(p);e.c((e.data=p).auth)},e.b=function(p){var x=(e.list=(e.list||[]).concat(p||[])).shift();if(n===x){if(e.name)return e.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(u&&f--){w.get("~@"+u).once(e.a);return}return e.err("Wrong user or password.")}w.get(x).once(e.a)},e.c=function(p){if(n===p)return e.b();if(typeof p=="string")return e.c(d(p));a.work(r,(e.auth=p).s,e.d,e.enc)},e.d=function(p){a.decrypt(e.auth.ek,p,e.e,e.enc)},e.e=function(p){if(n===p)return e.enc?(e.enc=null,e.b()):(e.enc={encode:"utf8"},e.c(e.auth));e.half=p,e.f(e.data)},e.f=function(p){var x=e.half||{},b=e.data||{};e.g(e.lol={pub:p.pub||b.pub,epub:p.epub||b.epub,priv:p.priv||x.priv,epriv:p.epriv||x.epriv})},e.g=function(p){if(!p||!p.pub||!p.epub)return e.b();e.pair=p;var x=w._.user,b=x._;b.tag;var T=b.opt;b=x._=w.get("~"+p.pub)._,b.opt=T,x.is={pub:p.pub,epub:p.epub,alias:u||p.pub},b.sea=e.pair,y.ing=!1;try{r&&n==(d(y.root.graph["~"+p.pub].auth)||"")[":"]&&(o.shuffle=o.change=r)}catch{}if(o.change?e.z():(k||h)(b),a.window&&(m.back("user")._.opt||o).remember)try{var $={};$=a.window.sessionStorage,$.recall=!0,$.pair=JSON.stringify(p)}catch{}try{w._.tag.auth?w._.on("auth",b):setTimeout(function(){w._.on("auth",b)},1)}catch(C){c.log("Your 'auth' callback crashed with:",C)}},e.h=function(p){if(!p)return e.b();if(u=p.alias,u||(u=p.alias="~"+s.pub),!p.auth)return e.g(s);s=null,e.c((e.data=p).auth)},e.z=function(){e.salt=String.random(64),a.work(o.change,e.salt,e.y)},e.y=function(p){a.encrypt({priv:e.pair.priv,epriv:e.pair.epriv},p,e.x,{raw:1})},e.x=function(p){e.w(JSON.stringify({ek:p,s:e.salt}))},e.w=function(p){if(o.shuffle){console.log("migrate core account from UTF8 & shuffle");var x={};Object.keys(e.data).forEach(function(b){x[b]=e.data[b]}),delete x._,x.auth=p,w.get("~"+e.pair.pub).put(x)}w.get("~"+e.pair.pub).get("auth").put(p,k||h)},e.err=function(p){var x={err:c.log(p||"User cannot be found!")};y.ing=!1,(k||h)(x)},e.plugin=function(p){if(!(e.name=p))return e.err();var x=[p];p[0]!=="~"&&(x[1]="~"+p,x[2]="~@"+p),e.b(x)},s?s.priv&&s.epriv?e.g(s):w.get("~"+s.pub).once(e.h):u?w.get("~@"+u).once(e.a):!u&&!r&&a.name(e.plugin),m};function d(t){if(typeof t!="string")return t;try{t=JSON.parse(t)}catch{t={}}return t}})(v,"./auth"),v(function(g){var i=v("./user"),a=i.SEA;i.GUN,i.prototype.recall=function(c,h){var d=this,t=d.back(-1);if(c=c||{},c&&c.sessionStorage){if(a.window)try{var s={};s=a.window.sessionStorage,s&&(t._.opt.remember=!0,(d.back("user")._.opt||c).remember=!0,(s.recall||s.pair)&&t.user().auth(JSON.parse(s.pair),h))}catch{}return d}return d}})(v,"./recall"),v(function(g){var i=v("./user"),a=i.SEA,c=i.GUN,h=function(){};i.prototype.pair=function(){var d=this,t;try{t=new Proxy({DANGER:"☠"},{get:function(s,u,r){if(!(!d.is||!(d._||"").sea))return d._.sea[u]}})}catch{}return t},i.prototype.delete=async function(d,t,s){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var u=this;u.back(-1);var r=u.back("user");try{r.auth(d,t,function(k){var o=(r.is||{}).pub;r.map().once(function(){this.put(null)}),r.leave(),(s||h)({ok:0})})}catch(k){c.log("User.delete failed! Error:",k)}return u},i.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const d=this.back(-1);try{return await authRecall(d),d._.user._}catch{const t="No session!";throw c.log(t),{err:t}}},i.prototype.trust=async function(d){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),c.is(d)&&d.get("pub").get((t,s)=>{console.log(t,s)}),d.get("trust").get(path).put(theirPubkey)},i.prototype.grant=function(d,t){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var s=this,u=s.back(-1).user(),r=u._.sea,k="";return s.back(function(o){o.is||(k+=o.get||"")}),async function(){var o,m=await u.get("grant").get(r.pub).get(k).then();m=await a.decrypt(m,r),m||(m=a.random(16).toString(),o=await a.encrypt(m,r),u.get("grant").get(r.pub).get(k).put(o));var y=d.get("pub").then(),w=d.get("epub").then();y=await y,w=await w;var e=await a.secret(w,r);o=await a.encrypt(m,e),u.get("grant").get(y).get(k).put(o,t)}(),s},i.prototype.secret=function(d,t){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var s=this,u=s.back(-1).user(),r=u.pair(),k="";return s.back(function(o){o.is||(k+=o.get||"")}),async function(){var o,m=await u.get("trust").get(r.pub).get(k).then();m=await a.decrypt(m,r),m||(m=a.random(16).toString(),o=await a.encrypt(m,r),u.get("trust").get(r.pub).get(k).put(o)),o=await a.encrypt(d,m),s.put(o,t)}(),s},g.exports=i})(v,"./share"),v(function(g){var i=v("./sea"),a=v("./settings"),c,h=(i.window||"").GUN||v((""+c==typeof O?".":"")+"./gun",1);h.on("opt",function(o){o.sea||(o.sea={own:{}},o.on("put",d,o)),this.to.next(o)});function d(o){var m=this,y=m.as,w=o.put,e=w["#"],n=w["."],f=w[":"],p=w[">"],x=o["#"],b;if(!(!e||!n)){if((o._||"").faith&&(y.opt||"").faith&&typeof o._=="function"){i.opt.pack(w,function($){i.verify($,!1,function(C){w["="]=i.opt.unpack(C),m.to.next(o)})});return}var T=function($){y.on("in",{"@":x,err:o.err=$})};if((o._||"").DBG&&((o._||"").DBG.c=+new Date),0<=e.indexOf("<?")&&(b=parseFloat(e.split("<?")[1]||""),b&&p<h.state()-b*1e3)){(b=o._)&&b.stun&&b.stun--;return}if(e==="~@"){d.alias(m,o,f,n,e,y,T);return}if(e.slice(0,2)==="~@"){d.pubs(m,o,f,n,e,y,T);return}if(b=i.opt.pub(e)){d.pub(m,o,f,n,e,y,T,y.user||"",b);return}if(0<=e.indexOf("#")){d.hash(m,o,f,n,e,y,T);return}d.any(m,o,f,n,e,y,T,y.user||"")}}d.hash=function(o,m,y,w,e,n,f){i.work(y,null,function(p){function x(b){let T="";for(let $=0;$<b.length;$++)T+=$-1&1?"":String.fromCharCode(parseInt(b.substring($-1,$+1),16));return btoa(T)}if(p&&p===w.split("#").slice(-1)[0]||p&&p===x(w.split("#").slice(-1)[0]))return o.to.next(m);f("Data hash not same as hash!")},{name:"SHA-256"})},d.alias=function(o,m,y,w,e,n,f){if(!y)return f("Data must exist!");if("~@"+w===s(y))return o.to.next(m);f("Alias not same!")},d.pubs=function(o,m,y,w,e,n,f){if(!y)return f("Alias must exist!");if(w===s(y))return o.to.next(m);f("Alias not same!")},d.pub=async function(o,m,y,w,e,n,f,p,x){var b;const T=await a.parse(y)||{},$=(C,A,_)=>{if(C.m&&C.s&&A&&x)return i.verify(C,x,l=>{if(c!==l&&c!==l.e&&m.put[">"]&&m.put[">"]>parseFloat(l.e))return f("Certificate expired.");if(c!==l&&l.c&&l.w&&(l.c===A||l.c.indexOf("*")>-1)){let j=e.indexOf("/")>-1?e.replace(e.substring(0,e.indexOf("/")+1),""):"";String.match=String.match||h.text.match;const D=Array.isArray(l.w)?l.w:typeof l.w=="object"||typeof l.w=="string"?[l.w]:[];for(const B of D)if(String.match(j,B["#"])&&String.match(w,B["."])||!B["."]&&String.match(j,B["#"])||!B["#"]&&String.match(w,B["."])||String.match(j?j+"/"+w:w,B["#"]||B)){if(B["+"]&&B["+"].indexOf("*")>-1&&j&&j.indexOf(A)==-1&&w.indexOf(A)==-1)return f(`Path "${j}" or key "${w}" must contain string "${A}".`);if(l.wb&&(typeof l.wb=="string"||(l.wb||{})["#"])){var S=o.as.root.$.back(-1);return typeof l.wb=="string"&&l.wb.slice(0,1)!=="~"&&(S=S.get("~"+x)),S.get(l.wb).get(A).once(E=>E&&(E===1||E===!0)?f(`Certificant ${A} blocked.`):_(l))}return _(l)}return f("Certificate verification fail.")}})};if(w==="pub"&&"~"+x===e)return y===x?o.to.next(m):f("Account not same!");if((b=p.is)&&b.pub&&!T["*"]&&!T["+"]&&(x===b.pub||x!==b.pub&&((m._.msg||{}).opt||{}).cert)){i.opt.pack(m.put,C=>{i.sign(C,p._.sea,async function(A){if(c===A)return f(i.err||"Signature fail.");if(m.put[":"]={":":b=i.opt.unpack(A.m),"~":A.s},m.put["="]=b,x===p.is.pub){(b=s(y))&&((n.sea.own[b]=n.sea.own[b]||{})[x]=1),JSON.stringifyAsync(m.put[":"],function(_,l){return _?f(_||"Stringify error."):(m.put[":"]=l,o.to.next(m))});return}if(x!==p.is.pub&&((m._.msg||{}).opt||{}).cert){const _=await a.parse(m._.msg.opt.cert);_&&_.m&&_.s&&$(_,p.is.pub,l=>{m.put[":"]["+"]=_,m.put[":"]["*"]=p.is.pub,JSON.stringifyAsync(m.put[":"],function(S,j){return S?f(S||"Stringify error."):(m.put[":"]=j,o.to.next(m))})})}},{raw:1})});return}i.opt.pack(m.put,C=>{i.verify(C,T["*"]||x,function(A){var _;if(A=i.opt.unpack(A),c===A)return f("Unverified data.");if((_=s(A))&&x===i.opt.pub(_)&&((n.sea.own[_]=n.sea.own[_]||{})[x]=1),T["+"]&&T["+"].m&&T["+"].s&&T["*"])$(T["+"],T["*"],l=>(m.put["="]=A,o.to.next(m)));else return m.put["="]=A,o.to.next(m)})})},d.any=function(o,m,y,w,e,n,f,p){if(n.opt.secure)return f("Soul missing public key at '"+w+"'.");n.on("secure",function(x){if(this.off(),!n.opt.secure)return o.to.next(x);f("Data cannot be changed.")}).on.on("secure",m)};var t=h.valid,s=function(o,m){return typeof(m=t(o))=="string"&&m};(h.state||"").ify;var u=/[^\w_-]/;i.opt.pub=function(o){if(o&&(o=o.split("~"),!(!o||!(o=o[1]))&&(o=o.split(u).slice(0,2),!(!o||o.length!=2)&&(o[0]||"")[0]!=="@")))return o=o.slice(0,2).join("."),o},i.opt.stringy=function(o){},i.opt.pack=function(o,m,y,w,e){var n,f;if(i.opt.check(o))return m(o);o&&o["#"]&&o["."]&&o[">"]&&(n=o[":"],f=1),JSON.parseAsync(f?n:o,function(p,x){var b=c!==(x||"")[":"]&&(x||"")["~"];if(!b){m(o);return}m({m:{"#":e||o["#"],".":y||o["."],":":(x||"")[":"],">":o[">"]||h.state.is(w,y)},s:b})})};var r=i.opt;i.opt.unpack=function(o,m,y){var w;if(c!==o){if(o&&c!==(w=o[":"]))return w;if(m=m||r.fall_key,!y&&r.fall_val&&(y={},y[m]=r.fall_val),!(!m||!y)){if(o===y[m]||!i.opt.check(y[m]))return o;var e=y&&y._&&y._["#"]||r.fall_soul,n=h.state.is(y,m)||r.fall_state;if(o&&o.length===4&&e===o[0]&&m===o[1]&&k(n)===k(o[3]))return o[2];if(n<i.opt.shuffle_attack)return o}}},i.opt.shuffle_attack=15463296e5;var k=Math.floor})(v,"./index")})()})(_t);var Qt=_t.exports;const Xt=jt(Qt);var Zt=()=>{if(!CanvasRenderingContext2D||!O())return;const N=CanvasRenderingContext2D.prototype,v=N.drawImage;if(!v){console.error("This script requires a basic implementation of drawImage");return}N.drawImage=function(h,d,t){if(!(arguments.length===9))return v.apply(this,[...arguments]);const u=g(...arguments);if(!i(u))return v.apply(this,u)};function O(){const c=document.createElement("canvas").getContext("2d");c.fillRect(0,0,40,40),c.drawImage(c.canvas,-40,-40,80,80,50,50,20,20);const h=c.getImageData(50,50,30,30),d=new Uint32Array(h.data.buffer),t=(r,k)=>d[k*h.width+r],s=[[9,9],[20,9],[9,20],[20,20]],u=[[10,10],[19,10],[10,19],[19,19]];return s.some(([r,k])=>t(r,k)!==0)||u.some(([r,k])=>t(r,k)===0)}function g(c,h,d,t,s,u,r,k,o){const{width:m,height:y}=a(c);t<0&&(h+=t,t=Math.abs(t)),s<0&&(d+=s,s=Math.abs(s)),k<0&&(u+=k,k=Math.abs(k)),o<0&&(r+=o,o=Math.abs(o));const w=Math.max(h,0),e=Math.min(h+t,m),n=Math.max(d,0),f=Math.min(d+s,y),p=k/t,x=o/s;return[c,w,n,e-w,f-n,h<0?u-h*p:u,d<0?r-d*x:r,(e-w)*p,(f-n)*x]}function i(c){return[3,4,7,8].some(h=>!c[h])}function a(c){const h=d=>{const t=globalThis[d];return t&&c instanceof t};if(h("HTMLImageElement"))return{width:c.naturalWidth,height:c.naturalHeight};if(h("HTMLVideoElement"))return{width:c.videoWidth,height:c.videoHeight};if(h("SVGImageElement"))throw new TypeError("SVGImageElement isn't yet supported as source image.","UnsupportedError");if(h("HTMLCanvasElement")||h("ImageBitmap"))return c}},F={};function it({pub:N,size:v=200,dark:O=!1,draw:g="circles",reflect:i=!0}){if(!zt(N)||!document)return"";const a=JSON.stringify(arguments[0]);if(F!=null&&F[a])return F[a];const c=document.createElement("canvas");c.width=c.height=v;const h=c.getContext("2d"),{decoded:d,finals:t}=te(N);return re({ctx:h,top:t[0],bottom:t[1],size:v,dark:O}),g=="squares"?(h.filter="blur(20px)",St(d[0],h,v),h.filter="blur(0px)",h.globalCompositeOperation="color-burn",St(d[1],h,v)):(Ot(d[0],h,v,.42*v),h.globalCompositeOperation="multiply",Ot(d[1],h,v,.125*v)),i&&(h.globalCompositeOperation="source-over",h.scale(-1,1),h.translate(-v/2,0),h.drawImage(c,v/2,0,v,v,0,0,v,v)),F[a]=c.toDataURL(),F[a]}function zt(N){return!!(N&&typeof N=="string"&&N.length==87&&N.split(".").length==2)}function te(N){const v=N.split("."),O=v.map(h=>ne(h)),g=O.map(h=>h[42]),i=O.map(h=>h.reduce((d,t)=>d+t)/h.length),a=v.map(h=>ee(h)%360),c=v.map((h,d)=>`hsl(${a[d]} ${g[d]*100}% ${i[d]*100}%)`);return{finals:g,decoded:O,angles:a,averages:i,colors:c}}var At="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function ee(N){return N.split("").reduce((v,O)=>v*64+At.indexOf(O),0)}function ne(N){const v=At.split("");let O=[],g=0;for(let i of N)O[g++]=v.indexOf(i)/64;return O}function Ct(N,v=3){return[...Array(Math.ceil(N.length/v))].map(()=>N.splice(0,v))}function re({ctx:N,top:v=0,bottom:O=150,size:g=200,dark:i=!1}){var a=N.createLinearGradient(0,0,0,g);let c=70;i&&(c=0),a.addColorStop(0,`hsla(0,0%,${c+v*30}%)`),a.addColorStop(1,`hsla(0,0%,${c+O*30}%)`),N.fillStyle=a,N.fillRect(0,0,g,g)}function St(N,v,O){Ct(N,14).forEach(i=>{if(i.length==14){let a=i[0]*O,c=i[1]*O,h=O/8+i[2]*O*(7/8),d=i[13]*Math.PI,t=i[3]*360,s=i[4]*100,u=i[5]*100,r=i[6],k=i[7],o=i[8]*360,m=i[9]*100,y=i[10]*100,w=i[11],e=i[12];const n=v.createLinearGradient(a+h*k,0,a+h*e,O);n.addColorStop(0,`hsla(${t},${s}%,${u}%,${r})`),n.addColorStop(1,`hsla(${o},${m}%,${y}%,${w})`),v.fillStyle=n,v.translate(a,c),v.rotate(d),v.fillRect(-h/2,-h/2,h,h),v.setTransform(1,0,0,1,0,0)}})}function Ot(N,v,O,g){Ct(N,7).forEach(a=>{if(a.length==7){let c=O/2+a[0]*O/2,h=a[1]*O,d=a[2]*g,t=a[3]*360,s=a[4]*100,u=a[5]*100,r=a[6];v.beginPath(),v.arc(c,h,d,0,2*Math.PI,!1),v.fillStyle=`hsla(${t},${s}%,${u}%,${r})`,v.closePath(),v.fill()}})}Zt();const oe={class:"flex flex-col p-2 gap-2"},ie={class:"text-2xl"},ae={key:0,class:"flex p-2 items-center flex-wrap"},ue=["src"],se={key:1,class:"flex p-2 items-center flex-wrap"},ce=["src"],fe={class:"flex flex-wrap items-center gap-2"},le=["src"],pe={class:"text-xs"},nt="test-app-1000",ge={__name:"GunP2p",setup(N){const v=Wt({peers:["https://peer.wallie.io/gun"]}),O=rt(""),g=rt("");ot(g,r=>{v.user().get("name").put(r)}),ot(()=>pt.note,r=>{v.user().get("midi").put(r.number)}),v.on("auth",()=>{var r;O.value=(r=v.user().is)==null?void 0:r.pub,v.user().get("name").on(k=>{g.value=k}),setInterval(()=>v.get(nt).get("users").get(O.value).put(Date.now()),1e3)});const i=rt(null),a=ft(()=>{var r;return it({pub:(r=i.value)==null?void 0:r.pub})}),c=ft(()=>it({pub:O.value}));Bt(()=>{v.user().recall({sessionStorage:!0}),h()});async function h(){i.value=await Xt.pair()}async function d(){v.user().auth(i.value)}async function t(){v.user().leave(),setTimeout(()=>{var r;(r=v.user())!=null&&r.is||(O.value=null)},500)}const s=Nt({});v.get(nt).get("users").map().on((r,k)=>{Date.now()-r<5e3&&(s[k]={timestamp:r})}),ot(s,()=>{for(let r in s)v.user(r).get("name").once(k=>s[r].name=k),v.user(r).get("midi").once(k=>s[r].midi=k)}),v.get(nt).get("play").on(r=>{Mt(pt.note.number)});function u(){v.get(nt).get("play").put(Date.now())}return(r,k)=>(Y(),Q("div",oe,[L("div",ie,[k[5]||(k[5]=Et("GUN P2P")),L("button",{class:"text-button",onClick:k[0]||(k[0]=o=>u())},"Play")]),O.value?(Y(),Q("div",ae,[L("img",{style:{width:"60px"},src:c.value},null,8,ue),Gt(L("input",{"onUpdate:modelValue":k[1]||(k[1]=o=>g.value=o)},null,512),[[Jt,g.value]]),L("button",{class:"text-button",onClick:k[2]||(k[2]=o=>t())},"Leave")])):(Y(),Q("div",se,[L("button",{class:"text-button",onClick:k[3]||(k[3]=o=>h())},"Generate"),L("img",{style:{width:"60px"},src:a.value},null,8,ce),L("button",{class:"text-button",onClick:k[4]||(k[4]=o=>d())},"Enter")])),L("div",fe,[(Y(!0),Q(Ut,null,Pt(tt(s),(o,m)=>(Y(),Q("div",{class:"p-2 flex flex-col shadow gap-2 relative",key:o.name},[L("img",{style:{width:"60px",margin:"0"},src:tt(it)({pub:m})},null,8,le),L("div",pe,lt(o.name),1),L("div",{class:"absolute bottom-0 right-0 px-1 p-0 rounded-xl text-xs",style:Rt({backgroundColor:tt(It)(o.midi,1,.5)})},lt(tt(Ht)[(o.midi-9)%12]),5)]))),128))])]))}};export{ge as default};
