import{r as ot,D as Wt,I as ht,o as Kt,a2 as Xt,q as Y,f as Z,s as L,Z as Vt,u as H,a5 as Yt,z as at,v as gt,l as Zt,j as Qt,F as te,Y as ee,a6 as ne}from"./framework.Bbwy4zmA.js";import{e as yt,al as Q,n as mt,aC as vt}from"./theme.DKUtGHOP.js";var wt={},re={},tt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof wt<"u"?wt:typeof self<"u"?self:{};function Jt(E){return E&&E.__esModule&&Object.prototype.hasOwnProperty.call(E,"default")?E.default:E}function ct(E){throw new Error('Could not dynamically require "'+E+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var bt={exports:{}},kt;function X(){return kt||(kt=1,function(E){(function(){function y(p,r){return r?ct(p):p.slice?y[c(p)]:function(f,l){p(f={exports:{}}),y[c(l)]=f.exports};function c(f){return f.split("/").slice(-1).toString().replace(".js","")}}var _=E;y(function(p){String.random=function(c,f){var l="";for(c=c||24,f=f||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";c-- >0;)l+=f.charAt(Math.floor(Math.random()*f.length));return l},String.match=function(c,f){var l,h;return typeof c!="string"?!1:(typeof f=="string"&&(f={"=":f}),f=f||{},l=f["="]||f["*"]||f[">"]||f["<"],c===l?!0:h!==f["="]?!1:(l=f["*"]||f[">"],c.slice(0,(l||"").length)===l?!0:h!==f["*"]?!1:h!==f[">"]&&h!==f["<"]?c>=f[">"]&&c<=f["<"]:h!==f[">"]&&c>=f[">"]||h!==f["<"]&&c<=f["<"]))},String.hash=function(c,f){if(typeof c=="string"){if(f=f||0,!c.length)return f;for(var l=0,h=c.length,t;l<h;++l)t=c.charCodeAt(l),f=(f<<5)-f+t,f|=0;return f}};var r=Object.prototype.hasOwnProperty;Object.plain=function(c){return c?c instanceof Object&&c.constructor===Object||Object.prototype.toString.call(c).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(c,f){for(var l in c)if(r.call(c,l)&&(!f||f.indexOf(l)==-1))return!1;return!0},Object.keys=Object.keys||function(c){var f=[];for(var l in c)r.call(c,l)&&f.push(l);return f},function(){var c,f=setTimeout,l=0,h=0,t=typeof setImmediate!=""+c&&setImmediate||function(a,n){return typeof MessageChannel==""+c?f:((a=new MessageChannel).port1.onmessage=function(b){b.data==""&&n()},function(b){n=b,a.port2.postMessage("")})}(),e=f.check=f.check||typeof performance!=""+c&&performance||{now:function(){return+new Date}};f.hold=f.hold||9,f.poll=f.poll||function(a){if(f.hold>=e.now()-l&&h++<3333){a();return}t(function(){l=e.now(),a()},h=0)}}(),function(){var c=setTimeout,f=c.turn=c.turn||function(n){l.push(n)==1&&h(a)},l=f.s=[],h=c.poll,t=0,e,a=function(){(e=l[t++])&&e(),(t==l.length||t==99)&&(l=f.s=l.slice(t),t=0),l.length&&h(a)}}(),function(){var c,f=setTimeout,l=f.turn;(f.each=f.each||function(h,t,e,a){a=a||9,function n(b,s,w){if(s=(b=(h||[]).splice(0,a)).length){for(var v=0;v<s&&c===(w=t(b[v]));v++);if(c===w){l(n);return}}e&&e(w)}()})()}()})(y,"./shim"),y(function(p){p.exports=function r(e,f,l){if(!e)return{to:r};var h,t=typeof f=="function",e=(this.tag||(this.tag={}))[e]||t&&(this.tag[e]={tag:e,to:r._={next:function(n){var b;(b=this.to)&&b.next(n)}}});if(t){var a={off:r.off||(r.off=function(){if(this.next===r._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=r._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:r._,next:f,the:e,on:this,as:l};return(a.back=e.last||e).to=a,e.last=a}return(e=e.to)&&h!==f&&e.next(f),e}})(y,"./onto"),y(function(p){p.exports=function(r){return r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"&&r!=1/0&&r!=-1/0&&r===r||!!r&&typeof r["#"]=="string"&&Object.keys(r).length===1&&r["#"]}})(y,"./valid"),y(function(p){y("./shim");function r(){var e=+new Date;return h<e?(f=0,h=e+r.drift):h=e+(f+=1)/l+r.drift}r.drift=0;var c=-1/0,f=0,l=999,h=c,t;r.is=function(e,a,n){var b=a&&e&&e._&&e._[">"]||n;if(b)return typeof(b=b[a])=="number"?b:c},r.ify=function(e,a,n,b,s){(e=e||{})._=e._||{},s&&(e._["#"]=s);var w=e._[">"]||(e._[">"]={});return t!==a&&a!=="_"&&(typeof n=="number"&&(w[a]=n),t!==b&&(e[a]=b)),e},p.exports=r})(y,"./state"),y(function(p){y("./shim");function r(c){var f={s:{}},l=f.s;c=c||{max:999,age:1e3*9},f.check=function(t){return l[t]?h(t):!1};var h=f.track=function(t){var e=l[t]||(l[t]={});return e.was=f.now=+new Date,f.to||(f.to=setTimeout(f.drop,c.age+9)),h.ed&&h.ed(t),e};return f.drop=function(t){f.to=null,f.now=+new Date;var e=Object.keys(l);console.STAT&&console.STAT(f.now,+new Date-f.now,"dup drop keys"),setTimeout.each(e,function(a){var n=l[a];n&&(t||c.age)>f.now-n.was||delete l[a]},0,99)},f}p.exports=r})(y,"./dup"),y(function(p){y("./onto"),p.exports=function(c,f){if(this.on){var l=(this.opt||{}).lack||9e3;if(typeof c!="function"){if(!c)return;var t=c["#"]||c,h=(this.tag||"")[t];return h?(f&&(h=this.on(t,f),clearTimeout(h.err),h.err=setTimeout(function(){h.off()},l)),!0):void 0}var t=f&&f["#"]||r(9);if(!c)return t;var e=this.on(t,c,f);return e.err=e.err||setTimeout(function(){e.off(),e.next({err:"Error: No ACK yet.",lack:!0})},l),t}};var r=String.random||function(){return Math.random().toString(36).slice(2)}})(y,"./ask"),y(function(p){function r(s){return s instanceof r?(this._={$:this}).$:this instanceof r?r.create(this._={$:this,opt:s}):new r(s)}r.is=function(s){return s instanceof r||s&&s._&&s===s._.$||!1},r.version=.202,r.chain=r.prototype,r.chain.toJSON=function(){},y("./shim"),r.valid=y("./valid"),r.state=y("./state"),r.on=y("./onto"),r.dup=y("./dup"),r.ask=y("./ask"),function(){r.create=function(d){d.root=d.root||d,d.graph=d.graph||{},d.on=d.on||r.on,d.ask=d.ask||r.ask,d.dup=d.dup||r.dup();var T=d.$.opt(d.opt);return d.once||(d.on("in",s,d),d.on("out",s,d),d.on("put",m,d),r.on("create",d),d.on("create",d)),d.once=1,T};function s(d){if(d){if(d.out===s){this.to.next(d);return}var T=this,D=T.as,A=D.at||D,B=A.$,M=A.dup,I,N=d.DBG;if((I=d["#"])||(I=d["#"]=f(9)),!M.check(I)){if(M.track(I),I=d._,d._=typeof I=="function"?I:function(){},d.$&&d.$===(d.$._||"").$||(d.$=B),d["@"]&&!d.put&&o(d),!A.ask(d["@"],d))if(N&&(N.u=+new Date),d.put){w(d);return}else d.get&&r.on.get(d,B);N&&(N.uc=+new Date),T.to.next(d),N&&(N.ua=+new Date),!(d.nts||d.NTS)&&(d.out=s,A.on("out",d),N&&(N.ue=+new Date))}}}function w(d){if(d){var T=d._||"",D=T.root=((T.$=d.$||"")._||"").root;if(d["@"]&&T.faith&&!T.miss){d.out=s,D.on("out",d);return}T.latch=D.hatch,T.match=D.hatch=[];var A=d.put,B=T.DBG=d.DBG,M=+new Date;if(O=O||M,!(A["#"]&&A["."])){B&&(B.p=M),T["#"]=d["#"],T.msg=d,T.all=0,T.stun=1;var I=Object.keys(A);console.STAT&&console.STAT(M,((B||T).pk=+new Date)-M,"put sort");var N=0,P,U,G,R,J,z,V;(function q(et){if(P!=N){if(P=N,!(G=I[N])){console.STAT&&console.STAT(M,((B||T).pd=+new Date)-M,"put"),i(T);return}(R=A[G])?(V=R._)?G!==V["#"]?z=g+x(G)+"soul not same.":(J=V[">"])||(z=g+x(G)+"no state."):z=g+x(G)+"no meta.":z=g+x(G)+"no node.",U=Object.keys(R||{})}if(z){d.err=T.err=z,i(T);return}var pt=0,F;for(et=et||0;et++<9&&(F=U[pt++]);)if(F!=="_"){var nt=R[F],dt=J[F];if(a===dt){z=g+x(F)+"on"+x(G)+"no state.";break}if(!h(nt)){z=g+x(F)+"on"+x(G)+"bad "+typeof nt+x(nt);break}v(nt,F,G,dt,d),++j}if((U=U.slice(pt)).length){l(q);return}++N,U=null,q(et)})()}}}r.on.put=w;function v(d,T,D,A,B){var M=B._||"",I=M.root,N=I.graph,P,U=N[D]||n,G=t(U,T,1),R=U[T],J=M.DBG;(P=console.STAT)&&(!N[D]||!R)&&(P.has=(P.has||0)+1);var z=$();if(A>z){setTimeout(function(){v(d,T,D,A,B)},(P=A-z)>S?S:P),console.STAT&&console.STAT((J||M).Hf=+new Date,P,"future");return}if(!(A<G)&&!(!M.faith&&A===G&&(d===R||k(d)<=k(R))&&!M.miss)){M.stun++;var V=B["#"]+M.all++,q={toString:function(){return V},_:M};q.toJSON=q.toString,I.dup.track(q)["#"]=B["#"],J&&(J.ph=J.ph||+new Date),I.on("put",{"#":q,"@":B["@"],put:{"#":D,".":T,":":d,">":A},ok:B.ok,_:M})}}function m(d){var T;(T=(d._||"").DBG)&&(T.pa=+new Date,T.pm=T.pm||+new Date);var D=this,A=D.as,B=A.graph,M=d._,I=d.put,N=I["#"],P=I["."],U=I[":"],G=I[">"];d["#"];var R;(R=M.msg)&&(R=R.put)&&(R=R[N])&&e(R,P,G,U,N),B[N]=e(B[N],P,G,U,N),(R=(A.next||"")[N])&&R.on("in",d),i(M),D.to.next(d)}function i(d,T){var D;if(!d.stop&&!(!d.err&&0<--d.stun)&&(d.stop=1,!!(D=d.root))){var A=d.match;A.end=1,A===D.hatch&&(!(A=d.latch)||A.end?delete D.hatch:D.hatch=A),d.hatch&&d.hatch(),setTimeout.each(d.match,function(B){B&&B()}),!(!(T=d.msg)||d.err||T.err)&&(T.out=s,d.root.on("out",T),C())}}function o(d){var T=d["@"]||"",D;if(!(D=T._)){var A=(A=d.$)&&(A=A._)&&(A=A.root)&&(A=A.dup);if(!(A=A.check(T)))return;d["@"]=A["#"]||d["@"];return}D.acks=(D.acks||0)+1,(D.err=d.err)&&(d["@"]=D["#"],i(D)),D.ok=d.ok||D.ok,!D.stop&&!D.crack&&(D.crack=D.match&&D.match.push(function(){u(D)})),u(D)}function u(d){!d||!d.root||d.stun||d.acks!==d.all||d.root.on("in",{"@":d["#"],err:d.err,ok:d.err?a:d.ok||{"":1}})}var g="Error: Invalid graph!",x=function(d){return" '"+(""+d).slice(0,9)+"...' "},k=JSON.stringify,S=2147483647,$=r.state,j=0,O,C=function(){j>999&&j/-(O-(O=+new Date))>1&&(r.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),C=function(){j=0})}}(),function(){r.on.get=function(w,v){var m=v._,i=w.get,o=i["#"],u=m.graph[o],g=i["."],x=m.next||(m.next={}),k=x[o],S=w._||{},$=S.DBG=w.DBG;if($&&($.g=+new Date),!u)return m.on("get",w);if(g){if((typeof g!="string"||a===u[g])&&!((k||"").next||"")[g]){m.on("get",w);return}u=e({},g,t(u,g),u[g],o)}u&&s(w,u),m.on("get",w)};function s(w,v){var m=+new Date,i=w._||{},o=i.DBG=w.DBG,u=w["#"],g=f(9),x=Object.keys(v||"").sort(),k=((v||"")._||"")["#"];x.length;var S=w.$._.root,$=v===S.graph[k];console.STAT&&console.STAT(m,((o||i).gk=+new Date)-m,"got keys"),v&&function j(){m=+new Date;for(var O=0,C,d={},T;O<9&&(C=x[O++]);)e(d,C,t(v,C),v[C],k);x=x.slice(O),(T={})[k]=d,d=T;var D;$&&(D=function(){},D.ram=D.faith=!0),T=x.length,console.STAT&&console.STAT(m,-(m-(m=+new Date)),"got copied some"),o&&(o.ga=+new Date),S.on("in",{"@":u,"#":g,put:d,"%":T?g=f(9):a,$:S.$,_:D,DBG:o,FOO:1}),console.STAT&&console.STAT(m,+new Date-m,"got in"),T&&setTimeout.turn(j)}(),v||S.on("in",{"@":w["#"]})}r.on.get.ack=s}(),function(){r.chain.opt=function(s){s=s||{};var w=this,v=w._,m=s.peers||s;return Object.plain(s)||(s={}),Object.plain(v.opt)||(v.opt=s),typeof m=="string"&&(m=[m]),Object.plain(v.opt.peers)||(v.opt.peers={}),m instanceof Array&&(s.peers={},m.forEach(function(i){var o={};o.id=o.url=i,s.peers[i]=v.opt.peers[i]=v.opt.peers[i]||o})),c(s,function i(o){var u=this[o];if(this&&this.hasOwnProperty(o)||typeof u=="string"||Object.empty(u)){this[o]=u;return}u&&u.constructor!==Object&&!(u instanceof Array)||c(u,i)}),v.opt.from=s,r.on("opt",v),v.opt.uuid=v.opt.uuid||function(i){return r.state().toString(36).replace(".","")+String.random(i||12)},w}}();var c=function(s,w){Object.keys(s).forEach(w,s)},f=String.random,l=setTimeout.turn,h=r.valid,t=r.state.is,e=r.state.ify,a,n={},b;r.log=function(){return!r.log.off&&b.log.apply(b,arguments),[].slice.call(arguments).join(" ")},r.log.once=function(s,w,v){return(v=r.log.once)[s]=v[s]||0,v[s]++||r.log(w)},typeof window<"u"&&((window.GUN=window.Gun=r).window=window);try{typeof _<"u"&&(_.exports=r)}catch{}p.exports=r,(r.window||{}).console=(r.window||{}).console||{log:function(){}},(b=console).only=function(s,w){return b.only.i&&s===b.only.i&&b.only.i++&&(b.log.apply(b,arguments)||w)},r.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(y,"./root"),y(function(p){var r=y("./root");r.chain.back=function(l,h){var t;if(l=l||1,l===-1||l===1/0)return this._.root.$;if(l===1)return(this._.back||this._).$;var e=this,a=e._;if(typeof l=="string"&&(l=l.split(".")),l instanceof Array){var n=0,b=l.length,t=a;for(n;n<b;n++)t=(t||c)[l[n]];return f!==t?h?e:t:(t=a.back)?t.$.back(l,h):void 0}if(typeof l=="function"){for(var s,t={back:a};(t=t.back)&&f===(s=l(t,h)););return s}return typeof l=="number"?(a.back||a).$.back(l-1):this};var c={},f})(y,"./back"),y(function(p){var r=y("./root");r.chain.chain=function(i){var o=this,u=o._,g=new(i||o).constructor(o),x=g._,k;return x.root=k=u.root,x.id=++k.once,x.back=o._,x.on=r.on,x.on("in",r.on.in,x),x.on("out",r.on.out,x),g};function c(i){var o,u=this.as,g=u.back,x=u.root,k;if(i.$||(i.$=u.$),this.to.next(i),u.err){u.on("in",{put:u.put=a,$:u.$});return}if(o=i.get){if(x.pass&&(x.pass[u.id]=u),u.lex&&Object.keys(u.lex).forEach(function(S){k[S]=u.lex[S]},k=i.get=i.get||{}),o["#"]||u.soul){if(o["#"]=o["#"]||u.soul,i["#"]||(i["#"]=n(9)),g=x.$.get(o["#"])._,o=o["."]){if(s(g.put,o)&&(k=g.ask&&g.ask[o],(g.ask||(g.ask={}))[o]=g.$.get(o)._,g.on("in",{get:o,put:{"#":g.soul,".":o,":":g.put[o],">":v(x.graph[g.soul],o)}}),k))return}else{if(k=g.ask&&g.ask[""],(g.ask||(g.ask={}))[""]=g,a!==g.put&&(g.on("in",g),k))return;i.$=g.$}return x.ask(t,i),x.on("in",i)}if(o["."])return u.get?(i={get:{".":u.get},$:u.$},(g.ask||(g.ask={}))[u.get]=i.$._,g.on("out",i)):(i={get:u.lex?i.get:{},$:u.$},g.on("out",i));if((u.ask||(u.ask={}))[""]=u,u.get)return o["."]=u.get,(g.ask||(g.ask={}))[u.get]=i.$._,g.on("out",i)}return g.on("out",i)}r.on.out=c;function f(i,o){o=o||this.as;var u=o.root,g=i.$||(i.$=o.$),x=(g||"")._||e,k=i.put||"",S=k["#"],$=k["."],j=a!==k["="]?k["="]:k[":"],O=k[">"]||-1/0,C;if(a!==i.put&&(a===k["#"]||a===k["."]||a===k[":"]&&a===k["="]||a===k[">"])){if(!b(k)){if(!(S=((k||"")._||"")["#"])){console.log("chain not yet supported for",k,"...",i,o);return}return g=o.root.$.get(S),setTimeout.each(Object.keys(k).sort(),function(d){d=="_"||a===(O=v(k,d))||o.on("in",{$:g,put:{"#":S,".":d,"=":k[d],">":O},VIA:i})})}o.on("in",{$:x.back.$,put:{"#":S=x.back.soul,".":$=x.has||x.get,"=":k,">":v(x.back.put,$)},via:i});return}(i.seen||"")[o.id]||((i.seen||(i.seen=function(){}))[o.id]=o,o!==x&&(Object.keys(i).forEach(function(d){k[d]=i[d]},k={}),k.get=o.get||k.get,!o.soul&&!o.has?k.$$$=k.$$$||o.$:x.soul&&(k.$=o.$,k.$$=k.$$||x.$),i=k),h(i,o),(o.soul||i.$$)&&O>=v(u.graph[S],$)&&((k=u.$.get(S)._).put=m(k.put,$,O,j,S)),!x.soul&&O>=v(u.graph[S],$)&&(C=(u.$.get(S)._.next||"")[$])&&(C.put=j,typeof(k=b(j))=="string"&&(C.put=u.$.get(k)._.put||j)),this.to&&this.to.next(i),o.any&&setTimeout.each(Object.keys(o.any),function(d){(d=o.any[d])&&d(i)},0,99),o.echo&&setTimeout.each(Object.keys(o.echo),function(d){(d=o.echo[d])&&d.on("in",i)},0,99),((i.$$||"")._||x).soul&&(C=o.next)&&(C=C[$])&&(k={},Object.keys(i).forEach(function(d){k[d]=i[d]}),k.$=(i.$$||i.$).get(k.get=$),delete k.$$,delete k.$$$,C.on("in",k)),l(i,o))}r.on.in=f;function l(i,o){if(o=o||this.as||i.$._,!(i.$$&&this!==r.on)&&!(!i.put||o.soul)){var u=i.put||"",g=u["="]||u[":"],x,k=o.root,S=k.$.get(u["#"]).get(u["."])._;if(typeof(g=b(g))!="string"){this===r.on&&((S.echo||(S.echo={}))[o.id]=o);return}if(!((S.echo||(S.echo={}))[o.id]&&!(k.pass||"")[o.id])){if(x=k.pass){if(x[g+o.id])return;x[g+o.id]=1}(S.echo||(S.echo={}))[o.id]=o,o.has&&(o.link=g);var $=k.$.get(S.link=g)._;($.echo||($.echo={}))[S.id]=S;var x=o.ask||"";(x[""]||o.lex)&&$.on("out",{get:{"#":g}}),setTimeout.each(Object.keys(x),function(O,C){!O||!(C=x[O])||C.on("out",{get:{"#":g,".":O}})},0,99)}}}r.on.link=l;function h(i,o){var u=i.put||"",g=a!==u["="]?u["="]:u[":"],x=o.root,k,S;if(a===g){if(o.soul&&a!==o.put||(S=(i.$$||i.$||"")._||"",i["@"]&&(a!==S.put||a!==o.put)))return;(k=o.link||i.linked)&&delete(x.$.get(k)._.echo||"")[o.id],o.has&&(o.link=null),o.put=a,setTimeout.each(Object.keys(o.next||""),function($,j){(j=o.next[$])&&(k&&delete(x.$.get(k).get($)._.echo||"")[j.id],j.on("in",{get:$,put:a,$:j.$}))},0,99);return}o.soul||i.$$||(k=b(g),S=i.$._||"",!((k===S.link||o.has&&!S.link)&&!((x.pass||"")[o.id]&&typeof k!="string"))&&(delete(S.echo||"")[o.id],h({get:o.get,put:a,$:i.$,linked:i.linked=i.linked||S.link},o)))}r.on.unlink=h;function t(i,o){var u=this.as,g=u.$._;g.root;var x=u.get||"",k=(i.put||"")[x["#"]]||"";if(!i.put||typeof x["."]=="string"&&a===k[x["."]]){if(a!==g.put||!g.soul&&!g.has)return;g.ack=(g.ack||0)+1,g.on("in",{get:g.get,put:g.put=a,$:g.$,"@":i["@"]});return}(i._||{}).miss=1,r.on.put(i)}var e={},a,n=String.random,b=r.valid,s=function(i,o){return i&&Object.prototype.hasOwnProperty.call(i,o)},w=r.state,v=w.is,m=w.ify})(y,"./chain"),y(function(p){var r=y("./root");r.chain.get=function(a,n,b){var s,w;if(typeof a=="string"){if(a.length==0)return(s=this.chain())._.err={err:r.log("0 length key!",a)},n&&n.call(s,s._.err),s;var v=this,m=v._,i=m.next||h;(s=i[a])||(s=a&&c(a,v)),s=s&&s.$}else if(typeof a=="function"){let k=function($,j,O){if(!k.stun&&!((B=u.pass)&&!B[g])){var C=$.$._,d=($.$$||"")._,T=(d||C).put,D=!C.has&&!C.soul,A={},B;if((D||e===T)&&(T=e===((B=$.put)||"")["="]?e===(B||"")[":"]?B:B[":"]:B["="]),typeof(B=r.valid(T))=="string"&&(T=e===(B=u.$.get(B)._.put)?o.not?e:T:B),!(o.not&&e===T)){if(e===o.stun){if((B=u.stun)&&B.on&&(m.$.back(function(M){if(B.on(""+M.id,A={}),(A.run||0)<k.id)return A}),!A.run&&B.on(""+C.id,A={}),!A.run&&d&&B.on(""+d.id,A={}),k.id>A.run&&((!A.stun||A.stun.end)&&(A.stun=B.on("stun"),A.stun=A.stun&&A.stun.last),A.stun&&!A.stun.end))){(A.stun.add||(A.stun.add={}))[g]=function(){k($,j,1)};return}if(e===T&&(O=0),(B=u.hatch)&&!B.end&&e===o.hatch&&!O){if(x[C.$._.id])return;x[C.$._.id]=1,B.push(function(){k($,j,1)});return}x={}}if(u.pass){if(u.pass[g+C.id])return;u.pass[g+C.id]=1}if(o.on){o.ok.call(C.$,T,C.get,$,j||k);return}if(o.v2020){o.ok($,j||k);return}Object.keys($).forEach(function(M){B[M]=$[M]},B={}),$=B,$.put=T,o.ok.call(o.as,$,j||k)}}};if(n===!0)return f(this,a,n,b),this;s=this;var m=s._,o=n||{},u=m.root,g;o.at=m,o.ok=a;var x={};return k.at=m,(m.any||(m.any={}))[g=String.random(7)]=k,k.off=function(){k.stun=1,m.any&&delete m.any[g]},k.rid=l,k.id=o.run||++u.once,w=u.pass,(u.pass={})[g]=1,o.out=o.out||{get:{}},m.on("out",o.out),u.pass=w,s}else{if(typeof a=="number")return this.get(""+a,n,b);if(typeof(w=t(a))=="string")return this.get(w,n,b);(w=this.get.next)&&(s=w(this,a))}return s?(n&&typeof n=="function"&&s.get(n,b),s):((s=this.chain())._.err={err:r.log("Invalid get request!",a)},n&&n.call(s,s._.err),s)};function c(a,n){var b=n._,s=b.next,w=n.chain(),v=w._;return s||(s=b.next={}),s[v.get=a]=v,n===b.root.$?v.soul=a:(b.soul||b.has)&&(v.has=a),v}function f(a,n,b,s){var w=a._,v=0,m;return(m=w.soul||w.link)?n(m,s,w):w.jam?w.jam.push([n,s]):(w.jam=[[n,s]],a.get(function(i,o){if(!(e===i.put&&!w.root.opt.super&&(m=Object.keys(w.root.opt.peers).length)&&++v<=m)){o.rid(i);var u=(u=i.$)&&u._||{},g=0,x;for(m=w.jam,delete w.jam;x=m[g++];){var k=x[0];x=x[1],k&&k(u.link||u.soul||r.valid(i.put)||((i.put||{})._||{})["#"],x,i,o)}}},{out:{get:{".":!0}}}),a)}function l(a){var n=this.at||this.on;if(!a||n.soul||n.has)return this.off();if(a=(a=(a=a.$||a)._||a).id){n.map;var b;if((b=this.seen||(this.seen={}))[a])return!0;b[a]=!0}}var h={},t=r.valid,e})(y,"./get"),y(function(p){var r=y("./root");r.chain.put=function(s,w,v){var m=this,i=m._,o=i.root;v=v||{},v.root=i.root,v.run||(v.run=o.once),c(v,i.id),v.ack=v.ack||w,v.via=v.via||m,v.data=v.data||s,v.soul||(v.soul=i.soul||typeof w=="string"&&w);var u=v.state=v.state||r.state();return typeof s=="function"?(s(function(g){v.data=g,m.put(t,t,v)}),m):v.soul?(v.$=o.$.get(v.soul),v.todo=[{it:v.data,ref:v.$}],v.turn=v.turn||a,v.ran=v.ran||f,function g(){var x=v.todo,k=x.pop(),S=k.it;k.ref&&k.ref._.id;var $,j,O,C,d;if(c(v,k.ref),(C=k.todo)&&(j=C.pop(),S=S[j],C.length&&x.push(k)),j&&(x.path||(x.path=[])).push(j),!($=n(S))&&!(d=r.is(S))){if(!Object.plain(S)){f.err(v,"Invalid data: "+h(S)+" at "+(v.via.back(function(B){B.get&&C.push(B.get)},C=[])||C.join("."))+"."+(x.path||[]).join("."));return}for(var T=v.seen||(v.seen=[]),D=T.length;D--;)if(S===(C=T[D]).it){$=S=C.link;break}}if(j&&$)k.node=b(k.node,j,u,S);else{let B=function(M,I){var N=O.link["#"];I&&(I.off(),I.rid(M));var P=N||M.soul||(C=(M.$$||M.$)._||"").soul||C.link||((C=C.put||"")._||"")["#"]||C["#"]||((C=M.put||"")&&M.$$?C["#"]:(C["="]||C[":"]||"")["#"]);if(!N&&c(v,M.$),!P&&!k.link["#"]){(k.wait||(k.wait=[])).push(function(){B(M,I)});return}P||(P=[],(M.$$||M.$).back(function(U){if(C=U.soul||U.link)return P.push(C);P.push(U.get)}),P=P.reverse().join("/")),O.link["#"]=P,!d&&(((v.graph||(v.graph={}))[P]=O.node||(O.node={_:{}}))._["#"]=P),delete v.wait[A],O.wait&&setTimeout.each(O.wait,function(U){U&&U()}),v.ran(v)};if(!v.seen){f.err(v,"Data at root of graph must be a node (an object).");return}v.seen.push(O={it:S,link:{},todo:d?[]:Object.keys(S).sort().reverse(),path:(x.path||[]).slice(),up:k}),k.node=b(k.node,j,u,O.link),!d&&O.todo.length&&x.push(O);var A=v.seen.length;(v.wait||(v.wait={}))[A]="",C=(O.ref=d?S:j?k.ref.get(j):k.ref)._,(C=S&&(S._||"")["#"]||C.soul||C.link)?B({soul:C}):O.ref.get(B,{run:v.run,v2020:1,out:{get:{".":" "}}})}if(!x.length)return v.ran(v);v.turn(g)}(),m):(l(v),m)};function c(s,w){if(w){w=(w._||"").id||w;var v=s.root.stun||(s.root.stun={on:r.on}),m={},i;s.stun||(s.stun=v.on("stun",function(){})),(i=v.on(""+w))&&i.the.last.next(m),!(m.run>=s.run)&&v.on(""+w,function(o){if(s.stun.end){this.off(),this.to.next(o);return}o.run=o.run||s.run,o.stun=o.stun||s.stun})}}function f(s){if(s.err){f.end(s.stun,s.root);return}if(!(s.todo.length||s.end||!Object.empty(s.wait))){s.end=1;var w=s.$.back(-1)._,v=w.root,m=w.ask(function(g){v.on("ack",g),g.err&&!g.lack&&r.log(g),++i>(s.acks||0)&&this.off(),s.ack&&s.ack(g,this)},s.opt),i=0,o=s.stun,u;(u=function(){o&&(f.end(o,v),setTimeout.each(Object.keys(o=o.add||""),function(g){(g=o[g])&&g()}))}).hatch=u,s.ack&&!s.ok&&(s.ok=s.acks||9),s.via._.on("out",{put:s.out=s.graph,ok:s.ok&&{"@":s.ok+1},opt:s.opt,"#":m,_:u})}}f.end=function(s,w){s.end=e,s.the.to===s&&s===s.the.last&&delete w.stun,s.off()},f.err=function(s,w){(s.ack||e).call(s,s.out={err:s.err=r.log(w)}),s.ran(s)};function l(s){var w=s.via._,v;s.via=s.via.back(function(m){if(m.soul||!m.get)return m.$;v=s.data,(s.data={})[m.get]=v}),(!s.via||!s.via._.soul)&&(s.via=w.root.$.get(((s.data||"")._||"")["#"]||w.$.back("opt.uuid")())),s.via.put(s.data,s.ack,s)}function h(s,w){return s&&(w=s.constructor)&&w.name||typeof s}var t,e=function(){},a=setTimeout.turn,n=r.valid,b=r.state.ify})(y,"./put"),y(function(p){var r=y("./root");y("./chain"),y("./back"),y("./put"),y("./get"),p.exports=r})(y,"./index"),y(function(p){var r=y("./index");r.chain.on=function(l,h,t,e){var a=this,n=a._;n.root;var b;if(typeof l=="string")return h?(b=n.on(l,h,t||n,e),t&&t.$&&(t.subs||(t.subs=[])).push(b),a):n.on(l);var s=h;return(s=s===!0?{change:!0}:s||{}).not=1,s.on=1,a.get(l,s),a},r.chain.once=function(l,h){if(h=h||{},!l)return c(this);var t=this,e=t._,a=e.root;e.put;var n=String.random(7),b;return t.get(function(s,w,v,m){var i=this,o=i._,u=o.one||(o.one={});if(m.stun||u[n]==="")return;if((b=r.valid(s))===!0){g();return}if(typeof b=="string")return;clearTimeout((e.one||"")[n]),clearTimeout(u[n]),u[n]=setTimeout(g,h.wait||99);function g(x){if(!o.has&&!o.soul&&(o={put:s,get:w}),f===(b=o.put)&&(b=((v.$$||"")._||"").put),typeof r.valid(b)=="string"&&(b=a.$.get(b)._.put,b===f&&!x)){u[n]=setTimeout(function(){g(1)},h.wait||99);return}m.stun||u[n]!==""&&(u[n]="",(e.soul||e.has)&&m.off(),l.call(i,b,o.get),clearTimeout(u[n]))}},{on:1}),t};function c(l,h,t){return r.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(t=l.chain())._.nix=l.once(function(e,a){t._.on("in",this._)}),t._.lex=l._.lex,t}r.chain.off=function(){var l=this,h=l._,t,e=h.back;if(e)return h.ack=0,(t=e.next)&&t[h.get]&&delete t[h.get],(t=e.any)&&(delete e.any,e.any={}),(t=e.ask)&&delete t[h.get],(t=e.put)&&delete t[h.get],(t=h.soul)&&delete e.root.graph[t],(t=h.map)&&Object.keys(t).forEach(function(a,n){n=t[a],n.link&&e.root.$.get(n.link).off()}),(t=h.next)&&Object.keys(t).forEach(function(a,n){n=t[a],n.$.off()}),h.on("off",{}),l};var f})(y,"./on"),y(function(p){var r=y("./index"),c=r.chain.get.next;r.chain.get.next=function(t,e){var a;return Object.plain(e)?(a=((a=e["#"])||"")["="]||a)?t.get(a):((a=t.chain()._).lex=e,t.on("in",function(n){String.match(n.get||(n.put||"")["."],e["."]||e["#"]||e)&&a.on("in",n),this.to.next(n)}),a.$):(c||l)(t,e)},r.chain.map=function(t,e,a){var n=this,b=n._,s,w;return Object.plain(t)&&(s=t["."]?t:{".":t},t=h),t?(r.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),w=n.chain(),n.map().on(function(v,m,i,o){var u=(t||l).call(this,v,m,i,o);if(h!==u){if(v===u)return w._.on("in",i);if(r.is(u))return w._.on("in",u._);var g={};Object.keys(i.put).forEach(function(x){g[x]=i.put[x]},g),g["="]=u,w._.on("in",{get:m,put:g})}}),w):((w=b.each)||((b.each=w=n.chain())._.lex=s||w._.lex||b.lex,w._.nix=n.back("nix"),n.on("in",f,w._)),w)};function f(t){this.to.next(t);var e=this.as,a=t.$,n=a._,b=t.put,s;!n.soul&&!t.$$||(s=e.lex)&&!String.match(t.get||(b||"")["."],s["."]||s["#"]||s)||r.on.link(t,e)}var l=function(){},h})(y,"./map"),y(function(p){var r=y("./index");r.chain.set=function(c,f,l){var h=this,t=h.back(-1),e,a;return f=f||function(){},l=l||{},l.item=l.item||c,(e=((c||"")._||"")["#"])&&((c={})["#"]=e),typeof(a=r.valid(c))=="string"?h.get(e=a).put(c,f,l):r.is(c)?(h.put(function(n){c.get(function(b,s,w){if(!b)return f.call(h,{err:r.log('Only a node can be linked! Not "'+w.put+'"!')});(a={})[b]={"#":b},n(a)},!0)}),c):(Object.plain(c)&&(c=t.get(e=h.back("opt.uuid")()).put(c)),h.get(e||t.back("opt.uuid")(7)).put(c,f,l))}})(y,"./set"),y(function(p){y("./shim");var r=function(){},c=JSON.parseAsync||function(t,e,a){var n,b=+new Date;try{e(n,JSON.parse(t,a),f.sucks(+new Date-b))}catch(s){e(s)}},f=JSON.stringifyAsync||function(t,e,a,n){var b,s=+new Date;try{e(b,JSON.stringify(t,a,n),f.sucks(+new Date-s))}catch(w){e(w)}};f.sucks=function(t){t>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),f.sucks=r)};function l(t){var e=function(){},a=t.opt||{};a.log=a.log||console.log,a.gap=a.gap||a.wait||0,a.max=a.max||(a.memory?a.memory*999*999:3e8)*.3,a.pack=a.pack||a.max*.01*.01,a.puff=a.puff||9;var n=setTimeout.turn||setTimeout,b=t.dup,s=b.check,w=b.track,v=e.hear=function(o,u){if(o){if(a.max<=o.length)return e.say({dam:"!",err:"Message too big!"},u);e===this&&(v.d+=o.length||0,++v.c);var g=u.SH=+new Date,x=o[0],k;if(x==="["){c(o,function(S,$){if(S||!$)return e.say({dam:"!",err:"DAM JSON parse error."},u);console.STAT&&console.STAT(+new Date,$.length,"# on hear batch");var j=a.puff;(function O(){for(var C=+new Date,d=0,T;d<j&&(T=$[d++]);)e.hear(T,u);$=$.slice(d),console.STAT&&console.STAT(C,+new Date-C,"hear loop"),m(u),$.length&&n(O,0)})()}),o="";return}if(x==="{"||(o["#"]||Object.plain(o))&&(k=o)){if(k)return v.one(k,u,g);c(o,function(S,$){if(S||!$)return e.say({dam:"!",err:"DAM JSON parse error."},u);v.one($,u,g)});return}}};v.one=function(o,u,g){var x,k,S,$,j;if(o.DBG&&(o.DBG=j={DBG:o.DBG}),j&&(j.h=g),j&&(j.hp=+new Date),(x=o["#"])||(x=o["#"]=String.random(9)),!(S=s(x))&&(k=o["##"],!(k&&(S=o["@"]||o.get&&x)&&b.check($=S+k)))){if((o._=function(){}).via=e.leap=u,(S=o["><"])&&typeof S=="string"&&S.slice(0,99).split(",").forEach(function(C){this[C]=1},o._.yo={}),S=o.dam){(S=e.hear[S])&&S(o,u,t),w(x);return}(S=o.ok)&&(o._.near=S["/"]);var g=+new Date;j&&(j.is=g),u.SI=x,w.ed=function(C){x===C&&(w.ed=0,(C=b.s[x])&&(C.via=u,o.get&&(C.it=o)))},t.on("in",e.last=o),j&&(j.hd=+new Date),console.STAT&&console.STAT(g,+new Date-g,o.get?"msg get":o.put?"msg put":"msg"),w(x),$&&w($),e.leap=e.last=null}},v.c=v.d=0,function(){var o=0,u;e.hash=function(k,S){var $,j,O,C=+new Date;f(k.put,function d(T,D){var A=(j||(j=O=D||"")).slice(0,32768);if($=String.hash(A,$),j=j.slice(32768),j){n(d,0);return}console.STAT&&console.STAT(C,+new Date-C,"say json+hash"),k._.$put=O,k["##"]=$,e.say(k,S),delete k._.$put},g)};function g(k,S){var $;return S instanceof Object?(Object.keys(S).sort().forEach(x,{to:$={},on:S}),$):S}function x(k){this.to[k]=this.on[k]}e.say=function(k,S){var $;if(($=this)&&($=$.to)&&$.next&&$.next(k),!k)return!1;var j,O,C,d=k["@"],T=k._||(k._=function(){}),D=k.DBG,A=+new Date;if(T.y=T.y||A,S||D&&(D.y=A),(j=k["#"])||(j=k["#"]=String.random(9)),!u&&w(j),!(O=k["##"])&&h!==k.put&&!T.via&&d){e.hash(k,S);return}if(!S&&d&&(S=($=b.s[d])&&($.via||($=$.it)&&($=$._)&&$.via)||($=e.last)&&d===$["#"]&&e.leap),!S&&d)return b.s[d]?void 0:(console.STAT&&console.STAT(+new Date,++o,"total no peer to ack to"),!1);if(d&&!k.put&&!O&&((b.s[d]||"").it||"")["##"])return!1;if(!S&&e.way)return e.way(k);if(D&&(D.yh=+new Date),!(C=T.raw)){e.raw(k,S);return}if(D&&(D.yr=+new Date),!S||!S.id){if(!Object.plain(S||a.peers))return!1;var A=+new Date;a.puff;var B=a.peers,M=Object.keys(S||a.peers||{});console.STAT&&console.STAT(A,+new Date-A,"peer keys"),function P(){var U=+new Date;u=1;var G=T.raw;T.raw=C;for(var R=0,J;R<9&&(J=(M||"")[R++]);)(J=B[J]||(S||"")[J])&&e.say(k,J);T.raw=G,u=0,M=M.slice(R),console.STAT&&console.STAT(U,+new Date-U,"say loop"),M.length&&(n(P,0),d&&w(d))}();return}if(!S.wire&&e.wire&&e.wire(S),j!==S.last){if(S.last=j,S===T.via||($=T.yo)&&($[S.url]||$[S.pid]||$[S.id]))return!1;if(console.STAT&&console.STAT(A,((D||T).yp=+new Date)-(T.y||A),"say prep"),!u&&d&&w(d),S.batch){if(S.tail=($=S.tail||0)+C.length,S.tail<=a.pack){S.batch+=($?",":"")+C;return}m(S)}S.batch="[";var I=+new Date;setTimeout(function(){console.STAT&&console.STAT(I,+new Date-I,"0ms TO"),m(S)},a.gap),i(C,S),console.STAT&&d===S.SI&&console.STAT(A,+new Date-S.SH,"say ack")}},e.say.c=e.say.d=0,e.raw=function(k,S){if(!k)return"";var $=k._||{},j,O;if(O=$.raw)return O;if(typeof k=="string")return k;var C=k["##"],d=k["@"];if(C&&d){if(!$.via&&s(d+C))return!1;if(O=(b.s[d]||"").it){if(C===O["##"])return!1;O["##"]||(O["##"]=C)}}if(!k.dam&&!k["@"]){var T=0,D=[];O=a.peers;for(var A in O){var B=O[A];if(D.push(B.url||B.pid||B.id),++T>6)break}T>1&&(k["><"]=D.join())}if(k.put&&(O=k.ok)&&(k.ok={"@":(O["@"]||1)-1,"/":O["/"]==k._.near?e.near:O["/"]}),j=$.$put){O={},Object.keys(k).forEach(function(I){O[I]=k[I]}),O.put=":])([:",f(O,function(I,N){if(!I){var P=+new Date;O=N.indexOf('"put":":])([:"'),M(h,N=N.slice(0,O+6)+j+N.slice(O+14)),console.STAT&&console.STAT(P,+new Date-P,"say slice")}});return}f(k,M);function M(I,N){I||($.raw=N,e.say(k,S))}}}();function m(o){var u=o.batch,g=typeof u=="string";if(g&&(u+="]"),o.batch=o.tail=null,!!u&&!(g?3>u.length:!u.length)){if(!g)try{u=u.length===1?u[0]:JSON.stringify(u)}catch(x){return a.log("DAM JSON stringify error",x)}u&&i(u,o)}}function i(o,u){try{var g=u.wire;u.say?u.say(o):g.send&&g.send(o),e.say.d+=o.length||0,++e.say.c}catch{(u.queue=u.queue||[]).push(o)}}return e.near=0,e.hi=function(o){var u=o.wire,g;if(!u){e.wire(o.length&&{url:o,id:o}||o);return}o.id?a.peers[o.url||o.id]=o:(g=o.id=o.id||o.url||String.random(9),e.say({dam:"?",pid:t.opt.pid},a.peers[g]=o),delete b.s[o.last]),o.met||(e.near++,o.met=+new Date,t.on("hi",o)),g=o.queue,o.queue=[],setTimeout.each(g||[],function(x){i(x,o)},0,9)},e.bye=function(o){o.met&&--e.near,delete o.met,t.on("bye",o);var u=+new Date;u=u-(o.met||u),e.bye.time=((e.bye.time||u)+u)/2},e.hear["!"]=function(o,u){a.log("Error:",o.err)},e.hear["?"]=function(o,u){o.pid&&(u.pid||(u.pid=o.pid),o["@"])||(e.say({dam:"?",pid:a.pid,"@":o["#"]},u),delete b.s[u.last])},e.hear.mob=function(o,u){if(o.peers){var g=Object.keys(o.peers),x=g[Math.random()*g.length>>0];x&&(e.bye(u),e.hi(x))}},t.on("create",function(o){o.opt.pid=o.opt.pid||String.random(9),this.to.next(o),o.on("out",e.say)}),t.on("bye",function(o,u){o=a.peers[o.id||o]||o,this.to.next(o),o.bye?o.bye():(u=o.wire)&&u.close&&u.close(),delete a.peers[o.id],o.wire=null}),t.on("bye",function(o,u){this.to.next(o),(u=console.STAT)&&(u.peers=e.near),(u=o.url)&&setTimeout(function(){},a.lack||9e3)}),t.on("hi",function(o,u){if(this.to.next(o),(u=console.STAT)&&(u.peers=e.near),!a.super){var g=Object.keys(t.next||"");g.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(g,function(x){var k=t.next[x];if(a.super||(k.ask||"")[""]){e.say({get:{"#":x}},o);return}setTimeout.each(Object.keys(k.ask||""),function(S){S&&e.say({"##":String.hash((t.graph[x]||"")[S]),get:{"#":x,".":S}},o)})})}}),e}var h;try{p.exports=l}catch{}})(y,"./mesh"),y(function(p){var r=y("./index");r.Mesh=y("./mesh"),r.on("opt",function(f){if(this.to.next(f),f.once)return;var l=f.opt;if(l.WebSocket===!1)return;var h=r.window||{},t=l.WebSocket||h.WebSocket||h.webkitWebSocket||h.mozWebSocket;if(!t)return;l.WebSocket=t;var e=l.mesh=l.mesh||r.Mesh(f);e.wire||l.wire,e.wire=l.wire=a;function a(w){try{if(!w||!w.url)return m&&m(w);var v=w.url.replace(/^http/,"ws"),m=w.wire=new l.WebSocket(v);return m.onclose=function(){b(w),l.mesh.bye(w)},m.onerror=function(i){b(w)},m.onopen=function(){l.mesh.hi(w)},m.onmessage=function(i){i&&l.mesh.hear(i.data||i,w)},m}catch{l.mesh.bye(w)}}setTimeout(function(){!l.super&&f.on("out",{dam:"hi"})},1);var n=2*999;function b(w){clearTimeout(w.defer),l.peers[w.url]&&(s&&w.retry<=0||(w.retry=(w.retry||l.retry+1||60)-(-w.tried+(w.tried=+new Date)<n*4?1:0),w.defer=setTimeout(function v(){if(s&&s.hidden)return setTimeout(v,n);a(w)},n)))}var s=""+c!=typeof document&&document});var c})(y,"./websocket"),y(function(p){if(!(typeof Gun>"u")){var r=function(){},c;try{c=(Gun.window||r).localStorage}catch{}c||(Gun.log("Warning: No localStorage exists to persist data to!"),c={setItem:function(l,h){this[l]=h},removeItem:function(l){delete this[l]},getItem:function(l){return this[l]}});var f=JSON.stringifyAsync||function(l,h,t,e){var a;try{h(a,JSON.stringify(l,t,e))}catch(n){h(n)}};Gun.on("create",function l(h){this.to.next(h);var t=h.opt;h.graph;var e=[],a,n,b,s;if(t.localStorage===!1)return;t.prefix=t.file||"gun/";try{a=l[t.prefix]=l[t.prefix]||JSON.parse(b=c.getItem(t.prefix))||{}}catch{a=l[t.prefix]={}}b=(b||"").length,h.on("get",function(v){this.to.next(v);var m=v.get,i,o,u,g;!m||!(i=m["#"])||(o=a[i]||g,o&&(u=m["."])&&!Object.plain(u)&&(o=Gun.state.ify({},u,Gun.state.is(o,u),o[u],i)),Gun.on.get.ack(v,o))}),h.on("put",function(v){this.to.next(v);var m=v.put,i=m["#"],o=m["."],u=v["#"],g=v.ok||"";if(a[i]=Gun.state.ify(a[i],o,m[">"],m[":"],i),s&&b>4999880){h.on("in",{"@":u,err:"localStorage max!"});return}!v["@"]&&(!v._.via||Math.random()<g["@"]/g["/"])&&e.push(u),!n&&(n=setTimeout(w,9+b/333))});function w(){if(!e.length&&((setTimeout.turn||"").s||"").length){setTimeout(w,99);return}var v=e;clearTimeout(n),n=!1,e=[],f(a,function(m,i){try{!m&&c.setItem(t.prefix,i)}catch(o){m=s=o||"localStorage failure"}m&&(Gun.log(m+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),h.on("localStorage:error",{err:m,get:t.prefix,put:a})),b=i.length,setTimeout.each(v,function(o){h.on("in",{"@":o,err:m,ok:0})},0,99)})}})}})(y,"./localStorage")})(),function(){var y;if(""+y!=typeof Gun){var _=function(d){console.warn("Warning! Deprecated internal utility will break in next version:",d)},p=Gun;p.fn=p.fn||{is:function(d){return _("fn"),!!d&&typeof d=="function"}},p.bi=p.bi||{is:function(d){return _("bi"),d instanceof Boolean||typeof d=="boolean"}},p.num=p.num||{is:function(d){return _("num"),!r(d)&&(d-parseFloat(d)+1>=0||d===1/0||d===-1/0)}},p.text=p.text||{is:function(d){return _("text"),typeof d=="string"}},p.text.ify=p.text.ify||function(d){return _("text.ify"),p.text.is(d)?d:typeof JSON<"u"?JSON.stringify(d):d&&d.toString?d.toString():d},p.text.random=p.text.random||function(d,T){_("text.random");var D="";for(d=d||24,T=T||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";d>0;)D+=T.charAt(Math.floor(Math.random()*T.length)),d--;return D},p.text.match=p.text.match||function(d,T){var D,A;return _("text.match"),typeof d!="string"?!1:(typeof T=="string"&&(T={"=":T}),T=T||{},D=T["="]||T["*"]||T[">"]||T["<"],d===D?!0:A!==T["="]?!1:(D=T["*"]||T[">"]||T["<"],d.slice(0,(D||"").length)===D?!0:A!==T["*"]?!1:A!==T[">"]&&A!==T["<"]?d>=T[">"]&&d<=T["<"]:A!==T[">"]&&d>=T[">"]||A!==T["<"]&&d<=T["<"]))},p.text.hash=p.text.hash||function(d,T){if(_("text.hash"),typeof d=="string"){if(T=T||0,!d.length)return T;for(var D=0,A=d.length,B;D<A;++D)B=d.charCodeAt(D),T=(T<<5)-T+B,T|=0;return T}},p.list=p.list||{is:function(d){return _("list"),d instanceof Array}},p.list.slit=p.list.slit||Array.prototype.slice,p.list.sort=p.list.sort||function(d){return _("list.sort"),function(T,D){return!T||!D?0:(T=T[d],D=D[d],T<D?-1:T>D?1:0)}},p.list.map=p.list.map||function(d,T,D){return _("list.map"),j(d,T,D)},p.list.index=1,p.obj=p.boj||{is:function(d){return _("obj"),d?d instanceof Object&&d.constructor===Object||Object.prototype.toString.call(d).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},p.obj.put=p.obj.put||function(d,T,D){return _("obj.put"),(d||{})[T]=D,d},p.obj.has=p.obj.has||function(d,T){return _("obj.has"),d&&Object.prototype.hasOwnProperty.call(d,T)},p.obj.del=p.obj.del||function(d,T){if(_("obj.del"),!!d)return d[T]=null,delete d[T],d},p.obj.as=p.obj.as||function(d,T,D,A){return _("obj.as"),d[T]=d[T]||(A===D?{}:D)},p.obj.ify=p.obj.ify||function(d){if(_("obj.ify"),g(d))return d;try{d=JSON.parse(d)}catch{d={}}return d},function(){var d;function T(D,A){k(this,A)&&d!==this[A]||(this[A]=D)}p.obj.to=p.obj.to||function(D,A){return _("obj.to"),A=A||{},j(D,T,A),A}}(),p.obj.copy=p.obj.copy||function(d){return _("obj.copy"),d&&JSON.parse(JSON.stringify(d))},function(){function d(T,D){var A=this.n,B;if(!(A&&(D===A||g(A)&&k(A,D)))&&B!==D)return!0}p.obj.empty=p.obj.empty||function(T,D){return _("obj.empty"),T?!j(T,d,{n:D}):!0}}(),function(){function d(A,B){if(arguments.length===2){d.r=d.r||{},d.r[A]=B;return}d.r=d.r||[],d.r.push(A)}var T=Object.keys,D;Object.keys=Object.keys||function(A){return D(A,function(B,M,I){I(M)})},p.obj.map=D=p.obj.map||function(A,B,M){_("obj.map");var I,N=0,P,U,G,R,J=typeof B=="function";if(d.r=I,T&&g(A)&&(G=T(A),R=!0),M=M||{},r(A)||G)for(P=(G||A).length;N<P;N++){var z=N+p.list.index;if(J){if(U=R?B.call(M,A[G[N]],G[N],d):B.call(M,A[N],z,d),U!==I)return U}else if(B===A[R?G[N]:N])return G?G[N]:z}else for(N in A)if(J){if(k(A,N)&&(U=M?B.call(M,A[N],N,d):B(A[N],N,d),U!==I))return U}else if(B===A[N])return N;return J?d.r:p.list.index?0:-1}}(),p.time=p.time||{},p.time.is=p.time.is||function(d){return _("time"),d?d instanceof Date:+new Date().getTime()};var o=p.fn.is,r=p.list.is,u=p.obj,g=u.is,k=u.has,j=u.map,c={};c.is=function(d){return _("val.is"),d===y?!1:d===null?!0:d===1/0?!1:h(d)||l(d)||w(d)?!0:c.link.is(d)||!1},c.link=c.rel={_:"#"},function(){c.link.is=function(T){if(_("val.link.is"),T&&T[f]&&!T._&&g(T)){var D={};if(j(T,d,D),D.id)return D.id}return!1};function d(T,D){var A=this;if(A.id)return A.id=!1;if(D==f&&h(T))A.id=T;else return A.id=!1}}(),c.link.ify=function(d){return _("val.link.ify"),$({},f,d)},p.obj.has._=".";var f=c.link._,y,l=p.bi.is,w=p.num.is,h=p.text.is,u=p.obj,g=u.is,$=u.put,j=u.map;p.val=p.val||c;var t={_:"_"};t.soul=function(d,T){return _("node.soul"),d&&d._&&d._[T||n]},t.soul.ify=function(d,T){return _("node.soul.ify"),T=typeof T=="string"?{soul:T}:T||{},d=d||{},d._=d._||{},d._[n]=T.soul||d._[n]||a(),d},t.soul._=c.link._,function(){t.is=function(T,D,A){_("node.is");var B;return g(T)&&(B=t.soul(T))?!j(T,d,{as:A,cb:D,s:B,n:T}):!1};function d(T,D){if(D!==t._){if(!c.is(T))return!0;this.cb&&this.cb.call(this.as,T,D,this.n,this.s)}}}(),function(){t.ify=function(T,D,A){return _("node.ify"),D?typeof D=="string"?D={soul:D}:typeof D=="function"&&(D={map:D}):D={},D.map&&(D.node=D.map.call(A,T,y,D.node||{})),(D.node=t.soul.ify(D.node||{},D))&&j(T,d,{o:D,as:A}),D.node};function d(T,D){var A=this.o,B,M;if(A.map){B=A.map.call(this.as,T,""+D,A.node),M===B?x(A.node,D):A.node&&(A.node[D]=B);return}c.is(T)&&(A.node[D]=T)}}();var u=p.obj,g=u.is,x=u.del,j=u.map,e=p.text,a=e.random,n=t.soul._,y;p.node=p.node||t;var b=p.state;b.lex=function(){return _("state.lex"),b().toString(36).replace(".","")},b.to=function(d,T,D){_("state.to");var A=(d||{})[T];return g(A)&&(A=O(A)),b.ify(D,T,b.is(d,T),A,t.soul(d))},function(){b.map=function(T,D,A){_("state.map");var B,M=g(M=T||D)?M:null;return T=o(T=T||D)?T:null,M&&!T?(D=w(D)?D:b(),M[m]=M[m]||{},j(M,d,{o:M,s:D}),M):(A=A||g(D)?D:B,D=w(D)?D:b(),function(I,N,P,U){if(!T)return d.call({o:P,s:D},I,N),I;T.call(A||this||{},I,N,P,U),!(k(P,N)&&B===P[N])&&d.call({o:P,s:D},I,N)})};function d(T,D){m!==D&&b.ify(this.o,D,this.s)}}();var u=p.obj;u.as;var k=u.has,g=u.is,j=u.map,O=u.copy,s=p.num,w=s.is,v=p.fn,o=v.is,m=t._,y,i={};(function(){i.is=function(D,A,B,M){return _("graph.is"),!D||!g(D)||S(D)?!1:!j(D,d,{cb:A,fn:B,as:M})};function d(D,A){if(!D||A!==t.soul(D)||!t.is(D,this.fn,this.as))return!0;this.cb&&(T.n=D,T.as=this.as,this.cb.call(T.as,D,A,T))}function T(D){D&&t.is(T.n,D,T.as)}})(),function(){i.ify=function(M,I,N){_("graph.ify");var P={path:[],obj:M};return I?typeof I=="string"?I={soul:I}:typeof I=="function"&&(I.map=I):I={},typeof N=="string"&&(I.soul=I.soul||N,N=y),I.soul&&(P.link=c.link.ify(I.soul)),I.shell=(N||{}).shell,I.graph=I.graph||{},I.seen=I.seen||[],I.as=I.as||N,d(I,P),I.root=P.node,I.graph};function d(M,I){var N;return(N=B(M,I))?N:(I.env=M,I.soul=D,t.ify(I.obj,T,I)&&(I.link=I.link||c.link.ify(t.soul(I.node)),I.obj!==M.shell&&(M.graph[c.link.is(I.link)]=I.node)),I)}function T(M,I,N){var P=this,U=P.env,G,R;if(t._===I&&k(M,c.link._))return N._;if(G=A(M,I,N,P,U)){if(I||(P.node=P.node||N||{},k(M,t._)&&t.soul(M)&&(P.node._=O(M._)),P.node=t.soul.ify(P.node,c.link.is(P.link)),P.link=P.link||c.link.ify(t.soul(P.node))),(R=U.map)&&(R.call(U.as||{},M,I,N,P),k(N,I))){if(M=N[I],y===M){x(N,I);return}if(!(G=A(M,I,N,P,U)))return}if(!I)return P.node;if(G===!0)return M;if(R=d(U,{obj:M,path:P.path.concat(I)}),!!R.node)return R.link}}function D(M){var I=this,N=c.link.is(I.link),P=I.env.graph;I.link=I.link||c.link.ify(M),I.link[c.link._]=M,I.node&&I.node[t._]&&(I.node[t._][c.link._]=M),k(P,N)&&(P[M]=P[N],x(P,N))}function A(M,I,N,P,U){var G;if(c.is(M))return!0;if(g(M))return 1;if(G=U.invalid)return M=G.call(U.as||{},M,I,N),A(M,I,N,P,U);U.err="Invalid value at '"+P.path.concat(I).join(".")+"'!",p.list.is(M)&&(U.err+=" Use `.set(item)` instead of an Array.")}function B(M,I){for(var N=M.seen,P=N.length,U;P--;)if(U=N[P],I.obj===U.obj)return U;N.push(I)}}(),i.node=function(d){_("graph.node");var T=t.soul(d);if(T)return $({},T,d)},function(){i.to=function(T,D,A){if(_("graph.to"),!!T){var B={};return A=A||{seen:{}},j(T[D],d,{obj:B,graph:T,opt:A}),B}};function d(T,D){var A,B;if(t._===D){if(S(T,c.link._))return;this.obj[D]=O(T);return}if(!(A=c.link.is(T))){this.obj[D]=T;return}if(B=this.opt.seen[A]){this.obj[D]=B;return}this.obj[D]=this.opt.seen[A]=i.to(this.graph,A,this.opt)}}();var o=p.fn.is,u=p.obj,g=u.is,x=u.del,k=u.has,S=u.empty,$=u.put,j=u.map,O=u.copy,y;p.graph=p.graph||i}}()}(bt)),bt.exports}var oe=X();const ie=Jt(oe);var xt={},St;function ae(){if(St)return xt;St=1;var E=typeof window<"u"?window.Gun:X();return E.chain.promise=function(p){var _=this,p=p||function(r){return r};return new Promise(function(r,c){_.once(function(f,l){r({put:f,get:l,gun:this})})}).then(p)},E.chain.then=function(y){var _=this,p=new Promise((r,c)=>{_.once(function(f,l){r(f,l)})});return y?p.then(y):p},xt}ae();var Tt={exports:{}},_t;function ut(){return _t||(_t=1,function(){function E(){var c=function(f,l,h){if(c.unit=0,!h&&p!==l&&(c.last=""+f<c.last?c.last:""+f,delete(c.$||{})[r]),h=h||c.$||(c.$={}),!f&&Object.keys(h).length)return h;f=""+f;for(var t=0,e=f.length-1,a=f[t],n,b;!(n=h[a])&&t<e;)a+=f[++t];if(n)if(t==e){if(p===l)return p===(b=n[""])?n:(c.unit=1)&&b;n[""]=l}else return p!==l&&delete n[r],c(f.slice(++t),l,n||(n={}));else{if(!y(h,function(s,w){var v=0,m="";if((w||"").length)for(;w[v]==f[v];)m+=w[v++];if(m){if(p===l)return v<=e?void 0:((b||(b={}))[w.slice(v)]=s,s);var i={};if(i[w.slice(v)]=s,v=f.slice(v),v===""?i[""]=l:(i[v]={})[""]=l,h[m]=i,E.debug&&""+m=="undefined"){console.log(0,m);debugger}return delete h[w],!0}})){if(p===l)return;if((h[a]||(h[a]={}))[""]=l,E.debug&&""+a=="undefined"){console.log(1,a);debugger}}if(p===l)return b}};return c}if(E.map=function c(f,l,h,t){try{t=t||[];var e=typeof f=="function"?f.$||{}:f;//!opt && console.log("WHAT IS T?", JSON.stringify(t).length);
if(!e)return;if(typeof e=="string"){if(E.debug)throw["BUG:",f,l,h,t];return}var a=(e[r]||_).sort||(e[r]=function S(){return S.sort=Object.keys(e).sort(),S}()).sort,n;h=h===!0?{branch:!0}:h||{},(n=h.reverse)&&(a=a.slice(0).reverse());for(var b=h.start,s=h.end,w="ï¿¿",v=0,m=a.length;v<m;v++){var i=a[v],o=e[i],u,g,x;if(!(!o||i===""||r===i||i==="undefined")&&(g=t.slice(0),g.push(i),x=g.join(""),!(p!==b&&x<(b||"").slice(0,x.length))&&!(p!==s&&(s||w)<x))){if(n&&(u=c(o,l,h,g),p!==u))return u;if(p!==(u=o[""])){var k=1;if(p!==b&&x<(b||"")&&(k=0),p!==s&&x>(s||w)&&(k=0),k&&(u=l(u,x,i,t),p!==u))return u}else if(h.branch&&(u=l(p,x,i,t),p!==u))return u;if(t=g,!n&&(u=c(o,l,h,t),p!==u))return u;t.pop()}}}catch(S){console.error(S)}},typeof window<"u")window.Radix=E;else try{Tt.exports=E}catch{}var y=E.object=function(c,f,l){for(var h in c)if(c.hasOwnProperty(h)&&(l=f(c[h],h))!==p)return l},_={},p,r=""}()),Tt.exports}ut();var Dt={exports:{}},$t={exports:{}},At;function se(){return At||(At=1,function(E){(function(){var y={},_,p=setTimeout.turn||typeof setImmediate!=""+_&&setImmediate||setTimeout;y.parseAsync=function(c,f,l,h){if(typeof c!="string"){try{f(_,JSON.parse(c))}catch(a){f(a)}return}var t={i:0,text:c,done:f,l:c.length,up:[]};h=h||1024*32,e();function e(){for(var a=t.text,n=t.i,b=t.l,s=0,w=t.w,v,m;s++<h;){var i=a[n++];if(n>b){t.end=!0;break}if(w){for(n=a.indexOf('"',n-1),i=a[n],m=0;a[n-++m]=="\\";);m=!(m%2),v=v||m,i=='"'&&!m&&(w=_,m=t.s,t.a?(m=a.slice(t.sl,n),(v||1+m.indexOf("\\"))&&(m=JSON.parse('"'+m+'"')),t.at instanceof Array?t.at.push(t.s=m):(t.at||(t.end=s=h,m=_),(t.at||{})[t.s]=t.s=m),t.s=_):(t.s=a.slice(t.sl,n),(v||1+t.s.indexOf("\\"))&&(t.s=JSON.parse('"'+t.s+'"'))),t.a=v=_),++n}else switch(i){case'"':t.sl=n,w=!0;break;case":":t.ai=n,t.a=!0;break;case",":(t.a||t.at instanceof Array)&&(m=a.slice(t.ai,n-1))&&_!==(m=r(m))&&(t.at instanceof Array?t.at.push(m):t.at[t.s]=m),t.a=_,t.at instanceof Array&&(t.a=!0,t.ai=n);break;case"{":t.up.push(t.at||(t.at={})),t.at instanceof Array?t.at.push(t.at={}):_!==(m=t.s)&&(t.at[m]=t.at={}),t.a=_;break;case"}":t.a&&(m=a.slice(t.ai,n-1))&&_!==(m=r(m))&&(t.at instanceof Array?t.at.push(m):(t.at||(t.end=s=h,m=_),(t.at||{})[t.s]=m)),t.a=_,t.at=t.up.pop();break;case"[":_!==(m=t.s)?(t.up.push(t.at),t.at[m]=t.at=[]):t.at||t.up.push(t.at=[]),t.a=!0,t.ai=n;break;case"]":t.a&&(m=a.slice(t.ai,n-1))&&_!==(m=r(m))&&(t.at instanceof Array?t.at.push(m):t.at[t.s]=m),t.a=_,t.at=t.up.pop();break}}if(t.s=_,t.i=n,t.w=w,t.end){if(m=t.at,_===m)try{m=JSON.parse(c)}catch(o){return t.done(o)}t.done(_,m)}else p(e)}};function r(c){var f=parseFloat(c);if(!isNaN(f))return f;if(c=c.trim(),c=="true")return!0;if(c=="false")return!1;if(c=="null")return null}y.stringifyAsync=function(c,f,l,h,t){t=t||{},t.text=t.text||"",t.up=[t.at={d:c}],t.done=f,t.i=0;var e=0;a();function a(){var n=t.at,b=n.d,s="",w;switch(n.i&&n.i-n.j>0&&(s+=","),_!==(w=n.k)&&(s+=JSON.stringify(w)+":"),typeof b){case"boolean":s+=""+b;break;case"string":s+=JSON.stringify(b);break;case"number":s+=isNaN(b)?"null":b;break;case"object":if(!b){s+="null";break}if(b instanceof Array){s+="[",n={i:-1,as:b,up:n,j:0},n.l=b.length,t.up.push(t.at=n);break}if(typeof(b||"").toJSON!="function"){s+="{",n={i:-1,ok:Object.keys(b).sort(),as:b,up:n,j:0},n.l=n.ok.length,t.up.push(t.at=n);break}if(w=b.toJSON()){s+=w;break}case"function":if(n.as instanceof Array){s+="null";break}default:s="",n.j++}for(t.text+=s;1+n.i>=n.l;)t.text+=n.ok?"}":"]",n=t.at=n.up;if(++n.i<n.l){if((w=n.ok)?n.d=n.as[n.k=w[n.i]]:n.d=n.as[n.i],++e<9)return a();e=0,p(a);return}t.done(_,t.text)}},typeof window!=""+_&&(window.YSON=y);try{""+_!="object"&&(E.exports=y)}catch{}typeof JSON!=""+_&&(JSON.parseAsync=y.parseAsync,JSON.stringifyAsync=y.stringifyAsync)})()}($t)),$t.exports}var Ot,jt;function ce(){return jt||(jt=1,Ot=function(E){var y=ut();E.find("a",function(){var _=[];y.map(E.list,function(c,f){f.indexOf("%1B")+1&&c&&_.push([f,c])}),_.length&&console.log(`
! ! ! WARNING ! ! !
RAD v0.2020.x has detected OLD v0.2019.x data & automatically migrating. Automatic migration will be turned OFF in future versions! If you are just developing/testing, we recommend you reset your data. Please contact us if you have any concerns.
This message should only log once.`);var p,r;_.forEach(function(c){p=c[0],r=c[1],E.list(decodeURIComponent(p),r),E.list(p,0)}),p&&E.find.bad(p)})}),Ot}var Et;function zt(){return Et||(Et=1,function(){function E(p){p=p||{},p.log=p.log||console.log,p.file=String(p.file||"radata");var r=(E.has||(E.has={}))[p.file];if(r)return r;p.max=p.max||(p.memory?p.memory*999*999:3e8)*.3,p.until=p.until||p.wait||250,p.batch=p.batch||10*1e3,p.chunk=p.chunk||1024*1024*1,p.code=p.code||{},p.code.from=p.code.from||"!",p.jsonify=!0;function c(v){return encodeURIComponent(v).replace(/\*/g,"%2A")}function f(v){return w!==v&&(!v||typeof v!="object")}var l=""+w==typeof setImmediate?setTimeout:setImmediate,h=setTimeout.turn||l,w,t=_.object,e=0;if(!p.store)return p.log("ERROR: Radisk needs `opt.store` interface with `{get: fn, put: fn (, list: fn)}`!");if(!p.store.put)return p.log("ERROR: Radisk needs `store.put` interface with `(file, data, cb)`!");if(!p.store.get)return p.log("ERROR: Radisk needs `store.get` interface with `(file, cb)`!");p.store.list,""+w!=typeof ct&&se();var a=JSON.parseAsync||function(v,m,i){var o;try{m(o,JSON.parse(v,i))}catch(u){m(u)}},n=function(v,m,i,o,u){if(typeof m=="function"){var g=i||{};i=m,n.read(v,i,g,u||o);return}n.save(v,m,i,o,u)};n.save=function(v,m,i,o,u){var g={key:v},x,k;g.find=function(S){var $;if(g.file=S||(S=p.code.from),u&&(u=u[S]=u[S]||{}),u&&(u.sf=u.sf||+new Date),$=n.disk[S]){g.mix(w,$);return}n.parse(S,g.mix,w,u)},g.mix=function(S,$){if(u&&(u.sml=+new Date),u&&(u.sm=u.sm||+new Date),g.err=S||g.err){i(S);return}var j=g.file=($||"").file||g.file,O;if(!$&&j!==p.code.from){n.find.bad(j),n.save(v,m,i,o);return}if(($=n.disk[j]||(n.disk[j]=$||_())).file||($.file=j),p.compare&&(m=p.compare($(v),m,v,j),w===m)){i(S,-1);return}if((g.disk=$)(v,m),o&&((O=(O=$.tags||($.tags={}))[o]||(O[o]=n.tags[o]||(n.tags[o]={})))[j]||(O[j]=n.one[o]||(n.one[o]=i)),i=null),u&&(u.st=u.st||+new Date),$.Q){i&&$.Q.push(i);return}$.Q=i?[i]:[],$.to=setTimeout(g.write,p.until)},g.write=function(){u&&(u.sto=u.sto||+new Date);var S=x=g.file,$=g.disk;k=g.q=$.Q,g.tags=$.tags,delete $.Q,delete n.disk[S],delete $.tags,n.write(S,$,g.ack,w,u)},g.ack=function(S,$){u&&(u.sa=u.sa||+new Date),u&&(u.sal=k.length);var j,O;for(var C in n.tags)if(n.tags.hasOwnProperty(C)){var d=n.tags[C];if(!((O=n.disk[x])&&(O=O.tags)&&O[d])){j=d[x],delete d[x];var T;for(var D in d)if(d.hasOwnProperty(D)){T=!0;break}T||(delete n.tags[d],j&&j(S,$))}}!k&&(k="");for(var A=k.length,B=0,M=+new Date;B<A;B++)(j=k[B])&&j(S,$);console.STAT&&console.STAT(M,+new Date-M,"rad acks",c(g.file)),console.STAT&&console.STAT(M,k.length,"rad acks #",c(g.file))},i||(i=function(S,$){}),n.find(v,g.find)},n.disk={},n.one={},n.tags={};var b=0;n.write=function(v,m,i,o,u){if(!m){i("No radix!");return}o=typeof o=="object"?o:{force:o};var g=function(){},x,k;if(g.text="",g.file=v=m.file||(m.file=v),!v){i("What file?");return}if(g.write=function(){var S=m.raw=g.text;n.disk[v=m.file||g.file||v]=m;var $=+new Date;u&&(u.wd=$),n.find.add(v,function(j){if(u&&(u.wa=+new Date),j){i(j);return}p.store.put(c(v),S,function(O,C){u&&(u.wp=+new Date),console.STAT&&console.STAT($,e=+new Date-$,"wrote disk",JSON.stringify(v),++b,"total all writes."),i(O,C||1),m.Q||delete n.disk[v]})})},g.split=function(){var S=+new Date;u&&(u.wf=S),g.text="",g.count||(g.count=0,_.map(m,function(){g.count++})),u&&(u.wfc=g.count),g.limit=Math.ceil(g.count/2);var $=g.count;return g.count=0,u&&(u.wf1=+new Date),g.sub=_(),_.map(m,g.slice,{reverse:1}),u&&(u.wf2=+new Date),n.write(g.end,g.sub,g.both,o),u&&(u.wf3=+new Date),g.hub=_(),_.map(m,g.stop),u&&(u.wf4=+new Date),n.write(m.file,g.hub,g.both,o),u&&(u.wf5=+new Date),console.STAT&&console.STAT(S,+new Date-S,"rad split",c(m.file),$),!0},g.slice=function(S,$){if(g.sub(g.end=$,S),g.limit<=++g.count)return!0},g.stop=function(S,$){if($>=g.end)return!0;g.hub($,S)},g.both=function(S,$){if(u&&(u.wfd=+new Date),k){i(S||k);return}if(x){i(S,$);return}x=!0,k=S},g.each=function(S,$,j,O){if(w!==S&&g.count++,p.max<=(S||"").length)return i("Data too big!"),!0;var C=E.encode(O.length)+"#"+E.encode(j)+(w===S?"":":"+E.encode(S))+`
`;if(p.chunk<g.text.length+C.length&&1<g.count&&!o.force)return g.split();g.text+=C},p.jsonify){n.write.jsonify(g,m,i,o,u);return}_.map(m,g.each,!0)||g.write()},n.write.jsonify=function(v,m,i,o,u){var g,x=+new Date;u&&(u.w=x);try{g=JSON.stringify(m.$)}catch{i("Cannot radisk!");return}if(u&&(u.ws=+new Date),console.STAT&&console.STAT(x,+new Date-x,"rad stringified JSON"),p.chunk<g.length&&!o.force){var k=0;if(_.map(m,function(){if(k++)return!0}),k>1)return v.split()}v.text=g,v.write()},n.range=function(v,m){if(!(!v||!m)){if(w===m.start&&w===m.end||f(v))return v;var i=_();return _.map(v,function(o,u){i(u,o)},m),i("")}},function(){n.read=function(v,m,i,o){i=i||{};var u={key:v};u.find=function(g){var x;if(u.file=g||(g=p.code.from),o&&(o=o[g]=o[g]||{}),o&&(o.rf=o.rf||+new Date),x=n.disk[u.file=g]){u.check(w,x);return}n.parse(g,u.check,w,o)},u.get=function(g,x,k){if(o&&(o.rgl=+new Date),o&&(o.rg=o.rg||+new Date),u.err=g||u.err){m(g);return}var S=u.file=(x||"").file||u.file;if(!x&&S!==p.code.from){n.find.bad(S),n.read(v,m,i);return}if(x=n.disk[S]||(n.disk[S]=x),!x){m(S===p.code.from?w:"No file!");return}x.file||(x.file=S);var $=n.range(x(v),i);if(o&&(o.rr=+new Date),i.unit=x.unit,i.chunks=(i.chunks||0)+1,i.parsed=(i.parsed||0)+((k||"").parsed||i.chunks*p.chunk),i.more=1,i.next=w,_.map(n.list,function(C,d){if(!(!C||S===d))return i.next=d,1},i.reverse?{reverse:1,end:S}:{start:S}),o&&(o.rl=+new Date),i.next||(i.more=0),i.next&&(!i.reverse&&(v<i.next&&i.next.indexOf(v)!=0||w!==i.end&&(i.end||"ï¿¿")<i.next)&&(i.more=0),i.reverse&&(v>i.next&&v.indexOf(i.next)!=0||w!==i.start&&(i.start||"")>i.next&&S<=i.start)&&(i.more=0)),!i.more){m(u.err,$,i);return}if($&&m(u.err,$,i),!(i.parsed>=i.limit)){var j=+new Date;o&&(o.rm=j);var O=i.next;l(function(){console.STAT&&console.STAT(j,+new Date-j,"rad more"),n.parse(O,u.check)},0)}},u.check=function(g,x,k){if(u.get(g,x,k),!(!x||x.check)){x.check=1;var S=+new Date;(k||(k={})).file||(k.file=u.file),_.map(x,function($,j){n.find(j,function(O){if((O||(O=p.code.from))!==k.file){var C=(""+Math.random()).slice(-3);h(function(){n.save(j,$,function d(T,D){if(T){n.save(j,$,d);return}console.STAT&&console.STAT("MISLOCATED DATA CORRECTED",C,c(j),c(k.file),c(O))})},0)}})}),console.STAT&&console.STAT(S,+new Date-S,"rad check")}},n.find(v||(i.reverse?i.end||"":i.start||""),u.find)}}(),function(){var v=0,m={},i="";n.parse=function(o,u,g,x){var k;if(!o)return u();if(k=m[o]){k.push(u);return}k=m[o]=[u];var S=function(){},$={file:o};(S.disk=_()).file=o,S.read=function(O,C){if(x&&(x.rpg=+new Date),console.STAT&&console.STAT(j,+new Date-j,"read disk",JSON.stringify(o),++v,"total all parses."),(S.err=O)||(S.not=!C)){delete m[o],S.map(k,S.ack);return}if(typeof C!="string"){try{p.max<=C.length?S.err="Chunk too big!":C=C.toString()}catch(d){S.err=d}if(S.err){delete m[o],S.map(k,S.ack);return}}if($.parsed=C.length,x&&(x.rpl=$.parsed),x&&(x.rpa=k.length),j=+new Date,!(p.jsonify||C[0]==="{")){S.radec(O,C);return}a(C,function(d,T){if(!d){delete m[o],S.disk.$=T,console.STAT&&(e=+new Date-j)>9&&console.STAT(j,e,"rad parsed JSON"),x&&(x.rpd=+new Date),S.map(k,S.ack);return}if(C[0]==="{"){delete m[o],S.err="JSON error!",S.map(k,S.ack);return}S.radec(d,C)})},S.map=function(){if(!(!k||!k.length)){for(var O=+new Date,C=S.err,d=S.not?w:S.disk,T=0,D;T<9&&(D=k[T++]);)D(C,d,$);console.STAT&&console.STAT(O,+new Date-O,"rad packs",c(o)),console.STAT&&console.STAT(O,T,"rad packs #",c(o)),(k=k.slice(T)).length&&h(S.map,0)}},S.ack=function(O){if(O){if(S.err||S.not){O(S.err,w,$);return}O(w,S.disk,$)}},S.radec=function(O,C){delete m[o],j=+new Date;var d=S.split(C),T=[],D,A,B;if(!d||d[1]!==0){S.err="File '"+o+"' does not have root radix! ",S.map(k,S.ack);return}for(;d;)A=B=w,D=d[1],d=S.split(d[2])||"",d[0]=="#"&&(A=d[1],T=T.slice(0,D),D<=T.length&&T.push(A)),d=S.split(d[2])||"",d[0]!=`
`&&((d[0]=="="||d[0]==":")&&(B=d[1]),w!==A&&w!==B&&S.disk(T.join(""),B),d=S.split(d[2]));console.STAT&&console.STAT(j,+new Date-j,"parsed RAD"),S.map(k,S.ack)},S.split=function(O){if(O){var C=[],d={},T=-1,D="";if(T=O.indexOf(i),!!O[T])return D=O.slice(0,T),C[0]=D,C[1]=E.decode(O.slice(T),d),C[2]=O.slice(T+d.i),C}},n.disk&&(g||(g=(n.disk[o]||"").raw));var j=+new Date;if(x&&(x.rp=j),g)return h(function(){S.read(w,g)},0);p.store.get(c(o),S.read)}}(),function(){var v,m="",i;n.find=function(g,x){if(!v){if(i){i.push([g,x]);return}i=[[g,x]],n.parse(m,o);return}_.map(n.list=v,function(k,S){if(k)return x(S)||!0},{reverse:1,end:g})||x(p.code.from)},n.find.add=function(g,x){var k=v(g);if(k||g===m){x(w,1);return}v(g,1),x.found=(x.found||0)+1,n.write(m,v,function(S,$){if(S){x(S);return}x.found=(x.found||0)-1,x.found===0&&x(w,1)},!0)},n.find.bad=function(g,x){v(g,0),n.write(m,v,x||s)};function o(g,x){if(g){p.log("list",g),setTimeout(function(){n.parse(m,o)},1e3);return}if(x){u(x);return}if(v=v||x||_(),!p.store.list){u(v);return}p.store.list(function(k){if(!k){u(v);return}n.find.add(k,s)})}function u(g,x){v=v||g,v.file=m,x=i,i=null,t(x,function(k){n.find(k[0],k[1])})}}();try{!y.window&&ce()(n)}catch{}var s=function(){},w;return E.has[p.file]=n,n}if(function(){var p="";E.encode=function(r,c,f){f=f||p;var l=f,h;if(typeof r=="string"){for(var t=r.indexOf(f);t!=-1;)l+=f,t=r.indexOf(f,t+1);return l+'"'+r+f}else{if(r&&r["#"]&&Object.keys(r).length==1)return l+"#"+h+l;if(typeof r=="number")return l+"+"+(r||0)+l;if(r===null)return l+" "+l;if(r===!0)return l+"+"+l;if(r===!1)return l+"-"+l}},E.decode=function(r,c,f){f=f||p;var l="",h=-1,t=0,e,a;if(f===r[0]){for(;f===r[++h];)++t;for(a=r[e=t]||!0;--t>=0;)h=r.indexOf(f,h+1);if(h==-1&&(h=r.length),l=r.slice(e+1,h),c&&(c.i=h+1),a==='"')return l;if(a==="#")return{"#":l};if(a==="+")return l.length===0?!0:parseFloat(l);if(a===" ")return null;if(a==="-")return!1}}}(),typeof window<"u"){var y=window.Gun,_=window.Radix;window.Radisk=E}else{var y=X(),_=ut();try{Dt.exports=E}catch{}}E.Radix=_}()),Dt.exports}zt();var Ct={},Bt;function ue(){if(Bt)return Ct;Bt=1;var E=typeof window<"u"?window.Gun:X();return E.on("create",function(y){E.TESTING&&(y.opt.file="radatatest"),this.to.next(y);var _=y.opt,p;if(!(_.rad===!1||_.radisk===!1)&&!(p+""!=typeof process&&""+(re||"").RAD=="false")){var r=E.window&&E.window.Radisk||zt(),c=r.Radix,f=r(_),l="\x1B",h=0;y.on("put",function(e){if(this.to.next(e),!(e._||"").rad){var a=e["#"],n=e.put,b=n["#"],s=n["."],w=n[":"],v=n[">"],m=(e._||"").DBG;m&&(m.sp=m.sp||+new Date);var i=(e._||"").RPS||((e._||"").RPS=+new Date);f(b+l+s,{":":w,">":v},function(o,u){if(m&&(m.spd=m.spd||+new Date),console.STAT&&console.STAT(i,+new Date-i,"put"),o){y.on("in",{"@":a,err:o,DBG:m});return}y.on("in",{"@":a,ok:u,DBG:m})},!1,m&&(m.r=m.r||{})),m&&(m.sps=m.sps||+new Date)}}),y.on("get",function(e){this.to.next(e);var a=e._||"",n=a.DBG=e.DBG;n&&(n.sg=+new Date);var b=e["#"],s=e.get,w=e.get["#"],v=e.get["."]||"",m={},i,o,u,g;if(typeof w=="string"?o=w:w&&(p!==(u=w["*"])&&(m.limit=g=1),p!==w[">"]&&(m.start=w[">"]),p!==w["<"]&&(m.end=w["<"]),o=g?""+u:u||w["="],g=null),o&&!m.limit&&(typeof v=="string"?o=o+l+(m.atom=v):v&&(p!==v[">"]&&(m.start=v[">"],m.limit=1),p!==v["<"]&&(m.end=v["<"],m.limit=1),p!==(u=v["*"])&&(m.limit=g=1),o&&(o=o+l+(g?""+(u||""):u||(m.atom=v["="]||""))))),((u=s["%"])||m.limit)&&(m.limit=u<=(m.pack||1e3*100)?u:1),(v["-"]||(w||{})["-"]||s["-"])&&(m.reverse=!0),(u=(y.next||"")[w])&&u.put){if(m.atom){if(u=(u.next||"")[m.atom],u&&u.root&&u.root.graph&&u.root.graph[w]&&u.root.graph[w][m.atom])return}else if(u&&u.rad)return}var x=E.state(),k=+new Date,S=0;n&&(n.sgm=k),f(o||"",function(j,O,C){n&&(n.sgr=+new Date),n&&(n.sgi=C);try{_.store.stats.get.time[t%50]=+new Date-k,++t,_.store.stats.get.count++,j&&(_.store.stats.get.err=j)}catch{}console.STAT&&console.STAT(k,+new Date-k,"got",JSON.stringify(o)),k=+new Date,C=C||"";var d,T;if(C.unit&&O&&p!==(d=O[":"])&&p!==(T=O[">"])){var D=o.split(l),A=D[0],B=D[1];(i=i||{})[A]=E.state.ify(i[A],B,T,d,A),y.$.get(A).get(B)._.rad=x}else O&&(typeof O!="string"&&(m.atom?O=p:c.map(O,$,m)),!i&&O&&$(O,""),!m.atom&&!v&typeof w=="string"&&!m.limit&&!m.more&&(y.$.get(w)._.rad=x));n&&(n.sgp=+new Date),console.STAT&&(h=+new Date-k)>9&&(console.STAT(k,h,"got prep time"),console.STAT(k,S,"got prep #")),S=0,k=+new Date;var M=function(){};M.faith=!0,M.rad=s,y.on("in",{"@":b,put:i,"%":C.more?1:p,err:j||p,_:M,DBG:n}),console.STAT&&(h=+new Date-k)>9&&console.STAT(k,h,"got emit",Object.keys(i||{}).length),i=p},m,n&&(n.r=n.r||{})),n&&(n.sgd=+new Date),console.STAT&&(h=+new Date-k)>9&&console.STAT(k,h,"get call");function $(j,O,C,d){if(S++,!!j){O=(o+O).split(l);var T=O.slice(0,1)[0];if(O=O.slice(-1)[0],m.limit&&m.limit<=m.count)return!0;var D,A,B=T,M=O;if(typeof j!="string"){D=j[":"],A=j[">"],(i=i||{})[B]=E.state.ify(i[B],M,A,D,B),m.count=(m.count||0)+((D||"").length||9);return}m.count=(m.count||0)+j.length;var I=j.lastIndexOf(">"),N=r.decode(j.slice(I+1),null,l);j=r.decode(j.slice(0,I),null,l),(i=i||{})[T]=E.state.ify(i[T],O,N,j,T)}}}),E.valid,(_.store||{}).stats={get:{time:{},count:0},put:{time:{},count:0}};var t=0}}),Ct}ue();var Mt={exports:{}},It;function fe(){return It||(It=1,function(){function E(_){_=_||{},_.file=String(_.file||"radata");var p=E[_.file],r=null,c;if(p)return console.log("Warning: reusing same IndexedDB store and options as 1st."),E[_.file];p=E[_.file]=function(){};try{_.indexedDB=_.indexedDB||E.indexedDB||indexedDB}catch{}try{if(!_.indexedDB||location.protocol=="file:"){var f=p.d||(p.d={});return p.put=function(l,h,t){f[l]=h,setTimeout(function(){t(null,1)},250)},p.get=function(l,h){setTimeout(function(){h(null,f[l]||c)},5)},console.log("Warning: No indexedDB exists to persist data to!"),p}}catch{}return p.start=function(){var l=indexedDB.open(_.file,1);l.onupgradeneeded=function(h){h.target.result.createObjectStore(_.file)},l.onsuccess=function(){r=l.result},l.onerror=function(h){console.log(h||1)}},p.start(),p.put=function(l,h,t){if(!r){setTimeout(function(){p.put(l,h,t)},1);return}var e=r.transaction([_.file],"readwrite"),a=e.objectStore(_.file),n=a.put(h,""+l);n.onsuccess=a.onsuccess=e.onsuccess=function(){t(null,1)},n.onabort=a.onabort=e.onabort=function(b){t(b||"put.tx.abort")},n.onerror=a.onerror=e.onerror=function(b){t(b||"put.tx.error")}},p.get=function(l,h){if(!r){setTimeout(function(){p.get(l,h)},9);return}var t=r.transaction([_.file],"readonly"),e=t.objectStore(_.file),a=e.get(""+l);a.onsuccess=function(){h(null,a.result)},a.onabort=function(n){h(n||4)},a.onerror=function(n){h(n||5)}},setInterval(function(){r&&r.close(),r=null,p.start()},1e3*15),p}if(typeof window<"u")(E.window=window).RindexedDB=E,E.indexedDB=window.indexedDB;else try{Mt.exports=E}catch{}try{var y=E.window.Gun||X();y.on("create",function(_){this.to.next(_),_.opt.store=_.opt.store||E(_.opt)})}catch{}}()),Mt.exports}fe();var le={},Nt;function pe(){return Nt||(Nt=1,function(){var E=typeof window<"u"?window.Gun:X();E.on("opt",function(y){this.to.next(y);var _=y.opt;if(y.once||!E.Mesh||_.RTCPeerConnection===!1)return;var p;typeof window<"u"&&(p=window),typeof tt<"u"&&(p=tt),p=p||{};var r=_.RTCPeerConnection||p.RTCPeerConnection||p.webkitRTCPeerConnection||p.mozRTCPeerConnection,c=_.RTCSessionDescription||p.RTCSessionDescription||p.webkitRTCSessionDescription||p.mozRTCSessionDescription,f=_.RTCIceCandidate||p.RTCIceCandidate||p.webkitRTCIceCandidate||p.mozRTCIceCandidate;if(!r||!c||!f)return;_.RTCPeerConnection=r,_.RTCSessionDescription=c,_.RTCIceCandidate=f,_.rtc=_.rtc||{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.sipgate.net:3478"}]},_.rtc.dataChannel=_.rtc.dataChannel||{ordered:!1,maxRetransmits:2},_.rtc.sdp=_.rtc.sdp||{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},_.rtc.max=_.rtc.max||55,_.rtc.room=_.rtc.room||E.window&&(location.hash.slice(1)||location.pathname.slice(1)),_.announce=function(t){_.rtc.start=+new Date,y.$.get("/RTC/"+_.rtc.room+"<?99").get("+").put(_.pid,function(e){!e.ok||!e.ok.rtc||h(e)},{acks:_.rtc.max}).on(function(e,a,n){e===_.pid||_.rtc.start>n.put[">"]||h({"#":""+n["#"],ok:{rtc:{id:e}}})})};var l=_.mesh=_.mesh||E.Mesh(y);y.on("create",function(t){this.to.next(t),setTimeout(_.announce,1)});function h(t){if(this&&this.off&&this.off(),!!t.ok){var e=t.ok.rtc,a,n;if(!(!e||!e.id||e.id===_.pid)){if(n=e.answer)return!(a=_.peers[e.id]||h[e.id])||a.remoteSet?void 0:(n.sdp=n.sdp.replace(/\\r\\n/g,`\r
`),a.setRemoteDescription(a.remoteSet=new _.RTCSessionDescription(n)));if(n=e.candidate)return a=_.peers[e.id]||h[e.id]||h({ok:{rtc:{id:e.id}}}),a.addIceCandidate(new _.RTCIceCandidate(n));if(!h[e.id]){(a=new _.RTCPeerConnection(_.rtc)).id=e.id;var b=a.wire=a.createDataChannel("dc",_.rtc.dataChannel);if(h[e.id]=a,b.to=setTimeout(function(){delete h[e.id]},1e3*60),b.onclose=function(){l.bye(a)},b.onerror=function(s){},b.onopen=function(s){delete h[e.id],l.hi(a)},b.onmessage=function(s){s&&l.hear(s.data||s,a)},a.onicecandidate=function(s){s.candidate&&y.on("out",{"@":t["#"],ok:{rtc:{candidate:s.candidate,id:_.pid}}})},a.ondatachannel=function(s){var w=s.channel;w.onmessage=b.onmessage,w.onopen=b.onopen,w.onclose=b.onclose},n=e.offer){e.offer.sdp=e.offer.sdp.replace(/\\r\\n/g,`\r
`),a.setRemoteDescription(new _.RTCSessionDescription(n)),a.createAnswer(function(s){a.setLocalDescription(s),y.on("out",{"@":t["#"],ok:{rtc:{answer:s,id:_.pid}}})},function(){},_.rtc.sdp);return}return a.createOffer(function(s){a.setLocalDescription(s),y.on("out",{"@":t["#"],"#":y.ask(h),ok:{rtc:{offer:s,id:_.pid}}})},function(){},_.rtc.sdp),a}}}}})}()),le}pe();var Pt={exports:{}},Ut;function de(){return Ut||(Ut=1,function(E){(function(){function y(p,r){return r?ct(p):p.slice?y[c(p)]:function(f,l){p(f={exports:{}}),y[c(l)]=f.exports};function c(f){return f.split("/").slice(-1).toString().replace(".js","")}}var _=E;y(function(p){typeof self<"u"&&(p.window=self),typeof window<"u"&&(p.window=window);var r=p.window||p,c,f=r.SEA||{};(f.window=p.window)&&(f.window.SEA=f);try{c+""!=typeof _&&(_.exports=f)}catch{}p.exports=f})(y,"./root"),y(function(p){var r=y("./root");try{r.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(y,"./https"),y(function(p){var r;if(r+""==typeof btoa){if(r+""==typeof Buffer)try{tt.Buffer=y("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}tt.btoa=function(c){return Buffer.from(c,"binary").toString("base64")},tt.atob=function(c){return Buffer.from(c,"base64").toString("binary")}}})(y,"./base64"),y(function(p){y("./base64");function r(){}Object.assign(r,{from:Array.from}),r.prototype=Object.create(Array.prototype),r.prototype.toString=function(c,f,l){c=c||"utf8",f=f||0;const h=this.length;if(c==="hex"){const t=new Uint8Array(this);return[...Array((l&&l+1||h)-f).keys()].map(e=>t[e+f].toString(16).padStart(2,"0")).join("")}if(c==="utf8")return Array.from({length:(l||h)-f},(t,e)=>String.fromCharCode(this[e+f])).join("");if(c==="base64")return btoa(this)},p.exports=r})(y,"./array"),y(function(p){y("./base64");var r=y("./array");function c(...f){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),c.from(...f)}c.prototype=Object.create(Array.prototype),Object.assign(c,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const f=arguments[0];let l;if(typeof f=="string"){const h=arguments[1]||"utf8";if(h==="hex"){const t=f.match(/([\da-fA-F]{2})/g).map(e=>parseInt(e,16));if(!t||!t.length)throw new TypeError("Invalid first argument for type 'hex'.");l=r.from(t)}else if(h==="utf8"||h==="binary"){const t=f.length,e=new Uint16Array(t);Array.from({length:t},(a,n)=>e[n]=f.charCodeAt(n)),l=r.from(e)}else if(h==="base64"){const t=atob(f),e=t.length,a=new Uint8Array(e);Array.from({length:e},(n,b)=>a[b]=t.charCodeAt(b)),l=r.from(a)}else h==="binary"?l=r.from(f):console.info("SafeBuffer.from unknown encoding: "+h);return l}if(f.byteLength,f.byteLength?f.byteLength:f.length){let h;return f instanceof ArrayBuffer&&(h=new Uint8Array(f)),r.from(h||f)}},alloc(f,l=0){return r.from(new Uint8Array(Array.from({length:f},()=>l)))},allocUnsafe(f){return r.from(new Uint8Array(Array.from({length:f})))},concat(f){if(!Array.isArray(f))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return r.from(f.reduce((l,h)=>l.concat(Array.from(h)),[]))}}),c.prototype.from=c.from,c.prototype.toString=r.prototype.toString,p.exports=c})(y,"./buffer"),y(function(p){const r=y("./root"),c={Buffer:y("./buffer")};var f={},l;if(JSON.parseAsync=JSON.parseAsync||function(t,e,a){var n;try{e(n,JSON.parse(t,a))}catch(b){e(b)}},JSON.stringifyAsync=JSON.stringifyAsync||function(t,e,a,n){var b;try{e(b,JSON.stringify(t,a,n))}catch(s){e(s)}},c.parse=function(t,e){return new Promise(function(a,n){JSON.parseAsync(t,function(b,s){b?n(b):a(s)},e)})},c.stringify=function(t,e,a){return new Promise(function(n,b){JSON.stringifyAsync(t,function(s,w){s?b(s):n(w)},e,a)})},r.window&&(c.crypto=r.window.crypto||r.window.msCrypto,c.subtle=(c.crypto||f).subtle||(c.crypto||f).webkitSubtle,c.TextEncoder=r.window.TextEncoder,c.TextDecoder=r.window.TextDecoder,c.random=t=>c.Buffer.from(c.crypto.getRandomValues(new Uint8Array(c.Buffer.alloc(t))))),!c.TextDecoder){const{TextEncoder:t,TextDecoder:e}=y((l+""==typeof _?".":"")+"./lib/text-encoding",1);c.TextDecoder=e,c.TextEncoder=t}if(!c.crypto)try{var h=y("crypto",1);Object.assign(c,{crypto:h,random:e=>c.Buffer.from(h.randomBytes(e))});const{Crypto:t}=y("@peculiar/webcrypto",1);c.ossl=c.subtle=new t({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}p.exports=c})(y,"./shim"),y(function(p){var r=y("./root"),c=y("./shim"),f={};f.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},f.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},f.ecdh={name:"ECDH",namedCurve:"P-256"},f.jwk=function(l,h){l=l.split(".");var t=l[0],e=l[1],a={kty:"EC",crv:"P-256",x:t,y:e,ext:!0};return a.key_ops=h?["sign"]:["verify"],h&&(a.d=h),a},f.keyToJwk=function(l){return{kty:"oct",k:l.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},f.recall={validity:12*60*60,hook:function(l){return l}},f.check=function(l){return typeof l=="string"&&l.slice(0,4)==="SEA{"},f.parse=async function(l){try{var h=typeof l=="string";return h&&l.slice(0,4)==="SEA{"&&(l=l.slice(3)),h?await c.parse(l):l}catch{}return l},r.opt=f,p.exports=f})(y,"./settings"),y(function(p){var r=y("./shim");p.exports=async function(c,f){var l=typeof c=="string"?c:await r.stringify(c),h=await r.subtle.digest({name:f||"SHA-256"},new r.TextEncoder().encode(l));return r.Buffer.from(h)}})(y,"./sha256"),y(function(p){const r=y("./shim"),c=r.subtle,f=r.ossl?r.ossl:c,l=h=>f.digest({name:"SHA-1"},new ArrayBuffer(h));p.exports=l})(y,"./sha1"),y(function(p){var r=y("./root"),c=y("./shim"),f=y("./settings"),l=y("./sha256"),h;r.work=r.work||(async(t,e,a,n)=>{try{var b=(e||{}).epub||e;if(n=n||{},b instanceof Function&&(a=b,b=h),t=typeof t=="string"?t:await c.stringify(t),(n.name||"").toLowerCase().slice(0,3)==="sha"){var s=c.Buffer.from(await l(t,n.name),"binary").toString(n.encode||"base64");if(a)try{a(s)}catch(i){console.log(i)}return s}b=b||c.random(9);var w=await(c.ossl||c.subtle).importKey("raw",new c.TextEncoder().encode(t),{name:n.name||"PBKDF2"},!1,["deriveBits"]),v=await(c.ossl||c.subtle).deriveBits({name:n.name||"PBKDF2",iterations:n.iterations||f.pbkdf2.iter,salt:new c.TextEncoder().encode(n.salt||b),hash:n.hash||f.pbkdf2.hash},w,n.length||f.pbkdf2.ks*8);t=c.random(t.length);var m=c.Buffer.from(v,"binary").toString(n.encode||"base64");if(a)try{a(m)}catch(i){console.log(i)}return m}catch(i){if(console.log(i),r.err=i,r.throw)throw i;a&&a();return}}),p.exports=r.work})(y,"./work"),y(function(p){var r=y("./root"),c=y("./shim");y("./settings"),r.name=r.name||(async(f,l)=>{try{if(f)try{f()}catch(h){console.log(h)}return}catch(h){if(console.log(h),r.err=h,r.throw)throw h;f&&f();return}}),r.pair=r.pair||(async(f,l)=>{try{var h=c.ossl||c.subtle,t=await c.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async n=>{var b={};b.priv=(await c.subtle.exportKey("jwk",n.privateKey)).d;var s=await c.subtle.exportKey("jwk",n.publicKey);return b.pub=s.x+"."+s.y,b});try{var e=await h.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async n=>{var b={};b.epriv=(await h.exportKey("jwk",n.privateKey)).d;var s=await h.exportKey("jwk",n.publicKey);return b.epub=s.x+"."+s.y,b})}catch(n){if(r.window)throw n;if(n=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw n}e=e||{};var a={pub:t.pub,priv:t.priv,epub:e.epub,epriv:e.epriv};if(f)try{f(a)}catch(n){console.log(n)}return a}catch(n){if(console.log(n),r.err=n,r.throw)throw n;f&&f();return}}),p.exports=r.pair})(y,"./pair"),y(function(p){var r=y("./root"),c=y("./shim"),f=y("./settings"),l=y("./sha256"),h;r.sign=r.sign||(async(t,e,a,n)=>{try{if(n=n||{},!(e||n).priv){if(!r.I)throw"No signing key.";e=await r.I(null,{what:t,how:"sign",why:n.why})}if(h===t)throw"`undefined` not allowed.";var b=await f.parse(t),s=n.check=n.check||b;if(r.verify&&(r.opt.check(s)||s&&s.s&&s.m)&&h!==await r.verify(s,e)){var u=await f.parse(s);if(n.raw||(u="SEA"+await c.stringify(u)),a)try{a(u)}catch(x){console.log(x)}return u}var w=e.pub,v=e.priv,m=f.jwk(w,v),i=await l(b),o=await(c.ossl||c.subtle).importKey("jwk",m,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(g=>(c.ossl||c.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},g,new Uint8Array(i))),u={m:b,s:c.Buffer.from(o,"binary").toString(n.encode||"base64")};if(n.raw||(u="SEA"+await c.stringify(u)),a)try{a(u)}catch(g){console.log(g)}return u}catch(g){if(console.log(g),r.err=g,r.throw)throw g;a&&a();return}}),p.exports=r.sign})(y,"./sign"),y(function(p){var r=y("./root"),c=y("./shim"),f=y("./settings"),l=y("./sha256"),h;r.verify=r.verify||(async(a,n,b,s)=>{try{var w=await f.parse(a);if(n===!1){var v=await f.parse(w.m);if(b)try{b(v)}catch($){console.log($)}return v}s=s||{};var m=n.pub||n,i=r.opt.slow_leak?await r.opt.slow_leak(m):await(c.ossl||c.subtle).importKey("jwk",f.jwk(m),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),o=await l(w.m),u,g,x,k;try{if(u=c.Buffer.from(w.s,s.encode||"base64"),g=new Uint8Array(u),x=await(c.ossl||c.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},i,g,new Uint8Array(o)),!x)throw"Signature did not match."}catch{if(r.opt.fallback)return await r.opt.fall_verify(a,n,b,s)}var S=x?await f.parse(w.m):h;if(b)try{b(S)}catch($){console.log($)}return S}catch($){if(console.log($),r.err=$,r.throw)throw $;b&&b();return}}),p.exports=r.verify;var t={};r.opt.slow_leak=a=>{if(t[a])return t[a];var n=f.jwk(a);return t[a]=(c.ossl||c.subtle).importKey("jwk",n,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),t[a]};var e=r.opt;r.opt.fall_verify=async function(a,n,b,s,w){if(w===r.opt.fallback)throw"Signature did not match";w=w||1;var v=a||"";a=r.opt.unpack(a)||a;var m=await f.parse(a),i=n.pub||n,o=await r.opt.slow_leak(i),u=w<=r.opt.fallback?c.Buffer.from(await c.subtle.digest({name:"SHA-256"},new c.TextEncoder().encode(await f.parse(m.m)))):await l(m.m),g,x,k;try{if(g=c.Buffer.from(m.s,s.encode||"base64"),x=new Uint8Array(g),k=await(c.ossl||c.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},o,x,new Uint8Array(u)),!k)throw"Signature did not match."}catch{try{g=c.Buffer.from(m.s,"utf8"),x=new Uint8Array(g),k=await(c.ossl||c.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},o,x,new Uint8Array(u))}catch{if(!k)throw"Signature did not match."}}var S=k?await f.parse(m.m):h;if(e.fall_soul=v["#"],e.fall_key=v["."],e.fall_val=a,e.fall_state=v[">"],b)try{b(S)}catch($){console.log($)}return S},r.opt.fallback=2})(y,"./verify"),y(function(p){var r=y("./shim"),c=y("./settings"),f=y("./sha256");const l=async(h,t,e)=>{const a=h+(t||r.random(8)).toString("utf8"),n=r.Buffer.from(await f(a),"binary"),b=c.keyToJwk(n);return await r.subtle.importKey("jwk",b,{name:"AES-GCM"},!1,["encrypt","decrypt"])};p.exports=l})(y,"./aeskey"),y(function(p){var r=y("./root"),c=y("./shim");y("./settings");var f=y("./aeskey"),l;r.encrypt=r.encrypt||(async(h,t,e,a)=>{try{a=a||{};var n=(t||a).epriv||t;if(l===h)throw"`undefined` not allowed.";if(!n){if(!r.I)throw"No encryption key.";t=await r.I(null,{what:h,how:"encrypt",why:a.why}),n=t.epriv||t}var b=typeof h=="string"?h:await c.stringify(h),s={s:c.random(9),iv:c.random(15)},w=await f(n,s.s,a).then(m=>c.subtle.encrypt({name:a.name||"AES-GCM",iv:new Uint8Array(s.iv)},m,new c.TextEncoder().encode(b))),v={ct:c.Buffer.from(w,"binary").toString(a.encode||"base64"),iv:s.iv.toString(a.encode||"base64"),s:s.s.toString(a.encode||"base64")};if(a.raw||(v="SEA"+await c.stringify(v)),e)try{e(v)}catch(m){console.log(m)}return v}catch(m){if(console.log(m),r.err=m,r.throw)throw m;e&&e();return}}),p.exports=r.encrypt})(y,"./encrypt"),y(function(p){var r=y("./root"),c=y("./shim"),f=y("./settings"),l=y("./aeskey");r.decrypt=r.decrypt||(async(h,t,e,a)=>{try{a=a||{};var n=(t||a).epriv||t;if(!n){if(!r.I)throw"No decryption key.";t=await r.I(null,{what:h,how:"decrypt",why:a.why}),n=t.epriv||t}var b=await f.parse(h),s,w,v;try{s=c.Buffer.from(b.s,a.encode||"base64"),w=c.Buffer.from(b.iv,a.encode||"base64"),v=c.Buffer.from(b.ct,a.encode||"base64");var m=await l(n,s,a).then(o=>c.subtle.decrypt({name:a.name||"AES-GCM",iv:new Uint8Array(w),tagLength:128},o,new Uint8Array(v)))}catch{if(a.encode==="utf8")throw"Could not decrypt";if(r.opt.fallback)return a.encode="utf8",await r.decrypt(h,t,e,a)}var i=await f.parse(new c.TextDecoder("utf8").decode(m));if(e)try{e(i)}catch(o){console.log(o)}return i}catch(o){if(console.log(o),r.err=o,r.throw)throw o;e&&e();return}}),p.exports=r.decrypt})(y,"./decrypt"),y(function(p){var r=y("./root"),c=y("./shim");y("./settings"),r.secret=r.secret||(async(l,h,t,e)=>{try{if(e=e||{},!h||!h.epriv||!h.epub){if(!r.I)throw"No secret mix.";h=await r.I(null,{what:l,how:"secret",why:e.why})}var a=l.epub||l,n=h.epub,b=h.epriv,s=c.ossl||c.subtle,w=f(a),v=Object.assign({public:await s.importKey(...w,!0,[])},{name:"ECDH",namedCurve:"P-256"}),m=f(n,b),i=await s.importKey(...m,!1,["deriveBits"]).then(async u=>{var g=await s.deriveBits(v,u,256),x=new Uint8Array(g),k=await s.importKey("raw",x,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return s.exportKey("jwk",k).then(({k:S})=>S)}),o=i;if(t)try{t(o)}catch(u){console.log(u)}return o}catch(u){if(console.log(u),r.err=u,r.throw)throw u;t&&t();return}});var f=(l,h)=>{var[t,e]=l.split("."),a=h?{d:h}:{};return["jwk",Object.assign(a,{x:t,y:e,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};p.exports=r.secret})(y,"./secret"),y(function(p){var r=y("./root");r.certify=r.certify||(async(c,f={},l,h,t={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),c=(()=>{var i=[];if(c){if((typeof c=="string"||Array.isArray(c))&&c.indexOf("*")>-1)return"*";if(typeof c=="string")return c;if(Array.isArray(c)){if(c.length===1&&c[0])return typeof c[0]=="object"&&c[0].pub?c[0].pub:typeof c[0]=="string"?c[0]:null;c.map(o=>{typeof o=="string"?i.push(o):typeof o=="object"&&o.pub&&i.push(o.pub)})}return typeof c=="object"&&c.pub?c.pub:i.length>0?i:null}})(),!c)return console.log("No certificant found.");const a=t.expiry&&(typeof t.expiry=="number"||typeof t.expiry=="string")?parseFloat(t.expiry):null,n=(f||{}).read?f.read:null,b=(f||{}).write?f.write:typeof f=="string"||Array.isArray(f)||f["+"]||f["#"]||f["."]||f["="]||f["*"]||f[">"]||f["<"]?f:null,s=(t||{}).block||(t||{}).blacklist||(t||{}).ban||{},w=s.read&&(typeof s.read=="string"||(s.read||{})["#"])?s.read:null,v=typeof s=="string"?s:s.write&&(typeof s.write=="string"||s.write["#"])?s.write:null;if(!n&&!b)return console.log("No policy found.");const m=JSON.stringify({c,...a?{e:a}:{},...n?{r:n}:{},...b?{w:b}:{},...w?{rb:w}:{},...v?{wb:v}:{}});var e=await r.sign(m,l,null,{raw:1});if(t.raw||(e="SEA"+JSON.stringify(e)),h)try{h(e)}catch(i){console.log(i)}return e}catch(a){if(r.err=a,r.throw)throw a;h&&h();return}}),p.exports=r.certify})(y,"./certify"),y(function(p){var r=y("./shim"),c=y("./root");c.work=y("./work"),c.sign=y("./sign"),c.verify=y("./verify"),c.encrypt=y("./encrypt"),c.decrypt=y("./decrypt"),c.certify=y("./certify"),c.random=c.random||r.random,c.Buffer=c.Buffer||y("./buffer"),c.keyid=c.keyid||(async f=>{try{const l=r.Buffer.concat(f.replace(/-/g,"+").replace(/_/g,"/").split(".").map(a=>r.Buffer.from(a,"base64"))),h=r.Buffer.concat([r.Buffer.from([153,l.length/256,l.length%256]),l]),t=await sha1hash(h),e=r.Buffer.from(t,"binary");return e.toString("hex",e.length-8)}catch(l){throw console.log(l),l}}),((c.window||{}).GUN||{}).SEA=c,p.exports=c})(y,"./sea"),y(function(p){var r=y("./sea"),c,f;r.window?c=r.window.GUN||{chain:{}}:c=y((f+""==typeof _?".":"")+"./gun",1),r.GUN=c;function l(t){this._={$:this}}l.prototype=function(){function t(){}return t.prototype=c.chain,new t}(),l.prototype.constructor=l,c.chain.user=function(t){var e=this,n=e.back(-1),a;if(t)return t=r.opt.pub((t._||"")["#"])||t,n.get("~"+t);if(a=n.back("user"))return a;var n=n._,b=n,s=b.opt.uuid||h;return(b=(a=b.user=e.chain(new l))._).opt={},b.opt.uuid=function(w){var v=s(),m=n.user;return!m||!(m=m.is)||!(m=m.pub)||(v="~"+m+"/"+v,w&&w.call&&w(null,v)),v},a};function h(){return c.state().toString(36).replace(".","")}c.User=l,l.GUN=c,l.SEA=c.SEA=r,p.exports=l})(y,"./user"),y(function(p){var r,c=""+r!=typeof GUN?GUN||{chain:{}}:y((""+r==typeof _?".":"")+"./gun",1);c.chain.then=function(f,l){var h=this,t=new Promise(function(e,a){h.once(e,l)});return f?t.then(f):t}})(y,"./then"),y(function(p){var r=y("./user"),c=r.SEA,f=r.GUN,l=function(){};r.prototype.create=function(...h){var t=typeof h[0]=="object"&&(h[0].pub||h[0].epub)?h[0]:typeof h[1]=="object"&&(h[1].pub||h[1].epub)?h[1]:null,e=t&&(t.pub||t.epub)?t.pub:typeof h[0]=="string"?h[0]:null,a=t&&(t.pub||t.epub)?t:e&&typeof h[1]=="string"?h[1]:null,n=h.filter(o=>typeof o=="function")[0]||null,b=h&&h.length>1&&typeof h[h.length-1]=="object"?h[h.length-1]:{},s=this,w=s._,v=s.back(-1);if(n=n||l,b=b||{},b.check!==!1){var m;if(e||(m="No user."),(a||"").length<8&&(m="Password too short!"),m)return n({err:f.log(m)}),s}if(w.ing)return(n||l)({err:f.log("User is already being created or authenticated!"),wait:!0}),s;w.ing=!0;var i={};return i.a=function(o){if(i.pubs=o,o&&!b.already){var u={err:f.log("User already created!")};w.ing=!1,(n||l)(u),s.leave();return}i.salt=String.random(64),c.work(a,i.salt,i.b)},i.b=function(o){i.proof=o,t?i.c(t):c.pair(i.c)},i.c=function(o){var u;i.pair=o||{},(u=w.root.user)&&(u._.sea=o,u.is={pub:o.pub,epub:o.epub,alias:e}),i.data={pub:o.pub},i.d()},i.d=function(){i.data.alias=e,i.e()},i.e=function(){i.data.epub=i.pair.epub,c.encrypt({priv:i.pair.priv,epriv:i.pair.epriv},i.proof,i.f,{raw:1})},i.f=function(o){i.data.auth=JSON.stringify({ek:o,s:i.salt}),i.g(i.data.auth)},i.g=function(o){var u;i.data.auth=i.data.auth||o,v.get(u="~"+i.pair.pub).put(i.data).on(i.h);var g={};g[u]={"#":u},v.get("~@"+e).put(g).get(u).on(i.i)},i.h=function(o,u,g,x){x.off(),i.h.ok=1,i.i()},i.i=function(o,u,g,x){x&&(i.i.ok=1,x.off()),!(!i.h.ok||!i.i.ok)&&(w.ing=!1,n({ok:0,pub:i.pair.pub}),l===n&&(t?s.auth(t):s.auth(e,a)))},v.get("~@"+e).once(i.a),s},r.prototype.leave=function(h,t){var e=this,a=e.back(-1)._.user;if(a&&(delete a.is,delete a._.is,delete a._.sea),c.window)try{var n={};n=c.window.sessionStorage,delete n.recall,delete n.pair}catch{}return e}})(y,"./create"),y(function(p){var r=y("./user"),c=r.SEA,f=r.GUN,l=function(){};r.prototype.auth=function(...t){var e=typeof t[0]=="object"&&(t[0].pub||t[0].epub)?t[0]:typeof t[1]=="object"&&(t[1].pub||t[1].epub)?t[1]:null,a=!e&&typeof t[0]=="string"?t[0]:null,n=(a||e&&!(e.priv&&e.epriv))&&typeof t[1]=="string"?t[1]:null,b=t.filter(g=>typeof g=="function")[0]||null,s=t&&t.length>1&&typeof t[t.length-1]=="object"?t[t.length-1]:{},w=this,v=w._,m=w.back(-1);if(v.ing)return(b||l)({err:f.log("User is already being created or authenticated!"),wait:!0}),w;v.ing=!0;var i={},o,u=9;return i.a=function(g){if(!g)return i.b();if(!g.pub){var x=[];return Object.keys(g).forEach(function(k){k!="_"&&x.push(g[k])}),i.b(x)}if(i.name)return i.f(g);i.c((i.data=g).auth)},i.b=function(g){var x=(i.list=(i.list||[]).concat(g||[])).shift();if(o===x){if(i.name)return i.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(a&&u--){m.get("~@"+a).once(i.a);return}return i.err("Wrong user or password.")}m.get(x).once(i.a)},i.c=function(g){if(o===g)return i.b();if(typeof g=="string")return i.c(h(g));c.work(n,(i.auth=g).s,i.d,i.enc)},i.d=function(g){c.decrypt(i.auth.ek,g,i.e,i.enc)},i.e=function(g){if(o===g)return i.enc?(i.enc=null,i.b()):(i.enc={encode:"utf8"},i.c(i.auth));i.half=g,i.f(i.data)},i.f=function(g){var x=i.half||{},k=i.data||{};i.g(i.lol={pub:g.pub||k.pub,epub:g.epub||k.epub,priv:g.priv||x.priv,epriv:g.epriv||x.epriv})},i.g=function(g){if(!g||!g.pub||!g.epub)return i.b();i.pair=g;var x=m._.user,k=x._;k.tag;var S=k.opt;k=x._=m.get("~"+g.pub)._,k.opt=S,x.is={pub:g.pub,epub:g.epub,alias:a||g.pub},k.sea=i.pair,v.ing=!1;try{n&&o==(h(v.root.graph["~"+g.pub].auth)||"")[":"]&&(s.shuffle=s.change=n)}catch{}if(s.change?i.z():(b||l)(k),c.window&&(w.back("user")._.opt||s).remember)try{var $={};$=c.window.sessionStorage,$.recall=!0,$.pair=JSON.stringify(g)}catch{}try{m._.tag.auth?m._.on("auth",k):setTimeout(function(){m._.on("auth",k)},1)}catch(j){f.log("Your 'auth' callback crashed with:",j)}},i.h=function(g){if(!g)return i.b();if(a=g.alias,a||(a=g.alias="~"+e.pub),!g.auth)return i.g(e);e=null,i.c((i.data=g).auth)},i.z=function(){i.salt=String.random(64),c.work(s.change,i.salt,i.y)},i.y=function(g){c.encrypt({priv:i.pair.priv,epriv:i.pair.epriv},g,i.x,{raw:1})},i.x=function(g){i.w(JSON.stringify({ek:g,s:i.salt}))},i.w=function(g){if(s.shuffle){console.log("migrate core account from UTF8 & shuffle");var x={};Object.keys(i.data).forEach(function(k){x[k]=i.data[k]}),delete x._,x.auth=g,m.get("~"+i.pair.pub).put(x)}m.get("~"+i.pair.pub).get("auth").put(g,b||l)},i.err=function(g){var x={err:f.log(g||"User cannot be found!")};v.ing=!1,(b||l)(x)},i.plugin=function(g){if(!(i.name=g))return i.err();var x=[g];g[0]!=="~"&&(x[1]="~"+g,x[2]="~@"+g),i.b(x)},e?e.priv&&e.epriv?i.g(e):m.get("~"+e.pub).once(i.h):a?m.get("~@"+a).once(i.a):!a&&!n&&c.name(i.plugin),w};function h(t){if(typeof t!="string")return t;try{t=JSON.parse(t)}catch{t={}}return t}})(y,"./auth"),y(function(p){var r=y("./user"),c=r.SEA;r.GUN,r.prototype.recall=function(f,l){var h=this,t=h.back(-1);if(f=f||{},f&&f.sessionStorage){if(c.window)try{var e={};e=c.window.sessionStorage,e&&(t._.opt.remember=!0,(h.back("user")._.opt||f).remember=!0,(e.recall||e.pair)&&t.user().auth(JSON.parse(e.pair),l))}catch{}return h}return h}})(y,"./recall"),y(function(p){var r=y("./user"),c=r.SEA,f=r.GUN,l=function(){};r.prototype.pair=function(){var h=this,t;try{t=new Proxy({DANGER:"â "},{get:function(e,a,n){if(!(!h.is||!(h._||"").sea))return h._.sea[a]}})}catch{}return t},r.prototype.delete=async function(h,t,e){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var a=this;a.back(-1);var n=a.back("user");try{n.auth(h,t,function(b){var s=(n.is||{}).pub;n.map().once(function(){this.put(null)}),n.leave(),(e||l)({ok:0})})}catch(b){f.log("User.delete failed! Error:",b)}return a},r.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const h=this.back(-1);try{return await authRecall(h),h._.user._}catch{const t="No session!";throw f.log(t),{err:t}}},r.prototype.trust=async function(h){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),f.is(h)&&h.get("pub").get((t,e)=>{console.log(t,e)}),h.get("trust").get(path).put(theirPubkey)},r.prototype.grant=function(h,t){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var e=this,a=e.back(-1).user(),n=a._.sea,b="";return e.back(function(s){s.is||(b+=s.get||"")}),async function(){var s,w=await a.get("grant").get(n.pub).get(b).then();w=await c.decrypt(w,n),w||(w=c.random(16).toString(),s=await c.encrypt(w,n),a.get("grant").get(n.pub).get(b).put(s));var v=h.get("pub").then(),m=h.get("epub").then();v=await v,m=await m;var i=await c.secret(m,n);s=await c.encrypt(w,i),a.get("grant").get(v).get(b).put(s,t)}(),e},r.prototype.secret=function(h,t){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var e=this,a=e.back(-1).user(),n=a.pair(),b="";return e.back(function(s){s.is||(b+=s.get||"")}),async function(){var s,w=await a.get("trust").get(n.pub).get(b).then();w=await c.decrypt(w,n),w||(w=c.random(16).toString(),s=await c.encrypt(w,n),a.get("trust").get(n.pub).get(b).put(s)),s=await c.encrypt(h,w),e.put(s,t)}(),e},p.exports=r})(y,"./share"),y(function(p){var r=y("./sea"),c=y("./settings"),f,l=(r.window||"").GUN||y((""+f==typeof _?".":"")+"./gun",1);l.on("opt",function(s){s.sea||(s.sea={own:{}},s.on("put",h,s)),this.to.next(s)});function h(s){var w=this,v=w.as,m=s.put,i=m["#"],o=m["."],u=m[":"],g=m[">"],x=s["#"],k;if(!(!i||!o)){if((s._||"").faith&&(v.opt||"").faith&&typeof s._=="function"){r.opt.pack(m,function($){r.verify($,!1,function(j){m["="]=r.opt.unpack(j),w.to.next(s)})});return}var S=function($){v.on("in",{"@":x,err:s.err=$})};if((s._||"").DBG&&((s._||"").DBG.c=+new Date),0<=i.indexOf("<?")&&(k=parseFloat(i.split("<?")[1]||""),k&&g<l.state()-k*1e3)){(k=s._)&&k.stun&&k.stun--;return}if(i==="~@"){h.alias(w,s,u,o,i,v,S);return}if(i.slice(0,2)==="~@"){h.pubs(w,s,u,o,i,v,S);return}if(k=r.opt.pub(i)){h.pub(w,s,u,o,i,v,S,v.user||"",k);return}if(0<=i.indexOf("#")){h.hash(w,s,u,o,i,v,S);return}h.any(w,s,u,o,i,v,S,v.user||"")}}h.hash=function(s,w,v,m,i,o,u){r.work(v,null,function(g){function x(k){let S="";for(let $=0;$<k.length;$++)S+=$-1&1?"":String.fromCharCode(parseInt(k.substring($-1,$+1),16));return btoa(S)}if(g&&g===m.split("#").slice(-1)[0]||g&&g===x(m.split("#").slice(-1)[0]))return s.to.next(w);u("Data hash not same as hash!")},{name:"SHA-256"})},h.alias=function(s,w,v,m,i,o,u){if(!v)return u("Data must exist!");if("~@"+m===e(v))return s.to.next(w);u("Alias not same!")},h.pubs=function(s,w,v,m,i,o,u){if(!v)return u("Alias must exist!");if(m===e(v))return s.to.next(w);u("Alias not same!")},h.pub=async function(s,w,v,m,i,o,u,g,x){var k;const S=await c.parse(v)||{},$=(j,O,C)=>{if(j.m&&j.s&&O&&x)return r.verify(j,x,d=>{if(f!==d&&f!==d.e&&w.put[">"]&&w.put[">"]>parseFloat(d.e))return u("Certificate expired.");if(f!==d&&d.c&&d.w&&(d.c===O||d.c.indexOf("*")>-1)){let D=i.indexOf("/")>-1?i.replace(i.substring(0,i.indexOf("/")+1),""):"";String.match=String.match||l.text.match;const A=Array.isArray(d.w)?d.w:typeof d.w=="object"||typeof d.w=="string"?[d.w]:[];for(const B of A)if(String.match(D,B["#"])&&String.match(m,B["."])||!B["."]&&String.match(D,B["#"])||!B["#"]&&String.match(m,B["."])||String.match(D?D+"/"+m:m,B["#"]||B)){if(B["+"]&&B["+"].indexOf("*")>-1&&D&&D.indexOf(O)==-1&&m.indexOf(O)==-1)return u(`Path "${D}" or key "${m}" must contain string "${O}".`);if(d.wb&&(typeof d.wb=="string"||(d.wb||{})["#"])){var T=s.as.root.$.back(-1);return typeof d.wb=="string"&&d.wb.slice(0,1)!=="~"&&(T=T.get("~"+x)),T.get(d.wb).get(O).once(M=>M&&(M===1||M===!0)?u(`Certificant ${O} blocked.`):C(d))}return C(d)}return u("Certificate verification fail.")}})};if(m==="pub"&&"~"+x===i)return v===x?s.to.next(w):u("Account not same!");if((k=g.is)&&k.pub&&!S["*"]&&!S["+"]&&(x===k.pub||x!==k.pub&&((w._.msg||{}).opt||{}).cert)){r.opt.pack(w.put,j=>{r.sign(j,g._.sea,async function(O){if(f===O)return u(r.err||"Signature fail.");if(w.put[":"]={":":k=r.opt.unpack(O.m),"~":O.s},w.put["="]=k,x===g.is.pub){(k=e(v))&&((o.sea.own[k]=o.sea.own[k]||{})[x]=1),JSON.stringifyAsync(w.put[":"],function(C,d){return C?u(C||"Stringify error."):(w.put[":"]=d,s.to.next(w))});return}if(x!==g.is.pub&&((w._.msg||{}).opt||{}).cert){const C=await c.parse(w._.msg.opt.cert);C&&C.m&&C.s&&$(C,g.is.pub,d=>{w.put[":"]["+"]=C,w.put[":"]["*"]=g.is.pub,JSON.stringifyAsync(w.put[":"],function(T,D){return T?u(T||"Stringify error."):(w.put[":"]=D,s.to.next(w))})})}},{raw:1})});return}r.opt.pack(w.put,j=>{r.verify(j,S["*"]||x,function(O){var C;if(O=r.opt.unpack(O),f===O)return u("Unverified data.");if((C=e(O))&&x===r.opt.pub(C)&&((o.sea.own[C]=o.sea.own[C]||{})[x]=1),S["+"]&&S["+"].m&&S["+"].s&&S["*"])$(S["+"],S["*"],d=>(w.put["="]=O,s.to.next(w)));else return w.put["="]=O,s.to.next(w)})})},h.any=function(s,w,v,m,i,o,u,g){if(o.opt.secure)return u("Soul missing public key at '"+m+"'.");o.on("secure",function(x){if(this.off(),!o.opt.secure)return s.to.next(x);u("Data cannot be changed.")}).on.on("secure",w)};var t=l.valid,e=function(s,w){return typeof(w=t(s))=="string"&&w};(l.state||"").ify;var a=/[^\w_-]/;r.opt.pub=function(s){if(s&&(s=s.split("~"),!(!s||!(s=s[1]))&&(s=s.split(a).slice(0,2),!(!s||s.length!=2)&&(s[0]||"")[0]!=="@")))return s=s.slice(0,2).join("."),s},r.opt.stringy=function(s){},r.opt.pack=function(s,w,v,m,i){var o,u;if(r.opt.check(s))return w(s);s&&s["#"]&&s["."]&&s[">"]&&(o=s[":"],u=1),JSON.parseAsync(u?o:s,function(g,x){var k=f!==(x||"")[":"]&&(x||"")["~"];if(!k){w(s);return}w({m:{"#":i||s["#"],".":v||s["."],":":(x||"")[":"],">":s[">"]||l.state.is(m,v)},s:k})})};var n=r.opt;r.opt.unpack=function(s,w,v){var m;if(f!==s){if(s&&f!==(m=s[":"]))return m;if(w=w||n.fall_key,!v&&n.fall_val&&(v={},v[w]=n.fall_val),!(!w||!v)){if(s===v[w]||!r.opt.check(v[w]))return s;var i=v&&v._&&v._["#"]||n.fall_soul,o=l.state.is(v,w)||n.fall_state;if(s&&s.length===4&&i===s[0]&&w===s[1]&&b(o)===b(s[3]))return s[2];if(o<r.opt.shuffle_attack)return s}}},r.opt.shuffle_attack=15463296e5;var b=Math.floor})(y,"./index")})()}(Pt)),Pt.exports}var he=de();const ge=Jt(he);var ye=Object.create,Lt=Object.defineProperty,me=Object.getOwnPropertyDescriptor,ve=Object.getOwnPropertyNames,we=Object.getPrototypeOf,be=Object.prototype.hasOwnProperty,W=(E,y)=>()=>(y||E((y={exports:{}}).exports,y),y.exports),ke=(E,y,_,p)=>{if(y&&typeof y=="object"||typeof y=="function")for(let r of ve(y))!be.call(E,r)&&r!==_&&Lt(E,r,{get:()=>y[r],enumerable:!(p=me(y,r))||p.enumerable});return E},ft=(E,y,_)=>(_=E!=null?ye(we(E)):{},ke(Lt(_,"default",{value:E,enumerable:!0}),E)),Ht=W(E=>{(function(y){typeof DO_NOT_EXPORT_CRC>"u"?typeof E=="object"?y(E):typeof define=="function"&&define.amd?define(function(){var _={};return y(_),_}):y({}):y({})})(function(y){y.version="0.3.0";function _(){for(var t=0,e=new Array(256),a=0;a!=256;++a)t=a,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,e[a]=t;return typeof Int32Array<"u"?new Int32Array(e):e}var p=_(),r=typeof Buffer<"u";function c(t){if(t.length>32768&&r)return l(new Buffer(t));for(var e=-1,a=t.length-1,n=0;n<a;)e=p[(e^t.charCodeAt(n++))&255]^e>>>8,e=p[(e^t.charCodeAt(n++))&255]^e>>>8;return n===a&&(e=e>>>8^p[(e^t.charCodeAt(n))&255]),e^-1}function f(t){if(t.length>1e4)return l(t);for(var e=-1,a=0,n=t.length-3;a<n;)e=e>>>8^p[(e^t[a++])&255],e=e>>>8^p[(e^t[a++])&255],e=e>>>8^p[(e^t[a++])&255],e=e>>>8^p[(e^t[a++])&255];for(;a<n+3;)e=e>>>8^p[(e^t[a++])&255];return e^-1}function l(t){for(var e=-1,a=0,n=t.length-7;a<n;)e=e>>>8^p[(e^t[a++])&255],e=e>>>8^p[(e^t[a++])&255],e=e>>>8^p[(e^t[a++])&255],e=e>>>8^p[(e^t[a++])&255],e=e>>>8^p[(e^t[a++])&255],e=e>>>8^p[(e^t[a++])&255],e=e>>>8^p[(e^t[a++])&255],e=e>>>8^p[(e^t[a++])&255];for(;a<n+7;)e=e>>>8^p[(e^t[a++])&255];return e^-1}function h(t){for(var e=-1,a=0,n=t.length,b,s;a<n;)b=t.charCodeAt(a++),b<128?e=e>>>8^p[(e^b)&255]:b<2048?(e=e>>>8^p[(e^(192|b>>6&31))&255],e=e>>>8^p[(e^(128|b&63))&255]):b>=55296&&b<57344?(b=(b&1023)+64,s=t.charCodeAt(a++)&1023,e=e>>>8^p[(e^(240|b>>8&7))&255],e=e>>>8^p[(e^(128|b>>2&63))&255],e=e>>>8^p[(e^(128|s>>6&15|b&3))&255],e=e>>>8^p[(e^(128|s&63))&255]):(e=e>>>8^p[(e^(224|b>>12&15))&255],e=e>>>8^p[(e^(128|b>>6&63))&255],e=e>>>8^p[(e^(128|b&63))&255]);return e^-1}y.table=p,y.bstr=c,y.buf=f,y.str=h})}),xe=W((E,y)=>{var _=Ht();y.exports=f;var p=new Uint8Array(4),r=new Int32Array(p.buffer),c=new Uint32Array(p.buffer);function f(l){if(l[0]!==137)throw new Error("Invalid .png file header");if(l[1]!==80)throw new Error("Invalid .png file header");if(l[2]!==78)throw new Error("Invalid .png file header");if(l[3]!==71)throw new Error("Invalid .png file header");if(l[4]!==13)throw new Error("Invalid .png file header: possibly caused by DOS-Unix line ending conversion?");if(l[5]!==10)throw new Error("Invalid .png file header: possibly caused by DOS-Unix line ending conversion?");if(l[6]!==26)throw new Error("Invalid .png file header");if(l[7]!==10)throw new Error("Invalid .png file header: possibly caused by DOS-Unix line ending conversion?");for(var h=!1,t=[],e=8;e<l.length;){p[3]=l[e++],p[2]=l[e++],p[1]=l[e++],p[0]=l[e++];var a=c[0]+4,n=new Uint8Array(a);n[0]=l[e++],n[1]=l[e++],n[2]=l[e++],n[3]=l[e++];var b=String.fromCharCode(n[0])+String.fromCharCode(n[1])+String.fromCharCode(n[2])+String.fromCharCode(n[3]);if(!t.length&&b!=="IHDR")throw new Error("IHDR header missing");if(b==="IEND"){h=!0,t.push({name:b,data:new Uint8Array(0)});break}for(var s=4;s<a;s++)n[s]=l[e++];p[3]=l[e++],p[2]=l[e++],p[1]=l[e++],p[0]=l[e++];var w=r[0],v=_.buf(n);if(v!==w)throw new Error("CRC values for "+b+" header do not match, PNG file is likely corrupted");var m=new Uint8Array(n.buffer.slice(4));t.push({name:b,data:m})}if(!h)throw new Error(".png file ended prematurely: no IEND header was found");return t}}),Se=W((E,y)=>{y.exports=function(_,p,r){var c=[],f=_.length;if(f===0)return c;var l=p<0?Math.max(0,p+f):p||0;for(r!==void 0&&(f=r<0?r+f:r);f-- >l;)c[f-l]=_[f];return c}}),Te=W((E,y)=>{var _=Se(),p=Ht();y.exports=l;var r=new Uint8Array(4),c=new Int32Array(r.buffer),f=new Uint32Array(r.buffer);function l(h){var t=8,e=t,a;for(a=0;a<h.length;a++)t+=h[a].data.length,t+=12;var n=new Uint8Array(t);for(n[0]=137,n[1]=80,n[2]=78,n[3]=71,n[4]=13,n[5]=10,n[6]=26,n[7]=10,a=0;a<h.length;a++){var b=h[a],s=b.name,w=b.data,v=w.length,m=[s.charCodeAt(0),s.charCodeAt(1),s.charCodeAt(2),s.charCodeAt(3)];f[0]=v,n[e++]=r[3],n[e++]=r[2],n[e++]=r[1],n[e++]=r[0],n[e++]=m[0],n[e++]=m[1],n[e++]=m[2],n[e++]=m[3];for(var i=0;i<v;)n[e++]=w[i++];var o=m.concat(_(w)),u=p.buf(o);c[0]=u,n[e++]=r[3],n[e++]=r[2],n[e++]=r[1],n[e++]=r[0]}return n}}),_e=W((E,y)=>{y.exports=_;function _(p,r){if(p=String(p),r=String(r),!/^[\x00-\xFF]+$/.test(p)||!/^[\x00-\xFF]+$/.test(r))throw new Error("Only Latin-1 characters are permitted in PNG tEXt chunks. You might want to consider base64 encoding and/or zEXt compression");if(p.length>=80)throw new Error('Keyword "'+p+'" is longer than the 79-character limit imposed by the PNG specification');for(var c=p.length+r.length+1,f=new Uint8Array(c),l=0,h,t=0;t<p.length;t++){if(!(h=p.charCodeAt(t)))throw new Error("0x00 character is not permitted in tEXt keywords");f[l++]=h}f[l++]=0;for(var e=0;e<r.length;e++){if(!(h=r.charCodeAt(e)))throw new Error("0x00 character is not permitted in tEXt content");f[l++]=h}return{name:"tEXt",data:f}}}),De=W((E,y)=>{y.exports=_;function _(p){p.data&&p.name&&(p=p.data);for(var r=!0,c="",f="",l=0;l<p.length;l++){var h=p[l];if(r)h?f+=String.fromCharCode(h):r=!1;else if(h)c+=String.fromCharCode(h);else throw new Error("Invalid NULL character found. 0x00 character is not permitted in tEXt content")}return{keyword:f,text:c}}}),$e=W(E=>{E.encode=_e(),E.decode=De()}),Ae=()=>{if(typeof window>"u"||typeof window.CanvasRenderingContext2D>"u"||!_())return;let E=CanvasRenderingContext2D.prototype,y=E.drawImage;if(!y){console.error("This script requires a basic implementation of drawImage");return}E.drawImage=function(f,l,h){if(arguments.length!==9)return y.apply(this,[...arguments]);let t=p(...arguments);if(!r(t))return y.apply(this,t)};function _(){let f=document.createElement("canvas").getContext("2d");f.fillRect(0,0,40,40),f.drawImage(f.canvas,-40,-40,80,80,50,50,20,20);let l=f.getImageData(50,50,30,30),h=new Uint32Array(l.data.buffer),t=(n,b)=>h[b*l.width+n],e=[[9,9],[20,9],[9,20],[20,20]],a=[[10,10],[19,10],[10,19],[19,19]];return e.some(([n,b])=>t(n,b)!==0)||a.some(([n,b])=>t(n,b)===0)}function p(f,l,h,t,e,a,n,b,s){let{width:w,height:v}=c(f);t<0&&(l+=t,t=Math.abs(t)),e<0&&(h+=e,e=Math.abs(e)),b<0&&(a+=b,b=Math.abs(b)),s<0&&(n+=s,s=Math.abs(s));let m=Math.max(l,0),i=Math.min(l+t,w),o=Math.max(h,0),u=Math.min(h+e,v),g=b/t,x=s/e;return[f,m,o,i-m,u-o,l<0?a-l*g:a,h<0?n-h*x:n,(i-m)*g,(u-o)*x]}function r(f){return[3,4,7,8].some(l=>!f[l])}function c(f){let l=h=>{let t=globalThis[h];return t&&f instanceof t};if(l("HTMLImageElement"))return{width:f.naturalWidth,height:f.naturalHeight};if(l("HTMLVideoElement"))return{width:f.videoWidth,height:f.videoHeight};if(l("SVGImageElement"))throw new TypeError("SVGImageElement isn't yet supported as source image.","UnsupportedError");if(l("HTMLCanvasElement")||l("ImageBitmap"))return f}},qt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function Oe(E){return E.split("").reduce((y,_)=>y*64+qt.indexOf(_),0)}function je(E){let y=qt.split(""),_=[],p=0;for(let r of E)_[p++]=y.indexOf(r)/64;return _}function Ee(E){return E&&typeof E=="string"&&E.length===87&&E.split(".").length===2}function Ft(E){let y=E.split("."),_=y.map(l=>je(l)),p=_.map(l=>l[42]),r=_.map(l=>l.reduce((h,t)=>h+t)/l.length),c=y.map(l=>Oe(l)%360),f=y.map((l,h)=>`hsl(${c[h]} ${p[h]*100}% ${r[h]*100}%)`);return{finals:p,decoded:_,angles:c,averages:r,colors:f}}function it(E,y=3){return[...Array(Math.ceil(E.length/y))].map(()=>E.splice(0,y))}var Ce=ft(xe()),Be=ft(Te()),Me=ft($e()),lt=ot(null);function Ie(E){try{let y=E.toDataURL("image/png").split(",")[1],_=atob(y),p=new Uint8Array(_.length);for(let r=0;r<_.length;r++)p[r]=_.charCodeAt(r);return p}catch(y){return lt.value="Failed to convert canvas to buffer: "+y.message,null}}function Ne(E,y){try{let _=`<metadata>
      <gun-data>${JSON.stringify(y)}</gun-data>
    </metadata>`;return E.replace("</svg>",`${_}</svg>`)}catch(_){return lt.value="Failed to embed data in SVG: "+_.message,null}}function Pe(E,y){try{let _=Ie(E);if(!_)return null;let p=(0,Ce.default)(_);return p.splice(-1,0,Me.default.encode("message",JSON.stringify(y))),(0,Be.default)(p)}catch(_){return lt.value="Failed to embed data: "+_.message,null}}function Ue({pub:E,size:y,dark:_,draw:p,reflect:r,round:c,embed:f,p3:l}){let h=document.createElement("canvas");h.width=h.height=y;let t=h.getContext("2d"),{decoded:e,finals:a}=Ft(E);if(Ge({ctx:t,top:a[0],bottom:a[1],size:y,dark:_}),p=="squares"?(t.filter="blur(20px)",Gt(e[0],t,y,l),t.filter="blur(0px)",t.globalCompositeOperation="color-burn",Gt(e[1],t,y,l)):(Rt(e[0],t,y,.42*y,l),t.globalCompositeOperation="multiply",Rt(e[1],t,y,.125*y,l)),r&&(t.globalCompositeOperation="source-over",t.scale(-1,1),t.translate(-y/2,0),t.drawImage(h,y/2,0,y,y,0,0,y,y),t.setTransform(1,0,0,1,0,0)),c){let b=t.getImageData(0,0,y,y);t.clearRect(0,0,y,y),t.fillStyle=_?"#cccccc":"#ffffff",t.fillRect(0,0,y,y),t.putImageData(b,0,0),t.globalCompositeOperation="destination-in",t.beginPath(),t.arc(y/2,y/2,y/2,0,Math.PI*2),t.closePath(),t.fill()}let n=h.toDataURL("image/png");if(f){let b=Pe(h,{pub:E,content:f});if(b){let s=new Blob([b],{type:"image/png"});n=URL.createObjectURL(s)}}return n}function Ge({ctx:E,top:y=0,bottom:_=150,size:p=200,dark:r=!1}){let c=E.createLinearGradient(0,0,0,p),f=r?0:70;c.addColorStop(0,`hsl(0,0%,${f+y*30}%)`),c.addColorStop(1,`hsl(0,0%,${f+_*30}%)`),E.fillStyle=c,E.fillRect(0,0,p,p)}function Gt(E,y,_,p){it(E,14).forEach(r=>{if(r.length===14){let[c,f,l,h,t,e,a,n,b,s,w,v,m,i]=r,o=_/8+l*_*(7/8),u=y.createLinearGradient(c*_+o*n,0,c*_+o*m,_);u.addColorStop(0,p?`color(display-p3 ${h} ${t} ${e} / ${a})`:`rgba(${h*255}, ${t*255}, ${e*255}, ${a})`),u.addColorStop(1,p?`color(display-p3 ${b} ${s} ${w} / ${v})`:`rgba(${b*255}, ${s*255}, ${w*255}, ${v})`),y.fillStyle=u,y.translate(c*_,f*_),y.rotate(i*Math.PI),y.fillRect(-o/2,-o/2,o,o),y.setTransform(1,0,0,1,0,0)}})}function Rt(E,y,_,p,r){it(E,7).forEach(c=>{if(c.length===7){let[f,l,h,t,e,a,n]=c;y.beginPath(),y.arc(_/2+f*_/2,l*_,h*p,0,2*Math.PI),y.fillStyle=r?`color(display-p3 ${t} ${e} ${a} / ${n})`:`rgba(${t*255}, ${e*255}, ${a*255}, ${n})`,y.closePath(),y.fill()}})}function Re({size:E=300,reflect:y=!0,follow:_=!0,finals:p=[.5,.5],averages:r=[.5,.5],breathVert:c=.03}={}){return`
    <script type="text/javascript"><![CDATA[
      // Compact state & precomputed constants
      const s = {
        e: [], // elements
        p: { x: null, y: null, tx: null, ty: null, a: false, lt: 0, lit: 0 }, // pointer state
        r: null, // rect
        a: false, // pulse active
        pt: 0, // pulse time
        pv: 0, // pulse value
        t: 0 // time
      },
      c = {
        sz: ${E},
        cx: ${E/2},
        cy: ${E/2},
        pz: ${E} * 1.2,
        bz: ${E} * 0.4 * ${p[1]},
        pr: ${E} * (0.5 + ${p[0]}/4),
        mv: (0.1 + 0.05*${r[0]}) * Math.max(0.8, Math.min(4.4, 200/${E})),
        bs: 0.1 * Math.max(0.8, Math.min(1.4, 200/${E})),
        bv: ${c} * Math.max(0.8, Math.min(1.4, 200/${E})),
        bd: 4500 + ${r[0]}*1000,
        pa: 0.6 * Math.max(0.8, Math.min(1.4, 200/${E})),
        pr: 200,
        pf: 700,
        rf: ${_},
        d: 900,
        td: 1500000,
        pp: 0.5+ 0.5*${r[1]}
      };

      // Init using IIFE
      (() => {
        const svg = document.currentScript?.closest('svg');
        if (!svg) return;
        
        // Update rect and get element collections
        const ur = () => s.r = svg.getBoundingClientRect();
        ur();
        
        // Cache elements for better performance
        s.e = [
          ...Array.from(svg.querySelectorAll('.interactive-circle')).map(el => {
            const x = +el.getAttribute('data-cx');
            const y = +el.getAttribute('data-cy');
            const r = +el.getAttribute('r');
            const o = +el.getAttribute('data-opacity');
            const m = Math.pow(r / (c.sz * 0.05), 0.7) * o;
            const mr = el.nextElementSibling && 
                      el.nextElementSibling.getAttribute('cx') === (c.sz - x).toString() ?
                      el.nextElementSibling : null;
            
            return {
              el, t: 'c',
              x, y, r,
              cx: x, cy: y,
              m, mr,
              o: Math.random() * Math.PI * 2
            };
          }),
          ...Array.from(svg.querySelectorAll('.interactive-square')).map(el => {
            const x = +el.getAttribute('data-cx');
            const y = +el.getAttribute('data-cy');
            const r = +el.getAttribute('data-r');
            const o = +el.getAttribute('data-opacity');
            const a = +el.getAttribute('data-angle') + (Math.random() * 20 - 10);
            
            return {
              el, t: 's',
              x, y, z: c.bz, r: a,
              cx: x, cy: y, cz: c.bz, cr: a, cs: 1,
              m: Math.pow((r / c.sz), 1.5) * o,
              o: Math.random() * Math.PI * 2
            };
          })
        ];
        
        // Initial transform for squares
        s.e.filter(el => el.t === 's').forEach(setTransform);
        
        // Helper functions for event handling
        const gc = e => ({ x: (e.touches?.[0] || e.changedTouches?.[0] || e).clientX, 
                           y: (e.touches?.[0] || e.changedTouches?.[0] || e).clientY });
        
        const inBounds = (x, y) => {
          const { left, top, width, height } = s.r || {};
          return x >= left && x <= left + width && y >= top && y <= top + height;
        };
        
        // Event handlers
        const up = e => {
          if (!s.r) ur();
          const { left, top, width, height } = s.r;
          const { x, y } = gc(e);
          
          if (!inBounds(x, y) && !e.type.startsWith('touch')) {
            if (s.p.a) pl(false);
            return;
          }
          
          // Calculate relative position
          const tx = ((x - left) / width) * c.sz;
          const ty = ((y - top) / height) * c.sz;
          
          // Init/update target position
          if (s.p.tx === null) {
            s.p.tx = tx;
            s.p.ty = ty;
          } else {
            s.p.tx = tx;
            s.p.ty = ty;
            
            // Handle reappearance after inactivity
            if (!s.p.a && performance.now() - s.p.lt > 100) {
              s.p.x = tx;
              s.p.y = ty;
            }
          }
          
          // Initialize actual position if first interaction
          if (s.p.x === null) {
            s.p.x = s.p.tx;
            s.p.y = s.p.ty;
          }
          
          s.p.a = true;
          s.p.lt = performance.now();
        };
        
        const pd = e => {
          up(e);
          s.a = true;
          s.pt = performance.now();
          if (e.type === 'touchstart') e.preventDefault();
        };
        
        const pu = e => {
          s.a = false;
          s.pt = performance.now();
          
          if (e.type === 'touchend' || e.type === 'touchcancel') {
            pl(true);
          }
        };
        
        const pl = (immediate = false) => {
          s.p.a = false;
          s.p.lit = performance.now();
          s.a = false;
          s.pt = s.p.lit;
          
          if (immediate) {
            s.p.tx = s.p.x = null;
            s.p.ty = s.p.y = null;
          }
        };
        
        // Event listeners
        window.addEventListener('resize', ur, { passive: true });
        svg.addEventListener('pointermove', up, { passive: true });
        svg.addEventListener('pointerenter', up, { passive: true });
        svg.addEventListener('pointerleave', pl, { passive: true });
        svg.addEventListener('pointerdown', pd, { passive: false });
        window.addEventListener('pointerup', pu, { passive: true });
        window.addEventListener('pointercancel', pu, { passive: true });
        
        // Start animation
        requestAnimationFrame(animate);
        
        // Setup auto-cleanup
        if (document.currentScript?.parentNode) {
          const cleanup = () => {
            window.removeEventListener('resize', ur);
            svg.removeEventListener('pointermove', up);
            svg.removeEventListener('pointerenter', up);
            svg.removeEventListener('pointerleave', pl);
            svg.removeEventListener('pointerdown', pd);
            window.removeEventListener('pointerup', pu);
            window.removeEventListener('pointercancel', pu);
            s.e = [];
          };
          
          new MutationObserver(mutations => {
            mutations.forEach(m => {
              if (m.removedNodes) {
                m.removedNodes.forEach(n => {
                  if (n === document.currentScript) {
                    cleanup();
                    observer.disconnect();
                  }
                });
              }
            });
          }).observe(document.currentScript.parentNode, { childList: true });
        }
      })();
      
      // Apply 3D transform to square elements
      function setTransform(el) {
        const ps = c.pz / (c.pz + el.cz);
        const px = c.cx + (el.cx - c.cx) * ps;
        const py = c.cy + (el.cy - c.cy) * ps;
        el.el.setAttribute('transform', 
          'translate('+ px+' '+ py+') rotate('+ el.cr+ ') scale(' + ps * el.cs + ')'
        );
      }
      
      // Calculate effects based on time and pulse
      function fx(el, t, pv) {
        const Î¸ = (t % c.bd) / c.bd * Math.PI * 2 + el.o;
        const w = Math.sin(Î¸);
        const mf = 1 - Math.min(0.8, el.m);
        return {
          s: (1 + w * c.bs * mf) * (1 + pv * c.pa * Math.pow(mf, 2)),
          y: w * c.sz * c.bv * mf,
          p: pv * c.pa * Math.pow(mf, 2)
        };
      }
      
      // Animation loop
      function animate(time) {
        const dt = s.t ? time - s.t : 0;
        s.t = time;
        
        // Handle pointer inactivity
        if (!s.p.a && s.p.x !== null && time - s.p.lit > c.td) {
          s.p.x = s.p.y = s.p.tx = s.p.ty = null;
          s.e.forEach(el => { if (el.ractive) el.ractive = false; });
        }
        
        // Smooth pointer movement
        if (s.p.a && s.p.tx !== null && s.p.x !== null) {
          const dx = s.p.tx - s.p.x;
          const dy = s.p.ty - s.p.y;
          const dist = Math.sqrt(dx*dx + dy*dy);
          const factor = dist > c.sz * 0.3 ? 0.2 : c.pp;
          
          s.p.x += dx * factor;
          s.p.y += dy * factor;
        }
        
        // Update pulse
        s.pv = s.a ? 
          s.pv + (1 - s.pv) * Math.min(1, (time - s.pt) / c.pr) : 
          s.pv * Math.max(0, 1 - (time - s.pt) / c.pf);
        
        if (s.pv < 0.001) s.pv = 0;
        
        // Process elements
        const ps = Math.max(0.6, Math.min(1, c.sz / 150));
        const active = s.p.x !== null;
        
        s.e.forEach(el => {
          const sm = Math.min(dt / c.d, 1) * (el.t === 's' ? 0.3 : 0.1);
          const effect = fx(el, time, s.pv);
          
          if (el.t === 'c') { // Circle
            let tx = el.x;
            let ty = el.y + effect.y;
            
            if (active) {
              const dx = s.p.x - el.x;
              const dy = s.p.y - el.y;
              const d = Math.sqrt(dx * dx + dy * dy);
              const mv = c.sz * c.mv * (1 - Math.min(0.8, el.m));
              const m = Math.min(d, mv) * ps;
              
              if (d > 0.1) {
                tx += m * (dx / d);
                ty += m * (dy / d);
              }
            }
            
            // Smooth interpolation
            const cx_diff = tx - el.cx;
            const cy_diff = ty - el.cy;
            const c_dist = Math.sqrt(cx_diff*cx_diff + cy_diff*cy_diff);
            const c_factor = c_dist > 20 ? 0.15 : 0.1;
            
            el.cx += cx_diff * c_factor;
            el.cy += cy_diff * c_factor;
            
            // Apply changes
            el.el.setAttribute('cx', el.cx);
            el.el.setAttribute('cy', el.cy);
            el.el.setAttribute('r', el.r * effect.s);
            
            // Handle reflection
            if (el.mr && ${y}) {
              // Initialize reflection properties if needed
              const reflectX = c.sz - el.x;
              if (!el.rcx) {
                el.rcx = reflectX;
                el.rcy = el.y;
                el.rtx = reflectX;
                el.rty = el.y;
                el.ractive = false;
                el.rest = { x: reflectX, y: el.y };
              }
              
              // Update reflection activity state
              if (active && !el.ractive && s.p.lt - s.p.lit > 100) {
                el.ractive = true;
              } else if (!active && el.ractive && s.p.lit - s.p.lt > 50) {
                el.ractive = false;
              }
              
              // Set target position based on active state and mode
              if (!active || !${_}) {
                el.rtx = c.sz - el.cx;
                el.rty = el.cy;
              } else {
                const rdx = s.p.x - reflectX;
                const rdy = s.p.y - el.y;
                const rd = Math.sqrt(rdx * rdx + rdy * rdy);
                const rmv = c.sz * c.mv * (1 - Math.min(0.8, el.m));
                const rm = Math.min(rd, rmv) * ps;
                
                if (rd > 0.1) {
                  el.rtx = reflectX + rm * (rdx / rd);
                  el.rty = el.y + effect.y + rm * (rdy / rd);
                } else {
                  el.rtx = reflectX;
                  el.rty = el.y + effect.y;
                }
              }
              
              // Return to rest position when inactive
              if (!active && !s.p.x) {
                el.rtx = el.rest.x;
                el.rty = el.rest.y + effect.y;
              }
              
              // Smooth interpolation for reflection
              const rcx_diff = el.rtx - el.rcx;
              const rcy_diff = el.rty - el.rcy;
              const rc_dist = Math.sqrt(rcx_diff*rcx_diff + rcy_diff*rcy_diff);
              const rc_factor = rc_dist > 30 ? 0.05 : (rc_dist > 10 ? 0.07 : 0.09);
              
              el.rcx += rcx_diff * rc_factor;
              el.rcy += rcy_diff * rc_factor;
              
              // Apply reflection position
              el.mr.setAttribute('cx', el.rcx);
              el.mr.setAttribute('cy', el.rcy);
              el.mr.setAttribute('r', el.r * effect.s);
            }
          } else if (el.t === 's') { // Square
            let tx = el.x, ty = el.y + effect.y, tz = c.bz, tr = el.r, ts = 1;
            
            if (active) {
              const dx = s.p.x - el.x;
              const dy = s.p.y - el.y;
              const d = Math.sqrt(dx * dx + dy * dy);
              const mf = 1 - Math.min(0.8, el.m);
              const mv = c.sz * 0.1 * mf;
              const m = Math.min(d, mv) * ps;
              
              if (d > 0.1) {
                tx += m * (dx / d);
                ty += m * (dy / d);
              }
              
              // Apply depth & scale changes
              const n = Math.min(d / c.pr, 1);
              const zf = 1 - n * n;
              tz -= c.bz * zf * mf;
              ts += zf * 0.3 * mf;
              tr += Math.sin(d / 100) * 5 * mf;
            } else {
              // Idle rotation
              tr += Math.sin(time / 1500 + el.o) * 3 * (1 - Math.min(0.8, el.m));
            }
            
            // Apply pulse to Z depth
            tz -= effect.p * c.bz * 0.7 * (1 - Math.min(0.8, el.m));
            ts *= effect.s;
            
            // Smoothing based on distance
            const sx_diff = tx - el.cx;
            const sy_diff = ty - el.cy;
            const s_dist = Math.sqrt(sx_diff*sx_diff + sy_diff*sy_diff);
            const s_factor = Math.min(1, s_dist > 20 ? sm * 1.5 : sm);
            
            // Apply interpolation
            el.cx += sx_diff * s_factor;
            el.cy += sy_diff * s_factor;
            el.cz += (tz - el.cz) * sm;
            el.cr += (tr - el.cr) * sm;
            el.cs += (ts - el.cs) * sm;
            
            setTransform(el);
          }
        });
        
        requestAnimationFrame(animate);
      }
    ]]><\/script>
  `}function Je({pub:E,size:y=200,dark:_=!1,draw:p="circles",reflect:r=!0,round:c=!0,embed:f=!0,svg:l}={}){let{decoded:h,finals:t,averages:e}=Ft(E),a=`
      <linearGradient id="bg" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="hsla(0,0%,${(_?0:70)+t[0]*30}%)"/>
        <stop offset="100%" stop-color="hsla(0,0%,${(_?0:70)+t[1]*30}%)"/>
      </linearGradient>
    `,n=(m,i=!1)=>it(m,14).map(o=>{if(o.length!==14)return"";let[u,g,x,k,S,$,j,O,C,d,T,D,A,B]=o,M=y/8+x*y*(7/8),I=`gradient-${u}-${g}-${i?"2":"1"}`,N=u*y,P=g*y,U=l==="interactive"?`class="interactive-square" data-cx="${N}" data-cy="${P}" data-r="${M}" data-angle="${B*180}" data-opacity="${(j+D)/2}"`:"";return`
          <defs>
            <linearGradient id="${I}" x1="${O}" y1="0" x2="${A}" y2="1">
              <stop offset="0%" stop-color="color(display-p3 ${k} ${S} ${$} / ${j})"/>
              <stop offset="100%" stop-color="color(display-p3 ${C} ${d} ${T} / ${D})"/>
            </linearGradient>
          </defs>
          <g ${U} transform="translate(${N} ${P}) rotate(${B*180})">
            <rect 
              x="${-M/2}" y="${-M/2}" 
              width="${M}" height="${M}"
              fill="url(#${I})"
              style="${i?"mix-blend-mode:color-burn;":"filter:blur(20px);"}"
            />
          </g>
        `}).join(""),b=(m,i,o=!1)=>it(m,7).map(u=>{if(u.length!==7)return"";let[g,x,k,S,$,j,O]=u,C=y/2+g*y/2,d=x*y,T=k*i;return`
          <circle 
            ${l==="interactive"?`class="interactive-circle" data-cx="${C}" data-cy="${d}" data-opacity="${O}"`:""}
            cx="${C}" cy="${d}" r="${T}"
            fill="color(display-p3 ${S} ${$} ${j} / ${O})"

            style="${o?"mix-blend-mode:multiply;":""}"
          />
          ${r?`
          <circle 
            cx="${y-C}" cy="${d}" r="${T}"
            fill="color(display-p3 ${S} ${$} ${j} / ${O})"

            style="${o?"mix-blend-mode:multiply;":""}"
          />`:""}
        `}).join(""),s=c?`
      <defs>
        <clipPath id="circle-mask">
          <circle cx="${y/2}" cy="${y/2}" r="${y/2}" />
        </clipPath>
      </defs>
    `:"",w=l==="interactive"?Re({size:y,reflect:r,finals:t,averages:e}):"",v=`
      <svg 
        width="${y}" height="${y}" 
        viewBox="0 0 ${y} ${y}" 
        xmlns="http://www.w3.org/2000/svg"
        style="overflow: visible;"
        >
        <defs>${a}</defs>
        ${s}
        <g ${c?'clip-path="url(#circle-mask)"':""}>
          <rect x="${-y}" width="${3*y}" y="${-y}" height="${3*y}" fill="url(#bg)"/>
          ${p==="squares"?`${n(h[0],!1)}
             ${n(h[1],!0)}`:`${b(h[0],.42*y)}
             ${b(h[1],.125*y,!0)}`}
        </g>
        ${w}
      </svg>
    `;if(l==="interactive")return`data:image/svg+xml,${encodeURIComponent(v.trim())}`;if(f){let m={pub:E};f&&(m.content=f),v=Ne(v,m)}return`data:image/svg+xml;base64,${typeof btoa=="function"?btoa(v):Buffer.from(v).toString("base64")}`}var rt={};function st({pub:E,size:y=200,dark:_=!1,draw:p="circles",reflect:r=!0,round:c=!0,embed:f=!0,svg:l=!0,p3:h=!0}={}){let t=typeof window<"u"&&typeof document<"u";if(!Ee(E))return"";if(l||!t)return Je({pub:E,size:y,dark:_,draw:p,reflect:r,round:c,embed:f,svg:l});let e=JSON.stringify(arguments[0]);if(rt!=null&&rt[e])return rt[e];let a=Ue({pub:E,size:y,dark:_,draw:p,reflect:r,round:c,embed:f,p3:h});return rt[e]=a,a}Ae();const ze={class:"flex flex-col p-2 gap-2"},Le={key:0,class:"flex gap-2 p-2 items-center flex-wrap"},He=["src"],qe={key:1,class:"flex p-2 items-center flex-wrap"},Fe=["src"],We={class:"flex flex-wrap items-center gap-2"},Ke=["onPointerdown"],Xe=["src"],Ve={class:"text-xs"},K="test-app-1000",Qe={__name:"GunP2p",setup(E){const y=ie({peers:["https://peer.wallie.io/gun"]}),_=ot(""),p=ot(""),r=ot(null),c=Wt({}),f=[],l=[];ht(p,n=>y.user().get("name").put(n)),ht(()=>Q.note,n=>y.user().get("midi").put(n.number)),Kt(()=>{y.user().recall({sessionStorage:!0}),e(),l.push(y.on("auth",()=>{_.value=y.user().is?.pub,l.push(y.user().get("name").on(n=>p.value=n)),l.push(y.get(K).get("personal").get(_.value).on(n=>yt(Q.note.number))),f.push(setInterval(()=>y.get(K).get("users").get(_.value).put(Date.now()),1e3))})),l.push(y.get(K).get("users").map().on((n,b)=>{Date.now()-n<8e3&&(c[b]=c[b]||{},c[b].timestamp=n,y.user(b).get("name").once(s=>c[b].name=s),y.user(b).get("midi").once(s=>c[b].midi=s))})),l.push(y.get(K).get("play").on(()=>yt(Q.note.number))),f.push(setInterval(()=>{for(let n in c)0>Date.now()-c[n].timestamp>6e3&&delete c[n]},1e4))}),Xt(()=>{f.forEach(n=>clearInterval(n)),l.forEach(n=>n?.off?.())});function h(){y.get(K).get("play").put(Date.now())}function t(n){y.get(K).get("personal").get(n).put(Date.now())}async function e(){r.value=await ge.pair()}function a(){y.user().leave(),setTimeout(()=>{y.user()?.is||(_.value=null)},1e3)}return(n,b)=>(Z(),Y("div",ze,[_.value?(Z(),Y("div",Le,[L("img",{style:{width:"60px"},src:H(st)({pub:_.value})},null,8,He),Vt(L("input",{class:"p-1","onUpdate:modelValue":b[0]||(b[0]=s=>p.value=s)},null,512),[[Yt,p.value]]),L("div",{class:"p-2 rounded-xl",style:gt({backgroundColor:H(vt)(H(Q).note.number)})},at(H(mt)[H(Q).note.pitch]),5),b[5]||(b[5]=L("div",{class:"flex-1"},null,-1)),L("button",{class:"text-button",onClick:b[1]||(b[1]=s=>a())},"Leave")])):(Z(),Y("div",qe,[L("button",{class:"text-button",onPointerdown:b[2]||(b[2]=s=>e())},"Generate",32),L("img",{style:{width:"60px"},src:H(st)({pub:r.value?.pub})},null,8,Fe),L("button",{class:"text-button",onPointerdown:b[3]||(b[3]=s=>H(y).user().auth(r.value))},"Enter",32)])),L("div",We,[Zt(ne,{name:"fade"},{default:Qt(()=>[L("button",{class:"text-button",key:"all",onPointerdown:b[4]||(b[4]=s=>h())},"Play all",32),(Z(!0),Y(te,null,ee(c,(s,w)=>(Z(),Y("button",{class:"p-2 flex flex-col shadow gap-2 relative active-op-80 transition",onPointerdown:v=>t(w),key:w},[L("img",{style:{width:"60px",margin:"0"},src:H(st)({pub:w})},null,8,Xe),L("div",Ve,at((s.name||"").slice(0,18)),1),L("div",{class:"absolute bottom-0 right-0 px-1 p-0 rounded-xl text-xs",style:gt({backgroundColor:H(vt)(s.midi,1,.5)})},at(H(mt)[(s.midi-9)%12]),5)],40,Ke))),128))]),_:1})])]))}};export{Qe as default};
