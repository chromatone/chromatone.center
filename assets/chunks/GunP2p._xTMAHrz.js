import{a as ot,r as Gt,w as lt,o as Jt,y as Ut,B as X,C as Z,E as K,u as L,H as Pt,a8 as Rt,J as it,K as pt,R as It,W as Mt,F as Ht,G as Kt,a9 as Lt}from"./framework.B_b_ZswS.js";import{am as z,e as ht,n as dt,aD as gt}from"./theme.CgSqoG0K.js";var yt={},tt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof yt<"u"?yt:typeof self<"u"?self:{};function _t(E){return E&&E.__esModule&&Object.prototype.hasOwnProperty.call(E,"default")?E.default:E}var vt;function At(){return vt||(vt={"/gun.js":Y})}function ut(E){function m(O){var g=mt(O,E);if(g!==null)return At()[g]();throw new Error('Could not dynamically require "'+O+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}return m.resolve=function(O){var g=mt(O,E);return g!==null?g:require.resolve(O)},m}function mt(E,m){var O=Wt(E);E=rt(E);var g;E[0]==="/"&&(m="");for(var i=At(),o=["",".js",".json"];O?g=rt(m+"/node_modules/"+E):g=rt(m+"/"+E),!g.endsWith("/..");){for(var s=0;s<o.length;s++){var h=g+o[s];if(i[h])return h}if(!O)break;var d=rt(m+"/..");if(d===m)break;m=d}return null}function Wt(E){var m=E[0];if(m==="/"||m==="\\")return!1;var O=E[1],g=E[2];return!(m==="."&&(!O||O==="/"||O==="\\")||m==="."&&O==="."&&(!g||g==="/"||g==="\\")||O===":"&&(g==="/"||g==="\\"))}function rt(E){E=E.replace(/\\/g,"/");for(var m=E.split("/"),O=m[0]==="",g=1;g<m.length;g++)(m[g]==="."||m[g]==="")&&m.splice(g--,1);for(var g=1;g<m.length;g++)m[g]===".."&&g>0&&m[g-1]!==".."&&m[g-1]!=="."&&(m.splice(--g,2),g--);return E=m.join("/"),O&&E[0]!=="/"?E="/"+E:E.length===0&&(E="."),E}var wt={exports:{}},bt;function Y(){return bt||(bt=1,function(E){(function(){function m(g,i){return i?ut("/")(g):g.slice?m[o(g)]:function(s,h){g(s={exports:{}}),m[o(h)]=s.exports};function o(s){return s.split("/").slice(-1).toString().replace(".js","")}}var O=E;m(function(g){String.random=function(o,s){var h="";for(o=o||24,s=s||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";o-- >0;)h+=s.charAt(Math.floor(Math.random()*s.length));return h},String.match=function(o,s){var h,d;return typeof o!="string"?!1:(typeof s=="string"&&(s={"=":s}),s=s||{},h=s["="]||s["*"]||s[">"]||s["<"],o===h?!0:d!==s["="]?!1:(h=s["*"]||s[">"],o.slice(0,(h||"").length)===h?!0:d!==s["*"]?!1:d!==s[">"]&&d!==s["<"]?o>=s[">"]&&o<=s["<"]:d!==s[">"]&&o>=s[">"]||d!==s["<"]&&o<=s["<"]))},String.hash=function(o,s){if(typeof o=="string"){if(s=s||0,!o.length)return s;for(var h=0,d=o.length,t;h<d;++h)t=o.charCodeAt(h),s=(s<<5)-s+t,s|=0;return s}};var i=Object.prototype.hasOwnProperty;Object.plain=function(o){return o?o instanceof Object&&o.constructor===Object||Object.prototype.toString.call(o).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(o,s){for(var h in o)if(i.call(o,h)&&(!s||s.indexOf(h)==-1))return!1;return!0},Object.keys=Object.keys||function(o){var s=[];for(var h in o)i.call(o,h)&&s.push(h);return s},function(){var o,s=setTimeout,h=0,d=0,t=typeof setImmediate!=""+o&&setImmediate||function(u,r){return typeof MessageChannel==""+o?s:((u=new MessageChannel).port1.onmessage=function(k){k.data==""&&r()},function(k){r=k,u.port2.postMessage("")})}(),c=s.check=s.check||typeof performance!=""+o&&performance||{now:function(){return+new Date}};s.hold=s.hold||9,s.poll=s.poll||function(u){if(s.hold>=c.now()-h&&d++<3333){u();return}t(function(){h=c.now(),u()},d=0)}}(),function(){var o=setTimeout,s=o.turn=o.turn||function(r){h.push(r)==1&&d(u)},h=s.s=[],d=o.poll,t=0,c,u=function(){(c=h[t++])&&c(),(t==h.length||t==99)&&(h=s.s=h.slice(t),t=0),h.length&&d(u)}}(),function(){var o,s=setTimeout,h=s.turn;(s.each=s.each||function(d,t,c,u){u=u||9,function r(k,a,y){if(a=(k=(d||[]).splice(0,u)).length){for(var v=0;v<a&&o===(y=t(k[v]));v++);if(o===y){h(r);return}}c&&c(y)}()})()}()})(m,"./shim"),m(function(g){g.exports=function i(c,s,h){if(!c)return{to:i};var d,t=typeof s=="function",c=(this.tag||(this.tag={}))[c]||t&&(this.tag[c]={tag:c,to:i._={next:function(r){var k;(k=this.to)&&k.next(r)}}});if(t){var u={off:i.off||(i.off=function(){if(this.next===i._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=i._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:i._,next:s,the:c,on:this,as:h};return(u.back=c.last||c).to=u,c.last=u}return(c=c.to)&&d!==s&&c.next(s),c}})(m,"./onto"),m(function(g){g.exports=function(i){return i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"&&i!=1/0&&i!=-1/0&&i===i||!!i&&typeof i["#"]=="string"&&Object.keys(i).length===1&&i["#"]}})(m,"./valid"),m(function(g){m("./shim");function i(){var c=+new Date;return d<c?(s=0,d=c+i.drift):d=c+(s+=1)/h+i.drift}i.drift=0;var o=-1/0,s=0,h=999,d=o,t;i.is=function(c,u,r){var k=u&&c&&c._&&c._[">"]||r;if(k)return typeof(k=k[u])=="number"?k:o},i.ify=function(c,u,r,k,a){(c=c||{})._=c._||{},a&&(c._["#"]=a);var y=c._[">"]||(c._[">"]={});return t!==u&&u!=="_"&&(typeof r=="number"&&(y[u]=r),t!==k&&(c[u]=k)),c},g.exports=i})(m,"./state"),m(function(g){m("./shim");function i(o){var s={s:{}},h=s.s;o=o||{max:999,age:1e3*9},s.check=function(t){return h[t]?d(t):!1};var d=s.track=function(t){var c=h[t]||(h[t]={});return c.was=s.now=+new Date,s.to||(s.to=setTimeout(s.drop,o.age+9)),d.ed&&d.ed(t),c};return s.drop=function(t){s.to=null,s.now=+new Date;var c=Object.keys(h);console.STAT&&console.STAT(s.now,+new Date-s.now,"dup drop keys"),setTimeout.each(c,function(u){var r=h[u];r&&(t||o.age)>s.now-r.was||delete h[u]},0,99)},s}g.exports=i})(m,"./dup"),m(function(g){m("./onto"),g.exports=function(o,s){if(this.on){var h=(this.opt||{}).lack||9e3;if(typeof o!="function"){if(!o)return;var t=o["#"]||o,d=(this.tag||"")[t];return d?(s&&(d=this.on(t,s),clearTimeout(d.err),d.err=setTimeout(function(){d.off()},h)),!0):void 0}var t=s&&s["#"]||i(9);if(!o)return t;var c=this.on(t,o,s);return c.err=c.err||setTimeout(function(){c.off(),c.next({err:"Error: No ACK yet.",lack:!0})},h),t}};var i=String.random||function(){return Math.random().toString(36).slice(2)}})(m,"./ask"),m(function(g){function i(a){return a instanceof i?(this._={$:this}).$:this instanceof i?i.create(this._={$:this,opt:a}):new i(a)}i.is=function(a){return a instanceof i||a&&a._&&a===a._.$||!1},i.version=.202,i.chain=i.prototype,i.chain.toJSON=function(){},m("./shim"),i.valid=m("./valid"),i.state=m("./state"),i.on=m("./onto"),i.dup=m("./dup"),i.ask=m("./ask"),function(){i.create=function(l){l.root=l.root||l,l.graph=l.graph||{},l.on=l.on||i.on,l.ask=l.ask||i.ask,l.dup=l.dup||i.dup();var S=l.$.opt(l.opt);return l.once||(l.on("in",a,l),l.on("out",a,l),l.on("put",w,l),i.on("create",l),l.on("create",l)),l.once=1,S};function a(l){if(l){if(l.out===a){this.to.next(l);return}var S=this,j=S.as,$=j.at||j,B=$.$,N=$.dup,G,J=l.DBG;if((G=l["#"])||(G=l["#"]=s(9)),!N.check(G)){if(N.track(G),G=l._,l._=typeof G=="function"?G:function(){},l.$&&l.$===(l.$._||"").$||(l.$=B),l["@"]&&!l.put&&n(l),!$.ask(l["@"],l))if(J&&(J.u=+new Date),l.put){y(l);return}else l.get&&i.on.get(l,B);J&&(J.uc=+new Date),S.to.next(l),J&&(J.ua=+new Date),!(l.nts||l.NTS)&&(l.out=a,$.on("out",l),J&&(J.ue=+new Date))}}}function y(l){if(l){var S=l._||"",j=S.root=((S.$=l.$||"")._||"").root;if(l["@"]&&S.faith&&!S.miss){l.out=a,j.on("out",l);return}S.latch=j.hatch,S.match=j.hatch=[];var $=l.put,B=S.DBG=l.DBG,N=+new Date;if(A=A||N,!($["#"]&&$["."])){B&&(B.p=N),S["#"]=l["#"],S.msg=l,S.all=0,S.stun=1;var G=Object.keys($);console.STAT&&console.STAT(N,((B||S).pk=+new Date)-N,"put sort");var J=0,U,P,R,I,M,H,Q;(function W(et){if(U!=J){if(U=J,!(R=G[J])){console.STAT&&console.STAT(N,((B||S).pd=+new Date)-N,"put"),e(S);return}(I=$[R])?(Q=I._)?R!==Q["#"]?H=p+x(R)+"soul not same.":(M=Q[">"])||(H=p+x(R)+"no state."):H=p+x(R)+"no meta.":H=p+x(R)+"no node.",P=Object.keys(I||{})}if(H){l.err=S.err=H,e(S);return}var ct=0,F;for(et=et||0;et++<9&&(F=P[ct++]);)if(F!=="_"){var nt=I[F],ft=M[F];if(u===ft){H=p+x(F)+"on"+x(R)+"no state.";break}if(!d(nt)){H=p+x(F)+"on"+x(R)+"bad "+typeof nt+x(nt);break}v(nt,F,R,ft,l),++C}if((P=P.slice(ct)).length){h(W);return}++J,P=null,W(et)})()}}}i.on.put=y;function v(l,S,j,$,B){var N=B._||"",G=N.root,J=G.graph,U,P=J[j]||r,R=t(P,S,1),I=P[S],M=N.DBG;(U=console.STAT)&&(!J[j]||!I)&&(U.has=(U.has||0)+1);var H=D();if($>H){setTimeout(function(){v(l,S,j,$,B)},(U=$-H)>T?T:U),console.STAT&&console.STAT((M||N).Hf=+new Date,U,"future");return}if(!($<R)&&!(!N.faith&&$===R&&(l===I||b(l)<=b(I))&&!N.miss)){N.stun++;var Q=B["#"]+N.all++,W={toString:function(){return Q},_:N};W.toJSON=W.toString,G.dup.track(W)["#"]=B["#"],M&&(M.ph=M.ph||+new Date),G.on("put",{"#":W,"@":B["@"],put:{"#":j,".":S,":":l,">":$},ok:B.ok,_:N})}}function w(l){var S;(S=(l._||"").DBG)&&(S.pa=+new Date,S.pm=S.pm||+new Date);var j=this,$=j.as,B=$.graph,N=l._,G=l.put,J=G["#"],U=G["."],P=G[":"],R=G[">"];l["#"];var I;(I=N.msg)&&(I=I.put)&&(I=I[J])&&c(I,U,R,P,J),B[J]=c(B[J],U,R,P,J),(I=($.next||"")[J])&&I.on("in",l),e(N),j.to.next(l)}function e(l,S){var j;if(!l.stop&&!(!l.err&&0<--l.stun)&&(l.stop=1,!!(j=l.root))){var $=l.match;$.end=1,$===j.hatch&&(!($=l.latch)||$.end?delete j.hatch:j.hatch=$),l.hatch&&l.hatch(),setTimeout.each(l.match,function(B){B&&B()}),!(!(S=l.msg)||l.err||S.err)&&(S.out=a,l.root.on("out",S),_())}}function n(l){var S=l["@"]||"",j;if(!(j=S._)){var $=($=l.$)&&($=$._)&&($=$.root)&&($=$.dup);if(!($=$.check(S)))return;l["@"]=$["#"]||l["@"];return}j.acks=(j.acks||0)+1,(j.err=l.err)&&(l["@"]=j["#"],e(j)),j.ok=l.ok||j.ok,!j.stop&&!j.crack&&(j.crack=j.match&&j.match.push(function(){f(j)})),f(j)}function f(l){!l||!l.root||l.stun||l.acks!==l.all||l.root.on("in",{"@":l["#"],err:l.err,ok:l.err?u:l.ok||{"":1}})}var p="Error: Invalid graph!",x=function(l){return" '"+(""+l).slice(0,9)+"...' "},b=JSON.stringify,T=2147483647,D=i.state,C=0,A,_=function(){C>999&&C/-(A-(A=+new Date))>1&&(i.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),_=function(){C=0})}}(),function(){i.on.get=function(y,v){var w=v._,e=y.get,n=e["#"],f=w.graph[n],p=e["."],x=w.next||(w.next={}),b=x[n],T=y._||{},D=T.DBG=y.DBG;if(D&&(D.g=+new Date),!f)return w.on("get",y);if(p){if((typeof p!="string"||u===f[p])&&!((b||"").next||"")[p]){w.on("get",y);return}f=c({},p,t(f,p),f[p],n)}f&&a(y,f),w.on("get",y)};function a(y,v){var w=+new Date,e=y._||{},n=e.DBG=y.DBG,f=y["#"],p=s(9),x=Object.keys(v||"").sort(),b=((v||"")._||"")["#"];x.length;var T=y.$._.root,D=v===T.graph[b];console.STAT&&console.STAT(w,((n||e).gk=+new Date)-w,"got keys"),v&&function C(){w=+new Date;for(var A=0,_,l={},S;A<9&&(_=x[A++]);)c(l,_,t(v,_),v[_],b);x=x.slice(A),(S={})[b]=l,l=S;var j;D&&(j=function(){},j.ram=j.faith=!0),S=x.length,console.STAT&&console.STAT(w,-(w-(w=+new Date)),"got copied some"),n&&(n.ga=+new Date),T.on("in",{"@":f,"#":p,put:l,"%":S?p=s(9):u,$:T.$,_:j,DBG:n,FOO:1}),console.STAT&&console.STAT(w,+new Date-w,"got in"),S&&setTimeout.turn(C)}(),v||T.on("in",{"@":y["#"]})}i.on.get.ack=a}(),function(){i.chain.opt=function(a){a=a||{};var y=this,v=y._,w=a.peers||a;return Object.plain(a)||(a={}),Object.plain(v.opt)||(v.opt=a),typeof w=="string"&&(w=[w]),Object.plain(v.opt.peers)||(v.opt.peers={}),w instanceof Array&&(a.peers={},w.forEach(function(e){var n={};n.id=n.url=e,a.peers[e]=v.opt.peers[e]=v.opt.peers[e]||n})),o(a,function e(n){var f=this[n];if(this&&this.hasOwnProperty(n)||typeof f=="string"||Object.empty(f)){this[n]=f;return}f&&f.constructor!==Object&&!(f instanceof Array)||o(f,e)}),v.opt.from=a,i.on("opt",v),v.opt.uuid=v.opt.uuid||function(e){return i.state().toString(36).replace(".","")+String.random(e||12)},y}}();var o=function(a,y){Object.keys(a).forEach(y,a)},s=String.random,h=setTimeout.turn,d=i.valid,t=i.state.is,c=i.state.ify,u,r={},k;i.log=function(){return!i.log.off&&k.log.apply(k,arguments),[].slice.call(arguments).join(" ")},i.log.once=function(a,y,v){return(v=i.log.once)[a]=v[a]||0,v[a]++||i.log(y)},typeof window<"u"&&((window.GUN=window.Gun=i).window=window);try{typeof O<"u"&&(O.exports=i)}catch{}g.exports=i,(i.window||{}).console=(i.window||{}).console||{log:function(){}},(k=console).only=function(a,y){return k.only.i&&a===k.only.i&&k.only.i++&&(k.log.apply(k,arguments)||y)},i.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(m,"./root"),m(function(g){var i=m("./root");i.chain.back=function(h,d){var t;if(h=h||1,h===-1||h===1/0)return this._.root.$;if(h===1)return(this._.back||this._).$;var c=this,u=c._;if(typeof h=="string"&&(h=h.split(".")),h instanceof Array){var r=0,k=h.length,t=u;for(r;r<k;r++)t=(t||o)[h[r]];return s!==t?d?c:t:(t=u.back)?t.$.back(h,d):void 0}if(typeof h=="function"){for(var a,t={back:u};(t=t.back)&&s===(a=h(t,d)););return a}return typeof h=="number"?(u.back||u).$.back(h-1):this};var o={},s})(m,"./back"),m(function(g){var i=m("./root");i.chain.chain=function(e){var n=this,f=n._,p=new(e||n).constructor(n),x=p._,b;return x.root=b=f.root,x.id=++b.once,x.back=n._,x.on=i.on,x.on("in",i.on.in,x),x.on("out",i.on.out,x),p};function o(e){var n,f=this.as,p=f.back,x=f.root,b;if(e.$||(e.$=f.$),this.to.next(e),f.err){f.on("in",{put:f.put=u,$:f.$});return}if(n=e.get){if(x.pass&&(x.pass[f.id]=f),f.lex&&Object.keys(f.lex).forEach(function(T){b[T]=f.lex[T]},b=e.get=e.get||{}),n["#"]||f.soul){if(n["#"]=n["#"]||f.soul,e["#"]||(e["#"]=r(9)),p=x.$.get(n["#"])._,n=n["."]){if(a(p.put,n)&&(b=p.ask&&p.ask[n],(p.ask||(p.ask={}))[n]=p.$.get(n)._,p.on("in",{get:n,put:{"#":p.soul,".":n,":":p.put[n],">":v(x.graph[p.soul],n)}}),b))return}else{if(b=p.ask&&p.ask[""],(p.ask||(p.ask={}))[""]=p,u!==p.put&&(p.on("in",p),b))return;e.$=p.$}return x.ask(t,e),x.on("in",e)}if(n["."])return f.get?(e={get:{".":f.get},$:f.$},(p.ask||(p.ask={}))[f.get]=e.$._,p.on("out",e)):(e={get:f.lex?e.get:{},$:f.$},p.on("out",e));if((f.ask||(f.ask={}))[""]=f,f.get)return n["."]=f.get,(p.ask||(p.ask={}))[f.get]=e.$._,p.on("out",e)}return p.on("out",e)}i.on.out=o;function s(e,n){n=n||this.as;var f=n.root,p=e.$||(e.$=n.$),x=(p||"")._||c,b=e.put||"",T=b["#"],D=b["."],C=u!==b["="]?b["="]:b[":"],A=b[">"]||-1/0,_;if(u!==e.put&&(u===b["#"]||u===b["."]||u===b[":"]&&u===b["="]||u===b[">"])){if(!k(b)){if(!(T=((b||"")._||"")["#"])){console.log("chain not yet supported for",b,"...",e,n);return}return p=n.root.$.get(T),setTimeout.each(Object.keys(b).sort(),function(l){l=="_"||u===(A=v(b,l))||n.on("in",{$:p,put:{"#":T,".":l,"=":b[l],">":A},VIA:e})})}n.on("in",{$:x.back.$,put:{"#":T=x.back.soul,".":D=x.has||x.get,"=":b,">":v(x.back.put,D)},via:e});return}(e.seen||"")[n.id]||((e.seen||(e.seen=function(){}))[n.id]=n,n!==x&&(Object.keys(e).forEach(function(l){b[l]=e[l]},b={}),b.get=n.get||b.get,!n.soul&&!n.has?b.$$$=b.$$$||n.$:x.soul&&(b.$=n.$,b.$$=b.$$||x.$),e=b),d(e,n),(n.soul||e.$$)&&A>=v(f.graph[T],D)&&((b=f.$.get(T)._).put=w(b.put,D,A,C,T)),!x.soul&&A>=v(f.graph[T],D)&&(_=(f.$.get(T)._.next||"")[D])&&(_.put=C,typeof(b=k(C))=="string"&&(_.put=f.$.get(b)._.put||C)),this.to&&this.to.next(e),n.any&&setTimeout.each(Object.keys(n.any),function(l){(l=n.any[l])&&l(e)},0,99),n.echo&&setTimeout.each(Object.keys(n.echo),function(l){(l=n.echo[l])&&l.on("in",e)},0,99),((e.$$||"")._||x).soul&&(_=n.next)&&(_=_[D])&&(b={},Object.keys(e).forEach(function(l){b[l]=e[l]}),b.$=(e.$$||e.$).get(b.get=D),delete b.$$,delete b.$$$,_.on("in",b)),h(e,n))}i.on.in=s;function h(e,n){if(n=n||this.as||e.$._,!(e.$$&&this!==i.on)&&!(!e.put||n.soul)){var f=e.put||"",p=f["="]||f[":"],x,b=n.root,T=b.$.get(f["#"]).get(f["."])._;if(typeof(p=k(p))!="string"){this===i.on&&((T.echo||(T.echo={}))[n.id]=n);return}if(!((T.echo||(T.echo={}))[n.id]&&!(b.pass||"")[n.id])){if(x=b.pass){if(x[p+n.id])return;x[p+n.id]=1}(T.echo||(T.echo={}))[n.id]=n,n.has&&(n.link=p);var D=b.$.get(T.link=p)._;(D.echo||(D.echo={}))[T.id]=T;var x=n.ask||"";(x[""]||n.lex)&&D.on("out",{get:{"#":p}}),setTimeout.each(Object.keys(x),function(A,_){!A||!(_=x[A])||_.on("out",{get:{"#":p,".":A}})},0,99)}}}i.on.link=h;function d(e,n){var f=e.put||"",p=u!==f["="]?f["="]:f[":"],x=n.root,b,T;if(u===p){if(n.soul&&u!==n.put||(T=(e.$$||e.$||"")._||"",e["@"]&&(u!==T.put||u!==n.put)))return;(b=n.link||e.linked)&&delete(x.$.get(b)._.echo||"")[n.id],n.has&&(n.link=null),n.put=u,setTimeout.each(Object.keys(n.next||""),function(D,C){(C=n.next[D])&&(b&&delete(x.$.get(b).get(D)._.echo||"")[C.id],C.on("in",{get:D,put:u,$:C.$}))},0,99);return}n.soul||e.$$||(b=k(p),T=e.$._||"",!((b===T.link||n.has&&!T.link)&&!((x.pass||"")[n.id]&&typeof b!="string"))&&(delete(T.echo||"")[n.id],d({get:n.get,put:u,$:e.$,linked:e.linked=e.linked||T.link},n)))}i.on.unlink=d;function t(e,n){var f=this.as,p=f.$._;p.root;var x=f.get||"",b=(e.put||"")[x["#"]]||"";if(!e.put||typeof x["."]=="string"&&u===b[x["."]]){if(u!==p.put||!p.soul&&!p.has)return;p.ack=(p.ack||0)+1,p.on("in",{get:p.get,put:p.put=u,$:p.$,"@":e["@"]});return}(e._||{}).miss=1,i.on.put(e)}var c={},u,r=String.random,k=i.valid,a=function(e,n){return e&&Object.prototype.hasOwnProperty.call(e,n)},y=i.state,v=y.is,w=y.ify})(m,"./chain"),m(function(g){var i=m("./root");i.chain.get=function(u,r,k){var a,y;if(typeof u=="string"){if(u.length==0)return(a=this.chain())._.err={err:i.log("0 length key!",u)},r&&r.call(a,a._.err),a;var v=this,w=v._,e=w.next||d;(a=e[u])||(a=u&&o(u,v)),a=a&&a.$}else if(typeof u=="function"){let b=function(D,C,A){if(!b.stun&&!((B=f.pass)&&!B[p])){var _=D.$._,l=(D.$$||"")._,S=(l||_).put,j=!_.has&&!_.soul,$={},B;if((j||c===S)&&(S=c===((B=D.put)||"")["="]?c===(B||"")[":"]?B:B[":"]:B["="]),typeof(B=i.valid(S))=="string"&&(S=c===(B=f.$.get(B)._.put)?n.not?c:S:B),!(n.not&&c===S)){if(c===n.stun){if((B=f.stun)&&B.on&&(w.$.back(function(N){if(B.on(""+N.id,$={}),($.run||0)<b.id)return $}),!$.run&&B.on(""+_.id,$={}),!$.run&&l&&B.on(""+l.id,$={}),b.id>$.run&&((!$.stun||$.stun.end)&&($.stun=B.on("stun"),$.stun=$.stun&&$.stun.last),$.stun&&!$.stun.end))){($.stun.add||($.stun.add={}))[p]=function(){b(D,C,1)};return}if(c===S&&(A=0),(B=f.hatch)&&!B.end&&c===n.hatch&&!A){if(x[_.$._.id])return;x[_.$._.id]=1,B.push(function(){b(D,C,1)});return}x={}}if(f.pass){if(f.pass[p+_.id])return;f.pass[p+_.id]=1}if(n.on){n.ok.call(_.$,S,_.get,D,C||b);return}if(n.v2020){n.ok(D,C||b);return}Object.keys(D).forEach(function(N){B[N]=D[N]},B={}),D=B,D.put=S,n.ok.call(n.as,D,C||b)}}};if(r===!0)return s(this,u,r,k),this;a=this;var w=a._,n=r||{},f=w.root,p;n.at=w,n.ok=u;var x={};return b.at=w,(w.any||(w.any={}))[p=String.random(7)]=b,b.off=function(){b.stun=1,w.any&&delete w.any[p]},b.rid=h,b.id=n.run||++f.once,y=f.pass,(f.pass={})[p]=1,n.out=n.out||{get:{}},w.on("out",n.out),f.pass=y,a}else{if(typeof u=="number")return this.get(""+u,r,k);if(typeof(y=t(u))=="string")return this.get(y,r,k);(y=this.get.next)&&(a=y(this,u))}return a?(r&&typeof r=="function"&&a.get(r,k),a):((a=this.chain())._.err={err:i.log("Invalid get request!",u)},r&&r.call(a,a._.err),a)};function o(u,r){var k=r._,a=k.next,y=r.chain(),v=y._;return a||(a=k.next={}),a[v.get=u]=v,r===k.root.$?v.soul=u:(k.soul||k.has)&&(v.has=u),v}function s(u,r,k,a){var y=u._,v=0,w;return(w=y.soul||y.link)?r(w,a,y):y.jam?y.jam.push([r,a]):(y.jam=[[r,a]],u.get(function(e,n){if(!(c===e.put&&!y.root.opt.super&&(w=Object.keys(y.root.opt.peers).length)&&++v<=w)){n.rid(e);var f=(f=e.$)&&f._||{},p=0,x;for(w=y.jam,delete y.jam;x=w[p++];){var b=x[0];x=x[1],b&&b(f.link||f.soul||i.valid(e.put)||((e.put||{})._||{})["#"],x,e,n)}}},{out:{get:{".":!0}}}),u)}function h(u){var r=this.at||this.on;if(!u||r.soul||r.has)return this.off();if(u=(u=(u=u.$||u)._||u).id){r.map;var k;if((k=this.seen||(this.seen={}))[u])return!0;k[u]=!0}}var d={},t=i.valid,c})(m,"./get"),m(function(g){var i=m("./root");i.chain.put=function(a,y,v){var w=this,e=w._,n=e.root;v=v||{},v.root=e.root,v.run||(v.run=n.once),o(v,e.id),v.ack=v.ack||y,v.via=v.via||w,v.data=v.data||a,v.soul||(v.soul=e.soul||typeof y=="string"&&y);var f=v.state=v.state||i.state();return typeof a=="function"?(a(function(p){v.data=p,w.put(t,t,v)}),w):v.soul?(v.$=n.$.get(v.soul),v.todo=[{it:v.data,ref:v.$}],v.turn=v.turn||u,v.ran=v.ran||s,function p(){var x=v.todo,b=x.pop(),T=b.it;b.ref&&b.ref._.id;var D,C,A,_,l;if(o(v,b.ref),(_=b.todo)&&(C=_.pop(),T=T[C],_.length&&x.push(b)),C&&(x.path||(x.path=[])).push(C),!(D=r(T))&&!(l=i.is(T))){if(!Object.plain(T)){s.err(v,"Invalid data: "+d(T)+" at "+(v.via.back(function(B){B.get&&_.push(B.get)},_=[])||_.join("."))+"."+(x.path||[]).join("."));return}for(var S=v.seen||(v.seen=[]),j=S.length;j--;)if(T===(_=S[j]).it){D=T=_.link;break}}if(C&&D)b.node=k(b.node,C,f,T);else{let B=function(N,G){var J=A.link["#"];G&&(G.off(),G.rid(N));var U=J||N.soul||(_=(N.$$||N.$)._||"").soul||_.link||((_=_.put||"")._||"")["#"]||_["#"]||((_=N.put||"")&&N.$$?_["#"]:(_["="]||_[":"]||"")["#"]);if(!J&&o(v,N.$),!U&&!b.link["#"]){(b.wait||(b.wait=[])).push(function(){B(N,G)});return}U||(U=[],(N.$$||N.$).back(function(P){if(_=P.soul||P.link)return U.push(_);U.push(P.get)}),U=U.reverse().join("/")),A.link["#"]=U,!l&&(((v.graph||(v.graph={}))[U]=A.node||(A.node={_:{}}))._["#"]=U),delete v.wait[$],A.wait&&setTimeout.each(A.wait,function(P){P&&P()}),v.ran(v)};if(!v.seen){s.err(v,"Data at root of graph must be a node (an object).");return}v.seen.push(A={it:T,link:{},todo:l?[]:Object.keys(T).sort().reverse(),path:(x.path||[]).slice(),up:b}),b.node=k(b.node,C,f,A.link),!l&&A.todo.length&&x.push(A);var $=v.seen.length;(v.wait||(v.wait={}))[$]="",_=(A.ref=l?T:C?b.ref.get(C):b.ref)._,(_=T&&(T._||"")["#"]||_.soul||_.link)?B({soul:_}):A.ref.get(B,{run:v.run,v2020:1,out:{get:{".":" "}}})}if(!x.length)return v.ran(v);v.turn(p)}(),w):(h(v),w)};function o(a,y){if(y){y=(y._||"").id||y;var v=a.root.stun||(a.root.stun={on:i.on}),w={},e;a.stun||(a.stun=v.on("stun",function(){})),(e=v.on(""+y))&&e.the.last.next(w),!(w.run>=a.run)&&v.on(""+y,function(n){if(a.stun.end){this.off(),this.to.next(n);return}n.run=n.run||a.run,n.stun=n.stun||a.stun})}}function s(a){if(a.err){s.end(a.stun,a.root);return}if(!(a.todo.length||a.end||!Object.empty(a.wait))){a.end=1;var y=a.$.back(-1)._,v=y.root,w=y.ask(function(p){v.on("ack",p),p.err&&!p.lack&&i.log(p),++e>(a.acks||0)&&this.off(),a.ack&&a.ack(p,this)},a.opt),e=0,n=a.stun,f;(f=function(){n&&(s.end(n,v),setTimeout.each(Object.keys(n=n.add||""),function(p){(p=n[p])&&p()}))}).hatch=f,a.ack&&!a.ok&&(a.ok=a.acks||9),a.via._.on("out",{put:a.out=a.graph,ok:a.ok&&{"@":a.ok+1},opt:a.opt,"#":w,_:f})}}s.end=function(a,y){a.end=c,a.the.to===a&&a===a.the.last&&delete y.stun,a.off()},s.err=function(a,y){(a.ack||c).call(a,a.out={err:a.err=i.log(y)}),a.ran(a)};function h(a){var y=a.via._,v;a.via=a.via.back(function(w){if(w.soul||!w.get)return w.$;v=a.data,(a.data={})[w.get]=v}),(!a.via||!a.via._.soul)&&(a.via=y.root.$.get(((a.data||"")._||"")["#"]||y.$.back("opt.uuid")())),a.via.put(a.data,a.ack,a)}function d(a,y){return a&&(y=a.constructor)&&y.name||typeof a}var t,c=function(){},u=setTimeout.turn,r=i.valid,k=i.state.ify})(m,"./put"),m(function(g){var i=m("./root");m("./chain"),m("./back"),m("./put"),m("./get"),g.exports=i})(m,"./index"),m(function(g){var i=m("./index");i.chain.on=function(h,d,t,c){var u=this,r=u._;r.root;var k;if(typeof h=="string")return d?(k=r.on(h,d,t||r,c),t&&t.$&&(t.subs||(t.subs=[])).push(k),u):r.on(h);var a=d;return(a=a===!0?{change:!0}:a||{}).not=1,a.on=1,u.get(h,a),u},i.chain.once=function(h,d){if(d=d||{},!h)return o(this);var t=this,c=t._,u=c.root;c.put;var r=String.random(7),k;return t.get(function(a,y,v,w){var e=this,n=e._,f=n.one||(n.one={});if(w.stun||f[r]==="")return;if((k=i.valid(a))===!0){p();return}if(typeof k=="string")return;clearTimeout((c.one||"")[r]),clearTimeout(f[r]),f[r]=setTimeout(p,d.wait||99);function p(x){if(!n.has&&!n.soul&&(n={put:a,get:y}),s===(k=n.put)&&(k=((v.$$||"")._||"").put),typeof i.valid(k)=="string"&&(k=u.$.get(k)._.put,k===s&&!x)){f[r]=setTimeout(function(){p(1)},d.wait||99);return}w.stun||f[r]!==""&&(f[r]="",(c.soul||c.has)&&w.off(),h.call(e,k,n.get),clearTimeout(f[r]))}},{on:1}),t};function o(h,d,t){return i.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(t=h.chain())._.nix=h.once(function(c,u){t._.on("in",this._)}),t._.lex=h._.lex,t}i.chain.off=function(){var h=this,d=h._,t,c=d.back;if(c)return d.ack=0,(t=c.next)&&t[d.get]&&delete t[d.get],(t=c.any)&&(delete c.any,c.any={}),(t=c.ask)&&delete t[d.get],(t=c.put)&&delete t[d.get],(t=d.soul)&&delete c.root.graph[t],(t=d.map)&&Object.keys(t).forEach(function(u,r){r=t[u],r.link&&c.root.$.get(r.link).off()}),(t=d.next)&&Object.keys(t).forEach(function(u,r){r=t[u],r.$.off()}),d.on("off",{}),h};var s})(m,"./on"),m(function(g){var i=m("./index"),o=i.chain.get.next;i.chain.get.next=function(t,c){var u;return Object.plain(c)?(u=((u=c["#"])||"")["="]||u)?t.get(u):((u=t.chain()._).lex=c,t.on("in",function(r){String.match(r.get||(r.put||"")["."],c["."]||c["#"]||c)&&u.on("in",r),this.to.next(r)}),u.$):(o||h)(t,c)},i.chain.map=function(t,c,u){var r=this,k=r._,a,y;return Object.plain(t)&&(a=t["."]?t:{".":t},t=d),t?(i.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),y=r.chain(),r.map().on(function(v,w,e,n){var f=(t||h).call(this,v,w,e,n);if(d!==f){if(v===f)return y._.on("in",e);if(i.is(f))return y._.on("in",f._);var p={};Object.keys(e.put).forEach(function(x){p[x]=e.put[x]},p),p["="]=f,y._.on("in",{get:w,put:p})}}),y):((y=k.each)||((k.each=y=r.chain())._.lex=a||y._.lex||k.lex,y._.nix=r.back("nix"),r.on("in",s,y._)),y)};function s(t){this.to.next(t);var c=this.as,u=t.$,r=u._,k=t.put,a;!r.soul&&!t.$$||(a=c.lex)&&!String.match(t.get||(k||"")["."],a["."]||a["#"]||a)||i.on.link(t,c)}var h=function(){},d})(m,"./map"),m(function(g){var i=m("./index");i.chain.set=function(o,s,h){var d=this,t=d.back(-1),c,u;return s=s||function(){},h=h||{},h.item=h.item||o,(c=((o||"")._||"")["#"])&&((o={})["#"]=c),typeof(u=i.valid(o))=="string"?d.get(c=u).put(o,s,h):i.is(o)?(d.put(function(r){o.get(function(k,a,y){if(!k)return s.call(d,{err:i.log('Only a node can be linked! Not "'+y.put+'"!')});(u={})[k]={"#":k},r(u)},!0)}),o):(Object.plain(o)&&(o=t.get(c=d.back("opt.uuid")()).put(o)),d.get(c||t.back("opt.uuid")(7)).put(o,s,h))}})(m,"./set"),m(function(g){m("./shim");var i=function(){},o=JSON.parseAsync||function(t,c,u){var r,k=+new Date;try{c(r,JSON.parse(t,u),s.sucks(+new Date-k))}catch(a){c(a)}},s=JSON.stringifyAsync||function(t,c,u,r){var k,a=+new Date;try{c(k,JSON.stringify(t,u,r),s.sucks(+new Date-a))}catch(y){c(y)}};s.sucks=function(t){t>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),s.sucks=i)};function h(t){var c=function(){},u=t.opt||{};u.log=u.log||console.log,u.gap=u.gap||u.wait||0,u.max=u.max||(u.memory?u.memory*999*999:3e8)*.3,u.pack=u.pack||u.max*.01*.01,u.puff=u.puff||9;var r=setTimeout.turn||setTimeout,k=t.dup,a=k.check,y=k.track,v=c.hear=function(n,f){if(n){if(u.max<=n.length)return c.say({dam:"!",err:"Message too big!"},f);c===this&&(v.d+=n.length||0,++v.c);var p=f.SH=+new Date,x=n[0],b;if(x==="["){o(n,function(T,D){if(T||!D)return c.say({dam:"!",err:"DAM JSON parse error."},f);console.STAT&&console.STAT(+new Date,D.length,"# on hear batch");var C=u.puff;(function A(){for(var _=+new Date,l=0,S;l<C&&(S=D[l++]);)c.hear(S,f);D=D.slice(l),console.STAT&&console.STAT(_,+new Date-_,"hear loop"),w(f),D.length&&r(A,0)})()}),n="";return}if(x==="{"||(n["#"]||Object.plain(n))&&(b=n)){if(b)return v.one(b,f,p);o(n,function(T,D){if(T||!D)return c.say({dam:"!",err:"DAM JSON parse error."},f);v.one(D,f,p)});return}}};v.one=function(n,f,p){var x,b,T,D,C;if(n.DBG&&(n.DBG=C={DBG:n.DBG}),C&&(C.h=p),C&&(C.hp=+new Date),(x=n["#"])||(x=n["#"]=String.random(9)),!(T=a(x))&&(b=n["##"],!(b&&(T=n["@"]||n.get&&x)&&k.check(D=T+b)))){if((n._=function(){}).via=c.leap=f,(T=n["><"])&&typeof T=="string"&&T.slice(0,99).split(",").forEach(function(_){this[_]=1},n._.yo={}),T=n.dam){(T=c.hear[T])&&T(n,f,t),y(x);return}(T=n.ok)&&(n._.near=T["/"]);var p=+new Date;C&&(C.is=p),f.SI=x,y.ed=function(_){x===_&&(y.ed=0,(_=k.s[x])&&(_.via=f,n.get&&(_.it=n)))},t.on("in",c.last=n),C&&(C.hd=+new Date),console.STAT&&console.STAT(p,+new Date-p,n.get?"msg get":n.put?"msg put":"msg"),y(x),D&&y(D),c.leap=c.last=null}},v.c=v.d=0,function(){var n=0,f;c.hash=function(b,T){var D,C,A,_=+new Date;s(b.put,function l(S,j){var $=(C||(C=A=j||"")).slice(0,32768);if(D=String.hash($,D),C=C.slice(32768),C){r(l,0);return}console.STAT&&console.STAT(_,+new Date-_,"say json+hash"),b._.$put=A,b["##"]=D,c.say(b,T),delete b._.$put},p)};function p(b,T){var D;return T instanceof Object?(Object.keys(T).sort().forEach(x,{to:D={},on:T}),D):T}function x(b){this.to[b]=this.on[b]}c.say=function(b,T){var D;if((D=this)&&(D=D.to)&&D.next&&D.next(b),!b)return!1;var C,A,_,l=b["@"],S=b._||(b._=function(){}),j=b.DBG,$=+new Date;if(S.y=S.y||$,T||j&&(j.y=$),(C=b["#"])||(C=b["#"]=String.random(9)),!f&&y(C),!(A=b["##"])&&d!==b.put&&!S.via&&l){c.hash(b,T);return}if(!T&&l&&(T=(D=k.s[l])&&(D.via||(D=D.it)&&(D=D._)&&D.via)||(D=c.last)&&l===D["#"]&&c.leap),!T&&l)return k.s[l]?void 0:(console.STAT&&console.STAT(+new Date,++n,"total no peer to ack to"),!1);if(l&&!b.put&&!A&&((k.s[l]||"").it||"")["##"])return!1;if(!T&&c.way)return c.way(b);if(j&&(j.yh=+new Date),!(_=S.raw)){c.raw(b,T);return}if(j&&(j.yr=+new Date),!T||!T.id){if(!Object.plain(T||u.peers))return!1;var $=+new Date;u.puff;var B=u.peers,N=Object.keys(T||u.peers||{});console.STAT&&console.STAT($,+new Date-$,"peer keys"),function U(){var P=+new Date;f=1;var R=S.raw;S.raw=_;for(var I=0,M;I<9&&(M=(N||"")[I++]);)(M=B[M]||(T||"")[M])&&c.say(b,M);S.raw=R,f=0,N=N.slice(I),console.STAT&&console.STAT(P,+new Date-P,"say loop"),N.length&&(r(U,0),l&&y(l))}();return}if(!T.wire&&c.wire&&c.wire(T),C!==T.last){if(T.last=C,T===S.via||(D=S.yo)&&(D[T.url]||D[T.pid]||D[T.id]))return!1;if(console.STAT&&console.STAT($,((j||S).yp=+new Date)-(S.y||$),"say prep"),!f&&l&&y(l),T.batch){if(T.tail=(D=T.tail||0)+_.length,T.tail<=u.pack){T.batch+=(D?",":"")+_;return}w(T)}T.batch="[";var G=+new Date;setTimeout(function(){console.STAT&&console.STAT(G,+new Date-G,"0ms TO"),w(T)},u.gap),e(_,T),console.STAT&&l===T.SI&&console.STAT($,+new Date-T.SH,"say ack")}},c.say.c=c.say.d=0,c.raw=function(b,T){if(!b)return"";var D=b._||{},C,A;if(A=D.raw)return A;if(typeof b=="string")return b;var _=b["##"],l=b["@"];if(_&&l){if(!D.via&&a(l+_))return!1;if(A=(k.s[l]||"").it){if(_===A["##"])return!1;A["##"]||(A["##"]=_)}}if(!b.dam&&!b["@"]){var S=0,j=[];A=u.peers;for(var $ in A){var B=A[$];if(j.push(B.url||B.pid||B.id),++S>6)break}S>1&&(b["><"]=j.join())}if(b.put&&(A=b.ok)&&(b.ok={"@":(A["@"]||1)-1,"/":A["/"]==b._.near?c.near:A["/"]}),C=D.$put){A={},Object.keys(b).forEach(function(G){A[G]=b[G]}),A.put=":])([:",s(A,function(G,J){if(!G){var U=+new Date;A=J.indexOf('"put":":])([:"'),N(d,J=J.slice(0,A+6)+C+J.slice(A+14)),console.STAT&&console.STAT(U,+new Date-U,"say slice")}});return}s(b,N);function N(G,J){G||(D.raw=J,c.say(b,T))}}}();function w(n){var f=n.batch,p=typeof f=="string";if(p&&(f+="]"),n.batch=n.tail=null,!!f&&!(p?3>f.length:!f.length)){if(!p)try{f=f.length===1?f[0]:JSON.stringify(f)}catch(x){return u.log("DAM JSON stringify error",x)}f&&e(f,n)}}function e(n,f){try{var p=f.wire;f.say?f.say(n):p.send&&p.send(n),c.say.d+=n.length||0,++c.say.c}catch{(f.queue=f.queue||[]).push(n)}}return c.near=0,c.hi=function(n){var f=n.wire,p;if(!f){c.wire(n.length&&{url:n,id:n}||n);return}n.id?u.peers[n.url||n.id]=n:(p=n.id=n.id||n.url||String.random(9),c.say({dam:"?",pid:t.opt.pid},u.peers[p]=n),delete k.s[n.last]),n.met||(c.near++,n.met=+new Date,t.on("hi",n)),p=n.queue,n.queue=[],setTimeout.each(p||[],function(x){e(x,n)},0,9)},c.bye=function(n){n.met&&--c.near,delete n.met,t.on("bye",n);var f=+new Date;f=f-(n.met||f),c.bye.time=((c.bye.time||f)+f)/2},c.hear["!"]=function(n,f){u.log("Error:",n.err)},c.hear["?"]=function(n,f){n.pid&&(f.pid||(f.pid=n.pid),n["@"])||(c.say({dam:"?",pid:u.pid,"@":n["#"]},f),delete k.s[f.last])},c.hear.mob=function(n,f){if(n.peers){var p=Object.keys(n.peers),x=p[Math.random()*p.length>>0];x&&(c.bye(f),c.hi(x))}},t.on("create",function(n){n.opt.pid=n.opt.pid||String.random(9),this.to.next(n),n.on("out",c.say)}),t.on("bye",function(n,f){n=u.peers[n.id||n]||n,this.to.next(n),n.bye?n.bye():(f=n.wire)&&f.close&&f.close(),delete u.peers[n.id],n.wire=null}),t.on("bye",function(n,f){this.to.next(n),(f=console.STAT)&&(f.peers=c.near),(f=n.url)&&setTimeout(function(){},u.lack||9e3)}),t.on("hi",function(n,f){if(this.to.next(n),(f=console.STAT)&&(f.peers=c.near),!u.super){var p=Object.keys(t.next||"");p.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(p,function(x){var b=t.next[x];if(u.super||(b.ask||"")[""]){c.say({get:{"#":x}},n);return}setTimeout.each(Object.keys(b.ask||""),function(T){T&&c.say({"##":String.hash((t.graph[x]||"")[T]),get:{"#":x,".":T}},n)})})}}),c}var d;try{g.exports=h}catch{}})(m,"./mesh"),m(function(g){var i=m("./index");i.Mesh=m("./mesh"),i.on("opt",function(s){if(this.to.next(s),s.once)return;var h=s.opt;if(h.WebSocket===!1)return;var d=i.window||{},t=h.WebSocket||d.WebSocket||d.webkitWebSocket||d.mozWebSocket;if(!t)return;h.WebSocket=t;var c=h.mesh=h.mesh||i.Mesh(s);c.wire||h.wire,c.wire=h.wire=u;function u(y){try{if(!y||!y.url)return w&&w(y);var v=y.url.replace(/^http/,"ws"),w=y.wire=new h.WebSocket(v);return w.onclose=function(){k(y),h.mesh.bye(y)},w.onerror=function(e){k(y)},w.onopen=function(){h.mesh.hi(y)},w.onmessage=function(e){e&&h.mesh.hear(e.data||e,y)},w}catch{h.mesh.bye(y)}}setTimeout(function(){!h.super&&s.on("out",{dam:"hi"})},1);var r=2*999;function k(y){clearTimeout(y.defer),h.peers[y.url]&&(a&&y.retry<=0||(y.retry=(y.retry||h.retry+1||60)-(-y.tried+(y.tried=+new Date)<r*4?1:0),y.defer=setTimeout(function v(){if(a&&a.hidden)return setTimeout(v,r);u(y)},r)))}var a=""+o!=typeof document&&document});var o})(m,"./websocket"),m(function(g){if(!(typeof Gun>"u")){var i=function(){},o;try{o=(Gun.window||i).localStorage}catch{}o||(Gun.log("Warning: No localStorage exists to persist data to!"),o={setItem:function(h,d){this[h]=d},removeItem:function(h){delete this[h]},getItem:function(h){return this[h]}});var s=JSON.stringifyAsync||function(h,d,t,c){var u;try{d(u,JSON.stringify(h,t,c))}catch(r){d(r)}};Gun.on("create",function h(d){this.to.next(d);var t=d.opt;d.graph;var c=[],u,r,k,a;if(t.localStorage===!1)return;t.prefix=t.file||"gun/";try{u=h[t.prefix]=h[t.prefix]||JSON.parse(k=o.getItem(t.prefix))||{}}catch{u=h[t.prefix]={}}k=(k||"").length,d.on("get",function(v){this.to.next(v);var w=v.get,e,n,f,p;!w||!(e=w["#"])||(n=u[e]||p,n&&(f=w["."])&&!Object.plain(f)&&(n=Gun.state.ify({},f,Gun.state.is(n,f),n[f],e)),Gun.on.get.ack(v,n))}),d.on("put",function(v){this.to.next(v);var w=v.put,e=w["#"],n=w["."],f=v["#"],p=v.ok||"";if(u[e]=Gun.state.ify(u[e],n,w[">"],w[":"],e),a&&k>4999880){d.on("in",{"@":f,err:"localStorage max!"});return}!v["@"]&&(!v._.via||Math.random()<p["@"]/p["/"])&&c.push(f),!r&&(r=setTimeout(y,9+k/333))});function y(){if(!c.length&&((setTimeout.turn||"").s||"").length){setTimeout(y,99);return}var v=c;clearTimeout(r),r=!1,c=[],s(u,function(w,e){try{!w&&o.setItem(t.prefix,e)}catch(n){w=a=n||"localStorage failure"}w&&(Gun.log(w+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),d.on("localStorage:error",{err:w,get:t.prefix,put:u})),k=e.length,setTimeout.each(v,function(n){d.on("in",{"@":n,err:w,ok:0})},0,99)})}})}})(m,"./localStorage")})(),function(){var m;if(""+m!=typeof Gun){var O=function(l){console.warn("Warning! Deprecated internal utility will break in next version:",l)},g=Gun;g.fn=g.fn||{is:function(l){return O("fn"),!!l&&typeof l=="function"}},g.bi=g.bi||{is:function(l){return O("bi"),l instanceof Boolean||typeof l=="boolean"}},g.num=g.num||{is:function(l){return O("num"),!i(l)&&(l-parseFloat(l)+1>=0||l===1/0||l===-1/0)}},g.text=g.text||{is:function(l){return O("text"),typeof l=="string"}},g.text.ify=g.text.ify||function(l){return O("text.ify"),g.text.is(l)?l:typeof JSON<"u"?JSON.stringify(l):l&&l.toString?l.toString():l},g.text.random=g.text.random||function(l,S){O("text.random");var j="";for(l=l||24,S=S||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";l>0;)j+=S.charAt(Math.floor(Math.random()*S.length)),l--;return j},g.text.match=g.text.match||function(l,S){var j,$;return O("text.match"),typeof l!="string"?!1:(typeof S=="string"&&(S={"=":S}),S=S||{},j=S["="]||S["*"]||S[">"]||S["<"],l===j?!0:$!==S["="]?!1:(j=S["*"]||S[">"]||S["<"],l.slice(0,(j||"").length)===j?!0:$!==S["*"]?!1:$!==S[">"]&&$!==S["<"]?l>=S[">"]&&l<=S["<"]:$!==S[">"]&&l>=S[">"]||$!==S["<"]&&l<=S["<"]))},g.text.hash=g.text.hash||function(l,S){if(O("text.hash"),typeof l=="string"){if(S=S||0,!l.length)return S;for(var j=0,$=l.length,B;j<$;++j)B=l.charCodeAt(j),S=(S<<5)-S+B,S|=0;return S}},g.list=g.list||{is:function(l){return O("list"),l instanceof Array}},g.list.slit=g.list.slit||Array.prototype.slice,g.list.sort=g.list.sort||function(l){return O("list.sort"),function(S,j){return!S||!j?0:(S=S[l],j=j[l],S<j?-1:S>j?1:0)}},g.list.map=g.list.map||function(l,S,j){return O("list.map"),C(l,S,j)},g.list.index=1,g.obj=g.boj||{is:function(l){return O("obj"),l?l instanceof Object&&l.constructor===Object||Object.prototype.toString.call(l).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},g.obj.put=g.obj.put||function(l,S,j){return O("obj.put"),(l||{})[S]=j,l},g.obj.has=g.obj.has||function(l,S){return O("obj.has"),l&&Object.prototype.hasOwnProperty.call(l,S)},g.obj.del=g.obj.del||function(l,S){if(O("obj.del"),!!l)return l[S]=null,delete l[S],l},g.obj.as=g.obj.as||function(l,S,j,$){return O("obj.as"),l[S]=l[S]||($===j?{}:j)},g.obj.ify=g.obj.ify||function(l){if(O("obj.ify"),p(l))return l;try{l=JSON.parse(l)}catch{l={}}return l},function(){var l;function S(j,$){b(this,$)&&l!==this[$]||(this[$]=j)}g.obj.to=g.obj.to||function(j,$){return O("obj.to"),$=$||{},C(j,S,$),$}}(),g.obj.copy=g.obj.copy||function(l){return O("obj.copy"),l&&JSON.parse(JSON.stringify(l))},function(){function l(S,j){var $=this.n,B;if(!($&&(j===$||p($)&&b($,j)))&&B!==j)return!0}g.obj.empty=g.obj.empty||function(S,j){return O("obj.empty"),S?!C(S,l,{n:j}):!0}}(),function(){function l($,B){if(arguments.length===2){l.r=l.r||{},l.r[$]=B;return}l.r=l.r||[],l.r.push($)}var S=Object.keys,j;Object.keys=Object.keys||function($){return j($,function(B,N,G){G(N)})},g.obj.map=j=g.obj.map||function($,B,N){O("obj.map");var G,J=0,U,P,R,I,M=typeof B=="function";if(l.r=G,S&&p($)&&(R=S($),I=!0),N=N||{},i($)||R)for(U=(R||$).length;J<U;J++){var H=J+g.list.index;if(M){if(P=I?B.call(N,$[R[J]],R[J],l):B.call(N,$[J],H,l),P!==G)return P}else if(B===$[I?R[J]:J])return R?R[J]:H}else for(J in $)if(M){if(b($,J)&&(P=N?B.call(N,$[J],J,l):B($[J],J,l),P!==G))return P}else if(B===$[J])return J;return M?l.r:g.list.index?0:-1}}(),g.time=g.time||{},g.time.is=g.time.is||function(l){return O("time"),l?l instanceof Date:+new Date().getTime()};var n=g.fn.is,i=g.list.is,f=g.obj,p=f.is,b=f.has,C=f.map,o={};o.is=function(l){return O("val.is"),l===m?!1:l===null?!0:l===1/0?!1:d(l)||h(l)||y(l)?!0:o.link.is(l)||!1},o.link=o.rel={_:"#"},function(){o.link.is=function(S){if(O("val.link.is"),S&&S[s]&&!S._&&p(S)){var j={};if(C(S,l,j),j.id)return j.id}return!1};function l(S,j){var $=this;if($.id)return $.id=!1;if(j==s&&d(S))$.id=S;else return $.id=!1}}(),o.link.ify=function(l){return O("val.link.ify"),D({},s,l)},g.obj.has._=".";var s=o.link._,m,h=g.bi.is,y=g.num.is,d=g.text.is,f=g.obj,p=f.is,D=f.put,C=f.map;g.val=g.val||o;var t={_:"_"};t.soul=function(l,S){return O("node.soul"),l&&l._&&l._[S||r]},t.soul.ify=function(l,S){return O("node.soul.ify"),S=typeof S=="string"?{soul:S}:S||{},l=l||{},l._=l._||{},l._[r]=S.soul||l._[r]||u(),l},t.soul._=o.link._,function(){t.is=function(S,j,$){O("node.is");var B;return p(S)&&(B=t.soul(S))?!C(S,l,{as:$,cb:j,s:B,n:S}):!1};function l(S,j){if(j!==t._){if(!o.is(S))return!0;this.cb&&this.cb.call(this.as,S,j,this.n,this.s)}}}(),function(){t.ify=function(S,j,$){return O("node.ify"),j?typeof j=="string"?j={soul:j}:typeof j=="function"&&(j={map:j}):j={},j.map&&(j.node=j.map.call($,S,m,j.node||{})),(j.node=t.soul.ify(j.node||{},j))&&C(S,l,{o:j,as:$}),j.node};function l(S,j){var $=this.o,B,N;if($.map){B=$.map.call(this.as,S,""+j,$.node),N===B?x($.node,j):$.node&&($.node[j]=B);return}o.is(S)&&($.node[j]=S)}}();var f=g.obj,p=f.is,x=f.del,C=f.map,c=g.text,u=c.random,r=t.soul._,m;g.node=g.node||t;var k=g.state;k.lex=function(){return O("state.lex"),k().toString(36).replace(".","")},k.to=function(l,S,j){O("state.to");var $=(l||{})[S];return p($)&&($=A($)),k.ify(j,S,k.is(l,S),$,t.soul(l))},function(){k.map=function(S,j,$){O("state.map");var B,N=p(N=S||j)?N:null;return S=n(S=S||j)?S:null,N&&!S?(j=y(j)?j:k(),N[w]=N[w]||{},C(N,l,{o:N,s:j}),N):($=$||p(j)?j:B,j=y(j)?j:k(),function(G,J,U,P){if(!S)return l.call({o:U,s:j},G,J),G;S.call($||this||{},G,J,U,P),!(b(U,J)&&B===U[J])&&l.call({o:U,s:j},G,J)})};function l(S,j){w!==j&&k.ify(this.o,j,this.s)}}();var f=g.obj;f.as;var b=f.has,p=f.is,C=f.map,A=f.copy,a=g.num,y=a.is,v=g.fn,n=v.is,w=t._,m,e={};(function(){e.is=function(j,$,B,N){return O("graph.is"),!j||!p(j)||T(j)?!1:!C(j,l,{cb:$,fn:B,as:N})};function l(j,$){if(!j||$!==t.soul(j)||!t.is(j,this.fn,this.as))return!0;this.cb&&(S.n=j,S.as=this.as,this.cb.call(S.as,j,$,S))}function S(j){j&&t.is(S.n,j,S.as)}})(),function(){e.ify=function(N,G,J){O("graph.ify");var U={path:[],obj:N};return G?typeof G=="string"?G={soul:G}:typeof G=="function"&&(G.map=G):G={},typeof J=="string"&&(G.soul=G.soul||J,J=m),G.soul&&(U.link=o.link.ify(G.soul)),G.shell=(J||{}).shell,G.graph=G.graph||{},G.seen=G.seen||[],G.as=G.as||J,l(G,U),G.root=U.node,G.graph};function l(N,G){var J;return(J=B(N,G))?J:(G.env=N,G.soul=j,t.ify(G.obj,S,G)&&(G.link=G.link||o.link.ify(t.soul(G.node)),G.obj!==N.shell&&(N.graph[o.link.is(G.link)]=G.node)),G)}function S(N,G,J){var U=this,P=U.env,R,I;if(t._===G&&b(N,o.link._))return J._;if(R=$(N,G,J,U,P)){if(G||(U.node=U.node||J||{},b(N,t._)&&t.soul(N)&&(U.node._=A(N._)),U.node=t.soul.ify(U.node,o.link.is(U.link)),U.link=U.link||o.link.ify(t.soul(U.node))),(I=P.map)&&(I.call(P.as||{},N,G,J,U),b(J,G))){if(N=J[G],m===N){x(J,G);return}if(!(R=$(N,G,J,U,P)))return}if(!G)return U.node;if(R===!0)return N;if(I=l(P,{obj:N,path:U.path.concat(G)}),!!I.node)return I.link}}function j(N){var G=this,J=o.link.is(G.link),U=G.env.graph;G.link=G.link||o.link.ify(N),G.link[o.link._]=N,G.node&&G.node[t._]&&(G.node[t._][o.link._]=N),b(U,J)&&(U[N]=U[J],x(U,J))}function $(N,G,J,U,P){var R;if(o.is(N))return!0;if(p(N))return 1;if(R=P.invalid)return N=R.call(P.as||{},N,G,J),$(N,G,J,U,P);P.err="Invalid value at '"+U.path.concat(G).join(".")+"'!",g.list.is(N)&&(P.err+=" Use `.set(item)` instead of an Array.")}function B(N,G){for(var J=N.seen,U=J.length,P;U--;)if(P=J[U],G.obj===P.obj)return P;J.push(G)}}(),e.node=function(l){O("graph.node");var S=t.soul(l);if(S)return D({},S,l)},function(){e.to=function(S,j,$){if(O("graph.to"),!!S){var B={};return $=$||{seen:{}},C(S[j],l,{obj:B,graph:S,opt:$}),B}};function l(S,j){var $,B;if(t._===j){if(T(S,o.link._))return;this.obj[j]=A(S);return}if(!($=o.link.is(S))){this.obj[j]=S;return}if(B=this.opt.seen[$]){this.obj[j]=B;return}this.obj[j]=this.opt.seen[$]=e.to(this.graph,$,this.opt)}}();var n=g.fn.is,f=g.obj,p=f.is,x=f.del,b=f.has,T=f.empty,D=f.put,C=f.map,A=f.copy,m;g.graph=g.graph||e}}()}(wt)),wt.exports}var Ft=Y();const Vt=_t(Ft);var Ct=typeof window<"u"?window.Gun:Y();Ct.chain.promise=function(O){var m=this,O=O||function(g){return g};return new Promise(function(g,i){m.once(function(o,s){g({put:o,get:s,gun:this})})}).then(O)};Ct.chain.then=function(E){var m=this,O=new Promise((g,i)=>{m.once(function(o,s){g(o,s)})});return E?O.then(E):O};var kt={exports:{}},xt;function st(){return xt||(xt=1,function(){function E(){var o=function(s,h,d){if(o.unit=0,!d&&g!==h&&(o.last=""+s<o.last?o.last:""+s,delete(o.$||{})[i]),d=d||o.$||(o.$={}),!s&&Object.keys(d).length)return d;s=""+s;for(var t=0,c=s.length-1,u=s[t],r,k;!(r=d[u])&&t<c;)u+=s[++t];if(r)if(t==c){if(g===h)return g===(k=r[""])?r:(o.unit=1)&&k;r[""]=h}else return g!==h&&delete r[i],o(s.slice(++t),h,r||(r={}));else{if(!m(d,function(a,y){var v=0,w="";if((y||"").length)for(;y[v]==s[v];)w+=y[v++];if(w){if(g===h)return v<=c?void 0:((k||(k={}))[y.slice(v)]=a,a);var e={};if(e[y.slice(v)]=a,v=s.slice(v),v===""?e[""]=h:(e[v]={})[""]=h,d[w]=e,E.debug&&""+w=="undefined"){console.log(0,w);debugger}return delete d[y],!0}})){if(g===h)return;if((d[u]||(d[u]={}))[""]=h,E.debug&&""+u=="undefined"){console.log(1,u);debugger}}if(g===h)return k}};return o}if(E.map=function o(s,h,d,t){try{t=t||[];var c=typeof s=="function"?s.$||{}:s;//!opt && console.log("WHAT IS T?", JSON.stringify(t).length);
if(!c)return;if(typeof c=="string"){if(E.debug)throw["BUG:",s,h,d,t];return}var u=(c[i]||O).sort||(c[i]=function T(){return T.sort=Object.keys(c).sort(),T}()).sort,r;d=d===!0?{branch:!0}:d||{},(r=d.reverse)&&(u=u.slice(0).reverse());for(var k=d.start,a=d.end,y="ï¿¿",v=0,w=u.length;v<w;v++){var e=u[v],n=c[e],f,p,x;if(!(!n||e===""||i===e||e==="undefined")&&(p=t.slice(0),p.push(e),x=p.join(""),!(g!==k&&x<(k||"").slice(0,x.length))&&!(g!==a&&(a||y)<x))){if(r&&(f=o(n,h,d,p),g!==f))return f;if(g!==(f=n[""])){var b=1;if(g!==k&&x<(k||"")&&(b=0),g!==a&&x>(a||y)&&(b=0),b&&(f=h(f,x,e,t),g!==f))return f}else if(d.branch&&(f=h(g,x,e,t),g!==f))return f;if(t=p,!r&&(f=o(n,h,d,t),g!==f))return f;t.pop()}}}catch(T){console.error(T)}},typeof window<"u")window.Radix=E;else try{kt.exports=E}catch{}var m=E.object=function(o,s,h){for(var d in o)if(o.hasOwnProperty(d)&&(h=s(o[d],d))!==g)return h},O={},g,i=""}()),kt.exports}st();var qt={exports:{}},Tt={exports:{}},St;function Yt(){return St||(St=1,function(E){(function(){var m={},O,g=setTimeout.turn||typeof setImmediate!=""+O&&setImmediate||setTimeout;m.parseAsync=function(o,s,h,d){if(typeof o!="string"){try{s(O,JSON.parse(o))}catch(u){s(u)}return}var t={i:0,text:o,done:s,l:o.length,up:[]};d=d||1024*32,c();function c(){for(var u=t.text,r=t.i,k=t.l,a=0,y=t.w,v,w;a++<d;){var e=u[r++];if(r>k){t.end=!0;break}if(y){for(r=u.indexOf('"',r-1),e=u[r],w=0;u[r-++w]=="\\";);w=!(w%2),v=v||w,e=='"'&&!w&&(y=O,w=t.s,t.a?(w=u.slice(t.sl,r),(v||1+w.indexOf("\\"))&&(w=JSON.parse('"'+w+'"')),t.at instanceof Array?t.at.push(t.s=w):(t.at||(t.end=a=d,w=O),(t.at||{})[t.s]=t.s=w),t.s=O):(t.s=u.slice(t.sl,r),(v||1+t.s.indexOf("\\"))&&(t.s=JSON.parse('"'+t.s+'"'))),t.a=v=O),++r}else switch(e){case'"':t.sl=r,y=!0;break;case":":t.ai=r,t.a=!0;break;case",":(t.a||t.at instanceof Array)&&(w=u.slice(t.ai,r-1))&&O!==(w=i(w))&&(t.at instanceof Array?t.at.push(w):t.at[t.s]=w),t.a=O,t.at instanceof Array&&(t.a=!0,t.ai=r);break;case"{":t.up.push(t.at||(t.at={})),t.at instanceof Array?t.at.push(t.at={}):O!==(w=t.s)&&(t.at[w]=t.at={}),t.a=O;break;case"}":t.a&&(w=u.slice(t.ai,r-1))&&O!==(w=i(w))&&(t.at instanceof Array?t.at.push(w):(t.at||(t.end=a=d,w=O),(t.at||{})[t.s]=w)),t.a=O,t.at=t.up.pop();break;case"[":O!==(w=t.s)?(t.up.push(t.at),t.at[w]=t.at=[]):t.at||t.up.push(t.at=[]),t.a=!0,t.ai=r;break;case"]":t.a&&(w=u.slice(t.ai,r-1))&&O!==(w=i(w))&&(t.at instanceof Array?t.at.push(w):t.at[t.s]=w),t.a=O,t.at=t.up.pop();break}}if(t.s=O,t.i=r,t.w=y,t.end){if(w=t.at,O===w)try{w=JSON.parse(o)}catch(n){return t.done(n)}t.done(O,w)}else g(c)}};function i(o){var s=parseFloat(o);if(!isNaN(s))return s;if(o=o.trim(),o=="true")return!0;if(o=="false")return!1;if(o=="null")return null}m.stringifyAsync=function(o,s,h,d,t){t=t||{},t.text=t.text||"",t.up=[t.at={d:o}],t.done=s,t.i=0;var c=0;u();function u(){var r=t.at,k=r.d,a="",y;switch(r.i&&r.i-r.j>0&&(a+=","),O!==(y=r.k)&&(a+=JSON.stringify(y)+":"),typeof k){case"boolean":a+=""+k;break;case"string":a+=JSON.stringify(k);break;case"number":a+=isNaN(k)?"null":k;break;case"object":if(!k){a+="null";break}if(k instanceof Array){a+="[",r={i:-1,as:k,up:r,j:0},r.l=k.length,t.up.push(t.at=r);break}if(typeof(k||"").toJSON!="function"){a+="{",r={i:-1,ok:Object.keys(k).sort(),as:k,up:r,j:0},r.l=r.ok.length,t.up.push(t.at=r);break}if(y=k.toJSON()){a+=y;break}case"function":if(r.as instanceof Array){a+="null";break}default:a="",r.j++}for(t.text+=a;1+r.i>=r.l;)t.text+=r.ok?"}":"]",r=t.at=r.up;if(++r.i<r.l){if((y=r.ok)?r.d=r.as[r.k=y[r.i]]:r.d=r.as[r.i],++c<9)return u();c=0,g(u);return}t.done(O,t.text)}},typeof window!=""+O&&(window.YSON=m);try{""+O!="object"&&(E.exports=m)}catch{}typeof JSON!=""+O&&(JSON.parseAsync=m.parseAsync,JSON.stringifyAsync=m.stringifyAsync)})()}(Tt)),Tt.exports}var Ot,jt;function Qt(){return jt||(jt=1,Ot=function(E){var m=st();E.find("a",function(){var O=[];m.map(E.list,function(o,s){s.indexOf("%1B")+1&&o&&O.push([s,o])}),O.length&&console.log(`
! ! ! WARNING ! ! !
RAD v0.2020.x has detected OLD v0.2019.x data & automatically migrating. Automatic migration will be turned OFF in future versions! If you are just developing/testing, we recommend you reset your data. Please contact us if you have any concerns.
This message should only log once.`);var g,i;O.forEach(function(o){g=o[0],i=o[1],E.list(decodeURIComponent(g),i),E.list(g,0)}),g&&E.find.bad(g)})}),Ot}(function(){function E(g){g=g||{},g.log=g.log||console.log,g.file=String(g.file||"radata");var i=(E.has||(E.has={}))[g.file];if(i)return i;g.max=g.max||(g.memory?g.memory*999*999:3e8)*.3,g.until=g.until||g.wait||250,g.batch=g.batch||10*1e3,g.chunk=g.chunk||1024*1024*1,g.code=g.code||{},g.code.from=g.code.from||"!",g.jsonify=!0;function o(v){return encodeURIComponent(v).replace(/\*/g,"%2A")}function s(v){return y!==v&&(!v||typeof v!="object")}var h=""+y==typeof setImmediate?setTimeout:setImmediate,d=setTimeout.turn||h,y,t=O.object,c=0;if(!g.store)return g.log("ERROR: Radisk needs `opt.store` interface with `{get: fn, put: fn (, list: fn)}`!");if(!g.store.put)return g.log("ERROR: Radisk needs `store.put` interface with `(file, data, cb)`!");if(!g.store.get)return g.log("ERROR: Radisk needs `store.get` interface with `(file, cb)`!");g.store.list,""+y!=typeof ut("/lib")&&Yt();var u=JSON.parseAsync||function(v,w,e){var n;try{w(n,JSON.parse(v,e))}catch(f){w(f)}},r=function(v,w,e,n,f){if(typeof w=="function"){var p=e||{};e=w,r.read(v,e,p,f||n);return}r.save(v,w,e,n,f)};r.save=function(v,w,e,n,f){var p={key:v},x,b;p.find=function(T){var D;if(p.file=T||(T=g.code.from),f&&(f=f[T]=f[T]||{}),f&&(f.sf=f.sf||+new Date),D=r.disk[T]){p.mix(y,D);return}r.parse(T,p.mix,y,f)},p.mix=function(T,D){if(f&&(f.sml=+new Date),f&&(f.sm=f.sm||+new Date),p.err=T||p.err){e(T);return}var C=p.file=(D||"").file||p.file,A;if(!D&&C!==g.code.from){r.find.bad(C),r.save(v,w,e,n);return}if((D=r.disk[C]||(r.disk[C]=D||O())).file||(D.file=C),g.compare&&(w=g.compare(D(v),w,v,C),y===w)){e(T,-1);return}if((p.disk=D)(v,w),n&&((A=(A=D.tags||(D.tags={}))[n]||(A[n]=r.tags[n]||(r.tags[n]={})))[C]||(A[C]=r.one[n]||(r.one[n]=e)),e=null),f&&(f.st=f.st||+new Date),D.Q){e&&D.Q.push(e);return}D.Q=e?[e]:[],D.to=setTimeout(p.write,g.until)},p.write=function(){f&&(f.sto=f.sto||+new Date);var T=x=p.file,D=p.disk;b=p.q=D.Q,p.tags=D.tags,delete D.Q,delete r.disk[T],delete D.tags,r.write(T,D,p.ack,y,f)},p.ack=function(T,D){f&&(f.sa=f.sa||+new Date),f&&(f.sal=b.length);var C,A;for(var _ in r.tags)if(r.tags.hasOwnProperty(_)){var l=r.tags[_];if(!((A=r.disk[x])&&(A=A.tags)&&A[l])){C=l[x],delete l[x];var S;for(var j in l)if(l.hasOwnProperty(j)){S=!0;break}S||(delete r.tags[l],C&&C(T,D))}}!b&&(b="");for(var $=b.length,B=0,N=+new Date;B<$;B++)(C=b[B])&&C(T,D);console.STAT&&console.STAT(N,+new Date-N,"rad acks",o(p.file)),console.STAT&&console.STAT(N,b.length,"rad acks #",o(p.file))},e||(e=function(T,D){}),r.find(v,p.find)},r.disk={},r.one={},r.tags={};var k=0;r.write=function(v,w,e,n,f){if(!w){e("No radix!");return}n=typeof n=="object"?n:{force:n};var p=function(){},x,b;if(p.text="",p.file=v=w.file||(w.file=v),!v){e("What file?");return}if(p.write=function(){var T=w.raw=p.text;r.disk[v=w.file||p.file||v]=w;var D=+new Date;f&&(f.wd=D),r.find.add(v,function(C){if(f&&(f.wa=+new Date),C){e(C);return}g.store.put(o(v),T,function(A,_){f&&(f.wp=+new Date),console.STAT&&console.STAT(D,c=+new Date-D,"wrote disk",JSON.stringify(v),++k,"total all writes."),e(A,_||1),w.Q||delete r.disk[v]})})},p.split=function(){var T=+new Date;f&&(f.wf=T),p.text="",p.count||(p.count=0,O.map(w,function(){p.count++})),f&&(f.wfc=p.count),p.limit=Math.ceil(p.count/2);var D=p.count;return p.count=0,f&&(f.wf1=+new Date),p.sub=O(),O.map(w,p.slice,{reverse:1}),f&&(f.wf2=+new Date),r.write(p.end,p.sub,p.both,n),f&&(f.wf3=+new Date),p.hub=O(),O.map(w,p.stop),f&&(f.wf4=+new Date),r.write(w.file,p.hub,p.both,n),f&&(f.wf5=+new Date),console.STAT&&console.STAT(T,+new Date-T,"rad split",o(w.file),D),!0},p.slice=function(T,D){if(p.sub(p.end=D,T),p.limit<=++p.count)return!0},p.stop=function(T,D){if(D>=p.end)return!0;p.hub(D,T)},p.both=function(T,D){if(f&&(f.wfd=+new Date),b){e(T||b);return}if(x){e(T,D);return}x=!0,b=T},p.each=function(T,D,C,A){if(y!==T&&p.count++,g.max<=(T||"").length)return e("Data too big!"),!0;var _=E.encode(A.length)+"#"+E.encode(C)+(y===T?"":":"+E.encode(T))+`
`;if(g.chunk<p.text.length+_.length&&1<p.count&&!n.force)return p.split();p.text+=_},g.jsonify){r.write.jsonify(p,w,e,n,f);return}O.map(w,p.each,!0)||p.write()},r.write.jsonify=function(v,w,e,n,f){var p,x=+new Date;f&&(f.w=x);try{p=JSON.stringify(w.$)}catch{e("Cannot radisk!");return}if(f&&(f.ws=+new Date),console.STAT&&console.STAT(x,+new Date-x,"rad stringified JSON"),g.chunk<p.length&&!n.force){var b=0;if(O.map(w,function(){if(b++)return!0}),b>1)return v.split()}v.text=p,v.write()},r.range=function(v,w){if(!(!v||!w)){if(y===w.start&&y===w.end||s(v))return v;var e=O();return O.map(v,function(n,f){e(f,n)},w),e("")}},function(){r.read=function(v,w,e,n){e=e||{};var f={key:v};f.find=function(p){var x;if(f.file=p||(p=g.code.from),n&&(n=n[p]=n[p]||{}),n&&(n.rf=n.rf||+new Date),x=r.disk[f.file=p]){f.check(y,x);return}r.parse(p,f.check,y,n)},f.get=function(p,x,b){if(n&&(n.rgl=+new Date),n&&(n.rg=n.rg||+new Date),f.err=p||f.err){w(p);return}var T=f.file=(x||"").file||f.file;if(!x&&T!==g.code.from){r.find.bad(T),r.read(v,w,e);return}if(x=r.disk[T]||(r.disk[T]=x),!x){w(T===g.code.from?y:"No file!");return}x.file||(x.file=T);var D=r.range(x(v),e);if(n&&(n.rr=+new Date),e.unit=x.unit,e.chunks=(e.chunks||0)+1,e.parsed=(e.parsed||0)+((b||"").parsed||e.chunks*g.chunk),e.more=1,e.next=y,O.map(r.list,function(_,l){if(!(!_||T===l))return e.next=l,1},e.reverse?{reverse:1,end:T}:{start:T}),n&&(n.rl=+new Date),e.next||(e.more=0),e.next&&(!e.reverse&&(v<e.next&&e.next.indexOf(v)!=0||y!==e.end&&(e.end||"ï¿¿")<e.next)&&(e.more=0),e.reverse&&(v>e.next&&v.indexOf(e.next)!=0||y!==e.start&&(e.start||"")>e.next&&T<=e.start)&&(e.more=0)),!e.more){w(f.err,D,e);return}if(D&&w(f.err,D,e),!(e.parsed>=e.limit)){var C=+new Date;n&&(n.rm=C);var A=e.next;h(function(){console.STAT&&console.STAT(C,+new Date-C,"rad more"),r.parse(A,f.check)},0)}},f.check=function(p,x,b){if(f.get(p,x,b),!(!x||x.check)){x.check=1;var T=+new Date;(b||(b={})).file||(b.file=f.file),O.map(x,function(D,C){r.find(C,function(A){if((A||(A=g.code.from))!==b.file){var _=(""+Math.random()).slice(-3);d(function(){r.save(C,D,function l(S,j){if(S){r.save(C,D,l);return}console.STAT&&console.STAT("MISLOCATED DATA CORRECTED",_,o(C),o(b.file),o(A))})},0)}})}),console.STAT&&console.STAT(T,+new Date-T,"rad check")}},r.find(v||(e.reverse?e.end||"":e.start||""),f.find)}}(),function(){var v=0,w={},e="";r.parse=function(n,f,p,x){var b;if(!n)return f();if(b=w[n]){b.push(f);return}b=w[n]=[f];var T=function(){},D={file:n};(T.disk=O()).file=n,T.read=function(A,_){if(x&&(x.rpg=+new Date),console.STAT&&console.STAT(C,+new Date-C,"read disk",JSON.stringify(n),++v,"total all parses."),(T.err=A)||(T.not=!_)){delete w[n],T.map(b,T.ack);return}if(typeof _!="string"){try{g.max<=_.length?T.err="Chunk too big!":_=_.toString()}catch(l){T.err=l}if(T.err){delete w[n],T.map(b,T.ack);return}}if(D.parsed=_.length,x&&(x.rpl=D.parsed),x&&(x.rpa=b.length),C=+new Date,!(g.jsonify||_[0]==="{")){T.radec(A,_);return}u(_,function(l,S){if(!l){delete w[n],T.disk.$=S,console.STAT&&(c=+new Date-C)>9&&console.STAT(C,c,"rad parsed JSON"),x&&(x.rpd=+new Date),T.map(b,T.ack);return}if(_[0]==="{"){delete w[n],T.err="JSON error!",T.map(b,T.ack);return}T.radec(l,_)})},T.map=function(){if(!(!b||!b.length)){for(var A=+new Date,_=T.err,l=T.not?y:T.disk,S=0,j;S<9&&(j=b[S++]);)j(_,l,D);console.STAT&&console.STAT(A,+new Date-A,"rad packs",o(n)),console.STAT&&console.STAT(A,S,"rad packs #",o(n)),(b=b.slice(S)).length&&d(T.map,0)}},T.ack=function(A){if(A){if(T.err||T.not){A(T.err,y,D);return}A(y,T.disk,D)}},T.radec=function(A,_){delete w[n],C=+new Date;var l=T.split(_),S=[],j,$,B;if(!l||l[1]!==0){T.err="File '"+n+"' does not have root radix! ",T.map(b,T.ack);return}for(;l;)$=B=y,j=l[1],l=T.split(l[2])||"",l[0]=="#"&&($=l[1],S=S.slice(0,j),j<=S.length&&S.push($)),l=T.split(l[2])||"",l[0]!=`
`&&((l[0]=="="||l[0]==":")&&(B=l[1]),y!==$&&y!==B&&T.disk(S.join(""),B),l=T.split(l[2]));console.STAT&&console.STAT(C,+new Date-C,"parsed RAD"),T.map(b,T.ack)},T.split=function(A){if(A){var _=[],l={},S=-1,j="";if(S=A.indexOf(e),!!A[S])return j=A.slice(0,S),_[0]=j,_[1]=E.decode(A.slice(S),l),_[2]=A.slice(S+l.i),_}},r.disk&&(p||(p=(r.disk[n]||"").raw));var C=+new Date;if(x&&(x.rp=C),p)return d(function(){T.read(y,p)},0);g.store.get(o(n),T.read)}}(),function(){var v,w="",e;r.find=function(p,x){if(!v){if(e){e.push([p,x]);return}e=[[p,x]],r.parse(w,n);return}O.map(r.list=v,function(b,T){if(b)return x(T)||!0},{reverse:1,end:p})||x(g.code.from)},r.find.add=function(p,x){var b=v(p);if(b||p===w){x(y,1);return}v(p,1),x.found=(x.found||0)+1,r.write(w,v,function(T,D){if(T){x(T);return}x.found=(x.found||0)-1,x.found===0&&x(y,1)},!0)},r.find.bad=function(p,x){v(p,0),r.write(w,v,x||a)};function n(p,x){if(p){g.log("list",p),setTimeout(function(){r.parse(w,n)},1e3);return}if(x){f(x);return}if(v=v||x||O(),!g.store.list){f(v);return}g.store.list(function(b){if(!b){f(v);return}r.find.add(b,a)})}function f(p,x){v=v||p,v.file=w,x=e,e=null,t(x,function(b){r.find(b[0],b[1])})}}();try{!m.window&&Qt()(r)}catch{}var a=function(){},y;return E.has[g.file]=r,r}if(function(){var g="";E.encode=function(i,o,s){s=s||g;var h=s,d;if(typeof i=="string"){for(var t=i.indexOf(s);t!=-1;)h+=s,t=i.indexOf(s,t+1);return h+'"'+i+s}else{if(i&&i["#"]&&Object.keys(i).length==1)return h+"#"+d+h;if(typeof i=="number")return h+"+"+(i||0)+h;if(i===null)return h+" "+h;if(i===!0)return h+"+"+h;if(i===!1)return h+"-"+h}},E.decode=function(i,o,s){s=s||g;var h="",d=-1,t=0,c,u;if(s===i[0]){for(;s===i[++d];)++t;for(u=i[c=t]||!0;--t>=0;)d=i.indexOf(s,d+1);if(d==-1&&(d=i.length),h=i.slice(c+1,d),o&&(o.i=d+1),u==='"')return h;if(u==="#")return{"#":h};if(u==="+")return h.length===0?!0:parseFloat(h);if(u===" ")return null;if(u==="-")return!1}}}(),typeof window<"u"){var m=window.Gun,O=window.Radix;window.Radisk=E}else{var m=Y(),O=st();try{qt.exports=E}catch{}}E.Radix=O})();var Xt={exports:{}};(function(){function E(O){O=O||{},O.file=String(O.file||"radata");var g=E[O.file],i=null,o;if(g)return console.log("Warning: reusing same IndexedDB store and options as 1st."),E[O.file];g=E[O.file]=function(){};try{O.indexedDB=O.indexedDB||E.indexedDB||indexedDB}catch{}try{if(!O.indexedDB||location.protocol=="file:"){var s=g.d||(g.d={});return g.put=function(h,d,t){s[h]=d,setTimeout(function(){t(null,1)},250)},g.get=function(h,d){setTimeout(function(){d(null,s[h]||o)},5)},console.log("Warning: No indexedDB exists to persist data to!"),g}}catch{}return g.start=function(){var h=indexedDB.open(O.file,1);h.onupgradeneeded=function(d){d.target.result.createObjectStore(O.file)},h.onsuccess=function(){i=h.result},h.onerror=function(d){console.log(d||1)}},g.start(),g.put=function(h,d,t){if(!i){setTimeout(function(){g.put(h,d,t)},1);return}var c=i.transaction([O.file],"readwrite"),u=c.objectStore(O.file),r=u.put(d,""+h);r.onsuccess=u.onsuccess=c.onsuccess=function(){t(null,1)},r.onabort=u.onabort=c.onabort=function(k){t(k||"put.tx.abort")},r.onerror=u.onerror=c.onerror=function(k){t(k||"put.tx.error")}},g.get=function(h,d){if(!i){setTimeout(function(){g.get(h,d)},9);return}var t=i.transaction([O.file],"readonly"),c=t.objectStore(O.file),u=c.get(""+h);u.onsuccess=function(){d(null,u.result)},u.onabort=function(r){d(r||4)},u.onerror=function(r){d(r||5)}},setInterval(function(){i&&i.close(),i=null,g.start()},1e3*15),g}if(typeof window<"u")(E.window=window).RindexedDB=E,E.indexedDB=window.indexedDB;else try{Xt.exports=E}catch{}try{var m=E.window.Gun||Y();m.on("create",function(O){this.to.next(O),O.opt.store=O.opt.store||E(O.opt)})}catch{}})();(function(){var E=typeof window<"u"?window.Gun:Y();E.on("opt",function(m){this.to.next(m);var O=m.opt;if(m.once||!E.Mesh||O.RTCPeerConnection===!1)return;var g;typeof window<"u"&&(g=window),typeof tt<"u"&&(g=tt),g=g||{};var i=O.RTCPeerConnection||g.RTCPeerConnection||g.webkitRTCPeerConnection||g.mozRTCPeerConnection,o=O.RTCSessionDescription||g.RTCSessionDescription||g.webkitRTCSessionDescription||g.mozRTCSessionDescription,s=O.RTCIceCandidate||g.RTCIceCandidate||g.webkitRTCIceCandidate||g.mozRTCIceCandidate;if(!i||!o||!s)return;O.RTCPeerConnection=i,O.RTCSessionDescription=o,O.RTCIceCandidate=s,O.rtc=O.rtc||{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.sipgate.net:3478"}]},O.rtc.dataChannel=O.rtc.dataChannel||{ordered:!1,maxRetransmits:2},O.rtc.sdp=O.rtc.sdp||{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},O.rtc.max=O.rtc.max||55,O.rtc.room=O.rtc.room||E.window&&(location.hash.slice(1)||location.pathname.slice(1)),O.announce=function(t){O.rtc.start=+new Date,m.$.get("/RTC/"+O.rtc.room+"<?99").get("+").put(O.pid,function(c){!c.ok||!c.ok.rtc||d(c)},{acks:O.rtc.max}).on(function(c,u,r){c===O.pid||O.rtc.start>r.put[">"]||d({"#":""+r["#"],ok:{rtc:{id:c}}})})};var h=O.mesh=O.mesh||E.Mesh(m);m.on("create",function(t){this.to.next(t),setTimeout(O.announce,1)});function d(t){if(this&&this.off&&this.off(),!!t.ok){var c=t.ok.rtc,u,r;if(!(!c||!c.id||c.id===O.pid)){if(r=c.answer)return!(u=O.peers[c.id]||d[c.id])||u.remoteSet?void 0:(r.sdp=r.sdp.replace(/\\r\\n/g,`\r
`),u.setRemoteDescription(u.remoteSet=new O.RTCSessionDescription(r)));if(r=c.candidate)return u=O.peers[c.id]||d[c.id]||d({ok:{rtc:{id:c.id}}}),u.addIceCandidate(new O.RTCIceCandidate(r));if(!d[c.id]){(u=new O.RTCPeerConnection(O.rtc)).id=c.id;var k=u.wire=u.createDataChannel("dc",O.rtc.dataChannel);if(d[c.id]=u,k.to=setTimeout(function(){delete d[c.id]},1e3*60),k.onclose=function(){h.bye(u)},k.onerror=function(a){},k.onopen=function(a){delete d[c.id],h.hi(u)},k.onmessage=function(a){a&&h.hear(a.data||a,u)},u.onicecandidate=function(a){a.candidate&&m.on("out",{"@":t["#"],ok:{rtc:{candidate:a.candidate,id:O.pid}}})},u.ondatachannel=function(a){var y=a.channel;y.onmessage=k.onmessage,y.onopen=k.onopen,y.onclose=k.onclose},r=c.offer){c.offer.sdp=c.offer.sdp.replace(/\\r\\n/g,`\r
`),u.setRemoteDescription(new O.RTCSessionDescription(r)),u.createAnswer(function(a){u.setLocalDescription(a),m.on("out",{"@":t["#"],ok:{rtc:{answer:a,id:O.pid}}})},function(){},O.rtc.sdp);return}return u.createOffer(function(a){u.setLocalDescription(a),m.on("out",{"@":t["#"],"#":m.ask(d),ok:{rtc:{offer:a,id:O.pid}}})},function(){},O.rtc.sdp),u}}}}})})();var Bt={exports:{}};(function(E){(function(){function m(g,i){return i?ut("/")(g):g.slice?m[o(g)]:function(s,h){g(s={exports:{}}),m[o(h)]=s.exports};function o(s){return s.split("/").slice(-1).toString().replace(".js","")}}var O=E;m(function(g){typeof self<"u"&&(g.window=self),typeof window<"u"&&(g.window=window);var i=g.window||g,o,s=i.SEA||{};(s.window=g.window)&&(s.window.SEA=s);try{o+""!=typeof O&&(O.exports=s)}catch{}g.exports=s})(m,"./root"),m(function(g){var i=m("./root");try{i.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(m,"./https"),m(function(g){var i;if(i+""==typeof btoa){if(i+""==typeof Buffer)try{tt.Buffer=m("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}tt.btoa=function(o){return Buffer.from(o,"binary").toString("base64")},tt.atob=function(o){return Buffer.from(o,"base64").toString("binary")}}})(m,"./base64"),m(function(g){m("./base64");function i(){}Object.assign(i,{from:Array.from}),i.prototype=Object.create(Array.prototype),i.prototype.toString=function(o,s,h){o=o||"utf8",s=s||0;const d=this.length;if(o==="hex"){const t=new Uint8Array(this);return[...Array((h&&h+1||d)-s).keys()].map(c=>t[c+s].toString(16).padStart(2,"0")).join("")}if(o==="utf8")return Array.from({length:(h||d)-s},(t,c)=>String.fromCharCode(this[c+s])).join("");if(o==="base64")return btoa(this)},g.exports=i})(m,"./array"),m(function(g){m("./base64");var i=m("./array");function o(...s){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),o.from(...s)}o.prototype=Object.create(Array.prototype),Object.assign(o,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const s=arguments[0];let h;if(typeof s=="string"){const d=arguments[1]||"utf8";if(d==="hex"){const t=s.match(/([\da-fA-F]{2})/g).map(c=>parseInt(c,16));if(!t||!t.length)throw new TypeError("Invalid first argument for type 'hex'.");h=i.from(t)}else if(d==="utf8"||d==="binary"){const t=s.length,c=new Uint16Array(t);Array.from({length:t},(u,r)=>c[r]=s.charCodeAt(r)),h=i.from(c)}else if(d==="base64"){const t=atob(s),c=t.length,u=new Uint8Array(c);Array.from({length:c},(r,k)=>u[k]=t.charCodeAt(k)),h=i.from(u)}else d==="binary"?h=i.from(s):console.info("SafeBuffer.from unknown encoding: "+d);return h}if(s.byteLength,s.byteLength?s.byteLength:s.length){let d;return s instanceof ArrayBuffer&&(d=new Uint8Array(s)),i.from(d||s)}},alloc(s,h=0){return i.from(new Uint8Array(Array.from({length:s},()=>h)))},allocUnsafe(s){return i.from(new Uint8Array(Array.from({length:s})))},concat(s){if(!Array.isArray(s))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return i.from(s.reduce((h,d)=>h.concat(Array.from(d)),[]))}}),o.prototype.from=o.from,o.prototype.toString=i.prototype.toString,g.exports=o})(m,"./buffer"),m(function(g){const i=m("./root"),o={Buffer:m("./buffer")};var s={},h;if(JSON.parseAsync=JSON.parseAsync||function(t,c,u){var r;try{c(r,JSON.parse(t,u))}catch(k){c(k)}},JSON.stringifyAsync=JSON.stringifyAsync||function(t,c,u,r){var k;try{c(k,JSON.stringify(t,u,r))}catch(a){c(a)}},o.parse=function(t,c){return new Promise(function(u,r){JSON.parseAsync(t,function(k,a){k?r(k):u(a)},c)})},o.stringify=function(t,c,u){return new Promise(function(r,k){JSON.stringifyAsync(t,function(a,y){a?k(a):r(y)},c,u)})},i.window&&(o.crypto=i.window.crypto||i.window.msCrypto,o.subtle=(o.crypto||s).subtle||(o.crypto||s).webkitSubtle,o.TextEncoder=i.window.TextEncoder,o.TextDecoder=i.window.TextDecoder,o.random=t=>o.Buffer.from(o.crypto.getRandomValues(new Uint8Array(o.Buffer.alloc(t))))),!o.TextDecoder){const{TextEncoder:t,TextDecoder:c}=m((h+""==typeof O?".":"")+"./lib/text-encoding",1);o.TextDecoder=c,o.TextEncoder=t}if(!o.crypto)try{var d=m("crypto",1);Object.assign(o,{crypto:d,random:c=>o.Buffer.from(d.randomBytes(c))});const{Crypto:t}=m("@peculiar/webcrypto",1);o.ossl=o.subtle=new t({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}g.exports=o})(m,"./shim"),m(function(g){var i=m("./root"),o=m("./shim"),s={};s.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},s.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},s.ecdh={name:"ECDH",namedCurve:"P-256"},s.jwk=function(h,d){h=h.split(".");var t=h[0],c=h[1],u={kty:"EC",crv:"P-256",x:t,y:c,ext:!0};return u.key_ops=d?["sign"]:["verify"],d&&(u.d=d),u},s.keyToJwk=function(h){return{kty:"oct",k:h.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},s.recall={validity:12*60*60,hook:function(h){return h}},s.check=function(h){return typeof h=="string"&&h.slice(0,4)==="SEA{"},s.parse=async function(h){try{var d=typeof h=="string";return d&&h.slice(0,4)==="SEA{"&&(h=h.slice(3)),d?await o.parse(h):h}catch{}return h},i.opt=s,g.exports=s})(m,"./settings"),m(function(g){var i=m("./shim");g.exports=async function(o,s){var h=typeof o=="string"?o:await i.stringify(o),d=await i.subtle.digest({name:s||"SHA-256"},new i.TextEncoder().encode(h));return i.Buffer.from(d)}})(m,"./sha256"),m(function(g){const i=m("./shim"),o=i.subtle,s=i.ossl?i.ossl:o,h=d=>s.digest({name:"SHA-1"},new ArrayBuffer(d));g.exports=h})(m,"./sha1"),m(function(g){var i=m("./root"),o=m("./shim"),s=m("./settings"),h=m("./sha256"),d;i.work=i.work||(async(t,c,u,r)=>{try{var k=(c||{}).epub||c;if(r=r||{},k instanceof Function&&(u=k,k=d),t=typeof t=="string"?t:await o.stringify(t),(r.name||"").toLowerCase().slice(0,3)==="sha"){var a=o.Buffer.from(await h(t,r.name),"binary").toString(r.encode||"base64");if(u)try{u(a)}catch(e){console.log(e)}return a}k=k||o.random(9);var y=await(o.ossl||o.subtle).importKey("raw",new o.TextEncoder().encode(t),{name:r.name||"PBKDF2"},!1,["deriveBits"]),v=await(o.ossl||o.subtle).deriveBits({name:r.name||"PBKDF2",iterations:r.iterations||s.pbkdf2.iter,salt:new o.TextEncoder().encode(r.salt||k),hash:r.hash||s.pbkdf2.hash},y,r.length||s.pbkdf2.ks*8);t=o.random(t.length);var w=o.Buffer.from(v,"binary").toString(r.encode||"base64");if(u)try{u(w)}catch(e){console.log(e)}return w}catch(e){if(console.log(e),i.err=e,i.throw)throw e;u&&u();return}}),g.exports=i.work})(m,"./work"),m(function(g){var i=m("./root"),o=m("./shim");m("./settings"),i.name=i.name||(async(s,h)=>{try{if(s)try{s()}catch(d){console.log(d)}return}catch(d){if(console.log(d),i.err=d,i.throw)throw d;s&&s();return}}),i.pair=i.pair||(async(s,h)=>{try{var d=o.ossl||o.subtle,t=await o.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async r=>{var k={};k.priv=(await o.subtle.exportKey("jwk",r.privateKey)).d;var a=await o.subtle.exportKey("jwk",r.publicKey);return k.pub=a.x+"."+a.y,k});try{var c=await d.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async r=>{var k={};k.epriv=(await d.exportKey("jwk",r.privateKey)).d;var a=await d.exportKey("jwk",r.publicKey);return k.epub=a.x+"."+a.y,k})}catch(r){if(i.window)throw r;if(r=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw r}c=c||{};var u={pub:t.pub,priv:t.priv,epub:c.epub,epriv:c.epriv};if(s)try{s(u)}catch(r){console.log(r)}return u}catch(r){if(console.log(r),i.err=r,i.throw)throw r;s&&s();return}}),g.exports=i.pair})(m,"./pair"),m(function(g){var i=m("./root"),o=m("./shim"),s=m("./settings"),h=m("./sha256"),d;i.sign=i.sign||(async(t,c,u,r)=>{try{if(r=r||{},!(c||r).priv){if(!i.I)throw"No signing key.";c=await i.I(null,{what:t,how:"sign",why:r.why})}if(d===t)throw"`undefined` not allowed.";var k=await s.parse(t),a=r.check=r.check||k;if(i.verify&&(i.opt.check(a)||a&&a.s&&a.m)&&d!==await i.verify(a,c)){var f=await s.parse(a);if(r.raw||(f="SEA"+await o.stringify(f)),u)try{u(f)}catch(x){console.log(x)}return f}var y=c.pub,v=c.priv,w=s.jwk(y,v),e=await h(k),n=await(o.ossl||o.subtle).importKey("jwk",w,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(p=>(o.ossl||o.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},p,new Uint8Array(e))),f={m:k,s:o.Buffer.from(n,"binary").toString(r.encode||"base64")};if(r.raw||(f="SEA"+await o.stringify(f)),u)try{u(f)}catch(p){console.log(p)}return f}catch(p){if(console.log(p),i.err=p,i.throw)throw p;u&&u();return}}),g.exports=i.sign})(m,"./sign"),m(function(g){var i=m("./root"),o=m("./shim"),s=m("./settings"),h=m("./sha256"),d;i.verify=i.verify||(async(u,r,k,a)=>{try{var y=await s.parse(u);if(r===!1){var v=await s.parse(y.m);if(k)try{k(v)}catch(D){console.log(D)}return v}a=a||{};var w=r.pub||r,e=i.opt.slow_leak?await i.opt.slow_leak(w):await(o.ossl||o.subtle).importKey("jwk",s.jwk(w),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),n=await h(y.m),f,p,x,b;try{if(f=o.Buffer.from(y.s,a.encode||"base64"),p=new Uint8Array(f),x=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},e,p,new Uint8Array(n)),!x)throw"Signature did not match."}catch{if(i.opt.fallback)return await i.opt.fall_verify(u,r,k,a)}var T=x?await s.parse(y.m):d;if(k)try{k(T)}catch(D){console.log(D)}return T}catch(D){if(console.log(D),i.err=D,i.throw)throw D;k&&k();return}}),g.exports=i.verify;var t={};i.opt.slow_leak=u=>{if(t[u])return t[u];var r=s.jwk(u);return t[u]=(o.ossl||o.subtle).importKey("jwk",r,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),t[u]};var c=i.opt;i.opt.fall_verify=async function(u,r,k,a,y){if(y===i.opt.fallback)throw"Signature did not match";y=y||1;var v=u||"";u=i.opt.unpack(u)||u;var w=await s.parse(u),e=r.pub||r,n=await i.opt.slow_leak(e),f=y<=i.opt.fallback?o.Buffer.from(await o.subtle.digest({name:"SHA-256"},new o.TextEncoder().encode(await s.parse(w.m)))):await h(w.m),p,x,b;try{if(p=o.Buffer.from(w.s,a.encode||"base64"),x=new Uint8Array(p),b=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},n,x,new Uint8Array(f)),!b)throw"Signature did not match."}catch{try{p=o.Buffer.from(w.s,"utf8"),x=new Uint8Array(p),b=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},n,x,new Uint8Array(f))}catch{if(!b)throw"Signature did not match."}}var T=b?await s.parse(w.m):d;if(c.fall_soul=v["#"],c.fall_key=v["."],c.fall_val=u,c.fall_state=v[">"],k)try{k(T)}catch(D){console.log(D)}return T},i.opt.fallback=2})(m,"./verify"),m(function(g){var i=m("./shim"),o=m("./settings"),s=m("./sha256");const h=async(d,t,c)=>{const u=d+(t||i.random(8)).toString("utf8"),r=i.Buffer.from(await s(u),"binary"),k=o.keyToJwk(r);return await i.subtle.importKey("jwk",k,{name:"AES-GCM"},!1,["encrypt","decrypt"])};g.exports=h})(m,"./aeskey"),m(function(g){var i=m("./root"),o=m("./shim");m("./settings");var s=m("./aeskey"),h;i.encrypt=i.encrypt||(async(d,t,c,u)=>{try{u=u||{};var r=(t||u).epriv||t;if(h===d)throw"`undefined` not allowed.";if(!r){if(!i.I)throw"No encryption key.";t=await i.I(null,{what:d,how:"encrypt",why:u.why}),r=t.epriv||t}var k=typeof d=="string"?d:await o.stringify(d),a={s:o.random(9),iv:o.random(15)},y=await s(r,a.s,u).then(w=>o.subtle.encrypt({name:u.name||"AES-GCM",iv:new Uint8Array(a.iv)},w,new o.TextEncoder().encode(k))),v={ct:o.Buffer.from(y,"binary").toString(u.encode||"base64"),iv:a.iv.toString(u.encode||"base64"),s:a.s.toString(u.encode||"base64")};if(u.raw||(v="SEA"+await o.stringify(v)),c)try{c(v)}catch(w){console.log(w)}return v}catch(w){if(console.log(w),i.err=w,i.throw)throw w;c&&c();return}}),g.exports=i.encrypt})(m,"./encrypt"),m(function(g){var i=m("./root"),o=m("./shim"),s=m("./settings"),h=m("./aeskey");i.decrypt=i.decrypt||(async(d,t,c,u)=>{try{u=u||{};var r=(t||u).epriv||t;if(!r){if(!i.I)throw"No decryption key.";t=await i.I(null,{what:d,how:"decrypt",why:u.why}),r=t.epriv||t}var k=await s.parse(d),a,y,v;try{a=o.Buffer.from(k.s,u.encode||"base64"),y=o.Buffer.from(k.iv,u.encode||"base64"),v=o.Buffer.from(k.ct,u.encode||"base64");var w=await h(r,a,u).then(n=>o.subtle.decrypt({name:u.name||"AES-GCM",iv:new Uint8Array(y),tagLength:128},n,new Uint8Array(v)))}catch{if(u.encode==="utf8")throw"Could not decrypt";if(i.opt.fallback)return u.encode="utf8",await i.decrypt(d,t,c,u)}var e=await s.parse(new o.TextDecoder("utf8").decode(w));if(c)try{c(e)}catch(n){console.log(n)}return e}catch(n){if(console.log(n),i.err=n,i.throw)throw n;c&&c();return}}),g.exports=i.decrypt})(m,"./decrypt"),m(function(g){var i=m("./root"),o=m("./shim");m("./settings"),i.secret=i.secret||(async(h,d,t,c)=>{try{if(c=c||{},!d||!d.epriv||!d.epub){if(!i.I)throw"No secret mix.";d=await i.I(null,{what:h,how:"secret",why:c.why})}var u=h.epub||h,r=d.epub,k=d.epriv,a=o.ossl||o.subtle,y=s(u),v=Object.assign({public:await a.importKey(...y,!0,[])},{name:"ECDH",namedCurve:"P-256"}),w=s(r,k),e=await a.importKey(...w,!1,["deriveBits"]).then(async f=>{var p=await a.deriveBits(v,f,256),x=new Uint8Array(p),b=await a.importKey("raw",x,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return a.exportKey("jwk",b).then(({k:T})=>T)}),n=e;if(t)try{t(n)}catch(f){console.log(f)}return n}catch(f){if(console.log(f),i.err=f,i.throw)throw f;t&&t();return}});var s=(h,d)=>{var[t,c]=h.split("."),u=d?{d}:{};return["jwk",Object.assign(u,{x:t,y:c,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};g.exports=i.secret})(m,"./secret"),m(function(g){var i=m("./root");i.certify=i.certify||(async(o,s={},h,d,t={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),o=(()=>{var e=[];if(o){if((typeof o=="string"||Array.isArray(o))&&o.indexOf("*")>-1)return"*";if(typeof o=="string")return o;if(Array.isArray(o)){if(o.length===1&&o[0])return typeof o[0]=="object"&&o[0].pub?o[0].pub:typeof o[0]=="string"?o[0]:null;o.map(n=>{typeof n=="string"?e.push(n):typeof n=="object"&&n.pub&&e.push(n.pub)})}return typeof o=="object"&&o.pub?o.pub:e.length>0?e:null}})(),!o)return console.log("No certificant found.");const u=t.expiry&&(typeof t.expiry=="number"||typeof t.expiry=="string")?parseFloat(t.expiry):null,r=(s||{}).read?s.read:null,k=(s||{}).write?s.write:typeof s=="string"||Array.isArray(s)||s["+"]||s["#"]||s["."]||s["="]||s["*"]||s[">"]||s["<"]?s:null,a=(t||{}).block||(t||{}).blacklist||(t||{}).ban||{},y=a.read&&(typeof a.read=="string"||(a.read||{})["#"])?a.read:null,v=typeof a=="string"?a:a.write&&(typeof a.write=="string"||a.write["#"])?a.write:null;if(!r&&!k)return console.log("No policy found.");const w=JSON.stringify({c:o,...u?{e:u}:{},...r?{r}:{},...k?{w:k}:{},...y?{rb:y}:{},...v?{wb:v}:{}});var c=await i.sign(w,h,null,{raw:1});if(t.raw||(c="SEA"+JSON.stringify(c)),d)try{d(c)}catch(e){console.log(e)}return c}catch(u){if(i.err=u,i.throw)throw u;d&&d();return}}),g.exports=i.certify})(m,"./certify"),m(function(g){var i=m("./shim"),o=m("./root");o.work=m("./work"),o.sign=m("./sign"),o.verify=m("./verify"),o.encrypt=m("./encrypt"),o.decrypt=m("./decrypt"),o.certify=m("./certify"),o.random=o.random||i.random,o.Buffer=o.Buffer||m("./buffer"),o.keyid=o.keyid||(async s=>{try{const h=i.Buffer.concat(s.replace(/-/g,"+").replace(/_/g,"/").split(".").map(u=>i.Buffer.from(u,"base64"))),d=i.Buffer.concat([i.Buffer.from([153,h.length/256,h.length%256]),h]),t=await sha1hash(d),c=i.Buffer.from(t,"binary");return c.toString("hex",c.length-8)}catch(h){throw console.log(h),h}}),((o.window||{}).GUN||{}).SEA=o,g.exports=o})(m,"./sea"),m(function(g){var i=m("./sea"),o,s;i.window?o=i.window.GUN||{chain:{}}:o=m((s+""==typeof O?".":"")+"./gun",1),i.GUN=o;function h(t){this._={$:this}}h.prototype=function(){function t(){}return t.prototype=o.chain,new t}(),h.prototype.constructor=h,o.chain.user=function(t){var c=this,r=c.back(-1),u;if(t)return t=i.opt.pub((t._||"")["#"])||t,r.get("~"+t);if(u=r.back("user"))return u;var r=r._,k=r,a=k.opt.uuid||d;return(k=(u=k.user=c.chain(new h))._).opt={},k.opt.uuid=function(y){var v=a(),w=r.user;return!w||!(w=w.is)||!(w=w.pub)||(v="~"+w+"/"+v,y&&y.call&&y(null,v)),v},u};function d(){return o.state().toString(36).replace(".","")}o.User=h,h.GUN=o,h.SEA=o.SEA=i,g.exports=h})(m,"./user"),m(function(g){var i,o=""+i!=typeof GUN?GUN||{chain:{}}:m((""+i==typeof O?".":"")+"./gun",1);o.chain.then=function(s,h){var d=this,t=new Promise(function(c,u){d.once(c,h)});return s?t.then(s):t}})(m,"./then"),m(function(g){var i=m("./user"),o=i.SEA,s=i.GUN,h=function(){};i.prototype.create=function(...d){var t=typeof d[0]=="object"&&(d[0].pub||d[0].epub)?d[0]:typeof d[1]=="object"&&(d[1].pub||d[1].epub)?d[1]:null,c=t&&(t.pub||t.epub)?t.pub:typeof d[0]=="string"?d[0]:null,u=t&&(t.pub||t.epub)?t:c&&typeof d[1]=="string"?d[1]:null,r=d.filter(n=>typeof n=="function")[0]||null,k=d&&d.length>1&&typeof d[d.length-1]=="object"?d[d.length-1]:{},a=this,y=a._,v=a.back(-1);if(r=r||h,k=k||{},k.check!==!1){var w;if(c||(w="No user."),(u||"").length<8&&(w="Password too short!"),w)return r({err:s.log(w)}),a}if(y.ing)return(r||h)({err:s.log("User is already being created or authenticated!"),wait:!0}),a;y.ing=!0;var e={};return e.a=function(n){if(e.pubs=n,n&&!k.already){var f={err:s.log("User already created!")};y.ing=!1,(r||h)(f),a.leave();return}e.salt=String.random(64),o.work(u,e.salt,e.b)},e.b=function(n){e.proof=n,t?e.c(t):o.pair(e.c)},e.c=function(n){var f;e.pair=n||{},(f=y.root.user)&&(f._.sea=n,f.is={pub:n.pub,epub:n.epub,alias:c}),e.data={pub:n.pub},e.d()},e.d=function(){e.data.alias=c,e.e()},e.e=function(){e.data.epub=e.pair.epub,o.encrypt({priv:e.pair.priv,epriv:e.pair.epriv},e.proof,e.f,{raw:1})},e.f=function(n){e.data.auth=JSON.stringify({ek:n,s:e.salt}),e.g(e.data.auth)},e.g=function(n){var f;e.data.auth=e.data.auth||n,v.get(f="~"+e.pair.pub).put(e.data).on(e.h);var p={};p[f]={"#":f},v.get("~@"+c).put(p).get(f).on(e.i)},e.h=function(n,f,p,x){x.off(),e.h.ok=1,e.i()},e.i=function(n,f,p,x){x&&(e.i.ok=1,x.off()),!(!e.h.ok||!e.i.ok)&&(y.ing=!1,r({ok:0,pub:e.pair.pub}),h===r&&(t?a.auth(t):a.auth(c,u)))},v.get("~@"+c).once(e.a),a},i.prototype.leave=function(d,t){var c=this,u=c.back(-1)._.user;if(u&&(delete u.is,delete u._.is,delete u._.sea),o.window)try{var r={};r=o.window.sessionStorage,delete r.recall,delete r.pair}catch{}return c}})(m,"./create"),m(function(g){var i=m("./user"),o=i.SEA,s=i.GUN,h=function(){};i.prototype.auth=function(...t){var c=typeof t[0]=="object"&&(t[0].pub||t[0].epub)?t[0]:typeof t[1]=="object"&&(t[1].pub||t[1].epub)?t[1]:null,u=!c&&typeof t[0]=="string"?t[0]:null,r=(u||c&&!(c.priv&&c.epriv))&&typeof t[1]=="string"?t[1]:null,k=t.filter(p=>typeof p=="function")[0]||null,a=t&&t.length>1&&typeof t[t.length-1]=="object"?t[t.length-1]:{},y=this,v=y._,w=y.back(-1);if(v.ing)return(k||h)({err:s.log("User is already being created or authenticated!"),wait:!0}),y;v.ing=!0;var e={},n,f=9;return e.a=function(p){if(!p)return e.b();if(!p.pub){var x=[];return Object.keys(p).forEach(function(b){b!="_"&&x.push(p[b])}),e.b(x)}if(e.name)return e.f(p);e.c((e.data=p).auth)},e.b=function(p){var x=(e.list=(e.list||[]).concat(p||[])).shift();if(n===x){if(e.name)return e.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(u&&f--){w.get("~@"+u).once(e.a);return}return e.err("Wrong user or password.")}w.get(x).once(e.a)},e.c=function(p){if(n===p)return e.b();if(typeof p=="string")return e.c(d(p));o.work(r,(e.auth=p).s,e.d,e.enc)},e.d=function(p){o.decrypt(e.auth.ek,p,e.e,e.enc)},e.e=function(p){if(n===p)return e.enc?(e.enc=null,e.b()):(e.enc={encode:"utf8"},e.c(e.auth));e.half=p,e.f(e.data)},e.f=function(p){var x=e.half||{},b=e.data||{};e.g(e.lol={pub:p.pub||b.pub,epub:p.epub||b.epub,priv:p.priv||x.priv,epriv:p.epriv||x.epriv})},e.g=function(p){if(!p||!p.pub||!p.epub)return e.b();e.pair=p;var x=w._.user,b=x._;b.tag;var T=b.opt;b=x._=w.get("~"+p.pub)._,b.opt=T,x.is={pub:p.pub,epub:p.epub,alias:u||p.pub},b.sea=e.pair,v.ing=!1;try{r&&n==(d(v.root.graph["~"+p.pub].auth)||"")[":"]&&(a.shuffle=a.change=r)}catch{}if(a.change?e.z():(k||h)(b),o.window&&(y.back("user")._.opt||a).remember)try{var D={};D=o.window.sessionStorage,D.recall=!0,D.pair=JSON.stringify(p)}catch{}try{w._.tag.auth?w._.on("auth",b):setTimeout(function(){w._.on("auth",b)},1)}catch(C){s.log("Your 'auth' callback crashed with:",C)}},e.h=function(p){if(!p)return e.b();if(u=p.alias,u||(u=p.alias="~"+c.pub),!p.auth)return e.g(c);c=null,e.c((e.data=p).auth)},e.z=function(){e.salt=String.random(64),o.work(a.change,e.salt,e.y)},e.y=function(p){o.encrypt({priv:e.pair.priv,epriv:e.pair.epriv},p,e.x,{raw:1})},e.x=function(p){e.w(JSON.stringify({ek:p,s:e.salt}))},e.w=function(p){if(a.shuffle){console.log("migrate core account from UTF8 & shuffle");var x={};Object.keys(e.data).forEach(function(b){x[b]=e.data[b]}),delete x._,x.auth=p,w.get("~"+e.pair.pub).put(x)}w.get("~"+e.pair.pub).get("auth").put(p,k||h)},e.err=function(p){var x={err:s.log(p||"User cannot be found!")};v.ing=!1,(k||h)(x)},e.plugin=function(p){if(!(e.name=p))return e.err();var x=[p];p[0]!=="~"&&(x[1]="~"+p,x[2]="~@"+p),e.b(x)},c?c.priv&&c.epriv?e.g(c):w.get("~"+c.pub).once(e.h):u?w.get("~@"+u).once(e.a):!u&&!r&&o.name(e.plugin),y};function d(t){if(typeof t!="string")return t;try{t=JSON.parse(t)}catch{t={}}return t}})(m,"./auth"),m(function(g){var i=m("./user"),o=i.SEA;i.GUN,i.prototype.recall=function(s,h){var d=this,t=d.back(-1);if(s=s||{},s&&s.sessionStorage){if(o.window)try{var c={};c=o.window.sessionStorage,c&&(t._.opt.remember=!0,(d.back("user")._.opt||s).remember=!0,(c.recall||c.pair)&&t.user().auth(JSON.parse(c.pair),h))}catch{}return d}return d}})(m,"./recall"),m(function(g){var i=m("./user"),o=i.SEA,s=i.GUN,h=function(){};i.prototype.pair=function(){var d=this,t;try{t=new Proxy({DANGER:"â "},{get:function(c,u,r){if(!(!d.is||!(d._||"").sea))return d._.sea[u]}})}catch{}return t},i.prototype.delete=async function(d,t,c){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var u=this;u.back(-1);var r=u.back("user");try{r.auth(d,t,function(k){var a=(r.is||{}).pub;r.map().once(function(){this.put(null)}),r.leave(),(c||h)({ok:0})})}catch(k){s.log("User.delete failed! Error:",k)}return u},i.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const d=this.back(-1);try{return await authRecall(d),d._.user._}catch{const t="No session!";throw s.log(t),{err:t}}},i.prototype.trust=async function(d){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),s.is(d)&&d.get("pub").get((t,c)=>{console.log(t,c)}),d.get("trust").get(path).put(theirPubkey)},i.prototype.grant=function(d,t){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var c=this,u=c.back(-1).user(),r=u._.sea,k="";return c.back(function(a){a.is||(k+=a.get||"")}),async function(){var a,y=await u.get("grant").get(r.pub).get(k).then();y=await o.decrypt(y,r),y||(y=o.random(16).toString(),a=await o.encrypt(y,r),u.get("grant").get(r.pub).get(k).put(a));var v=d.get("pub").then(),w=d.get("epub").then();v=await v,w=await w;var e=await o.secret(w,r);a=await o.encrypt(y,e),u.get("grant").get(v).get(k).put(a,t)}(),c},i.prototype.secret=function(d,t){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var c=this,u=c.back(-1).user(),r=u.pair(),k="";return c.back(function(a){a.is||(k+=a.get||"")}),async function(){var a,y=await u.get("trust").get(r.pub).get(k).then();y=await o.decrypt(y,r),y||(y=o.random(16).toString(),a=await o.encrypt(y,r),u.get("trust").get(r.pub).get(k).put(a)),a=await o.encrypt(d,y),c.put(a,t)}(),c},g.exports=i})(m,"./share"),m(function(g){var i=m("./sea"),o=m("./settings"),s,h=(i.window||"").GUN||m((""+s==typeof O?".":"")+"./gun",1);h.on("opt",function(a){a.sea||(a.sea={own:{}},a.on("put",d,a)),this.to.next(a)});function d(a){var y=this,v=y.as,w=a.put,e=w["#"],n=w["."],f=w[":"],p=w[">"],x=a["#"],b;if(!(!e||!n)){if((a._||"").faith&&(v.opt||"").faith&&typeof a._=="function"){i.opt.pack(w,function(D){i.verify(D,!1,function(C){w["="]=i.opt.unpack(C),y.to.next(a)})});return}var T=function(D){v.on("in",{"@":x,err:a.err=D})};if((a._||"").DBG&&((a._||"").DBG.c=+new Date),0<=e.indexOf("<?")&&(b=parseFloat(e.split("<?")[1]||""),b&&p<h.state()-b*1e3)){(b=a._)&&b.stun&&b.stun--;return}if(e==="~@"){d.alias(y,a,f,n,e,v,T);return}if(e.slice(0,2)==="~@"){d.pubs(y,a,f,n,e,v,T);return}if(b=i.opt.pub(e)){d.pub(y,a,f,n,e,v,T,v.user||"",b);return}if(0<=e.indexOf("#")){d.hash(y,a,f,n,e,v,T);return}d.any(y,a,f,n,e,v,T,v.user||"")}}d.hash=function(a,y,v,w,e,n,f){i.work(v,null,function(p){function x(b){let T="";for(let D=0;D<b.length;D++)T+=D-1&1?"":String.fromCharCode(parseInt(b.substring(D-1,D+1),16));return btoa(T)}if(p&&p===w.split("#").slice(-1)[0]||p&&p===x(w.split("#").slice(-1)[0]))return a.to.next(y);f("Data hash not same as hash!")},{name:"SHA-256"})},d.alias=function(a,y,v,w,e,n,f){if(!v)return f("Data must exist!");if("~@"+w===c(v))return a.to.next(y);f("Alias not same!")},d.pubs=function(a,y,v,w,e,n,f){if(!v)return f("Alias must exist!");if(w===c(v))return a.to.next(y);f("Alias not same!")},d.pub=async function(a,y,v,w,e,n,f,p,x){var b;const T=await o.parse(v)||{},D=(C,A,_)=>{if(C.m&&C.s&&A&&x)return i.verify(C,x,l=>{if(s!==l&&s!==l.e&&y.put[">"]&&y.put[">"]>parseFloat(l.e))return f("Certificate expired.");if(s!==l&&l.c&&l.w&&(l.c===A||l.c.indexOf("*")>-1)){let j=e.indexOf("/")>-1?e.replace(e.substring(0,e.indexOf("/")+1),""):"";String.match=String.match||h.text.match;const $=Array.isArray(l.w)?l.w:typeof l.w=="object"||typeof l.w=="string"?[l.w]:[];for(const B of $)if(String.match(j,B["#"])&&String.match(w,B["."])||!B["."]&&String.match(j,B["#"])||!B["#"]&&String.match(w,B["."])||String.match(j?j+"/"+w:w,B["#"]||B)){if(B["+"]&&B["+"].indexOf("*")>-1&&j&&j.indexOf(A)==-1&&w.indexOf(A)==-1)return f(`Path "${j}" or key "${w}" must contain string "${A}".`);if(l.wb&&(typeof l.wb=="string"||(l.wb||{})["#"])){var S=a.as.root.$.back(-1);return typeof l.wb=="string"&&l.wb.slice(0,1)!=="~"&&(S=S.get("~"+x)),S.get(l.wb).get(A).once(N=>N&&(N===1||N===!0)?f(`Certificant ${A} blocked.`):_(l))}return _(l)}return f("Certificate verification fail.")}})};if(w==="pub"&&"~"+x===e)return v===x?a.to.next(y):f("Account not same!");if((b=p.is)&&b.pub&&!T["*"]&&!T["+"]&&(x===b.pub||x!==b.pub&&((y._.msg||{}).opt||{}).cert)){i.opt.pack(y.put,C=>{i.sign(C,p._.sea,async function(A){if(s===A)return f(i.err||"Signature fail.");if(y.put[":"]={":":b=i.opt.unpack(A.m),"~":A.s},y.put["="]=b,x===p.is.pub){(b=c(v))&&((n.sea.own[b]=n.sea.own[b]||{})[x]=1),JSON.stringifyAsync(y.put[":"],function(_,l){return _?f(_||"Stringify error."):(y.put[":"]=l,a.to.next(y))});return}if(x!==p.is.pub&&((y._.msg||{}).opt||{}).cert){const _=await o.parse(y._.msg.opt.cert);_&&_.m&&_.s&&D(_,p.is.pub,l=>{y.put[":"]["+"]=_,y.put[":"]["*"]=p.is.pub,JSON.stringifyAsync(y.put[":"],function(S,j){return S?f(S||"Stringify error."):(y.put[":"]=j,a.to.next(y))})})}},{raw:1})});return}i.opt.pack(y.put,C=>{i.verify(C,T["*"]||x,function(A){var _;if(A=i.opt.unpack(A),s===A)return f("Unverified data.");if((_=c(A))&&x===i.opt.pub(_)&&((n.sea.own[_]=n.sea.own[_]||{})[x]=1),T["+"]&&T["+"].m&&T["+"].s&&T["*"])D(T["+"],T["*"],l=>(y.put["="]=A,a.to.next(y)));else return y.put["="]=A,a.to.next(y)})})},d.any=function(a,y,v,w,e,n,f,p){if(n.opt.secure)return f("Soul missing public key at '"+w+"'.");n.on("secure",function(x){if(this.off(),!n.opt.secure)return a.to.next(x);f("Data cannot be changed.")}).on.on("secure",y)};var t=h.valid,c=function(a,y){return typeof(y=t(a))=="string"&&y};(h.state||"").ify;var u=/[^\w_-]/;i.opt.pub=function(a){if(a&&(a=a.split("~"),!(!a||!(a=a[1]))&&(a=a.split(u).slice(0,2),!(!a||a.length!=2)&&(a[0]||"")[0]!=="@")))return a=a.slice(0,2).join("."),a},i.opt.stringy=function(a){},i.opt.pack=function(a,y,v,w,e){var n,f;if(i.opt.check(a))return y(a);a&&a["#"]&&a["."]&&a[">"]&&(n=a[":"],f=1),JSON.parseAsync(f?n:a,function(p,x){var b=s!==(x||"")[":"]&&(x||"")["~"];if(!b){y(a);return}y({m:{"#":e||a["#"],".":v||a["."],":":(x||"")[":"],">":a[">"]||h.state.is(w,v)},s:b})})};var r=i.opt;i.opt.unpack=function(a,y,v){var w;if(s!==a){if(a&&s!==(w=a[":"]))return w;if(y=y||r.fall_key,!v&&r.fall_val&&(v={},v[y]=r.fall_val),!(!y||!v)){if(a===v[y]||!i.opt.check(v[y]))return a;var e=v&&v._&&v._["#"]||r.fall_soul,n=h.state.is(v,y)||r.fall_state;if(a&&a.length===4&&e===a[0]&&y===a[1]&&k(n)===k(a[3]))return a[2];if(n<i.opt.shuffle_attack)return a}}},i.opt.shuffle_attack=15463296e5;var k=Math.floor})(m,"./index")})()})(Bt);var Zt=Bt.exports;const zt=_t(Zt);var te=()=>{if(!CanvasRenderingContext2D||!O())return;const E=CanvasRenderingContext2D.prototype,m=E.drawImage;if(!m){console.error("This script requires a basic implementation of drawImage");return}E.drawImage=function(h,d,t){if(!(arguments.length===9))return m.apply(this,[...arguments]);const u=g(...arguments);if(!i(u))return m.apply(this,u)};function O(){const s=document.createElement("canvas").getContext("2d");s.fillRect(0,0,40,40),s.drawImage(s.canvas,-40,-40,80,80,50,50,20,20);const h=s.getImageData(50,50,30,30),d=new Uint32Array(h.data.buffer),t=(r,k)=>d[k*h.width+r],c=[[9,9],[20,9],[9,20],[20,20]],u=[[10,10],[19,10],[10,19],[19,19]];return c.some(([r,k])=>t(r,k)!==0)||u.some(([r,k])=>t(r,k)===0)}function g(s,h,d,t,c,u,r,k,a){const{width:y,height:v}=o(s);t<0&&(h+=t,t=Math.abs(t)),c<0&&(d+=c,c=Math.abs(c)),k<0&&(u+=k,k=Math.abs(k)),a<0&&(r+=a,a=Math.abs(a));const w=Math.max(h,0),e=Math.min(h+t,y),n=Math.max(d,0),f=Math.min(d+c,v),p=k/t,x=a/c;return[s,w,n,e-w,f-n,h<0?u-h*p:u,d<0?r-d*x:r,(e-w)*p,(f-n)*x]}function i(s){return[3,4,7,8].some(h=>!s[h])}function o(s){const h=d=>{const t=globalThis[d];return t&&s instanceof t};if(h("HTMLImageElement"))return{width:s.naturalWidth,height:s.naturalHeight};if(h("HTMLVideoElement"))return{width:s.videoWidth,height:s.videoHeight};if(h("SVGImageElement"))throw new TypeError("SVGImageElement isn't yet supported as source image.","UnsupportedError");if(h("HTMLCanvasElement")||h("ImageBitmap"))return s}},V={};function at({pub:E,size:m=200,dark:O=!1,draw:g="circles",reflect:i=!0}){if(!ee(E)||!document)return"";const o=JSON.stringify(arguments[0]);if(V!=null&&V[o])return V[o];const s=document.createElement("canvas");s.width=s.height=m;const h=s.getContext("2d"),{decoded:d,finals:t}=ne(E);return ie({ctx:h,top:t[0],bottom:t[1],size:m,dark:O}),g=="squares"?(h.filter="blur(20px)",Dt(d[0],h,m),h.filter="blur(0px)",h.globalCompositeOperation="color-burn",Dt(d[1],h,m)):($t(d[0],h,m,.42*m),h.globalCompositeOperation="multiply",$t(d[1],h,m,.125*m)),i&&(h.globalCompositeOperation="source-over",h.scale(-1,1),h.translate(-m/2,0),h.drawImage(s,m/2,0,m,m,0,0,m,m)),V[o]=s.toDataURL(),V[o]}function ee(E){return!!(E&&typeof E=="string"&&E.length==87&&E.split(".").length==2)}function ne(E){const m=E.split("."),O=m.map(h=>oe(h)),g=O.map(h=>h[42]),i=O.map(h=>h.reduce((d,t)=>d+t)/h.length),o=m.map(h=>re(h)%360),s=m.map((h,d)=>`hsl(${o[d]} ${g[d]*100}% ${i[d]*100}%)`);return{finals:g,decoded:O,angles:o,averages:i,colors:s}}var Et="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function re(E){return E.split("").reduce((m,O)=>m*64+Et.indexOf(O),0)}function oe(E){const m=Et.split("");let O=[],g=0;for(let i of E)O[g++]=m.indexOf(i)/64;return O}function Nt(E,m=3){return[...Array(Math.ceil(E.length/m))].map(()=>E.splice(0,m))}function ie({ctx:E,top:m=0,bottom:O=150,size:g=200,dark:i=!1}){var o=E.createLinearGradient(0,0,0,g);let s=70;i&&(s=0),o.addColorStop(0,`hsla(0,0%,${s+m*30}%)`),o.addColorStop(1,`hsla(0,0%,${s+O*30}%)`),E.fillStyle=o,E.fillRect(0,0,g,g)}function Dt(E,m,O){Nt(E,14).forEach(i=>{if(i.length==14){let o=i[0]*O,s=i[1]*O,h=O/8+i[2]*O*(7/8),d=i[13]*Math.PI,t=i[3]*360,c=i[4]*100,u=i[5]*100,r=i[6],k=i[7],a=i[8]*360,y=i[9]*100,v=i[10]*100,w=i[11],e=i[12];const n=m.createLinearGradient(o+h*k,0,o+h*e,O);n.addColorStop(0,`hsla(${t},${c}%,${u}%,${r})`),n.addColorStop(1,`hsla(${a},${y}%,${v}%,${w})`),m.fillStyle=n,m.translate(o,s),m.rotate(d),m.fillRect(-h/2,-h/2,h,h),m.setTransform(1,0,0,1,0,0)}})}function $t(E,m,O,g){Nt(E,7).forEach(o=>{if(o.length==7){let s=O/2+o[0]*O/2,h=o[1]*O,d=o[2]*g,t=o[3]*360,c=o[4]*100,u=o[5]*100,r=o[6];m.beginPath(),m.arc(s,h,d,0,2*Math.PI,!1),m.fillStyle=`hsla(${t},${c}%,${u}%,${r})`,m.closePath(),m.fill()}})}te();const ae={class:"flex flex-col p-2 gap-2"},ue={key:0,class:"flex gap-2 p-2 items-center flex-wrap"},se=["src"],ce={key:1,class:"flex p-2 items-center flex-wrap"},fe=["src"],le={class:"flex flex-wrap items-center gap-2"},pe=["onPointerdown"],he=["src"],de={class:"text-xs"},q="test-app-1000",ve={__name:"GunP2p",setup(E){const m=Vt({peers:["https://peer.wallie.io/gun"]}),O=ot(""),g=ot(""),i=ot(null),o=Gt({}),s=[],h=[];lt(g,r=>m.user().get("name").put(r)),lt(()=>z.note,r=>m.user().get("midi").put(r.number)),Jt(()=>{m.user().recall({sessionStorage:!0}),c(),h.push(m.on("auth",()=>{var r;O.value=(r=m.user().is)==null?void 0:r.pub,h.push(m.user().get("name").on(k=>g.value=k)),h.push(m.get(q).get("personal").get(O.value).on(k=>ht(z.note.number))),s.push(setInterval(()=>m.get(q).get("users").get(O.value).put(Date.now()),1e3))})),h.push(m.get(q).get("users").map().on((r,k)=>{Date.now()-r<8e3&&(o[k]=o[k]||{},o[k].timestamp=r,m.user(k).get("name").once(a=>o[k].name=a),m.user(k).get("midi").once(a=>o[k].midi=a))})),h.push(m.get(q).get("play").on(()=>ht(z.note.number))),s.push(setInterval(()=>{for(let r in o)0>Date.now()-o[r].timestamp>6e3&&delete o[r]},1e4))}),Ut(()=>{s.forEach(r=>clearInterval(r)),h.forEach(r=>{var k;return(k=r==null?void 0:r.off)==null?void 0:k.call(r)})});function d(){m.get(q).get("play").put(Date.now())}function t(r){m.get(q).get("personal").get(r).put(Date.now())}async function c(){i.value=await zt.pair()}function u(){m.user().leave(),setTimeout(()=>{var r;(r=m.user())!=null&&r.is||(O=null)},1e3)}return(r,k)=>{var a;return X(),Z("div",ae,[O.value?(X(),Z("div",ue,[K("img",{style:{width:"60px"},src:L(at)({pub:O.value})},null,8,se),Pt(K("input",{class:"p-1","onUpdate:modelValue":k[0]||(k[0]=y=>g.value=y)},null,512),[[Rt,g.value]]),K("div",{class:"p-2 rounded-xl",style:pt({backgroundColor:L(gt)(L(z).note.number)})},it(L(dt)[L(z).note.pitch]),5),k[5]||(k[5]=K("div",{class:"flex-1"},null,-1)),K("button",{class:"text-button",onClick:k[1]||(k[1]=y=>u())},"Leave")])):(X(),Z("div",ce,[K("button",{class:"text-button",onPointerdown:k[2]||(k[2]=y=>c())},"Generate",32),K("img",{style:{width:"60px"},src:L(at)({pub:(a=i.value)==null?void 0:a.pub})},null,8,fe),K("button",{class:"text-button",onPointerdown:k[3]||(k[3]=y=>L(m).user().auth(i.value))},"Enter",32)])),K("div",le,[It(Lt,{name:"fade"},{default:Mt(()=>[K("button",{class:"text-button",key:"all",onPointerdown:k[4]||(k[4]=y=>d())},"Play all",32),(X(!0),Z(Ht,null,Kt(o,(y,v)=>(X(),Z("button",{class:"p-2 flex flex-col shadow gap-2 relative active-op-80 transition",onPointerdown:w=>t(v),key:v},[K("img",{style:{width:"60px",margin:"0"},src:L(at)({pub:v})},null,8,he),K("div",de,it((y.name||"").slice(0,18)),1),K("div",{class:"absolute bottom-0 right-0 px-1 p-0 rounded-xl text-xs",style:pt({backgroundColor:L(gt)(y.midi,1,.5)})},it(L(dt)[(y.midi-9)%12]),5)],40,pe))),128))]),_:1})])])}}};export{ve as default};
