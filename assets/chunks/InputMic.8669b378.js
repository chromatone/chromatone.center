import{u as p,s as c}from"./useAudio.be0f0d23.js";import"./tuner.f3d8e340.js";import"./audio.aba48680.js";import{f as y}from"./calculations.2bac3e9a.js";import"./colors.a5d5ae39.js";import"./midi.36560961.js";import"./loop.5f39f706.js";import"./mic.a8597eff.js";import"./midiRender.affeda4e.js";import"./Midi.1f918097.js";import"./tempo.4e2f4c38.js";import"./noise.50c0df1a.js";import"./index.e98b5e67.js";import"./sequence.23b98f68.js";import"./synth.8a2ee66e.js";import"./theory.61e5aadb.js";import{k as S,j as m,i as b,A as k,w as u,o as h,c as v,a as _,L as C,t as O,g as l,v as V,f as g}from"./framework.f277db28.js";import{_ as A}from"./ControlRotary.64f87b82.js";import{_ as D}from"./AnalysisScope.af71c368.js";import{u as R}from"./index.911cb71e.js";function $(i="main:fft"){const{FFTs:a,meters:t}=p(),e=S({sr:m(()=>{var n;return((n=t["main:sample-rate"])==null?void 0:n.max)||44100}),freq:m(()=>e.data[0].map((n,s)=>s*e.sr/(e.data[0].length||1))),colors:m(()=>e.freq.map(y)),data:m(()=>(a==null?void 0:a[i])||[[],[]]),total:m(()=>e.data[0].map((n,s)=>Math.log2(1+Math.abs(n)+Math.abs(e.data[1][s]))))});return{FFT:e}}const q={class:"flex is-group p-2 bg-light-200 dark-bg-dark-200 shadow rounded gap-4"},oe={__name:"AnalysisFFT",props:{name:{default:"main:fft",type:String}},setup(i){const a=i,{FFT:t}=$(a.name);let e=b(null);k(n),u(t,n,{deep:!0});function n(){if(!e.value||!(t!=null&&t.total))return;let s=e.value.getContext("2d");s.clearRect(0,0,e.value.width,e.value.height);for(let r=0;r<t.total.length;r++){let x=t.total[r],d=Math.pow(x,2)*e.value.height/50,f=Math.log2(r+1)*e.value.width/Math.log2(t.total.length+1),M=Math.log2(r+2)*e.value.width/Math.log2(t.total.length+1)-f,w=e.value.height-d;s.fillStyle=t.colors[r],s.fillRect(f,w,M,d)}}return(s,r)=>(h(),v("div",q,[_("canvas",{class:"max-w-full",ref_key:"canvas",ref:e,height:"512",width:"2048"},null,512)]))}},o=C({isOpen:!1,stream:null,streamSource:null,gain:R(1,0,10),async open(){const{audio:i}=p();navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(o.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1}}),o.streamSource=i.ctx.createMediaStreamSource(o.stream),o.streamSource.connect(i.node))},close(){o.streamSource.disconnect()}});function B(){const{audio:i,render:a}=p();return u(o,()=>{const t=c.mul(c.const({key:"mic:gain",value:o.gain.value}),c.in({key:"mic:in",channel:0}));i.layers.mic={signal:o.isOpen?[c.scope({name:"mic",size:512},t),t]:[0,0]},a("mic")}),u(()=>o.isOpen,t=>{t?o.open():setTimeout(()=>{o.close()},400)}),o}const N={class:"is-group flex items-center"},se={__name:"InputMic",setup(i){const a=B();return(t,e)=>{const n=A;return h(),v("div",N,[_("button",{class:V(["text-button",{"text-red-500":l(a).isOpen}]),onClick:e[0]||(e[0]=s=>l(a).isOpen=!l(a).isOpen)},O(l(a).isOpen?"Close":"Open")+" mic",3),g(n,{param:"GAIN",modelValue:l(a).gain.value,"onUpdate:modelValue":e[1]||(e[1]=s=>l(a).gain.value=s),min:0,max:10,step:.1},null,8,["modelValue"]),g(D,{name:"mic"})])}}};export{se as _,oe as a};
