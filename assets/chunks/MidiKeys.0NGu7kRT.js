import{v as W,i as y,j as E,_ as G,w as j,o as u,c as d,a as l,N as q,g as e,t as g,F as M,r as C,l as S,b as H}from"./framework.HVt1h3pg.js";import{g as r,n as $}from"./colors.im4OGed9.js";import{u as J}from"./midi.OEToXt3d.js";import{s as b,n as w,i as Q}from"./theory.kDp-YHKa.js";import{a as N}from"./index.tljQmfR-.js";import{u as K,D as A}from"./index.dyz7TQwj.js";function U(){const t=K(W("midi-keys-begin",0),0,127),c=K(W("midi-keys-end",44),t,127),x=A(t),h=A(c),f=y(),D=y(),z=E(()=>Array(h.value+1-x.value).fill(0).map((i,m)=>m+x.value));return N({onDrag(a){a.event.preventDefault();let i=t.value+a.delta[0]/5;i+1<=c.value&&(t.value=Math.round(i))},onWheel(a){a.event.preventDefault();let i=t.value-a.velocities[0]/5;i+1<=c.value&&(t.value=Math.round(i))}},{domTarget:f,eventOptions:{passive:!1}}),N({onDrag(a){a.event.preventDefault();let i=c.value+a.delta[0]/5;i>t.value&&(c.value=i)},onWheel(a){a.event.preventDefault();let i=c.value-a.velocities[0]/5;i-1>t.value&&(c.value=i)}},{domTarget:D,eventOptions:{passive:!1}}),{begin:t,end:c,roundBegin:x,roundEnd:h,beginControl:f,endControl:D,keys:z}}const X=["viewBox"],Y=["transform"],Z=["transform"],_=["height","width","fill"],p=["y"],tt=["transform"],et=["transform"],nt=["transform"],ot=["height","width","fill"],lt=["x","y"],st=["transform","stroke"],at=["transform"],it=["transform"],rt=["width","height"],ct=["y"],ht=["transform","opacity"],ut=["transform"],dt=["transform"],ft=["cy","fill"],vt=["transform"],wt=["height","width","fill"],gt=["x","y"],mt=["transform"],yt=["transform"],xt={class:"keys"},kt=["transform"],$t=["width","height","fill","onMousedown","onMouseenter","onTouchstart","onMouseleave","onMouseup","onTouchend","onTouchcancel"],bt=["r","cx","cy","opacity","fill"],Ot=["x","y","font-size"],Mt=["x1","x2","y2","stroke"],Ct=["x","y","font-size"],Nt=["fill","y","x","font-size","font-weight"],Dt={__name:"MidiKeys",props:{width:{type:Number,default:1200},height:{type:Number,default:500},controlOffset:{type:Number,default:100},slotOffset:{type:Number,default:0}},setup(t){const{midi:c,playKey:x}=J(),{roundBegin:h,roundEnd:f,beginControl:D,endControl:z,keys:a}=U(),i=y(),m=y(!1);N({onPointerdown(n){m.value=!0},onPointerleave(n){m.value=!1},onPointercancel(n){m.value=!1},onPointerup(n){m.value=!1}},{domTarget:i});function I(n){x(n-7,0,0,r.isIn(w[n%12])?1:.3)}function T(n){x(n-7,0,1,0)}const F=y(),P=y(r.tonic*100);j(P,n=>{r.tonic=Math.round((n/100%12+12)%12)}),N({onDrag(n){n.event.preventDefault(),P.value+=n.delta[0]*5},onWheel(n){n.event.preventDefault(),P.value-=n.velocities[0]*5}},{domTarget:F,eventOptions:{passive:!1}});const L=y(),O=K(10,1,b.length-1);N({onDrag(n){n.event.preventDefault(),O.value+=n.delta[0]/5},onWheel(n){n.event.preventDefault(),O.value-=n.velocities[0]/5}},{domTarget:L,eventOptions:{passive:!1}});const R=E(()=>{let n=Math.round(O.value);return b[n]});j(R,n=>{r.chroma=n.chroma});const B=W("filter-keys",!0),s=E(()=>B.value?a.value.filter(n=>r.isIn(w[(n+3)%12])):a.value);return(n,V)=>(u(),d("svg",{class:"w-full cursor-pointer fullscreen-container overflow-hidden select-none touch-none",viewBox:`0 -${t.controlOffset+t.slotOffset} ${t.width} ${t.height+t.controlOffset}`,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},ref_key:"keyboard",ref:i},[l("g",{class:"slot",transform:`translate(0,${-t.slotOffset-t.controlOffset})`},[q(n.$slots,"default",{},void 0,!0)],8,Y),l("g",{class:"offset",transform:`translate(0,${-t.controlOffset})`},[l("g",{class:"begin",ref_key:"beginControl",ref:D},[l("rect",{height:t.controlOffset,width:t.width/5,fill:e($)(e(h)+3,null,e(c).activeNotes[e(h)]?1:.1)},null,8,_),l("text",{class:"font-bold text-6xl",x:10,y:t.controlOffset*.75},g(e(w)[(e(h)+3)%12])+g(Math.floor((Math.round(e(h))+3)/12)-1),9,p),(u(!0),d(M,null,C(e(f),(o,v)=>(u(),d("line",{class:"pointer-events-none",transform:`translate(${v/e(f)*t.width/5},0)`,y2:16,opacity:".3","stroke-width":"2","stroke-linecap":"round",stroke:"white"},null,8,tt))),256)),l("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(h)/e(f)*t.width/5},0)`,stroke:"white"},null,8,et)],512),l("g",{class:"tonic",ref_key:"tonicControl",ref:F,transform:`translate(${t.width/5},0)`},[l("rect",{height:t.controlOffset,width:t.width/5,fill:e($)(e(r).tonic,2,.8)},null,8,ot),l("text",{class:"font-bold text-6xl",x:t.width/10,"text-anchor":"middle",y:t.controlOffset*.75},g(e(w)[e(r).tonic%12]),9,lt),(u(!0),d(M,null,C(e(w),(o,v)=>(u(),d("line",{transform:`translate(${(v/12+1/24)*t.width/5},0)`,y2:16,"stroke-width":"2","stroke-linecap":"round",stroke:e($)(v,5,.4)},null,8,st))),256)),l("line",{class:"transition",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(r).tonic/12*t.width/5+t.width/120},0)`,stroke:"white"},null,8,at)],8,nt),l("g",{class:"scale",ref_key:"scaleControl",ref:L,transform:`translate(${t.width*2/5},0)`},[l("rect",{width:t.width*2/5,height:t.controlOffset,fill:"#aaa"},null,8,rt),l("text",{class:"text-4xl",x:30,y:t.controlOffset*.75},g(R.value.name),9,ct),(u(!0),d(M,null,C(e(b).length,(o,v)=>(u(),d("line",{transform:`translate(${(v/e(b).length+1/e(b).length)*t.width*2/5},0)`,y2:36,opacity:o==Math.round(e(O))?1:.2,"stroke-width":"2","stroke-linecap":"round",stroke:"white"},null,8,ht))),256)),l("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(O)/e(b).length*t.width*2/5},0)`,stroke:"white"},null,8,ut)],8,it),l("g",{class:"show",transform:`translate(${t.width*4/5-50},0)`,onClick:V[0]||(V[0]=o=>B.value=!e(B))},[l("circle",{cy:t.controlOffset*.5,r:"20",fill:e(B)?"black":"transparent",stroke:"black","stroke-width":4},null,8,ft)],8,dt),l("g",{class:"end",ref_key:"endControl",ref:z,transform:`translate(${t.width*4/5},0)`},[l("rect",{height:t.controlOffset,width:t.width/5,fill:e($)(e(f)+3,null,e(c).activeNotes[e(f)]?1:.1)},null,8,wt),l("text",{class:"font-bold text-6xl pointer-events-none",x:t.width/5-20,"text-anchor":"end",y:t.controlOffset*.75},g(e(w)[(e(f)+3)%12])+g(Math.floor((e(f)+3)/12)-1),9,gt),(u(!0),d(M,null,C(Number(127-e(h)),(o,v)=>(u(),d("line",{class:"pointer-events-none",transform:`translate(${v/(127-e(h))*t.width/5},0)`,y2:16,opacity:".3","stroke-width":"2","stroke-linecap":"round",stroke:"white"},null,8,mt))),256)),l("line",{class:"pointer-events-none",y2:20,"stroke-width":"8","stroke-linecap":"round",stroke:"white",transform:`translate(${(e(f)-e(h))/(127-e(h))*t.width/5},0)`},null,8,yt)],8,vt)],8,Z),l("g",xt,[(u(!0),d(M,null,C(s.value,(o,v)=>(u(),d("g",{class:"key",key:o,transform:`translate(${v*t.width/s.value.length},0)`,"text-anchor":"middle"},[l("rect",{width:t.width/s.value.length,height:t.height,fill:e($)(o+3,null,e(c).activeNotes[o]?1:.1,e(r).isIn(e(w)[(o+3)%12])?1:.4),onMousedown:S(k=>I(o+3),["prevent"]),onMouseenter:k=>m.value?I(o+3):null,onTouchstart:S(k=>I(o+3),["prevent"]),onMouseleave:k=>T(o+3),onMouseup:S(k=>T(o+3),["prevent"]),onTouchend:k=>T(o+3),onTouchcancel:k=>T(o+3)},null,40,$t),l("circle",{class:"pointer-events-none",r:e(r).tonic==(o+3)%12?t.width/s.value.length/3:t.width/s.value.length/8,cx:t.width/s.value.length/2,cy:t.height-t.width/s.value.length/2,opacity:e(c).activeNotes[o]?1:.3,fill:e(r).isIn(e(w)[(o+3)%12])?"white":"black"},null,8,bt),l("text",{class:"opacity-75 pointer-events-none",x:t.width/s.value.length/2,y:t.height-t.width/s.value.length*1.1,"font-size":t.width/s.value.length*.5},g(e(Q)[(o+3-e(r).tonic)%12]),9,Ot),e(r).tonic==(o+3)%12?(u(),d("line",{key:0,class:"pointer-events-none",x1:t.width/s.value.length/2,x2:t.width/s.value.length/2,y1:0,y2:t.height,"stroke-width":"6",opacity:.9,stroke:e(c).activeNotes[o]?"white":e($)(o+3,-1,1,1)},null,8,Mt)):H("",!0),l("text",{class:"opacity-75 pointer-events-none",x:t.width/s.value.length/2,y:t.width/s.value.length+10,"font-size":t.width/s.value.length*.333},g(o),9,Ct),l("text",{class:"pointer-events-none",fill:e(r).isIn(e(w)[(o+3)%12])?"black":"#777e",y:t.width/s.value.length/2+10,x:t.width/s.value.length/2,"font-size":t.width/s.value.length*.5,"font-weight":e(r).tonic==(o+3)%12?"bold":"normal"},g(e(w)[(o+3)%12]),9,Nt)],8,kt))),128))])],8,X))}},Wt=G(Dt,[["__scopeId","data-v-66df98b2"]]);export{Wt as _};
