import{_ as q}from"./SvgRing.vPOeBKf7.js";import{v as W,i as y,j as E,_ as H,w as j,o as u,c as d,a as l,N as J,g as e,t as g,F as M,r as C,l as S,f as Q,b as U}from"./framework.zmD4b-eB.js";import{g as a,n as $}from"./colors.uFY4QJSc.js";import{u as X}from"./midi.RNICv3HM.js";import{s as b,n as w,i as Y}from"./theory.76qaQigv.js";import{a as N}from"./index.iB1AmcYb.js";import{u as K,D as A}from"./index.qXrjdxB9.js";function Z(){const t=K(W("midi-keys-begin",0),0,127),c=K(W("midi-keys-end",44),t,127),x=A(t),h=A(c),f=y(),D=y(),z=E(()=>Array(h.value+1-x.value).fill(0).map((r,m)=>m+x.value));return N({onDrag(i){i.event.preventDefault();let r=t.value+i.delta[0]/5;r+1<=c.value&&(t.value=Math.round(r))},onWheel(i){i.event.preventDefault();let r=t.value-i.velocities[0]/5;r+1<=c.value&&(t.value=Math.round(r))}},{domTarget:f,eventOptions:{passive:!1}}),N({onDrag(i){i.event.preventDefault();let r=c.value+i.delta[0]/5;r>t.value&&(c.value=r)},onWheel(i){i.event.preventDefault();let r=c.value-i.velocities[0]/5;r-1>t.value&&(c.value=r)}},{domTarget:D,eventOptions:{passive:!1}}),{begin:t,end:c,roundBegin:x,roundEnd:h,beginControl:f,endControl:D,keys:z}}const _=["viewBox"],p=["transform"],tt=["transform"],et=["height","width","fill"],nt=["x","y"],ot=["transform","stroke"],lt=["transform"],st=["transform"],at=["width","height"],it=["y"],rt=["transform","opacity"],ct=["transform"],ht=["transform"],ut=["cy","fill"],dt=["transform"],ft=["height","width","fill"],vt=["y"],wt=["transform"],gt=["transform"],mt=["transform"],yt=["height","width","fill"],xt=["x","y"],kt=["transform"],$t=["transform"],bt={class:"keys"},Ot=["transform"],Mt=["width","height","fill","onMousedown","onMouseenter","onTouchstart","onMouseleave","onMouseup","onTouchend","onTouchcancel"],Ct=["r","cx","cy","opacity","fill"],Nt=["x","y","font-size"],Dt=["x1","x2","y2","stroke"],Tt=["x","y","font-size"],Bt=["fill","y","x","font-size","font-weight"],zt={__name:"MidiKeys",props:{width:{type:Number,default:1200},height:{type:Number,default:500},controlOffset:{type:Number,default:100},slotOffset:{type:Number,default:0}},setup(t){const{midi:c,playKey:x}=X(),{roundBegin:h,roundEnd:f,beginControl:D,endControl:z,keys:i}=Z(),r=y(),m=y(!1);N({onPointerdown(n){m.value=!0},onPointerleave(n){m.value=!1},onPointercancel(n){m.value=!1},onPointerup(n){m.value=!1}},{domTarget:r});function I(n){x(n-7,0,0,a.isIn(w[n%12])?1:.3)}function T(n){x(n-7,0,1,0)}const V=y(),P=y(a.tonic*100);j(P,n=>{a.tonic=Math.round((n/100%12+12)%12)}),N({onDrag(n){n.event.preventDefault(),P.value+=n.delta[0]*5},onWheel(n){n.event.preventDefault(),P.value-=n.velocities[0]*5}},{domTarget:V,eventOptions:{passive:!1}});const F=y(),O=K(10,1,b.length-1);N({onDrag(n){n.event.preventDefault(),O.value+=n.delta[0]/5},onWheel(n){n.event.preventDefault(),O.value-=n.velocities[0]/5}},{domTarget:F,eventOptions:{passive:!1}});const L=E(()=>{let n=Math.round(O.value);return b[n]});j(L,n=>{a.chroma=n.chroma});const B=W("filter-keys",!0),s=E(()=>B.value?i.value.filter(n=>a.isIn(w[(n+3)%12])):i.value);return(n,R)=>{const G=q;return u(),d("svg",{class:"w-full cursor-pointer fullscreen-container overflow-hidden select-none touch-none",viewBox:`0 -${t.controlOffset+t.slotOffset} ${t.width} ${t.height+t.controlOffset}`,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},ref_key:"keyboard",ref:r},[l("g",{class:"slot",transform:`translate(0,${-t.slotOffset-t.controlOffset})`},[J(n.$slots,"default",{},void 0,!0)],8,p),l("g",{class:"offset",transform:`translate(0,${-t.controlOffset})`},[l("g",{class:"tonic",ref_key:"tonicControl",ref:V},[l("rect",{height:t.controlOffset,width:t.width/5,fill:e($)(e(a).tonic,2,.8)},null,8,et),l("text",{class:"font-bold text-6xl",x:t.width/10,"text-anchor":"middle",y:t.controlOffset*.75},g(e(w)[e(a).tonic%12]),9,nt),(u(!0),d(M,null,C(e(w),(o,v)=>(u(),d("line",{transform:`translate(${(v/12+1/24)*t.width/5},0)`,y2:16,"stroke-width":"2","stroke-linecap":"round",stroke:e($)(v,5,.4)},null,8,ot))),256)),l("line",{class:"transition",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(a).tonic/12*t.width/5+t.width/120},0)`,stroke:"white"},null,8,lt)],512),l("g",{class:"scale",ref_key:"scaleControl",ref:F,transform:`translate(${t.width/5},0)`},[l("rect",{width:t.width*2/5,height:t.controlOffset,fill:"#aaa"},null,8,at),l("text",{class:"text-4xl",x:30,y:t.controlOffset*.75},g(L.value.name),9,it),(u(!0),d(M,null,C(e(b).length,(o,v)=>(u(),d("line",{transform:`translate(${(v/e(b).length+1/e(b).length)*t.width*2/5},0)`,y2:36,opacity:o==Math.round(e(O))?1:.2,"stroke-width":"2","stroke-linecap":"round",stroke:"white"},null,8,rt))),256)),l("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(O)/e(b).length*t.width*2/5},0)`,stroke:"white"},null,8,ct),l("g",{class:"show",transform:`translate(${t.width*2/5-50},10)`,onClick:R[0]||(R[0]=o=>B.value=!e(B))},[l("circle",{cy:t.controlOffset*.5,r:"20",fill:e(B)?"black":"transparent",stroke:"black","stroke-width":4},null,8,ut)],8,ht)],8,st),l("g",{class:"begin",ref_key:"beginControl",ref:D,transform:`translate(${t.width*3/5},0)`},[l("rect",{height:t.controlOffset,width:t.width/5,fill:e($)(e(h)+3,null,e(c).activeNotes[e(h)]?1:.1)},null,8,ft),l("text",{class:"font-bold text-6xl",x:10,y:t.controlOffset*.75},g(e(w)[(e(h)+3)%12])+g(Math.floor((Math.round(e(h))+3)/12)-1),9,vt),(u(!0),d(M,null,C(e(f),(o,v)=>(u(),d("line",{class:"pointer-events-none",transform:`translate(${v/e(f)*t.width/5},0)`,y2:16,opacity:".3","stroke-width":"2","stroke-linecap":"round",stroke:"white"},null,8,wt))),256)),l("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(h)/e(f)*t.width/5},0)`,stroke:"white"},null,8,gt)],8,dt),l("g",{class:"end",ref_key:"endControl",ref:z,transform:`translate(${t.width*4/5},0)`},[l("rect",{height:t.controlOffset,width:t.width/5,fill:e($)(e(f)+3,null,e(c).activeNotes[e(f)]?1:.1)},null,8,yt),l("text",{class:"font-bold text-6xl pointer-events-none",x:t.width/5-20,"text-anchor":"end",y:t.controlOffset*.75},g(e(w)[(e(f)+3)%12])+g(Math.floor((e(f)+3)/12)-1),9,xt),(u(!0),d(M,null,C(Number(127-e(h)),(o,v)=>(u(),d("line",{class:"pointer-events-none",transform:`translate(${v/(127-e(h))*t.width/5},0)`,y2:16,opacity:".3","stroke-width":"2","stroke-linecap":"round",stroke:"white"},null,8,kt))),256)),l("line",{class:"pointer-events-none",y2:20,"stroke-width":"8","stroke-linecap":"round",stroke:"white",transform:`translate(${(e(f)-e(h))/(127-e(h))*t.width/5},0)`},null,8,$t)],8,mt)],8,tt),l("g",bt,[(u(!0),d(M,null,C(s.value,(o,v)=>(u(),d("g",{class:"key",key:o,transform:`translate(${v*t.width/s.value.length},0)`,"text-anchor":"middle"},[l("rect",{width:t.width/s.value.length,height:t.height,fill:e($)(o+3,null,e(c).activeNotes[o]?1:.1,e(a).isIn(e(w)[(o+3)%12])?1:.4),onMousedown:S(k=>I(o+3),["prevent"]),onMouseenter:k=>m.value?I(o+3):null,onTouchstart:S(k=>I(o+3),["prevent"]),onMouseleave:k=>T(o+3),onMouseup:S(k=>T(o+3),["prevent"]),onTouchend:k=>T(o+3),onTouchcancel:k=>T(o+3)},null,40,Mt),l("circle",{class:"pointer-events-none",r:e(a).tonic==(o+3)%12?t.width/s.value.length/3:t.width/s.value.length/8,cx:t.width/s.value.length/2,cy:t.height-t.width/s.value.length/2,opacity:e(c).activeNotes[o]?1:.3,fill:e(a).isIn(e(w)[(o+3)%12])?"white":"black"},null,8,Ct),Q(G,{cx:t.width/s.value.length/2,cy:t.height-t.width/s.value.length/2,radius:t.width/s.value.length/3,from:0,opacity:.4,to:30*((o+e(a).tonic-9)%12),thickness:t.width/s.value.length/5,round:!0,fill:"white"},null,8,["cx","cy","radius","to","thickness"]),l("text",{class:"opacity-75 pointer-events-none",x:t.width/s.value.length/2,y:t.height-t.width/s.value.length*1.1,"font-size":t.width/s.value.length*.5},g(e(Y)[(o+3-e(a).tonic)%12]),9,Nt),e(a).tonic==(o+3)%12?(u(),d("line",{key:0,class:"pointer-events-none",x1:t.width/s.value.length/2,x2:t.width/s.value.length/2,y1:0,y2:t.height,"stroke-width":"6",opacity:.9,stroke:e(c).activeNotes[o]?"white":e($)(o+3,-1,1,1)},null,8,Dt)):U("",!0),l("text",{class:"opacity-75 pointer-events-none",x:t.width/s.value.length/2,y:t.width/s.value.length+10,"font-size":t.width/s.value.length*.333},g(o),9,Tt),l("text",{class:"pointer-events-none",fill:e(a).isIn(e(w)[(o+3)%12])?"black":"#777e",y:t.width/s.value.length/2+10,x:t.width/s.value.length/2,"font-size":t.width/s.value.length*.5,"font-weight":e(a).tonic==(o+3)%12?"bold":"normal"},g(e(w)[(o+3)%12]),9,Bt)],8,Ot))),128))])],8,_)}}},Ft=H(zt,[["__scopeId","data-v-a9883683"]]);export{Ft as _};
