import{r as y,x as d,y as g,A as l,E as e,a0 as G,I as Q,G as m,u as I,c as C,q as U,ap as X,d as J,J as Z,F as S,B as T,M as p}from"./framework.-sYaBLvc.js";import{Y as L,c as b,g as r,n as f,i as _,af as tt,ag as et,J as W,ah as j,T as M,ai as q,S as z}from"./theme.DyXcm_Up.js";const nt=["transform"],ot=["width","height","fill"],lt={class:"marks pointer-events-none"},st=["x1","x2","y2","stroke"],at=["r","cx","cy","opacity","fill"],it=["x","y","font-size"],rt=["x","y","font-size"],ct=["fill","y","x","font-size","font-weight"],ut={__name:"MidiKeysNote",props:{note:{type:Number,default:0},step:{type:Number,default:0},width:{type:Number,default:1200},height:{type:Number,default:400},pressed:{type:Boolean,default:!1}},setup(t){const{midi:i,playKey:h}=L();function s(o,n=10){return o=Math.max(0,Math.min(1,o)),Math.log(1+n*o)/Math.log(1+n)}function w(o,n){n==null||n.preventDefault();const c=n.target.getBoundingClientRect(),V=n.clientY-c.top,D=c.height,B=V/D,k=.3+s(B)*.7,P=r.isIn(f[o%12])?1:.3,x=k*P;h(o-7,0,!1,x),tt({number:o-3,velocity:Math.round(x*127)})}function v(o,n){h(o-7,0,!0,0),et({number:o-3})}const N=y();return(o,n)=>(d(),g("g",{class:"note",transform:`translate(${t.step*t.width},0)`,"text-anchor":"middle",ref_key:"noteKey",ref:N},[l("rect",{width:t.width,height:t.height,fill:e(b)(t.note+3,null,e(i).activeNotes[t.note]?1:.1,e(r).isIn(e(f)[(t.note+3)%12])?1:.4),onPointerdown:n[0]||(n[0]=G(c=>w(t.note+3,c),["prevent"])),onPointerenter:n[1]||(n[1]=c=>t.pressed?w(t.note+3,c):null),onPointerleave:n[2]||(n[2]=c=>v(t.note+3)),onPointerup:n[3]||(n[3]=G(c=>v(t.note+3),["prevent"])),onTouchcancel:n[4]||(n[4]=c=>v(t.note+3))},null,40,ot),l("g",lt,[e(r).tonic==(t.note+3)%12?(d(),g("line",{key:0,x1:t.width/2,x2:t.width/2,y1:0,y2:t.height,"stroke-width":"6",opacity:.9,stroke:e(i).activeNotes[t.note]?"white":e(b)(t.note+3,-1,1,1)},null,8,st)):Q("",!0),l("circle",{r:e(r).tonic==(t.note+3)%12?t.width/3:t.width/8,cx:t.width/2,cy:t.height-t.width/2,opacity:e(i).activeNotes[t.note]?1:.3,fill:e(r).isIn(e(f)[(t.note+3)%12])?"white":"black"},null,8,at),l("text",{class:"opacity-75 number",x:t.width/2,y:t.width*1.8,"font-size":t.width*.333},m(e(_)[(t.note+3-e(r).tonic)%12]),9,it),l("text",{class:"opacity-55",x:t.width/2,y:t.width+14,"font-size":t.width*.333},m(t.note),9,rt),l("text",{fill:e(r).isIn(e(f)[(t.note+3)%12])?"black":"#777e",y:t.width/2+10,x:t.width/2,"font-size":t.width*.5,"font-weight":e(r).tonic==(t.note+3)%12?"bold":"normal"},m(e(f)[(t.note+3)%12]),9,ct)])],8,nt))}};function dt(){const t=W(I("midi-keys-begin",45),0,127),i=W(I("midi-keys-end",83),t,127),h=j(t),s=j(i),w=y(),v=y(),N=C(()=>Array(s.value+1-h.value).fill(0).map((n,c)=>c+h.value));return M({onDrag(o){o.event.preventDefault();let n=t.value+o.delta[0]/5;n+1<=i.value&&(t.value=Math.round(n))},onWheel(o){o.event.preventDefault();let n=t.value-o.velocities[0]/5;n+1<=i.value&&(t.value=Math.round(n))}},{domTarget:w,eventOptions:{passive:!1}}),M({onDrag(o){o.event.preventDefault();let n=i.value+o.delta[0]/5;n>t.value&&(i.value=n)},onWheel(o){o.event.preventDefault();let n=i.value-o.velocities[0]/5;n-1>t.value&&(i.value=n)}},{domTarget:v,eventOptions:{passive:!1}}),{begin:t,end:i,roundBegin:h,roundEnd:s,beginControl:w,endControl:v,keys:N}}const ft=["viewBox"],ht=["transform"],vt=["transform"],gt=["height","width","fill"],yt=["x","y"],mt=["transform","stroke"],wt=["transform"],kt=["transform"],xt=["width","height"],$t=["y"],bt=["transform","opacity"],Ot=["transform"],Ct=["transform"],Mt=["cy","fill"],Nt=["transform"],Dt=["height","width","fill"],Bt=["y"],Pt=["transform"],Kt=["height","width","fill"],St=["x","y"],Tt=["transform"],zt=["transform","stroke"],It=["x","width"],Vt=["transform"],Wt=["transform"],Et={__name:"MidiKeys",props:{width:{type:Number},height:{type:Number},controlOffset:{type:Number,default:100},slotOffset:{type:Number,default:0}},setup(t){const i=t,h=X(),s=C(()=>i.width||h.width.value),w=C(()=>i.height||h.height.value-80),{midi:v,playKey:N}=L(),{roundBegin:o,roundEnd:n,beginControl:c,endControl:V,keys:D}=dt(),B=y(),E=y(),k=y(!1);M({onPointerdown(a){k.value=!0},onPointerleave(a){k.value=!1},onPointercancel(a){k.value=!1},onPointerup(a){k.value=!1}},{domTarget:B});const P=y(),x=y(r.tonic*100);J(x,a=>{r.tonic=Math.round((a/100%12+12)%12)}),M({onDrag(a){a.event.preventDefault(),x.value+=a.delta[0]},onWheel(a){a.event.preventDefault(),x.value-=a.velocities[0]}},{domTarget:P,eventOptions:{passive:!1}});const R=y(),O=W(I("midikeys-scale",1),1,q().length-1);M({onDrag(a){a.event.preventDefault(),O.value+=a.delta[0]/5},onWheel(a){a.event.preventDefault(),O.value-=a.velocities[0]/5}},{domTarget:R,eventOptions:{passive:!1}});const A=C(()=>{let a=Math.round(O.value);return q()[a]});J(A,a=>{r.chroma=a.chroma});const K=I("filter-keys",!0),F=C(()=>K.value?D.value.filter(a=>r.isIn(f[(a+3)%12])):D.value);return(a,Y)=>{const H=ut;return d(),g("svg",{class:"w-full cursor-pointer fullscreen-container overflow-hidden select-none touch-none",viewBox:`0 -${t.controlOffset+t.slotOffset} ${s.value} ${w.value+t.controlOffset}`,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},ref_key:"svg",ref:B},[l("g",{class:"slot",transform:`translate(0,${-t.slotOffset-t.controlOffset})`},[Z(a.$slots,"default",{},void 0,!0)],8,ht),l("g",{class:"offset",transform:`translate(0,${-t.controlOffset})`},[l("g",{class:"tonic",ref_key:"tonicControl",ref:P},[l("rect",{height:t.controlOffset,width:s.value/5,fill:e(b)(e(r).tonic,2,.8)},null,8,gt),l("text",{class:"font-bold text-5xl",x:s.value/10,"text-anchor":"middle",y:t.controlOffset*.75},m(e(f)[e(r).tonic%12]),9,yt),(d(!0),g(S,null,T(e(f),($,u)=>(d(),g("line",{transform:`translate(${(u/12+1/24)*s.value/5},0)`,y2:16,"stroke-width":"6","stroke-linecap":"round",stroke:e(b)(u,5,.4)},null,8,mt))),256)),l("line",{class:"transition",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${(x.value/1200%1+1)%1*s.value/5+s.value/120},0)`,stroke:"white"},null,8,wt)],512),l("g",{class:"scale",ref_key:"scaleControl",ref:R,transform:`translate(${s.value/5},0)`},[l("rect",{width:s.value*2/5,height:t.controlOffset,fill:"#aaa"},null,8,xt),l("text",{class:"text-4xl",x:30,y:t.controlOffset*.75},m(A.value.name),9,$t),(d(!0),g(S,null,T(e(z).all().length,($,u)=>(d(),g("line",{transform:`translate(${(u/e(z).all().length+1/e(z).all().length)*s.value*2/5},0)`,y2:36,opacity:$==Math.round(e(O))?1:.2,"stroke-width":"2","stroke-linecap":"round",stroke:"currentColor"},null,8,bt))),256)),l("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(O)/e(z).all().length*s.value*2/5},0)`,stroke:"white"},null,8,Ot),l("g",{class:"show",transform:`translate(${s.value*2/5-50},10)`},[l("circle",{onClick:Y[0]||(Y[0]=$=>K.value=!e(K)),cy:t.controlOffset*.5,r:"20",fill:e(K)?"black":"transparent",stroke:"black","stroke-width":4},null,8,Mt)],8,Ct)],8,kt),l("g",{class:"begin",ref_key:"beginControl",ref:c,transform:`translate(${s.value*3/5},0)`},[l("rect",{height:t.controlOffset,width:s.value/5,fill:e(b)(e(o)+3,null,e(v).activeNotes[e(o)]?1:.1)},null,8,Dt),l("text",{class:"font-bold text-5xl pointer-events-none",x:10,y:t.controlOffset*.75},m(e(f)[(e(o)+3)%12])+m(Math.floor((Math.round(e(o))+3)/12)-1),9,Bt)],8,Nt),l("g",{class:"end",ref_key:"endControl",ref:V,transform:`translate(${s.value*4/5},0)`},[l("rect",{height:t.controlOffset,width:s.value/5,fill:e(b)(e(n)+3,null,e(v).activeNotes[e(n)]?1:.1)},null,8,Kt),l("text",{class:"font-bold text-5xl pointer-events-none",x:s.value/5-20,"text-anchor":"end",y:t.controlOffset*.75},m(e(f)[(e(n)+3)%12])+m(Math.floor((e(n)+3)/12)-1),9,St)],8,Pt),l("g",{class:"range pointer-events-none",transform:`translate(${s.value*3/5},0)`},[(d(),g(S,null,T(127,($,u)=>l("line",{transform:`translate(${u/127*s.value*2/5},0)`,y2:16,opacity:".3","stroke-width":"2","stroke-linecap":"round",stroke:(u+3)%12==e(r).tonic?e(b)((u+3)%12):"white"},null,8,zt)),64)),l("rect",{class:"ranger",x:e(o)/127*s.value*2/5,width:(e(n)-e(o))/127*s.value*2/5,height:"20",fill:"gray",opacity:.8},null,8,It),l("line",{class:"begin",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(o)/127*s.value*2/5},0)`,stroke:"white"},null,8,Vt),l("line",{class:"end",y2:20,"stroke-width":"8","stroke-linecap":"round",stroke:"white",transform:`translate(${e(n)/127*s.value*2/5},0)`},null,8,Wt)],8,Tt)],8,vt),l("g",{class:"keys",ref_key:"area",ref:E},[(d(!0),g(S,null,T(F.value,($,u)=>(d(),p(H,{key:$,note:$,step:u,width:s.value/F.value.length,height:w.value,pressed:k.value},null,8,["note","step","width","height","pressed"]))),128))],512)],8,ft)}}},Ft=U(Et,[["__scopeId","data-v-3051fb10"]]);export{Ft as _};
