import{r as g,x as f,y as v,A as n,E as e,S as L,I as Q,G as y,u as I,c as C,q as U,an as X,d as Y,J as Z,F as S,B as T,T as p}from"./framework.Bh6q1hI4.js";import{N as J,c as $,g as c,n as h,x as W,i as _,u as tt,D as E,O as j,L as M,P as q,S as z}from"./theme.DIa4sgO1.js";const et=["transform"],nt=["width","height","fill"],ot={class:"marks pointer-events-none"},lt=["x1","x2","y2","stroke"],st=["r","cx","cy","opacity","fill"],at=["x","y","font-size"],it=["x","y","font-size"],rt=["fill","y","x","font-size","font-weight"],ct={__name:"MidiKeysNote",props:{note:{type:Number,default:0},step:{type:Number,default:0},width:{type:Number,default:1200},height:{type:Number,default:400},pressed:{type:Boolean,default:!1}},setup(t){const{activeNotes:r}=J();function m(u,l=10){return u=Math.max(0,Math.min(1,u)),Math.log(1+l*u)/Math.log(1+l)}function o(u,l){l==null||l.preventDefault();const s=l.target.getBoundingClientRect(),i=l.clientY-s.top,b=s.height,N=i/b,V=.3+m(N)*.7,k=c.isIn(h[(u+3)%12])?1:.5,D=V*k;tt(u,D)}const w=g();return(u,l)=>(f(),v("g",{class:"note",transform:`translate(${t.step*t.width},0)`,"text-anchor":"middle",ref_key:"noteKey",ref:w},[n("rect",{width:t.width,height:t.height,fill:e($)(t.note+3,null,e(r)[t.note]?1:.1,e(c).isIn(e(h)[(t.note+3)%12])?1:.4),onPointerdown:l[0]||(l[0]=L(s=>o(t.note,s),["prevent"])),onPointerenter:l[1]||(l[1]=s=>t.pressed?o(t.note,s):null),onPointerleave:l[2]||(l[2]=s=>e(W)(t.note)),onPointerup:l[3]||(l[3]=L(s=>e(W)(t.note),["prevent"])),onTouchcancel:l[4]||(l[4]=s=>e(W)(t.note))},null,40,nt),n("g",ot,[e(c).tonic==(t.note+3)%12?(f(),v("line",{key:0,x1:t.width/2,x2:t.width/2,y1:0,y2:t.height,"stroke-width":"6",opacity:.9,stroke:e(r)[t.note]?"white":e($)(t.note+3,-1,1,1)},null,8,lt)):Q("",!0),n("circle",{r:e(c).tonic==(t.note+3)%12?t.width/3:t.width/8,cx:t.width/2,cy:t.height-t.width/2,opacity:e(r)[t.note]?1:.3,fill:e(c).isIn(e(h)[(t.note+3)%12])?"white":"black"},null,8,st),n("text",{class:"opacity-75 number",x:t.width/2,y:t.width*1.8,"font-size":t.width*.333},y(e(_)[(t.note+3-e(c).tonic)%12]),9,at),n("text",{class:"opacity-55",x:t.width/2,y:t.width+14,"font-size":t.width*.333},y(t.note),9,it),n("text",{fill:e(c).isIn(e(h)[(t.note+3)%12])?"black":"#777e",y:t.width/2+10,x:t.width/2,"font-size":t.width*.5,"font-weight":e(c).tonic==(t.note+3)%12?"bold":"normal"},y(e(h)[(t.note+3)%12]),9,rt)])],8,et))}};function ut(){const t=E(I("midi-keys-begin",45),0,127),r=E(I("midi-keys-end",83),t,127),m=j(t),o=j(r),w=g(),u=g(),l=C(()=>Array(o.value+1-m.value).fill(0).map((i,b)=>b+m.value));return M({onDrag(s){s.event.preventDefault();let i=t.value+s.delta[0]/5;i+1<=r.value&&(t.value=Math.round(i))},onWheel(s){s.event.preventDefault();let i=t.value-s.velocities[0]/5;i+1<=r.value&&(t.value=Math.round(i))}},{domTarget:w,eventOptions:{passive:!1}}),M({onDrag(s){s.event.preventDefault();let i=r.value+s.delta[0]/5;i>t.value&&(r.value=i)},onWheel(s){s.event.preventDefault();let i=r.value-s.velocities[0]/5;i-1>t.value&&(r.value=i)}},{domTarget:u,eventOptions:{passive:!1}}),{begin:t,end:r,roundBegin:m,roundEnd:o,beginControl:w,endControl:u,keys:l}}const dt=["viewBox"],ft=["transform"],ht=["transform"],vt=["height","width","fill"],gt=["x","y"],yt=["transform","stroke"],mt=["transform"],wt=["transform"],kt=["width","height"],xt=["y"],$t=["transform","opacity"],bt=["transform"],Ot=["transform"],Ct=["cy","fill"],Mt=["transform"],Nt=["height","width","fill"],Dt=["y"],Bt=["transform"],Pt=["height","width","fill"],St=["x","y"],Tt=["transform"],zt=["transform","stroke"],It=["x","width"],Kt=["transform"],Vt=["transform"],Wt={__name:"MidiKeys",props:{width:{type:Number},height:{type:Number},controlOffset:{type:Number,default:100},slotOffset:{type:Number,default:0}},setup(t){const r=t,m=X(),o=C(()=>r.width||m.width.value),w=C(()=>r.height||m.height.value-80),{activeNotes:u}=J(),{roundBegin:l,roundEnd:s,beginControl:i,endControl:b,keys:N}=ut(),K=g(),V=g(),k=g(!1);M({onPointerdown(a){k.value=!0},onPointerleave(a){k.value=!1},onPointercancel(a){k.value=!1},onPointerup(a){k.value=!1}},{domTarget:K});const D=g(),B=g(c.tonic*100);Y(B,a=>{c.tonic=Math.round((a/100%12+12)%12)}),M({onDrag(a){a.event.preventDefault(),B.value+=a.delta[0]},onWheel(a){a.event.preventDefault(),B.value-=a.velocities[0]}},{domTarget:D,eventOptions:{passive:!1}});const F=g(),O=E(I("midikeys-scale",1),1,q().length-1);M({onDrag(a){a.event.preventDefault(),O.value+=a.delta[0]/5},onWheel(a){a.event.preventDefault(),O.value-=a.velocities[0]/5}},{domTarget:F,eventOptions:{passive:!1}});const R=C(()=>{let a=Math.round(O.value);return q()[a]});Y(R,a=>{c.chroma=a.chroma});const P=I("filter-keys",!0),A=C(()=>P.value?N.value.filter(a=>c.isIn(h[(a+3)%12])):N.value);return(a,G)=>{const H=ct;return f(),v("svg",{class:"w-full cursor-pointer fullscreen-container overflow-hidden select-none touch-none",viewBox:`0 -${t.controlOffset+t.slotOffset} ${o.value} ${w.value+t.controlOffset}`,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},ref_key:"svg",ref:K},[n("g",{class:"slot",transform:`translate(0,${-t.slotOffset-t.controlOffset})`},[Z(a.$slots,"default",{},void 0,!0)],8,ft),n("g",{class:"offset",transform:`translate(0,${-t.controlOffset})`},[n("g",{class:"tonic",ref_key:"tonicControl",ref:D},[n("rect",{height:t.controlOffset,width:o.value/5,fill:e($)(e(c).tonic,2,.8)},null,8,vt),n("text",{class:"font-bold text-5xl",x:o.value/10,"text-anchor":"middle",y:t.controlOffset*.75},y(e(h)[e(c).tonic%12]),9,gt),(f(!0),v(S,null,T(e(h),(x,d)=>(f(),v("line",{transform:`translate(${(d/12+1/24)*o.value/5},0)`,y2:16,"stroke-width":"6","stroke-linecap":"round",stroke:e($)(d,5,.4)},null,8,yt))),256)),n("line",{class:"transition",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${(B.value/1200%1+1)%1*o.value/5+o.value/120},0)`,stroke:"white"},null,8,mt)],512),n("g",{class:"scale",ref_key:"scaleControl",ref:F,transform:`translate(${o.value/5},0)`},[n("rect",{width:o.value*2/5,height:t.controlOffset,fill:"#aaa"},null,8,kt),n("text",{class:"text-4xl",x:30,y:t.controlOffset*.75},y(R.value.name),9,xt),(f(!0),v(S,null,T(e(z).all().length,(x,d)=>(f(),v("line",{transform:`translate(${(d/e(z).all().length+1/e(z).all().length)*o.value*2/5},0)`,y2:36,opacity:x==Math.round(e(O))?1:.2,"stroke-width":"2","stroke-linecap":"round",stroke:"currentColor"},null,8,$t))),256)),n("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(O)/e(z).all().length*o.value*2/5},0)`,stroke:"white"},null,8,bt),n("g",{class:"show",transform:`translate(${o.value*2/5-50},10)`},[n("circle",{onClick:G[0]||(G[0]=x=>P.value=!e(P)),cy:t.controlOffset*.5,r:"20",fill:e(P)?"black":"transparent",stroke:"black","stroke-width":4},null,8,Ct)],8,Ot)],8,wt),n("g",{class:"begin",ref_key:"beginControl",ref:i,transform:`translate(${o.value*3/5},0)`},[n("rect",{height:t.controlOffset,width:o.value/5,fill:e($)(e(l)+3,null,e(u)[e(l)]?1:.1)},null,8,Nt),n("text",{class:"font-bold text-5xl pointer-events-none",x:10,y:t.controlOffset*.75},y(e(h)[(e(l)+3)%12])+y(Math.floor((Math.round(e(l))+3)/12)-1),9,Dt)],8,Mt),n("g",{class:"end",ref_key:"endControl",ref:b,transform:`translate(${o.value*4/5},0)`},[n("rect",{height:t.controlOffset,width:o.value/5,fill:e($)(e(s)+3,null,e(u)[e(s)]?1:.1)},null,8,Pt),n("text",{class:"font-bold text-5xl pointer-events-none",x:o.value/5-20,"text-anchor":"end",y:t.controlOffset*.75},y(e(h)[(e(s)+3)%12])+y(Math.floor((e(s)+3)/12)-1),9,St)],8,Bt),n("g",{class:"range pointer-events-none",transform:`translate(${o.value*3/5},0)`},[(f(),v(S,null,T(127,(x,d)=>n("line",{transform:`translate(${d/127*o.value*2/5},0)`,y2:16,opacity:".3","stroke-width":"2","stroke-linecap":"round",stroke:(d+3)%12==e(c).tonic?e($)((d+3)%12):"white"},null,8,zt)),64)),n("rect",{class:"ranger",x:e(l)/127*o.value*2/5,width:(e(s)-e(l))/127*o.value*2/5,height:"20",fill:"gray",opacity:.8},null,8,It),n("line",{class:"begin",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(l)/127*o.value*2/5},0)`,stroke:"white"},null,8,Kt),n("line",{class:"end",y2:20,"stroke-width":"8","stroke-linecap":"round",stroke:"white",transform:`translate(${e(s)/127*o.value*2/5},0)`},null,8,Vt)],8,Tt)],8,ht),n("g",{class:"keys",ref_key:"area",ref:V},[(f(!0),v(S,null,T(A.value,(x,d)=>(f(),p(H,{key:x,note:x,step:d,width:o.value/A.value.length,height:w.value,pressed:k.value},null,8,["note","step","width","height","pressed"]))),128))],512)],8,dt)}}},Rt=U(Wt,[["__scopeId","data-v-16130881"]]);export{Rt as _};
