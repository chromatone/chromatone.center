import{R as H,c as N,g as f,n as k,i as Z,F as W,u as A,T as L,P as C,U,v as b,y as S,S as z}from"./theme.DKUtGHOP.js";import{r as m,q as g,f as v,s as o,u as t,t as _,z as y,M as Y,_ as p,I as j,k as ee,F,Y as K,e as te}from"./framework.Bbwy4zmA.js";const ne=["transform"],oe=["data-note","width","height","fill"],le={class:"marks pointer-events-none"},ae=["x1","x2","y2","stroke"],se=["r","cx","cy","opacity","fill"],ie=["x","y","font-size"],re=["x","y","font-size"],ce=["fill","y","x","font-size","font-weight"],de={__name:"MidiKeysNote",props:{note:{type:Number,default:0},step:{type:Number,default:0},width:{type:Number,default:1200},height:{type:Number,default:400},pressed:{type:Boolean,default:!1}},setup(e){const{activeNotes:i}=H(),h=m();return(u,T)=>(v(),g("g",{class:"note",transform:`translate(${e.step*e.width},0)`,"text-anchor":"middle",ref_key:"noteKey",ref:h},[o("rect",{class:"note-cell","data-note":e.note,width:e.width,height:e.height,fill:t(N)(e.note+3,null,t(i)[e.note]?1:.1,t(f).isIn(t(k)[(e.note+3)%12])?1:.4)},null,8,oe),o("g",le,[t(f).tonic==(e.note+3)%12?(v(),g("line",{key:0,x1:e.width/2,x2:e.width/2,y1:0,y2:e.height,"stroke-width":"6",opacity:.9,stroke:t(i)[e.note]?"white":t(N)(e.note+3,-1,1,1)},null,8,ae)):_("",!0),o("circle",{r:t(f).tonic==(e.note+3)%12?e.width/3:e.width/8,cx:e.width/2,cy:e.height-e.width/2,opacity:t(i)[e.note]?1:.3,fill:t(f).isIn(t(k)[(e.note+3)%12])?"white":"black"},null,8,se),o("text",{class:"opacity-75 number",x:e.width/2,y:e.width*1.8,"font-size":e.width*.333},y(t(Z)[(e.note+3-t(f).tonic)%12]),9,ie),o("text",{class:"opacity-55",x:e.width/2,y:e.width+14,"font-size":e.width*.333},y(e.note),9,re),o("text",{fill:t(f).isIn(t(k)[(e.note+3)%12])?"black":"#777e",y:e.width/2+10,x:e.width/2,"font-size":e.width*.5,"font-weight":t(f).tonic==(e.note+3)%12?"bold":"normal"},y(t(k)[(e.note+3)%12]),9,ce)])],8,ne))}};function fe(){const e=W(A("midi-keys-begin",45),0,127),i=W(A("midi-keys-end",83),e,127),h=L(e),u=L(i),T=m(),E=m(),P=Y(()=>Array(u.value+1-h.value).fill(0).map((c,x)=>x+h.value));return C({onDrag(r){r.event.preventDefault();let c=e.value+r.delta[0]/5;c+1<=i.value&&(e.value=Math.round(c))},onWheel(r){r.event.preventDefault();let c=e.value-r.velocities[0]/5;c+1<=i.value&&(e.value=Math.round(c))}},{domTarget:T,eventOptions:{passive:!1}}),C({onDrag(r){r.event.preventDefault();let c=i.value+r.delta[0]/5;c>e.value&&(i.value=c)},onWheel(r){r.event.preventDefault();let c=i.value-r.velocities[0]/5;c-1>e.value&&(i.value=c)}},{domTarget:E,eventOptions:{passive:!1}}),{begin:e,end:i,roundBegin:h,roundEnd:u,beginControl:T,endControl:E,keys:P}}const he=["viewBox"],ue=["transform"],ve=["transform"],me=["height","width","fill"],we=["x","y"],ge=["transform","stroke"],ye=["transform"],ke=["transform"],xe=["width","height"],$e=["y"],be=["transform","opacity"],Ne=["transform"],Oe=["transform"],De=["cy","fill"],Ce=["transform"],Te=["height","width","fill"],Me=["y"],Ee=["transform"],Pe=["height","width","fill"],Be=["x","y"],Ie=["transform"],Se=["transform","stroke"],ze=["x","width"],Fe=["transform"],Ke=["transform"],Ae={__name:"MidiKeys",props:{width:{type:Number,default:900},height:{type:Number,default:400},controlOffset:{type:Number,default:100},slotOffset:{type:Number,default:0}},setup(e){const{activeNotes:i}=H(),{roundBegin:h,roundEnd:u,beginControl:T,endControl:E,keys:P}=fe(),r=m(),c=m(),x=m(!1);C({onPointerdown(n){x.value=!0},onPointerleave(n){x.value=!1},onPointercancel(n){x.value=!1},onPointerup(n){x.value=!1}},{domTarget:r});const R=m(),B=m(f.tonic*100);j(B,n=>{f.tonic=Math.round((n/100%12+12)%12)}),C({onDrag(n){n.event.preventDefault(),B.value+=n.delta[0]},onWheel(n){n.event.preventDefault(),B.value-=n.velocities[0]}},{domTarget:R,eventOptions:{passive:!1}});const X=m(),M=W(A("midikeys-scale",1),1,U().length-1);C({onDrag(n){n.event.preventDefault(),M.value+=n.delta[0]/5},onWheel(n){n.event.preventDefault(),M.value-=n.velocities[0]/5}},{domTarget:X,eventOptions:{passive:!1}});const V=Y(()=>{let n=Math.round(M.value);return U()[n]});j(V,n=>{f.chroma=n.chroma});const I=A("filter-keys",!0),q=Y(()=>I.value?P.value.filter(n=>f.isIn(k[(n+3)%12])):P.value),w=m(null),$=new Map;C({onTouchstart:J,onTouchmove:Q,onTouchend:G,onTouchcancel:G,onDrag:({event:n,first:a,last:s,active:d})=>{n.preventDefault();const l=document.elementFromPoint(n.clientX,n.clientY);if(!l)return;const O=l.closest(".note-cell");if(!O)return;const D=parseInt(O.dataset.note);isNaN(D)||(a?(S(D),w.value=D):s?(b(w.value),w.value=null):d&&w.value!==D&&(b(w.value),S(D),w.value=D))},onDragEnd:()=>{w.value!==null&&(b(w.value),w.value=null)}},{domTarget:c,eventOptions:{passive:!1}});function J({event:n}){n.preventDefault(),Array.from(n.changedTouches).forEach(a=>{const s=document.elementFromPoint(a.clientX,a.clientY);if(!s)return;const d=s.closest(".note-cell");if(!d)return;const l=parseInt(d.dataset.note);isNaN(l)||($.set(a.identifier,l),S(l))})}function Q({event:n}){n.preventDefault(),Array.from(n.changedTouches).forEach(a=>{const s=$.get(a.identifier),d=document.elementFromPoint(a.clientX,a.clientY);if(!d){s!==void 0&&(b(s),$.delete(a.identifier));return}const l=d.closest(".note-cell");if(!l){s!==void 0&&(b(s),$.delete(a.identifier));return}const O=parseInt(l.dataset.note);O!==s&&(s!==void 0&&b(s),$.set(a.identifier,O),S(O))})}function G({event:n}){n.preventDefault(),Array.from(n.changedTouches).forEach(a=>{const s=$.get(a.identifier);s!==void 0&&(b(s),$.delete(a.identifier))})}return(n,a)=>{const s=de;return v(),g("svg",{class:"w-full cursor-pointer fullscreen-container overflow-hidden select-none touch-none",viewBox:`0 -${e.controlOffset+e.slotOffset} ${e.width} ${e.height+e.controlOffset}`,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},ref_key:"svg",ref:r},[o("g",{class:"slot",transform:`translate(0,${-e.slotOffset-e.controlOffset})`},[ee(n.$slots,"default",{},void 0,!0)],8,ue),o("g",{class:"offset",transform:`translate(0,${-e.controlOffset})`},[o("g",{class:"tonic",ref_key:"tonicControl",ref:R},[o("rect",{height:e.controlOffset,width:e.width/5,fill:t(N)(t(f).tonic,2,.8)},null,8,me),o("text",{class:"font-bold text-5xl",x:e.width/10,"text-anchor":"middle",y:e.controlOffset*.75},y(t(k)[t(f).tonic%12]),9,we),(v(!0),g(F,null,K(t(k),(d,l)=>(v(),g("line",{transform:`translate(${(l/12+1/24)*e.width/5},0)`,y2:16,"stroke-width":"6","stroke-linecap":"round",stroke:t(N)(l,5,.4)},null,8,ge))),256)),o("line",{class:"transition",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${(B.value/1200%1+1)%1*e.width/5+e.width/120},0)`,stroke:"white"},null,8,ye)],512),o("g",{class:"scale",ref_key:"scaleControl",ref:X,transform:`translate(${e.width/5},0)`},[o("rect",{width:e.width*2/5,height:e.controlOffset,fill:"#aaa"},null,8,xe),o("text",{class:"text-4xl",x:30,y:e.controlOffset*.75},y(V.value.name),9,$e),(v(!0),g(F,null,K(t(z).all().length,(d,l)=>(v(),g("line",{transform:`translate(${(l/t(z).all().length+1/t(z).all().length)*e.width*2/5},0)`,y2:36,opacity:d==Math.round(t(M))?1:.2,"stroke-width":"2","stroke-linecap":"round",stroke:"currentColor"},null,8,be))),256)),o("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${t(M)/t(z).all().length*e.width*2/5},0)`,stroke:"white"},null,8,Ne),o("g",{class:"show",transform:`translate(${e.width*2/5-50},10)`},[o("circle",{onClick:a[0]||(a[0]=d=>I.value=!t(I)),cy:e.controlOffset*.5,r:"20",fill:t(I)?"black":"transparent",stroke:"black","stroke-width":4},null,8,De)],8,Oe)],8,ke),o("g",{class:"begin",ref_key:"beginControl",ref:T,transform:`translate(${e.width*3/5},0)`},[o("rect",{height:e.controlOffset,width:e.width/5,fill:t(N)(t(h)+3,null,t(i)[t(h)]?1:.1)},null,8,Te),o("text",{class:"font-bold text-5xl pointer-events-none",x:10,y:e.controlOffset*.75},y(t(k)[(t(h)+3)%12])+y(Math.floor((Math.round(t(h))+3)/12)-1),9,Me)],8,Ce),o("g",{class:"end",ref_key:"endControl",ref:E,transform:`translate(${e.width*4/5},0)`},[o("rect",{height:e.controlOffset,width:e.width/5,fill:t(N)(t(u)+3,null,t(i)[t(u)]?1:.1)},null,8,Pe),o("text",{class:"font-bold text-5xl pointer-events-none",x:e.width/5-20,"text-anchor":"end",y:e.controlOffset*.75},y(t(k)[(t(u)+3)%12])+y(Math.floor((t(u)+3)/12)-1),9,Be)],8,Ee),o("g",{class:"range pointer-events-none",transform:`translate(${e.width*3/5},0)`},[(v(),g(F,null,K(127,(d,l)=>o("line",{transform:`translate(${l/127*e.width*2/5},0)`,y2:16,opacity:".3","stroke-width":"2","stroke-linecap":"round",stroke:(l+3)%12==t(f).tonic?t(N)((l+3)%12):"white"},null,8,Se)),64)),o("rect",{class:"ranger",x:t(h)/127*e.width*2/5,width:(t(u)-t(h))/127*e.width*2/5,height:"20",fill:"gray",opacity:.8},null,8,ze),o("line",{class:"begin",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${t(h)/127*e.width*2/5},0)`,stroke:"white"},null,8,Fe),o("line",{class:"end",y2:20,"stroke-width":"8","stroke-linecap":"round",stroke:"white",transform:`translate(${t(u)/127*e.width*2/5},0)`},null,8,Ke)],8,Ie)],8,ve),o("g",{class:"keys",ref_key:"area",ref:c},[(v(!0),g(F,null,K(q.value,(d,l)=>(v(),te(s,{key:d,note:d,step:l,width:e.width/q.value.length,height:e.height,pressed:x.value},null,8,["note","step","width","height","pressed"]))),128))],512)],8,he)}}},Re=p(Ae,[["__scopeId","data-v-7acdcba9"]]);export{Re as _};
