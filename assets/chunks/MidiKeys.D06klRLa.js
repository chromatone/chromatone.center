import{r as w,v as f,x as v,z as n,D as e,X as R,H as q,E as m,u as P,c as K,q as G,d as F,I as H,F as M,A as B,L as Q}from"./framework.0GAYKUFI.js";import{u as V,n as k,g as a,e as u,z as Y,X as j,Y as J,Q as I,ae as L,a6 as N,o as $}from"./theme.D6x5ugam.js";const U=["transform"],Z=["width","height","fill"],_={class:"marks pointer-events-none"},p=["x1","x2","y2","stroke"],tt=["r","cx","cy","opacity","fill"],et=["x","y","font-size"],nt=["x","y","font-size"],lt=["fill","y","x","font-size","font-weight"],ot={__name:"MidiKeysNote",props:{note:{type:Number,default:0},step:{type:Number,default:0},width:{type:Number,default:1200},height:{type:Number,default:400},pressed:{type:Boolean,default:!1}},setup(t){const{midi:i,playKey:y}=V();function r(c){let l=a.isIn(u[c%12])?1:.3;y(c-7,0,!1,l),j({number:c-3})}function d(c){y(c-7,0,!0,0),J({number:c-3})}const x=w();return(c,l)=>(f(),v("g",{class:"note",transform:`translate(${t.step*t.width},0)`,"text-anchor":"middle",ref_key:"noteKey",ref:x},[n("rect",{width:t.width,height:t.height,fill:e(k)(t.note+3,null,e(i).activeNotes[t.note]?1:.1,e(a).isIn(e(u)[(t.note+3)%12])?1:.4),onPointerdown:l[0]||(l[0]=R(s=>r(t.note+3),["prevent"])),onPointerenter:l[1]||(l[1]=s=>t.pressed?r(t.note+3):null),onPointerleave:l[2]||(l[2]=s=>d(t.note+3)),onPointerup:l[3]||(l[3]=R(s=>d(t.note+3),["prevent"])),onTouchcancel:l[4]||(l[4]=s=>d(t.note+3))},null,40,Z),n("g",_,[e(a).tonic==(t.note+3)%12?(f(),v("line",{key:0,x1:t.width/2,x2:t.width/2,y1:0,y2:t.height,"stroke-width":"6",opacity:.9,stroke:e(i).activeNotes[t.note]?"white":e(k)(t.note+3,-1,1,1)},null,8,p)):q("",!0),n("circle",{r:e(a).tonic==(t.note+3)%12?t.width/3:t.width/8,cx:t.width/2,cy:t.height-t.width/2,opacity:e(i).activeNotes[t.note]?1:.3,fill:e(a).isIn(e(u)[(t.note+3)%12])?"white":"black"},null,8,tt),n("text",{class:"opacity-75 number",x:t.width/2,y:t.width*1.8,"font-size":t.width*.333},m(e(Y)[(t.note+3-e(a).tonic)%12]),9,et),n("text",{class:"opacity-55",x:t.width/2,y:t.width+14,"font-size":t.width*.333},m(t.note),9,nt),n("text",{fill:e(a).isIn(e(u)[(t.note+3)%12])?"black":"#777e",y:t.width/2+10,x:t.width/2,"font-size":t.width*.5,"font-weight":e(a).tonic==(t.note+3)%12?"bold":"normal"},m(e(u)[(t.note+3)%12]),9,lt)])],8,U))}};function st(){const t=I(P("midi-keys-begin",45),0,127),i=I(P("midi-keys-end",83),t,127),y=L(t),r=L(i),d=w(),x=w(),c=K(()=>Array(r.value+1-y.value).fill(0).map((s,z)=>z+y.value));return N({onDrag(l){l.event.preventDefault();let s=t.value+l.delta[0]/5;s+1<=i.value&&(t.value=Math.round(s))},onWheel(l){l.event.preventDefault();let s=t.value-l.velocities[0]/5;s+1<=i.value&&(t.value=Math.round(s))}},{domTarget:d,eventOptions:{passive:!1}}),N({onDrag(l){l.event.preventDefault();let s=i.value+l.delta[0]/5;s>t.value&&(i.value=s)},onWheel(l){l.event.preventDefault();let s=i.value-l.velocities[0]/5;s-1>t.value&&(i.value=s)}},{domTarget:x,eventOptions:{passive:!1}}),{begin:t,end:i,roundBegin:y,roundEnd:r,beginControl:d,endControl:x,keys:c}}const it=["viewBox"],at=["transform"],rt=["transform"],dt=["height","width","fill"],ct=["x","y"],ht=["transform","stroke"],ft=["transform"],ut=["transform"],vt=["width","height"],wt=["y"],mt=["transform","opacity"],yt=["transform"],gt=["transform"],kt=["cy","fill"],xt=["transform"],$t=["height","width","fill"],bt=["y"],Ot=["transform"],Nt=["height","width","fill"],Ct=["x","y"],Dt=["transform"],Mt=["transform","stroke"],Bt=["x","width"],Pt=["transform"],zt=["transform"],Kt={__name:"MidiKeys",props:{width:{type:Number,default:1200},height:{type:Number,default:500},controlOffset:{type:Number,default:100},slotOffset:{type:Number,default:0}},setup(t){const{midi:i,playKey:y}=V(),{roundBegin:r,roundEnd:d,beginControl:x,endControl:c,keys:l}=st(),s=w(),z=w(),b=w(!1);N({onPointerdown(o){b.value=!0},onPointerleave(o){b.value=!1},onPointercancel(o){b.value=!1},onPointerup(o){b.value=!1}},{domTarget:s});const T=w(),C=w(a.tonic*100);F(C,o=>{a.tonic=Math.round((o/100%12+12)%12)}),N({onDrag(o){o.event.preventDefault(),C.value+=o.delta[0]},onWheel(o){o.event.preventDefault(),C.value-=o.velocities[0]}},{domTarget:T,eventOptions:{passive:!1}});const S=w(),O=I(P("midikeys-scale",1),1,$.all().length-1);N({onDrag(o){o.event.preventDefault(),O.value+=o.delta[0]/5},onWheel(o){o.event.preventDefault(),O.value-=o.velocities[0]/5}},{domTarget:S,eventOptions:{passive:!1}});const E=K(()=>{let o=Math.round(O.value);return $.all()[o]});F(E,o=>{a.chroma=o.chroma});const D=P("filter-keys",!0),W=K(()=>D.value?l.value.filter(o=>a.isIn(u[(o+3)%12])):l.value);return(o,A)=>{const X=ot;return f(),v("svg",{class:"w-full cursor-pointer fullscreen-container overflow-hidden select-none touch-none",viewBox:`0 -${t.controlOffset+t.slotOffset} ${t.width} ${t.height+t.controlOffset}`,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},ref_key:"svg",ref:s},[n("g",{class:"slot",transform:`translate(0,${-t.slotOffset-t.controlOffset})`},[H(o.$slots,"default",{},void 0,!0)],8,at),n("g",{class:"offset",transform:`translate(0,${-t.controlOffset})`},[n("g",{class:"tonic",ref_key:"tonicControl",ref:T},[n("rect",{height:t.controlOffset,width:t.width/5,fill:e(k)(e(a).tonic,2,.8)},null,8,dt),n("text",{class:"font-bold text-5xl",x:t.width/10,"text-anchor":"middle",y:t.controlOffset*.75},m(e(u)[e(a).tonic%12]),9,ct),(f(!0),v(M,null,B(e(u),(g,h)=>(f(),v("line",{transform:`translate(${(h/12+1/24)*t.width/5},0)`,y2:16,"stroke-width":"6","stroke-linecap":"round",stroke:e(k)(h,5,.4)},null,8,ht))),256)),n("line",{class:"transition",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${(C.value/1200%1+1)%1*t.width/5+t.width/120},0)`,stroke:"white"},null,8,ft)],512),n("g",{class:"scale",ref_key:"scaleControl",ref:S,transform:`translate(${t.width/5},0)`},[n("rect",{width:t.width*2/5,height:t.controlOffset,fill:"#aaa"},null,8,vt),n("text",{class:"text-4xl",x:30,y:t.controlOffset*.75},m(E.value.name),9,wt),(f(!0),v(M,null,B(e($).all().length,(g,h)=>(f(),v("line",{transform:`translate(${(h/e($).all().length+1/e($).all().length)*t.width*2/5},0)`,y2:36,opacity:g==Math.round(e(O))?1:.2,"stroke-width":"2","stroke-linecap":"round",stroke:"currentColor"},null,8,mt))),256)),n("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(O)/e($).all().length*t.width*2/5},0)`,stroke:"white"},null,8,yt),n("g",{class:"show",transform:`translate(${t.width*2/5-50},10)`},[n("circle",{onClick:A[0]||(A[0]=g=>D.value=!e(D)),cy:t.controlOffset*.5,r:"20",fill:e(D)?"black":"transparent",stroke:"black","stroke-width":4},null,8,kt)],8,gt)],8,ut),n("g",{class:"begin",ref_key:"beginControl",ref:x,transform:`translate(${t.width*3/5},0)`},[n("rect",{height:t.controlOffset,width:t.width/5,fill:e(k)(e(r)+3,null,e(i).activeNotes[e(r)]?1:.1)},null,8,$t),n("text",{class:"font-bold text-5xl pointer-events-none",x:10,y:t.controlOffset*.75},m(e(u)[(e(r)+3)%12])+m(Math.floor((Math.round(e(r))+3)/12)-1),9,bt)],8,xt),n("g",{class:"end",ref_key:"endControl",ref:c,transform:`translate(${t.width*4/5},0)`},[n("rect",{height:t.controlOffset,width:t.width/5,fill:e(k)(e(d)+3,null,e(i).activeNotes[e(d)]?1:.1)},null,8,Nt),n("text",{class:"font-bold text-5xl pointer-events-none",x:t.width/5-20,"text-anchor":"end",y:t.controlOffset*.75},m(e(u)[(e(d)+3)%12])+m(Math.floor((e(d)+3)/12)-1),9,Ct)],8,Ot),n("g",{class:"range pointer-events-none",transform:`translate(${t.width*3/5},0)`},[(f(),v(M,null,B(127,(g,h)=>n("line",{transform:`translate(${h/127*t.width*2/5},0)`,y2:16,opacity:".3","stroke-width":"2","stroke-linecap":"round",stroke:(h+3)%12==e(a).tonic?e(k)((h+3)%12):"white"},null,8,Mt)),64)),n("rect",{class:"ranger",x:e(r)/127*t.width*2/5,width:(e(d)-e(r))/127*t.width*2/5,height:"20",fill:"gray",opacity:.8},null,8,Bt),n("line",{class:"begin",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(r)/127*t.width*2/5},0)`,stroke:"white"},null,8,Pt),n("line",{class:"end",y2:20,"stroke-width":"8","stroke-linecap":"round",stroke:"white",transform:`translate(${e(d)/127*t.width*2/5},0)`},null,8,zt)],8,Dt)],8,rt),n("g",{class:"keys",ref_key:"area",ref:z},[(f(!0),v(M,null,B(W.value,(g,h)=>(f(),Q(X,{key:g,note:g,step:h,width:t.width/W.value.length,height:t.height,pressed:b.value},null,8,["note","step","width","height","pressed"]))),128))],512)],8,it)}}},St=G(Kt,[["__scopeId","data-v-3cac1677"]]);export{St as _};
