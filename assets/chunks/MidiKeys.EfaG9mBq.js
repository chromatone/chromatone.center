import{r as y,x as u,y as v,A as n,E as e,S as F,I as j,G as m,u as I,c as V,q,d as R,J,F as P,B as S,T as H}from"./framework.CQBrk0Ry.js";import{N as L,c as $,g as r,n as w,x as K,i as Q,u as U,D as z,O as A,L as C,P as G,S as T}from"./theme.Dd_Fb62b.js";const X=["transform"],Z=["width","height","fill"],p={class:"marks pointer-events-none"},_=["x1","x2","y2","stroke"],tt=["r","cx","cy","opacity","fill"],et=["x","y","font-size"],nt=["x","y","font-size"],ot=["fill","y","x","font-size","font-weight"],lt={__name:"MidiKeysNote",props:{note:{type:Number,default:0},step:{type:Number,default:0},width:{type:Number,default:1200},height:{type:Number,default:400},pressed:{type:Boolean,default:!1}},setup(t){const{activeNotes:a}=L();function c(h,s=10){return h=Math.max(0,Math.min(1,h)),Math.log(1+s*h)/Math.log(1+s)}function d(h,s){s==null||s.preventDefault();const o=s.target.getBoundingClientRect(),i=s.clientY-o.top,g=o.height,M=i/g,N=.3+c(M)*.7,k=r.isIn(w[(h+3)%12])?1:.5,D=N*k;U(h,D)}const b=y();return(h,s)=>(u(),v("g",{class:"note",transform:`translate(${t.step*t.width},0)`,"text-anchor":"middle",ref_key:"noteKey",ref:b},[n("rect",{width:t.width,height:t.height,fill:e($)(t.note+3,null,e(a)[t.note]?1:.1,e(r).isIn(e(w)[(t.note+3)%12])?1:.4),onPointerdown:s[0]||(s[0]=F(o=>d(t.note,o),["prevent"])),onPointerenter:s[1]||(s[1]=o=>t.pressed?d(t.note,o):null),onPointerleave:s[2]||(s[2]=o=>e(K)(t.note)),onPointerup:s[3]||(s[3]=F(o=>e(K)(t.note),["prevent"])),onTouchcancel:s[4]||(s[4]=o=>e(K)(t.note))},null,40,Z),n("g",p,[e(r).tonic==(t.note+3)%12?(u(),v("line",{key:0,x1:t.width/2,x2:t.width/2,y1:0,y2:t.height,"stroke-width":"6",opacity:.9,stroke:e(a)[t.note]?"white":e($)(t.note+3,-1,1,1)},null,8,_)):j("",!0),n("circle",{r:e(r).tonic==(t.note+3)%12?t.width/3:t.width/8,cx:t.width/2,cy:t.height-t.width/2,opacity:e(a)[t.note]?1:.3,fill:e(r).isIn(e(w)[(t.note+3)%12])?"white":"black"},null,8,tt),n("text",{class:"opacity-75 number",x:t.width/2,y:t.width*1.8,"font-size":t.width*.333},m(e(Q)[(t.note+3-e(r).tonic)%12]),9,et),n("text",{class:"opacity-55",x:t.width/2,y:t.width+14,"font-size":t.width*.333},m(t.note),9,nt),n("text",{fill:e(r).isIn(e(w)[(t.note+3)%12])?"black":"#777e",y:t.width/2+10,x:t.width/2,"font-size":t.width*.5,"font-weight":e(r).tonic==(t.note+3)%12?"bold":"normal"},m(e(w)[(t.note+3)%12]),9,ot)])],8,X))}};function st(){const t=z(I("midi-keys-begin",45),0,127),a=z(I("midi-keys-end",83),t,127),c=A(t),d=A(a),b=y(),h=y(),s=V(()=>Array(d.value+1-c.value).fill(0).map((i,g)=>g+c.value));return C({onDrag(o){o.event.preventDefault();let i=t.value+o.delta[0]/5;i+1<=a.value&&(t.value=Math.round(i))},onWheel(o){o.event.preventDefault();let i=t.value-o.velocities[0]/5;i+1<=a.value&&(t.value=Math.round(i))}},{domTarget:b,eventOptions:{passive:!1}}),C({onDrag(o){o.event.preventDefault();let i=a.value+o.delta[0]/5;i>t.value&&(a.value=i)},onWheel(o){o.event.preventDefault();let i=a.value-o.velocities[0]/5;i-1>t.value&&(a.value=i)}},{domTarget:h,eventOptions:{passive:!1}}),{begin:t,end:a,roundBegin:c,roundEnd:d,beginControl:b,endControl:h,keys:s}}const it=["viewBox"],at=["transform"],rt=["transform"],ct=["height","width","fill"],dt=["x","y"],ht=["transform","stroke"],ft=["transform"],ut=["transform"],wt=["width","height"],gt=["y"],vt=["transform","opacity"],yt=["transform"],mt=["transform"],kt=["cy","fill"],xt=["transform"],$t=["height","width","fill"],bt=["y"],Ot=["transform"],Ct=["height","width","fill"],Mt=["x","y"],Nt=["transform"],Dt=["transform","stroke"],Bt=["x","width"],Pt=["transform"],St=["transform"],Tt={__name:"MidiKeys",props:{width:{type:Number,default:900},height:{type:Number,default:400},controlOffset:{type:Number,default:100},slotOffset:{type:Number,default:0}},setup(t){const{activeNotes:a}=L(),{roundBegin:c,roundEnd:d,beginControl:b,endControl:h,keys:s}=st(),o=y(),i=y(),g=y(!1);C({onPointerdown(l){g.value=!0},onPointerleave(l){g.value=!1},onPointercancel(l){g.value=!1},onPointerup(l){g.value=!1}},{domTarget:o});const M=y(),O=y(r.tonic*100);R(O,l=>{r.tonic=Math.round((l/100%12+12)%12)}),C({onDrag(l){l.event.preventDefault(),O.value+=l.delta[0]},onWheel(l){l.event.preventDefault(),O.value-=l.velocities[0]}},{domTarget:M,eventOptions:{passive:!1}});const N=y(),k=z(I("midikeys-scale",1),1,G().length-1);C({onDrag(l){l.event.preventDefault(),k.value+=l.delta[0]/5},onWheel(l){l.event.preventDefault(),k.value-=l.velocities[0]/5}},{domTarget:N,eventOptions:{passive:!1}});const D=V(()=>{let l=Math.round(k.value);return G()[l]});R(D,l=>{r.chroma=l.chroma});const B=I("filter-keys",!0),E=V(()=>B.value?s.value.filter(l=>r.isIn(w[(l+3)%12])):s.value);return(l,W)=>{const Y=lt;return u(),v("svg",{class:"w-full cursor-pointer fullscreen-container overflow-hidden select-none touch-none",viewBox:`0 -${t.controlOffset+t.slotOffset} ${t.width} ${t.height+t.controlOffset}`,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},ref_key:"svg",ref:o},[n("g",{class:"slot",transform:`translate(0,${-t.slotOffset-t.controlOffset})`},[J(l.$slots,"default",{},void 0,!0)],8,at),n("g",{class:"offset",transform:`translate(0,${-t.controlOffset})`},[n("g",{class:"tonic",ref_key:"tonicControl",ref:M},[n("rect",{height:t.controlOffset,width:t.width/5,fill:e($)(e(r).tonic,2,.8)},null,8,ct),n("text",{class:"font-bold text-5xl",x:t.width/10,"text-anchor":"middle",y:t.controlOffset*.75},m(e(w)[e(r).tonic%12]),9,dt),(u(!0),v(P,null,S(e(w),(x,f)=>(u(),v("line",{transform:`translate(${(f/12+1/24)*t.width/5},0)`,y2:16,"stroke-width":"6","stroke-linecap":"round",stroke:e($)(f,5,.4)},null,8,ht))),256)),n("line",{class:"transition",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${(O.value/1200%1+1)%1*t.width/5+t.width/120},0)`,stroke:"white"},null,8,ft)],512),n("g",{class:"scale",ref_key:"scaleControl",ref:N,transform:`translate(${t.width/5},0)`},[n("rect",{width:t.width*2/5,height:t.controlOffset,fill:"#aaa"},null,8,wt),n("text",{class:"text-4xl",x:30,y:t.controlOffset*.75},m(D.value.name),9,gt),(u(!0),v(P,null,S(e(T).all().length,(x,f)=>(u(),v("line",{transform:`translate(${(f/e(T).all().length+1/e(T).all().length)*t.width*2/5},0)`,y2:36,opacity:x==Math.round(e(k))?1:.2,"stroke-width":"2","stroke-linecap":"round",stroke:"currentColor"},null,8,vt))),256)),n("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(k)/e(T).all().length*t.width*2/5},0)`,stroke:"white"},null,8,yt),n("g",{class:"show",transform:`translate(${t.width*2/5-50},10)`},[n("circle",{onClick:W[0]||(W[0]=x=>B.value=!e(B)),cy:t.controlOffset*.5,r:"20",fill:e(B)?"black":"transparent",stroke:"black","stroke-width":4},null,8,kt)],8,mt)],8,ut),n("g",{class:"begin",ref_key:"beginControl",ref:b,transform:`translate(${t.width*3/5},0)`},[n("rect",{height:t.controlOffset,width:t.width/5,fill:e($)(e(c)+3,null,e(a)[e(c)]?1:.1)},null,8,$t),n("text",{class:"font-bold text-5xl pointer-events-none",x:10,y:t.controlOffset*.75},m(e(w)[(e(c)+3)%12])+m(Math.floor((Math.round(e(c))+3)/12)-1),9,bt)],8,xt),n("g",{class:"end",ref_key:"endControl",ref:h,transform:`translate(${t.width*4/5},0)`},[n("rect",{height:t.controlOffset,width:t.width/5,fill:e($)(e(d)+3,null,e(a)[e(d)]?1:.1)},null,8,Ct),n("text",{class:"font-bold text-5xl pointer-events-none",x:t.width/5-20,"text-anchor":"end",y:t.controlOffset*.75},m(e(w)[(e(d)+3)%12])+m(Math.floor((e(d)+3)/12)-1),9,Mt)],8,Ot),n("g",{class:"range pointer-events-none",transform:`translate(${t.width*3/5},0)`},[(u(),v(P,null,S(127,(x,f)=>n("line",{transform:`translate(${f/127*t.width*2/5},0)`,y2:16,opacity:".3","stroke-width":"2","stroke-linecap":"round",stroke:(f+3)%12==e(r).tonic?e($)((f+3)%12):"white"},null,8,Dt)),64)),n("rect",{class:"ranger",x:e(c)/127*t.width*2/5,width:(e(d)-e(c))/127*t.width*2/5,height:"20",fill:"gray",opacity:.8},null,8,Bt),n("line",{class:"begin",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(c)/127*t.width*2/5},0)`,stroke:"white"},null,8,Pt),n("line",{class:"end",y2:20,"stroke-width":"8","stroke-linecap":"round",stroke:"white",transform:`translate(${e(d)/127*t.width*2/5},0)`},null,8,St)],8,Nt)],8,rt),n("g",{class:"keys",ref_key:"area",ref:i},[(u(!0),v(P,null,S(E.value,(x,f)=>(u(),H(Y,{key:x,note:x,step:f,width:t.width/E.value.length,height:t.height,pressed:g.value},null,8,["note","step","width","height","pressed"]))),128))],512)],8,it)}}},Vt=q(Tt,[["__scopeId","data-v-1337b9f0"]]);export{Vt as _};
