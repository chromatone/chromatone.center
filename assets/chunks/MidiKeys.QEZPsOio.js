import{r as v,f as d,g as h,h as o,l as e,U as Y,q as Q,m as g,u as V,c as M,_ as X,an as Z,d as q,x as p,F as K,j as S,z as _}from"./framework.DBqT_UJK.js";import{T as U,c as $,g as c,n as f,z as A,i as tt,x as et,aa as G,H as I,ab as H,O as N,ac as L,S as T}from"./theme.DVRQnRLg.js";const nt=["transform"],ot=["width","height","fill"],lt={class:"marks pointer-events-none"},st=["x1","x2","y2","stroke"],at=["r","cx","cy","opacity","fill"],it=["x","y","font-size"],rt=["x","y","font-size"],ct=["fill","y","x","font-size","font-weight"],ut={__name:"MidiKeysNote",props:{note:{type:Number,default:0},step:{type:Number,default:0},width:{type:Number,default:1200},height:{type:Number,default:400},pressed:{type:Boolean,default:!1}},setup(t){const{activeNotes:r}=U();function y(i,n=10){return i=Math.max(0,Math.min(1,i)),Math.log(1+n*i)/Math.log(1+n)}function l(i,n){n==null||n.preventDefault();const s=n.target.getBoundingClientRect(),O=n.clientY-s.top,D=s.height,B=O/D,k=.3+y(B)*.7,z=c.isIn(f[(i+3)%12])?1:.5,b=k*z;et(G(i),b)}function m(i,n){A(G(i))}const w=v();return(i,n)=>(d(),h("g",{class:"note",transform:`translate(${t.step*t.width},0)`,"text-anchor":"middle",ref_key:"noteKey",ref:w},[o("rect",{width:t.width,height:t.height,fill:e($)(t.note+3,null,e(r)[t.note]?1:.1,e(c).isIn(e(f)[(t.note+3)%12])?1:.4),onPointerdown:n[0]||(n[0]=Y(s=>l(t.note,s),["prevent"])),onPointerenter:n[1]||(n[1]=s=>t.pressed?l(t.note,s):null),onPointerleave:n[2]||(n[2]=s=>m(t.note)),onPointerup:n[3]||(n[3]=Y(s=>m(t.note),["prevent"])),onTouchcancel:n[4]||(n[4]=s=>e(A)(t.note,s))},null,40,ot),o("g",lt,[e(c).tonic==(t.note+3)%12?(d(),h("line",{key:0,x1:t.width/2,x2:t.width/2,y1:0,y2:t.height,"stroke-width":"6",opacity:.9,stroke:e(r)[t.note]?"white":e($)(t.note+3,-1,1,1)},null,8,st)):Q("",!0),o("circle",{r:e(c).tonic==(t.note+3)%12?t.width/3:t.width/8,cx:t.width/2,cy:t.height-t.width/2,opacity:e(r)[t.note]?1:.3,fill:e(c).isIn(e(f)[(t.note+3)%12])?"white":"black"},null,8,at),o("text",{class:"opacity-75 number",x:t.width/2,y:t.width*1.8,"font-size":t.width*.333},g(e(tt)[(t.note+3-e(c).tonic)%12]),9,it),o("text",{class:"opacity-55",x:t.width/2,y:t.width+14,"font-size":t.width*.333},g(t.note),9,rt),o("text",{fill:e(c).isIn(e(f)[(t.note+3)%12])?"black":"#777e",y:t.width/2+10,x:t.width/2,"font-size":t.width*.5,"font-weight":e(c).tonic==(t.note+3)%12?"bold":"normal"},g(e(f)[(t.note+3)%12]),9,ct)])],8,nt))}};function dt(){const t=I(V("midi-keys-begin",45),0,127),r=I(V("midi-keys-end",83),t,127),y=H(t),l=H(r),m=v(),w=v(),i=M(()=>Array(l.value+1-y.value).fill(0).map((s,O)=>O+y.value));return N({onDrag(n){n.event.preventDefault();let s=t.value+n.delta[0]/5;s+1<=r.value&&(t.value=Math.round(s))},onWheel(n){n.event.preventDefault();let s=t.value-n.velocities[0]/5;s+1<=r.value&&(t.value=Math.round(s))}},{domTarget:m,eventOptions:{passive:!1}}),N({onDrag(n){n.event.preventDefault();let s=r.value+n.delta[0]/5;s>t.value&&(r.value=s)},onWheel(n){n.event.preventDefault();let s=r.value-n.velocities[0]/5;s-1>t.value&&(r.value=s)}},{domTarget:w,eventOptions:{passive:!1}}),{begin:t,end:r,roundBegin:y,roundEnd:l,beginControl:m,endControl:w,keys:i}}const ft=["viewBox"],ht=["transform"],vt=["transform"],gt=["height","width","fill"],yt=["x","y"],mt=["transform","stroke"],wt=["transform"],kt=["transform"],xt=["width","height"],$t=["y"],bt=["transform","opacity"],Ot=["transform"],Ct=["transform"],Mt=["cy","fill"],Nt=["transform"],Dt=["height","width","fill"],Bt=["y"],zt=["transform"],Pt=["height","width","fill"],Kt=["x","y"],St=["transform"],Tt=["transform","stroke"],Vt=["x","width"],It=["transform"],Wt=["transform"],Et={__name:"MidiKeys",props:{width:{type:Number},height:{type:Number},controlOffset:{type:Number,default:100},slotOffset:{type:Number,default:0}},setup(t){const r=t,y=Z(),l=M(()=>r.width||y.width.value),m=M(()=>r.height||y.height.value-80),{activeNotes:w}=U(),{roundBegin:i,roundEnd:n,beginControl:s,endControl:O,keys:D}=dt(),B=v(),W=v(),k=v(!1);N({onPointerdown(a){k.value=!0},onPointerleave(a){k.value=!1},onPointercancel(a){k.value=!1},onPointerup(a){k.value=!1}},{domTarget:B});const z=v(),b=v(c.tonic*100);q(b,a=>{c.tonic=Math.round((a/100%12+12)%12)}),N({onDrag(a){a.event.preventDefault(),b.value+=a.delta[0]},onWheel(a){a.event.preventDefault(),b.value-=a.velocities[0]}},{domTarget:z,eventOptions:{passive:!1}});const E=v(),C=I(V("midikeys-scale",1),1,L().length-1);N({onDrag(a){a.event.preventDefault(),C.value+=a.delta[0]/5},onWheel(a){a.event.preventDefault(),C.value-=a.velocities[0]/5}},{domTarget:E,eventOptions:{passive:!1}});const F=M(()=>{let a=Math.round(C.value);return L()[a]});q(F,a=>{c.chroma=a.chroma});const P=V("filter-keys",!0),R=M(()=>P.value?D.value.filter(a=>c.isIn(f[(a+3)%12])):D.value);return(a,j)=>{const J=ut;return d(),h("svg",{class:"w-full cursor-pointer fullscreen-container overflow-hidden select-none touch-none",viewBox:`0 -${t.controlOffset+t.slotOffset} ${l.value} ${m.value+t.controlOffset}`,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},ref_key:"svg",ref:B},[o("g",{class:"slot",transform:`translate(0,${-t.slotOffset-t.controlOffset})`},[p(a.$slots,"default",{},void 0,!0)],8,ht),o("g",{class:"offset",transform:`translate(0,${-t.controlOffset})`},[o("g",{class:"tonic",ref_key:"tonicControl",ref:z},[o("rect",{height:t.controlOffset,width:l.value/5,fill:e($)(e(c).tonic,2,.8)},null,8,gt),o("text",{class:"font-bold text-5xl",x:l.value/10,"text-anchor":"middle",y:t.controlOffset*.75},g(e(f)[e(c).tonic%12]),9,yt),(d(!0),h(K,null,S(e(f),(x,u)=>(d(),h("line",{transform:`translate(${(u/12+1/24)*l.value/5},0)`,y2:16,"stroke-width":"6","stroke-linecap":"round",stroke:e($)(u,5,.4)},null,8,mt))),256)),o("line",{class:"transition",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${(b.value/1200%1+1)%1*l.value/5+l.value/120},0)`,stroke:"white"},null,8,wt)],512),o("g",{class:"scale",ref_key:"scaleControl",ref:E,transform:`translate(${l.value/5},0)`},[o("rect",{width:l.value*2/5,height:t.controlOffset,fill:"#aaa"},null,8,xt),o("text",{class:"text-4xl",x:30,y:t.controlOffset*.75},g(F.value.name),9,$t),(d(!0),h(K,null,S(e(T).all().length,(x,u)=>(d(),h("line",{transform:`translate(${(u/e(T).all().length+1/e(T).all().length)*l.value*2/5},0)`,y2:36,opacity:x==Math.round(e(C))?1:.2,"stroke-width":"2","stroke-linecap":"round",stroke:"currentColor"},null,8,bt))),256)),o("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(C)/e(T).all().length*l.value*2/5},0)`,stroke:"white"},null,8,Ot),o("g",{class:"show",transform:`translate(${l.value*2/5-50},10)`},[o("circle",{onClick:j[0]||(j[0]=x=>P.value=!e(P)),cy:t.controlOffset*.5,r:"20",fill:e(P)?"black":"transparent",stroke:"black","stroke-width":4},null,8,Mt)],8,Ct)],8,kt),o("g",{class:"begin",ref_key:"beginControl",ref:s,transform:`translate(${l.value*3/5},0)`},[o("rect",{height:t.controlOffset,width:l.value/5,fill:e($)(e(i)+3,null,e(w)[e(i)]?1:.1)},null,8,Dt),o("text",{class:"font-bold text-5xl pointer-events-none",x:10,y:t.controlOffset*.75},g(e(f)[(e(i)+3)%12])+g(Math.floor((Math.round(e(i))+3)/12)-1),9,Bt)],8,Nt),o("g",{class:"end",ref_key:"endControl",ref:O,transform:`translate(${l.value*4/5},0)`},[o("rect",{height:t.controlOffset,width:l.value/5,fill:e($)(e(n)+3,null,e(w)[e(n)]?1:.1)},null,8,Pt),o("text",{class:"font-bold text-5xl pointer-events-none",x:l.value/5-20,"text-anchor":"end",y:t.controlOffset*.75},g(e(f)[(e(n)+3)%12])+g(Math.floor((e(n)+3)/12)-1),9,Kt)],8,zt),o("g",{class:"range pointer-events-none",transform:`translate(${l.value*3/5},0)`},[(d(),h(K,null,S(127,(x,u)=>o("line",{transform:`translate(${u/127*l.value*2/5},0)`,y2:16,opacity:".3","stroke-width":"2","stroke-linecap":"round",stroke:(u+3)%12==e(c).tonic?e($)((u+3)%12):"white"},null,8,Tt)),64)),o("rect",{class:"ranger",x:e(i)/127*l.value*2/5,width:(e(n)-e(i))/127*l.value*2/5,height:"20",fill:"gray",opacity:.8},null,8,Vt),o("line",{class:"begin",y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e(i)/127*l.value*2/5},0)`,stroke:"white"},null,8,It),o("line",{class:"end",y2:20,"stroke-width":"8","stroke-linecap":"round",stroke:"white",transform:`translate(${e(n)/127*l.value*2/5},0)`},null,8,Wt)],8,St)],8,vt),o("g",{class:"keys",ref_key:"area",ref:W},[(d(!0),h(K,null,S(R.value,(x,u)=>(d(),_(J,{key:x,note:x,step:u,width:l.value/R.value.length,height:m.value,pressed:k.value},null,8,["note","step","width","height","pressed"]))),128))],512)],8,ft)}}},jt=X(Et,[["__scopeId","data-v-aacc82c4"]]);export{jt as _};
