import{v as O,i as v,j as P,_ as A,w as R,o as C,c as $,a as o,g as t,t as g,F as G,r as q,l as B,b as H}from"./framework.HVt1h3pg.js";import{g as r,n as m}from"./colors.im4OGed9.js";import{u as J}from"./midi.OEToXt3d.js";import{s as I,n as d,i as Q}from"./theory.kDp-YHKa.js";import{a as w}from"./index.tljQmfR-.js";import{u as S,D as V}from"./index.dyz7TQwj.js";function U(){const c=S(O("midi-keys-begin",0),0,127),e=S(O("midi-keys-end",44),c,127),h=V(c),n=V(e),f=v(),x=v(),_=P(()=>Array(n.value+1-h.value).fill(0).map((i,D)=>D+h.value));return w({onDrag(s){s.event.preventDefault();let i=c.value+s.delta[0]/5;i+1<=e.value&&(c.value=Math.round(i))},onWheel(s){s.event.preventDefault();let i=c.value-s.velocities[0]/5;i+1<=e.value&&(c.value=Math.round(i))}},{domTarget:f,eventOptions:{passive:!1}}),w({onDrag(s){s.event.preventDefault();let i=e.value+s.delta[0]/5;i>c.value&&(e.value=i)},onWheel(s){s.event.preventDefault();let i=e.value-s.velocities[0]/5;i-1>c.value&&(e.value=i)}},{domTarget:x,eventOptions:{passive:!1}}),{begin:c,end:e,roundBegin:h,roundEnd:n,beginControl:f,endControl:x,keys:_}}const X=["viewBox"],Y={class:"offset"},Z=["y","height","width","fill"],ee=["y"],te=["y1","y2","transform"],le=["x","y","height","width","fill"],ne=["x","y"],oe=["y1","y2","transform"],ae=["x","y","height","width","fill"],se=["x","y"],re=["y1","y2","transform"],ie=["x","y","width","height"],ue=["x","y"],ce=["y1","y2","transform"],ve=["cx","cy","fill"],he={class:"keys"},de=["transform"],fe=["width","height","fill","onMousedown","onMouseenter","onTouchstart","onMouseleave","onMouseup","onTouchend","onTouchcancel"],ge=["r","cx","cy","opacity","fill"],_e=["x","y"],pe=["x1","x2","y2","stroke"],xe=["fill","y","x","font-size","font-weight"],ye={__name:"MidiKeys",setup(c){const e=v(1200),h=v(500),n=v(100),{midi:f,playKey:x}=J(),{roundBegin:_,roundEnd:s,beginControl:i,endControl:D,keys:W}=U(),E=v(),y=v(!1);w({onPointerdown(l){y.value=!0},onPointerleave(l){y.value=!1},onPointercancel(l){y.value=!1},onPointerup(l){y.value=!1}},{domTarget:E});function T(l){x(l-7,0,0,r.isIn(d[l%12])?1:.3)}function b(l){x(l-7,0,1,0)}const K=v(),N=v(r.tonic*100);R(N,l=>{r.tonic=Math.round((l/100%12+12)%12)}),w({onDrag(l){l.event.preventDefault(),N.value+=l.delta[0]*5},onWheel(l){l.event.preventDefault(),N.value-=l.velocities[0]*5}},{domTarget:K,eventOptions:{passive:!1}});const z=v(),k=S(10,1,I.length-1);w({onDrag(l){l.event.preventDefault(),k.value+=l.delta[0]/5},onWheel(l){l.event.preventDefault(),k.value-=l.velocities[0]/5}},{domTarget:z,eventOptions:{passive:!1}});const F=P(()=>{let l=Math.round(k.value);return I[l]});R(F,l=>{r.chroma=l.chroma});const M=O("filter-keys",!0),u=P(()=>M.value?W.value.filter(l=>r.isIn(d[(l+3)%12])):W.value);return(l,L)=>(C(),$("svg",{class:"rounded-xl w-full cursor-pointer fullscreen-container overflow-hidden select-none touch-none",id:"screen",viewBox:`0 -${n.value} ${e.value} ${h.value+n.value}`,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},ref_key:"keyboard",ref:E},[o("g",Y,[o("g",{class:"begin",ref_key:"beginControl",ref:i},[o("rect",{y:-n.value,height:n.value,width:e.value/5,fill:t(m)(t(_)+3,null,t(f).activeNotes[t(_)]?1:.1)},null,8,Z),o("text",{class:"font-bold text-6xl",x:10,y:-n.value/4},g(t(d)[(t(_)+3)%12])+g(Math.floor((Math.round(t(_))+3)/12)-1),9,ee),o("line",{y1:-n.value,y2:-n.value+20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${t(_)/127*e.value/5},0)`,stroke:"white"},null,8,te)],512),o("g",{class:"end",ref_key:"endControl",ref:D},[o("rect",{x:e.value/5,y:-n.value,height:n.value,width:e.value/5,fill:t(m)(t(s)+3,null,t(f).activeNotes[t(s)]?1:.1)},null,8,le),o("text",{class:"font-bold text-6xl",x:e.value*2/5-20,"text-anchor":"end",y:-n.value/4},g(t(d)[(t(s)+3)%12])+g(Math.floor((t(s)+3)/12)-1),9,ne),o("line",{y1:-n.value,y2:-n.value+20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e.value/5+t(s)/127*e.value/5},0)`,stroke:"white"},null,8,oe)],512),o("g",{class:"tonic",ref_key:"tonicControl",ref:K},[o("rect",{x:e.value*2/5,y:-n.value,height:n.value,width:e.value/5,fill:t(m)(t(r).tonic,2,.8)},null,8,ae),o("text",{class:"font-bold text-6xl",x:e.value*2.5/5,"text-anchor":"middle",y:-n.value/4},g(t(d)[t(r).tonic%12]),9,se),o("line",{class:"transition",y1:-n.value,y2:-n.value+20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e.value*2/5+t(r).tonic/12*e.value/5+e.value/120},0)`,stroke:"white"},null,8,re)],512),o("g",{class:"scale",ref_key:"scaleControl",ref:z},[o("rect",{x:e.value*3/5,y:-n.value,width:e.value*2/5,height:n.value,fill:"#aaa"},null,8,ie),o("text",{class:"text-4xl",x:e.value*3/5+30,y:-n.value/3.2},g(F.value.name),9,ue),o("line",{y1:-n.value,y2:-n.value+20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e.value*3/5+t(k)/t(I).length*e.value*2/5},0)`,stroke:"white"},null,8,ce)],512),o("g",{class:"show",onClick:L[0]||(L[0]=a=>M.value=!t(M))},[o("circle",{cx:e.value-50,cy:-n.value/2,r:"20",fill:t(M)?"black":"transparent",stroke:"black","stroke-width":4},null,8,ve)])]),o("g",he,[(C(!0),$(G,null,q(u.value,(a,j)=>(C(),$("g",{class:"key",key:a,transform:`translate(${j*e.value/u.value.length},0)`,"text-anchor":"middle"},[o("rect",{width:e.value/u.value.length,height:h.value,fill:t(m)(a+3,null,t(f).activeNotes[a]?1:.1,t(r).isIn(t(d)[(a+3)%12])?1:.4),onMousedown:B(p=>T(a+3),["prevent"]),onMouseenter:p=>y.value?T(a+3):null,onTouchstart:B(p=>T(a+3),["prevent"]),onMouseleave:p=>b(a+3),onMouseup:B(p=>b(a+3),["prevent"]),onTouchend:p=>b(a+3),onTouchcancel:p=>b(a+3)},null,40,fe),o("circle",{class:"pointer-events-none",r:t(r).tonic==(a+3)%12?e.value/u.value.length/3:e.value/u.value.length/8,cx:e.value/u.value.length/2,cy:h.value-e.value/u.value.length/2,opacity:t(f).activeNotes[a]?1:.3,fill:t(r).isIn(t(d)[(a+3)%12])?"white":"black"},null,8,ge),o("text",{class:"text-2xl opacity-75 pointer-events-none",x:e.value/u.value.length/2,y:h.value-e.value/u.value.length*1.1},g(t(Q)[(a+3-t(r).tonic)%12]),9,_e),t(r).tonic==(a+3)%12?(C(),$("line",{key:0,class:"pointer-events-none",x1:e.value/u.value.length/2,x2:e.value/u.value.length/2,y1:0,y2:h.value,"stroke-width":"6",opacity:.9,stroke:t(f).activeNotes[a]?"white":t(m)(a+3,-1,1,1)},null,8,pe)):H("",!0),o("text",{class:"pointer-events-none",fill:t(r).isIn(t(d)[(a+3)%12])?"black":"#777e",y:e.value/u.value.length/2+10,x:e.value/u.value.length/2,"font-size":e.value/u.value.length*.5,"font-weight":t(r).tonic==(a+3)%12?"bold":"normal"},g(t(d)[(a+3)%12]),9,xe)],8,de))),128))])],8,X))}},$e=A(ye,[["__scopeId","data-v-391debcd"]]);export{$e as _};
