import{v as L,i as v,j as O,_ as A,w as R,o as $,c as C,a as o,g as t,t as g,F as G,r as q,l as B,b as H}from"./framework.HVt1h3pg.js";import{g as u,n as x}from"./colors.im4OGed9.js";import{u as J}from"./midi.OEToXt3d.js";import{s as I,n as h}from"./theory.kDp-YHKa.js";import{a as w}from"./index.tljQmfR-.js";import{u as P,D as V}from"./index.dyz7TQwj.js";function Q(){const c=P(L("midi-keys-begin",0),0,127),e=P(L("midi-keys-end",44),c,127),d=V(c),l=V(e),f=v(),y=v(),_=O(()=>Array(l.value+1-d.value).fill(0).map((r,D)=>D+d.value));return w({onDrag(s){s.event.preventDefault();let r=c.value+s.delta[0]/5;r+1<=e.value&&(c.value=Math.round(r))},onWheel(s){s.event.preventDefault();let r=c.value-s.velocities[0]/5;r+1<=e.value&&(c.value=Math.round(r))}},{domTarget:f,eventOptions:{passive:!1}}),w({onDrag(s){s.event.preventDefault();let r=e.value+s.delta[0]/5;r>c.value&&(e.value=r)},onWheel(s){s.event.preventDefault();let r=e.value-s.velocities[0]/5;r>c.value&&(e.value=r)}},{domTarget:y,eventOptions:{passive:!1}}),{begin:c,end:e,roundBegin:d,roundEnd:l,beginControl:f,endControl:y,keys:_}}const U=["viewBox"],X={class:"offset"},Y=["y","height","width","fill"],Z=["y"],ee=["y1","y2","transform"],te=["y1","y2","transform"],le=["x","y","height","width","fill"],ne=["x","y"],oe=["y1","y2","transform"],ae=["x","y","width","height"],se=["x","y"],re=["y1","y2","transform"],ue=["cx","cy","fill"],ie=["x","y","height","width","fill"],ve=["x","y"],ce=["y1","y2","transform"],he=["y1","y2","transform"],de={class:"keys"},fe=["transform"],_e=["width","height","fill","onMousedown","onMouseenter","onTouchstart","onMouseleave","onMouseup","onTouchend","onTouchcancel"],ge=["r","cx","cy","opacity","fill"],pe=["x1","x2","y2","stroke"],ye=["fill","y","x","font-size","font-weight"],me={__name:"MidiKeys",setup(c){const e=v(1200),d=v(500),l=v(100),{midi:f,playKey:y}=J(),{roundBegin:_,roundEnd:s,beginControl:r,endControl:D,keys:S}=Q(),W=v(),m=v(!1);w({onPointerdown(n){m.value=!0},onPointerleave(n){m.value=!1},onPointercancel(n){m.value=!1},onPointerup(n){m.value=!1}},{domTarget:W});function T(n){y(n-7,0,0,u.isIn(h[n%12])?1:.3)}function k(n){y(n-7,0,1,0)}const E=v(),N=v(u.tonic*100);R(N,n=>{u.tonic=Math.round((n/100%12+12)%12)}),w({onDrag(n){n.event.preventDefault(),N.value+=n.delta[0]*5},onWheel(n){n.event.preventDefault(),N.value-=n.velocities[0]*5}},{domTarget:E,eventOptions:{passive:!1}});const K=v(),b=P(10,1,I.length-1);w({onDrag(n){n.event.preventDefault(),b.value+=n.delta[0]/5},onWheel(n){n.event.preventDefault(),b.value-=n.velocities[0]/5}},{domTarget:K,eventOptions:{passive:!1}});const z=O(()=>{let n=Math.round(b.value);return I[n]});R(z,n=>{u.chroma=n.chroma});const M=v(!1),i=O(()=>M.value?S.value.filter(n=>u.isIn(h[(n+3)%12])):S.value);return(n,F)=>($(),C("svg",{class:"rounded-xl w-full cursor-pointer fullscreen-container overflow-hidden select-none touch-none",id:"screen",viewBox:`0 -${l.value} ${e.value} ${d.value+l.value}`,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},ref_key:"keyboard",ref:W},[o("g",X,[o("g",{class:"begin",ref_key:"beginControl",ref:r},[o("rect",{y:-l.value,height:l.value,width:e.value/5,fill:t(x)(t(_)+3,null,t(f).activeNotes[t(_)]?1:.1)},null,8,Y),o("text",{class:"font-bold text-6xl",x:10,y:-l.value/4},g(t(h)[(t(_)+3)%12])+g(Math.floor((Math.round(t(_))+3)/12)-1),9,Z),o("line",{y1:-l.value,y2:-l.value+20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${t(_)/127*e.value/5},0)`,stroke:"white"},null,8,ee),o("line",{opacity:"0.4",y1:-l.value,y2:-l.value+20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${+(t(s)/127)*e.value/5},0)`,stroke:"white"},null,8,te)],512),o("g",{class:"tonic",ref_key:"tonicControl",ref:E},[o("rect",{x:e.value/5,y:-l.value,height:l.value,width:e.value/5,fill:t(x)(t(u).tonic,2,.8)},null,8,le),o("text",{class:"font-bold text-6xl",x:e.value*1.5/5,"text-anchor":"middle",y:-l.value/4},g(t(h)[t(u).tonic%12]),9,ne),o("line",{class:"transition",y1:-l.value,y2:-l.value+20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e.value/5+t(u).tonic/12*e.value/5+e.value/120},0)`,stroke:"white"},null,8,oe)],512),o("g",{class:"scale",ref_key:"scaleControl",ref:K},[o("rect",{x:e.value*2/5,y:-l.value,width:e.value*2/5,height:l.value,fill:"#aaa"},null,8,ae),o("text",{class:"text-4xl",x:e.value*2/5+30,y:-l.value/3.2},g(z.value.name),9,se),o("line",{y1:-l.value,y2:-l.value+20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e.value*2/5+t(b)/t(I).length*e.value*2/5},0)`,stroke:"white"},null,8,re)],512),o("g",{class:"show",onClick:F[0]||(F[0]=a=>M.value=!M.value)},[o("circle",{cx:e.value*4/5-50,cy:-l.value/2,r:"20",fill:M.value?"black":"transparent",stroke:"black","stroke-width":4},null,8,ue)]),o("g",{class:"end",ref_key:"endControl",ref:D},[o("rect",{x:e.value*4/5,y:-l.value,height:l.value,width:e.value/5,fill:t(x)(t(s)+3,null,t(f).activeNotes[t(s)]?1:.1)},null,8,ie),o("text",{class:"font-bold text-6xl",x:e.value-10,"text-anchor":"end",y:-l.value/4},g(t(h)[(t(s)+3)%12])+g(Math.floor((t(s)+3)/12)-1),9,ve),o("line",{y1:-l.value,y2:-l.value+20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e.value*4/5+t(s)/127*e.value/5},0)`,stroke:"white"},null,8,ce),o("line",{opacity:".5",y1:-l.value,y2:-l.value+20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${e.value*4/5+t(_)/127*e.value/5},0)`,stroke:"white"},null,8,he)],512)]),o("g",de,[($(!0),C(G,null,q(i.value,(a,j)=>($(),C("g",{class:"key",key:a,transform:`translate(${j*e.value/i.value.length},0)`},[o("rect",{width:e.value/i.value.length,height:d.value,fill:t(x)(a+3,null,t(f).activeNotes[a]?1:.1,t(u).isIn(t(h)[(a+3)%12])?1:.4),onMousedown:B(p=>T(a+3),["prevent"]),onMouseenter:p=>m.value?T(a+3):null,onTouchstart:B(p=>T(a+3),["prevent"]),onMouseleave:p=>k(a+3),onMouseup:B(p=>k(a+3),["prevent"]),onTouchend:p=>k(a+3),onTouchcancel:p=>k(a+3)},null,40,_e),o("circle",{r:t(u).tonic==(a+3)%12?e.value/i.value.length/3:e.value/i.value.length/8,cx:e.value/i.value.length/2,cy:d.value-e.value/i.value.length/2,opacity:t(f).activeNotes[a]?1:.3,fill:t(u).isIn(t(h)[(a+3)%12])?"white":"black"},null,8,ge),t(u).tonic==(a+3)%12?($(),C("line",{key:0,class:"pointer-events-none",x1:e.value/i.value.length/2,x2:e.value/i.value.length/2,y1:0,y2:d.value,"stroke-width":"6",opacity:.9,stroke:t(f).activeNotes[a]?"white":t(x)(a+3,-1,1,1)},null,8,pe)):H("",!0),o("text",{class:"pointer-events-none",fill:t(u).isIn(t(h)[(a+3)%12])?"black":"#777e","text-anchor":"middle",y:e.value/i.value.length/2+10,x:e.value/i.value.length/2,"font-size":e.value/i.value.length*.5,"font-weight":t(u).tonic==(a+3)%12?"bold":"normal"},g(t(h)[(a+3)%12]),9,ye)],8,fe))),128))])],8,U))}},Ce=A(me,[["__scopeId","data-v-999b9a74"]]);export{Ce as _};
