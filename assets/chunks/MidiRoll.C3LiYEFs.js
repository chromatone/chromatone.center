import{_ as z}from"./ControlStart.CIh3Inkd.js";import{R as N,ae as V,u as x,F,I as j,c as C}from"./theme.BUIsQubF.js";import{D as S,M as k,I as D,o as q,a1 as A,q as c,f as d,s as o,e as H,t as w,Z as W,j as Z,au as G,u as r,z as R}from"./framework.DprnlfsI.js";const J={class:"flex flex-col items-center w-full touch-none select-none"},K={class:"fullscreen-container",id:"screen"},L={key:0,class:"i-la-arrow-up"},O={key:1,class:"i-la-arrow-left"},P={key:0,class:"i-la-play"},Q={key:1,class:"i-la-pause"},U={class:"absolute bottom-1 left-8 text-white p-2"},X={class:"text-lg"},Y={class:"absolute top-2 left-2 text-white p-2"},tt={class:"text-lg"},et=["width","height"],lt={__name:"MidiRoll",setup(it){const{midi:l,stopAll:v,channels:m,guessChords:$}=N(),{width:_,height:y}=V(),h=S({notes:k(()=>{let i=[];for(let e in m)for(let a in m[e].notes){let u=m[e].notes[a];u.velocity>0&&i.push(u)}return i}),startTime:Date.now(),endTime:Date.now()});D(()=>l.playing,i=>{var e,a;i?h.startTime=((e=l.note)==null?void 0:e.timestamp)||Date.now():h.endTime=((a=l.note)==null?void 0:a.timestamp)||Date.now()});let p,s,n,g;const t=S({initiated:!1,width:_,height:y,speed:k(()=>Math.round(t.rawSpeed*2)/2),rawSpeed:F(x("midi-roll-speed",1),1,3),direction:x("midi-roll-direction",1)});D([_,y],()=>{n&&(n.width=t.width,n.height=t.height)}),q(()=>{p=document.getElementById("spectrogram"),s=p.getContext("2d"),n=document.createElement("canvas"),g=n.getContext("2d"),n.width=t.width,n.height=t.height,s.fillStyle="#333",s.fillRect(0,0,t.width,t.height),b()});function b(){t.initiated||(t.initiated=!0,j(I))}function I(){t.direction==1?T():B()}function T(){g.drawImage(p,0,0,t.width,t.height),s.fillStyle="#333333",s.fillRect(0,t.height-t.speed,t.width,t.speed);for(let i=0;i<127;i++){let e=i*t.width/127;s.fillStyle=C(i+3,0,.5,.25),s.fillRect(e,t.height-t.speed,1,t.speed)}s.translate(0,-t.speed),s.drawImage(n,0,0,t.width,t.height),h.notes.forEach(i=>{const e=16-i.channel;s.fillStyle=C(i.number-9,0,1),s.fillRect(i.number*t.width/127-e/2,t.height-t.speed,e,t.speed*2)}),s.setTransform(1,0,0,1,0,0)}function B(){g.drawImage(p,0,0,t.width,t.height),s.fillStyle="#333333",s.fillRect(t.width-t.speed,0,t.speed,t.height),h.notes.forEach(i=>{s.fillStyle=E((i.number+3)%12,1),s.fillRect(t.width-t.speed,t.height-i.number*t.height/127,t.speed,12-i.channel/2)}),s.translate(-t.speed,0),s.drawImage(n,0,0,t.width,t.height),s.setTransform(1,0,0,1,0,0)}function E(i=0,e=1,a=1){return`hsla(${i*30}, ${e*100}%, ${e*60}%, ${a})`}function M(i){let e=i.delta[0]-i.delta[1];e!=0?t.rawSpeed+=e/500:i.active&&(l.playing=!l.playing)}return(i,e)=>{const a=z,u=A("drag");return d(),c("div",J,[o("div",K,[t.initiated?w("",!0):(d(),H(a,{key:0,class:"absolute",onClick:e[0]||(e[0]=f=>b())},{default:Z(()=>e[5]||(e[5]=[G("Start")])),_:1})),o("button",{class:"p-2 absolute top-2 right-2",onClick:e[1]||(e[1]=f=>t.direction?t.direction=0:t.direction=1)},[t.direction==1?(d(),c("div",L)):w("",!0),t.direction==0?(d(),c("div",O)):w("",!0)]),o("button",{class:"absolute bottom-2 right-2 p-2",onClick:e[2]||(e[2]=f=>r(l).playing=!r(l).playing)},[r(l).playing?(d(),c("div",Q)):(d(),c("div",P))]),o("button",{class:"absolute bottom-2 left-2 p-2",onClick:e[3]||(e[3]=f=>r(v)())},e[6]||(e[6]=[o("div",{class:"i-la-stop"},null,-1)])),o("div",U,[o("div",X,R(r($)[0]),1)]),o("div",Y,[o("div",tt,"x"+R(t.speed),1)]),W(o("canvas",{class:"max-h-100vh w-full cursor-pointer",id:"spectrogram",width:t.width,height:t.height,onDblclick:e[4]||(e[4]=f=>r(v)())},null,40,et),[[u,M]])])])}}};export{lt as default};
