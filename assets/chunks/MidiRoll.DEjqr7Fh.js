import{_ as M}from"./ControlStart.BAfrouiT.js";import{R as N,ae as z,F,u as x,I as H,c as C}from"./theme.oPgoCdSG.js";import{r as S,e as k,w as D,o as W,O as A,B as d,C as c,E as o,V as J,W as L,af as O,L as w,u as r,J as R,H as j}from"./framework.B_b_ZswS.js";const q={class:"flex flex-col items-center w-full touch-none select-none"},G={class:"fullscreen-container",id:"screen"},K={key:0,class:"i-la-arrow-up"},P={key:1,class:"i-la-arrow-left"},Q={key:0,class:"i-la-play"},U={key:1,class:"i-la-pause"},X={class:"absolute bottom-1 left-8 text-white p-2"},Y={class:"text-lg"},Z={class:"absolute top-2 left-2 text-white p-2"},ee={class:"text-lg"},te=["width","height"],le={__name:"MidiRoll",setup(ie){const{midi:l,stopAll:v,channels:m,guessChords:$}=N(),{width:_,height:y}=z(),h=S({notes:k(()=>{let i=[];for(let t in m)for(let a in m[t].notes){let u=m[t].notes[a];u.velocity>0&&i.push(u)}return i}),startTime:Date.now(),endTime:Date.now()});D(()=>l.playing,i=>{var t,a;i?h.startTime=((t=l.note)==null?void 0:t.timestamp)||Date.now():h.endTime=((a=l.note)==null?void 0:a.timestamp)||Date.now()});let p,s,n,g;const e=S({initiated:!1,width:_,height:y,speed:k(()=>Math.round(e.rawSpeed*2)/2),rawSpeed:F(x("midi-roll-speed",1),1,3),direction:x("midi-roll-direction",1)});D([_,y],()=>{n&&(n.width=e.width,n.height=e.height)}),W(()=>{p=document.getElementById("spectrogram"),s=p.getContext("2d"),n=document.createElement("canvas"),g=n.getContext("2d"),n.width=e.width,n.height=e.height,s.fillStyle="#333",s.fillRect(0,0,e.width,e.height),b()});function b(){e.initiated||(e.initiated=!0,H(I))}function I(){e.direction==1?T():B()}function T(){g.drawImage(p,0,0,e.width,e.height),s.fillStyle="#333333",s.fillRect(0,e.height-e.speed,e.width,e.speed);for(let i=0;i<127;i++){let t=i*e.width/127;s.fillStyle=C(i+3,0,.5,.25),s.fillRect(t,e.height-e.speed,1,e.speed)}s.translate(0,-e.speed),s.drawImage(n,0,0,e.width,e.height),h.notes.forEach(i=>{const t=16-i.channel;s.fillStyle=C(i.number-9,0,1),s.fillRect(i.number*e.width/127-t/2,e.height-e.speed,t,e.speed*2)}),s.setTransform(1,0,0,1,0,0)}function B(){g.drawImage(p,0,0,e.width,e.height),s.fillStyle="#333333",s.fillRect(e.width-e.speed,0,e.speed,e.height),h.notes.forEach(i=>{s.fillStyle=E((i.number+3)%12,1),s.fillRect(e.width-e.speed,e.height-i.number*e.height/127,e.speed,12-i.channel/2)}),s.translate(-e.speed,0),s.drawImage(n,0,0,e.width,e.height),s.setTransform(1,0,0,1,0,0)}function E(i=0,t=1,a=1){return`hsla(${i*30}, ${t*100}%, ${t*60}%, ${a})`}function V(i){let t=i.delta[0]-i.delta[1];t!=0?e.rawSpeed+=t/500:i.active&&(l.playing=!l.playing)}return(i,t)=>{const a=M,u=A("drag");return d(),c("div",q,[o("div",G,[e.initiated?w("",!0):(d(),J(a,{key:0,class:"absolute",onClick:t[0]||(t[0]=f=>b())},{default:L(()=>t[5]||(t[5]=[O("Start")])),_:1})),o("button",{class:"p-2 absolute top-2 right-2",onClick:t[1]||(t[1]=f=>e.direction?e.direction=0:e.direction=1)},[e.direction==1?(d(),c("div",K)):w("",!0),e.direction==0?(d(),c("div",P)):w("",!0)]),o("button",{class:"absolute bottom-2 right-2 p-2",onClick:t[2]||(t[2]=f=>r(l).playing=!r(l).playing)},[r(l).playing?(d(),c("div",U)):(d(),c("div",Q))]),o("button",{class:"absolute bottom-2 left-2 p-2",onClick:t[3]||(t[3]=f=>r(v)())},t[6]||(t[6]=[o("div",{class:"i-la-stop"},null,-1)])),o("div",X,[o("div",Y,R(r($)[0]),1)]),o("div",Z,[o("div",ee,"x"+R(e.speed),1)]),j(o("canvas",{class:"max-h-100vh w-full cursor-pointer",id:"spectrogram",width:e.width,height:e.height,onDblclick:t[4]||(t[4]=f=>r(v)())},null,40,te),[[u,V]])])])}}};export{le as default};
