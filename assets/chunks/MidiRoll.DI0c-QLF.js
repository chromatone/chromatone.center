import{_ as B}from"./ControlStart.pSxYfY8v.js";import{ao as I,b,c as k,d as x,u as S,o as E,M as V,U as M,f as d,g as r,h as l,B as N,C as z,ae as H,q as w,l as c,m as q,k as A}from"./framework.B7TlvOs3.js";import{ak as n,H as F,aV as C}from"./theme.t-3cbqQx.js";const U={class:"flex flex-col items-center w-full touch-none select-none"},W={class:"fullscreen-container",id:"screen"},j={key:0,class:"i-la-arrow-up"},G={key:1,class:"i-la-arrow-left"},J={key:0,class:"i-la-play"},K={key:1,class:"i-la-pause"},L=l("div",{class:"i-la-stop"},null,-1),O=[L],P={class:"absolute top-2 left-2 text-white p-2"},Q={class:"text-lg"},X=["width","height"],ie={__name:"MidiRoll",setup(Y){const{width:_,height:v}=I(),h=b({notes:k(()=>{let i=[];for(let t in n.channels)for(let a in n.channels[t].notes){let u=n.channels[t].notes[a];u.velocity>0&&i.push(u)}return i}),startTime:Date.now(),endTime:Date.now()});x(()=>n.playing,i=>{var t,a;i?h.startTime=((t=n.note)==null?void 0:t.timestamp)||Date.now():h.endTime=((a=n.note)==null?void 0:a.timestamp)||Date.now()});let p,s,o,m;const e=b({initiated:!1,width:_,height:v,speed:k(()=>Math.round(e.rawSpeed*2)/2),rawSpeed:F(S("midi-roll-speed",1),1,3),direction:S("midi-roll-direction",1)});x([_,v],()=>{o&&(o.width=e.width,o.height=e.height)}),E(()=>{p=document.getElementById("spectrogram"),s=p.getContext("2d"),o=document.createElement("canvas"),m=o.getContext("2d"),o.width=e.width,o.height=e.height,s.fillStyle="#333",s.fillRect(0,0,e.width,e.height),y()});function y(){e.initiated||(e.initiated=!0,V(D))}function D(){e.direction==1?$():R()}function $(){m.drawImage(p,0,0,e.width,e.height),s.fillStyle="#333333",s.fillRect(0,e.height-e.speed,e.width,e.speed);for(let i=0;i<127;i++){let t=i*e.width/127;s.fillStyle=g((i+3)%12,1,.1),s.fillRect(t,e.height-e.speed,1,e.speed)}s.translate(0,-e.speed),s.drawImage(o,0,0,e.width,e.height),h.notes.forEach(i=>{const t=16-i.channel;s.fillStyle=g((i.number+3)%12,1),s.fillRect(i.number*e.width/127-t/2,e.height-e.speed,t,e.speed*2)}),s.setTransform(1,0,0,1,0,0)}function R(){m.drawImage(p,0,0,e.width,e.height),s.fillStyle="#333333",s.fillRect(e.width-e.speed,0,e.speed,e.height),h.notes.forEach(i=>{s.fillStyle=g((i.number+3)%12,1),s.fillRect(e.width-e.speed,e.height-i.number*e.height/127,e.speed,12-i.channel/2)}),s.translate(-e.speed,0),s.drawImage(o,0,0,e.width,e.height),s.setTransform(1,0,0,1,0,0)}function g(i=0,t=1,a=1){return`hsla(${i*30}, ${t*100}%, ${t*60}%, ${a})`}function T(i){let t=i.delta[0]-i.delta[1];t!=0?e.rawSpeed+=t/500:i.active&&(n.playing=!n.playing)}return(i,t)=>{const a=B,u=M("drag");return d(),r("div",U,[l("div",W,[e.initiated?w("",!0):(d(),N(a,{key:0,class:"absolute",onClick:t[0]||(t[0]=f=>y())},{default:z(()=>[H("Start")]),_:1})),l("button",{class:"p-2 absolute top-2 right-2",onClick:t[1]||(t[1]=f=>e.direction?e.direction=0:e.direction=1)},[e.direction==1?(d(),r("div",j)):w("",!0),e.direction==0?(d(),r("div",G)):w("",!0)]),l("button",{class:"absolute bottom-2 right-2 p-2",onClick:t[2]||(t[2]=f=>c(n).playing=!c(n).playing)},[c(n).playing?(d(),r("div",K)):(d(),r("div",J))]),l("button",{class:"absolute bottom-2 left-2 p-2",onClick:t[3]||(t[3]=f=>c(C)())},O),l("div",P,[l("div",Q,"x"+q(e.speed),1)]),A(l("canvas",{class:"max-h-100vh w-full cursor-pointer",id:"spectrogram",width:e.width,height:e.height,onDblclick:t[4]||(t[4]=f=>c(C)())},null,40,X),[[u,T]])])])}}};export{ie as default};
