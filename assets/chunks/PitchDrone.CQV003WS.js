import{H as k,F as C,aA as S,aL as B,c as F,Z as L,$ as N,a0 as O,b4 as D,b5 as j,b6 as A,b7 as _,b8 as R,ao as G,O as $,n as H,aq as U}from"./theme.CmnwaAF3.js";import{b as V,u as g,c as m,s as P,H as K,d as u,G as W,K as E,r as T,f as d,g as f,h as r,p as v,l as o,m as x,F as b,j as q,z as Z,R as M}from"./framework.DBqT_UJK.js";const l=V({base:55,freq:k(g("drone-freq",110),27.5,220),started:!1,stopped:!0,filterFreq:g("drone-filter-freq",1e3),volume:g("drone-vol",.5),note:m(()=>C(l.freq).toNote()),pitch:m({get(){return Math.round((S(l.freq)+72)%12)},set(s){l.freq=B(s-36)}}),cents:m(()=>X(l.freq)%1200),centDiff:m(()=>l.cents-l.pitch*100),color:m(()=>F(l.pitch,0))}),p=P({initiated:!1});function z(){const{channel:s}=L("drone");p.channel=s,p.gain=new N(l.volume).connect(s),p.filter=new O(l.filterFreq).connect(p.gain)}function I(){return p.initiated||(z(),p.initiated=!0,l.started=!0,K(" ",s=>{s.preventDefault(),l.stopped=!l.stopped}),u(()=>l.volume,s=>{p.gain.gain.targetRampTo(s,1)}),u(()=>l.filterFreq,s=>{p.filter.frequency.targetRampTo(s,.1)})),l}let w=0;function J(s){const e=P({}),t=V({play:!1,active:!1,vol:k(g(`drone-${s}-vol`,.8),0,1),pan:k(g(`drone-${s}-pan`,0),-1,1),freq:m(()=>l.freq*Math.pow(2,s/12)),note:m(()=>C(t.freq).toNote()),color:m(()=>F(C(t.freq).toMidi()-9,0)),lfo:0,panning:0}),h=D({param:`drone-${s}-vol`,number:5+w});u(h,a=>{t.vol=a,a>0&&(t.play=!0)});const i=D({param:`drone-${s}-pan`,number:6+w});u(i,a=>{t.pan=(a-.5)*2}),w+=2,u(()=>l.stopped,a=>{a?t.play=!1:t.active&&(t.play=!0)}),u(()=>t.play,a=>{a?(e.synth||(p.initiated||(z(),p.initiated=!0,l.started=!0),n(),c()),t.active=!0,l.stopped=!1,e.synth.triggerAttack(t.freq)):e.synth&&e.synth.triggerRelease()});function n(){e.meter=new j({normalRange:!0}),e.panner=new A({volume:_(l.volume)}).connect(p.filter),e.lfo=new R(Math.random()*.5+.01,-.25,.25).connect(e.panner.pan).start(),e.lfoVol=new R(Math.random()*.1+.001,-20,0).connect(e.panner.volume).connect(e.meter).start(),e.synth=new G({envelope:{attack:2,sustain:1,release:4},oscillator:{type:"sawtooth32"},volume:_(t.vol)-10}).connect(e.panner)}function c(){u(()=>t.freq,a=>{e.synth.frequency.targetRampTo(a)}),u(()=>t.vol,a=>{e.synth.volume.exponentialRampTo(_(a)-10,1)}),u(()=>t.pan,a=>{e.panner.pan.targetRampTo(a,1)}),W(()=>{t.lfo=e.meter.getValue()})}return E(()=>{e.synth&&e.synth.triggerRelease()}),t}function Q(s,e=l.base){return e*Math.pow(2,s/12)}function X(s,e=0){return Math.floor(1200*Math.log(s/Q(e))/Math.log(2))}const Y={class:"text-2xl z-100"},ee={__name:"PitchDroneVoice",props:{interval:{type:Number,default:0}},setup(s){const t=J(s.interval);function h(n,c){n.tap&&(t.play=!t.play,t.active=t.play),t.vol-=c[1]/400,t.pan+=c[0]/100}const i=T();return $({onDrag(n){var c;(c=n==null?void 0:n.event)==null||c.preventDefault(),h(n,n.delta)},onWheel(n){var c;(c=n==null?void 0:n.event)==null||c.preventDefault(),h(n,n.velocities.map(a=>-a))}},{domTarget:i,eventOptions:{passive:!1}}),(n,c)=>(d(),f("div",{class:"py-16 flex-1 relative cursor-pointer rounded-xl overflow-hidden text-center font-bold border-6 touch-none",ref_key:"control",ref:i,style:v({borderColor:o(t).play?o(t).color:"#3333"})},[r("div",{class:"vol -z-5 absolute left-0 right-0 bottom-0 bg-dark-100 bg-opacity-30 border-t-4",style:v({borderColor:o(t).color,height:o(t).vol*100+"%",opacity:o(t).play?1:.2})},null,4),r("div",{class:"vol -z-5 absolute left-0 right-0 bottom-0 bg-dark-900 bg-opacity-20 border-t-1",style:v({height:o(t).vol*100*o(t).lfo+"%",opacity:o(t).play?1:.2,backgroundColor:o(t).color})},null,4),r("div",{class:"pan -z-5 absolute left-0 top-0 bottom-0 border-r-2",style:v({width:o(t).pan*50+50+"%",opacity:o(t).play?1:.2})},null,4),r("div",Y,x(o(t).note),1)],4))}},te={class:"drone w-full flex-1 justify-center flex flex-col p-2"},oe={class:"intervals my-2"},ne={class:"flex flex-wrap"},ae={class:"info my-4 flex flex-wrap justify-stretch items-center touch-none"},se={class:"p-1 text-4xl font-bold"},le={class:"p-1"},re={class:"p-1"},ie={class:"p-1 text-xl"},ce={class:"controls min-w-10em flex-1 my-2 p-2 flex flex-wrap items-center justify-center is-group gap-2"},pe={key:0,class:"i-la-stop"},de={key:1,class:"i-la-play"},fe={class:"is-group flex p-2 gap-2"},ue={class:"notes w-full text-sm font-bold text-center flex flex-wrap"},me=["onClick"],xe={__name:"PitchDrone",setup(s){const e=I(),t=V({fifths:{title:"5P",voices:[7,19,31]},octave:{title:"8P",voices:[-12,0,12]}}),h=T();return $({onDrag(i){var n;(n=i==null?void 0:i.event)==null||n.preventDefault(),e.freq+=i.delta[0]/10},onWheel(i){var n;(n=i==null?void 0:i.event)==null||n.preventDefault(),e.freq-=i.velocities[0]/10}},{domTarget:h,eventOptions:{passive:!1}}),(i,n)=>{const c=U;return d(),f("div",{class:"flex flex-col items-stretch transition-all duration-500 ease-out select-none rounded-3xl shadow-xl border-8",style:v({borderColor:o(e).color})},[r("div",te,[r("div",oe,[(d(!0),f(b,null,q(t,a=>(d(),f("div",{class:"interval flex flex-col m-1",key:a},[r("div",ne,[(d(!0),f(b,null,q(a.voices,y=>(d(),Z(ee,{class:"m-2",key:y,interval:y},null,8,["interval"]))),128))])]))),128))]),r("div",ae,[r("div",{class:"flex flex-wrap p-4 mx-2 flex-1 min-w-10em items-center rounded-xl text-white p-2 cursor-pointer transition-all duration-500 ease-out",ref_key:"pitchControl",ref:h,style:v({backgroundColor:o(e).color})},[r("div",se,x(o(e).note),1),r("div",le,x(o(e).centDiff),1),r("div",re,x(o(e).cents)+" cents",1),r("div",ie,x(o(e).freq.toFixed(2))+" Hz",1)],4),r("div",ce,[r("button",{class:"text-button text-3xl",onClick:n[0]||(n[0]=a=>o(e).stopped=!o(e).stopped)},[o(e).stopped?(d(),f("div",de)):(d(),f("div",pe))]),r("div",fe,[M(c,{class:"w-4em",modelValue:o(e).volume,"onUpdate:modelValue":n[1]||(n[1]=a=>o(e).volume=a),min:0,max:1,step:.05,param:"VOL"},null,8,["modelValue"]),M(c,{class:"w-4em",modelValue:o(e).filterFreq,"onUpdate:modelValue":n[2]||(n[2]=a=>o(e).filterFreq=a),min:55,max:12e3,step:.05,fixed:0,param:"LP"},null,8,["modelValue"])])])]),r("div",ue,[(d(!0),f(b,null,q(o(H),(a,y)=>(d(),f("div",{class:"p-2 m-1 flex-1 cursor-pointer rounded-xl",key:a,style:v({backgroundColor:o(F)(y,3,o(e).pitch==y?1:.2,o(e).pitch==y?1:.4)}),onClick:he=>o(e).pitch=y},x(a),13,me))),128))])])],4)}}};export{xe as default};
