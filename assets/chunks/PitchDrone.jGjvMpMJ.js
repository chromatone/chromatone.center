import{D as k,F as C,aw as B,aL as L,c as D,Z as S,$ as A,a0 as N,b6 as V,b7 as j,b8 as O,b9 as _,ba as M,ak as G,L as R,n as U,am as E}from"./theme.Bl9EEmmj.js";import{b as F,u as g,c as m,s as T,h as H,d as u,g as W,k as K,r as $,x as p,y as d,A as r,H as x,E as n,G as v,F as b,B as w,T as Z,P}from"./framework.BjEhsXnI.js";const s=F({base:55,freq:k(g("drone-freq",110),27.5,220),started:!1,stopped:!0,filterFreq:g("drone-filter-freq",1e3),volume:g("drone-vol",.5),note:m(()=>C(s.freq).toNote()),pitch:m({get(){return Math.round((B(s.freq)+72)%12)},set(a){s.freq=L(a-36)}}),cents:m(()=>X(s.freq)%1200),centDiff:m(()=>s.cents-s.pitch*100),color:m(()=>D(s.pitch,0))}),f=T({initiated:!1});function z(){const{channel:a}=S("drone");f.channel=a,f.gain=new A(s.volume).connect(a),f.filter=new N(s.filterFreq).connect(f.gain)}function I(){return f.initiated||(z(),f.initiated=!0,s.started=!0,H(" ",a=>{a.preventDefault(),s.stopped=!s.stopped}),u(()=>s.volume,a=>{f.gain.gain.targetRampTo(a,1)}),u(()=>s.filterFreq,a=>{f.filter.frequency.targetRampTo(a,.1)})),s}let q=0;function J(a){const e=T({}),t=F({play:!1,active:!1,vol:k(g(`drone-${a}-vol`,.8),0,1),pan:k(g(`drone-${a}-pan`,0),-1,1),freq:m(()=>s.freq*Math.pow(2,a/12)),note:m(()=>C(t.freq).toNote()),color:m(()=>D(C(t.freq).toMidi()-9,0)),lfo:0,panning:0}),h=V({param:`drone-${a}-vol`,number:5+q});u(h,l=>{t.vol=l,l>0&&(t.play=!0)});const i=V({param:`drone-${a}-pan`,number:6+q});u(i,l=>{t.pan=(l-.5)*2}),q+=2,u(()=>s.stopped,l=>{l?t.play=!1:t.active&&(t.play=!0)}),u(()=>t.play,l=>{l?(e.synth||(f.initiated||(z(),f.initiated=!0,s.started=!0),o(),c()),t.active=!0,s.stopped=!1,e.synth.triggerAttack(t.freq)):e.synth&&e.synth.triggerRelease()});function o(){e.meter=new j({normalRange:!0}),e.panner=new O({volume:_(s.volume)}).connect(f.filter),e.lfo=new M(Math.random()*.5+.01,-.25,.25).connect(e.panner.pan).start(),e.lfoVol=new M(Math.random()*.1+.001,-20,0).connect(e.panner.volume).connect(e.meter).start(),e.synth=new G({envelope:{attack:2,sustain:1,release:4},oscillator:{type:"sawtooth32"},volume:_(t.vol)-10}).connect(e.panner)}function c(){u(()=>t.freq,l=>{e.synth.frequency.targetRampTo(l)}),u(()=>t.vol,l=>{e.synth.volume.exponentialRampTo(_(l)-10,1)}),u(()=>t.pan,l=>{e.panner.pan.targetRampTo(l,1)}),W(()=>{t.lfo=e.meter.getValue()})}return K(()=>{e.synth&&e.synth.triggerRelease()}),t}function Q(a,e=s.base){return e*Math.pow(2,a/12)}function X(a,e=0){return Math.floor(1200*Math.log(a/Q(e))/Math.log(2))}const Y={class:"text-2xl z-100"},ee={__name:"PitchDroneVoice",props:{interval:{type:Number,default:0}},setup(a){const t=J(a.interval);function h(o,c){o.tap&&(t.play=!t.play,t.active=t.play),t.vol-=c[1]/400,t.pan+=c[0]/100}const i=$();return R({onDrag(o){var c;(c=o==null?void 0:o.event)==null||c.preventDefault(),h(o,o.delta)},onWheel(o){var c;(c=o==null?void 0:o.event)==null||c.preventDefault(),h(o,o.velocities.map(l=>-l))}},{domTarget:i,eventOptions:{passive:!1}}),(o,c)=>(p(),d("div",{class:"relative cursor-pointer rounded-xl overflow-hidden text-center font-bold border-6 touch-none flex items-center justify-center",ref_key:"control",ref:i,style:x({borderColor:n(t).play?n(t).color:"#3333"})},[r("div",{class:"vol -z-5 absolute left-0 right-0 bottom-0 bg-dark-100 bg-opacity-30 border-t-4",style:x({borderColor:n(t).color,height:n(t).vol*100+"%",opacity:n(t).play?1:.2})},null,4),r("div",{class:"vol -z-5 absolute left-0 right-0 bottom-0 bg-dark-900 bg-opacity-20 border-t-1",style:x({height:n(t).vol*100*n(t).lfo+"%",opacity:n(t).play?1:.2,backgroundColor:n(t).color})},null,4),r("div",{class:"pan -z-5 absolute left-0 top-0 bottom-0 border-r-2",style:x({width:n(t).pan*50+50+"%",opacity:n(t).play?1:.2})},null,4),r("div",Y,v(n(t).note),1)],4))}},te={class:"flex-1 justify-center flex flex-col"},oe={class:"flex-1 flex flex-col gap-1"},ne={class:"flex flex-wrap flex-1"},le={class:"my-4 flex flex-wrap justify-stretch items-center touch-none"},ae={class:"p-1 text-6xl font-bold"},se={class:"flex flex-col text-md"},re={class:"p-0"},ie={class:"p-0"},ce={class:"controls min-w-10em flex-1 my-2 p-2 flex flex-wrap items-center justify-center is-group gap-2"},fe={key:0,class:"i-la-stop"},pe={key:1,class:"i-la-play"},de={class:"notes w-full text-sm font-bold text-center flex flex-wrap"},ue=["onClick"],xe={__name:"PitchDrone",setup(a){const e=I(),t=F({fifths:{title:"5P",voices:[7,19,31]},fourths:{title:"4P",voices:[5,17,29]},octave:{title:"8P",voices:[-12,0,12]}}),h=$();return R({onDrag(i){var o;(o=i==null?void 0:i.event)==null||o.preventDefault(),e.freq+=i.delta[0]/10},onWheel(i){var o;(o=i==null?void 0:i.event)==null||o.preventDefault(),e.freq-=i.velocities[0]/10}},{domTarget:h,eventOptions:{passive:!1}}),(i,o)=>{const c=E;return p(),d("div",{class:"flex flex-col items-stretch transition-all duration-500 ease-out select-none rounded-3xl shadow-xl border-8 w-full h-screen p-1",style:x({borderColor:n(e).color})},[r("div",te,[r("div",oe,[(p(!0),d(b,null,w(t,l=>(p(),d("div",{class:"flex flex-col m-1 flex-1",key:l},[r("div",ne,[(p(!0),d(b,null,w(l.voices,y=>(p(),Z(ee,{class:"m-2 flex-1",key:y,interval:y},null,8,["interval"]))),128))])]))),128))]),r("div",le,[r("div",{class:"flex flex-wrap p-4 mx-2 flex-1 min-w-10em items-center rounded-xl text-white p-2 cursor-pointer transition-all duration-500 ease-out",ref_key:"pitchControl",ref:h,style:x({backgroundColor:n(e).color})},[r("div",ae,v(n(e).note),1),r("div",se,[r("div",re,v(n(e).centDiff)+"%",1),r("div",ie,v(n(e).freq.toFixed(2))+" Hz",1)])],4),r("div",ce,[r("button",{class:"text-button text-3xl",onClick:o[0]||(o[0]=l=>n(e).stopped=!n(e).stopped)},[n(e).stopped?(p(),d("div",pe)):(p(),d("div",fe))]),P(c,{class:"w-4em",modelValue:n(e).volume,"onUpdate:modelValue":o[1]||(o[1]=l=>n(e).volume=l),min:0,max:1,step:.05,param:"VOL"},null,8,["modelValue"]),P(c,{class:"w-4em",modelValue:n(e).filterFreq,"onUpdate:modelValue":o[2]||(o[2]=l=>n(e).filterFreq=l),min:55,max:12e3,step:.05,fixed:0,param:"LP"},null,8,["modelValue"])])]),r("div",de,[(p(!0),d(b,null,w(n(U),(l,y)=>(p(),d("div",{class:"p-2 m-1 flex-1 cursor-pointer rounded-xl",key:l,style:x({backgroundColor:n(D)(y,3,n(e).pitch==y?1:.2,n(e).pitch==y?1:.4)}),onClick:me=>n(e).pitch=y},v(l),13,ue))),128))])])],4)}}};export{xe as default};
