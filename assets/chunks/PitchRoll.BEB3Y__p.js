import{_ as B}from"./ControlStart.BbANuc_t.js";import{J as C,aD as D,w as I}from"./theme.DBWQeAkq.js";import{q as R,ap as W,b as A,u as M,P as x,r as T,o as $,d as E,W as F,x as d,y as p,A as l,E as i,M as V,N as q,af as z,I as b,G as c,C as H,H as K,K as G,L as J}from"./framework.CCD4PXEM.js";const v=u=>(G("data-v-05f3b5cf"),u=u(),J(),u),L={class:"flex flex-col mb-8 relative"},j={class:"fullscreen-container cursor-pointer",id:"screen"},O={class:"p-1 absolute top-2 left-2 flex items-center"},Q=v(()=>l("div",{class:"i-la-angle-double-right"},null,-1)),U=["width","height"],X={key:0,class:"flex gap-2 w-full p-2 items-center absolute bottom-4"},Y={key:0,class:"i-la-play"},Z={key:1,class:"i-la-pause"},ee=v(()=>l("div",{class:"i-la-times"},null,-1)),te=[ee],oe=v(()=>l("div",{class:"flex-1"},null,-1)),le={class:"p-1 w-2em"},ne={class:"p-1 w-1em"},se={class:"p-1 mt-2 w-6em text-sm"},ie=v(()=>l("div",{class:"flex-1"},null,-1)),ae={class:"flex-0 text-center"},ce={__name:"PitchRoll",setup(u){const{width:w,height:y}=W(),e=A({running:!0,speed:C(M("pitch-roll-speed",4),4,20),runnerWidth:2,runnerAhead:4,maxPlotFrequency:880,maxPlotNote:97,minPlotNote:24,prevBeat:0,step:0});x(" ",a=>{a.preventDefault(),e.running=!e.running}),x("Enter",()=>{_()});function P(a){a.tap&&(e.running=!e.running),e.speed=e.speed+a.delta[0]/5}const k=[0,1,2,3,4,5,6,7,8],{init:S,tuner:o}=D(),n=T();let t;$(()=>{t=n.value.getContext("2d")}),E(()=>o==null?void 0:o.frame,a=>{if(!e.running)return;let s=a*e.speed%n.value.width;if(t.globalAlpha=1,t.clearRect(s,0,e.speed,n.value.height),t.beginPath(),t.fillStyle=o.note.color,t.fillRect(s+e.speed,0,e.runnerWidth,n.value.height),!o.note.silent){const r=n.value.height-(o.note.value-e.minPlotNote)/(e.maxPlotNote-e.minPlotNote)*n.value.height;t.arc(s-8,r,8,0,4*Math.PI),t.fillStyle=I(o.note.color).lighten(.3).toHex(),t.fill()}if(a%50==0){t.beginPath(),t.strokeStyle="hsla(90,50%,50%,0.1)",t.lineWidth="1";for(let r of k){let h=n.value.height-(r*12-e.minPlotNote)/(e.maxPlotNote-e.minPlotNote)*n.value.height;t.moveTo(0,h),t.lineTo(n.value.width,h)}t.stroke()}t.globalAlpha=.25,o.beat>e.prevBeat&&(e.prevBeat=o.beat,t.fillStyle=o.note.color,t.fillRect(s-5,0,1,n.value.height))});function N(){S(),e.running=!0}function _(){t.clearRect(0,0,n.value.width,n.value.height)}return(a,s)=>{var m,g;const r=B,h=F("drag");return d(),p("div",L,[l("div",j,[i(o).running?b("",!0):(d(),V(r,{key:0,class:"absolute",onClick:s[0]||(s[0]=f=>N())},{default:q(()=>[z("Start rolling ")]),_:1})),l("div",O,[Q,l("span",null,c(e.speed.toFixed(1)),1)]),H(l("canvas",{class:"w-full h-full",ref_key:"roll",ref:n,width:i(w),height:i(y),onDblclick:s[1]||(s[1]=f=>_())},null,40,U),[[h,P]])]),i(o).note?(d(),p("div",X,[l("div",{class:"btn",onClick:s[2]||(s[2]=f=>e.running=!e.running)},[e.running?(d(),p("div",Z)):(d(),p("div",Y))]),l("div",{class:"btn",onClick:s[3]||(s[3]=f=>_())},te),oe,l("div",{class:"flex-1 text-center font-bold text-4xl transition-all duration-200 flex items-center",style:K({color:i(o).note.color})},[l("div",le,c((m=i(o).note)==null?void 0:m.name),1),l("div",ne,c((g=i(o).note)==null?void 0:g.octave),1),l("div",se,c(i(o).note.cents>0?"+":"")+c(i(o).note.cents)+" cents",1)],4),ie,l("div",ae,c(i(o).bpm.toFixed(1))+" BPM",1)])):b("",!0)])}}},he=R(ce,[["__scopeId","data-v-05f3b5cf"]]);export{he as default};
