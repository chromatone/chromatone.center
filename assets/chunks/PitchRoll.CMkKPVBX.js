import{_ as S}from"./ControlStart.DFGBqsN9.js";import{H as N,au as B,w as C}from"./theme.BxOLoZmJ.js";import{q as D,b as R,u as I,P as g,r as M,o as T,d as W,W as $,v as d,x as h,z as s,D as a,M as A,N as E,ar as F,H as x,E as r,B as H,G as V,J as q,K as z}from"./framework.C3BURm3f.js";const b=u=>(q("data-v-e0f16db9"),u=u(),z(),u),K={class:"flex flex-col mb-8"},G={class:"fullscreen-container cursor-pointer",id:"screen"},J={class:"p-1 absolute top-2 left-2 flex items-center"},j=b(()=>s("div",{class:"i-la-angle-double-right"},null,-1)),L={key:0,class:"flex p-8 items-center"},O={class:"p-1 w-2em"},Q={class:"p-1 w-1em"},U={class:"p-1 mt-2 w-6em text-sm"},X={key:0,class:"i-la-play"},Y={key:1,class:"i-la-pause"},Z=b(()=>s("div",{class:"i-la-times"},null,-1)),ee=[Z],te={class:"flex-1 text-center font-bold"},oe={__name:"PitchRoll",setup(u){const e=R({running:!0,speed:N(I("pitch-roll-speed",4),4,20),runnerWidth:2,runnerAhead:4,maxPlotFrequency:880,maxPlotNote:97,minPlotNote:24,prevBeat:0,step:0});g(" ",i=>{i.preventDefault(),e.running=!e.running}),g("Enter",()=>{v()});function y(i){i.tap&&(e.running=!e.running),e.speed=e.speed+i.delta[0]/5}const P=[0,1,2,3,4,5,6,7,8],{init:k,tuner:o}=B(),n=M();let t;T(()=>{t=n.value.getContext("2d")}),W(()=>o==null?void 0:o.frame,i=>{if(!e.running)return;let l=i*e.speed%n.value.width;if(t.globalAlpha=1,t.clearRect(l,0,e.speed,n.value.height),t.beginPath(),t.fillStyle=o.note.color,t.fillRect(l+e.speed,0,e.runnerWidth,n.value.height),!o.note.silent){const c=n.value.height-(o.note.value-e.minPlotNote)/(e.maxPlotNote-e.minPlotNote)*n.value.height;t.arc(l-8,c,8,0,4*Math.PI),t.fillStyle=C(o.note.color).lighten(.3).toHex(),t.fill()}if(i%50==0){t.beginPath(),t.strokeStyle="hsla(90,50%,50%,0.1)",t.lineWidth="1";for(let c of P){let p=n.value.height-(c*12-e.minPlotNote)/(e.maxPlotNote-e.minPlotNote)*n.value.height;t.moveTo(0,p),t.lineTo(n.value.width,p)}t.stroke()}t.globalAlpha=.25,o.beat>e.prevBeat&&(e.prevBeat=o.beat,t.fillStyle=o.note.color,t.fillRect(l-5,0,1,n.value.height))});function w(){k(),e.running=!0}function v(){t.clearRect(0,0,n.value.width,n.value.height)}return(i,l)=>{var _,m;const c=S,p=$("drag");return d(),h("div",K,[s("div",G,[a(o).running?x("",!0):(d(),A(c,{key:0,class:"absolute",onClick:l[0]||(l[0]=f=>w())},{default:E(()=>[F("Start rolling ")]),_:1})),s("div",J,[j,s("span",null,r(e.speed.toFixed(1)),1)]),H(s("canvas",{class:"w-full h-full",ref_key:"roll",ref:n,width:1920,height:1080,onDblclick:l[1]||(l[1]=f=>v())},null,544),[[p,y]])]),a(o).note?(d(),h("div",L,[s("div",{class:"flex-1 text-center font-bold text-4xl transition-all duration-200 flex items-center",style:V({color:a(o).note.color})},[s("div",O,r((_=a(o).note)==null?void 0:_.name),1),s("div",Q,r((m=a(o).note)==null?void 0:m.octave),1),s("div",U,r(a(o).note.cents>0?"+":"")+r(a(o).note.cents)+" cents",1)],4),s("div",{class:"btn",onClick:l[2]||(l[2]=f=>e.running=!e.running)},[e.running?(d(),h("div",Y)):(d(),h("div",X))]),s("div",{class:"btn",onClick:l[3]||(l[3]=f=>v())},ee),s("div",te,r(a(o).bpm.toFixed(1))+" BPM",1)])):x("",!0)])}}},ie=D(oe,[["__scopeId","data-v-e0f16db9"]]);export{ie as default};
