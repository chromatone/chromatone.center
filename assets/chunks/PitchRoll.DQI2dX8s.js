import{_ as S}from"./ControlStart.DtzOcs_F.js";import{D as B,aP as C,c as g}from"./theme.7_GhOmt2.js";import{_ as R,ak as D,H as T,E as W,a2 as _,r as $,o as z,J as A,a0 as E,q as v,f as d,s as o,t as x,e as F,R as I,u as i,j as M,aI as V,z as r,v as q}from"./framework.D01lOa8K.js";const j={class:"flex flex-col mb-8 relative"},H={class:"fullscreen-container cursor-pointer",id:"screen"},J={class:"p-1 absolute top-2 left-2 flex items-center"},K=["width","height"],G={key:0,class:"flex gap-2 w-full p-2 items-center absolute bottom-4"},L={key:0,class:"i-la-play"},O={key:1,class:"i-la-pause"},Q={class:"p-1 w-2em"},U={class:"p-1 w-1em"},X={class:"p-1 mt-2 w-6em text-sm"},Y={class:"flex-0 text-center"},Z={__name:"PitchRoll",setup(ee){const{width:b,height:y}=D(),e=T({running:!0,speed:B(W("pitch-roll-speed",4),4,20),runnerWidth:2,runnerAhead:4,maxPlotFrequency:880,maxPlotNote:97,minPlotNote:24,prevBeat:0,step:0});_(" ",a=>{a.preventDefault(),e.running=!e.running}),_("Enter",()=>{p()});function k(a){a.tap&&(e.running=!e.running),e.speed=e.speed+a.delta[0]/5}const w=[0,1,2,3,4,5,6,7,8],{init:P,tuner:n}=C(),s=$();let l;z(()=>{l=s.value.getContext("2d")}),A(()=>n==null?void 0:n.frame,a=>{if(!e.running)return;let t=a*e.speed%s.value.width;if(l.globalAlpha=1,l.clearRect(t,0,e.speed,s.value.height),l.beginPath(),l.fillStyle=g(n.note.value-9,0),l.fillRect(t+e.speed,0,e.runnerWidth,s.value.height),!n.note.silent){const u=s.value.height-(n.note.value-e.minPlotNote)/(e.maxPlotNote-e.minPlotNote)*s.value.height;l.arc(t-8,u,8,0,4*Math.PI),l.fillStyle=g(n.note.value-9,0),l.fill()}if(a%50==0){l.beginPath(),l.strokeStyle="hsla(90,50%,50%,0.1)",l.lineWidth="1";for(let u of w){let c=s.value.height-(u*12-e.minPlotNote)/(e.maxPlotNote-e.minPlotNote)*s.value.height;l.moveTo(0,c),l.lineTo(s.value.width,c)}l.stroke()}l.globalAlpha=.25,n.beat>e.prevBeat&&(e.prevBeat=n.beat,l.fillStyle=n.note.color,l.fillRect(t-5,0,1,s.value.height))});function N(){P(),e.running=!0}function p(){l.clearRect(0,0,s.value.width,s.value.height)}return(a,t)=>{var h,m;const u=S,c=E("drag");return d(),v("div",j,[o("div",H,[i(n).running?x("",!0):(d(),F(u,{key:0,class:"absolute",onClick:t[0]||(t[0]=f=>N())},{default:M(()=>t[4]||(t[4]=[V("Start rolling ")])),_:1})),o("div",J,[t[5]||(t[5]=o("div",{class:"i-la-angle-double-right"},null,-1)),o("span",null,r(e.speed.toFixed(1)),1)]),I(o("canvas",{class:"w-full h-full",ref_key:"roll",ref:s,width:i(b),height:i(y),onDblclick:t[1]||(t[1]=f=>p())},null,40,K),[[c,k]])]),i(n).note?(d(),v("div",G,[o("div",{class:"btn",onClick:t[2]||(t[2]=f=>e.running=!e.running)},[e.running?(d(),v("div",O)):(d(),v("div",L))]),o("div",{class:"btn",onClick:t[3]||(t[3]=f=>p())},t[6]||(t[6]=[o("div",{class:"i-la-times"},null,-1)])),t[7]||(t[7]=o("div",{class:"flex-1"},null,-1)),o("div",{class:"flex-1 text-center font-bold text-4xl transition-all duration-200 flex items-center",style:q({color:i(n).note.color})},[o("div",Q,r((h=i(n).note)==null?void 0:h.name),1),o("div",U,r((m=i(n).note)==null?void 0:m.octave),1),o("div",X,r(i(n).note.cents>0?"+":"")+r(i(n).note.cents)+" cents",1)],4),t[8]||(t[8]=o("div",{class:"flex-1"},null,-1)),o("div",Y,r(i(n).bpm.toFixed(1))+" BPM",1)])):x("",!0)])}}},oe=R(Z,[["__scopeId","data-v-6264767d"]]);export{oe as default};
