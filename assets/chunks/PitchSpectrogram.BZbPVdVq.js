import{r as h,h as y,an as D,b as R,c as $,u as m,d as A,o as B,P as q,x as u,y as p,A as a,C as O,L as U,I as z,G as L,R as b,_ as N}from"./framework.DzzWumix.js";import{bd as T,H as j,be as F,bf as G,aA as H,aq as K}from"./theme.CASTdkoz.js";import{_ as W}from"./ControlStart.C2-v4vcy.js";const J={class:"flex flex-col justify-center"},Q={class:"fullscreen-container text-white",id:"screen"},X=["width","height"],Y={class:"absolute top-4 left-4 text-xl select-none"},Z={key:0,class:"i-la-play"},ee={key:1,class:"i-la-pause"},te={key:0,class:"i-la-arrow-left"},oe={key:1,class:"i-la-arrow-down"},se={class:"absolute w-full bottom-2 flex items-center gap-2 px-2 flex-wrap"},ae={class:"is-group flex flex-wrap gap-2 flex-0 p-2 op-20 hover-op-80 transition"},le={class:"scale-75 max-h-60 overflow-clip relative text-white op-20 hover-op-80 transition"},de={__name:"PitchSpectrogram",setup(ne){const C=h(),f=h(),{mic:k,input:M}=T(),i=h(!1);y(" ",o=>{i.value=!i.value,o.preventDefault()}),y("Enter",o=>{g(),o.preventDefault()});let c,l,r,v;function g(){l.fillStyle="#000",l.fillRect(0,0,e.width,e.height)}const{width:w,height:_}=D(),e=R({initiated:!1,width:w,height:_,speed:$(()=>Math.floor(e.speedCount/100)),speedCount:j(100,100,500),vertical:m("spectrogram-vertical",!1),pow:m("spectrogram-power",1),offset:m("spectrogram-offset",0)});function S(o){o.tap&&(i.value=!i.value),e.speedCount-=o.delta[0]/2}A([w,_],([o,t])=>{c&&r&&(c.width=o,c.height=t,r.width=o,r.height=t)}),B(()=>{F(),c=document.getElementById("spectrogram"),l=c.getContext("2d"),r=document.createElement("canvas"),v=r.getContext("2d"),r.width=e.width,r.height=e.height,l.fillStyle="#000",l.fillRect(0,0,e.width,e.height);const o=c.captureStream();f.value.srcObject=o,f.value.play().then(()=>{var t,s;return(s=(t=f.value)==null?void 0:t.requestPictureInPicture)==null?void 0:s.call(t)}).catch(t=>console.error(t))});function P(o,t=10,s=.5){return 1/(1+Math.exp(-t*(o-s)))}let x;function V(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(async()=>{const{AudioMotionAnalyzer:o}=await N(async()=>{const{AudioMotionAnalyzer:t}=await import("./audioMotion-analyzer.7XoESQPH.js");return{AudioMotionAnalyzer:t}},[]);x=new o(null,{mode:1,connectSpeakers:!1,volume:0,useCanvas:!1,source:G.meter,onCanvasDraw(t){if(i.value)return;v.drawImage(c,0,0,e.width,e.height);let s=t.getBars();for(let n=0;n<s.length;n++)l.fillStyle=E((s[n].freqLo+s[n].freqHi)/2,P(s[n].value[0])),e.vertical?l.fillRect(n*(e.width/s.length),0,e.width/s.length,e.speed):l.fillRect(e.width-e.speed,e.height-(n+1)*(e.height/s.length),e.speed,e.height/s.length);e.vertical?l.translate(0,e.speed):l.translate(-e.speed,0),l.drawImage(r,0,0,e.width,e.height),l.setTransform(1,0,0,1,0,0)}}),e.initiated=!0,k.open=!0,x.connectInput(M)}).catch(o=>{console.log("mic denied",o)})}function E(o,t){let s=Math.pow(t+e.offset,e.pow);return`hsl(${H(o)*30}, ${s*100}%, ${s*70}%)`}return(o,t)=>{const s=W,n=K,I=q("drag");return u(),p("div",J,[a("div",Q,[O(a("canvas",{class:"cursor-pointer max-w-full",id:"spectrogram",ref_key:"canvasElement",ref:C,width:e.width,height:e.height},null,8,X),[[I,S]]),e.initiated?z("",!0):(u(),U(s,{key:0,class:"absolute",onClick:t[0]||(t[0]=d=>V())})),a("div",Y,"x"+L(e.speed),1),a("button",{class:"absolute bottom-4 left-4 text-xl select-none cursor-pointer",onMousedown:t[1]||(t[1]=d=>i.value=!i.value)},[i.value?(u(),p("div",Z)):(u(),p("div",ee))],32),a("button",{class:"absolute bottom-4 right-4 text-xl select-none cursor-pointer",onMousedown:t[2]||(t[2]=d=>e.vertical=!e.vertical)},[e.vertical?(u(),p("div",oe)):(u(),p("div",te))],32),a("button",{class:"absolute top-4 right-4 text-xl select-none cursor-pointer",onMousedown:t[3]||(t[3]=d=>g())},t[6]||(t[6]=[a("div",{class:"i-la-trash-alt"},null,-1)]),32)]),a("div",se,[a("div",ae,[b(n,{modelValue:e.pow,"onUpdate:modelValue":t[4]||(t[4]=d=>e.pow=d),min:1,max:10,step:1,fixed:0,param:"POW"},null,8,["modelValue"]),b(n,{modelValue:e.offset,"onUpdate:modelValue":t[5]||(t[5]=d=>e.offset=d),min:-.5,max:.5,step:1e-4,param:"OFFSET",fixed:2},null,8,["modelValue"])]),t[8]||(t[8]=a("div",{class:"flex-1"},null,-1)),a("div",le,[t[7]||(t[7]=a("div",{class:"absolute p-2 opacity-70 touch-none select-none text-md"},"Right click here to enter Picture-In-Picture mode",-1)),a("video",{class:"max-h-50",ref_key:"video",ref:f},null,512)])])])}}};export{de as default};
