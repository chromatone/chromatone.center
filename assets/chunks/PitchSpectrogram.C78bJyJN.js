import{bd as si,D as $e,am as ai}from"./theme.Bw6rsLYr.js";import{q as ni,r as Be,an as ri,ap as li,u as Me,d as ft,o as oi,f as hi,h as bt,x as Re,y as ye,A as Z,E as me,I as _t,G as At,z as ci,C as Ct,D as Tt,P as Ye,V as je,H as di}from"./framework.BjEhsXnI.js";/**!
 * audioMotion-analyzer
 * High-resolution real-time graphic audio spectrum analyzer JS module
 *
 * @version 4.5.0
 * @author  Henrique Avila Vianna <hvianna@gmail.com> <https://henriquevianna.com>
 * @license AGPL-3.0-or-later
 */const ui="4.5.0",xt=Math.PI,ze=2*xt,gt=xt/2,Bt=8.17579892,kt="dual-combined",tt="dual-horizontal",Se="single",Le="dual-vertical",It="bar-index",Ot="bar-level",at="gradient",Dt=60,Ft="click",fi="fullscreenchange",Yt="resize",_i="#111",jt="",Nt="A",Mt="B",Gt="C",Ht="D",zt="468",it="sans-serif",gi="#0f0",mi="#7f7f7f22",Pe=10,Pt="create",qt="fschange",pi="lores",vi=Yt,mt="user",wi="#000c",Xt="#fff",xi="#4f4",Vt="#888",Ri="#555",pt="bark",Qe="linear",qe="log",vt="mel",Wt=["#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b"],Qt=[["classic",{colorStops:["red",{color:"yellow",level:.85,pos:.6},{color:"lime",level:.475}]}],["prism",{colorStops:Wt}],["rainbow",{dir:"h",colorStops:["#817",...Wt,"#639"]}],["orangered",{bgColor:"#3e2f29",colorStops:["OrangeRed"]}],["steelblue",{bgColor:"#222c35",colorStops:["SteelBlue"]}]],Ke={alphaBars:!1,ansiBands:!1,barSpace:.1,bgAlpha:.7,channelLayout:Se,colorMode:at,fadePeaks:!1,fftSize:8192,fillAlpha:1,frequencyScale:qe,gradient:Qt[0][0],gravity:3.8,height:void 0,ledBars:!1,linearAmplitude:!1,linearBoost:1,lineWidth:0,loRes:!1,lumiBars:!1,maxDecibels:-25,maxFPS:0,maxFreq:22e3,minDecibels:-85,minFreq:20,mirror:0,mode:0,noteLabels:!1,outlineBars:!1,overlay:!1,peakFadeTime:750,peakHoldTime:500,peakLine:!1,radial:!1,radialInvert:!1,radius:.3,reflexAlpha:.15,reflexBright:1,reflexFit:!0,reflexRatio:0,roundBars:!1,showBgColor:!0,showFPS:!1,showPeaks:!0,showScaleX:!0,showScaleY:!1,smoothing:.5,spinSpeed:0,splitGradient:!1,start:!0,trueLeds:!1,useCanvas:!0,volume:1,weightingFilter:jt,width:void 0},yi=["ERR_AUDIO_CONTEXT_FAIL","Could not create audio context. Web Audio API not supported?"],Li=["ERR_INVALID_AUDIO_CONTEXT","Provided audio context is not valid"],Ei=["ERR_UNKNOWN_GRADIENT","Unknown gradient"],wt=["ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1"],Si=["ERR_INVALID_MODE","Invalid mode"],bi=["ERR_REFLEX_OUT_OF_RANGE","Reflex ratio must be >= 0 and < 1"],Ai=["ERR_INVALID_AUDIO_SOURCE","Audio source must be an instance of HTMLMediaElement or AudioNode"],Ci=["ERR_GRADIENT_INVALID_NAME","Gradient name must be a non-empty string"],Ti=["ERR_GRADIENT_NOT_AN_OBJECT","Gradient options must be an object"],Bi=["ERR_GRADIENT_MISSING_COLOR","Gradient colorStops must be a non-empty array"];class fe extends Error{constructor(e,i){const[s,n]=e;super(n+(i!==void 0?`: ${i}`:"")),this.name="AudioMotionError",this.code=s}}const Ut=(he,e)=>console.warn(`${he} is deprecated. Use ${e} instead.`),$t=he=>{for(const e in he)return!1;return!0},st=(he,e,i="toLowerCase")=>e[Math.max(0,e.indexOf((""+he)[i]()))],ki=(he,e,i,s,n)=>e+(s-e)*(n-he)/(i-he);Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(he){let e=this.length;for(;e-- >0;)if(he(this[e]))return e;return-1});class Ii{constructor(e,i={}){this._ready=!1,this._aux={},this._canvasGradients=[],this._destroyed=!1,this._energy={val:0,peak:0,hold:0},this._flg={},this._fps=0,this._gradients={},this._last=0,this._outNodes=[],this._ownContext=!1,this._selectedGrads=[],this._sources=[],e instanceof Element||($t(i)&&!$t(e)&&(i=e),e=null),this._ownCanvas=!(i.canvas instanceof HTMLCanvasElement);const s=this._ownCanvas?document.createElement("canvas"):i.canvas;s.style="max-width: 100%;",this._ctx=s.getContext("2d");for(const[v,y]of Qt)this.registerGradient(v,y);this._container=e||!this._ownCanvas&&s.parentElement||document.body,this._defaultWidth=this._container.clientWidth||640,this._defaultHeight=this._container.clientHeight||270;let n;if(!(i.source&&(n=i.source.context))){if(!(n=i.audioCtx))try{n=new(window.AudioContext||window.webkitAudioContext),this._ownContext=!0}catch{throw new fe(yi)}}if(!n.createGain)throw new fe(Li);const f=this._analyzer=[n.createAnalyser(),n.createAnalyser()],r=this._splitter=n.createChannelSplitter(2),o=this._merger=n.createChannelMerger(2);this._input=n.createGain(),this._output=n.createGain(),i.source&&this.connectInput(i.source);for(const v of[0,1])r.connect(f[v],v);o.connect(this._output),i.connectSpeakers!==!1&&this.connectOutput();for(const v of["_scaleX","_scaleR"])this[v]=document.createElement("canvas").getContext("2d");this._fsEl=i.fsElement||s;const c=()=>{this._fsTimeout||(this._fsTimeout=window.setTimeout(()=>{this._fsChanging||(this._setCanvas(vi),this._fsTimeout=0)},Dt))};window.ResizeObserver&&(this._observer=new ResizeObserver(c),this._observer.observe(this._container)),this._controller=new AbortController;const m=this._controller.signal;window.addEventListener(Yt,c,{signal:m}),s.addEventListener(fi,()=>{this._fsChanging=!0,this._fsTimeout&&window.clearTimeout(this._fsTimeout),this._setCanvas(qt),this._fsTimeout=window.setTimeout(()=>{this._fsChanging=!1,this._fsTimeout=0},Dt)},{signal:m});const R=()=>{n.state=="suspended"&&n.resume(),window.removeEventListener(Ft,R)};window.addEventListener(Ft,R),document.addEventListener("visibilitychange",()=>{document.visibilityState!="hidden"&&(this._frames=0,this._time=performance.now())},{signal:m}),this._setProps(i,!0),this.useCanvas&&this._ownCanvas&&this._container.appendChild(s),this._ready=!0,this._setCanvas(Pt)}get alphaBars(){return this._alphaBars}set alphaBars(e){this._alphaBars=!!e,this._calcBars()}get ansiBands(){return this._ansiBands}set ansiBands(e){this._ansiBands=!!e,this._calcBars()}get barSpace(){return this._barSpace}set barSpace(e){this._barSpace=+e||0,this._calcBars()}get channelLayout(){return this._chLayout}set channelLayout(e){this._chLayout=st(e,[Se,tt,Le,kt]),this._input.disconnect(),this._input.connect(this._chLayout!=Se?this._splitter:this._analyzer[0]),this._analyzer[0].disconnect(),this._outNodes.length&&this._analyzer[0].connect(this._chLayout!=Se?this._merger:this._output),this._calcBars(),this._makeGrad()}get colorMode(){return this._colorMode}set colorMode(e){this._colorMode=st(e,[at,It,Ot])}get fadePeaks(){return this._fadePeaks}set fadePeaks(e){this._fadePeaks=!!e}get fftSize(){return this._analyzer[0].fftSize}set fftSize(e){for(const s of[0,1])this._analyzer[s].fftSize=e;const i=this._analyzer[0].frequencyBinCount;this._fftData=[new Float32Array(i),new Float32Array(i)],this._calcBars()}get frequencyScale(){return this._frequencyScale}set frequencyScale(e){this._frequencyScale=st(e,[qe,pt,vt,Qe]),this._calcBars()}get gradient(){return this._selectedGrads[0]}set gradient(e){this._setGradient(e)}get gradientLeft(){return this._selectedGrads[0]}set gradientLeft(e){this._setGradient(e,0)}get gradientRight(){return this._selectedGrads[1]}set gradientRight(e){this._setGradient(e,1)}get gravity(){return this._gravity}set gravity(e){this._gravity=e>0?+e:this._gravity||Ke.gravity}get height(){return this._height}set height(e){this._height=e,this._setCanvas(mt)}get ledBars(){return this._showLeds}set ledBars(e){this._showLeds=!!e,this._calcBars()}get linearAmplitude(){return this._linearAmplitude}set linearAmplitude(e){this._linearAmplitude=!!e}get linearBoost(){return this._linearBoost}set linearBoost(e){this._linearBoost=e>=1?+e:1}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=+e||0}get loRes(){return this._loRes}set loRes(e){this._loRes=!!e,this._setCanvas(pi)}get lumiBars(){return this._lumiBars}set lumiBars(e){this._lumiBars=!!e,this._calcBars(),this._makeGrad()}get maxDecibels(){return this._analyzer[0].maxDecibels}set maxDecibels(e){for(const i of[0,1])this._analyzer[i].maxDecibels=e}get maxFPS(){return this._maxFPS}set maxFPS(e){this._maxFPS=e<0?0:+e||0}get maxFreq(){return this._maxFreq}set maxFreq(e){if(e<1)throw new fe(wt);this._maxFreq=Math.min(e,this.audioCtx.sampleRate/2),this._calcBars()}get minDecibels(){return this._analyzer[0].minDecibels}set minDecibels(e){for(const i of[0,1])this._analyzer[i].minDecibels=e}get minFreq(){return this._minFreq}set minFreq(e){if(e<1)throw new fe(wt);this._minFreq=+e,this._calcBars()}get mirror(){return this._mirror}set mirror(e){this._mirror=Math.sign(e)|0,this._calcBars(),this._makeGrad()}get mode(){return this._mode}set mode(e){const i=e|0;if(i>=0&&i<=10&&i!=9)this._mode=i,this._calcBars(),this._makeGrad();else throw new fe(Si,e)}get noteLabels(){return this._noteLabels}set noteLabels(e){this._noteLabels=!!e,this._createScales()}get outlineBars(){return this._outlineBars}set outlineBars(e){this._outlineBars=!!e,this._calcBars()}get peakFadeTime(){return this._peakFadeTime}set peakFadeTime(e){this._peakFadeTime=e>=0?+e:this._peakFadeTime||Ke.peakFadeTime}get peakHoldTime(){return this._peakHoldTime}set peakHoldTime(e){this._peakHoldTime=+e||0}get peakLine(){return this._peakLine}set peakLine(e){this._peakLine=!!e}get radial(){return this._radial}set radial(e){this._radial=!!e,this._calcBars(),this._makeGrad()}get radialInvert(){return this._radialInvert}set radialInvert(e){this._radialInvert=!!e,this._calcBars(),this._makeGrad()}get radius(){return this._radius}set radius(e){this._radius=+e||0,this._calcBars(),this._makeGrad()}get reflexRatio(){return this._reflexRatio}set reflexRatio(e){if(e=+e||0,e<0||e>=1)throw new fe(bi);this._reflexRatio=e,this._calcBars(),this._makeGrad()}get roundBars(){return this._roundBars}set roundBars(e){this._roundBars=!!e,this._calcBars()}get smoothing(){return this._analyzer[0].smoothingTimeConstant}set smoothing(e){for(const i of[0,1])this._analyzer[i].smoothingTimeConstant=e}get spinSpeed(){return this._spinSpeed}set spinSpeed(e){e=+e||0,(this._spinSpeed===void 0||e==0)&&(this._spinAngle=-gt),this._spinSpeed=e}get splitGradient(){return this._splitGradient}set splitGradient(e){this._splitGradient=!!e,this._makeGrad()}get stereo(){return Ut("stereo","channelLayout"),this._chLayout!=Se}set stereo(e){Ut("stereo","channelLayout"),this.channelLayout=e?Le:Se}get trueLeds(){return this._trueLeds}set trueLeds(e){this._trueLeds=!!e}get volume(){return this._output.gain.value}set volume(e){this._output.gain.value=e}get weightingFilter(){return this._weightingFilter}set weightingFilter(e){this._weightingFilter=st(e,[jt,Nt,Mt,Gt,Ht,zt],"toUpperCase")}get width(){return this._width}set width(e){this._width=e,this._setCanvas(mt)}get audioCtx(){return this._input.context}get canvas(){return this._ctx.canvas}get canvasCtx(){return this._ctx}get connectedSources(){return this._sources}get connectedTo(){return this._outNodes}get fps(){return this._fps}get fsHeight(){return this._fsHeight}get fsWidth(){return this._fsWidth}get isAlphaBars(){return this._flg.isAlpha}get isBandsMode(){return this._flg.isBands}get isDestroyed(){return this._destroyed}get isFullscreen(){return this._fsEl&&(document.fullscreenElement||document.webkitFullscreenElement)===this._fsEl}get isLedBars(){return this._flg.isLeds}get isLumiBars(){return this._flg.isLumi}get isOctaveBands(){return this._flg.isOctaves}get isOn(){return!!this._runId}get isOutlineBars(){return this._flg.isOutline}get pixelRatio(){return this._pixelRatio}get isRoundBars(){return this._flg.isRound}static get version(){return ui}connectInput(e){const i=e instanceof HTMLMediaElement;if(!(i||e.connect))throw new fe(Ai);const s=i?this.audioCtx.createMediaElementSource(e):e;return this._sources.includes(s)||(s.connect(this._input),this._sources.push(s)),s}connectOutput(e=this.audioCtx.destination){if(!this._outNodes.includes(e)&&(this._output.connect(e),this._outNodes.push(e),this._outNodes.length==1))for(const i of[0,1])this._analyzer[i].connect(this._chLayout==Se&&!i?this._output:this._merger,0,i)}destroy(){if(!this._ready)return;const{audioCtx:e,canvas:i,_controller:s,_input:n,_merger:f,_observer:r,_ownCanvas:o,_ownContext:c,_splitter:m}=this;this._destroyed=!0,this._ready=!1,this.stop(),s.abort(),r&&r.disconnect(),this.onCanvasResize=null,this.onCanvasDraw=null,this._fsEl=null,this.disconnectInput(),this.disconnectOutput(),n.disconnect(),m.disconnect(),f.disconnect(),c&&e.close(),o&&i.remove(),this._calcBars()}disconnectInput(e,i){e?Array.isArray(e)||(e=[e]):e=Array.from(this._sources);for(const s of e){const n=this._sources.indexOf(s);if(i&&s.mediaStream)for(const f of s.mediaStream.getAudioTracks())f.stop();n>=0&&(s.disconnect(this._input),this._sources.splice(n,1))}}disconnectOutput(e){if(!(e&&!this._outNodes.includes(e))&&(this._output.disconnect(e),this._outNodes=e?this._outNodes.filter(i=>i!==e):[],this._outNodes.length==0))for(const i of[0,1])this._analyzer[i].disconnect()}getBars(){return Array.from(this._bars,({posX:e,freq:i,freqLo:s,freqHi:n,hold:f,peak:r,value:o})=>({posX:e,freq:i,freqLo:s,freqHi:n,hold:f,peak:r,value:o}))}getEnergy(e,i){if(e===void 0)return this._energy.val;if(e!=+e){if(e=="peak")return this._energy.peak;const o={bass:[20,250],lowMid:[250,500],mid:[500,2e3],highMid:[2e3,4e3],treble:[4e3,16e3]};if(!o[e])return null;[e,i]=o[e]}const s=this._freqToBin(e),n=i?this._freqToBin(i):s,f=this._chLayout==Se?1:2;let r=0;for(let o=0;o<f;o++)for(let c=s;c<=n;c++)r+=this._normalizedB(this._fftData[o][c]);return r/(n-s+1)/f}getOptions(e){Array.isArray(e)||(e=[e]);let i={};for(const s of Object.keys(Ke))e.includes(s)||(s=="gradient"&&this.gradientLeft!=this.gradientRight?(i.gradientLeft=this.gradientLeft,i.gradientRight=this.gradientRight):s!="start"&&(i[s]=this[s]));return i}registerGradient(e,i){if(typeof e!="string"||e.trim().length==0)throw new fe(Ci);if(typeof i!="object")throw new fe(Ti);const{colorStops:s}=i;if(!Array.isArray(s)||!s.length)throw new fe(Bi);const n=s.length,f=r=>+r!=r||r<0||r>1;s.forEach((r,o)=>{const c=o/Math.max(1,n-1);typeof r!="object"?s[o]={pos:c,color:r}:f(r.pos)&&(r.pos=c),f(r.level)&&(s[o].level=1-o/n)}),s.sort((r,o)=>r.level<o.level?1:r.level>o.level?-1:0),s[0].level=1,this._gradients[e]={bgColor:i.bgColor||_i,dir:i.dir,colorStops:s},this._selectedGrads.includes(e)&&this._makeGrad()}setCanvasSize(e,i){this._width=e,this._height=i,this._setCanvas(mt)}setFreqRange(e,i){if(e<1||i<1)throw new fe(wt);this._minFreq=Math.min(e,i),this.maxFreq=Math.max(e,i)}setLedParams(e){let i,s,n;e&&(i=e.maxLeds|0,s=+e.spaceV,n=+e.spaceH),this._ledParams=i>0&&s>0&&n>=0?[i,s,n]:void 0,this._calcBars()}setOptions(e){this._setProps(e)}setSensitivity(e,i){for(const s of[0,1])this._analyzer[s].minDecibels=Math.min(e,i),this._analyzer[s].maxDecibels=Math.max(e,i)}start(){this.toggleAnalyzer(!0)}stop(){this.toggleAnalyzer(!1)}toggleAnalyzer(e){const i=this.isOn;return e===void 0&&(e=!i),i&&!e?(cancelAnimationFrame(this._runId),this._runId=0):!i&&e&&!this._destroyed&&(this._frames=0,this._time=performance.now(),this._runId=requestAnimationFrame(s=>this._draw(s))),this.isOn}toggleFullscreen(){if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{const e=this._fsEl;if(!e)return;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}}_binToFreq(e){return e*this.audioCtx.sampleRate/this.fftSize||1}_calcBars(){const e=this._bars=[];if(!this._ready){this._flg={isAlpha:!1,isBands:!1,isLeds:!1,isLumi:!1,isOctaves:!1,isOutline:!1,isRound:!1,noLedGap:!1};return}const{_ansiBands:i,_barSpace:s,canvas:n,_chLayout:f,_maxFreq:r,_minFreq:o,_mirror:c,_mode:m,_radial:R,_radialInvert:v,_reflexRatio:y}=this,T=n.width>>1,U=n.height>>1,W=f==Le&&!R,z=f==tt,B=m%10!=0,K=B&&this._frequencyScale==qe,_=this._showLeds&&B&&!R,I=this._lumiBars&&B&&!R,ie=this._alphaBars&&!I&&m!=Pe,ee=this._outlineBars&&B&&!I&&!_,x=this._roundBars&&B&&!I&&!_,$=f!=Le||y>0&&!I,q=n.height-(W&&!_?.5:0)>>W,Q=q*(I||R?1:1-y)|0,t=n.width-T*(z||c!=0),Y=W?n.height-q*2:0,de=T*(c==-1&&!z&&!R);let le=Math.min(n.width,n.height)*.375*(f==Le?1:this._radius)|0,N=Math.min(T,U);v&&f!=Le&&([le,N]=[N,le]);const O=C=>e.push({...C,peak:[0,0],hold:[0],alpha:[0],value:[0]}),b=C=>{const D=this._freqToBin(C,"floor"),L=this._binToFreq(D),E=this._binToFreq(D+1),G=Math.log2(C/L)/Math.log2(E/L);return[D,G]};let w,M,h;if(K){const C=(F,V,k)=>+F.toPrecision(k?Math.max(V,1+Math.log10(F)|0):V),D=F=>{const V=[1,1.12,1.25,1.4,1.6,1.8,2,2.24,2.5,2.8,3.15,3.55,4,4.5,5,5.6,6.3,7.1,8,9,10],k=Math.log10(F)|0,pe=F/10**k;let _e=1;for(;_e<V.length&&pe>V[_e];)_e++;return pe-V[_e-1]<V[_e]-pe&&_e--,(V[_e]*10**(k+5)|0)/1e5},L=[0,24,12,8,6,4,3,2,1][m],E=i?10**(3/(L*10)):2**(1/L),G=E**.5;let ne=i?7.94328235/(L%2?1:G):Bt;do{let F=ne;const V=C(F/G,4,!0),k=C(F*G,4,!0),[pe,_e]=b(V),[Xe,ve]=b(k);i?F=L<4?D(F):C(F,F.toString()[0]<5?3:2):F=C(F,4,!0),F>=o&&O({posX:0,freq:F,freqLo:V,freqHi:k,binLo:pe,binHi:Xe,ratioLo:_e,ratioHi:ve}),ne*=E}while(ne<=r);w=t/e.length,e.forEach((F,V)=>F.posX=de+V*w);const X=e[0],ae=e[e.length-1];M=this._freqScaling(X.freqLo),h=t/(this._freqScaling(ae.freqHi)-M),X.freqLo<o&&(X.freqLo=o,[X.binLo,X.ratioLo]=b(o)),ae.freqHi>r&&(ae.freqHi=r,[ae.binHi,ae.ratioHi]=b(r))}else if(B){const C=[0,24,12,8,6,4,3,2,1][m]*10,D=L=>{switch(this._frequencyScale){case pt:return 1960/(26.81/(L+.53)-1);case vt:return 700*(2**L-1);case Qe:return L}};w=t/C,M=this._freqScaling(o),h=t/(this._freqScaling(r)-M);for(let L=0,E=0;L<C;L++,E+=w){const G=D(M+E/h),ne=D(M+(E+w/2)/h),X=D(M+(E+w)/h),[ae,F]=b(G),[V,k]=b(X);O({posX:de+E,freq:ne,freqLo:G,freqHi:X,binLo:ae,binHi:V,ratioLo:F,ratioHi:k})}}else{w=1,M=this._freqScaling(o),h=t/(this._freqScaling(r)-M);const C=this._freqToBin(o,"floor"),D=this._freqToBin(r);let L=-999;for(let E=C;E<=D;E++){const G=this._binToFreq(E),ne=de+Math.round(h*(this._freqScaling(G)-M));if(ne>L)O({posX:ne,freq:G,freqLo:G,freqHi:G,binLo:E,binHi:E,ratioLo:0,ratioHi:0}),L=ne;else if(e.length){const X=e[e.length-1];X.binHi=E,X.freqHi=G,X.freq=(X.freqLo*G)**.5}}}let l=0,A=0;if(_){const C=this._pixelRatio/(window.devicePixelRatio>1&&window.screen.height<=540?2:1),D=[[],[128,3,.45],[128,4,.225],[96,6,.225],[80,6,.225],[80,6,.125],[64,6,.125],[48,8,.125],[24,16,.125]],L=this._ledParams,[E,G,ne]=L||D[m];let X,ae=Q;if(L){const F=2*C;let V;X=E+1;do X--,V=ae/X/(1+G),A=V*G;while((V<F||A<F)&&X>1)}else{const F=540/G;A=Math.min(G*C,Math.max(2,ae/F+.1|0))}$&&(ae+=A),L||(X=Math.min(E,ae/(A*2)|0)),l=ne>=1?ne:w*ne,this._leds=[X,l,A,ae/X-A]}const d=Math.min(w-1,s*(s>0&&s<1?w:1));B&&(w-=Math.max(_?l:0,d)),e.forEach((C,D)=>{let L=C.posX,E=w;B&&(s==0&&!_?(L|=0,E|=0,D>0&&L>e[D-1].posX+e[D-1].width&&(L--,E++)):L+=Math.max(_?l:0,d)/2,C.posX=L),C.barCenter=L+(w==1?0:E/2),C.width=E});const se=[];for(const C of[0,1]){const D=f==Le?(q+Y)*C:0,L=D+q,E=D+Q-(!_||$?0:A);se.push({channelTop:D,channelBottom:L,analyzerBottom:E})}this._aux={analyzerHeight:Q,analyzerWidth:t,centerX:T,centerY:U,channelCoords:se,channelHeight:q,channelGap:Y,initialX:de,innerRadius:le,outerRadius:N,scaleMin:M,unitWidth:h},this._flg={isAlpha:ie,isBands:B,isLeds:_,isLumi:I,isOctaves:K,isOutline:ee,isRound:x,noLedGap:$},this._createScales()}_createScales(){if(!this._ready)return;const{analyzerWidth:e,initialX:i,innerRadius:s,scaleMin:n,unitWidth:f}=this._aux,{canvas:r,_frequencyScale:o,_mirror:c,_noteLabels:m,_radial:R,_scaleX:v,_scaleR:y}=this,T=v.canvas,U=y.canvas,W=[],z=this._chLayout==tt,B=this._chLayout==Le,K=Math.min(r.width,r.height),_=["C",,"D",,"E","F",,"G",,"A",,"B"],I=K/34|0,ie=T.height>>1,ee=I>>1,x=ie*(m?.7:1.5),$=ee*(m?1:2),q=2**(1/12);if(!m&&(this._ansiBands||o!=qe))W.push(16,31.5,63,125,250,500,1e3,2e3,4e3),o==Qe?W.push(6e3,8e3,1e4,12e3,14e3,16e3,18e3,2e4,22e3):W.push(8e3,16e3);else{let N=Bt;for(let O=-1;O<11;O++)for(let b=0;b<12;b++){if(N>=this._minFreq&&N<=this._maxFreq){const w=_[b],M=w=="C";(w&&m&&!c&&!z||M)&&W.push(m?[N,w+(M?O:"")]:N)}N*=q}}U.width=U.height=Math.max(K*.15,(s<<1)+B*I);const Q=U.width>>1,t=Q-I*.7,Y=(N,O)=>{const b=ze*(N/r.width),w=b-gt,M=t*Math.cos(w),h=t*Math.sin(w);y.save(),y.translate(Q+M,Q+h),y.rotate(b),y.fillText(O,0,0),y.restore()};T.width|=0,v.fillStyle=y.strokeStyle=wi,v.fillRect(0,0,T.width,T.height),y.arc(Q,Q,Q-I/2,0,ze),y.lineWidth=I,y.stroke(),v.fillStyle=y.fillStyle=Xt,v.font=`${ie}px ${it}`,y.font=`${ee}px ${it}`,v.textAlign=y.textAlign="center";let de=-x/4,le=-$;for(const N of W){const[O,b]=Array.isArray(N)?N:[N,N<1e3?N|0:`${(N/100|0)/10}k`],w=f*(this._freqScaling(O)-n),M=T.height*.75,h=b[0]=="C",l=ie*(m&&!c&&!z?h?1.2:.6:3);if(v.fillStyle=y.fillStyle=h&&!c&&!z?xi:Xt,m){const A=o==qe,d=o==Qe;let se=["C"];if((A||O>2e3||!d&&O>250||(!R||B)&&(!d&&O>125||O>1e3))&&se.push("G"),(A||O>4e3||!d&&O>500||(!R||B)&&(!d&&O>250||O>2e3))&&se.push("E"),(d&&O>4e3||(!R||B)&&(A||O>2e3||!d&&O>500))&&se.push("D","F","A","B"),!se.includes(b[0]))continue}w>=de+x/2&&w<=e&&(v.fillText(b,z&&c==-1?e-w:i+w,M,l),(z||c&&(w>x||c==1))&&v.fillText(b,z&&c!=1?e+w:(i||r.width)-w,M,l),de=w+Math.min(l,v.measureText(b).width)/2),w>=le+$&&w<e-$&&(Y(z&&c==1?e-w:w,b),(z||c&&(w>$||c==1))&&Y(z&&c!=-1?e+w:-w,b),le=w)}}_draw(e){this._runId=requestAnimationFrame(a=>this._draw(a));const i=e-this._time,s=e-this._last,n=this._maxFPS?975/this._maxFPS:0;if(s<n)return;this._last=e-(n?s%n:0),this._frames++,i>=1e3&&(this._fps=this._frames/i*1e3,this._frames=0,this._time=e);const{isAlpha:f,isBands:r,isLeds:o,isLumi:c,isOctaves:m,isOutline:R,isRound:v,noLedGap:y}=this._flg,{analyzerHeight:T,centerX:U,centerY:W,channelCoords:z,channelHeight:B,channelGap:K,initialX:_,innerRadius:I,outerRadius:ie}=this._aux,{_bars:ee,canvas:x,_canvasGradients:$,_chLayout:q,_colorMode:Q,_ctx:t,_energy:Y,_fadePeaks:de,fillAlpha:le,_fps:N,_linearAmplitude:O,_lineWidth:b,maxDecibels:w,minDecibels:M,_mirror:h,_mode:l,overlay:A,_radial:d,showBgColor:se,showPeaks:C,useCanvas:D,_weightingFilter:L}=this,E=this._scaleX.canvas,G=this._scaleR.canvas,ne=N*this._peakFadeTime/1e3,X=N**2,ae=this._gravity*1e3,F=N*this._peakHoldTime/1e3,V=q==kt,k=q==tt,pe=q==Le,_e=q==Se,Xe=o&&this._trueLeds&&Q==at,ve=d?x.width:this._aux.analyzerWidth,nt=_+ve,Ve=C&&this._peakLine&&l==Pe,be=d?ie-I:T,Kt=be/this._pixelRatio,[Jt,Yi,We,rt]=this._leds||[];Y.val>0&&N>0&&(this._spinAngle+=this._spinSpeed*ze/60/N);const Zt=a=>{if(this._reflexRatio>0&&!c&&!d){let S,we;this.reflexFit||pe?(S=pe&&a==0?B+K:0,we=B-T):(S=x.height-T*2,we=T),t.save(),t.globalAlpha=this.reflexAlpha,this.reflexBright!=1&&(t.filter=`brightness(${this.reflexBright})`),t.setTransform(1,0,0,-1,0,x.height),t.drawImage(x,0,z[a].channelTop,x.width,T,0,S,x.width,we),t.restore()}},ei=()=>{this.showScaleX&&(d?(t.save(),t.translate(U,W),this._spinSpeed&&t.rotate(this._spinAngle+gt),t.drawImage(G,-G.width>>1,-G.width>>1),t.restore()):t.drawImage(E,0,x.height-E.height))},ti=a=>{const S=a**2,we=424.36,te=11599.29,Je=25122.25,Ae=544496.41,Ee=148693636,Ie=Oe=>20*Math.log10(Oe);switch(L){case Nt:const Oe=Ee*S**2/((S+we)*Math.sqrt((S+te)*(S+Ae))*(S+Ee));return 2+Ie(Oe);case Mt:const De=Ee*S*a/((S+we)*Math.sqrt(S+Je)*(S+Ee));return .17+Ie(De);case Gt:const ht=Ee*S/((S+we)*(S+Ee));return .06+Ie(ht);case Ht:const Ze=((103791848e-2-S)**2+108076816e-2*S)/((9837328-S)**2+11723776*S),ct=a/68966888496476e-18*Math.sqrt(Ze/((S+79919.29)*(S+1345600)));return Ie(ct);case zt:const et=-4737338981378384e-39*a**6+2043828333606125e-30*a**4-1363894795463638e-22*S+1,Fe=1306612257412824e-34*a**5-2118150887518656e-26*a**3+.0005559488023498642*a,ce=.0001246332637532143*a/Math.hypot(et,Fe);return 18.2+Ie(ce)}return 0},lt=(a,S,we)=>{t.beginPath(),t.moveTo(a,S),t.lineTo(a,we),t.stroke()},ot=a=>{if(a&&b){const S=t.globalAlpha;t.globalAlpha=1,t.stroke(),t.globalAlpha=S}},ke=a=>Math.max(0,(a*Jt|0)*(rt+We)-We),ii=a=>{Y.val=a,Y.peak>0&&(Y.hold--,Y.hold<0&&(Y.peak+=Y.hold*ae/X/x.height*this._pixelRatio)),a>=Y.peak&&(Y.peak=a,Y.hold=F)};A&&t.clearRect(0,0,x.width,x.height);let Rt=0;const yt=ee.length,Lt=_e?1:2;for(let a=0;a<Lt;a++){const{channelTop:S,channelBottom:we,analyzerBottom:te}=z[a],Je=this._gradients[this._selectedGrads[a]],Ae=Je.colorStops,Ee=Ae.length,Ie=!se||o&&!A?"#000":Je.bgColor,Oe=pe&&d&&a?-1:1,De=!a&&h==-1||a&&h==1,ht=!k||a&&h!=1?0:ve>>(a||!De),Ze=k&&De?-1:1,ct=()=>{const u=E.height,g=u>>1,p=O?100:w,P=O?0:M,j=O?20:5,oe=T/(p-P),xe=h!=-1&&(!k||a==0||h==1),Ce=h!=1&&(!k||a!=h);t.save(),t.fillStyle=Vt,t.font=`${g}px ${it}`,t.textAlign="right",t.lineWidth=1;for(let Te=p;Te>P;Te-=j){const Ge=S+(p-Te)*oe,J=Te%2==0|0;if(J){const re=Ge+g*(Ge==S?.8:.35);xe&&t.fillText(Te,u*.85,re),Ce&&t.fillText(Te,(k?ve:x.width)-u*.1,re),t.strokeStyle=Vt,t.setLineDash([2,4]),t.lineDashOffset=0}else t.strokeStyle=Ri,t.setLineDash([2,8]),t.lineDashOffset=1;t.beginPath(),t.moveTo(_+u*J*xe,~~Ge+.5),t.lineTo(nt-u*J*Ce,~~Ge+.5),t.stroke()}t.restore()},et=(u,g)=>{const p=ge[u]+(u<ge.length-1?(ge[u+1]-ge[u])*g:0);return isNaN(p)?-1/0:p},Fe=(u,g=Ze)=>g*ze*((u+ht)/x.width)+this._spinAngle,ce=(u,g,p)=>{const P=I+g*Oe,j=Fe(u,p);return[U+P*Math.cos(j),W+P*Math.sin(j)]},dt=(u,g,p,P,j)=>{t.beginPath();for(const oe of h&&!k?[1,-1]:[Ze]){const[xe,Ce]=v?[Fe(u,oe),Fe(u+p,oe)]:[];t.moveTo(...ce(u,g,oe)),t.lineTo(...ce(u,g+P,oe)),v?t.arc(U,W,I+(g+P)*Oe,xe,Ce,oe!=1):t.lineTo(...ce(u+p,g+P,oe)),t.lineTo(...ce(u+p,g,oe)),v&&!j&&t.arc(U,W,I+g*Oe,Ce,xe,oe==1)}ot(j),t.fill()},ut=(u=0,g=0)=>{let p;if(Q==at&&!Xe||l==Pe)p=$[a];else{const P=Q==It?g%Ee:Ae.findLastIndex(j=>o?ke(u)<=ke(j.level):u<=j.level);p=Ae[P].color}t.fillStyle=t.strokeStyle=p};if(D){if(k&&!d){const u=ve*(a+De),g=De?-1:1;t.setTransform(g,0,0,1,u,0)}if((!A||se)&&(A&&(t.globalAlpha=this.bgAlpha),t.fillStyle=Ie,(a==0||!d&&!V)&&t.fillRect(_,S-K,ve,(A&&this.reflexAlpha==1?T:B)+K),t.globalAlpha=1),this.showScaleY&&!c&&!d&&(a==0||!V)&&ct(),o?(t.setLineDash([rt,We]),t.lineWidth=ee[0].width):t.lineWidth=R?Math.min(b,ee[0].width/2):b,t.save(),!d){const u=new Path2D;u.rect(0,S,x.width,T),t.clip(u)}}let ge=this._fftData[a];this._analyzer[a].getFloatFrequencyData(ge),L&&(ge=ge.map((u,g)=>u+ti(this._binToFreq(g)))),t.beginPath();let Ue=[];for(let u=0;u<yt;u++){const g=ee[u],{posX:p,barCenter:P,width:j,freq:oe,binLo:xe,binHi:Ce,ratioLo:Te,ratioHi:Ge}=g;let J=Math.max(et(xe,Te),et(Ce,Ge));for(let H=xe+1;H<Ce;H++)ge[H]>J&&(J=ge[H]);if(J=this._normalizedB(J),g.value[a]=J,Rt+=J,g.peak[a]>0&&g.alpha[a]>0&&(g.hold[a]--,g.hold[a]<0)){if(de&&!Ve){const H=!f||R&&b>0?1:f?g.peak[a]:le;g.alpha[a]=H*(1+g.hold[a]/ne)}else g.peak[a]+=g.hold[a]*ae/X/Kt;g.alpha[a]<=0&&(g.peak[a]=0)}if(J>=g.peak[a]&&(g.peak[a]=J,g.hold[a]=F,g.alpha[a]=!f||R&&b>0?1:f?J:le),!D)continue;t.globalAlpha=c||f?J:R?le:1,ut(J,u);const re=c?be:o?ke(J):J*be|0;if(l==Pe){const H=u?0:(this._normalizedB(ge[ee[1].binLo])*be+re)/2;if(d){if(u==0&&(k&&t.moveTo(...ce(0,0)),t.lineTo(...ce(0,p<0?H:re))),p>=0){const ue=[p,re];t.lineTo(...ce(...ue)),Ue.push(ue)}}else{if(u==0)if(h==-1&&!k)t.moveTo(_,te-(p<_?H:re));else{const ue=xe?this._normalizedB(ge[xe-1])*be:re;t.moveTo(_-b,te-ue)}(k||h!=-1||p>=_)&&t.lineTo(p,te-re)}}else if(o){if(se&&!A&&(a==0||!V)){const H=t.globalAlpha;t.strokeStyle=mi,t.globalAlpha=1,lt(P,S,te),t.strokeStyle=t.fillStyle,t.globalAlpha=H}if(Xe){const H=c?0:Ae.findLastIndex(Ne=>ke(J)<=ke(Ne.level));let ue=te;for(let Ne=Ee-1;Ne>=H;Ne--){t.strokeStyle=Ae[Ne].color;let St=te-(Ne==H?re:ke(Ae[Ne].level));lt(P,ue,St),ue=St-We}}else lt(P,te,te-re)}else if(p>=_)if(d)dt(p,0,j,re,R);else if(v){const H=j/2,ue=te+H;t.beginPath(),t.moveTo(p,ue),t.lineTo(p,ue-re),t.arc(P,ue-re,H,xt,ze),t.lineTo(p+j,ue),ot(R),t.fill()}else{const H=R?t.lineWidth:0;t.beginPath(),t.rect(p,te+H,j,-re-H),ot(R),t.fill()}const He=g.peak[a],Et=g.alpha[a];if(He>0&&Et>0&&C&&!Ve&&!c&&p>=_&&p<nt){if(de?t.globalAlpha=Et:R&&b>0?t.globalAlpha=1:f&&(t.globalAlpha=He),(Q==Ot||Xe)&&ut(He),o){const H=ke(He);H>=We&&t.fillRect(p,te-H,j,rt)}else if(!d)t.fillRect(p,te-He*be,j,2);else if(l!=Pe){const H=He*be;dt(p,H,j,!this._radialInvert||pe||H+I>=2?-2:2)}}}if(D){if(t.globalAlpha=1,l==Pe){if(ut(),d&&!k){if(h){let u;for(;u=Ue.pop();)t.lineTo(...ce(...u,-1))}t.closePath()}if(b>0&&t.stroke(),le>0){if(d){const u=k?Fe(ve>>1):0,g=k?Fe(ve):ze;t.moveTo(...ce(k?ve>>1:0,0)),t.arc(U,W,I,u,g,k?!De:!0)}else t.lineTo(nt,te),t.lineTo(_,te);t.globalAlpha=le,t.fill(),t.globalAlpha=1}if((Ve||d&&C)&&(Ue=[],t.beginPath(),ee.forEach((u,g)=>{let p=u.posX,P=u.peak[a],j=g?"lineTo":"moveTo";if(d&&p<0){const oe=ee[g+1];P=ki(p,P,oe.posX,oe.peak[a],0),p=0}P*=be,Ve?(t[j](...d?ce(p,P):[p,te-P]),d&&h&&!k&&Ue.push([p,P])):P>0&&dt(p,P,1,-2)}),Ve)){let u;for(;u=Ue.pop();)t.lineTo(...ce(...u,-1));t.lineWidth=1,t.stroke()}}t.restore(),k&&!d&&t.setTransform(1,0,0,1,0,0),(!k&&!V||a)&&Zt(a)}}if(ii(Rt/(yt<<Lt-1)),D&&(h&&!d&&!k&&(t.setTransform(-1,0,0,1,x.width-_,0),t.drawImage(x,_,0,U,x.height,0,0,U,x.height),t.setTransform(1,0,0,1,0,0)),t.setLineDash([]),ei()),this.showFPS){const a=E.height;t.font=`bold ${a}px ${it}`,t.fillStyle=gi,t.textAlign="right",t.fillText(Math.round(N),x.width-a,a*2)}this.onCanvasDraw&&(t.save(),t.fillStyle=t.strokeStyle=$[0],this.onCanvasDraw(this,{timestamp:e,canvasGradients:$}),t.restore())}_freqScaling(e){switch(this._frequencyScale){case qe:return Math.log2(e);case pt:return 26.81*e/(1960+e)-.53;case vt:return Math.log2(1+e/700);case Qe:return e}}_freqToBin(e,i="round"){const s=this._analyzer[0].frequencyBinCount-1,n=Math[i](e*this.fftSize/this.audioCtx.sampleRate);return n<s?n:s}_makeGrad(){if(!this._ready)return;const{canvas:e,_ctx:i,_radial:s,_reflexRatio:n}=this,{analyzerWidth:f,centerX:r,centerY:o,initialX:c,innerRadius:m,outerRadius:R}=this._aux,{isLumi:v}=this._flg,y=this._chLayout==Le,T=1-n,U=v?e.height:e.height*(1-n*!y)|0;for(const W of[0,1]){const z=this._gradients[this._selectedGrads[W]],B=z.colorStops,K=z.dir=="h";let _;if(s?_=i.createRadialGradient(r,o,R,r,o,m-(R-m)*y):_=i.createLinearGradient(...K?[c,0,c+f,0]:[0,0,0,U]),B){const I=y&&!this._splitGradient&&(!K||s);for(let ie=0;ie<1+I;ie++){const ee=B.length-1;B.forEach((x,$)=>{let q=x.pos;if(I&&(q/=2),y&&!v&&!s&&!K&&(q*=T,!I&&q>.5*T&&(q+=.5*n)),ie==1)if(s||v){const Q=ee-$;x=B[Q],q=1-x.pos/2}else $==0&&q>0&&_.addColorStop(.5,x.color),q+=.5;_.addColorStop(q,x.color),y&&$==ee&&q<.5&&_.addColorStop(.5,x.color)})}}this._canvasGradients[W]=_}}_normalizedB(e){const i=this._linearAmplitude,s=i?1/this._linearBoost:1,n=(c,m,R)=>c<=m?m:c>=R?R:c,f=c=>10**(c/20);let r=this.maxDecibels,o=this.minDecibels;return i&&(r=f(r),o=f(o),e=f(e)**s),n((e-o)/(r-o)**s,0,1)}_setCanvas(e){if(!this._ready)return;const{canvas:i,_ctx:s}=this,n=this._scaleX.canvas,f=window.devicePixelRatio/(this._loRes+1);let r=window.screen.width*f,o=window.screen.height*f;Math.abs(window.orientation)==90&&r<o&&([r,o]=[o,r]);const c=this.isFullscreen,m=c&&this._fsEl==i,R=m?r:(this._width||this._container.clientWidth||this._defaultWidth)*f|0,v=m?o:(this._height||this._container.clientHeight||this._defaultHeight)*f|0;this._pixelRatio=f,this._fsWidth=r,this._fsHeight=o,!(e!=Pt&&i.width==R&&i.height==v)&&(i.width=R,i.height=v,this.overlay||(s.fillStyle="#000",s.fillRect(0,0,R,v)),s.lineJoin="bevel",n.width=R,n.height=Math.max(20*f,Math.min(R,v)/32|0),this._calcBars(),this._makeGrad(),this._fsStatus!==void 0&&this._fsStatus!==c&&(e=qt),this._fsStatus=c,this.onCanvasResize&&this.onCanvasResize(e,this))}_setGradient(e,i){if(!this._gradients.hasOwnProperty(e))throw new fe(Ei,e);[0,1].includes(i)||(this._selectedGrads[1]=e,i=0),this._selectedGrads[i]=e,this._makeGrad()}_setProps(e,i){const s=["onCanvasDraw","onCanvasResize"],n=["gradientLeft","gradientRight","stereo"],f=Object.keys(Ke).filter(r=>r!="start").concat(s,n);(i||e===void 0)&&(e={...Ke,...e});for(const r of Object.keys(e))s.includes(r)&&typeof e[r]!="function"?this[r]=void 0:f.includes(r)&&(this[r]=e[r]);e.start!==void 0&&this.toggleAnalyzer(e.start)}}const Oi={class:"flex flex-col justify-center bg-black relative"},Di=["width","height"],Fi={key:0,class:"flex absolute top-2 left-20 top-4 z-100 text-white op-20 hover-op-100 transition"},Ni={key:0,class:"i-la-play"},Mi={key:1,class:"i-la-pause"},Gi={key:0,class:"i-la-arrow-left"},Hi={key:1,class:"i-la-arrow-down"},zi={key:0,class:"i-la-circle"},Pi={key:1,class:"i-la-dot-circle"},qi={key:2,class:"p-0 text-sm font-mono"},Xi={class:"absolute top-14 left-2 flex flex-col text-white items-center overscroll-none overflow-x-hidden overflow-y-scroll bg-dark-900 bg-op-20 backdrop-blur op-40 hover-op-100 transition"},Vi={class:"is-group flex flex-col gap-2"},Wi={class:"fixed overflow-clip text-white transition bottom-4 left-18 rounded-xl overflow-hidden"},Ui={class:"relative"},$i={__name:"PitchSpectrogram",setup(he){let e,i,s,n;const f=Be(),r=Be(),o=Be(),{width:c,height:m}=ri(),{toggle:R}=li(f),v=Be(!1),y=Be(!1),T=Be(0),U=Be(!1),W=Be(!1),z=Me("vertical",!1);Me("vertical",!1),ft([c,m],([h,l])=>{!r.value&&!i||(r.value.width=i.width=h,r.value.height=i.height=l,M())}),oi(()=>{si(),e=r.value.getContext("2d"),i=document.createElement("canvas"),s=i.getContext("2d"),i.width=c.value,i.height=m.value,M();const h=r.value.captureStream();o.value.srcObject=h,o.value.play().then(()=>{var l,A;return(A=(l=o.value)==null?void 0:l.requestPictureInPicture)==null?void 0:A.call(l)}).catch(l=>console.error(l))});const B=$e(Me("smoothing",.5),0,.9),K=$e(Me("frame",2),1,4),_=$e(Me("speed",1),1,4),I=$e(Me("steepness",10),3,30),ie=$e(Me("midpoint",.5),0,1);ft(K,h=>n&&(n.fftSize=Math.pow(2,11+h))),ft(B,h=>n&&(n.smoothing=h));function ee(){navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,autoGainControl:!0,noiseSuppression:!1},video:!1}).then(async h=>{n=new Ii(null,{mode:1,connectSpeakers:!1,volume:0,fftSize:8192,smoothing:B.value,useCanvas:!1,onCanvasDraw:w});const l=n.audioCtx.createMediaStreamSource(h);n.connectInput(l),W.value=!0}).catch(h=>{console.log("mic denied",h)})}let x,$;const q=()=>{x=document.createElement("canvas"),x.width=_.value,x.height=m.value,$=x.getContext("2d"),y.value=Date.now(),T.value=_.value,M()},Q=()=>{y.value=!1;const h=document.createElement("a");h.download="canvas_recording.png",h.href=x.toDataURL(),h.click()};let t,Y;const de=hi(),le=()=>{t=t||document.createElement("canvas"),Y=Y||t.getContext("2d");const h=T.value+_.value;t.width=h,t.height=x.height,Y.drawImage(x,0,0),x.width=h,$.drawImage(t,0,0),$.drawImage(r.value,c.value-_.value,0,_.value,m.value,T.value,0,_.value,m.value),T.value=h},N=h=>12*Math.log2(Number(h)/440),O=(h,l)=>`hsl(${N(h)*30}, ${l*100}%, ${l*75}%)`,b=h=>1/(1+Math.exp(-I.value*(h-ie.value))),w=h=>{if(v.value)return;s.drawImage(r.value,0,0,c.value,m.value,0,0,c.value,m.value);const l=h.getBars().map(se=>O(se.freq,b(se.value[0]))),A=c.value/l.length,d=m.value/l.length;l.forEach((se,C)=>{const[D,L,E,G]=z.value?[C*A,0,A,_.value]:[c.value-_.value,m.value-(C+1)*d,_.value,d];e.fillStyle=se,e.fillRect(D,L,E,G)}),e.translate(z.value?0:-_.value,z.value?_.value:0),e.drawImage(i,0,0,c.value,m.value,0,0,c.value,m.value),e.setTransform(1,0,0,1,0,0),y.value&&le()};function M(){e.fillStyle="#000",e.fillRect(0,0,c.value,m.value)}return bt(" ",h=>{h.preventDefault(),v.value=!v.value}),bt("Enter",h=>{h.preventDefault(),M()}),(h,l)=>{const A=ai;return Re(),ye("div",Oi,[Z("div",{class:"fullscreen-container",id:"screen",ref_key:"screen",ref:f},[Z("canvas",{class:"max-w-full",id:"spectrogram",ref_key:"canvasElement",ref:r,width:me(c),height:me(m)},null,8,Di),W.value?_t("",!0):(Re(),ye("button",{key:0,class:"absolute m-auto top-0 w-full h-full text-white text-2xl",title:"Press anywhere to start",onClick:l[0]||(l[0]=d=>ee())},"START"))],512),W.value?(Re(),ye("div",Fi,[Z("button",{class:"text-xl select-none cursor-pointer",onPointerdown:l[1]||(l[1]=d=>v.value=!v.value)},[v.value?(Re(),ye("div",Ni)):(Re(),ye("div",Mi))],32),Z("button",{class:"text-xl select-none cursor-pointer",onPointerdown:l[2]||(l[2]=d=>z.value=!me(z))},[me(z)?(Re(),ye("div",Hi)):(Re(),ye("div",Gi))],32),Z("button",{class:"text-xl select-none cursor-pointer",onPointerdown:l[3]||(l[3]=d=>M())},l[12]||(l[12]=[Z("div",{class:"i-la-trash-alt"},null,-1)]),32),Z("button",{class:ci(["text-xl select-none cursor-pointer flex items-center gap-1",{"text-red":y.value}]),onPointerdown:l[4]||(l[4]=d=>y.value?Q():q())},[y.value?(Re(),ye("div",Pi)):(Re(),ye("div",zi)),y.value&&T.value?(Re(),ye("div",qi,At(T.value)+"px ("+At(((me(de)-y.value)/1e3).toFixed(1))+"s)",1)):_t("",!0)],34)])):_t("",!0),Ct(Z("div",Xi,[Z("div",Vi,[Ye(A,{modelValue:me(_),"onUpdate:modelValue":l[5]||(l[5]=d=>je(_)?_.value=d:null),min:1,max:5,step:1,fixed:0,param:"SPEED"},null,8,["modelValue"]),Ye(A,{modelValue:me(K),"onUpdate:modelValue":l[6]||(l[6]=d=>je(K)?K.value=d:null),min:1,max:4,step:1,fixed:0,param:"FRAME"},null,8,["modelValue"]),Ye(A,{modelValue:me(I),"onUpdate:modelValue":l[7]||(l[7]=d=>je(I)?I.value=d:null),min:3,max:30,step:1e-4,fixed:2,param:"CONTRAST"},null,8,["modelValue"]),Ye(A,{modelValue:me(ie),"onUpdate:modelValue":l[8]||(l[8]=d=>je(ie)?ie.value=d:null),min:0,max:1,step:1e-4,param:"MIDPOINT",fixed:2},null,8,["modelValue"]),Ye(A,{modelValue:me(B),"onUpdate:modelValue":l[9]||(l[9]=d=>je(B)?B.value=d:null),min:0,max:1,step:1e-4,param:"SMOOTH",fixed:2},null,8,["modelValue"])]),l[15]||(l[15]=Z("div",{class:"flex-1"},null,-1)),Z("button",{class:"top-4 right-4 text-xl select-none cursor-pointer transition",style:di({opacity:U.value?1:.2}),onPointerdown:l[10]||(l[10]=d=>U.value=!U.value)},l[13]||(l[13]=[Z("div",{class:"i-la-external-link-square-alt"},null,-1)]),36),Z("button",{class:"text-xl select-none cursor-pointer",onPointerdown:l[11]||(l[11]=d=>me(R)())},l[14]||(l[14]=[Z("div",{class:"i-la-expand"},null,-1)]),32)],512),[[Tt,W.value]]),Ct(Z("div",Wi,[Z("div",Ui,[l[16]||(l[16]=Z("div",{class:"absolute p-2 opacity-70 touch-none select-none text-md"},"Right click here to enter Picture-In-Picture mode",-1)),Z("video",{class:"max-h-50 max-w-full",ref_key:"video",ref:o},null,512)])],512),[[Tt,U.value]])])}}},Ki=ni($i,[["__scopeId","data-v-168ffec3"]]);export{Ki as default};
