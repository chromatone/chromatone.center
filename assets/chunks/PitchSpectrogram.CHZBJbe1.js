import{r as f,P as w,b as E,c as P,u as m,o as D,W as I,v as c,x as u,z as l,B as $,M as B,H as R,E as A,X as x,_ as U}from"./framework.C3BURm3f.js";import{aT as q,H as O,aU as T,aV as z,aG as H,an as N}from"./theme.CrbMhUYh.js";import{_ as j}from"./ControlStart.DFGBqsN9.js";const F={class:"flex flex-col justify-center"},G={class:"fullscreen-container text-white max-h-90svh",id:"screen"},L=["width","height"],W={class:"absolute top-4 left-4 text-xl select-none"},K={key:0,class:"i-la-play"},X={key:1,class:"i-la-pause"},J={key:0,class:"i-la-arrow-left"},Q={key:1,class:"i-la-arrow-down"},Y=l("div",{class:"i-la-trash-alt"},null,-1),Z=[Y],ee={class:"flex items-center gap-2 px-2 flex-wrap"},te={class:"is-group flex flex-wrap gap-2 flex-1 p-2"},se={class:"max-w-120 scale-75 max-h-60 overflow-clip relative text-white"},oe=l("div",{class:"absolute p-2 opacity-70 touch-none select-none text-md"},"Right click here to enter Picture-In-Picture mode",-1),re={__name:"PitchSpectrogram",setup(ae){const y=f(),p=f(),{mic:b,input:k}=q(),i=f(!1);w(" ",o=>{i.value=!i.value,o.preventDefault()}),w("Enter",o=>{_(),o.preventDefault()});let h,a,d,v;function _(){a.fillStyle="#000",a.fillRect(0,0,e.width,e.height)}const e=E({initiated:!1,width:1600,height:1600,speed:P(()=>Math.floor(e.speedCount/100)),speedCount:O(100,100,500),vertical:m("spectrogram-vertical",!1),pow:m("spectrogram-power",1),offset:m("spectrogram-offset",0)});function C(o){o.tap&&(i.value=!i.value),e.speedCount-=o.delta[0]/2}D(()=>{T(),h=document.getElementById("spectrogram"),a=h.getContext("2d"),d=document.createElement("canvas"),v=d.getContext("2d"),d.width=e.width,d.height=e.height,a.fillStyle="#000",a.fillRect(0,0,e.width,e.height);const o=h.captureStream();p.value.srcObject=o,p.value.play().then(()=>{var t,s;return(s=(t=p.value)==null?void 0:t.requestPictureInPicture)==null?void 0:s.call(t)}).catch(t=>console.error(t))});let g;function M(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(async()=>{const{AudioMotionAnalyzer:o}=await U(async()=>{const{AudioMotionAnalyzer:t}=await import("./audioMotion-analyzer.7XoESQPH.js");return{AudioMotionAnalyzer:t}},[]);g=new o(null,{mode:1,connectSpeakers:!1,volume:0,useCanvas:!1,source:z.meter,onCanvasDraw(t){if(i.value)return;v.drawImage(h,0,0,e.width,e.height);let s=t.getBars();for(let n=0;n<s.length;n++)a.fillStyle=S((s[n].freqLo+s[n].freqHi)/2,s[n].value[0]),e.vertical?a.fillRect(n*(e.width/s.length),0,e.width/s.length,e.speed):a.fillRect(e.width-e.speed,e.height-(n+1)*(e.height/s.length),e.speed,e.height/s.length);e.vertical?a.translate(0,e.speed):a.translate(-e.speed,0),a.drawImage(d,0,0,e.width,e.height),a.setTransform(1,0,0,1,0,0)}}),e.initiated=!0,b.open=!0,g.connectInput(k)}).catch(o=>{console.log("mic denied",o)})}function S(o,t){let s=Math.pow(t+e.offset,e.pow);return`hsl(${H(o)*30}, ${s*100}%, ${s*70}%)`}return(o,t)=>{const s=j,n=N,V=I("drag");return c(),u("div",F,[l("div",G,[$(l("canvas",{class:"h-full min-h-70svh w-full cursor-pointer",id:"spectrogram",ref_key:"canvasElement",ref:y,width:e.width,height:e.height},null,8,L),[[V,C]]),e.initiated?R("",!0):(c(),B(s,{key:0,class:"absolute",onClick:t[0]||(t[0]=r=>M())})),l("div",W,"x"+A(e.speed),1),l("button",{class:"absolute bottom-4 left-4 text-xl select-none cursor-pointer",onMousedown:t[1]||(t[1]=r=>i.value=!i.value)},[i.value?(c(),u("div",K)):(c(),u("div",X))],32),l("button",{class:"absolute bottom-4 right-4 text-xl select-none cursor-pointer",onMousedown:t[2]||(t[2]=r=>e.vertical=!e.vertical)},[e.vertical?(c(),u("div",Q)):(c(),u("div",J))],32),l("button",{class:"absolute top-4 right-4 text-xl select-none cursor-pointer",onMousedown:t[3]||(t[3]=r=>_())},Z,32)]),l("div",ee,[l("div",te,[x(n,{modelValue:e.pow,"onUpdate:modelValue":t[4]||(t[4]=r=>e.pow=r),min:1,max:10,step:1,fixed:0,param:"POW"},null,8,["modelValue"]),x(n,{modelValue:e.offset,"onUpdate:modelValue":t[5]||(t[5]=r=>e.offset=r),min:-.5,max:.5,step:1e-4,param:"OFFSET",fixed:2},null,8,["modelValue"])]),l("div",se,[oe,l("video",{class:"max-h-50",ref_key:"video",ref:p},null,512)])])])}}};export{re as default};
