import{_ as V,r as _,R as j,c as E,d as D,f as b,g as $,h as i,F,j as R,p as N,m as B,n as T,l as z,q as W,k as H,D as q,ah as X,$ as Y,z as G,A as J}from"./framework.B7TlvOs3.js";import{H as K,g as k,n as g,aj as Q,x as Z,z as ee}from"./theme.DO9Zxf3P.js";function te(l,o,n){l/=255,o/=255,n/=255;const c=Math.max(l,o,n),u=Math.min(l,o,n);let a,r,f=(c+u)/2;if(c===u)a=r=0;else{const d=c-u;switch(r=f>.5?d/(2-c-u):d/(c+u),c){case l:a=(o-n)/d+(o<n?6:0);break;case o:a=(n-l)/d+2;break;case n:a=(l-o)/d+4;break}a/=6}return[a,r,f]}function ae(l,o=5){const n=new Map;for(let a=0;a<l.length;a+=4){const r=l[a],f=l[a+1],d=l[a+2],[m,w,p]=te(r,f,d),C=ne(m);if(C!==-1){const h=C;n.has(h)||n.set(h,{count:0,s:0,l:0});const I=n.get(h);I.count++,I.s+=w,I.l+=p}}const c=Array.from(n.entries()).sort((a,r)=>r[1].count-a[1].count).slice(0,o).map(([a,{count:r,s:f,l:d}])=>({hueIndex:a,s:f/r,l:d/r,percent:r/(l.length/4)*100})),u=c.reduce((a,r)=>a+r.percent,0);return c.map(a=>({...a,percent:a.percent/u*100}))}function ne(l){const o=l*360;for(let n=0;n<12;n++){const c=n*30,u=(c-15+360)%360,a=(c+15)%360;if(u>a){if(o>=u||o<a)return n}else if(o>=u&&o<a)return n}return-1}const y=l=>(G("data-v-315c49bd"),l=l(),J(),l),se={class:"container mx-auto"},oe={key:0,class:"relative w-90vw h-90vh overflow-hidden"},le={class:"text-xs font-bold text-white text-shadow p-1"},ce={class:"p-4 flex flex-wrap gap-2"},ie={class:"m-0"},re=y(()=>i("label",{class:"cursor-pointer bg-blue-500 hover-bg-blue-600 text-white font-bold py-2 px-4 rounded",for:"fileInput"},"Load Image",-1)),ue={class:"m-0"},de=y(()=>i("label",{class:"mr-2"},"Scan direction:",-1)),he=y(()=>i("option",{value:"horizontal"},"Horizontal",-1)),ve=y(()=>i("option",{value:"vertical"},"Vertical",-1)),fe=[he,ve],me={class:"m-0"},pe=y(()=>i("label",{class:"mr-2"},"Color count:",-1)),xe={class:"ml-2"},_e={__name:"PixelSort",setup(l){const o=_(null),n=_("horizontal"),c=_(null),{elementX:u,elementY:a,isOutside:r,elementHeight:f,elementWidth:d}=j(c),m=K(_(5),1,7),w=_([]),p=_(20);function C(e,t=1){return[...e.slice(t,e.length),...e.slice(0,t)]}const h=E(()=>{if(!k.value||!k.value.chroma)return[1,1,1,1,1,1,1,1,1,1,1,1];const e=k.value.chroma.split("").map(Number);return C(e,-g.indexOf(k.value.tonic||"C"))});function I(e,t){const s=g.indexOf(e);if(h.value.map((O,P)=>O?g[P]:null).filter(Boolean),h.value[s])return`${e}${t}`;let v=s,x=s;for(;!h.value[v]&&!h.value[x];){if(v=(v-1+12)%12,x=(x+1)%12,h.value[v])return`${g[v]}${t}`;if(h.value[x])return`${g[x]}${t}`}return`${e}${t}`}function L(e){const t=e.target.files[0];t&&(o.value=URL.createObjectURL(t))}function U(e,t,s,v){return(v==="horizontal"?e.getImageData(0,s*e.canvas.height-p.value/2,e.canvas.width,p.value):e.getImageData(t*e.canvas.width-p.value/2,0,p.value,e.canvas.height)).data}function A(e,t,s){return`hsl(${e*30%360}, ${t*100}%, ${s*100}%)`}function S(e,t){const s=g[e],v=Math.floor(t*3)-1+3+Q.offset;return I(s,v)}D([u,a],()=>{if(r.value||!c.value)return;const e=c.value.getContext("2d"),t=U(e,u.value/d.value,a.value/f.value,n.value);w.value=ae(t,m.value)}),D(o,async()=>{if(o.value){const e=new Image;e.src=o.value,await e.decode();const t=c.value;t.getContext("2d").drawImage(e,0,0,t.width,t.height)}});function M(e){const t=w.value.map(s=>S(s.hueIndex,s.l));Z(t),setTimeout(()=>{ee(t)},200)}return(e,t)=>(b(),$("div",se,[o.value?(b(),$("div",oe,[i("canvas",{class:"w-full h-full max-w-screen max-h-full",ref_key:"canvasElement",ref:c,width:"1200",height:"1200"},null,512),i("div",{class:T(["absolute flex",{"w-full h-5":n.value==="horizontal","h-full w-5 flex-col":n.value==="vertical"}]),onMousedown:M,onTouchstart:M,style:N(n.value==="horizontal"?`top: ${Math.max(0,z(a)-p.value/2)}px`:"left: 0px")},[(b(!0),$(F,null,R(w.value,s=>(b(),$("div",{class:"relative flex items-center justify-center",key:s.hueIndex,style:N({flex:`1 1 ${s.percent}%`,backgroundColor:A(s.hueIndex,s.s,s.l)})},[i("span",le,B(S(s.hueIndex,s.l)),1)],4))),128))],38)])):W("",!0),i("div",ce,[i("div",ie,[re,i("input",{class:"hidden",id:"fileInput",type:"file",accept:"image/*",onChange:L},null,32)]),i("div",ue,[de,H(i("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s)},fe,512),[[q,n.value]])]),i("div",me,[pe,H(i("input",{type:"range","onUpdate:modelValue":t[1]||(t[1]=s=>Y(m)?m.value=s:null),min:"1",max:"7",step:"1"},null,512),[[X,z(m)]]),i("span",xe,B(z(m)),1)])])]))}},Ie=V(_e,[["__scopeId","data-v-315c49bd"]]);export{Ie as default};
