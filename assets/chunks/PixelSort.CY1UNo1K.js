import{_ as V,r as g,a5 as A,G as E,J as D,c as I,h as b,i as r,F,Q as R,l as N,B as S,m as T,u as k,k as j,R as B,ai as W,ab as q,aj as G}from"./framework.DqGUeSFU.js";import{D as J,g as $,n as w,ag as Q,v as X,y as Y}from"./theme.DkSlrVce.js";function K(i,s,n){i/=255,s/=255,n/=255;const o=Math.max(i,s,n),c=Math.min(i,s,n);let a,u,m=(o+c)/2;if(o===c)a=u=0;else{const d=o-c;switch(u=m>.5?d/(2-o-c):d/(o+c),o){case i:a=(s-n)/d+(s<n?6:0);break;case s:a=(n-i)/d+2;break;case n:a=(i-s)/d+4;break}a/=6}return[a,u,m]}function Z(i,s=5){const n=new Map;for(let a=0;a<i.length;a+=4){const u=i[a],m=i[a+1],d=i[a+2],[h,y,p]=K(u,m,d),C=ee(h);if(C!==-1){const v=C;n.has(v)||n.set(v,{count:0,s:0,l:0});const _=n.get(v);_.count++,_.s+=y,_.l+=p}}const o=Array.from(n.entries()).sort((a,u)=>u[1].count-a[1].count).slice(0,s).map(([a,{count:u,s:m,l:d}])=>({hueIndex:a,s:m/u,l:d/u,percent:u/(i.length/4)*100})),c=o.reduce((a,u)=>a+u.percent,0);return o.map(a=>({...a,percent:a.percent/c*100}))}function ee(i){const s=i*360;for(let n=0;n<12;n++){const o=n*30,c=(o-15+360)%360,a=(o+15)%360;if(c>a){if(s>=c||s<a)return n}else if(s>=c&&s<a)return n}return-1}const te={class:"container mx-auto"},ae={key:0,class:"relative w-90vw h-90vh overflow-hidden"},ne={class:"text-xs font-bold text-white text-shadow p-1"},le={class:"p-4 flex flex-wrap gap-2"},se={class:"m-0"},oe={class:"m-0"},re={class:"m-0"},ie={class:"ml-2"},ue={__name:"PixelSort",setup(i){const s=g(null),n=g("horizontal"),o=g(null),{elementX:c,elementY:a,isOutside:u,elementHeight:m,elementWidth:d}=A(o),h=J(g(5),1,7),y=g([]),p=g(20);function C(t,e=1){return[...t.slice(e,t.length),...t.slice(0,e)]}const v=E(()=>{if(!$.value||!$.value.chroma)return[1,1,1,1,1,1,1,1,1,1,1,1];const t=$.value.chroma.split("").map(Number);return C(t,-w.indexOf($.value.tonic||"C"))});function _(t,e){const l=w.indexOf(t);if(v.value.map((O,P)=>O?w[P]:null).filter(Boolean),v.value[l])return`${t}${e}`;let f=l,x=l;for(;!v.value[f]&&!v.value[x];){if(f=(f-1+12)%12,x=(x+1)%12,v.value[f])return`${w[f]}${e}`;if(v.value[x])return`${w[x]}${e}`}return`${t}${e}`}function L(t){const e=t.target.files[0];e&&(s.value=URL.createObjectURL(e))}function U(t,e,l,f){return(f==="horizontal"?t.getImageData(0,l*t.canvas.height-p.value/2,t.canvas.width,p.value):t.getImageData(e*t.canvas.width-p.value/2,0,p.value,t.canvas.height)).data}function H(t,e,l){return`hsl(${t*30%360}, ${e*100}%, ${l*100}%)`}function M(t,e){const l=w[t],f=Math.floor(e*3)-1+3+Q.offset;return _(l,f)}D([c,a],()=>{if(u.value||!o.value)return;const t=o.value.getContext("2d"),e=U(t,c.value/d.value,a.value/m.value,n.value);y.value=Z(e,h.value)}),D(s,async()=>{if(s.value){const t=new Image;t.src=s.value,await t.decode();const e=o.value;e.getContext("2d").drawImage(t,0,0,e.width,e.height)}});function z(t){const e=y.value.map(l=>M(l.hueIndex,l.l));X(e),setTimeout(()=>{Y(e)},200)}return(t,e)=>(I(),b("div",te,[s.value?(I(),b("div",ae,[r("canvas",{class:"w-full h-full max-w-screen max-h-full",ref_key:"canvasElement",ref:o,width:"1200",height:"1200"},null,512),r("div",{class:T(["absolute flex",{"w-full h-5":n.value==="horizontal","h-full w-5 flex-col":n.value==="vertical"}]),onMousedown:z,onTouchstart:z,style:N(n.value==="horizontal"?`top: ${Math.max(0,k(a)-p.value/2)}px`:"left: 0px")},[(I(!0),b(F,null,R(y.value,l=>(I(),b("div",{class:"relative flex items-center justify-center",key:l.hueIndex,style:N({flex:`1 1 ${l.percent}%`,backgroundColor:H(l.hueIndex,l.s,l.l)})},[r("span",ne,S(M(l.hueIndex,l.l)),1)],4))),128))],38)])):j("",!0),r("div",le,[r("div",se,[e[2]||(e[2]=r("label",{class:"cursor-pointer bg-blue-500 hover-bg-blue-600 text-white font-bold py-2 px-4 rounded",for:"fileInput"},"Load Image",-1)),r("input",{class:"hidden",id:"fileInput",type:"file",accept:"image/*",onChange:L},null,32)]),r("div",oe,[e[4]||(e[4]=r("label",{class:"mr-2"},"Scan direction:",-1)),B(r("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l)},e[3]||(e[3]=[r("option",{value:"horizontal"},"Horizontal",-1),r("option",{value:"vertical"},"Vertical",-1)]),512),[[W,n.value]])]),r("div",re,[e[5]||(e[5]=r("label",{class:"mr-2"},"Color count:",-1)),B(r("input",{type:"range","onUpdate:modelValue":e[1]||(e[1]=l=>G(h)?h.value=l:null),min:"1",max:"7",step:"1"},null,512),[[q,k(h)]]),r("span",ie,S(k(h)),1)])])]))}},ve=V(ue,[["__scopeId","data-v-3b278704"]]);export{ve as default};
