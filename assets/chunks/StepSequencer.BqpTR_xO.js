import{a_ as L,R as W,n as X,g as P,bf as G,aS as J,bg as Q,bh as Y,bi as Z,a8 as tt,u as et,aT as T,bj as ot,aI as at,c as k,ak as _,l as st,aq as nt}from"./theme.C7l8iKW5.js";import{_ as rt,e as it,r as lt,b as E,u as g,c as V,L as ut,w as pt,o as dt,d as y,N as mt,S as vt,f as u,g as p,h as l,F as M,j as q,p as $,l as b,m as O,n as B,X as j,k as d,U as c,B as ft,au as gt,q as A}from"./framework.Ce66O8ev.js";const bt={class:"flex flex-col"},yt=["id","onMousedown","onMouseenter"],ct={class:"info p-2 flex flex-wrap items-center justify-center mx-2 gap-4"},xt={class:"flex flex-wrap items-center justify-center bg-light-900 p-4 rounded-2xl dark-bg-dark-800 gap-2",style:{flex:"5 1 300px"}},kt=["value"],wt={class:"is-group flex flex-wrap p-2"},Vt={class:"is-group flex items-center"},ht={class:"is-group flex items-center"},Ct={__name:"StepSequencer",setup(St){const{isDark:D}=it(),R=L(),U=W(),h=lt(0),e=E({started:!1,playing:!1,hover:!1,mounted:!1,current:0,octave:g("seq-octave",3),bpm:g("seq-bpm",120),steps:g("seq-steps",16),type:g("seq-type","up"),probability:g("seq-prob",1),humanize:g("seq-human",!1),interval:g("seq-interval","8n"),note:V(()=>X[P.tonic]),range:V(()=>G(e.note+e.octave+" "+P.set.name)(e.note+e.octave,e.note+(e.octave+2)).map(o=>J(o)).reverse()),midi:V(()=>e.range.map(o=>Q(o))),pitches:V(()=>e.midi.map(o=>(o+3)%12)),progress:0}),I=["up","down","upDown","downUp","alternateUp","alternateDown","random","randomWalk","randomOnce"],r=E([]),x=E([]);let m=[];ut(" ",o=>{o.preventDefault(),e.playing=!e.playing}),pt(()=>{e.range.forEach((o,t)=>{r[t]=r[t]||[],r[t].length=e.steps,r.length=e.range.length,Array.apply(null,r[t]).forEach((a,n)=>{r[t][n]={row:t,cell:n,note:o,active:(a==null?void 0:a.active)||!1}})})}),dt(()=>{e.mounted=!0,Y(),C()}),y(h,o=>{Z.volume.setValueAtTime(o,0)}),y(()=>e.steps,()=>{e.mounted&&C()},{immediate:!0});function C(){m.forEach(o=>{o.stop(0),o.dispose()}),m=[],r.forEach((o,t)=>{m[t]=new tt((f,a)=>{R.schedule(()=>{x[t]=a==null?void 0:a.cell,a!=null&&a.active&&(et(a==null?void 0:a.note),T(a.note.slice(0,-1),a.note.slice(-1)-4),setTimeout(()=>{T(a.note.slice(0,-1),a.note.slice(-1)-4,!0)},200))},f),a!=null&&a.active&&ot(a.note,e.interval,f)},r[t],e.type).start(0),m[t].interval=e.interval})}let z;function N(o,t,f,a){!e.hover&&!f||!f&&z==a.target.id||(z=a.target.id,r[o][t].active?r[o][t].active=!1:r[o][t].active=!0)}function F(){r.forEach((o,t)=>{o.forEach((f,a)=>r[t][a].active=!1)})}y(()=>e.playing,o=>{o?(m.forEach(t=>{t.start(0)}),U.start(),e.started||(at(),e.started=!0)):(m.forEach(t=>{t.stop()}),U.stop())}),y(()=>e.type,o=>{m.forEach(t=>{t.pattern=o})},{immediate:!0}),y(()=>e.probability,o=>{m.forEach(t=>{t.probability=o})},{immediate:!0}),y(()=>e.humanize,o=>{m.forEach(t=>{t.humanize=o})},{immediate:!0});function H(){e.playing=!1,C()}mt(()=>{m.forEach(o=>{o.stop(0),o.dispose()})});function K(o,t){return o.active?k(e.pitches[t]):o.cell==x[t]?D.value?"#eee7":"#3337":"#4444"}return(o,t)=>{const f=st,a=nt,n=vt("tooltip");return u(),p("div",bt,[l("div",{class:"rows sticky top-2 h-96svh",onMousedown:t[0]||(t[0]=s=>e.hover=!0),onMouseleave:t[1]||(t[1]=j(s=>e.hover=!1,["self"])),onMouseup:t[2]||(t[2]=s=>e.hover=!1)},[(u(!0),p(M,null,q(r,(s,i)=>(u(),p("div",{class:"row",key:s},[l("div",{class:"title m-1 rounded-md shadow",style:$({color:b(k)(e.pitches[i]),backgroundColor:e.range[i].length>2?"#0005":"#aaa5"})},O(e.range[i]),5),(u(!0),p(M,null,q(s,(v,w)=>(u(),p("div",{class:B(["cell",{active:v==null?void 0:v.active,current:v.cell==x[i]}]),id:`c${i}-${w}`,key:v,style:$({color:b(k)(e.pitches[i]),borderColor:K(v,i),backgroundColor:v.cell==x[i]?v.active?b(k)(e.pitches[i],3):b(D)?"#0005":"#fff5":"transparent",marginRight:w%4==3?"12px":"1px"}),onMousedown:j(S=>N(i,w,!0,S),["prevent"]),onMouseenter:S=>N(i,w,!1,S)},[l("div",{class:"dot",style:$({backgroundColor:v.active?b(k)(e.pitches[i]):v.cell==x[i]?"currentColor":"#4448"})},null,4)],46,yt))),128))]))),128))],32),l("div",ct,[d(c(f,{style:{flex:"1 1 100px"}},null,512),[[n,"Select root note and scale",void 0,{top:!0}]]),l("div",xt,[d((u(),p("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>e.type=s)},[(u(),p(M,null,q(I,s=>l("option",{key:s,value:s},O(s),9,kt)),64))])),[[ft,e.type],[n,"Pattern type",void 0,{top:!0}]]),l("div",wt,[d(c(a,{modelValue:e.octave,"onUpdate:modelValue":t[4]||(t[4]=s=>e.octave=s),max:4,min:2,fixed:0,param:"OCTAVE"},null,8,["modelValue"]),[[n,"Octave",void 0,{top:!0}]]),d(c(a,{modelValue:e.steps,"onUpdate:modelValue":t[5]||(t[5]=s=>e.steps=s),max:32,min:4,step:1,fixed:0,param:"steps"},null,8,["modelValue"]),[[n,"Number of steps",void 0,{top:!0}]]),d(c(a,{modelValue:e.probability,"onUpdate:modelValue":t[6]||(t[6]=s=>e.probability=s),max:1,min:0,step:.01,fixed:2,param:"prob"},null,8,["modelValue"]),[[n,"Probability",void 0,{top:!0}]]),d(c(a,{modelValue:b(_).bpm,"onUpdate:modelValue":t[7]||(t[7]=s=>b(_).bpm=s),step:1,max:400,min:10,fixed:0,param:"BPM"},null,8,["modelValue"]),[[n,"Set tempo",void 0,{top:!0}]])]),l("div",Vt,[d(c(a,{modelValue:h.value,"onUpdate:modelValue":t[8]||(t[8]=s=>h.value=s),step:.1,max:10,min:-20,fixed:0,param:"PIANO"},null,8,["modelValue"]),[[n,"Set piano volume",void 0,{top:!0}]]),d((u(),p("button",{class:B(["text-button",{active:e.humanize}]),onClick:t[9]||(t[9]=s=>e.humanize=!e.humanize)},t[14]||(t[14]=[gt("HMN")]),2)),[[n,"Humanize rhythm",void 0,{bottom:!0}]]),d((u(),p("button",{class:"text-button",onClick:t[10]||(t[10]=s=>F())},t[15]||(t[15]=[l("div",{class:"i-la-trash-alt"},null,-1)]))),[[n,"Clear pattern",void 0,{bottom:!0}]])]),l("div",ht,[e.playing?A("",!0):d((u(),p("button",{key:0,class:"text-button",onClick:t[11]||(t[11]=s=>e.playing=!0)},t[16]||(t[16]=[l("div",{class:"i-la-play"},null,-1)]))),[[n,"Play",void 0,{bottom:!0}]]),e.playing?d((u(),p("button",{key:1,class:"text-button",onClick:t[12]||(t[12]=s=>e.playing=!1)},t[17]||(t[17]=[l("div",{class:"i-la-pause"},null,-1)]))),[[n,"Pause",void 0,{bottom:!0}]]):A("",!0),d((u(),p("button",{class:"text-button",onClick:t[13]||(t[13]=s=>H())},t[18]||(t[18]=[l("div",{class:"i-la-stop"},null,-1)]))),[[n,"Stop",void 0,{bottom:!0}]])])])])])}}},qt=rt(Ct,[["__scopeId","data-v-1538ec46"]]);export{qt as default};
