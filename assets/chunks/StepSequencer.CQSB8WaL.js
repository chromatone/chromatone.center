import{bh as I,V as K,u as c,bu as L,bv as W,g as U,bw as Y,n as Z,b1 as G,aa as J,e as Q,c as y,aB as X,ar as ee,O as N,aO as te}from"./theme.DKUtGHOP.js";import{_ as oe,a4 as ae,D as E,M as k,S as se,o as ne,I as x,a2 as le,a1 as re,q as u,f as p,s as i,F as M,Y as S,v as D,u as b,z as O,a3 as P,y as B,Z as d,l as w,aa as ie,aw as ue,t as T}from"./framework.Bbwy4zmA.js";const pe={class:"flex flex-col"},de=["id","onMousedown","onMouseenter"],me={class:"info p-2 flex flex-wrap items-center justify-center mx-2 gap-4"},ve={class:"flex flex-wrap items-center justify-center bg-light-900 p-4 rounded-2xl dark-bg-dark-800 gap-2",style:{flex:"5 1 300px"}},fe=["value"],ce={class:"is-group flex flex-wrap p-2"},be={class:"is-group flex items-center"},ge={class:"is-group flex items-center"},ye={__name:"StepSequencer",setup(xe){const{isDark:$}=ae(),R=I(),q=K(),t=E({started:!1,playing:!1,hover:!1,mounted:!1,current:0,octave:c("seq-octave",3),bpm:c("seq-bpm",120),steps:c("seq-steps",16),type:c("seq-type","up"),probability:c("seq-prob",1),humanize:c("seq-human",!1),interval:c("seq-interval","8n"),note:k(()=>Z[U.tonic]),range:k(()=>W(t.note+t.octave+" "+U.set.name)(t.note+t.octave,t.note+(t.octave+2)).map(o=>Y(o)).reverse()),midi:k(()=>t.range.map(o=>L(o))),pitches:k(()=>t.midi.map(o=>(o+3)%12)),progress:0}),j=["up","down","upDown","downUp","alternateUp","alternateDown","random","randomWalk","randomOnce"],n=E([]),g=E([]);let m=[];G(" ",o=>{o.preventDefault(),t.playing=!t.playing}),se(()=>{t.range.forEach((o,e)=>{n[e]=n[e]||[],n[e].length=t.steps,n.length=t.range.length,Array.apply(null,n[e]).forEach((s,l)=>{n[e][l]={row:e,cell:l,note:o,active:s?.active||!1}})})}),ne(()=>{t.mounted=!0,V()}),x(()=>t.steps,()=>{t.mounted&&V()},{immediate:!0});function V(){m.forEach(o=>{o.stop(0),o.dispose()}),m=[],n.forEach((o,e)=>{m[e]=new J((v,s)=>{R.schedule(()=>{g[e]=s?.cell,s?.active&&Q(s?.note)},v)},n[e],t.type).start(0),m[e].interval=t.interval})}let z;function _(o,e,v,s){!t.hover&&!v||!v&&z==s.target.id||(z=s.target.id,n[o][e].active?n[o][e].active=!1:n[o][e].active=!0)}function A(){n.forEach((o,e)=>{o.forEach((v,s)=>n[e][s].active=!1)})}x(()=>t.playing,o=>{o?(m.forEach(e=>{e.start(0)}),q.start(),t.started||(te(),t.started=!0)):(m.forEach(e=>{e.stop()}),q.stop())}),x(()=>t.type,o=>{m.forEach(e=>{e.pattern=o})},{immediate:!0}),x(()=>t.probability,o=>{m.forEach(e=>{e.probability=o})},{immediate:!0}),x(()=>t.humanize,o=>{m.forEach(e=>{e.humanize=o})},{immediate:!0});function F(){t.playing=!1,V()}le(()=>{m.forEach(o=>{o.stop(0),o.dispose()})});function H(o,e){return o.active?y(t.pitches[e]):o.cell==g[e]?$.value?"#eee7":"#3337":"#4444"}return(o,e)=>{const v=X,s=ee,l=re("tooltip");return p(),u("div",pe,[i("div",{class:"rows sticky top-2 h-96svh",onMousedown:e[0]||(e[0]=a=>t.hover=!0),onMouseleave:e[1]||(e[1]=P(a=>t.hover=!1,["self"])),onMouseup:e[2]||(e[2]=a=>t.hover=!1)},[(p(!0),u(M,null,S(n,(a,r)=>(p(),u("div",{class:"row",key:a},[i("div",{class:"title m-1 rounded-md shadow",style:D({color:b(y)(t.pitches[r]),backgroundColor:t.range[r].length>2?"#0005":"#aaa5"})},O(t.range[r]),5),(p(!0),u(M,null,S(a,(f,h)=>(p(),u("div",{class:B(["cell",{active:f?.active,current:f.cell==g[r]}]),id:`c${r}-${h}`,key:f,style:D({color:b(y)(t.pitches[r]),borderColor:H(f,r),backgroundColor:f.cell==g[r]?f.active?b(y)(t.pitches[r],3):b($)?"#0005":"#fff5":"transparent",marginRight:h%4==3?"12px":"1px"}),onMousedown:P(C=>_(r,h,!0,C),["prevent"]),onMouseenter:C=>_(r,h,!1,C)},[i("div",{class:"dot",style:D({backgroundColor:f.active?b(y)(t.pitches[r]):f.cell==g[r]?"currentColor":"#4448"})},null,4)],46,de))),128))]))),128))],32),i("div",me,[d(w(v,{style:{flex:"1 1 100px"}},null,512),[[l,"Select root note and scale",void 0,{top:!0}]]),i("div",ve,[d((p(),u("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>t.type=a)},[(p(),u(M,null,S(j,a=>i("option",{key:a,value:a},O(a),9,fe)),64))])),[[ie,t.type],[l,"Pattern type",void 0,{top:!0}]]),i("div",ce,[d(w(s,{modelValue:t.octave,"onUpdate:modelValue":e[4]||(e[4]=a=>t.octave=a),max:4,min:2,fixed:0,param:"OCTAVE"},null,8,["modelValue"]),[[l,"Octave",void 0,{top:!0}]]),d(w(s,{modelValue:t.steps,"onUpdate:modelValue":e[5]||(e[5]=a=>t.steps=a),max:32,min:4,step:1,fixed:0,param:"steps"},null,8,["modelValue"]),[[l,"Number of steps",void 0,{top:!0}]]),d(w(s,{modelValue:t.probability,"onUpdate:modelValue":e[6]||(e[6]=a=>t.probability=a),max:1,min:0,step:.01,fixed:2,param:"prob"},null,8,["modelValue"]),[[l,"Probability",void 0,{top:!0}]]),d(w(s,{modelValue:b(N).bpm,"onUpdate:modelValue":e[7]||(e[7]=a=>b(N).bpm=a),step:1,max:400,min:10,fixed:0,param:"BPM"},null,8,["modelValue"]),[[l,"Set tempo",void 0,{top:!0}]])]),i("div",be,[d((p(),u("button",{class:B(["text-button",{active:t.humanize}]),onClick:e[8]||(e[8]=a=>t.humanize=!t.humanize)},e[13]||(e[13]=[ue("HMN")]),2)),[[l,"Humanize rhythm",void 0,{bottom:!0}]]),d((p(),u("button",{class:"text-button",onClick:e[9]||(e[9]=a=>A())},e[14]||(e[14]=[i("div",{class:"i-la-trash-alt"},null,-1)]))),[[l,"Clear pattern",void 0,{bottom:!0}]])]),i("div",ge,[t.playing?T("",!0):d((p(),u("button",{key:0,class:"text-button",onClick:e[10]||(e[10]=a=>t.playing=!0)},e[15]||(e[15]=[i("div",{class:"i-la-play"},null,-1)]))),[[l,"Play",void 0,{bottom:!0}]]),t.playing?d((p(),u("button",{key:1,class:"text-button",onClick:e[11]||(e[11]=a=>t.playing=!1)},e[16]||(e[16]=[i("div",{class:"i-la-pause"},null,-1)]))),[[l,"Pause",void 0,{bottom:!0}]]):T("",!0),d((p(),u("button",{class:"text-button",onClick:e[12]||(e[12]=a=>F())},e[17]||(e[17]=[i("div",{class:"i-la-stop"},null,-1)]))),[[l,"Stop",void 0,{bottom:!0}]])])])])])}}},ke=oe(ye,[["__scopeId","data-v-469737b0"]]);export{ke as default};
