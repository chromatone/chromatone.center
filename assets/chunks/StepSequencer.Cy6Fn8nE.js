import{a_ as W,R as Z,n as G,g as T,bf as Q,aT as X,bg as Y,bh as ee,bi as te,a8 as oe,u as ae,aU as O,bj as se,aJ as ne,c as _,al as A,l as ie,ar as re}from"./theme.B5E67p0g.js";import{_ as le,e as ue,r as pe,b as M,u as c,c as V,N as de,w as me,o as ve,d as b,P as fe,U as ce,f as u,g as p,h as l,F as D,j as U,p as $,l as g,m as B,n as I,Z as j,k as d,V as y,D as ge,ae as be,q as R,z as ye,A as he}from"./framework.B7TlvOs3.js";const k=x=>(ye("data-v-1538ec46"),x=x(),he(),x),_e={class:"flex flex-col"},xe=["id","onMousedown","onMouseenter"],we={class:"info p-2 flex flex-wrap items-center justify-center mx-2 gap-4"},Ve={class:"flex flex-wrap items-center justify-center bg-light-900 p-4 rounded-2xl dark-bg-dark-800 gap-2",style:{flex:"5 1 300px"}},ke=["value"],Ce={class:"is-group flex flex-wrap p-2"},Se={class:"is-group flex items-center"},Ee=k(()=>l("div",{class:"i-la-trash-alt"},null,-1)),Me=[Ee],De={class:"is-group flex items-center"},Ue=k(()=>l("div",{class:"i-la-play"},null,-1)),$e=[Ue],qe=k(()=>l("div",{class:"i-la-pause"},null,-1)),ze=[qe],Pe=k(()=>l("div",{class:"i-la-stop"},null,-1)),Ne=[Pe],Te={__name:"StepSequencer",setup(x){const{isDark:q}=ue(),F=W(),z=Z(),C=pe(0),t=M({started:!1,playing:!1,hover:!1,mounted:!1,current:0,octave:c("seq-octave",3),bpm:c("seq-bpm",120),steps:c("seq-steps",16),type:c("seq-type","up"),probability:c("seq-prob",1),humanize:c("seq-human",!1),interval:c("seq-interval","8n"),note:V(()=>G[T.tonic]),range:V(()=>Q(t.note+t.octave+" "+T.set.name)(t.note+t.octave,t.note+(t.octave+2)).map(o=>X(o)).reverse()),midi:V(()=>t.range.map(o=>Y(o))),pitches:V(()=>t.midi.map(o=>(o+3)%12)),progress:0}),H=["up","down","upDown","downUp","alternateUp","alternateDown","random","randomWalk","randomOnce"],i=M([]),h=M([]);let m=[];de(" ",o=>{o.preventDefault(),t.playing=!t.playing}),me(()=>{t.range.forEach((o,e)=>{i[e]=i[e]||[],i[e].length=t.steps,i.length=t.range.length,Array.apply(null,i[e]).forEach((a,n)=>{i[e][n]={row:e,cell:n,note:o,active:(a==null?void 0:a.active)||!1}})})}),ve(()=>{t.mounted=!0,ee(),S()}),b(C,o=>{te.volume.setValueAtTime(o,0)}),b(()=>t.steps,()=>{t.mounted&&S()},{immediate:!0});function S(){m.forEach(o=>{o.stop(0),o.dispose()}),m=[],i.forEach((o,e)=>{m[e]=new oe((f,a)=>{F.schedule(()=>{h[e]=a==null?void 0:a.cell,a!=null&&a.active&&(ae(a==null?void 0:a.note),O(a.note.slice(0,-1),a.note.slice(-1)-4),setTimeout(()=>{O(a.note.slice(0,-1),a.note.slice(-1)-4,!0)},200))},f),a!=null&&a.active&&se(a.note,t.interval,f)},i[e],t.type).start(0),m[e].interval=t.interval})}let P;function N(o,e,f,a){!t.hover&&!f||!f&&P==a.target.id||(P=a.target.id,i[o][e].active?i[o][e].active=!1:i[o][e].active=!0)}function K(){i.forEach((o,e)=>{o.forEach((f,a)=>i[e][a].active=!1)})}b(()=>t.playing,o=>{o?(m.forEach(e=>{e.start(0)}),z.start(),t.started||(ne(),t.started=!0)):(m.forEach(e=>{e.stop()}),z.stop())}),b(()=>t.type,o=>{m.forEach(e=>{e.pattern=o})},{immediate:!0}),b(()=>t.probability,o=>{m.forEach(e=>{e.probability=o})},{immediate:!0}),b(()=>t.humanize,o=>{m.forEach(e=>{e.humanize=o})},{immediate:!0});function J(){t.playing=!1,S()}fe(()=>{m.forEach(o=>{o.stop(0),o.dispose()})});function L(o,e){return o.active?_(t.pitches[e]):o.cell==h[e]?q.value?"#eee7":"#3337":"#4444"}return(o,e)=>{const f=ie,a=re,n=ce("tooltip");return u(),p("div",_e,[l("div",{class:"rows sticky top-2 h-96svh",onMousedown:e[0]||(e[0]=s=>t.hover=!0),onMouseleave:e[1]||(e[1]=j(s=>t.hover=!1,["self"])),onMouseup:e[2]||(e[2]=s=>t.hover=!1)},[(u(!0),p(D,null,U(i,(s,r)=>(u(),p("div",{class:"row",key:s},[l("div",{class:"title m-1 rounded-md shadow",style:$({color:g(_)(t.pitches[r]),backgroundColor:t.range[r].length>2?"#0005":"#aaa5"})},B(t.range[r]),5),(u(!0),p(D,null,U(s,(v,w)=>(u(),p("div",{class:I(["cell",{active:v==null?void 0:v.active,current:v.cell==h[r]}]),id:`c${r}-${w}`,key:v,style:$({color:g(_)(t.pitches[r]),borderColor:L(v,r),backgroundColor:v.cell==h[r]?v.active?g(_)(t.pitches[r],3):g(q)?"#0005":"#fff5":"transparent",marginRight:w%4==3?"12px":"1px"}),onMousedown:j(E=>N(r,w,!0,E),["prevent"]),onMouseenter:E=>N(r,w,!1,E)},[l("div",{class:"dot",style:$({backgroundColor:v.active?g(_)(t.pitches[r]):v.cell==h[r]?"currentColor":"#4448"})},null,4)],46,xe))),128))]))),128))],32),l("div",we,[d(y(f,{style:{flex:"1 1 100px"}},null,512),[[n,"Select root note and scale",void 0,{top:!0}]]),l("div",Ve,[d((u(),p("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>t.type=s)},[(u(),p(D,null,U(H,s=>l("option",{key:s,value:s},B(s),9,ke)),64))])),[[ge,t.type],[n,"Pattern type",void 0,{top:!0}]]),l("div",Ce,[d(y(a,{modelValue:t.octave,"onUpdate:modelValue":e[4]||(e[4]=s=>t.octave=s),max:4,min:2,fixed:0,param:"OCTAVE"},null,8,["modelValue"]),[[n,"Octave",void 0,{top:!0}]]),d(y(a,{modelValue:t.steps,"onUpdate:modelValue":e[5]||(e[5]=s=>t.steps=s),max:32,min:4,step:1,fixed:0,param:"steps"},null,8,["modelValue"]),[[n,"Number of steps",void 0,{top:!0}]]),d(y(a,{modelValue:t.probability,"onUpdate:modelValue":e[6]||(e[6]=s=>t.probability=s),max:1,min:0,step:.01,fixed:2,param:"prob"},null,8,["modelValue"]),[[n,"Probability",void 0,{top:!0}]]),d(y(a,{modelValue:g(A).bpm,"onUpdate:modelValue":e[7]||(e[7]=s=>g(A).bpm=s),step:1,max:400,min:10,fixed:0,param:"BPM"},null,8,["modelValue"]),[[n,"Set tempo",void 0,{top:!0}]])]),l("div",Se,[d(y(a,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=s=>C.value=s),step:.1,max:10,min:-20,fixed:0,param:"PIANO"},null,8,["modelValue"]),[[n,"Set piano volume",void 0,{top:!0}]]),d((u(),p("button",{class:I(["text-button",{active:t.humanize}]),onClick:e[9]||(e[9]=s=>t.humanize=!t.humanize)},[be("HMN")],2)),[[n,"Humanize rhythm",void 0,{bottom:!0}]]),d((u(),p("button",{class:"text-button",onClick:e[10]||(e[10]=s=>K())},Me)),[[n,"Clear pattern",void 0,{bottom:!0}]])]),l("div",De,[t.playing?R("",!0):d((u(),p("button",{key:0,class:"text-button",onClick:e[11]||(e[11]=s=>t.playing=!0)},$e)),[[n,"Play",void 0,{bottom:!0}]]),t.playing?d((u(),p("button",{key:1,class:"text-button",onClick:e[12]||(e[12]=s=>t.playing=!1)},ze)),[[n,"Pause",void 0,{bottom:!0}]]):R("",!0),d((u(),p("button",{class:"text-button",onClick:e[13]||(e[13]=s=>J())},Ne)),[[n,"Stop",void 0,{bottom:!0}]])])])])])}}},Be=le(Te,[["__scopeId","data-v-1538ec46"]]);export{Be as default};
