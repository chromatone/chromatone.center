import{bh as X,X as G,n as J,g as N,bi as Z,aU as Q,bj as Y,bk as tt,bl as et,ae as ot,m as at,aV as T,bm as st,be as nt,c as _,aq as B,l as it,ax as rt}from"./theme.DZiOYyfH.js";import{q as lt,L as ut,r as pt,b as M,u as f,c as k,P as dt,w as mt,o as vt,d as g,R as ct,W as ft,v as u,x as p,z as i,F as q,A as D,G as $,D as b,E as A,y as I,Z as R,B as d,X as y,O as bt,aq as gt,H as j,J as yt,K as ht}from"./framework.njvVDImA.js";const x=w=>(yt("data-v-16c663c5"),w=w(),ht(),w),_t={class:"flex flex-col"},xt=x(()=>i("div",{class:"row"},[i("div",{class:"title"})],-1)),wt=["id","onMousedown","onMouseenter"],Vt={class:"flex flex-wrap items-center justify-center mx-2 gap-2"},kt={class:"flex flex-wrap items-center justify-center bg-light-900 p-4 rounded-2xl dark-bg-dark-800 gap-2",style:{flex:"5 1 200px"}},Ct=["value"],St={class:"is-group flex flex-wrap p-2"},Et={class:"is-group flex items-center"},Mt=x(()=>i("div",{class:"i-la-trash-alt"},null,-1)),qt=[Mt],Dt={class:"is-group flex items-center"},$t=x(()=>i("div",{class:"i-la-play"},null,-1)),zt=[$t],Ut=x(()=>i("div",{class:"i-la-pause"},null,-1)),Pt=[Ut],Ot=x(()=>i("div",{class:"i-la-stop"},null,-1)),Nt=[Ot],Tt={__name:"StepSequencer",setup(w){const{isDark:z}=ut(),H=X(),U=G(),C=pt(0),e=M({started:!1,playing:!1,hover:!1,mounted:!1,current:0,octave:f("seq-octave",3),bpm:f("seq-bpm",120),steps:f("seq-steps",16),type:f("seq-type","up"),probability:f("seq-prob",1),humanize:f("seq-human",!1),interval:f("seq-interval","8n"),note:k(()=>J[N.tonic]),range:k(()=>Z(e.note+e.octave+" "+N.set.name)(e.note+e.octave,e.note+(e.octave+2)).map(o=>Q(o)).reverse()),midi:k(()=>e.range.map(o=>Y(o))),pitches:k(()=>e.midi.map(o=>(o+3)%12)),progress:0}),K=["up","down","upDown","downUp","alternateUp","alternateDown","random","randomWalk","randomOnce"],r=M([]),h=M([]);let m=[];dt(" ",o=>{o.preventDefault(),e.playing=!e.playing}),mt(()=>{e.range.forEach((o,t)=>{r[t]=r[t]||[],r[t].length=e.steps,r.length=e.range.length,Array.apply(null,r[t]).forEach((a,n)=>{r[t][n]={row:t,cell:n,note:o,active:(a==null?void 0:a.active)||!1}})})}),vt(()=>{e.mounted=!0,tt(),S()}),g(C,o=>{et.volume.setValueAtTime(o,0)}),g(()=>e.steps,()=>{e.mounted&&S()},{immediate:!0});function S(){m.forEach(o=>{o.stop(0),o.dispose()}),m=[],r.forEach((o,t)=>{m[t]=new ot((c,a)=>{H.schedule(()=>{h[t]=a==null?void 0:a.cell,a!=null&&a.active&&(at(a==null?void 0:a.note),T(a.note.slice(0,-1),a.note.slice(-1)-4),setTimeout(()=>{T(a.note.slice(0,-1),a.note.slice(-1)-4,!0)},200))},c),a!=null&&a.active&&st(a.note,e.interval,c)},r[t],e.type).start(0),m[t].interval=e.interval})}let P;function O(o,t,c,a){!e.hover&&!c||!c&&P==a.target.id||(P=a.target.id,r[o][t].active?r[o][t].active=!1:r[o][t].active=!0)}function F(){r.forEach((o,t)=>{o.forEach((c,a)=>r[t][a].active=!1)})}g(()=>e.playing,o=>{o?(m.forEach(t=>{t.start(0)}),U.start(),e.started||(nt(),e.started=!0)):(m.forEach(t=>{t.stop()}),U.stop())}),g(()=>e.type,o=>{m.forEach(t=>{t.pattern=o})},{immediate:!0}),g(()=>e.probability,o=>{m.forEach(t=>{t.probability=o})},{immediate:!0}),g(()=>e.humanize,o=>{m.forEach(t=>{t.humanize=o})},{immediate:!0});function L(){e.playing=!1,S()}ct(()=>{m.forEach(o=>{o.stop(0),o.dispose()})});function W(o,t){return o.active?_(e.pitches[t]):o.cell==h[t]?z.value?"#eee7":"#3337":"#4444"}return(o,t)=>{const c=it,a=rt,n=ft("tooltip");return u(),p("div",_t,[i("div",{class:"rows",onMousedown:t[0]||(t[0]=s=>e.hover=!0),onMouseleave:t[1]||(t[1]=R(s=>e.hover=!1,["self"])),onMouseup:t[2]||(t[2]=s=>e.hover=!1)},[xt,(u(!0),p(q,null,D(r,(s,l)=>(u(),p("div",{class:"row",key:s},[i("div",{class:"title m-1 rounded-md shadow",style:$({color:b(_)(e.pitches[l]),backgroundColor:e.range[l].length>2?"#0005":"#aaa5"})},A(e.range[l]),5),(u(!0),p(q,null,D(s,(v,V)=>(u(),p("div",{class:I(["cell",{active:v==null?void 0:v.active,current:v.cell==h[l]}]),id:`c${l}-${V}`,key:v,style:$({color:b(_)(e.pitches[l]),borderColor:W(v,l),backgroundColor:v.cell==h[l]?v.active?b(_)(e.pitches[l],3):b(z)?"#0005":"#fff5":"transparent",marginRight:V%4==3?"12px":"1px"}),onMousedown:R(E=>O(l,V,!0,E),["prevent"]),onMouseenter:E=>O(l,V,!1,E)},[i("div",{class:"dot",style:$({backgroundColor:v.active?b(_)(e.pitches[l]):v.cell==h[l]?"currentColor":"#4448"})},null,4)],46,wt))),128))]))),128))],32),i("div",Vt,[d(y(c,{style:{flex:"1 1 100px"}},null,512),[[n,"Select root note and scale",void 0,{top:!0}]]),i("div",kt,[d((u(),p("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>e.type=s)},[(u(),p(q,null,D(K,s=>i("option",{key:s,value:s},A(s),9,Ct)),64))])),[[bt,e.type],[n,"Pattern type",void 0,{top:!0}]]),i("div",St,[d(y(a,{modelValue:e.octave,"onUpdate:modelValue":t[4]||(t[4]=s=>e.octave=s),max:4,min:2,fixed:0,param:"OCTAVE"},null,8,["modelValue"]),[[n,"Octave",void 0,{top:!0}]]),d(y(a,{modelValue:e.steps,"onUpdate:modelValue":t[5]||(t[5]=s=>e.steps=s),max:32,min:4,step:1,fixed:0,param:"steps"},null,8,["modelValue"]),[[n,"Number of steps",void 0,{top:!0}]]),d(y(a,{modelValue:e.probability,"onUpdate:modelValue":t[6]||(t[6]=s=>e.probability=s),max:1,min:0,step:.01,fixed:2,param:"prob"},null,8,["modelValue"]),[[n,"Probability",void 0,{top:!0}]]),d(y(a,{modelValue:b(B).bpm,"onUpdate:modelValue":t[7]||(t[7]=s=>b(B).bpm=s),step:1,max:400,min:10,fixed:0,param:"BPM"},null,8,["modelValue"]),[[n,"Set tempo",void 0,{top:!0}]])]),i("div",Et,[d(y(a,{modelValue:C.value,"onUpdate:modelValue":t[8]||(t[8]=s=>C.value=s),step:.1,max:10,min:-20,fixed:0,param:"PIANO"},null,8,["modelValue"]),[[n,"Set piano volume",void 0,{top:!0}]]),d((u(),p("button",{class:I(["text-button",{active:e.humanize}]),onClick:t[9]||(t[9]=s=>e.humanize=!e.humanize)},[gt("HMN")],2)),[[n,"Humanize rhythm",void 0,{bottom:!0}]]),d((u(),p("button",{class:"text-button",onClick:t[10]||(t[10]=s=>F())},qt)),[[n,"Clear pattern",void 0,{bottom:!0}]])]),i("div",Dt,[e.playing?j("",!0):d((u(),p("button",{key:0,class:"text-button",onClick:t[11]||(t[11]=s=>e.playing=!0)},zt)),[[n,"Play",void 0,{bottom:!0}]]),e.playing?d((u(),p("button",{key:1,class:"text-button",onClick:t[12]||(t[12]=s=>e.playing=!1)},Pt)),[[n,"Pause",void 0,{bottom:!0}]]):j("",!0),d((u(),p("button",{class:"text-button",onClick:t[13]||(t[13]=s=>L())},Nt)),[[n,"Stop",void 0,{bottom:!0}]])])])])])}}},It=lt(Tt,[["__scopeId","data-v-16c663c5"]]);export{It as default};
