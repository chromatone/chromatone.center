import{_ as $}from"./MidiKeys.0Lo0HrcT.js";import{E as A,aC as w,O as M,at as t,an as U}from"./theme.DF4Pw-XN.js";import{_ as N}from"./AnalysisFFT.CnEiAMnN.js";import{u as F}from"./useElementary.CQkbN8sK.js";import{H as O,E as P,J as f,o as R,a1 as q,u as g,c as b,h as k,t as V,i as z,F as H,Q as J}from"./framework.D_pKV3Tc.js";const{audio:C}=F();function B(c,v="ref"){const r=O({}),d={},i={},l={};for(let o in c){let e=c[o];if(r[o]=A(e!=null&&e.nostore?e.value:P(`${v}:${o}`,e.value),e.min,e.max),!(e!=null&&e.hidden)){const n=o.split(":"),m=n.pop(),s=n.pop();l[s]=l[s]||{},l[s][m]=e}}return f(()=>C.initiated,()=>{if(C.initiated)for(let o in c){let[e,n]=C.core.createRef("const",{value:r[o]},[]);d[o]=e,i[o]=n}},{immediate:!0}),f(r,o=>{for(let e in o)i[e]&&i[e]({value:o[e]})}),{controls:r,cv:d,setters:i,groups:l}}const K={key:1,class:"flex flex-col gap-6 p-2"},L={class:"flex flex-wrap p-2 gap-4"},W={__name:"StringSynth",setup(c){R(()=>w.value=!1),q(()=>w.value=!0);const{midi:v}=M(),r={"string:volume":{value:.8,min:0,max:1,step:.01},"string:smooth":{value:.8,min:1e-4,max:.1,step:.001,fixed:3},"string:feedback":{value:.995,min:.9,max:.9999,step:.001,fixed:3}},d={"string:trigger":{value:0,min:0,max:1,step:1,nostore:!0},"string:midi":{value:42,min:1,max:127,step:1,nostore:!0},"string:velocity":{value:0,min:1,max:127,step:1,nostore:!0}},{audio:i,render:l}=F(),{controls:o,cv:e}=B(r,"string"),{controls:n,cv:m}=B(d,"string-midi");return f(()=>v.note,s=>{n["string:trigger"]=s.velocity>0?1:0,n["string:midi"]=s==null?void 0:s.number,n["string:velocity"]=(s==null?void 0:s.velocity)/127}),f(()=>i.initiated,()=>{if(!i.initiated)return;let s=t.mul(440,t.pow(2,t.div(t.sub(m["string:midi"],69),12))),p=t.mul(t.div(1,s),1e3),_=t.adsr(1e-4,.2,.01,.2,m["string:trigger"]),x=t.mul(_,t.noise(),m["string:velocity"]),y=t.lowpass(880,6,x),a=t.adsr(.005,.2,0,.1,1),u=t.mul(a,t.cycle(t.mul(1,s)),.2),h=t.delay({size:44100},t.smooth(t.tau2pole(e["string:smooth"]),t.ms2samps(p)),e["string:feedback"],y),S=t.add(h,u),T=t.tanh(S);const E=t.mul(e["string:volume"],T);i.layers.string={volume:1,signal:[E,E]}}),(s,p)=>{const _=N,x=U,y=$;return g(i).started?(b(),k("div",K,[V(_),z("div",L,[(b(),k(H,null,J(r,(a,u)=>V(x,{param:u.split(":")[1],modelValue:g(o)[u],"onUpdate:modelValue":h=>g(o)[u]=h,min:a.min,max:a.max,fixed:a.fixed,step:a.step},null,8,["param","modelValue","onUpdate:modelValue","min","max","fixed","step"])),64))]),V(y)])):(b(),k("button",{key:0,class:"p-40 text-2xl font-bold bg-light-900 dark-bg-dark-700",onClick:p[0]||(p[0]=a=>g(l)())},"START "))}}};export{W as default};
