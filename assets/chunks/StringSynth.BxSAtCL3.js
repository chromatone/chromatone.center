import{_ as A}from"./MidiKeys.CYJtG8_r.js";import{F as E,u as M,aH as B,R,ar as U,ax as e}from"./theme.DKUtGHOP.js";import{_ as q}from"./AnalysisFFT.CoLN8bwq.js";import{u as S}from"./useElementary.kwxWhjY9.js";import{D as N,I as f,o as P,a2 as z,q as b,u as g,f as k,l as V,s as D,F as H,Y as I}from"./framework.Bbwy4zmA.js";const{audio:F}=S();function C(c,v="ref"){const a=N({}),d={},o={},l={};for(let s in c){let t=c[s];if(a[s]=E(t?.nostore?t.value:M(`${v}:${s}`,t.value),t.min,t.max),!t?.hidden){const i=s.split(":"),m=i.pop(),n=i.pop();l[n]=l[n]||{},l[n][m]=t}}return f(()=>F.initiated,()=>{if(F.initiated)for(let s in c){let[t,i]=F.core.createRef("const",{value:a[s]},[]);d[s]=t,o[s]=i}},{immediate:!0}),f(a,s=>{for(let t in s)o[t]&&o[t]({value:s[t]})}),{controls:a,cv:d,setters:o,groups:l}}const K={key:1,class:"flex flex-col gap-6 p-2"},L={class:"flex flex-wrap p-2 gap-4"},Q={__name:"StringSynth",setup(c){P(()=>B.value=!1),z(()=>B.value=!0);const{midi:v}=R(),a={"string:volume":{value:.8,min:0,max:1,step:.01},"string:smooth":{value:.8,min:1e-4,max:.1,step:.001,fixed:3},"string:feedback":{value:.995,min:.9,max:.9999,step:.001,fixed:3}},d={"string:trigger":{value:0,min:0,max:1,step:1,nostore:!0},"string:midi":{value:42,min:1,max:127,step:1,nostore:!0},"string:velocity":{value:0,min:1,max:127,step:1,nostore:!0}},{audio:o,render:l}=S(),{controls:s,cv:t}=C(a,"string"),{controls:i,cv:m}=C(d,"string-midi");return f(()=>v.note,n=>{i["string:trigger"]=n.velocity>0?1:0,i["string:midi"]=n?.number,i["string:velocity"]=n?.velocity/127}),f(()=>o.initiated,()=>{if(!o.initiated)return;let n=e.mul(440,e.pow(2,e.div(e.sub(m["string:midi"],69),12))),p=e.mul(e.div(1,n),1e3),_=e.adsr(1e-4,.2,.01,.2,m["string:trigger"]),x=e.mul(_,e.noise(),m["string:velocity"]),y=e.lowpass(880,6,x),r=e.adsr(.005,.2,0,.1,1),u=e.mul(r,e.cycle(e.mul(1,n)),.2),h=e.delay({size:44100},e.smooth(e.tau2pole(t["string:smooth"]),e.ms2samps(p)),t["string:feedback"],y),T=e.add(h,u),$=e.tanh(T);const w=e.mul(t["string:volume"],$);o.layers.string={volume:1,signal:[w,w]}}),(n,p)=>{const _=q,x=U,y=A;return g(o).started?(k(),b("div",K,[V(_),D("div",L,[(k(),b(H,null,I(a,(r,u)=>V(x,{param:u.split(":")[1],modelValue:g(s)[u],"onUpdate:modelValue":h=>g(s)[u]=h,min:r.min,max:r.max,fixed:r.fixed,step:r.step},null,8,["param","modelValue","onUpdate:modelValue","min","max","fixed","step"])),64))]),V(y)])):(k(),b("button",{key:0,class:"p-40 text-2xl font-bold bg-light-900 dark-bg-dark-700",onClick:p[0]||(p[0]=r=>g(l)())},"START "))}}};export{Q as default};
