import{_ as E}from"./MidiKeys.r0Dgn0sF.js";import{aJ as b,Y as T,aF as C,bo as h,bp as e,aw as M}from"./theme.C7XPe3zW.js";import{_ as S}from"./AnalysisFFT.BAEX4wRU.js";import{o as U,R as N,d as k,E as a,x as g,y as _,X as f,A as P,F as R,B as $}from"./framework.BY0U24KH.js";const q={key:1,class:"flex flex-col gap-6 p-2"},z={class:"flex flex-wrap p-2 gap-4"},Y={__name:"StringSynth",setup(J){U(()=>b.value=!1),N(()=>b.value=!0);const{midi:V}=T(),v={"string:volume":{value:.8,min:0,max:1,step:.01},"string:smooth":{value:.8,min:1e-4,max:.1,step:.001,fixed:3},"string:feedback":{value:.995,min:.9,max:.9999,step:.001,fixed:3}},w={"string:trigger":{value:0,min:0,max:1,step:1,nostore:!0},"string:midi":{value:42,min:1,max:127,step:1,nostore:!0},"string:velocity":{value:0,min:1,max:127,step:1,nostore:!0}},{audio:o,render:B}=C(),{controls:x,cv:l}=h(v,"string"),{controls:r,cv:m}=h(w,"string-midi");return k(()=>V.note,t=>{r["string:trigger"]=t.velocity>0?1:0,r["string:midi"]=t==null?void 0:t.number,r["string:velocity"]=(t==null?void 0:t.velocity)/127}),k(()=>o.initiated,()=>{if(!o.initiated)return;let t=e.mul(440,e.pow(2,e.div(e.sub(m["string:midi"],69),12))),n=e.mul(e.div(1,t),1e3),d=e.adsr(1e-4,.2,.01,.2,m["string:trigger"]),u=e.mul(d,e.noise(),m["string:velocity"]),c=e.lowpass(880,6,u),s=e.adsr(.005,.2,0,.1,1),i=e.mul(s,e.cycle(e.mul(1,t)),.2),p=e.delay({size:44100},e.smooth(e.tau2pole(l["string:smooth"]),e.ms2samps(n)),l["string:feedback"],c),F=e.add(p,i),A=e.tanh(F);const y=e.mul(l["string:volume"],A);o.layers.string={volume:1,signal:[y,y]}}),(t,n)=>{const d=S,u=M,c=E;return a(o).started?(g(),_("div",q,[f(d),P("div",z,[(g(),_(R,null,$(v,(s,i)=>f(u,{param:i.split(":")[1],modelValue:a(x)[i],"onUpdate:modelValue":p=>a(x)[i]=p,min:s.min,max:s.max,fixed:s.fixed,step:s.step},null,8,["param","modelValue","onUpdate:modelValue","min","max","fixed","step"])),64))]),f(c)])):(g(),_("button",{key:0,class:"p-40 text-2xl font-bold bg-light-900 dark-bg-dark-700",onClick:n[0]||(n[0]=s=>a(B)())},"START "))}}};export{Y as default};
