import{r as S,M as h,q as d,f as u,s as m,u as p,z as T,_ as q,D as F,F as y,Y as g,e as P,l as E,a3 as k}from"./framework.CxSiiyCs.js";import{R as A,M as O,aL as R,c as w,v as j,y as C,q as z,x as D,n as L,g as N,r as M}from"./theme.DLCqlVTm.js";const V={class:"cursor-pointer"},I=["r","stroke-width","fill"],U={style:{"user-select":"none","pointer-events":"none"},"font-size":"22px","text-anchor":"middle",fill:"white",x:0,y:8},Y={__name:"TonalArrayNote",props:{note:{type:Object,default:()=>{}},r:{type:Number,default:10},pressed:{type:Boolean,default:!1},available:{type:Boolean,default:!1},tonic:{type:Number,default:0}},emits:["update:pressed"],setup(l){const{activeChroma:$}=A(),o=l,a=S(!1),c=h(()=>{let x=o.tonic>o.note.pitch?3:2;return O(R(o.note.pitch,x)).toNote()});function v(){a.value=!0,C(c.value)}function f(){a.value=!1,j(c.value)}return(x,e)=>(u(),d("g",V,[m("circle",{class:"transition-all duration-50",r:l.r,cx:0,cy:0,"stroke-width":l.tonic==l.note.pitch?4:l.available?2:0,stroke:"white",fill:p(w)(l.note.pitch,a.value||p($)?.[l.note.pitch]>0?5:l.available?3:2,a.value||p($)?.[l.note.pitch]>0?1:.4),onMousedown:e[0]||(e[0]=t=>v()),onTouchstart:e[1]||(e[1]=t=>v()),onMouseenter:e[2]||(e[2]=t=>l.pressed?v():null),onMouseup:e[3]||(e[3]=t=>f()),onMouseleave:e[4]||(e[4]=t=>f()),onTouchend:e[5]||(e[5]=t=>f()),onTouchcancel:e[6]||(e[6]=t=>f())},null,40,I),m("text",U,T(l.note.name),1)]))}},G=["transform","fill","stroke-width"],H={__name:"TonalArrayTrigger",props:{pressed:Boolean,note:{type:Object,default:()=>{}},chord:{type:Object,default:()=>{}},p:{type:Number,default:0},activeSteps:{type:Array,default:()=>[]}},setup(l){const{midi:$,activeChroma:o}=A(),a=l,c=S(!1),v=h(()=>a.chord.map(n=>n+a.note.pitch)),f=h(()=>{let n=!0;return v.value.map(r=>r>11?r%12:r).forEach(r=>{a.activeSteps[r]!="1"&&(n=!1)}),n}),x=h(()=>{let n=!0;return v.value.map(r=>r>11?r%12:r).forEach(r=>{o.value[r]!="1"&&(n=!1)}),n}),e=h(()=>v.value.map(n=>n+57+12*$.offset));function t(){c.value=!0,C(e.value),D(e.value)}function i(){c.value=!1,j(e.value),z(e.value)}return(n,s)=>(u(),d("polygon",{class:"chord-trigger",style:{"mix-blend-mode":"screen"},transform:"rotate("+60*l.p+")",fill:p(w)(l.note.pitch,c.value||x.value?5:f.value?.5:-2,f.value?1:.2),opacity:1,"stroke-width":f.value?4:.5,stroke:"hsla(0,0%,100%,0.5)",points:"0,0 80,0 80,46.188 40,69.28",onMousedown:s[0]||(s[0]=r=>t()),onMouseenter:s[1]||(s[1]=r=>l.pressed?t():null),onTouchstart:s[2]||(s[2]=r=>t()),onMouseleave:s[3]||(s[3]=r=>i()),onMouseup:s[4]||(s[4]=r=>i()),onTouchend:s[5]||(s[5]=r=>i()),onTouchcancel:s[6]||(s[6]=r=>i())},null,40,G))}},J=["transform"],K=["fill"],Q=["fill"],W={class:"chord-name","text-anchor":"middle",fill:"white",x:80,y:-40},X={class:"chord-name","text-anchor":"middle",fill:"white",x:80,y:55},Z=["transform"],_=["transform"],ee={__name:"TonalArray",setup(l){const $=[...L].map((e,t)=>({name:e,pitch:t})),o=F({pressed:!1,r:28,dx:80,rowNum:12,colNum:12,rows:[0,9,5,2,10],bgRows:[4,0,9,5,2,10,7],chords:[[0,3,7],[0,3,8],[0,5,8],[0,5,9],[0,4,9],[0,4,7]]}),a=h(()=>{let e=N.chroma.split("").map(Number);return M(e,-N.tonic)}),c=h(()=>o.dx*2*.866),v=h(()=>{let e=[];for(let t=0;t<12;t++)e[t]=$[7*t%12];return e});function f(e){return!a.value[e]||!a.value[(e+4)%12]||!a.value[(e+7)%12]}function x(e){return!a.value[e]||!a.value[(e+3)%12]||!a.value[(e+7)%12]}return(e,t)=>(u(),d("svg",{class:"min-h-80svh max-h-100svh",id:"tonal-array",viewBox:"-80 -110 1040 770",version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},onTouchstart:t[1]||(t[1]=k(i=>o.pressed=!0,["stop","prevent"])),onTouchend:t[2]||(t[2]=k(i=>o.pressed=!1,["stop","prevent"])),onMousedown:t[3]||(t[3]=k(i=>o.pressed=!0,["stop","prevent"])),onMouseup:t[4]||(t[4]=k(i=>o.pressed=!1,["stop","prevent"])),onMouseleave:t[5]||(t[5]=i=>o.pressed=!1)},[t[6]||(t[6]=m("clipPath",{id:"grid-mask"},[m("rect",{x:-80,y:-110,width:1040,height:770})],-1)),(u(!0),d(y,null,g(o.bgRows,(i,n)=>(u(),d("g",{key:i,"clip-path":"url(#grid-mask)"},[(u(!0),d(y,null,g(p(M)(v.value,i-1).splice(0,7),(s,r)=>(u(),d("g",{key:s,transform:`translate(${(r-1)*2*o.dx+(n+1)%2*o.dx}, ${(n-1)*c.value})`},[m("polygon",{class:"chord-triangle",fill:x(s.pitch)?p(w)(s.pitch,1,.2):p(w)(s.pitch,3),points:"0,0 160,0 80,138.56"},null,8,K),m("polygon",{class:"chord-triangle major",fill:f(s.pitch)?p(w)(s.pitch,1,.2):p(w)(s.pitch,2),points:"0,0 160,0 80,-138.56"},null,8,Q),m("text",W,T(s.name)+"M",1),m("text",X,T(s.name)+"m",1)],8,J))),128))]))),128)),(u(!0),d(y,null,g(o.rows,(i,n)=>(u(),d("g",{class:"cursor-crosshair",key:n},[(u(!0),d(y,null,g(p(M)(v.value,i).splice(0,7),(s,r)=>(u(),d("g",{key:s,transform:`translate(${r*2*o.dx+n%2*o.dx}, ${n*c.value})`},[(u(!0),d(y,null,g(o.chords,(b,B)=>(u(),P(H,{key:B,"active-steps":a.value,chord:b,p:B,note:s,pressed:o.pressed},null,8,["active-steps","chord","p","note","pressed"]))),128))],8,Z))),128))]))),128)),(u(!0),d(y,null,g(o.rows,(i,n)=>(u(),d("g",{key:n},[(u(!0),d(y,null,g(p(M)(v.value,i).splice(0,6),(s,r)=>(u(),d("g",{key:r,transform:"translate("+(r*2*o.dx+n%2*o.dx)+","+n*c.value+")"},[E(Y,{pressed:o.pressed,"onUpdate:pressed":t[0]||(t[0]=b=>o.pressed=b),available:!!a.value[s.pitch],tonic:p(N).tonic,note:s,r:o.r},null,8,["pressed","available","tonic","note","r"])],8,_))),128))]))),128))],32))}},oe=q(ee,[["__scopeId","data-v-bd27fa1f"]]);export{oe as default};
