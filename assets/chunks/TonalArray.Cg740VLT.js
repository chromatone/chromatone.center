import{r as S,c as h,f as u,g as i,h as m,l as d,m as T,_ as z,b as E,F as g,j as $,z as O,U as q,X as b}from"./framework.CRnXhBxo.js";import{T as j,F as A,aH as C,c as w,x as F,z as P,v as R,y as U,n as V,g as N,r as k}from"./theme.Bq_9bLhe.js";const D={class:"cursor-pointer"},H=["r","stroke-width","fill"],I={style:{"user-select":"none","pointer-events":"none"},"font-size":"22px","text-anchor":"middle",fill:"white",x:0,y:8},L={__name:"TonalArrayNote",props:{note:{type:Object,default:()=>{}},r:{type:Number,default:10},pressed:{type:Boolean,default:!1},available:{type:Boolean,default:!1},tonic:{type:Number,default:0}},emits:["update:pressed"],setup(l){const{midi:y}=j(),r=l,a=S(!1),v=h(()=>{let c=r.tonic>r.note.pitch?3:2;return A(C(r.note.pitch,c)).toNote()});function p(){a.value=!0,F(v.value)}function f(){a.value=!1,P(v.value)}return(c,e)=>{var o,n;return u(),i("g",D,[m("circle",{class:"transition-all duration-50",r:l.r,cx:0,cy:0,"stroke-width":l.tonic==l.note.pitch?4:l.available?2:0,stroke:"white",fill:d(w)(l.note.pitch,a.value||((o=d(y).activeChroma)==null?void 0:o[l.note.pitch])>0?5:l.available?3:2,a.value||((n=d(y).activeChroma)==null?void 0:n[l.note.pitch])>0?1:.4),onMousedown:e[0]||(e[0]=t=>p()),onTouchstart:e[1]||(e[1]=t=>p()),onMouseenter:e[2]||(e[2]=t=>l.pressed?p():null),onMouseup:e[3]||(e[3]=t=>f()),onMouseleave:e[4]||(e[4]=t=>f()),onTouchend:e[5]||(e[5]=t=>f()),onTouchcancel:e[6]||(e[6]=t=>f())},null,40,H),m("text",I,T(l.note.name),1)])}}},X=["transform","fill","stroke-width"],G={__name:"TonalArrayTrigger",props:{pressed:Boolean,note:{type:Object,default:()=>{}},chord:{type:Object,default:()=>{}},p:{type:Number,default:0},activeSteps:{type:Array,default:()=>[]}},setup(l){const{midi:y}=j(),r=l,a=S(!1),v=h(()=>r.chord.map(n=>n+r.note.pitch)),p=h(()=>{let n=!0;return v.value.map(s=>s>11?s%12:s).forEach(s=>{r.activeSteps[s]!="1"&&(n=!1)}),n}),f=h(()=>{let n=!0;return v.value.map(s=>s>11?s%12:s).forEach(s=>{y.activeChroma[s]!="1"&&(n=!1)}),n}),c=h(()=>v.value.map(n=>A(C(n)).transpose(-12+12*y.offset).toNote()));function e(){a.value=!0,F(c.value),R(c.value)}function o(){a.value=!1,P(c.value),U(c.value)}return(n,t)=>(u(),i("polygon",{class:"chord-trigger",style:{"mix-blend-mode":"screen"},transform:"rotate("+60*l.p+")",fill:d(w)(l.note.pitch,a.value||f.value?5:p.value?.5:-2,p.value?1:.2),opacity:1,"stroke-width":p.value?4:.5,stroke:"hsla(0,0%,100%,0.5)",points:"0,0 80,0 80,46.188 40,69.28",onMousedown:t[0]||(t[0]=s=>e()),onMouseenter:t[1]||(t[1]=s=>l.pressed?e():null),onTouchstart:t[2]||(t[2]=s=>e()),onMouseleave:t[3]||(t[3]=s=>o()),onMouseup:t[4]||(t[4]=s=>o()),onTouchend:t[5]||(t[5]=s=>o()),onTouchcancel:t[6]||(t[6]=s=>o())},null,40,X))}},J=["transform"],K=["fill"],Q=["fill"],W={class:"chord-name","text-anchor":"middle",fill:"white",x:80,y:-40},Y={class:"chord-name","text-anchor":"middle",fill:"white",x:80,y:55},Z=["transform"],_=["transform"],ee={__name:"TonalArray",setup(l){const y=[...V].map((e,o)=>({name:e,pitch:o})),r=E({pressed:!1,r:28,dx:80,rowNum:12,colNum:12,rows:[0,9,5,2,10],bgRows:[4,0,9,5,2,10,7],chords:[[0,3,7],[0,3,8],[0,5,8],[0,5,9],[0,4,9],[0,4,7]]}),a=h(()=>{let e=N.chroma.split("").map(Number);return k(e,-N.tonic)}),v=h(()=>r.dx*2*.866),p=h(()=>{let e=[];for(let o=0;o<12;o++)e[o]=y[7*o%12];return e});function f(e){return!a.value[e]||!a.value[(e+4)%12]||!a.value[(e+7)%12]}function c(e){return!a.value[e]||!a.value[(e+3)%12]||!a.value[(e+7)%12]}return(e,o)=>(u(),i("svg",{class:"min-h-80svh max-h-100svh",id:"tonal-array",viewBox:"-80 -110 1040 770",version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},onTouchstart:o[1]||(o[1]=b(n=>r.pressed=!0,["stop","prevent"])),onTouchend:o[2]||(o[2]=b(n=>r.pressed=!1,["stop","prevent"])),onMousedown:o[3]||(o[3]=b(n=>r.pressed=!0,["stop","prevent"])),onMouseup:o[4]||(o[4]=b(n=>r.pressed=!1,["stop","prevent"])),onMouseleave:o[5]||(o[5]=n=>r.pressed=!1)},[o[6]||(o[6]=m("clipPath",{id:"grid-mask"},[m("rect",{x:-80,y:-110,width:1040,height:770})],-1)),(u(!0),i(g,null,$(r.bgRows,(n,t)=>(u(),i("g",{key:n,"clip-path":"url(#grid-mask)"},[(u(!0),i(g,null,$(d(k)(p.value,n-1).splice(0,7),(s,x)=>(u(),i("g",{key:s,transform:`translate(${(x-1)*2*r.dx+(t+1)%2*r.dx}, ${(t-1)*v.value})`},[m("polygon",{class:"chord-triangle",fill:c(s.pitch)?d(w)(s.pitch,1,.2):d(w)(s.pitch,3),points:"0,0 160,0 80,138.56"},null,8,K),m("polygon",{class:"chord-triangle major",fill:f(s.pitch)?d(w)(s.pitch,1,.2):d(w)(s.pitch,2),points:"0,0 160,0 80,-138.56"},null,8,Q),m("text",W,T(s.name)+"M",1),m("text",Y,T(s.name)+"m",1)],8,J))),128))]))),128)),(u(!0),i(g,null,$(r.rows,(n,t)=>(u(),i("g",{class:"cursor-crosshair",key:t},[(u(!0),i(g,null,$(d(k)(p.value,n).splice(0,7),(s,x)=>(u(),i("g",{key:s,transform:`translate(${x*2*r.dx+t%2*r.dx}, ${t*v.value})`},[(u(!0),i(g,null,$(r.chords,(M,B)=>(u(),O(G,{key:B,"active-steps":a.value,chord:M,p:B,note:s,pressed:r.pressed},null,8,["active-steps","chord","p","note","pressed"]))),128))],8,Z))),128))]))),128)),(u(!0),i(g,null,$(r.rows,(n,t)=>(u(),i("g",{key:t},[(u(!0),i(g,null,$(d(k)(p.value,n).splice(0,6),(s,x)=>(u(),i("g",{key:x,transform:"translate("+(x*2*r.dx+t%2*r.dx)+","+t*v.value+")"},[q(L,{pressed:r.pressed,"onUpdate:pressed":o[0]||(o[0]=M=>r.pressed=M),available:!!a.value[s.pitch],tonic:d(N).tonic,note:s,r:r.r},null,8,["pressed","available","tonic","note","r"])],8,_))),128))]))),128))],32))}},oe=z(ee,[["__scopeId","data-v-409e889b"]]);export{oe as default};
