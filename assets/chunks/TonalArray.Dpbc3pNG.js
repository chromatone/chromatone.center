import{r as B,c as m,v as u,x as i,z as h,D as d,E as S,q as I,b as P,F as y,A as g,M as q,X as D,$ as b,J as O,K as z}from"./framework.CBUNEF-3.js";import{S as A,F as C,D as j,a as w,L as F,M as E,v as L,y as R,n as V,g as N,r as k}from"./theme.BoeYuT6A.js";const J={class:"cursor-pointer"},K=["r","stroke-width","fill"],U={style:{"user-select":"none","pointer-events":"none"},"font-size":"22px","text-anchor":"middle",fill:"white",x:0,y:8},X={__name:"TonalArrayNote",props:{note:{type:Object,default:()=>{}},r:{type:Number,default:10},pressed:{type:Boolean,default:!1},available:{type:Boolean,default:!1},tonic:{type:Number,default:0}},emits:["update:pressed"],setup(a){const{midi:$}=A(),o=a,l=B(!1),v=m(()=>{let c=o.tonic>o.note.pitch?3:2;return C(j(o.note.pitch,c)).toNote()});function p(){l.value=!0,F(v.value)}function f(){l.value=!1,E(v.value)}return(c,e)=>{var r,n;return u(),i("g",J,[h("circle",{class:"transition-all duration-50",r:a.r,cx:0,cy:0,"stroke-width":a.tonic==a.note.pitch?4:a.available?2:0,stroke:"white",fill:d(w)(a.note.pitch,l.value||((r=d($).activeChroma)==null?void 0:r[a.note.pitch])>0?5:a.available?3:2,l.value||((n=d($).activeChroma)==null?void 0:n[a.note.pitch])>0?1:.4),onMousedown:e[0]||(e[0]=t=>p()),onTouchstart:e[1]||(e[1]=t=>p()),onMouseenter:e[2]||(e[2]=t=>a.pressed?p():null),onMouseup:e[3]||(e[3]=t=>f()),onMouseleave:e[4]||(e[4]=t=>f()),onTouchend:e[5]||(e[5]=t=>f()),onTouchcancel:e[6]||(e[6]=t=>f())},null,40,K),h("text",U,S(a.note.name),1)])}}},G=["transform","fill","stroke-width"],H={__name:"TonalArrayTrigger",props:{pressed:Boolean,note:{type:Object,default:()=>{}},chord:{type:Object,default:()=>{}},p:{type:Number,default:0},activeSteps:{type:Array,default:()=>[]}},setup(a){const{midi:$}=A(),o=a,l=B(!1),v=m(()=>o.chord.map(n=>n+o.note.pitch)),p=m(()=>{let n=!0;return v.value.map(s=>s>11?s%12:s).forEach(s=>{o.activeSteps[s]!="1"&&(n=!1)}),n}),f=m(()=>{let n=!0;return v.value.map(s=>s>11?s%12:s).forEach(s=>{$.activeChroma[s]!="1"&&(n=!1)}),n}),c=m(()=>v.value.map(n=>C(j(n)).transpose(-12).toNote()));function e(){l.value=!0,F(c.value),L(c.value)}function r(){l.value=!1,E(c.value),R(c.value)}return(n,t)=>(u(),i("polygon",{class:"chord-trigger",style:{"mix-blend-mode":"screen"},transform:"rotate("+60*a.p+")",fill:d(w)(a.note.pitch,l.value||f.value?5:p.value?.5:-2,p.value?1:.2),opacity:1,"stroke-width":p.value?4:.5,stroke:"hsla(0,0%,100%,0.5)",points:"0,0 80,0 80,46.188 40,69.28",onMousedown:t[0]||(t[0]=s=>e()),onMouseenter:t[1]||(t[1]=s=>a.pressed?e():null),onTouchstart:t[2]||(t[2]=s=>e()),onMouseleave:t[3]||(t[3]=s=>r()),onMouseup:t[4]||(t[4]=s=>r()),onTouchend:t[5]||(t[5]=s=>r()),onTouchcancel:t[6]||(t[6]=s=>r())},null,40,G))}},Q=a=>(O("data-v-409e889b"),a=a(),z(),a),W=Q(()=>h("clipPath",{id:"grid-mask"},[h("rect",{x:-80,y:-110,width:1040,height:770})],-1)),Y=["transform"],Z=["fill"],_=["fill"],ee={class:"chord-name","text-anchor":"middle",fill:"white",x:80,y:-40},te={class:"chord-name","text-anchor":"middle",fill:"white",x:80,y:55},se=["transform"],oe=["transform"],re={__name:"TonalArray",setup(a){const $=[...V].map((e,r)=>({name:e,pitch:r})),o=P({pressed:!1,r:28,dx:80,rowNum:12,colNum:12,rows:[0,9,5,2,10],bgRows:[4,0,9,5,2,10,7],chords:[[0,3,7],[0,3,8],[0,5,8],[0,5,9],[0,4,9],[0,4,7]]}),l=m(()=>{let e=N.chroma.split("").map(Number);return k(e,-N.tonic)}),v=m(()=>o.dx*2*.866),p=m(()=>{let e=[];for(let r=0;r<12;r++)e[r]=$[7*r%12];return e});function f(e){return!l.value[e]||!l.value[(e+4)%12]||!l.value[(e+7)%12]}function c(e){return!l.value[e]||!l.value[(e+3)%12]||!l.value[(e+7)%12]}return(e,r)=>(u(),i("svg",{class:"min-h-80svh max-h-100svh",id:"tonal-array",viewBox:"-80 -110 1040 770",version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},onTouchstart:r[1]||(r[1]=b(n=>o.pressed=!0,["stop","prevent"])),onTouchend:r[2]||(r[2]=b(n=>o.pressed=!1,["stop","prevent"])),onMousedown:r[3]||(r[3]=b(n=>o.pressed=!0,["stop","prevent"])),onMouseup:r[4]||(r[4]=b(n=>o.pressed=!1,["stop","prevent"])),onMouseleave:r[5]||(r[5]=n=>o.pressed=!1)},[W,(u(!0),i(y,null,g(o.bgRows,(n,t)=>(u(),i("g",{key:n,"clip-path":"url(#grid-mask)"},[(u(!0),i(y,null,g(d(k)(p.value,n-1).splice(0,7),(s,x)=>(u(),i("g",{key:s,transform:`translate(${(x-1)*2*o.dx+(t+1)%2*o.dx}, ${(t-1)*v.value})`},[h("polygon",{class:"chord-triangle",fill:c(s.pitch)?d(w)(s.pitch,1,.2):d(w)(s.pitch,3),points:"0,0 160,0 80,138.56"},null,8,Z),h("polygon",{class:"chord-triangle major",fill:f(s.pitch)?d(w)(s.pitch,1,.2):d(w)(s.pitch,2),points:"0,0 160,0 80,-138.56"},null,8,_),h("text",ee,S(s.name)+"M",1),h("text",te,S(s.name)+"m",1)],8,Y))),128))]))),128)),(u(!0),i(y,null,g(o.rows,(n,t)=>(u(),i("g",{class:"cursor-crosshair",key:t},[(u(!0),i(y,null,g(d(k)(p.value,n).splice(0,7),(s,x)=>(u(),i("g",{key:s,transform:`translate(${x*2*o.dx+t%2*o.dx}, ${t*v.value})`},[(u(!0),i(y,null,g(o.chords,(M,T)=>(u(),q(H,{key:T,"active-steps":l.value,chord:M,p:T,note:s,pressed:o.pressed},null,8,["active-steps","chord","p","note","pressed"]))),128))],8,se))),128))]))),128)),(u(!0),i(y,null,g(o.rows,(n,t)=>(u(),i("g",{key:t},[(u(!0),i(y,null,g(d(k)(p.value,n).splice(0,6),(s,x)=>(u(),i("g",{key:x,transform:"translate("+(x*2*o.dx+t%2*o.dx)+","+t*v.value+")"},[D(X,{pressed:o.pressed,"onUpdate:pressed":r[0]||(r[0]=M=>o.pressed=M),available:!!l.value[s.pitch],tonic:d(N).tonic,note:s,r:o.r},null,8,["pressed","available","tonic","note","r"])],8,oe))),128))]))),128))],32))}},le=I(re,[["__scopeId","data-v-409e889b"]]);export{le as default};
