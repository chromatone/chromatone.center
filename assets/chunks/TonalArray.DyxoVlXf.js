import{r as S,G as h,c as i,h as d,i as m,u as p,B as T,_ as F,H as P,F as y,Q as g,e as E,t as O,a7 as k}from"./framework.DqGUeSFU.js";import{N as A,I as q,aF as I,c as w,v as j,y as C,u as R,x as V,n as z,g as N,r as b}from"./theme.Cc8uQkq-.js";const D={class:"cursor-pointer"},G=["r","stroke-width","fill"],H={style:{"user-select":"none","pointer-events":"none"},"font-size":"22px","text-anchor":"middle",fill:"white",x:0,y:8},L={__name:"TonalArrayNote",props:{note:{type:Object,default:()=>{}},r:{type:Number,default:10},pressed:{type:Boolean,default:!1},available:{type:Boolean,default:!1},tonic:{type:Number,default:0}},emits:["update:pressed"],setup(a){const{activeChroma:$}=A(),r=a,u=S(!1),c=h(()=>{let x=r.tonic>r.note.pitch?3:2;return q(I(r.note.pitch,x)).toNote()});function v(){u.value=!0,j(c.value)}function f(){u.value=!1,C(c.value)}return(x,e)=>{var s,l;return i(),d("g",D,[m("circle",{class:"transition-all duration-50",r:a.r,cx:0,cy:0,"stroke-width":a.tonic==a.note.pitch?4:a.available?2:0,stroke:"white",fill:p(w)(a.note.pitch,u.value||((s=p($))==null?void 0:s[a.note.pitch])>0?5:a.available?3:2,u.value||((l=p($))==null?void 0:l[a.note.pitch])>0?1:.4),onMousedown:e[0]||(e[0]=o=>v()),onTouchstart:e[1]||(e[1]=o=>v()),onMouseenter:e[2]||(e[2]=o=>a.pressed?v():null),onMouseup:e[3]||(e[3]=o=>f()),onMouseleave:e[4]||(e[4]=o=>f()),onTouchend:e[5]||(e[5]=o=>f()),onTouchcancel:e[6]||(e[6]=o=>f())},null,40,G),m("text",H,T(a.note.name),1)])}}},Q=["transform","fill","stroke-width"],U={__name:"TonalArrayTrigger",props:{pressed:Boolean,note:{type:Object,default:()=>{}},chord:{type:Object,default:()=>{}},p:{type:Number,default:0},activeSteps:{type:Array,default:()=>[]}},setup(a){const{midi:$,activeChroma:r}=A(),u=a,c=S(!1),v=h(()=>u.chord.map(o=>o+u.note.pitch)),f=h(()=>{let o=!0;return v.value.map(n=>n>11?n%12:n).forEach(n=>{u.activeSteps[n]!="1"&&(o=!1)}),o}),x=h(()=>{let o=!0;return v.value.map(n=>n>11?n%12:n).forEach(n=>{r.value[n]!="1"&&(o=!1)}),o}),e=h(()=>v.value.map(o=>o+57+12*$.offset));function s(){c.value=!0,j(e.value),R(e.value)}function l(){c.value=!1,C(e.value),V(e.value)}return(o,t)=>(i(),d("polygon",{class:"chord-trigger",style:{"mix-blend-mode":"screen"},transform:"rotate("+60*a.p+")",fill:p(w)(a.note.pitch,c.value||x.value?5:f.value?.5:-2,f.value?1:.2),opacity:1,"stroke-width":f.value?4:.5,stroke:"hsla(0,0%,100%,0.5)",points:"0,0 80,0 80,46.188 40,69.28",onMousedown:t[0]||(t[0]=n=>s()),onMouseenter:t[1]||(t[1]=n=>a.pressed?s():null),onTouchstart:t[2]||(t[2]=n=>s()),onMouseleave:t[3]||(t[3]=n=>l()),onMouseup:t[4]||(t[4]=n=>l()),onTouchend:t[5]||(t[5]=n=>l()),onTouchcancel:t[6]||(t[6]=n=>l())},null,40,Q))}},J=["transform"],K=["fill"],W=["fill"],X={class:"chord-name","text-anchor":"middle",fill:"white",x:80,y:-40},Y={class:"chord-name","text-anchor":"middle",fill:"white",x:80,y:55},Z=["transform"],_=["transform"],ee={__name:"TonalArray",setup(a){const $=[...z].map((e,s)=>({name:e,pitch:s})),r=P({pressed:!1,r:28,dx:80,rowNum:12,colNum:12,rows:[0,9,5,2,10],bgRows:[4,0,9,5,2,10,7],chords:[[0,3,7],[0,3,8],[0,5,8],[0,5,9],[0,4,9],[0,4,7]]}),u=h(()=>{let e=N.chroma.split("").map(Number);return b(e,-N.tonic)}),c=h(()=>r.dx*2*.866),v=h(()=>{let e=[];for(let s=0;s<12;s++)e[s]=$[7*s%12];return e});function f(e){return!u.value[e]||!u.value[(e+4)%12]||!u.value[(e+7)%12]}function x(e){return!u.value[e]||!u.value[(e+3)%12]||!u.value[(e+7)%12]}return(e,s)=>(i(),d("svg",{class:"min-h-80svh max-h-100svh",id:"tonal-array",viewBox:"-80 -110 1040 770",version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},onTouchstart:s[1]||(s[1]=k(l=>r.pressed=!0,["stop","prevent"])),onTouchend:s[2]||(s[2]=k(l=>r.pressed=!1,["stop","prevent"])),onMousedown:s[3]||(s[3]=k(l=>r.pressed=!0,["stop","prevent"])),onMouseup:s[4]||(s[4]=k(l=>r.pressed=!1,["stop","prevent"])),onMouseleave:s[5]||(s[5]=l=>r.pressed=!1)},[s[6]||(s[6]=m("clipPath",{id:"grid-mask"},[m("rect",{x:-80,y:-110,width:1040,height:770})],-1)),(i(!0),d(y,null,g(r.bgRows,(l,o)=>(i(),d("g",{key:l,"clip-path":"url(#grid-mask)"},[(i(!0),d(y,null,g(p(b)(v.value,l-1).splice(0,7),(t,n)=>(i(),d("g",{key:t,transform:`translate(${(n-1)*2*r.dx+(o+1)%2*r.dx}, ${(o-1)*c.value})`},[m("polygon",{class:"chord-triangle",fill:x(t.pitch)?p(w)(t.pitch,1,.2):p(w)(t.pitch,3),points:"0,0 160,0 80,138.56"},null,8,K),m("polygon",{class:"chord-triangle major",fill:f(t.pitch)?p(w)(t.pitch,1,.2):p(w)(t.pitch,2),points:"0,0 160,0 80,-138.56"},null,8,W),m("text",X,T(t.name)+"M",1),m("text",Y,T(t.name)+"m",1)],8,J))),128))]))),128)),(i(!0),d(y,null,g(r.rows,(l,o)=>(i(),d("g",{class:"cursor-crosshair",key:o},[(i(!0),d(y,null,g(p(b)(v.value,l).splice(0,7),(t,n)=>(i(),d("g",{key:t,transform:`translate(${n*2*r.dx+o%2*r.dx}, ${o*c.value})`},[(i(!0),d(y,null,g(r.chords,(M,B)=>(i(),E(U,{key:B,"active-steps":u.value,chord:M,p:B,note:t,pressed:r.pressed},null,8,["active-steps","chord","p","note","pressed"]))),128))],8,Z))),128))]))),128)),(i(!0),d(y,null,g(r.rows,(l,o)=>(i(),d("g",{key:o},[(i(!0),d(y,null,g(p(b)(v.value,l).splice(0,6),(t,n)=>(i(),d("g",{key:n,transform:"translate("+(n*2*r.dx+o%2*r.dx)+","+o*c.value+")"},[O(L,{pressed:r.pressed,"onUpdate:pressed":s[0]||(s[0]=M=>r.pressed=M),available:!!u.value[t.pitch],tonic:p(N).tonic,note:t,r:r.r},null,8,["pressed","available","tonic","note","r"])],8,_))),128))]))),128))],32))}},oe=F(ee,[["__scopeId","data-v-bd27fa1f"]]);export{oe as default};
