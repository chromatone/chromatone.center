var Jr=Object.defineProperty;var Qr=(n,t,e)=>t in n?Jr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var xn=(n,t,e)=>Qr(n,typeof t!="symbol"?t+"":t,e);import{E as nr}from"./theme.ClaafdjQ.js";import{e as ts}from"./events.BUvirThg.js";import{x as es,y as ns,ac as rs,A as ss,G as is,E as os}from"./framework.DIQG-TE4.js";function Tn(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`positive integer expected, not ${n}`)}function as(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function Ee(n,...t){if(!as(n))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(n.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${n.length}`)}function cs(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Tn(n.outputLen),Tn(n.blockLen)}function ge(n,t=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(t&&n.finished)throw new Error("Hash#digest() has already been called")}function ls(n,t){Ee(n);const e=t.outputLen;if(n.length<e)throw new Error(`digestInto() expects output buffer of length at least ${e}`)}const ve=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ke=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),ct=(n,t)=>n<<32-t|n>>>t;new Uint8Array(new Uint32Array([287454020]).buffer)[0];function us(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function Qe(n){return typeof n=="string"&&(n=us(n)),Ee(n),n}function hs(...n){let t=0;for(let r=0;r<n.length;r++){const s=n[r];Ee(s),t+=s.length}const e=new Uint8Array(t);for(let r=0,s=0;r<n.length;r++){const i=n[r];e.set(i,s),s+=i.length}return e}class rr{clone(){return this._cloneInto()}}function ds(n){const t=r=>n().update(Qe(r)).digest(),e=n();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>n(),t}function sr(n=32){if(ve&&typeof ve.getRandomValues=="function")return ve.getRandomValues(new Uint8Array(n));throw new Error("crypto.getRandomValues must be defined")}function fs(n,t,e,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(t,e,r);const s=BigInt(32),i=BigInt(4294967295),o=Number(e>>s&i),u=Number(e&i),h=r?4:0,l=r?0:4;n.setUint32(t+h,o,r),n.setUint32(t+l,u,r)}const ps=(n,t,e)=>n&t^~n&e,_s=(n,t,e)=>n&t^n&e^t&e;class gs extends rr{constructor(t,e,r,s){super(),this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=ke(this.buffer)}update(t){ge(this);const{view:e,buffer:r,blockLen:s}=this;t=Qe(t);const i=t.length;for(let o=0;o<i;){const u=Math.min(s-this.pos,i-o);if(u===s){const h=ke(t);for(;s<=i-o;o+=s)this.process(h,o);continue}r.set(t.subarray(o,o+u),this.pos),this.pos+=u,o+=u,this.pos===s&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ge(this),ls(t,this),this.finished=!0;const{buffer:e,view:r,blockLen:s,isLE:i}=this;let{pos:o}=this;e[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(r,0),o=0);for(let c=o;c<s;c++)e[c]=0;fs(r,s-8,BigInt(this.length*8),i),this.process(r,0);const u=ke(t),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=h/4,a=this.get();if(l>a.length)throw new Error("_sha2: outputLen bigger than state");for(let c=0;c<l;c++)u.setUint32(4*c,a[c],i)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:r,length:s,finished:i,destroyed:o,pos:u}=this;return t.length=s,t.pos=u,t.finished=i,t.destroyed=o,s%e&&t.buffer.set(r),t}}const ys=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),_t=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),gt=new Uint32Array(64);class ms extends gs{constructor(){super(64,32,8,!1),this.A=_t[0]|0,this.B=_t[1]|0,this.C=_t[2]|0,this.D=_t[3]|0,this.E=_t[4]|0,this.F=_t[5]|0,this.G=_t[6]|0,this.H=_t[7]|0}get(){const{A:t,B:e,C:r,D:s,E:i,F:o,G:u,H:h}=this;return[t,e,r,s,i,o,u,h]}set(t,e,r,s,i,o,u,h){this.A=t|0,this.B=e|0,this.C=r|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=u|0,this.H=h|0}process(t,e){for(let c=0;c<16;c++,e+=4)gt[c]=t.getUint32(e,!1);for(let c=16;c<64;c++){const f=gt[c-15],S=gt[c-2],x=ct(f,7)^ct(f,18)^f>>>3,p=ct(S,17)^ct(S,19)^S>>>10;gt[c]=p+gt[c-7]+x+gt[c-16]|0}let{A:r,B:s,C:i,D:o,E:u,F:h,G:l,H:a}=this;for(let c=0;c<64;c++){const f=ct(u,6)^ct(u,11)^ct(u,25),S=a+f+ps(u,h,l)+ys[c]+gt[c]|0,p=(ct(r,2)^ct(r,13)^ct(r,22))+_s(r,s,i)|0;a=l,l=h,h=u,u=o+S|0,o=i,i=s,s=r,r=S+p|0}r=r+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,u=u+this.E|0,h=h+this.F|0,l=l+this.G|0,a=a+this.H|0,this.set(r,s,i,o,u,h,l,a)}roundClean(){gt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Me=ds(()=>new ms);class ir extends rr{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,cs(t);const r=Qe(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(r.length>s?t.create().update(r).digest():r);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=t.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),i.fill(0)}update(t){return ge(this),this.iHash.update(t),this}digestInto(t){ge(this),Ee(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:r,finished:s,destroyed:i,blockLen:o,outputLen:u}=this;return t=t,t.finished=s,t.destroyed=i,t.blockLen=o,t.outputLen=u,t.oHash=e._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const or=(n,t,e)=>new ir(n,t).update(e).digest();or.create=(n,t)=>new ir(n,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ar=BigInt(0),Se=BigInt(1),bs=BigInt(2);function Ct(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function ee(n){if(!Ct(n))throw new Error("Uint8Array expected")}const ws=Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0"));function qt(n){ee(n);let t="";for(let e=0;e<n.length;e++)t+=ws[n[e]];return t}function cr(n){const t=n.toString(16);return t.length&1?`0${t}`:t}function tn(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return BigInt(n===""?"0":`0x${n}`)}const lt={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function An(n){if(n>=lt._0&&n<=lt._9)return n-lt._0;if(n>=lt._A&&n<=lt._F)return n-(lt._A-10);if(n>=lt._a&&n<=lt._f)return n-(lt._a-10)}function Ht(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const t=n.length,e=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(e);for(let s=0,i=0;s<e;s++,i+=2){const o=An(n.charCodeAt(i)),u=An(n.charCodeAt(i+1));if(o===void 0||u===void 0){const h=n[i]+n[i+1];throw new Error('hex string expected, got non-hex character "'+h+'" at index '+i)}r[s]=o*16+u}return r}function nt(n){return tn(qt(n))}function en(n){return ee(n),tn(qt(Uint8Array.from(n).reverse()))}function mt(n,t){return Ht(n.toString(16).padStart(t*2,"0"))}function nn(n,t){return mt(n,t).reverse()}function Es(n){return Ht(cr(n))}function tt(n,t,e){let r;if(typeof t=="string")try{r=Ht(t)}catch(i){throw new Error(`${n} must be valid hex string, got "${t}". Cause: ${i}`)}else if(Ct(t))r=Uint8Array.from(t);else throw new Error(`${n} must be hex string or Uint8Array`);const s=r.length;if(typeof e=="number"&&s!==e)throw new Error(`${n} expected ${e} bytes, got ${s}`);return r}function Rt(...n){let t=0;for(let r=0;r<n.length;r++){const s=n[r];ee(s),t+=s.length}const e=new Uint8Array(t);for(let r=0,s=0;r<n.length;r++){const i=n[r];e.set(i,s),s+=i.length}return e}function Ss(n,t){if(n.length!==t.length)return!1;let e=0;for(let r=0;r<n.length;r++)e|=n[r]^t[r];return e===0}function xs(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function Ts(n){let t;for(t=0;n>ar;n>>=Se,t+=1);return t}function As(n,t){return n>>BigInt(t)&Se}function Cs(n,t,e){return n|(e?Se:ar)<<BigInt(t)}const rn=n=>(bs<<BigInt(n-1))-Se,De=n=>new Uint8Array(n),Cn=n=>Uint8Array.from(n);function lr(n,t,e){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let r=De(n),s=De(n),i=0;const o=()=>{r.fill(1),s.fill(0),i=0},u=(...c)=>e(s,r,...c),h=(c=De())=>{s=u(Cn([0]),c),r=u(),c.length!==0&&(s=u(Cn([1]),c),r=u())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let c=0;const f=[];for(;c<t;){r=u();const S=r.slice();f.push(S),c+=r.length}return Rt(...f)};return(c,f)=>{o(),h(c);let S;for(;!(S=f(l()));)h();return o(),S}}const Rs={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||Ct(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,t)=>t.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function ne(n,t,e={}){const r=(s,i,o)=>{const u=Rs[i];if(typeof u!="function")throw new Error(`Invalid validator "${i}", expected function`);const h=n[s];if(!(o&&h===void 0)&&!u(h,n))throw new Error(`Invalid param ${String(s)}=${h} (${typeof h}), expected ${i}`)};for(const[s,i]of Object.entries(t))r(s,i,!1);for(const[s,i]of Object.entries(e))r(s,i,!0);return n}const Is=Object.freeze(Object.defineProperty({__proto__:null,abytes:ee,bitGet:As,bitLen:Ts,bitMask:rn,bitSet:Cs,bytesToHex:qt,bytesToNumberBE:nt,bytesToNumberLE:en,concatBytes:Rt,createHmacDrbg:lr,ensureBytes:tt,equalBytes:Ss,hexToBytes:Ht,hexToNumber:tn,isBytes:Ct,numberToBytesBE:mt,numberToBytesLE:nn,numberToHexUnpadded:cr,numberToVarBytesBE:Es,utf8ToBytes:xs,validateObject:ne},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const X=BigInt(0),Y=BigInt(1),xt=BigInt(2),Ns=BigInt(3),qe=BigInt(4),Rn=BigInt(5),In=BigInt(8);BigInt(9);BigInt(16);function J(n,t){const e=n%t;return e>=X?e:t+e}function vs(n,t,e){if(e<=X||t<X)throw new Error("Expected power/modulo > 0");if(e===Y)return X;let r=Y;for(;t>X;)t&Y&&(r=r*n%e),n=n*n%e,t>>=Y;return r}function st(n,t,e){let r=n;for(;t-- >X;)r*=r,r%=e;return r}function He(n,t){if(n===X||t<=X)throw new Error(`invert: expected positive integers, got n=${n} mod=${t}`);let e=J(n,t),r=t,s=X,i=Y;for(;e!==X;){const u=r/e,h=r%e,l=s-i*u;r=e,e=h,s=i,i=l}if(r!==Y)throw new Error("invert: does not exist");return J(s,t)}function ks(n){const t=(n-Y)/xt;let e,r,s;for(e=n-Y,r=0;e%xt===X;e/=xt,r++);for(s=xt;s<n&&vs(s,t,n)!==n-Y;s++);if(r===1){const o=(n+Y)/qe;return function(h,l){const a=h.pow(l,o);if(!h.eql(h.sqr(a),l))throw new Error("Cannot find square root");return a}}const i=(e+Y)/xt;return function(u,h){if(u.pow(h,t)===u.neg(u.ONE))throw new Error("Cannot find square root");let l=r,a=u.pow(u.mul(u.ONE,s),e),c=u.pow(h,i),f=u.pow(h,e);for(;!u.eql(f,u.ONE);){if(u.eql(f,u.ZERO))return u.ZERO;let S=1;for(let p=u.sqr(f);S<l&&!u.eql(p,u.ONE);S++)p=u.sqr(p);const x=u.pow(a,Y<<BigInt(l-S-1));a=u.sqr(x),c=u.mul(c,x),f=u.mul(f,a),l=S}return c}}function Ds(n){if(n%qe===Ns){const t=(n+Y)/qe;return function(r,s){const i=r.pow(s,t);if(!r.eql(r.sqr(i),s))throw new Error("Cannot find square root");return i}}if(n%In===Rn){const t=(n-Rn)/In;return function(r,s){const i=r.mul(s,xt),o=r.pow(i,t),u=r.mul(s,o),h=r.mul(r.mul(u,xt),o),l=r.mul(u,r.sub(h,r.ONE));if(!r.eql(r.sqr(l),s))throw new Error("Cannot find square root");return l}}return ks(n)}const Bs=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Os(n){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=Bs.reduce((r,s)=>(r[s]="function",r),t);return ne(n,e)}function Ps(n,t,e){if(e<X)throw new Error("Expected power > 0");if(e===X)return n.ONE;if(e===Y)return t;let r=n.ONE,s=t;for(;e>X;)e&Y&&(r=n.mul(r,s)),s=n.sqr(s),e>>=Y;return r}function Us(n,t){const e=new Array(t.length),r=t.reduce((i,o,u)=>n.is0(o)?i:(e[u]=i,n.mul(i,o)),n.ONE),s=n.inv(r);return t.reduceRight((i,o,u)=>n.is0(o)?i:(e[u]=n.mul(i,e[u]),n.mul(i,o)),s),e}function ur(n,t){const e=t!==void 0?t:n.toString(2).length,r=Math.ceil(e/8);return{nBitLength:e,nByteLength:r}}function Fs(n,t,e=!1,r={}){if(n<=X)throw new Error(`Expected Field ORDER > 0, got ${n}`);const{nBitLength:s,nByteLength:i}=ur(n,t);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=Ds(n),u=Object.freeze({ORDER:n,BITS:s,BYTES:i,MASK:rn(s),ZERO:X,ONE:Y,create:h=>J(h,n),isValid:h=>{if(typeof h!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof h}`);return X<=h&&h<n},is0:h=>h===X,isOdd:h=>(h&Y)===Y,neg:h=>J(-h,n),eql:(h,l)=>h===l,sqr:h=>J(h*h,n),add:(h,l)=>J(h+l,n),sub:(h,l)=>J(h-l,n),mul:(h,l)=>J(h*l,n),pow:(h,l)=>Ps(u,h,l),div:(h,l)=>J(h*He(l,n),n),sqrN:h=>h*h,addN:(h,l)=>h+l,subN:(h,l)=>h-l,mulN:(h,l)=>h*l,inv:h=>He(h,n),sqrt:r.sqrt||(h=>o(u,h)),invertBatch:h=>Us(u,h),cmov:(h,l,a)=>a?l:h,toBytes:h=>e?nn(h,i):mt(h,i),fromBytes:h=>{if(h.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${h.length}`);return e?en(h):nt(h)}});return Object.freeze(u)}function hr(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const t=n.toString(2).length;return Math.ceil(t/8)}function dr(n){const t=hr(n);return t+Math.ceil(t/2)}function Ls(n,t,e=!1){const r=n.length,s=hr(t),i=dr(t);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);const o=e?nt(n):en(n),u=J(o,t-Y)+Y;return e?nn(u,s):mt(u,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ms=BigInt(0),Be=BigInt(1);function qs(n,t){const e=(s,i)=>{const o=i.negate();return s?o:i},r=s=>{const i=Math.ceil(t/s)+1,o=2**(s-1);return{windows:i,windowSize:o}};return{constTimeNegate:e,unsafeLadder(s,i){let o=n.ZERO,u=s;for(;i>Ms;)i&Be&&(o=o.add(u)),u=u.double(),i>>=Be;return o},precomputeWindow(s,i){const{windows:o,windowSize:u}=r(i),h=[];let l=s,a=l;for(let c=0;c<o;c++){a=l,h.push(a);for(let f=1;f<u;f++)a=a.add(l),h.push(a);l=a.double()}return h},wNAF(s,i,o){const{windows:u,windowSize:h}=r(s);let l=n.ZERO,a=n.BASE;const c=BigInt(2**s-1),f=2**s,S=BigInt(s);for(let x=0;x<u;x++){const p=x*h;let m=Number(o&c);o>>=S,m>h&&(m-=f,o+=Be);const b=p,A=p+Math.abs(m)-1,I=x%2!==0,D=m<0;m===0?a=a.add(e(I,i[b])):l=l.add(e(D,i[A]))}return{p:l,f:a}},wNAFCached(s,i,o,u){const h=s._WINDOW_SIZE||1;let l=i.get(s);return l||(l=this.precomputeWindow(s,h),h!==1&&i.set(s,u(l))),this.wNAF(h,l,o)}}}function fr(n){return Os(n.Fp),ne(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ur(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Hs(n){const t=fr(n);ne(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:e,Fp:r,a:s}=t;if(e){if(!r.eql(s,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:$s,hexToBytes:Ws}=Is,Tt={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(n){const{Err:t}=Tt;if(n.length<2||n[0]!==2)throw new t("Invalid signature integer tag");const e=n[1],r=n.subarray(2,e+2);if(!e||r.length!==e)throw new t("Invalid signature integer: wrong length");if(r[0]&128)throw new t("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:$s(r),l:n.subarray(e+2)}},toSig(n){const{Err:t}=Tt,e=typeof n=="string"?Ws(n):n;ee(e);let r=e.length;if(r<2||e[0]!=48)throw new t("Invalid signature tag");if(e[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:s,l:i}=Tt._parseInt(e.subarray(2)),{d:o,l:u}=Tt._parseInt(i);if(u.length)throw new t("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(n){const t=l=>Number.parseInt(l[0],16)&8?"00"+l:l,e=l=>{const a=l.toString(16);return a.length&1?`0${a}`:a},r=t(e(n.s)),s=t(e(n.r)),i=r.length/2,o=s.length/2,u=e(i),h=e(o);return`30${e(o+i+4)}02${h}${s}02${u}${r}`}},ht=BigInt(0),it=BigInt(1);BigInt(2);const Nn=BigInt(3);BigInt(4);function js(n){const t=Hs(n),{Fp:e}=t,r=t.toBytes||((x,p,m)=>{const b=p.toAffine();return Rt(Uint8Array.from([4]),e.toBytes(b.x),e.toBytes(b.y))}),s=t.fromBytes||(x=>{const p=x.subarray(1),m=e.fromBytes(p.subarray(0,e.BYTES)),b=e.fromBytes(p.subarray(e.BYTES,2*e.BYTES));return{x:m,y:b}});function i(x){const{a:p,b:m}=t,b=e.sqr(x),A=e.mul(b,x);return e.add(e.add(A,e.mul(x,p)),m)}if(!e.eql(e.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function o(x){return typeof x=="bigint"&&ht<x&&x<t.n}function u(x){if(!o(x))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function h(x){const{allowedPrivateKeyLengths:p,nByteLength:m,wrapPrivateKey:b,n:A}=t;if(p&&typeof x!="bigint"){if(Ct(x)&&(x=qt(x)),typeof x!="string"||!p.includes(x.length))throw new Error("Invalid key");x=x.padStart(m*2,"0")}let I;try{I=typeof x=="bigint"?x:nt(tt("private key",x,m))}catch{throw new Error(`private key must be ${m} bytes, hex or bigint, not ${typeof x}`)}return b&&(I=J(I,A)),u(I),I}const l=new Map;function a(x){if(!(x instanceof c))throw new Error("ProjectivePoint expected")}class c{constructor(p,m,b){if(this.px=p,this.py=m,this.pz=b,p==null||!e.isValid(p))throw new Error("x required");if(m==null||!e.isValid(m))throw new Error("y required");if(b==null||!e.isValid(b))throw new Error("z required")}static fromAffine(p){const{x:m,y:b}=p||{};if(!p||!e.isValid(m)||!e.isValid(b))throw new Error("invalid affine point");if(p instanceof c)throw new Error("projective point not allowed");const A=I=>e.eql(I,e.ZERO);return A(m)&&A(b)?c.ZERO:new c(m,b,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(p){const m=e.invertBatch(p.map(b=>b.pz));return p.map((b,A)=>b.toAffine(m[A])).map(c.fromAffine)}static fromHex(p){const m=c.fromAffine(s(tt("pointHex",p)));return m.assertValidity(),m}static fromPrivateKey(p){return c.BASE.multiply(h(p))}_setWindowSize(p){this._WINDOW_SIZE=p,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!e.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:p,y:m}=this.toAffine();if(!e.isValid(p)||!e.isValid(m))throw new Error("bad point: x or y not FE");const b=e.sqr(m),A=i(p);if(!e.eql(b,A))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:p}=this.toAffine();if(e.isOdd)return!e.isOdd(p);throw new Error("Field doesn't support isOdd")}equals(p){a(p);const{px:m,py:b,pz:A}=this,{px:I,py:D,pz:k}=p,T=e.eql(e.mul(m,k),e.mul(I,A)),R=e.eql(e.mul(b,k),e.mul(D,A));return T&&R}negate(){return new c(this.px,e.neg(this.py),this.pz)}double(){const{a:p,b:m}=t,b=e.mul(m,Nn),{px:A,py:I,pz:D}=this;let k=e.ZERO,T=e.ZERO,R=e.ZERO,v=e.mul(A,A),K=e.mul(I,I),L=e.mul(D,D),U=e.mul(A,I);return U=e.add(U,U),R=e.mul(A,D),R=e.add(R,R),k=e.mul(p,R),T=e.mul(b,L),T=e.add(k,T),k=e.sub(K,T),T=e.add(K,T),T=e.mul(k,T),k=e.mul(U,k),R=e.mul(b,R),L=e.mul(p,L),U=e.sub(v,L),U=e.mul(p,U),U=e.add(U,R),R=e.add(v,v),v=e.add(R,v),v=e.add(v,L),v=e.mul(v,U),T=e.add(T,v),L=e.mul(I,D),L=e.add(L,L),v=e.mul(L,U),k=e.sub(k,v),R=e.mul(L,K),R=e.add(R,R),R=e.add(R,R),new c(k,T,R)}add(p){a(p);const{px:m,py:b,pz:A}=this,{px:I,py:D,pz:k}=p;let T=e.ZERO,R=e.ZERO,v=e.ZERO;const K=t.a,L=e.mul(t.b,Nn);let U=e.mul(m,I),_=e.mul(b,D),E=e.mul(A,k),N=e.add(m,b),d=e.add(I,D);N=e.mul(N,d),d=e.add(U,_),N=e.sub(N,d),d=e.add(m,A);let g=e.add(I,k);return d=e.mul(d,g),g=e.add(U,E),d=e.sub(d,g),g=e.add(b,A),T=e.add(D,k),g=e.mul(g,T),T=e.add(_,E),g=e.sub(g,T),v=e.mul(K,d),T=e.mul(L,E),v=e.add(T,v),T=e.sub(_,v),v=e.add(_,v),R=e.mul(T,v),_=e.add(U,U),_=e.add(_,U),E=e.mul(K,E),d=e.mul(L,d),_=e.add(_,E),E=e.sub(U,E),E=e.mul(K,E),d=e.add(d,E),U=e.mul(_,d),R=e.add(R,U),U=e.mul(g,d),T=e.mul(N,T),T=e.sub(T,U),U=e.mul(N,_),v=e.mul(g,v),v=e.add(v,U),new c(T,R,v)}subtract(p){return this.add(p.negate())}is0(){return this.equals(c.ZERO)}wNAF(p){return S.wNAFCached(this,l,p,m=>{const b=e.invertBatch(m.map(A=>A.pz));return m.map((A,I)=>A.toAffine(b[I])).map(c.fromAffine)})}multiplyUnsafe(p){const m=c.ZERO;if(p===ht)return m;if(u(p),p===it)return this;const{endo:b}=t;if(!b)return S.unsafeLadder(this,p);let{k1neg:A,k1:I,k2neg:D,k2:k}=b.splitScalar(p),T=m,R=m,v=this;for(;I>ht||k>ht;)I&it&&(T=T.add(v)),k&it&&(R=R.add(v)),v=v.double(),I>>=it,k>>=it;return A&&(T=T.negate()),D&&(R=R.negate()),R=new c(e.mul(R.px,b.beta),R.py,R.pz),T.add(R)}multiply(p){u(p);let m=p,b,A;const{endo:I}=t;if(I){const{k1neg:D,k1:k,k2neg:T,k2:R}=I.splitScalar(m);let{p:v,f:K}=this.wNAF(k),{p:L,f:U}=this.wNAF(R);v=S.constTimeNegate(D,v),L=S.constTimeNegate(T,L),L=new c(e.mul(L.px,I.beta),L.py,L.pz),b=v.add(L),A=K.add(U)}else{const{p:D,f:k}=this.wNAF(m);b=D,A=k}return c.normalizeZ([b,A])[0]}multiplyAndAddUnsafe(p,m,b){const A=c.BASE,I=(k,T)=>T===ht||T===it||!k.equals(A)?k.multiplyUnsafe(T):k.multiply(T),D=I(this,m).add(I(p,b));return D.is0()?void 0:D}toAffine(p){const{px:m,py:b,pz:A}=this,I=this.is0();p==null&&(p=I?e.ONE:e.inv(A));const D=e.mul(m,p),k=e.mul(b,p),T=e.mul(A,p);if(I)return{x:e.ZERO,y:e.ZERO};if(!e.eql(T,e.ONE))throw new Error("invZ was invalid");return{x:D,y:k}}isTorsionFree(){const{h:p,isTorsionFree:m}=t;if(p===it)return!0;if(m)return m(c,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:p,clearCofactor:m}=t;return p===it?this:m?m(c,this):this.multiplyUnsafe(t.h)}toRawBytes(p=!0){return this.assertValidity(),r(c,this,p)}toHex(p=!0){return qt(this.toRawBytes(p))}}c.BASE=new c(t.Gx,t.Gy,e.ONE),c.ZERO=new c(e.ZERO,e.ONE,e.ZERO);const f=t.nBitLength,S=qs(c,t.endo?Math.ceil(f/2):f);return{CURVE:t,ProjectivePoint:c,normPrivateKeyToScalar:h,weierstrassEquation:i,isWithinCurveOrder:o}}function Vs(n){const t=fr(n);return ne(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Ys(n){const t=Vs(n),{Fp:e,n:r}=t,s=e.BYTES+1,i=2*e.BYTES+1;function o(d){return ht<d&&d<e.ORDER}function u(d){return J(d,r)}function h(d){return He(d,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:a,weierstrassEquation:c,isWithinCurveOrder:f}=js({...t,toBytes(d,g,y){const w=g.toAffine(),C=e.toBytes(w.x),B=Rt;return y?B(Uint8Array.from([g.hasEvenY()?2:3]),C):B(Uint8Array.from([4]),C,e.toBytes(w.y))},fromBytes(d){const g=d.length,y=d[0],w=d.subarray(1);if(g===s&&(y===2||y===3)){const C=nt(w);if(!o(C))throw new Error("Point is not on curve");const B=c(C);let F;try{F=e.sqrt(B)}catch(M){const z=M instanceof Error?": "+M.message:"";throw new Error("Point is not on curve"+z)}const q=(F&it)===it;return(y&1)===1!==q&&(F=e.neg(F)),{x:C,y:F}}else if(g===i&&y===4){const C=e.fromBytes(w.subarray(0,e.BYTES)),B=e.fromBytes(w.subarray(e.BYTES,2*e.BYTES));return{x:C,y:B}}else throw new Error(`Point of length ${g} was invalid. Expected ${s} compressed bytes or ${i} uncompressed bytes`)}}),S=d=>qt(mt(d,t.nByteLength));function x(d){const g=r>>it;return d>g}function p(d){return x(d)?u(-d):d}const m=(d,g,y)=>nt(d.slice(g,y));class b{constructor(g,y,w){this.r=g,this.s=y,this.recovery=w,this.assertValidity()}static fromCompact(g){const y=t.nByteLength;return g=tt("compactSignature",g,y*2),new b(m(g,0,y),m(g,y,2*y))}static fromDER(g){const{r:y,s:w}=Tt.toSig(tt("DER",g));return new b(y,w)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(g){return new b(this.r,this.s,g)}recoverPublicKey(g){const{r:y,s:w,recovery:C}=this,B=R(tt("msgHash",g));if(C==null||![0,1,2,3].includes(C))throw new Error("recovery id invalid");const F=C===2||C===3?y+t.n:y;if(F>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");const q=C&1?"03":"02",O=l.fromHex(q+S(F)),M=h(F),z=u(-B*M),G=u(w*M),Q=l.BASE.multiplyAndAddUnsafe(O,z,G);if(!Q)throw new Error("point at infinify");return Q.assertValidity(),Q}hasHighS(){return x(this.s)}normalizeS(){return this.hasHighS()?new b(this.r,u(-this.s),this.recovery):this}toDERRawBytes(){return Ht(this.toDERHex())}toDERHex(){return Tt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ht(this.toCompactHex())}toCompactHex(){return S(this.r)+S(this.s)}}const A={isValidPrivateKey(d){try{return a(d),!0}catch{return!1}},normPrivateKeyToScalar:a,randomPrivateKey:()=>{const d=dr(t.n);return Ls(t.randomBytes(d),t.n)},precompute(d=8,g=l.BASE){return g._setWindowSize(d),g.multiply(BigInt(3)),g}};function I(d,g=!0){return l.fromPrivateKey(d).toRawBytes(g)}function D(d){const g=Ct(d),y=typeof d=="string",w=(g||y)&&d.length;return g?w===s||w===i:y?w===2*s||w===2*i:d instanceof l}function k(d,g,y=!0){if(D(d))throw new Error("first arg must be private key");if(!D(g))throw new Error("second arg must be public key");return l.fromHex(g).multiply(a(d)).toRawBytes(y)}const T=t.bits2int||function(d){const g=nt(d),y=d.length*8-t.nBitLength;return y>0?g>>BigInt(y):g},R=t.bits2int_modN||function(d){return u(T(d))},v=rn(t.nBitLength);function K(d){if(typeof d!="bigint")throw new Error("bigint expected");if(!(ht<=d&&d<v))throw new Error(`bigint expected < 2^${t.nBitLength}`);return mt(d,t.nByteLength)}function L(d,g,y=U){if(["recovered","canonical"].some(H=>H in y))throw new Error("sign() legacy options not supported");const{hash:w,randomBytes:C}=t;let{lowS:B,prehash:F,extraEntropy:q}=y;B==null&&(B=!0),d=tt("msgHash",d),F&&(d=tt("prehashed msgHash",w(d)));const O=R(d),M=a(g),z=[K(M),K(O)];if(q!=null&&q!==!1){const H=q===!0?C(e.BYTES):q;z.push(tt("extraEntropy",H))}const G=Rt(...z),Q=O;function Z(H){const $=T(H);if(!f($))return;const W=h($),V=l.BASE.multiply($).toAffine(),et=u(V.x);if(et===ht)return;const ot=u(W*u(Q+et*M));if(ot===ht)return;let Ne=(V.x===et?0:2)|Number(V.y&it),Sn=ot;return B&&x(ot)&&(Sn=p(ot),Ne^=1),new b(et,Sn,Ne)}return{seed:G,k2sig:Z}}const U={lowS:t.lowS,prehash:!1},_={lowS:t.lowS,prehash:!1};function E(d,g,y=U){const{seed:w,k2sig:C}=L(d,g,y),B=t;return lr(B.hash.outputLen,B.nByteLength,B.hmac)(w,C)}l.BASE._setWindowSize(8);function N(d,g,y,w=_){var V;const C=d;if(g=tt("msgHash",g),y=tt("publicKey",y),"strict"in w)throw new Error("options.strict was renamed to lowS");const{lowS:B,prehash:F}=w;let q,O;try{if(typeof C=="string"||Ct(C))try{q=b.fromDER(C)}catch(et){if(!(et instanceof Tt.Err))throw et;q=b.fromCompact(C)}else if(typeof C=="object"&&typeof C.r=="bigint"&&typeof C.s=="bigint"){const{r:et,s:ot}=C;q=new b(et,ot)}else throw new Error("PARSE");O=l.fromHex(y)}catch(et){if(et.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(B&&q.hasHighS())return!1;F&&(g=t.hash(g));const{r:M,s:z}=q,G=R(g),Q=h(z),Z=u(G*Q),H=u(M*Q),$=(V=l.BASE.multiplyAndAddUnsafe(O,Z,H))==null?void 0:V.toAffine();return $?u($.x)===M:!1}return{CURVE:t,getPublicKey:I,getSharedSecret:k,sign:E,verify:N,ProjectivePoint:l,Signature:b,utils:A}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Gs(n){return{hash:n,hmac:(t,...e)=>or(n,t,hs(...e)),randomBytes:sr}}function Ks(n,t){const e=r=>Ys({...n,...Gs(r)});return Object.freeze({...e(t),create:e})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const xe=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),ye=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),pr=BigInt(1),me=BigInt(2),vn=(n,t)=>(n+t/me)/t;function _r(n){const t=xe,e=BigInt(3),r=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),u=BigInt(44),h=BigInt(88),l=n*n*n%t,a=l*l*n%t,c=st(a,e,t)*a%t,f=st(c,e,t)*a%t,S=st(f,me,t)*l%t,x=st(S,s,t)*S%t,p=st(x,i,t)*x%t,m=st(p,u,t)*p%t,b=st(m,h,t)*m%t,A=st(b,u,t)*p%t,I=st(A,e,t)*a%t,D=st(I,o,t)*x%t,k=st(D,r,t)*l%t,T=st(k,me,t);if(!$e.eql($e.sqr(T),n))throw new Error("Cannot find square root");return T}const $e=Fs(xe,void 0,void 0,{sqrt:_r}),sn=Ks({a:BigInt(0),b:BigInt(7),Fp:$e,n:ye,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const t=ye,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-pr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=e,o=BigInt("0x100000000000000000000000000000000"),u=vn(i*n,t),h=vn(-r*n,t);let l=J(n-u*e-h*s,t),a=J(-u*r-h*i,t);const c=l>o,f=a>o;if(c&&(l=t-l),f&&(a=t-a),l>o||a>o)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:c,k1:l,k2neg:f,k2:a}}}},Me),Te=BigInt(0),gr=n=>typeof n=="bigint"&&Te<n&&n<xe,zs=n=>typeof n=="bigint"&&Te<n&&n<ye,kn={};function be(n,...t){let e=kn[n];if(e===void 0){const r=Me(Uint8Array.from(n,s=>s.charCodeAt(0)));e=Rt(r,r),kn[n]=e}return Me(Rt(e,...t))}const on=n=>n.toRawBytes(!0).slice(1),We=n=>mt(n,32),Oe=n=>J(n,xe),Gt=n=>J(n,ye),an=sn.ProjectivePoint,Zs=(n,t,e)=>an.BASE.multiplyAndAddUnsafe(n,t,e);function je(n){let t=sn.utils.normPrivateKeyToScalar(n),e=an.fromPrivateKey(t);return{scalar:e.hasEvenY()?t:Gt(-t),bytes:on(e)}}function yr(n){if(!gr(n))throw new Error("bad x: need 0 < x < p");const t=Oe(n*n),e=Oe(t*n+BigInt(7));let r=_r(e);r%me!==Te&&(r=Oe(-r));const s=new an(n,r,pr);return s.assertValidity(),s}function mr(...n){return Gt(nt(be("BIP0340/challenge",...n)))}function Xs(n){return je(n).bytes}function Js(n,t,e=sr(32)){const r=tt("message",n),{bytes:s,scalar:i}=je(t),o=tt("auxRand",e,32),u=We(i^nt(be("BIP0340/aux",o))),h=be("BIP0340/nonce",u,s,r),l=Gt(nt(h));if(l===Te)throw new Error("sign failed: k is zero");const{bytes:a,scalar:c}=je(l),f=mr(a,s,r),S=new Uint8Array(64);if(S.set(a,0),S.set(We(Gt(c+f*i)),32),!br(S,r,s))throw new Error("sign: Invalid signature produced");return S}function br(n,t,e){const r=tt("signature",n,64),s=tt("message",t),i=tt("publicKey",e,32);try{const o=yr(nt(i)),u=nt(r.subarray(0,32));if(!gr(u))return!1;const h=nt(r.subarray(32,64));if(!zs(h))return!1;const l=mr(We(u),on(o),s),a=Zs(o,h,Gt(-l));return!(!a||!a.hasEvenY()||a.toAffine().x!==u)}catch{return!1}}const cn={getPublicKey:Xs,sign:Js,verify:br,utils:{randomPrivateKey:sn.utils.randomPrivateKey,lift_x:yr,pointToBytes:on,numberToBytesBE:mt,bytesToNumberBE:nt,taggedHash:be,mod:J}},Kt="Trystero",zt=(n,t)=>Array(n).fill().map(t),Dn="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",Ve=n=>zt(n,()=>Dn[Math.floor(Math.random()*Dn.length)]).join(""),Ut=Ve(20),Ft=Promise.all.bind(Promise),ln=typeof window<"u",{entries:Bn,fromEntries:Qs,keys:ti}=Object,St=()=>{},ut=n=>new Error(`${Kt}: ${n}`),ei=new TextEncoder,ni=new TextDecoder,At=n=>ei.encode(n),de=n=>ni.decode(n),Ye=n=>n.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),""),ae=(...n)=>n.join("@"),ri=(n,t,e)=>(n.relayUrls||t).slice(0,n.relayUrls?n.relayUrls.length:n.relayRedundancy||e),ft=JSON.stringify,we=JSON.parse,On=3333,Ot={},si=(n,t)=>{const e={},r=()=>{const s=new WebSocket(n);s.onclose=()=>{Ot[n]??(Ot[n]=On),setTimeout(r,Ot[n]),Ot[n]*=2},s.onmessage=i=>t(i.data),e.socket=s,e.url=s.url,e.ready=new Promise(i=>s.onopen=()=>{i(e),Ot[n]=On}),e.send=i=>{s.readyState===1&&s.send(i)}};return r(),e},un="AES-GCM",Pe={},ii=n=>btoa(String.fromCharCode.apply(null,new Uint8Array(n))),oi=n=>{const t=atob(n);return new Uint8Array(t.length).map((e,r)=>t.charCodeAt(r)).buffer},ce=async n=>{if(Pe[n])return Pe[n];const t=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",At(n)))).map(e=>e.toString(36)).join("");return Pe[n]=t,t},ai=async(n,t,e)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},At(`${n}:${t}:${e}`)),{name:un},!1,["encrypt","decrypt"]),wr="$",Er=",",ci=async(n,t)=>{const e=crypto.getRandomValues(new Uint8Array(16));return e.join(Er)+wr+ii(await crypto.subtle.encrypt({name:un,iv:e},await n,At(t)))},li=async(n,t)=>{const[e,r]=t.split(wr);return de(await crypto.subtle.decrypt({name:un,iv:new Uint8Array(e.split(Er))},await n,oi(r)))};var Ge={exports:{}},Ue,Pn;function ui(){if(Pn)return Ue;Pn=1;var n=1e3,t=n*60,e=t*60,r=e*24,s=r*7,i=r*365.25;Ue=function(a,c){c=c||{};var f=typeof a;if(f==="string"&&a.length>0)return o(a);if(f==="number"&&isFinite(a))return c.long?h(a):u(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))};function o(a){if(a=String(a),!(a.length>100)){var c=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(a);if(c){var f=parseFloat(c[1]),S=(c[2]||"ms").toLowerCase();switch(S){case"years":case"year":case"yrs":case"yr":case"y":return f*i;case"weeks":case"week":case"w":return f*s;case"days":case"day":case"d":return f*r;case"hours":case"hour":case"hrs":case"hr":case"h":return f*e;case"minutes":case"minute":case"mins":case"min":case"m":return f*t;case"seconds":case"second":case"secs":case"sec":case"s":return f*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function u(a){var c=Math.abs(a);return c>=r?Math.round(a/r)+"d":c>=e?Math.round(a/e)+"h":c>=t?Math.round(a/t)+"m":c>=n?Math.round(a/n)+"s":a+"ms"}function h(a){var c=Math.abs(a);return c>=r?l(a,c,r,"day"):c>=e?l(a,c,e,"hour"):c>=t?l(a,c,t,"minute"):c>=n?l(a,c,n,"second"):a+" ms"}function l(a,c,f,S){var x=c>=f*1.5;return Math.round(a/f)+" "+S+(x?"s":"")}return Ue}function hi(n){e.debug=e,e.default=e,e.coerce=h,e.disable=i,e.enable=s,e.enabled=o,e.humanize=ui(),e.destroy=l,Object.keys(n).forEach(a=>{e[a]=n[a]}),e.names=[],e.skips=[],e.formatters={};function t(a){let c=0;for(let f=0;f<a.length;f++)c=(c<<5)-c+a.charCodeAt(f),c|=0;return e.colors[Math.abs(c)%e.colors.length]}e.selectColor=t;function e(a){let c,f=null,S,x;function p(...m){if(!p.enabled)return;const b=p,A=Number(new Date),I=A-(c||A);b.diff=I,b.prev=c,b.curr=A,c=A,m[0]=e.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let D=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(T,R)=>{if(T==="%%")return"%";D++;const v=e.formatters[R];if(typeof v=="function"){const K=m[D];T=v.call(b,K),m.splice(D,1),D--}return T}),e.formatArgs.call(b,m),(b.log||e.log).apply(b,m)}return p.namespace=a,p.useColors=e.useColors(),p.color=e.selectColor(a),p.extend=r,p.destroy=e.destroy,Object.defineProperty(p,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(S!==e.namespaces&&(S=e.namespaces,x=e.enabled(a)),x),set:m=>{f=m}}),typeof e.init=="function"&&e.init(p),p}function r(a,c){const f=e(this.namespace+(typeof c>"u"?":":c)+a);return f.log=this.log,f}function s(a){e.save(a),e.namespaces=a,e.names=[],e.skips=[];let c;const f=(typeof a=="string"?a:"").split(/[\s,]+/),S=f.length;for(c=0;c<S;c++)f[c]&&(a=f[c].replace(/\*/g,".*?"),a[0]==="-"?e.skips.push(new RegExp("^"+a.slice(1)+"$")):e.names.push(new RegExp("^"+a+"$")))}function i(){const a=[...e.names.map(u),...e.skips.map(u).map(c=>"-"+c)].join(",");return e.enable(""),a}function o(a){if(a[a.length-1]==="*")return!0;let c,f;for(c=0,f=e.skips.length;c<f;c++)if(e.skips[c].test(a))return!1;for(c=0,f=e.names.length;c<f;c++)if(e.names[c].test(a))return!0;return!1}function u(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function h(a){return a instanceof Error?a.stack||a.message:a}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var di=hi;(function(n,t){var e={};t.formatArgs=s,t.save=i,t.load=o,t.useColors=r,t.storage=u(),t.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const a="color: "+this.color;l.splice(1,0,a,"color: inherit");let c=0,f=0;l[0].replace(/%[a-zA-Z%]/g,S=>{S!=="%%"&&(c++,S==="%c"&&(f=c))}),l.splice(f,0,a)}t.log=console.debug||console.log||(()=>{});function i(l){try{l?t.storage.setItem("debug",l):t.storage.removeItem("debug")}catch{}}function o(){let l;try{l=t.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l=e.DEBUG),l}function u(){try{return localStorage}catch{}}n.exports=di(t);const{formatters:h}=n.exports;h.j=function(l){try{return JSON.stringify(l)}catch(a){return"[UnexpectedJSONParseError]: "+a.message}}})(Ge,Ge.exports);var fi=Ge.exports;const pi=nr(fi),dt=typeof window<"u"?window:self,Ke=dt.RTCPeerConnection||dt.mozRTCPeerConnection||dt.webkitRTCPeerConnection,_i=dt.RTCSessionDescription||dt.mozRTCSessionDescription||dt.webkitRTCSessionDescription,gi=dt.RTCIceCandidate||dt.mozRTCIceCandidate||dt.webkitRTCIceCandidate;var yi=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n),mi=class{constructor(t){if(!(t>0)||t-1&t)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const Un=mi;var bi=class{constructor(t){this.hwm=t||16,this.head=new Un(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(t){if(this.length++,!this.head.push(t)){const e=this.head;this.head=e.next=new Un(2*this.head.buffer.length),this.head.push(t)}}shift(){this.length!==0&&this.length--;const t=this.tail.shift();if(t===void 0&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return t}peek(){const t=this.tail.peek();return t===void 0&&this.tail.next?this.tail.next.peek():t}isEmpty(){return this.length===0}},Sr=class{constructor(t){this.decoder=new TextDecoder(t==="utf16le"?"utf16-le":t)}decode(t){return this.decoder.decode(t,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const wi=Sr,Ei=Sr;var Si=class{constructor(t="utf8"){switch(this.encoding=xi(t),this.encoding){case"utf8":this.decoder=new Ei;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new wi(this.encoding)}}push(t){return typeof t=="string"?t:this.decoder.decode(t)}write(t){return this.push(t)}end(t){let e="";return t&&(e=this.push(t)),e+=this.decoder.flush(),e}};function xi(n){switch(n=n.toLowerCase(),n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:throw new Error("Unknown encoding: "+n)}}const{EventEmitter:Ti}=ts,Ae=new Error("Stream was destroyed"),Fe=new Error("Premature close"),xr=yi,Tr=bi,Ai=Si,j=(1<<29)-1,Dt=1,hn=2,It=4,Zt=8,Ar=j^Dt,Ci=j^hn,re=16,Xt=32,jt=64,yt=128,se=256,dn=512,Nt=1024,ze=2048,fn=4096,pn=8192,at=16384,Lt=32768,Ce=65536,vt=131072,Cr=se|dn,Ri=re|Ce,Ii=jt|re,Ni=fn|yt,_n=se|vt,vi=j^re,ki=j^jt,Di=j^(jt|Ce),Bi=j^Ce,Oi=j^se,Pi=j^(yt|pn),Ui=j^Nt,Fn=j^Cr,Rr=j^Lt,Fi=j^Xt,Ir=j^vt,Li=j^_n,bt=1<<18,$t=2<<18,ie=4<<18,kt=8<<18,oe=16<<18,Bt=32<<18,Ze=64<<18,Mt=128<<18,gn=256<<18,Wt=512<<18,Re=1024<<18,Nr=j^(bt|gn),vr=j^ie,Mi=j^Wt,qi=j^oe,Hi=j^kt,kr=j^Mt,$i=j^$t,Dr=j^Re,Jt=re|bt,Br=j^Jt,yn=at|Bt,pt=It|Zt|hn,rt=pt|Dt,Or=pt|yn,Wi=vr&ki,mn=Mt|Lt,ji=mn&Br,Pr=rt|ji,Vi=rt|Nt|at,Ln=rt|at|yt,Yi=rt|Nt|yt,Gi=rt|fn|yt|pn,Ki=rt|re|Nt|at|Ce|vt,zi=pt|Nt|at,Zi=Xt|rt|Lt|jt,Xi=rt|Wt|Bt,Ji=kt|oe,Ur=kt|bt,Qi=kt|oe|rt|bt,Mn=rt|bt|kt|Re,to=ie|bt,eo=bt|gn,no=rt|Wt|Ur|Bt,ro=oe|pt|Wt|Bt,so=$t|rt|Mt|ie,le=Symbol.asyncIterator||Symbol("asyncIterator");class Fr{constructor(t,{highWaterMark:e=16384,map:r=null,mapWritable:s,byteLength:i,byteLengthWritable:o}={}){this.stream=t,this.queue=new Tr,this.highWaterMark=e,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=o||i||jr,this.map=s||r,this.afterWrite=uo.bind(this),this.afterUpdateNextTick=po.bind(this)}get ended(){return(this.stream._duplexState&Bt)!==0}push(t){return this.map!==null&&(t=this.map(t)),this.buffered+=this.byteLength(t),this.queue.push(t),this.buffered<this.highWaterMark?(this.stream._duplexState|=kt,!0):(this.stream._duplexState|=Ji,!1)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),this.buffered===0&&(this.stream._duplexState&=Hi),t}end(t){typeof t=="function"?this.stream.once("finish",t):t!=null&&this.push(t),this.stream._duplexState=(this.stream._duplexState|Wt)&vr}autoBatch(t,e){const r=[],s=this.stream;for(r.push(t);(s._duplexState&Mn)===Ur;)r.push(s._writableState.shift());if(s._duplexState&rt)return e(null);s._writev(r,e)}update(){const t=this.stream;t._duplexState|=$t;do{for(;(t._duplexState&Mn)===kt;){const e=this.shift();t._duplexState|=eo,t._write(e,this.afterWrite)}t._duplexState&to||this.updateNonPrimary()}while(this.continueUpdate()===!0);t._duplexState&=$i}updateNonPrimary(){const t=this.stream;if((t._duplexState&no)===Wt){t._duplexState=(t._duplexState|bt)&Mi,t._final(lo.bind(this));return}if((t._duplexState&pt)===It){t._duplexState&mn||(t._duplexState|=Jt,t._destroy(Lr.bind(this)));return}(t._duplexState&Pr)===Dt&&(t._duplexState=(t._duplexState|Jt)&Ar,t._open(Mr.bind(this)))}continueUpdate(){return this.stream._duplexState&Mt?(this.stream._duplexState&=kr,!0):!1}updateCallback(){(this.stream._duplexState&so)===ie?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&Mt||(this.stream._duplexState|=Mt,this.stream._duplexState&$t||xr(this.afterUpdateNextTick))}}class io{constructor(t,{highWaterMark:e=16384,map:r=null,mapReadable:s,byteLength:i,byteLengthReadable:o}={}){this.stream=t,this.queue=new Tr,this.highWaterMark=e===0?1:e,this.buffered=0,this.readAhead=e>0,this.error=null,this.pipeline=null,this.byteLength=o||i||jr,this.map=s||r,this.pipeTo=null,this.afterRead=ho.bind(this),this.afterUpdateNextTick=fo.bind(this)}get ended(){return(this.stream._duplexState&at)!==0}pipe(t,e){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof e!="function"&&(e=null),this.stream._duplexState|=dn,this.pipeTo=t,this.pipeline=new ao(this.stream,t,e),e&&this.stream.on("error",qn),te(t))t._writableState.pipeline=this.pipeline,e&&t.on("error",qn),t.on("finish",this.pipeline.finished.bind(this.pipeline));else{const r=this.pipeline.done.bind(this.pipeline,t),s=this.pipeline.done.bind(this.pipeline,t,null);t.on("error",r),t.on("close",s),t.on("finish",this.pipeline.finished.bind(this.pipeline))}t.on("drain",co.bind(this)),this.stream.emit("piping",t),t.emit("pipe",this.stream)}push(t){const e=this.stream;return t===null?(this.highWaterMark=0,e._duplexState=(e._duplexState|Nt)&Di,!1):this.map!==null&&(t=this.map(t),t===null)?this.buffered<this.highWaterMark:(this.buffered+=this.byteLength(t),this.queue.push(t),e._duplexState=(e._duplexState|yt)&Bi,this.buffered<this.highWaterMark)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),this.buffered===0&&(this.stream._duplexState&=Pi),t}unshift(t){const e=[this.map!==null?this.map(t):t];for(;this.buffered>0;)e.push(this.shift());for(let r=0;r<e.length-1;r++){const s=e[r];this.buffered+=this.byteLength(s),this.queue.push(s)}this.push(e[e.length-1])}read(){const t=this.stream;if((t._duplexState&Ln)===yt){const e=this.shift();return this.pipeTo!==null&&this.pipeTo.write(e)===!1&&(t._duplexState&=Fn),t._duplexState&ze&&t.emit("data",e),e}return this.readAhead===!1&&(t._duplexState|=vt,this.updateNextTick()),null}drain(){const t=this.stream;for(;(t._duplexState&Ln)===yt&&t._duplexState&Cr;){const e=this.shift();this.pipeTo!==null&&this.pipeTo.write(e)===!1&&(t._duplexState&=Fn),t._duplexState&ze&&t.emit("data",e)}}update(){const t=this.stream;t._duplexState|=Xt;do{for(this.drain();this.buffered<this.highWaterMark&&(t._duplexState&Ki)===vt;)t._duplexState|=Ri,t._read(this.afterRead),this.drain();(t._duplexState&Gi)===Ni&&(t._duplexState|=pn,t.emit("readable")),t._duplexState&Ii||this.updateNonPrimary()}while(this.continueUpdate()===!0);t._duplexState&=Fi}updateNonPrimary(){const t=this.stream;if((t._duplexState&Yi)===Nt&&(t._duplexState=(t._duplexState|at)&Ui,t.emit("end"),(t._duplexState&Or)===yn&&(t._duplexState|=It),this.pipeTo!==null&&this.pipeTo.end()),(t._duplexState&pt)===It){t._duplexState&mn||(t._duplexState|=Jt,t._destroy(Lr.bind(this)));return}(t._duplexState&Pr)===Dt&&(t._duplexState=(t._duplexState|Jt)&Ar,t._open(Mr.bind(this)))}continueUpdate(){return this.stream._duplexState&Lt?(this.stream._duplexState&=Rr,!0):!1}updateCallback(){(this.stream._duplexState&Zi)===jt?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&Lt||(this.stream._duplexState|=Lt,this.stream._duplexState&Xt||xr(this.afterUpdateNextTick))}}class oo{constructor(t){this.data=null,this.afterTransform=go.bind(t),this.afterFinal=null}}class ao{constructor(t,e,r){this.from=t,this.to=e,this.afterPipe=r,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(t,e){if(e&&(this.error=e),t===this.to&&(this.to=null,this.from!==null)){(!(this.from._duplexState&at)||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(t===this.from&&(this.from=null,this.to!==null)){t._duplexState&at||this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function co(){this.stream._duplexState|=dn,this.updateCallback()}function lo(n){const t=this.stream;n&&t.destroy(n),t._duplexState&pt||(t._duplexState|=Bt,t.emit("finish")),(t._duplexState&Or)===yn&&(t._duplexState|=It),t._duplexState&=Nr,t._duplexState&$t?this.updateNextTick():this.update()}function Lr(n){const t=this.stream;!n&&this.error!==Ae&&(n=this.error),n&&t.emit("error",n),t._duplexState|=Zt,t.emit("close");const e=t._readableState,r=t._writableState;if(e!==null&&e.pipeline!==null&&e.pipeline.done(t,n),r!==null){for(;r.drains!==null&&r.drains.length>0;)r.drains.shift().resolve(!1);r.pipeline!==null&&r.pipeline.done(t,n)}}function uo(n){const t=this.stream;n&&t.destroy(n),t._duplexState&=Nr,this.drains!==null&&_o(this.drains),(t._duplexState&Qi)===oe&&(t._duplexState&=qi,(t._duplexState&Ze)===Ze&&t.emit("drain")),this.updateCallback()}function ho(n){n&&this.stream.destroy(n),this.stream._duplexState&=vi,this.readAhead===!1&&!(this.stream._duplexState&se)&&(this.stream._duplexState&=Ir),this.updateCallback()}function fo(){this.stream._duplexState&Xt||(this.stream._duplexState&=Rr,this.update())}function po(){this.stream._duplexState&$t||(this.stream._duplexState&=kr,this.update())}function _o(n){for(let t=0;t<n.length;t++)--n[t].writes===0&&(n.shift().resolve(!0),t--)}function Mr(n){const t=this.stream;n&&t.destroy(n),t._duplexState&It||(t._duplexState&Vi||(t._duplexState|=jt),t._duplexState&Xi||(t._duplexState|=ie),t.emit("open")),t._duplexState&=Br,t._writableState!==null&&t._writableState.updateCallback(),t._readableState!==null&&t._readableState.updateCallback()}function go(n,t){t!=null&&this.push(t),this._writableState.afterWrite(n)}function yo(n){this._readableState!==null&&(n==="data"&&(this._duplexState|=ze|_n,this._readableState.updateNextTick()),n==="readable"&&(this._duplexState|=fn,this._readableState.updateNextTick())),this._writableState!==null&&n==="drain"&&(this._duplexState|=Ze,this._writableState.updateNextTick())}class bn extends Ti{constructor(t){super(),this._duplexState=0,this._readableState=null,this._writableState=null,t&&(t.open&&(this._open=t.open),t.destroy&&(this._destroy=t.destroy),t.predestroy&&(this._predestroy=t.predestroy),t.signal&&t.signal.addEventListener("abort",Ao.bind(this))),this.on("newListener",yo)}_open(t){t(null)}_destroy(t){t(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&Zt)!==0}get destroying(){return(this._duplexState&pt)!==0}destroy(t){this._duplexState&pt||(t||(t=Ae),this._duplexState=(this._duplexState|It)&Wi,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=t),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=t),this._duplexState|=hn,this._predestroy(),this._duplexState&=Ci,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class Qt extends bn{constructor(t){super(t),this._duplexState|=Dt|Bt|vt,this._readableState=new io(this,t),t&&(this._readableState.readAhead===!1&&(this._duplexState&=Ir),t.read&&(this._read=t.read),t.eagerOpen&&this._readableState.updateNextTick(),t.encoding&&this.setEncoding(t.encoding))}setEncoding(t){const e=new Ai(t),r=this._readableState.map||Eo;return this._readableState.map=s,this;function s(i){const o=e.push(i);return o===""?null:r(o)}}_read(t){t(null)}pipe(t,e){return this._readableState.updateNextTick(),this._readableState.pipe(t,e),t}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(t){return this._readableState.updateNextTick(),this._readableState.push(t)}unshift(t){return this._readableState.updateNextTick(),this._readableState.unshift(t)}resume(){return this._duplexState|=_n,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?Li:Oi,this}static _fromAsyncIterator(t,e){let r;const s=new Qt({...e,read(o){t.next().then(i).then(o.bind(null,null)).catch(o)},predestroy(){r=t.return()},destroy(o){if(!r)return o(null);r.then(o.bind(null,null)).catch(o)}});return s;function i(o){o.done?s.push(null):s.push(o.value)}}static from(t,e){if(xo(t))return t;if(t[le])return this._fromAsyncIterator(t[le](),e);Array.isArray(t)||(t=t===void 0?[]:[t]);let r=0;return new Qt({...e,read(s){this.push(r===t.length?null:t[r++]),s(null)}})}static isBackpressured(t){return(t._duplexState&zi)!==0||t._readableState.buffered>=t._readableState.highWaterMark}static isPaused(t){return(t._duplexState&se)===0}[le](){const t=this;let e=null,r=null,s=null;return this.on("error",l=>{e=l}),this.on("readable",i),this.on("close",o),{[le](){return this},next(){return new Promise(function(l,a){r=l,s=a;const c=t.read();c!==null?u(c):t._duplexState&Zt&&u(null)})},return(){return h(null)},throw(l){return h(l)}};function i(){r!==null&&u(t.read())}function o(){r!==null&&u(null)}function u(l){s!==null&&(e?s(e):l===null&&!(t._duplexState&at)?s(Ae):r({value:l,done:l===null}),s=r=null)}function h(l){return t.destroy(l),new Promise((a,c)=>{if(t._duplexState&Zt)return a({value:void 0,done:!0});t.once("close",function(){l?c(l):a({value:void 0,done:!0})})})}}}class qr extends bn{constructor(t){super(t),this._duplexState|=Dt|at,this._writableState=new Fr(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final),t.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=Re}uncork(){this._duplexState&=Dr,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}static isBackpressured(t){return(t._duplexState&ro)!==0}static drained(t){if(t.destroyed)return Promise.resolve(!1);const e=t._writableState,s=(Co(t)?Math.min(1,e.queue.length):e.queue.length)+(t._duplexState&gn?1:0);return s===0?Promise.resolve(!0):(e.drains===null&&(e.drains=[]),new Promise(i=>{e.drains.push({writes:s,resolve:i})}))}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class wn extends Qt{constructor(t){super(t),this._duplexState=Dt|this._duplexState&vt,this._writableState=new Fr(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final))}cork(){this._duplexState|=Re}uncork(){this._duplexState&=Dr,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class Hr extends wn{constructor(t){super(t),this._transformState=new oo(this),t&&(t.transform&&(this._transform=t.transform),t.flush&&(this._flush=t.flush))}_write(t,e){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=t:this._transform(t,this._transformState.afterTransform)}_read(t){if(this._transformState.data!==null){const e=this._transformState.data;this._transformState.data=null,t(null),this._transform(e,this._transformState.afterTransform)}else t(null)}destroy(t){super.destroy(t),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(t,e){e(null,t)}_flush(t){t(null)}_final(t){this._transformState.afterFinal=t,this._flush(bo.bind(this))}}class mo extends Hr{}function bo(n,t){const e=this._transformState.afterFinal;if(n)return e(n);t!=null&&this.push(t),this.push(null),e(null)}function wo(...n){return new Promise((t,e)=>$r(...n,r=>{if(r)return e(r);t()}))}function $r(n,...t){const e=Array.isArray(n)?[...n,...t]:[n,...t],r=e.length&&typeof e[e.length-1]=="function"?e.pop():null;if(e.length<2)throw new Error("Pipeline requires at least 2 streams");let s=e[0],i=null,o=null;for(let l=1;l<e.length;l++)i=e[l],te(s)?s.pipe(i,h):(u(s,!0,l>1,h),s.pipe(i)),s=i;if(r){let l=!1;const a=te(i)||!!(i._writableState&&i._writableState.autoDestroy);i.on("error",c=>{o===null&&(o=c)}),i.on("finish",()=>{l=!0,a||r(o)}),a&&i.on("close",()=>r(o||(l?null:Fe)))}return i;function u(l,a,c,f){l.on("error",f),l.on("close",S);function S(){if(a&&l._readableState&&!l._readableState.ended||c&&l._writableState&&!l._writableState.ended)return f(Fe)}}function h(l){if(!(!l||o)){o=l;for(const a of e)a.destroy(l)}}}function Eo(n){return n}function Wr(n){return!!n._readableState||!!n._writableState}function te(n){return typeof n._duplexState=="number"&&Wr(n)}function So(n){const t=n._readableState&&n._readableState.error||n._writableState&&n._writableState.error;return t===Ae?null:t}function xo(n){return te(n)&&n.readable}function To(n){return typeof n=="object"&&n!==null&&typeof n.byteLength=="number"}function jr(n){return To(n)?n.byteLength:1024}function qn(){}function Ao(){this.destroy(new Error("Stream aborted."))}function Co(n){return n._writev!==qr.prototype._writev&&n._writev!==wn.prototype._writev}var Ro={pipeline:$r,pipelinePromise:wo,isStream:Wr,isStreamx:te,getStreamError:So,Stream:bn,Writable:qr,Readable:Qt,Duplex:wn,Transform:Hr,PassThrough:mo};function Hn(n,t){for(const e in t)Object.defineProperty(n,e,{value:t[e],enumerable:!0,configurable:!0});return n}function Io(n,t,e){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");e||(e={}),typeof t=="object"&&(e=t,t=""),t&&(e.code=t);try{return Hn(n,e)}catch{e.message=n.message,e.stack=n.stack;const s=function(){};return s.prototype=Object.create(Object.getPrototypeOf(n)),Hn(new s,e)}}var No=Io;const P=nr(No);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const $n="0123456789abcdef",Vr=[];for(let n=0;n<256;n++)Vr[n]=$n[n>>4&15]+$n[n&15];const Wn=n=>{const t=n.length;let e="",r=0;for(;r<t;)e+=Vr[n[r++]];return e};var jn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vo=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ue=0;ue<jn.length;ue++)vo[jn.charCodeAt(ue)]=ue;new TextDecoder;const ko=new TextEncoder,Do=n=>ko.encode(n),Vn=typeof window<"u"?window:self,Xe=Vn.crypto||Vn.msCrypto||{};Xe.subtle||Xe.webkitSubtle;const Yn=n=>{const t=new Uint8Array(n);return Xe.getRandomValues(t)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const Bo=pi("simple-peer"),Le=64*1024,Oo=5*1e3,Po=5*1e3;function Gn(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function Uo(n){console.warn(n)}let Ie=class Je extends Ro.Duplex{constructor(e){e=Object.assign({allowHalfOpen:!1},e);super(e);xn(this,"_pc");if(this.__objectMode=!!e.objectMode,this._id=Wn(Yn(4)).slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||Wn(Yn(20)):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||Je.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Je.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(r=>r),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||Oo,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!Ke)throw P(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new Ke(this.config)}catch(r){this.__destroy(P(r,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=r=>{this._onIceCandidate(r)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(r=>{this.__destroy(P(r,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=r=>{this._setupData(r)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new _i(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(r=>{this._addIceCandidate(r)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(r=>{this.__destroy(P(r,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.__destroy(P(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const r=new gi(e);this._pc.addIceCandidate(r).catch(s=>{!r.address||r.address.endsWith(".local")?Uo("Ignoring unsupported ICE candidate."):this.__destroy(P(s,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}_final(e){this._readableState.ended||this.push(null),e(null)}__destroy(e){this.end(),this._destroy(()=>{},e)}_destroy(e,r){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",r&&(r.message||r)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,r&&this.emit("error",r),e()},0))}_setupData(e){if(!e.channel)return this.__destroy(P(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=Le),this.channelName=this._channel.label,this._channel.onmessage=s=>{this._onChannelMessage(s)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=s=>{const i=s.error instanceof Error?s.error:new Error(`Datachannel error: ${s.message} ${s.filename}:${s.lineno}:${s.colno}`);this.__destroy(P(i,"ERR_DATA_CHANNEL"))};let r=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(r&&this._onChannelClose(),r=!0):r=!1},Po)}_write(e,r){if(this.destroyed)return r(P(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(s){return this.__destroy(P(s,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Le?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Gn(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const r=()=>{if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?r():this.once("_iceComplete",r))},i=o=>{this.__destroy(P(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(i)}).catch(e=>{this.__destroy(P(e,"ERR_CREATE_OFFER"))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Gn(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const r=()=>{var u;if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp}),this.initiator||(u=this._requestMissingTransceivers)==null||u.call(this)},s=()=>{this.destroyed||(this.trickle||this._iceComplete?r():this.once("_iceComplete",r))},i=o=>{this.__destroy(P(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(i)}).catch(e=>{this.__destroy(P(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._destroying||this._pc.connectionState==="failed"&&this.__destroy(P(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,r=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,r),this.emit("iceStateChange",e,r),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.__destroy(P(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.__destroy(P(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const r=s=>(Object.prototype.toString.call(s.values)==="[object Array]"&&s.values.forEach(i=>{Object.assign(s,i)}),s);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(s=>{const i=[];s.forEach(o=>{i.push(r(o))}),e(null,i)},s=>e(s)):this._pc.getStats.length>0?this._pc.getStats(s=>{if(this.destroyed)return;const i=[];s.result().forEach(o=>{const u={};o.names().forEach(h=>{u[h]=o.stat(h)}),u.id=o.id,u.type=o.type,u.timestamp=o.timestamp,i.push(r(u))}),e(null,i)},s=>e(s)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this._destroying||this.getStats((r,s)=>{if(this.destroyed||this._destroying)return;r&&(s=[]);const i={},o={},u={};let h=!1;s.forEach(a=>{(a.type==="remotecandidate"||a.type==="remote-candidate")&&(i[a.id]=a),(a.type==="localcandidate"||a.type==="local-candidate")&&(o[a.id]=a),(a.type==="candidatepair"||a.type==="candidate-pair")&&(u[a.id]=a)});const l=a=>{h=!0;let c=o[a.localCandidateId];c&&(c.ip||c.address)?(this.localAddress=c.ip||c.address,this.localPort=Number(c.port)):c&&c.ipAddress?(this.localAddress=c.ipAddress,this.localPort=Number(c.portNumber)):typeof a.googLocalAddress=="string"&&(c=a.googLocalAddress.split(":"),this.localAddress=c[0],this.localPort=Number(c[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let f=i[a.remoteCandidateId];f&&(f.ip||f.address)?(this.remoteAddress=f.ip||f.address,this.remotePort=Number(f.port)):f&&f.ipAddress?(this.remoteAddress=f.ipAddress,this.remotePort=Number(f.portNumber)):typeof a.googRemoteAddress=="string"&&(f=a.googRemoteAddress.split(":"),this.remoteAddress=f[0],this.remotePort=Number(f[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(s.forEach(a=>{a.type==="transport"&&a.selectedCandidatePairId&&l(u[a.selectedCandidatePairId]),(a.type==="googCandidatePair"&&a.googActiveConnection==="true"||(a.type==="candidatepair"||a.type==="candidate-pair")&&a.selected)&&l(a)}),!h&&(!Object.keys(u).length||Object.keys(o).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(c){return this.__destroy(P(c,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const a=this._cb;this._cb=null,a(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>Le||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let r=e.data;r instanceof ArrayBuffer?r=new Uint8Array(r):this.__objectMode===!1&&(r=Do(r)),this.push(r)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],Bo.apply(null,e)}};Ie.WEBRTC_SUPPORT=!!Ke;Ie.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Ie.channelConfig={};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */class Fo extends Ie{constructor(t={}){super(t),this._pc&&(this.streams=t.streams||(t.stream?[t.stream]:[]),this._senderMap=new Map,this.streams&&this.streams.forEach(e=>{this.addStream(e)}),this._pc.ontrack=e=>{this._onTrack(e)})}addTransceiver(t,e){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,e),this._needsNegotiation()}catch(r){this.__destroy(P(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:e}})}}addStream(t){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach(e=>{this.addTrack(e,t)})}}addTrack(t,e){if(this._destroying)return;if(this.destroyed)throw P(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const r=this._senderMap.get(t)||new Map;let s=r.get(e);if(!s)s=this._pc.addTrack(t,e),r.set(e,s),this._senderMap.set(t,r),this._needsNegotiation();else throw s.removed?P(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):P(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,e,r){if(this._destroying)return;if(this.destroyed)throw P(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const s=this._senderMap.get(t),i=s?s.get(r):null;if(!i)throw P(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");e&&this._senderMap.set(e,s),i.replaceTrack!=null?i.replaceTrack(e):this.__destroy(P(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,e){if(this._destroying)return;if(this.destroyed)throw P(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const r=this._senderMap.get(t),s=r?r.get(e):null;if(!s)throw P(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{s.removed=!0,this._pc.removeTrack(s)}catch(i){i.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(s):this.__destroy(P(i,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach(e=>{this.removeTrack(e,t)})}}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_onTrack(t){this.destroyed||t.streams.forEach(e=>{this._debug("on track"),this.emit("track",t.track,e),this._remoteTracks.push({track:t.track,stream:e}),!this._remoteStreams.some(r=>r.id===e.id)&&(this._remoteStreams.push(e),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",e)}))})}}const Kn="data",zn="signal",Zn=(n,t)=>{const e=new Fo({iceServers:[{urls:Lo}],...t,initiator:n,trickle:!1}),r=i=>s.push(i);let s=[];return e.on(Kn,r),{id:e._id,created:Date.now(),connection:e._pc,get channel(){return e._channel},get isDead(){return e.destroyed},signal:i=>new Promise(o=>{n||e.on(zn,o),e.signal(i)}),sendData:i=>e.send(i),destroy:()=>e.destroy(),setHandlers:i=>Object.entries(i).forEach(([o,u])=>e.on(o,u)),offerPromise:n?new Promise(i=>e.on(zn,i)):Promise.resolve(),addStream:i=>e.addStream(i),removeStream:i=>e.removeStream(i),addTrack:(i,o)=>e.addTrack(i,o),removeTrack:(i,o)=>e.removeTrack(i,o),replaceTrack:(i,o,u)=>e.replaceTrack(i,o,u),drainEarlyData:i=>{e.off(Kn,r),s.forEach(i),s=null}}},Lo=[...zt(5,(n,t)=>`stun:stun${t||""}.l.google.com:19302`),"stun:global.stun.twilio.com:3478"],Mo=Object.getPrototypeOf(Uint8Array),fe=12,Yr=0,pe=Yr+fe,_e=pe+1,Vt=_e+1,Yt=Vt+1,wt=16*2**10-Yt,he=255,Xn="bufferedamountlow",Pt=n=>"@_"+n,qo=(n,t,e)=>{const r={},s={},i={},o={},u={},h={},l={},a={onPeerJoin:St,onPeerLeave:St,onPeerStream:St,onPeerTrack:St},c=(_,E)=>(_?Array.isArray(_)?_:[_]:ti(r)).flatMap(N=>{const d=r[N];return d?E(N,d):(console.warn(`${Kt}: no peer with id ${N} found`),[])}),f=_=>{r[_]&&(delete r[_],delete o[_],delete u[_],a.onPeerLeave(_),t(_))},S=_=>{if(s[_])return i[_];if(!_)throw ut("action type argument is required");const E=At(_);if(E.byteLength>fe)throw ut(`action type string "${_}" (${E.byteLength}b) exceeds byte limit (${fe}). Hint: choose a shorter name.`);const N=new Uint8Array(fe);N.set(E);let d=0;return s[_]={onComplete:St,onProgress:St,setOnComplete:g=>s[_]={...s[_],onComplete:g},setOnProgress:g=>s[_]={...s[_],onProgress:g},send:async(g,y,w,C)=>{if(w&&typeof w!="object")throw ut("action meta argument must be an object");const B=typeof g;if(B==="undefined")throw ut("action data cannot be undefined");const F=B!=="string",q=g instanceof Blob,O=q||g instanceof ArrayBuffer||g instanceof Mo;if(w&&!O)throw ut("action meta argument can only be used with binary data");const M=O?new Uint8Array(q?await g.arrayBuffer():g):At(F?ft(g):g),z=w?At(ft(w)):null,G=Math.ceil(M.byteLength/wt)+(w?1:0)||1,Q=zt(G,(Z,H)=>{const $=H===G-1,W=w&&H===0,V=new Uint8Array(Yt+(W?z.byteLength:$?M.byteLength-wt*(G-(w?2:1)):wt));return V.set(N),V.set([d],pe),V.set([$|W<<1|O<<2|F<<3],_e),V.set([Math.round((H+1)/G*he)],Vt),V.set(w?W?z:M.subarray((H-1)*wt,H*wt):M.subarray(H*wt,(H+1)*wt),Yt),V});return d=d+1&he,Ft(c(y,async(Z,H)=>{const{channel:$}=H;let W=0;for(;W<G;){const V=Q[W];if($.bufferedAmount>$.bufferedAmountLowThreshold&&await new Promise(et=>{const ot=()=>{$.removeEventListener(Xn,ot),et()};$.addEventListener(Xn,ot)}),!r[Z])break;H.sendData(V),W++,C==null||C(V[Vt]/he,Z,w)}}))}},i[_]||(i[_]=[s[_].send,s[_].setOnComplete,s[_].setOnProgress])},x=(_,E)=>{var G,Q;const N=new Uint8Array(E),d=de(N.subarray(Yr,pe)).replaceAll("\0",""),[g]=N.subarray(pe,_e),[y]=N.subarray(_e,Vt),[w]=N.subarray(Vt,Yt),C=N.subarray(Yt),B=!!(y&1),F=!!(y&2),q=!!(y&4),O=!!(y&8);if(!s[d]){console.warn(`${Kt}: received message with unregistered type (${d})`);return}o[_]||(o[_]={}),(G=o[_])[d]||(G[d]={});const M=(Q=o[_][d])[g]||(Q[g]={chunks:[]});if(F?M.meta=we(de(C)):M.chunks.push(C),s[d].onProgress(w/he,_,M.meta),!B)return;const z=new Uint8Array(M.chunks.reduce((Z,H)=>Z+H.byteLength,0));if(M.chunks.reduce((Z,H)=>(z.set(H,Z),Z+H.byteLength),0),delete o[_][d][g],q)s[d].onComplete(z,_,M.meta);else{const Z=de(z);s[d].onComplete(O?we(Z):Z,_)}},p=async()=>{await L(""),await new Promise(_=>setTimeout(_,99)),Bn(r).forEach(([_,E])=>{E.destroy(),delete r[_]}),e()},[m,b]=S(Pt("ping")),[A,I]=S(Pt("pong")),[D,k]=S(Pt("signal")),[T,R]=S(Pt("stream")),[v,K]=S(Pt("track")),[L,U]=S(Pt("leave"));return n((_,E)=>{var N;r[E]||(r[E]=_,_.setHandlers({data:d=>x(E,d),stream:d=>{a.onPeerStream(d,E,h[E]),delete h[E]},track:(d,g)=>{a.onPeerTrack(d,g,E,l[E]),delete l[E]},signal:d=>D(d,E),close:()=>f(E),error:()=>f(E)}),a.onPeerJoin(E),(N=_.drainEarlyData)==null||N.call(_,d=>x(E,d)))}),b((_,E)=>A("",E)),I((_,E)=>{var N;(N=u[E])==null||N.call(u),delete u[E]}),k((_,E)=>{var N;return(N=r[E])==null?void 0:N.signal(_)}),R((_,E)=>h[E]=_),K((_,E)=>l[E]=_),U((_,E)=>f(E)),ln&&addEventListener("beforeunload",p),{makeAction:S,leave:p,ping:async _=>{if(!_)throw ut("ping() must be called with target peer ID");const E=Date.now();return m("",_),await new Promise(N=>u[_]=N),Date.now()-E},getPeers:()=>Qs(Bn(r).map(([_,E])=>[_,E.connection])),addStream:(_,E,N)=>c(E,async(d,g)=>{N&&await T(N,d),g.addStream(_)}),removeStream:(_,E)=>c(E,(N,d)=>d.removeStream(_)),addTrack:(_,E,N,d)=>c(N,async(g,y)=>{d&&await v(d,g),y.addTrack(_,E)}),removeTrack:(_,E,N)=>c(N,(d,g)=>g.removeTrack(_,E)),replaceTrack:(_,E,N,d,g)=>c(d,async(y,w)=>{g&&await v(g,y),w.replaceTrack(_,E,N)}),onPeerJoin:_=>a.onPeerJoin=_,onPeerLeave:_=>a.onPeerLeave=_,onPeerStream:_=>a.onPeerStream=_,onPeerTrack:_=>a.onPeerTrack=_}},Ho=20,$o=5333,Jn=57333,Wo=({init:n,subscribe:t,announce:e})=>{const r={};let s=!1,i,o,u;return(h,l,a)=>{var g;const{appId:c}=h;if((g=r[c])!=null&&g[l])return r[c][l];const f={},S={},x=ae(Kt,c,l),p=ce(x),m=ce(ae(x,Ut)),b=ai(h.password||"",c,l),A=y=>async w=>({type:w.type,sdp:await y(b,w.sdp)}),I=A(li),D=A(ci),k=()=>Zn(!0,h.rtcConfig),T=(y,w,C)=>{var B;if(S[w]){S[w]!==y&&y.destroy();return}S[w]=y,d(y,w),(B=f[w])==null||B.forEach((F,q)=>{q!==C&&F.destroy()}),delete f[w]},R=(y,w)=>{S[w]===y&&delete S[w]},v=(y,w)=>{var B;if(S[y])return;const C=(B=f[y])==null?void 0:B[w];C&&(delete f[y][w],C.destroy())},K=y=>(o.push(...zt(y,k)),Ft(o.splice(0,y).map(w=>w.offerPromise.then(D).then(C=>({peer:w,offer:C}))))),L=(y,w)=>a==null?void 0:a({error:`incorrect password (${h.password}) when decrypting ${w}`,appId:c,peerId:y,roomId:l}),U=y=>async(w,C,B)=>{var Q,Z,H;const[F,q]=await Ft([p,m]);if(w!==F&&w!==q)return;const{peerId:O,offer:M,answer:z,peer:G}=typeof C=="string"?we(C):C;if(!(O===Ut||S[O])){if(O&&!M&&!z){if((Q=f[O])!=null&&Q[y])return;const[[{peer:$,offer:W}],V]=await Ft([K(1),ce(ae(x,O))]);f[O]||(f[O]=[]),f[O][y]=$,setTimeout(()=>v(O,y),_[y]*.9),$.setHandlers({connect:()=>T($,O,y),close:()=>R($,O)}),B(V,ft({peerId:Ut,offer:W}))}else if(M){if(((Z=f[O])==null?void 0:Z[y])&&Ut>O)return;const W=Zn(!1,h.rtcConfig);W.setHandlers({connect:()=>T(W,O,y),close:()=>R(W,O)});let V;try{V=await I(M)}catch{L(O,"offer");return}if(W.isDead)return;const[et,ot]=await Ft([ce(ae(x,O)),W.signal(V)]);B(et,ft({peerId:Ut,answer:await D(ot)}))}else if(z){let $;try{$=await I(z)}catch{L(O,"answer");return}if(G)G.setHandlers({connect:()=>T(G,O,y),close:()=>R(G,O)}),G.signal($);else{const W=(H=f[O])==null?void 0:H[y];W&&!W.isDead&&W.signal($)}}}};if(!h)throw ut("requires a config map as the first argument");if(!c&&!h.firebaseApp)throw ut("config map is missing appId field");if(!l)throw ut("roomId argument required");if(!s){const y=n(h);o=zt(Ho,k),i=Array.isArray(y)?y:[y],s=!0,u=setInterval(()=>o=o.filter(w=>{const C=Date.now()-w.created<Jn;return C||w.destroy(),C}),Jn*1.03)}const _=i.map(()=>$o),E=[],N=i.map(async(y,w)=>t(await y,await p,await m,U(w),K));Ft([p,m]).then(([y,w])=>{const C=async(B,F)=>{const q=await e(B,y,w);typeof q=="number"&&(_[F]=q),E[F]=setTimeout(()=>C(B,F),_[F])};N.forEach(async(B,F)=>{await B,C(await i[F],F)})});let d=St;return r[c]||(r[c]={}),r[c][l]=qo(y=>d=y,y=>delete S[y],()=>{delete r[c][l],E.forEach(clearTimeout),N.forEach(async y=>(await y)()),clearInterval(u)})}},jo=5,Gr=29333,Kr="x",zr="EVENT",Zr=ln&&cn.utils.randomPrivateKey(),Vo=ln&&Ye(cn.getPublicKey(Zr)),En={},Et={},Xr=()=>Math.floor(Date.now()/1e3),Qn=async(n,t)=>{const e={kind:Gr,content:t,pubkey:Vo,created_at:Xr(),tags:[[Kr,n]]},r=Ye(new Uint8Array(await crypto.subtle.digest("SHA-256",At(ft([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])))));return ft([zr,{...e,id:r,sig:Ye(await cn.sign(r,Zr))}])},tr=(n,t)=>(En[n]=t,ft(["REQ",n,{kinds:[Gr],since:Xr(),["#"+Kr]:[t]}])),er=n=>(delete En[n],ft(["CLOSE",n])),Yo=Wo({init:n=>ri(n,Go,jo).map(t=>{const e=si(t,r=>{var h;const[s,i,o,u]=we(r);if(s!==zr){const l=`${Kt}: relay failure from ${e.url} - `;s==="NOTICE"?console.warn(l+i):s==="OK"&&!o&&console.warn(l+u);return}(h=Et[i])==null||h.call(Et,En[i],o.content)});return e.ready}),subscribe:(n,t,e,r)=>{const s=Ve(64),i=Ve(64);return Et[s]=Et[i]=(o,u)=>r(o,u,async(h,l)=>n.send(await Qn(h,l))),n.send(tr(s,t)),n.send(tr(i,e)),()=>{n.send(er(s)),n.send(er(i)),delete Et[s],delete Et[i]}},announce:async(n,t)=>n.send(await Qn(t,ft({peerId:Ut})))}),Go=["relay.nostr.net","relay.snort.social","relay.piazza.today","relay.exit.pub","nostr.lu.ke","nostr.mom","relay.urbanzap.space","nostr.data.haus","nostr.sathoarder.com","relay.nostromo.social","relay.nostr.bg","nostr.stakey.net","nostr.vulpem.com","a.nos.lol","eu.purplerelay.com","nostr2.sanhauf.com","e.nos.lol"].map(n=>"wss://"+n),Ko={class:"p-4"},zo={class:"p-2"},ia={__name:"Trystero",setup(n){const t=Yo({appId:"trystero-lounge"},"101");t.onPeerJoin(console.log),t.onPeerLeave(console.log);const[e,r]=t.makeAction("mouseMove"),[s,i]=t.makeAction("click");return window.addEventListener("mousemove",o=>e([o.clientX,o.clientY])),window.addEventListener("click",()=>s(10)),r(([o,u],h)=>console.log(o,u)),i((o,u)=>console.log(o)),(o,u)=>(es(),ns("div",Ko,[rs("P2P"),ss("div",zo,is(os(t)),1)]))}};export{ia as default};
