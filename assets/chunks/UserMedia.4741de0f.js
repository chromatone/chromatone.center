import{T as n,o as u,V as m,r as h,_ as d,b as c,i as v,a5 as a,k as l}from"./index.83aed4fc.js";class s extends n{constructor(){super(u(s.getDefaults(),arguments,["volume"])),this.name="UserMedia";const e=u(s.getDefaults(),arguments,["volume"]);this._volume=this.output=new m({context:this.context,volume:e.volume}),this.volume=this._volume.volume,h(this,"volume"),this.mute=e.mute}static getDefaults(){return Object.assign(n.getDefaults(),{mute:!1,volume:0})}open(e){return d(this,void 0,void 0,function*(){c(s.supported,"UserMedia is not supported"),this.state==="started"&&this.close();const t=yield s.enumerateDevices();v(e)?this._device=t[e]:(this._device=t.find(i=>i.label===e||i.deviceId===e),!this._device&&t.length>0&&(this._device=t[0]),c(a(this._device),`No matching device ${e}`));const o={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(o.audio.deviceId=this._device.deviceId);const r=yield navigator.mediaDevices.getUserMedia(o);if(!this._stream){this._stream=r;const i=this.context.createMediaStreamSource(r);l(i,this.output),this._mediaStream=i}return this})}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach(e=>{e.stop()}),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return d(this,void 0,void 0,function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="audioinput")})}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){if(this._device)return this._device.deviceId}get groupId(){if(this._device)return this._device.groupId}get label(){if(this._device)return this._device.label}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return a(navigator.mediaDevices)&&a(navigator.mediaDevices.getUserMedia)}}export{s as U};
