import{_ as G}from"./transport.c7b215a2.js";import{_ as J}from"./trash.522b71af.js";import{_ as K,a as Q,b as W,c as Y,d as Z}from"./angle-right.dc945f13.js";import{o as l,c as a,a as r,X as E,A as T,i as V,z,l as R,w as y,u as o,F as k,r as N,g as w,S as U,t as $,k as O,e as C,f as B,x as D,V as ee,p as te,h as oe,_ as ne,B as se,m as le,n as re}from"./framework.eba39b59.js";import{i as S}from"./state.3e7769cb.js";import{u as q}from"./index.d912cb41.js";import{j as F,n as ie}from"./colors.de66a068.js";import{t as I}from"./tempo.720ba7db.js";import{u as ae,m as ue,t as de}from"./sequence.1c00f0ce.js";import{r as ce}from"./midiRender.a93b111d.js";import{b as me}from"./index.7d5af125.js";const he={style:{"vertical-align":"middle"},viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"},fe=r("path",{fill:"currentColor",d:"M15 4.594L13.281 6.28L8.562 11H4v10h4.563l4.718 4.719L15 27.406zm-2 4.843v13.126L9.719 19.28L9.406 19H6v-6h3.406l.313-.281zm7.219 2.344L18.78 13.22L21.563 16l-2.782 2.781l1.438 1.438L23 17.437l2.781 2.782l1.438-1.438L24.437 16l2.782-2.781l-1.438-1.438L23 14.562z"},null,-1),ve=[fe];function ye(e,b){return l(),a("svg",he,ve)}const pe={name:"la-volume-off",render:ye},xe={class:"bar cursor-pointer","font-size":"32px"},we=["x1","x2","y1","y2","stroke-width","stroke"],be=["x2","y1","y2","stroke"],ge=["x1","x2","y1","y2","stroke-width","stroke"],ke={key:0,class:"all"},$e=["cx","cy","r"],_e=["cx","cy"],Ce=["transform"],Ne=["fill"],Ve={transform:"translate(0 10)",fill:"currentColor","text-anchor":"middle"},Be=E({__name:"bar",props:{modelValue:{type:[Number,String],default:.1},step:{type:Number,default:.1},min:{type:Number,default:0},max:{type:Number,default:1},width:{type:Number,default:100},height:{type:Number,default:50},vector:{type:Array,default:[1,-1]},showPositions:{type:Boolean,default:!1},ratio:{type:Number,default:200},every:{type:Number,default:null},showCenter:{type:Boolean,default:!1},inverted:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:b}){const t=e,c=T({inner:q((Number(t.modelValue)-t.min)/(t.max-t.min),0,1),proportion:V(()=>t.inverted?(Number(t.modelValue)-t.max)/(t.min-t.max):(Number(t.modelValue)-t.min)/(t.max-t.min)),pos:V(()=>c.proportion*t.width)});function n(u){c.inner+=(t.vector[0]*u.delta[0]+t.vector[1]*u.delta[1])/t.ratio}function _(u){c.inner+=u*t.step/(t.max-t.min)}z(()=>c.inner,u=>{let i=u*(t.max-t.min)+t.min;b("update:modelValue",Math.round(i/t.step)*t.step)});const v=V(()=>{let u=(t.max-t.min)/t.step,i=[];for(let s=0;s<=1;s+=1/u)i.push(s*t.width);return i});return(u,i)=>{const s=R("drag");return y((l(),a("g",xe,[r("line",{class:"add",onMousedown:i[0]||(i[0]=m=>_(1)),x1:e.inverted?0:c.pos,x2:e.inverted?c.pos:e.width,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":e.height,stroke:o(S)?"#1114":"#fff8"},null,40,we),r("line",{class:"pointer-events-none",x1:0,x2:e.width,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":18,stroke:o(S)?"#2228":"#eee"},null,8,be),r("line",{class:"subtract",onMousedown:i[1]||(i[1]=m=>_(-1)),x1:e.inverted?e.width:e.showCenter?e.width/2:0,x2:c.pos,y1:e.height/2,y2:e.height/2,"stroke-linecap":"round","stroke-width":e.height,stroke:o(S)?"#3338":"#ddd8"},null,40,ge),e.showPositions?(l(),a("g",ke,[(l(!0),a(k,null,N(v.value,(m,h)=>(l(),a("circle",{key:m,cx:m,cy:e.height/2,r:e.every&&h%e.every==0?4:2,fill:"currentColor",opacity:"0.5"},null,8,$e))),128))])):w("",!0),e.showCenter?(l(),a("circle",{key:1,cx:e.width/2,cy:e.height/2,r:"4",opacity:"0.5",fill:"currentColor"},null,8,_e)):w("",!0),r("g",{class:"mover",transform:`translate(${c.pos} ${e.height/2})`},[r("circle",{r:"25","stroke-width":"0","stroke-opacity":"0.5",stroke:"currentColor",style:{filter:"url(#shadowButton)"},fill:o(S)?"#333":"#eee"},null,8,Ne),r("g",Ve,[U(u.$slots,"default",{},()=>[r("text",null,$(e.modelValue),1)])])],8,Ce)])),[[s,n]])}}}),Se=["transform"],Me=["opacity"],ze=["width","fill"],Ae=["stroke","fill"],De=["fill"],Le=["stroke"],Re=["onDblclick","data-sub"],je=["transform"],Xe=["width","x","fill"],Ie=["transform","fill","opacity"],Pe=["x"],Ee=["fill","stroke"],Te={key:0,class:"transition-all duration-100 ease-out pointer-events-none",cx:0,cy:100,r:"3",fill:"currentColor",opacity:"0.8"},Ue={__name:"step",props:{proportion:{type:Number,default:1},step:{type:Number,default:1},subdivisions:{type:[Array,String],default:""},muted:{type:Boolean,default:!1},total:{type:Number,default:4},current:{type:[Number,String],default:0},mutes:{type:Object,default:{}},accented:{type:Boolean,default:!1},width:{type:Number,default:900},pad:{type:Number,default:50}},emits:["mute","subdivide","accent"],setup(e,{emit:b}){const t=e,c=V(()=>F(t.step+I.pitch/12*t.total,t.total,1));V(()=>t.subdivisions[0].includes("!"));const n=q(0,40,640),_=V(()=>Math.floor(n.value/40));z(_,(i,s)=>{if(i==s)return;let m=[];for(let h=0;h<i;h++)m.push(`${t.step}-${h}`);b("subdivide",m)});function v(i){if(i.tap){let s=i.event.currentTarget.dataset.sub;t.mutes[s]=!t.mutes[s]}n.value+=i.delta[0]-i.delta[1]}const u=V(()=>{let i=t.subdivisions[0]==t.current,s=t.subdivisions[0].split("-")[0],m=t.current.split("-")[0];return!t.mutes[t.subdivisions[0]]&&(i||s==m)});return(i,s)=>{const m=R("drag");return l(),a("g",{class:"cursor-pointer",transform:`translate(${e.proportion*e.step*e.width+e.pad},0)`},[r("g",{class:"step",opacity:e.muted?.1:1},[r("rect",{class:"transition-fill duration-100",onMousedown:s[0]||(s[0]=h=>i.$emit("mute")),width:e.proportion*e.width,height:"180",rx:"10",fill:u.value?e.muted?"transparent":c.value:"transparent"},null,40,ze),r("circle",{class:"transition-all duration-100 ease-out",onMousedown:s[1]||(s[1]=h=>e.muted?i.$emit("mute"):i.$emit("accent")),cy:"35",cx:"0",r:"25","stroke-width":"4",stroke:c.value,fill:u.value?e.muted?"transparent":"currentColor":e.accented?c.value:o(S)?"#333":"#eee"},null,40,Ae),r("text",{class:"pointer-events-none transition-all duration-100 ease-out",y:"48","font-size":"40","text-anchor":"middle",x:"0",fill:u.value?o(S)?"#333":"#eee":"currentColor"},$(e.step+1),9,De),r("line",{class:"pointer-events-none",y1:"60",y2:"100","stroke-width":"8",stroke:c.value},null,8,Le),(l(!0),a(k,null,N(e.subdivisions,(h,d)=>y((l(),a("g",{class:"sub",key:h,onDblclick:p=>{i.$emit("subdivide",[`${h}-1`]),n.value=40},"data-sub":h},[r("line",{transform:`translate(${d*e.proportion*e.width/e.subdivisions.length}, 0)`,y1:"100",y2:"150","stroke-width":"1",stroke:"currentColor"},null,8,je),r("rect",{class:"transition-fill duration-100",width:e.proportion*e.width/e.subdivisions.length,height:"80",y:"100",rx:"10",x:d*e.proportion*e.width/e.subdivisions.length,fill:`hsla(0,0%,${90-d*80/e.subdivisions.length}%,${h==e.current?.9:.4})`},null,8,Xe),r("circle",{class:"transition-all duration-100 ease-out pointer-events-none",transform:`translate(${d*e.proportion*e.width/e.subdivisions.length}, 0)`,cx:0,cy:100,r:6,fill:h==e.current?"currentColor":e.muted?"transparent":c.value,opacity:e.mutes[h]?0:1,"stroke-width":"4","stroke-linecap":"round"},null,8,Ie),e.mutes[h]?w("",!0):(l(),a("text",{key:0,y:"140","font-size":"40","text-anchor":"middle",x:15+d*e.proportion*e.width/e.subdivisions.length,fill:"currentColor"},$(d+1),9,Pe))],40,Re)),[[m,v]])),128)),r("circle",{class:"transition-all duration-100 ease-out pointer-events-none",cx:"0",cy:100,r:"10",fill:c.value,stroke:u.value?"currentColor":"transparent","stroke-width":"4",opacity:"0.8"},null,8,Ee)],8,Me),e.muted?(l(),a("circle",Te)):w("",!0)],8,Se)}}},j=e=>(te("data-v-a2e2f095"),e=e(),oe(),e),Oe={class:"w-full bg-light-300 dark-bg-dark-800",version:"1.1",baseProfile:"full",viewBox:"0 0 1000 350",xmlns:"http://www.w3.org/2000/svg",style:{"user-select":"none","touch-action":"none"}},qe=j(()=>r("defs",null,[r("filter",{id:"shadowButton",x:"-50%",height:"200%",width:"300%"},[r("feDropShadow",{dx:"0",dy:"3",stdDeviation:"3","flood-color":"#2225"})])],-1)),Fe={key:0,class:"meter-bars",transform:"translate(40,15)"},He=["transform"],Ge={class:"signature"},Je=j(()=>r("text",{fill:"currentColor","font-size":"45","text-anchor":"middle",y:"2"},"/",-1)),Ke={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"end",x:-10},Qe={fill:"currentColor","font-family":"Commissioner, sans-serif","font-size":"40px","text-anchor":"start",x:10},We=j(()=>r("circle",{r:"18",fill:"#5553"},null,-1)),Ye=j(()=>r("circle",{r:"18",fill:"#5553"},null,-1)),Ze={"text-anchor":"middle",style:{"user-select":"none",transition:"all 300ms ease"}},et=["opacity"],tt={class:"lines",transform:"translate(0,100)"},ot=["x1","x2"],nt=["x1","x2","stroke"],st={class:"arrows pointer-events-none"},lt=["transform"],rt=["cx","r","fill"],it={class:"bottom",transform:"translate(40,290)"},at={transform:"translate(-20 -30)"},ut=["transform"],dt=["fill"],ct=["transform"],mt=["fill"],ht=E({__name:"beat-bar",props:{order:{type:Number,default:0},loop:{type:Object,default:{over:4,under:4,sound:"A",volume:1}},maxRatio:{type:Number,default:1},editable:{type:Boolean,default:!1},mute:{type:String,default:null},accents:{type:String,default:null},width:{type:Number,default:920}},emits:["del","sound"],setup(e,{emit:b}){const t=e,c=V(()=>(1e3-t.width)/2),{seq:n}=ae(t.loop,t.order,"bars"),_=["A","B","C","D","E"],v=O(_.findIndex(i=>{var s;return i==((s=n.meter)==null?void 0:s.sound)}));z(v,i=>{n.meter.sound=_[i]});const u=V(()=>{const i=1/n.meter.over;return i>=t.maxRatio?t.maxRatio:i});return z(()=>t.loop,i=>{n.meter={...t.loop}},{immediate:!0}),z(()=>t.accents,i=>{i&&i.split("").forEach((s,m)=>{n.mutes[m]=s=="0"||s==".",n.accents[m]=s=="2"||s=="X"})},{immediate:!0}),(i,s)=>{const m=Be,h=K,d=Q,p=pe,A=W,L=Y,P=Z,H=J,g=R("tooltip");return l(),a(k,null,[U(i.$slots,"default",{},void 0,!0),(l(),a("svg",Oe,[qe,e.editable?(l(),a("g",Fe,[y(C(m,{class:"over",modelValue:o(n).meter.over,"onUpdate:modelValue":s[0]||(s[0]=f=>o(n).meter.over=f),width:340,step:1,min:2,max:16,"show-positions":"",ratio:500,every:4},null,8,["modelValue"]),[[g,"Number of steps",void 0,{top:!0}]]),y(C(m,{class:"under",transform:"translate(580,0)",modelValue:o(n).meter.under,"onUpdate:modelValue":s[1]||(s[1]=f=>o(n).meter.under=f),width:340,step:1,min:1,max:16,"show-positions":"",ratio:500,every:4,inverted:"",vector:[-1,-1]},null,8,["modelValue"]),[[g,"Measure subdivision",void 0,{top:!0}]])])):w("",!0),r("g",{class:"info",transform:"translate(500,53)"},[y((l(),a("g",Ge,[Je,r("text",Ke,$(o(n).meter.over),1),r("text",Qe,$(o(n).meter.under),1)])),[[g,"Time signature",void 0,{top:!0}]]),y((l(),a("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(70,-10)",onMousedown:s[2]||(s[2]=f=>o(n).rotateAccents(-1))},[We,C(h,{"font-size":"28",x:"-17",y:"-17"})],32)),[[g,"Rotate pattern backward",void 0,{top:!0}]]),y((l(),a("g",{class:"cursor-pointer opacity-50 transition-all duration-200 ease hover-opacity-100",transform:"translate(-70,-10)",onMousedown:s[3]||(s[3]=f=>o(n).rotateAccents(1))},[Ye,C(d,{"font-size":"28",x:"-17",y:"-17"})],32)),[[g,"Rotate pattern forward",void 0,{top:!0}]])],8,He),r("g",Ze,[r("g",{class:"steps",opacity:o(n).volume*.9+.1,transform:"translate(0,90)"},[r("g",tt,[r("line",{x1:c.value,x2:u.value*o(n).steps.length*e.width+c.value,stroke:"currentColor","stroke-width":"2"},null,8,ot),(l(!0),a(k,null,N(o(n).activeSteps,(f,x)=>(l(),a("line",{key:x,x1:u.value*Number(f)*e.width+c.value,x2:u.value*(o(n).activeSteps[x+1]||o(n).steps.length)*e.width+c.value,"stroke-width":"6",stroke:o(F)(Number(f)+Number(o(I).pitch)/12*o(n).steps.length,o(n).steps.length,1)},null,8,nt))),128))]),(l(!0),a(k,null,N(o(n).steps,(f,x)=>(l(),B(Ue,{key:x,onMute:X=>o(n).mutes[x]=!o(n).mutes[x],onSubdivide:X=>o(n).steps[x]=X,onAccent:X=>o(n).accents[x]=!o(n).accents[x],muted:o(n).mutes[x],step:x,accented:!!o(n).accents[x],mutes:o(n).mutes,current:o(n).current,subdivisions:f,proportion:u.value,total:o(n).steps.length,width:e.width,pad:c.value},null,8,["onMute","onSubdivide","onAccent","muted","step","accented","mutes","current","subdivisions","proportion","total","width","pad"]))),128)),r("g",st,[r("line",{class:"progress",transform:`translate(${c.value+o(n).progress*e.width*u.value*o(n).meter.over}, 0)`,"stroke-width":"4",stroke:"currentColor","stroke-linecap":"round",y2:180},null,8,lt)]),r("circle",{cx:u.value*o(n).steps.length*e.width+c.value,cy:100,r:o(n).mutes[1]?4:8,fill:o(n).mutes[1]?"currentColor":o(ie)(Number(o(I).pitch),4)},null,8,rt)],8,et),r("g",it,[y((l(),B(m,{class:"volume",modelValue:o(n).volume,"onUpdate:modelValue":s[4]||(s[4]=f=>o(n).volume=f),width:200,step:.01},{default:D(()=>[r("g",at,[o(n).volume==0?(l(),B(p,{key:0})):(l(),B(A,{key:1}))])]),_:1},8,["modelValue"])),[[g,"Track volume",void 0,{bottom:!0}]]),y((l(),B(m,{class:"pan",transform:"translate(270,0)",modelValue:o(n).pan,"onUpdate:modelValue":s[5]||(s[5]=f=>o(n).pan=f),min:-1,max:1,width:200,step:.01,"show-center":""},{default:D(()=>[C(L,{x:-18,y:-30})]),_:1},8,["modelValue"])),[[g,"Track panning",void 0,{bottom:!0}]]),y((l(),B(m,{class:"sound",transform:"translate(540,0)",modelValue:v.value,"onUpdate:modelValue":s[6]||(s[6]=f=>v.value=f),width:265,step:1,min:0,max:4,"show-positions":"",every:1},{default:D(()=>{var f;return[r("text",null,$((f=o(n).meter)==null?void 0:f.sound),1)]}),_:1},8,["modelValue"])),[[g,"Click sound select",void 0,{bottom:!0}]]),C(ee,{name:"fade"},{default:D(()=>[e.editable&&!o(n).isEuclidean?y((l(),a("g",{key:0,class:"reset cursor-pointer",onMousedown:s[7]||(s[7]=f=>o(n).reset()),transform:"translate(840, 0)"},[r("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:o(S)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,dt),C(P,{"stroke-width":"0",y:"9",x:"9","font-size":"26"})],40,ut)),[[g,"Reset to Euclidean pattern",void 0,{bottom:!0}]]):w("",!0)]),_:1}),e.editable?y((l(),a("g",{key:0,class:"del cursor-pointer",onMousedown:s[8]||(s[8]=f=>i.$emit("del")),transform:"translate(900, 0)"},[r("rect",{style:{filter:"url(#shadowButton)"},width:"50",height:"50","stroke-width":"3",rx:"40",fill:o(S)?"hsla(0,0%,30%,1)":"hsla(0,0%,100%,1)"},null,8,mt),C(H,{color:"hsla(0,25%,50%,1)","stroke-width":"0",y:"9",x:"9","font-size":"26"})],40,ct)),[[g,"Remove track",void 0,{bottom:!0}]]):w("",!0)])])]))],64)}}});const ft=ne(ht,[["__scopeId","data-v-a2e2f095"]]),M=me("tempo-bar-loops-object",{0:{over:8,under:8,volume:1,sound:"A"},1:{over:3,under:3,volume:.5,sound:"B"}}),vt={class:"flex flex-wrap items-center w-full p-4 has-bg rounded-xl relative gap-6 bg-light-600 dark-bg-dark-500",id:"screen"},yt={key:1,class:"flex flex-col p-2 my-2 is-group"},pt={class:"flex flex"},xt={class:"flex flex-wrap justify-center"},wt={class:"font-bold mx-2"},bt={key:0},gt={class:"flex flex-wrap justify-center is-group m-1 text-xl p-2",style:{flex:"1 1 100%"}},kt=r("div",{class:"i-la-plus"},null,-1),$t=[kt],_t=r("div",{class:"i-la-file-download"},null,-1),Ct=[_t],Nt={key:1,class:"is-group m-2"},Vt=["onClick"],Bt=["onClick"],Et={__name:"index",props:{meters:{type:Array,default:null},patterns:{type:Object,default:null},accents:{type:String,default:"XxXxXxXx"},mute:{type:String,delault:""},secondary:{type:Boolean,default:!1}},setup(e){const b=e,t=O(b.accents),c=T({over:4,under:4,volume:1,sound:"A"});z(()=>b.meters,v=>{if(v){let u=v[0].split("/");M.value={0:{over:Number(u[0]),under:Number(u[1]),volume:b.secondary?0:1,sound:"A"}}}},{immediate:!0}),z(()=>b.patterns,v=>{v&&(t.value=Object.keys(v)[0])},{immediate:!0});function n(v,u){M.value[0].over=v.length,M.value[0].under=u?u.split("/")[1]:v.length,t.value=v}function _(){M.value[Math.floor(Math.random()*1e4)]={...c}}return(v,u)=>{const i=G,s=se("client-only"),m=R("tooltip");return l(),a("div",vt,[C(s,null,{default:D(()=>{var h;return[e.secondary?w("",!0):(l(),B(i,{key:0,secondary:!0})),(l(!0),a(k,null,N(o(M),(d,p)=>(l(),B(ft,{class:"my-1 rounded-3xl shadow-lg min-h-36 max-h-30vh",style:{flex:"1 1 420px"},key:p,order:p,loop:d,maxRatio:o(ue),onDel:A=>delete o(M)[p],editable:!e.meters,accents:t.value,mute:e.mute},null,8,["order","loop","maxRatio","onDel","editable","accents","mute"]))),128)),e.patterns?(l(),a("div",yt,[r("div",pt,[(l(!0),a(k,null,N(t.value,(d,p)=>(l(),a("div",{class:"flex-1 p-1 border-1 border-current rounded-lg m-1 opacity-50",key:p,style:le({opacity:d=="X"?1:.5,backgroundColor:d=="1"||d=="X"||d=="x"?"currentColor":"transparent"})},null,4))),128))]),r("div",xt,[(l(!0),a(k,null,N((h=e.patterns[t.value])==null?void 0:h.names,d=>(l(),a("div",{class:"p-1",key:d},[r("span",wt,$(d.name),1),d.place?(l(),a("span",bt,"("+$(d.place)+")",1)):w("",!0)]))),128))])])):w("",!0),r("div",gt,[e.meters?w("",!0):y((l(),a("button",{key:0,class:"text-button",onClick:u[0]||(u[0]=d=>_())},$t)),[[m,"Add new track",void 0,{bottom:!0}]]),y((l(),a("button",{class:"text-button flex items-center",onClick:u[1]||(u[1]=d=>o(ce)(o(de)))},Ct)),[[m,"Export MIDI file",void 0,{bottom:!0}]]),e.meters&&e.meters.length>1?(l(),a("div",Nt,[(l(!0),a(k,null,N(e.meters,d=>(l(),a("button",{class:"text-button",onClick:p=>M.value=[{over:d.split("/")[0],under:d.split("/")[1],sound:"A",volume:1}]},$(d),9,Vt))),256))])):w("",!0),(l(!0),a(k,null,N(e.patterns,(d,p)=>{var A,L;return l(),a("button",{class:re(["text-button",{active:t.value==p}]),onClick:P=>n(p,d.meter)},$(((L=(A=d==null?void 0:d.names)==null?void 0:A[0])==null?void 0:L.name)||p),11,Bt)}),256))])]}),_:1})])}}};export{Et as _};
