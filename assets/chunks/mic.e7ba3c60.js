import{u as g,c as D}from"./index.4d18a0f4.js";import{u as m}from"./index.2be4a733.js";import{B as w,W as b,o as e,c as O,b as d,r as S,f as r,R as f,G as _,y as v}from"./index.e98b5e67.js";import{a as j,C as y,c as M}from"./audio.36f0d408.js";import{U as T}from"./UserMedia.9dadeb85.js";import{S as A}from"./Subtract.109130cb.js";import{O as C}from"./OnePoleFilter.8566943f.js";import{k as G,w as n}from"./framework.5d1030ab.js";class z extends w{constructor(){super(...arguments),this.name="Abs",this._abs=new b({context:this.context,mapping:t=>Math.abs(t)<.001?0:Math.abs(t)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class l extends w{constructor(){super(Object.assign(e(l.getDefaults(),arguments))),this.name="GreaterThanZero",this._thresh=this.output=new b({context:this.context,length:127,mapping:t=>t<=0?0:1}),this._scale=this.input=new O({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}}class h extends d{constructor(){super(Object.assign(e(h.getDefaults(),arguments,["value"]))),this.name="GreaterThan",this.override=!1;const t=e(h.getDefaults(),arguments,["value"]);this._subtract=this.input=new A({context:this.context,value:t.value}),this._gtz=this.output=new l({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,S(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(d.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}class u extends r{constructor(){super(e(u.getDefaults(),arguments,["smoothing"])),this.name="Follower";const t=e(u.getDefaults(),arguments,["smoothing"]);this._abs=this.input=new z({context:this.context}),this._lowpass=this.output=new C({context:this.context,frequency:1/this.toSeconds(t.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=t.smoothing}static getDefaults(){return Object.assign(r.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class c extends r{constructor(){super(Object.assign(e(c.getDefaults(),arguments,["threshold","smoothing"]))),this.name="Gate";const t=e(c.getDefaults(),arguments,["threshold","smoothing"]);this._follower=new u({context:this.context,smoothing:t.smoothing}),this._gt=new h({context:this.context,value:f(t.threshold)}),this.input=new _({context:this.context}),this._gate=this.output=new _({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(r.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return v(this._gt.value)}set threshold(t){this._gt.value=f(t)}get smoothing(){return this._follower.smoothing}set smoothing(t){this._follower.smoothing=t}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}const s=G({initiated:!1,open:!1,opened:!1,recording:!0,monitor:!1,meter:0,volume:m(g("mic-vol",1),0,5),gate:m(g("mic-gate",-60),-100,-40)});let o,i,a,x;function P(){if(!s.initiated){o=new j,o.normalRange=!0,i=new T,x=new y({threshold:-20,ratio:2}).connect(o),a=new c({threshold:-60,smoothing:1}),i.connect(a),a.connect(x);const{channel:p}=M("mic");n(()=>s.open,t=>{t?i.open().then(()=>{s.opened=!0,D(()=>{s.meter=o.getValue()})}):(i.close(),s.opened=!1)}),n(()=>s.monitor,t=>t?o.connect(p):o.disconnect(p)),n(()=>s.volume,t=>i.volume.rampTo(v(t)),{immediate:!0}),n(()=>s.gate,t=>a.threshold=t,{immediate:!0})}return{mic:s,input:i}}export{P as u};
