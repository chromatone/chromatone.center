import{e as K,g as U,l as L,o as W,q as G,t as Q,P as Z,D as X,v as Y,x as ee,y as te,T as N,z as oe,n as y,A as T,_ as se}from"./chunks/theme.NJ_Xky9a.js";import{_ as ae}from"./chunks/ControlScale.AuHab161.js";import{D as j,ak as ne,b as E,u as f,c as V,q as re,w as ie,o as le,d as x,x as pe,M as ue,E as p,F as u,G as r,V as $,W as M,L as D,C as _,I as A,P as B,Q as I,N as c,O as h,a0 as de,$ as ce,T as R,J as me,K as ve}from"./chunks/framework.avS8w96o.js";import"./chunks/ChromaKeys.lEw8VsE0.js";const w=b=>(me("data-v-e26763e5"),b=b(),ve(),b),fe={class:"flex flex-col"},_e=w(()=>r("div",{class:"row"},[r("div",{class:"title"})],-1)),ge=["id","onMousedown","onMouseenter"],he={class:"flex flex-wrap items-center justify-center"},be={class:"flex flex-wrap justify-center flex-1 bg-light-900 p-4 rounded-2xl dark-bg-dark-800 gap-2"},ye=["value"],xe={class:"is-group flex flex-wrap p-2"},we={class:"is-group"},ke=w(()=>r("div",{class:"i-la-trash-alt"},null,-1)),Ve=[ke],Ce={class:"is-group flex items-center"},qe=w(()=>r("div",{class:"i-la-play"},null,-1)),Se=[qe],Ee=w(()=>r("div",{class:"i-la-pause"},null,-1)),$e=[Ee],Me=w(()=>r("div",{class:"i-la-stop"},null,-1)),De=[Me],Pe={__name:"StepSequencer",setup(b){const{isDark:C}=ne(),t=E({started:!1,playing:!1,hover:!1,mounted:!1,current:0,octave:f("seq-octave",3),bpm:f("seq-bpm",120),steps:f("seq-steps",16),type:f("seq-type","up"),probability:f("seq-prob",1),humanize:f("seq-human",!1),interval:f("seq-interval","8n"),note:V(()=>K[U.tonic]),range:V(()=>L.rangeOf(t.note+t.octave+" "+U.set.name)(t.note+t.octave,t.note+(t.octave+2)).map(o=>W.simplify(o)).reverse()),midi:V(()=>t.range.map(o=>G.toMidi(o))),pitches:V(()=>t.midi.map(o=>(o+3)%12)),progress:0}),P=["up","down","upDown","downUp","alternateUp","alternateDown","random","randomWalk","randomOnce"],n=E([]),g=E([]);let d=[];re(" ",o=>{o.preventDefault(),t.playing=!t.playing}),ie(()=>{t.range.forEach((o,e)=>{n[e]=n[e]||[],n[e].length=t.steps,n.length=t.range.length,Array.apply(null,n[e]).forEach((s,i)=>{n[e][i]={row:e,cell:i,note:o,active:(s==null?void 0:s.active)||!1}})})}),le(()=>{t.mounted=!0,Q(),q()}),x(()=>t.steps,()=>{t.mounted&&q()},{immediate:!0});function q(){d.forEach(o=>{o.stop(0),o.dispose()}),d=[],n.forEach((o,e)=>{d[e]=new Z((m,s)=>{X.schedule(()=>{g[e]=s==null?void 0:s.cell,s!=null&&s.active&&Y(s==null?void 0:s.note)},m),s!=null&&s.active&&(ee(s.note,t.interval,m),te(s.note,t.interval,m))},n[e],t.type).start(0),d[e].interval=t.interval})}let z;function O(o,e,m,s){!t.hover&&!m||!m&&z==s.target.id||(z=s.target.id,n[o][e].active?n[o][e].active=!1:n[o][e].active=!0)}function F(){n.forEach((o,e)=>{o.forEach((m,s)=>n[e][s].active=!1)})}x(()=>t.playing,o=>{o?(d.forEach(e=>{e.start(0)}),N.start(),t.started||(oe(),t.started=!0)):(d.forEach(e=>{e.stop()}),N.stop())}),x(()=>t.type,o=>{d.forEach(e=>{e.pattern=o})},{immediate:!0}),x(()=>t.probability,o=>{d.forEach(e=>{e.probability=o})},{immediate:!0}),x(()=>t.humanize,o=>{d.forEach(e=>{e.humanize=o})},{immediate:!0});function H(){t.playing=!1,q()}pe(()=>{d.forEach(o=>{o.stop(0),o.dispose()})});function J(o,e){return o.active?y(t.pitches[e]):o.cell==g[e]?C.value?"#eee7":"#3337":"#4444"}return(o,e)=>{const m=ae,s=se,i=ue("tooltip");return p(),u("div",fe,[r("div",{class:"rows",onMousedown:e[0]||(e[0]=a=>t.hover=!0),onMouseleave:e[1]||(e[1]=I(a=>t.hover=!1,["self"])),onMouseup:e[2]||(e[2]=a=>t.hover=!1)},[_e,(p(!0),u($,null,M(n,(a,l)=>(p(),u("div",{class:"row",key:a},[r("div",{class:"title m-1 rounded-md shadow",style:D({color:_(y)(t.pitches[l]),backgroundColor:t.range[l].length>2?"#0005":"#aaa5"})},A(t.range[l]),5),(p(!0),u($,null,M(a,(v,k)=>(p(),u("div",{class:B(["cell",{active:v==null?void 0:v.active,current:v.cell==g[l]}]),id:`c${l}-${k}`,key:v,style:D({color:_(y)(t.pitches[l]),borderColor:J(v,l),backgroundColor:v.cell==g[l]?v.active?_(y)(t.pitches[l],3):_(C)?"#0005":"#fff5":"transparent",marginRight:k%4==3?"12px":"1px"}),onMousedown:I(S=>O(l,k,!0,S),["prevent"]),onMouseenter:S=>O(l,k,!1,S)},[r("div",{class:"dot",style:D({backgroundColor:v.active?_(y)(t.pitches[l]):v.cell==g[l]?"currentColor":"#4448"})},null,4)],46,ge))),128))]))),128))],32),r("div",he,[c(h(m,{class:"flex-1"},null,512),[[i,"Select root note and scale",void 0,{top:!0}]]),r("div",be,[c((p(),u("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>t.type=a)},[(p(),u($,null,M(P,a=>r("option",{key:a,value:a},A(a),9,ye)),64))])),[[de,t.type],[i,"Pattern type",void 0,{top:!0}]]),r("div",xe,[c(h(s,{modelValue:t.octave,"onUpdate:modelValue":e[4]||(e[4]=a=>t.octave=a),max:4,min:2,fixed:0,param:"OCTAVE"},null,8,["modelValue"]),[[i,"Octave",void 0,{top:!0}]]),c(h(s,{modelValue:t.steps,"onUpdate:modelValue":e[5]||(e[5]=a=>t.steps=a),max:32,min:4,step:1,fixed:0,param:"steps"},null,8,["modelValue"]),[[i,"Number of steps",void 0,{top:!0}]]),c(h(s,{modelValue:t.probability,"onUpdate:modelValue":e[6]||(e[6]=a=>t.probability=a),max:1,min:0,step:.01,fixed:2,param:"prob"},null,8,["modelValue"]),[[i,"Probability",void 0,{top:!0}]]),c(h(s,{modelValue:_(T).bpm,"onUpdate:modelValue":e[7]||(e[7]=a=>_(T).bpm=a),step:1,max:400,min:10,fixed:0,param:"BPM"},null,8,["modelValue"]),[[i,"Set tempo",void 0,{top:!0}]])]),r("div",we,[c((p(),u("button",{class:B(["text-button",{active:t.humanize}]),onClick:e[8]||(e[8]=a=>t.humanize=!t.humanize)},[ce("HMN")],2)),[[i,"Humanize rhythm",void 0,{bottom:!0}]]),c((p(),u("button",{class:"text-button",onClick:e[9]||(e[9]=a=>F())},Ve)),[[i,"Clear pattern",void 0,{bottom:!0}]])]),r("div",Ce,[t.playing?R("",!0):c((p(),u("button",{key:0,class:"text-button",onClick:e[10]||(e[10]=a=>t.playing=!0)},Se)),[[i,"Play",void 0,{bottom:!0}]]),t.playing?c((p(),u("button",{key:1,class:"text-button",onClick:e[11]||(e[11]=a=>t.playing=!1)},$e)),[[i,"Pause",void 0,{bottom:!0}]]):R("",!0),c((p(),u("button",{class:"text-button",onClick:e[12]||(e[12]=a=>H())},De)),[[i,"Stop",void 0,{bottom:!0}]])])])])])}}},ze=j(Pe,[["__scopeId","data-v-e26763e5"]]),Ie=JSON.parse('{"title":"Step sequencer","description":"A simple tool to build up melodies and chord progressions","frontmatter":{"title":"Step sequencer","description":"A simple tool to build up melodies and chord progressions","layout":"app","date":"2021-08-19T00:00:00.000Z","cover":"sequencer.png"},"headers":[],"relativePath":"practice/chord/sequencer/index.md","filePath":"practice/chord/sequencer/index.md","lastUpdated":1709374066000}'),Oe={name:"practice/chord/sequencer/index.md"};function Ue(b,C,t,P,n,g){const d=ze;return p(),u("div",null,[h(d)])}const Re=j(Oe,[["render",Ue]]);export{Ie as __pageData,Re as default};
