import{Y as T,O as N,u as S,Z as B,$ as F,a0 as R,v as w,F as y,a1 as P}from"./chunks/theme.DRfkbxnY.js";import{b as v,c as x,d as O,C as a,D as c,F as t,L as r,K as s,G as b,H as $,a2 as q,B as V,a0 as M,S as E,a5 as L}from"./chunks/framework.C3LH_Uf3.js";const Z={class:"flex flex-col"},z={class:"text-2xl"},G={class:"flex flex-wrap"},H={key:0,class:"i-la-circle"},J={key:1,class:"i-mdi-checkbox-blank-circle"},K={key:0,class:"i-la-play"},Q={key:1,class:"i-la-pause"},U=t("div",{class:"i-la-stop"},null,-1),W=[U],Y=t("div",{class:"i-la-trash-alt"},null,-1),j=[Y],A=t("div",{class:"i-la-plus"},null,-1),X=[A],tt={class:"p-1"},et=t("div",{class:"i-la-minus"},null,-1),st=[et],ot=t("div",{class:"p-1"},"/",-1),it=t("div",{class:"i-la-plus"},null,-1),nt=[it],lt={class:"p-1"},rt=t("div",{class:"i-la-minus"},null,-1),at=[rt],ct={class:"flex flex-col"},dt=["viewBox"],ut=["width","height"],pt=["x1","x2","y2"],_t=["transform"],ht=["y2"],mt={y:"3",x:"1","font-size":"2"},vt={class:"flex text-xs p-4"},xt={class:"grid grid-cols-3 text-xs gap-2"},gt={__name:"MidiRows",setup(C){const g=T();N();const{midi:_}=S(),{seq:n}=B(null,1,"row"),d=F(),i=v({width:100,height:30,progress:x(()=>i.width*n.progress),recording:!1}),h=x(()=>n.meter.over*g.PPQ*4/n.meter.under),u=x(()=>d.ticks%h.value),I=new R((l,e)=>{console.log(e),w(y(e.midi,"midi").toNote(),e.duration+"i")}).set({loop:!0,loopEnd:"800i",loopStart:0,playbackRate:1,probability:1}).start(0),m=v({}),k=v([]),{track:f,midiFile:wt}=D();O(()=>_.note,l=>{if(w(y(l.number,"midi").toNote()+"","196i"),!(!i.recording||!d.playing))if(l.velocity>0)m[l.number]=u.value;else{const e=m==null?void 0:m[l.number],p=u.value;let o;p>e?o=p-e:o=h.value-e+p,k.push({ticks:u.value,midi:l.number,channel:l.channel,start:e,stop:p,duration:o}),I.add({time:u.value+"i",midi:l.number,duration:o})}});function D(){const l=new P.Midi;l.name="Chromatone recording";const e=l.addTrack();return{midiFile:l,track:e}}return(l,e)=>{var p;return a(),c("div",Z,[t("div",z,"MIDI ROWS "+r(u.value)+"/"+r(h.value),1),t("div",G,[t("button",{onClick:e[0]||(e[0]=o=>i.recording=!i.recording)},[i.recording?(a(),c("div",J)):(a(),c("div",H))]),t("button",{onClick:e[1]||(e[1]=o=>s(d).playing=!s(d).playing)},[s(d).playing?(a(),c("div",Q)):(a(),c("div",K))]),t("button",{onClick:e[2]||(e[2]=o=>s(d).stopped=Date.now())},W),t("button",{onClick:e[3]||(e[3]=o=>s(f).notes=[])},j),t("button",{onClick:e[4]||(e[4]=o=>s(n).meter.over++)},X),t("div",tt,r(s(n).meter.over),1),t("button",{onClick:e[5]||(e[5]=o=>s(n).meter.over--)},st),ot,t("button",{onClick:e[6]||(e[6]=o=>s(n).meter.under++)},nt),t("div",lt,r(s(n).meter.under),1),t("button",{onClick:e[7]||(e[7]=o=>s(n).meter.under--)},at)]),t("div",ct,[(a(),c("svg",{viewBox:`0 0 ${i.width} ${i.height}`},[t("rect",{width:i.width,height:i.height,fill:"#999"},null,8,ut),(a(!0),c(b,null,$((p=s(_))==null?void 0:p.channels,o=>(a(),c("g",{class:"channel",key:o}))),128)),t("line",{x1:i.progress,x2:i.progress,y1:0,y2:i.height,stroke:"black"},null,8,pt),(a(!0),c(b,null,$(s(n).steps,o=>(a(),c("g",{key:o,transform:`translate(${i.width*o[0].split("-")[0]/s(n).steps.length})`},[t("line",{y2:i.height,stroke:"black","stroke-width":"0.1"},null,8,ht),t("text",mt,r(Number(o[0].split("-")[0])+1),1)],8,_t))),128))],8,dt))]),t("div",vt,r(k),1),t("div",xt,[t("pre",null,r(s(n)),1),t("pre",null,r(s(d)),1),t("pre",null,[q(),t("p",null," "+r(s(f)),1),t("p",null,r(s(_).clock),1),t("p",null,r(s(_).note),1)])])])}}},$t=JSON.parse('{"title":"MIDI Rows","description":"Measurewise MIDI recorder","frontmatter":{"title":"MIDI Rows","description":"Measurewise MIDI recorder","date":"2020-02-02T00:00:00.000Z","layout":"app"},"headers":[],"relativePath":"practice/experiments/rows/index.md","filePath":"practice/experiments/rows/index.md","lastUpdated":1720375267000}'),kt={name:"practice/experiments/rows/index.md"};function ft(C,g,_,n,d,i){const h=gt,u=L("client-only");return a(),c("div",null,[M(u,null,{default:E(()=>[M(h)]),_:1})])}const Mt=V(kt,[["render",ft]]);export{$t as __pageData,Mt as default};
