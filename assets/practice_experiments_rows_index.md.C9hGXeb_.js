import{Q as B,N as P,R as S,T as F,U as V,e as M,V as E}from"./chunks/theme.CMLB9bsx.js";import{H as f,G as _,J as O,c as r,h as a,i as s,B as l,u as e,F as C,Q as I,aI as Q,_ as q,t as T,s as J,f as U}from"./chunks/framework.DqGUeSFU.js";const z={class:"flex flex-col"},G={class:"text-2xl"},H={class:"flex flex-wrap"},L={key:0,class:"i-la-circle"},W={key:1,class:"i-mdi-checkbox-blank-circle"},Z={key:0,class:"i-la-play"},j={key:1,class:"i-la-pause"},A={class:"p-1"},K={class:"p-1"},X={class:"flex flex-col"},Y=["viewBox"],tt=["width","height"],st=["x1","x2","y2"],et=["transform"],it=["y2"],nt={y:"3",x:"1","font-size":"2"},ot={class:"flex text-xs p-4"},lt={class:"grid grid-cols-3 text-xs gap-2"},rt={__name:"MidiRows",setup(D){const w=B(),{midi:v,clock:h}=P(),{seq:y,meter:d,steps:m,progress:k}=S(null,1,"row"),u=F(),n=f({width:100,height:30,progress:_(()=>n.width*k.value),recording:!1}),g=_(()=>d.over*w.PPQ*4/d.under),p=_(()=>u.ticks%g.value),N=new V((o,t)=>{M(t.midi)}).set({loop:!0,loopEnd:"800i",loopStart:0,playbackRate:1,probability:1}).start(0),x=f({}),b=f([]),{track:$,midiFile:ut}=R();O(()=>v.note,o=>{if(M(o.midi),!(!n.recording||!u.playing))if(o.velocity>0)x[o.number]=p.value;else{const t=x==null?void 0:x[o.number],c=p.value;let i;c>t?i=c-t:i=g.value-t+c,b.push({ticks:p.value,midi:o.number,channel:o.channel,start:t,stop:c,duration:i}),N.add({time:p.value+"i",midi:o.number,duration:i})}});function R(){const o=new E.Midi;o.name="Chromatone recording";const t=o.addTrack();return{midiFile:o,track:t}}return(o,t)=>{var c;return r(),a("div",z,[s("div",G,"MIDI ROWS "+l(p.value)+"/"+l(g.value),1),s("div",H,[s("button",{onClick:t[0]||(t[0]=i=>n.recording=!n.recording)},[n.recording?(r(),a("div",W)):(r(),a("div",L))]),s("button",{onClick:t[1]||(t[1]=i=>e(u).playing=!e(u).playing)},[e(u).playing?(r(),a("div",j)):(r(),a("div",Z))]),s("button",{onClick:t[2]||(t[2]=i=>e(u).stopped=Date.now())},t[8]||(t[8]=[s("div",{class:"i-la-stop"},null,-1)])),s("button",{onClick:t[3]||(t[3]=i=>e($).notes=[])},t[9]||(t[9]=[s("div",{class:"i-la-trash-alt"},null,-1)])),s("button",{onClick:t[4]||(t[4]=i=>e(d).over++)},t[10]||(t[10]=[s("div",{class:"i-la-plus"},null,-1)])),s("div",A,l(e(d).over),1),s("button",{onClick:t[5]||(t[5]=i=>e(d).over--)},t[11]||(t[11]=[s("div",{class:"i-la-minus"},null,-1)])),t[14]||(t[14]=s("div",{class:"p-1"},"/",-1)),s("button",{onClick:t[6]||(t[6]=i=>e(d).under++)},t[12]||(t[12]=[s("div",{class:"i-la-plus"},null,-1)])),s("div",K,l(e(d).under),1),s("button",{onClick:t[7]||(t[7]=i=>e(d).under--)},t[13]||(t[13]=[s("div",{class:"i-la-minus"},null,-1)]))]),s("div",X,[(r(),a("svg",{viewBox:`0 0 ${n.width} ${n.height}`},[s("rect",{width:n.width,height:n.height,fill:"#999"},null,8,tt),(r(!0),a(C,null,I((c=e(v))==null?void 0:c.channels,i=>(r(),a("g",{class:"channel",key:i}))),128)),s("line",{x1:n.progress,x2:n.progress,y1:0,y2:n.height,stroke:"black"},null,8,st),(r(!0),a(C,null,I(e(m),i=>(r(),a("g",{key:i,transform:`translate(${n.width*i[0].split("-")[0]/e(m).length})`},[s("line",{y2:n.height,stroke:"black","stroke-width":"0.1"},null,8,it),s("text",nt,l(Number(i[0].split("-")[0])+1),1)],8,et))),128))],8,Y))]),s("div",ot,l(b),1),s("div",lt,[s("pre",null,l(e(y)),1),s("pre",null,l(e(u)),1),s("pre",null,[t[15]||(t[15]=Q()),s("p",null," "+l(e($)),1),s("p",null,l(e(h)),1),s("p",null,l(e(v).note),1)])])])}}},vt=JSON.parse('{"title":"MIDI Rows","description":"Measurewise MIDI recorder","frontmatter":{"title":"MIDI Rows","description":"Measurewise MIDI recorder","date":"2020-02-02T00:00:00.000Z","layout":"app"},"headers":[],"relativePath":"practice/experiments/rows/index.md","filePath":"practice/experiments/rows/index.md","lastUpdated":1739467643000}'),at={name:"practice/experiments/rows/index.md"};function dt(D,w,v,h,y,d){const m=rt,k=U("client-only");return r(),a("div",null,[T(k,null,{default:J(()=>[T(m)]),_:1})])}const mt=q(at,[["render",dt]]);export{vt as __pageData,mt as default};
