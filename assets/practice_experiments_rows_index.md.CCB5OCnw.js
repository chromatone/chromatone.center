import{X as B,R as P,Y as S,Z as q,$ as O,e as M,F as C,a0 as V}from"./chunks/theme.DVBhUxD1.js";import{b as f,c as _,d as E,f as r,g as a,h as e,m as l,l as s,F as I,j as T,au as Z,_ as j,R as D,A as z,$ as A}from"./chunks/framework.D4K5LW16.js";const J={class:"flex flex-col"},L={class:"text-2xl"},Q={class:"flex flex-wrap"},U={key:0,class:"i-la-circle"},W={key:1,class:"i-mdi-checkbox-blank-circle"},X={key:0,class:"i-la-play"},Y={key:1,class:"i-la-pause"},G={class:"p-1"},H={class:"p-1"},K={class:"flex flex-col"},tt=["viewBox"],et=["width","height"],st=["x1","x2","y2"],it=["transform"],nt=["y2"],ot={y:"3",x:"1","font-size":"2"},lt={class:"flex text-xs p-4"},rt={class:"grid grid-cols-3 text-xs gap-2"},at={__name:"MidiRows",setup(N){const w=B(),{midi:m,clock:y}=P(),{seq:h,meter:d,steps:v,progress:g}=S(null,1,"row"),u=q(),n=f({width:100,height:30,progress:_(()=>n.width*g.value),recording:!1}),k=_(()=>d.over*w.PPQ*4/d.under),p=_(()=>u.ticks%k.value),R=new O((o,t)=>{console.log(t),M(C(t.midi,"midi").toNote())}).set({loop:!0,loopEnd:"800i",loopStart:0,playbackRate:1,probability:1}).start(0),x=f({}),b=f([]),{track:$,midiFile:ct}=F();E(()=>m.note,o=>{if(M(C(o.midi,"midi").toNote()),!(!n.recording||!u.playing))if(o.velocity>0)x[o.number]=p.value;else{const t=x==null?void 0:x[o.number],c=p.value;let i;c>t?i=c-t:i=k.value-t+c,b.push({ticks:p.value,midi:o.number,channel:o.channel,start:t,stop:c,duration:i}),R.add({time:p.value+"i",midi:o.number,duration:i})}});function F(){const o=new V.Midi;o.name="Chromatone recording";const t=o.addTrack();return{midiFile:o,track:t}}return(o,t)=>{var c;return r(),a("div",J,[e("div",L,"MIDI ROWS "+l(p.value)+"/"+l(k.value),1),e("div",Q,[e("button",{onClick:t[0]||(t[0]=i=>n.recording=!n.recording)},[n.recording?(r(),a("div",W)):(r(),a("div",U))]),e("button",{onClick:t[1]||(t[1]=i=>s(u).playing=!s(u).playing)},[s(u).playing?(r(),a("div",Y)):(r(),a("div",X))]),e("button",{onClick:t[2]||(t[2]=i=>s(u).stopped=Date.now())},t[8]||(t[8]=[e("div",{class:"i-la-stop"},null,-1)])),e("button",{onClick:t[3]||(t[3]=i=>s($).notes=[])},t[9]||(t[9]=[e("div",{class:"i-la-trash-alt"},null,-1)])),e("button",{onClick:t[4]||(t[4]=i=>s(d).over++)},t[10]||(t[10]=[e("div",{class:"i-la-plus"},null,-1)])),e("div",G,l(s(d).over),1),e("button",{onClick:t[5]||(t[5]=i=>s(d).over--)},t[11]||(t[11]=[e("div",{class:"i-la-minus"},null,-1)])),t[14]||(t[14]=e("div",{class:"p-1"},"/",-1)),e("button",{onClick:t[6]||(t[6]=i=>s(d).under++)},t[12]||(t[12]=[e("div",{class:"i-la-plus"},null,-1)])),e("div",H,l(s(d).under),1),e("button",{onClick:t[7]||(t[7]=i=>s(d).under--)},t[13]||(t[13]=[e("div",{class:"i-la-minus"},null,-1)]))]),e("div",K,[(r(),a("svg",{viewBox:`0 0 ${n.width} ${n.height}`},[e("rect",{width:n.width,height:n.height,fill:"#999"},null,8,et),(r(!0),a(I,null,T((c=s(m))==null?void 0:c.channels,i=>(r(),a("g",{class:"channel",key:i}))),128)),e("line",{x1:n.progress,x2:n.progress,y1:0,y2:n.height,stroke:"black"},null,8,st),(r(!0),a(I,null,T(s(v),i=>(r(),a("g",{key:i,transform:`translate(${n.width*i[0].split("-")[0]/s(v).length})`},[e("line",{y2:n.height,stroke:"black","stroke-width":"0.1"},null,8,nt),e("text",ot,l(Number(i[0].split("-")[0])+1),1)],8,it))),128))],8,tt))]),e("div",lt,l(b),1),e("div",rt,[e("pre",null,l(s(h)),1),e("pre",null,l(s(u)),1),e("pre",null,[t[15]||(t[15]=Z()),e("p",null," "+l(s($)),1),e("p",null,l(s(y)),1),e("p",null,l(s(m).note),1)])])])}}},vt=JSON.parse('{"title":"MIDI Rows","description":"Measurewise MIDI recorder","frontmatter":{"title":"MIDI Rows","description":"Measurewise MIDI recorder","date":"2020-02-02T00:00:00.000Z","layout":"app"},"headers":[],"relativePath":"practice/experiments/rows/index.md","filePath":"practice/experiments/rows/index.md","lastUpdated":1727601639000}'),dt={name:"practice/experiments/rows/index.md"};function ut(N,w,m,y,h,d){const v=at,g=A("client-only");return r(),a("div",null,[D(g,null,{default:z(()=>[D(v)]),_:1})])}const xt=j(dt,[["render",ut]]);export{vt as __pageData,xt as default};
