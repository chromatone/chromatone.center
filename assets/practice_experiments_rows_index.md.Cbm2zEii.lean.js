import{R as N,T as R,U as F,V as B,W as P,e as h,F as b,X as S}from"./chunks/theme.B80b73CT.js";import{b as g,c as k,d as V,f as a,g as d,h as e,m as r,l as s,F as $,j as M,au as q,_ as O,R as C,A as E,$ as U}from"./chunks/framework.BH4RfCYQ.js";const W={class:"flex flex-col"},j={class:"text-2xl"},z={class:"flex flex-wrap"},A={key:0,class:"i-la-circle"},J={key:1,class:"i-mdi-checkbox-blank-circle"},L={key:0,class:"i-la-play"},Q={key:1,class:"i-la-pause"},X={class:"p-1"},Z={class:"p-1"},G={class:"flex flex-col"},H=["viewBox"],K=["width","height"],Y=["x1","x2","y2"],tt=["transform"],et=["y2"],st={y:"3",x:"1","font-size":"2"},it={class:"flex text-xs p-4"},nt={class:"grid grid-cols-3 text-xs gap-2"},ot={__name:"MidiRows",setup(I){const f=N(),{midi:v,clock:_}=R(),{seq:o}=F(null,1,"row"),u=B(),n=g({width:100,height:30,progress:k(()=>n.width*o.progress),recording:!1}),p=k(()=>o.meter.over*f.PPQ*4/o.meter.under),m=k(()=>u.ticks%p.value),T=new P((l,t)=>{console.log(t),h(b(t.midi,"midi").toNote())}).set({loop:!0,loopEnd:"800i",loopStart:0,playbackRate:1,probability:1}).start(0),x=g({}),w=g([]),{track:y,midiFile:at}=D();V(()=>v.note,l=>{if(h(b(l.midi,"midi").toNote()),!(!n.recording||!u.playing))if(l.velocity>0)x[l.number]=m.value;else{const t=x==null?void 0:x[l.number],c=m.value;let i;c>t?i=c-t:i=p.value-t+c,w.push({ticks:m.value,midi:l.number,channel:l.channel,start:t,stop:c,duration:i}),T.add({time:m.value+"i",midi:l.number,duration:i})}});function D(){const l=new S.Midi;l.name="Chromatone recording";const t=l.addTrack();return{midiFile:l,track:t}}return(l,t)=>{var c;return a(),d("div",W,[e("div",j,"MIDI ROWS "+r(m.value)+"/"+r(p.value),1),e("div",z,[e("button",{onClick:t[0]||(t[0]=i=>n.recording=!n.recording)},[n.recording?(a(),d("div",J)):(a(),d("div",A))]),e("button",{onClick:t[1]||(t[1]=i=>s(u).playing=!s(u).playing)},[s(u).playing?(a(),d("div",Q)):(a(),d("div",L))]),e("button",{onClick:t[2]||(t[2]=i=>s(u).stopped=Date.now())},t[8]||(t[8]=[e("div",{class:"i-la-stop"},null,-1)])),e("button",{onClick:t[3]||(t[3]=i=>s(y).notes=[])},t[9]||(t[9]=[e("div",{class:"i-la-trash-alt"},null,-1)])),e("button",{onClick:t[4]||(t[4]=i=>s(o).meter.over++)},t[10]||(t[10]=[e("div",{class:"i-la-plus"},null,-1)])),e("div",X,r(s(o).meter.over),1),e("button",{onClick:t[5]||(t[5]=i=>s(o).meter.over--)},t[11]||(t[11]=[e("div",{class:"i-la-minus"},null,-1)])),t[14]||(t[14]=e("div",{class:"p-1"},"/",-1)),e("button",{onClick:t[6]||(t[6]=i=>s(o).meter.under++)},t[12]||(t[12]=[e("div",{class:"i-la-plus"},null,-1)])),e("div",Z,r(s(o).meter.under),1),e("button",{onClick:t[7]||(t[7]=i=>s(o).meter.under--)},t[13]||(t[13]=[e("div",{class:"i-la-minus"},null,-1)]))]),e("div",G,[(a(),d("svg",{viewBox:`0 0 ${n.width} ${n.height}`},[e("rect",{width:n.width,height:n.height,fill:"#999"},null,8,K),(a(!0),d($,null,M((c=s(v))==null?void 0:c.channels,i=>(a(),d("g",{class:"channel",key:i}))),128)),e("line",{x1:n.progress,x2:n.progress,y1:0,y2:n.height,stroke:"black"},null,8,Y),(a(!0),d($,null,M(s(o).steps,i=>(a(),d("g",{key:i,transform:`translate(${n.width*i[0].split("-")[0]/s(o).steps.length})`},[e("line",{y2:n.height,stroke:"black","stroke-width":"0.1"},null,8,et),e("text",st,r(Number(i[0].split("-")[0])+1),1)],8,tt))),128))],8,H))]),e("div",it,r(w),1),e("div",nt,[e("pre",null,r(s(o)),1),e("pre",null,r(s(u)),1),e("pre",null,[t[15]||(t[15]=q()),e("p",null," "+r(s(y)),1),e("p",null,r(s(_)),1),e("p",null,r(s(v).note),1)])])])}}},ct=JSON.parse('{"title":"MIDI Rows","description":"Measurewise MIDI recorder","frontmatter":{"title":"MIDI Rows","description":"Measurewise MIDI recorder","date":"2020-02-02T00:00:00.000Z","layout":"app"},"headers":[],"relativePath":"practice/experiments/rows/index.md","filePath":"practice/experiments/rows/index.md","lastUpdated":1725784341000}'),lt={name:"practice/experiments/rows/index.md"};function rt(I,f,v,_,o,u){const n=ot,p=U("client-only");return a(),d("div",null,[C(p,null,{default:E(()=>[C(n)]),_:1})])}const pt=O(lt,[["render",rt]]);export{ct as __pageData,pt as default};
