import{V as B,R as P,W as S,X as V,Y as q,e as M,Z as E}from"./chunks/theme.DLCqlVTm.js";import{D as g,M as f,I as F,q as r,f as a,s as e,z as l,u as s,F as C,Y as I,aw as O,_ as z,i as W,l as D,j as Y}from"./chunks/framework.CxSiiyCs.js";const Z={class:"flex flex-col"},j={class:"text-2xl"},J={class:"flex flex-wrap"},L={key:0,class:"i-la-circle"},Q={key:1,class:"i-mdi-checkbox-blank-circle"},U={key:0,class:"i-la-play"},X={key:1,class:"i-la-pause"},A={class:"p-1"},G={class:"p-1"},H={class:"flex flex-col"},K=["viewBox"],tt=["width","height"],et=["x1","x2","y2"],st=["transform"],it=["y2"],nt={y:"3",x:"1","font-size":"2"},ot={class:"flex text-xs p-4"},lt={class:"grid grid-cols-3 text-xs gap-2"},rt={__name:"MidiRows",setup(T){const _=B(),{midi:p,clock:w}=P(),{seq:y,meter:d,steps:v,progress:x}=S(null,1,"row"),u=V(),n=g({width:100,height:30,progress:f(()=>n.width*x.value),recording:!1}),k=f(()=>d.over*_.PPQ*4/d.under),c=f(()=>u.ticks%k.value),N=new q((o,t)=>{M(t.midi)}).set({loop:!0,loopEnd:"800i",loopStart:0,playbackRate:1,probability:1}).start(0),h=g({}),b=g([]),{track:$}=R();F(()=>p.note,o=>{if(M(o.midi),!(!n.recording||!u.playing))if(o.velocity>0)h[o.number]=c.value;else{const t=h?.[o.number],i=c.value;let m;i>t?m=i-t:m=k.value-t+i,b.push({ticks:c.value,midi:o.number,channel:o.channel,start:t,stop:i,duration:m}),N.add({time:c.value+"i",midi:o.number,duration:m})}});function R(){const o=new E.Midi;o.name="Chromatone recording";const t=o.addTrack();return{midiFile:o,track:t}}return(o,t)=>(a(),r("div",Z,[e("div",j,"MIDI ROWS "+l(c.value)+"/"+l(k.value),1),e("div",J,[e("button",{onClick:t[0]||(t[0]=i=>n.recording=!n.recording)},[n.recording?(a(),r("div",Q)):(a(),r("div",L))]),e("button",{onClick:t[1]||(t[1]=i=>s(u).playing=!s(u).playing)},[s(u).playing?(a(),r("div",X)):(a(),r("div",U))]),e("button",{onClick:t[2]||(t[2]=i=>s(u).stopped=Date.now())},t[8]||(t[8]=[e("div",{class:"i-la-stop"},null,-1)])),e("button",{onClick:t[3]||(t[3]=i=>s($).notes=[])},t[9]||(t[9]=[e("div",{class:"i-la-trash-alt"},null,-1)])),e("button",{onClick:t[4]||(t[4]=i=>s(d).over++)},t[10]||(t[10]=[e("div",{class:"i-la-plus"},null,-1)])),e("div",A,l(s(d).over),1),e("button",{onClick:t[5]||(t[5]=i=>s(d).over--)},t[11]||(t[11]=[e("div",{class:"i-la-minus"},null,-1)])),t[14]||(t[14]=e("div",{class:"p-1"},"/",-1)),e("button",{onClick:t[6]||(t[6]=i=>s(d).under++)},t[12]||(t[12]=[e("div",{class:"i-la-plus"},null,-1)])),e("div",G,l(s(d).under),1),e("button",{onClick:t[7]||(t[7]=i=>s(d).under--)},t[13]||(t[13]=[e("div",{class:"i-la-minus"},null,-1)]))]),e("div",H,[(a(),r("svg",{viewBox:`0 0 ${n.width} ${n.height}`},[e("rect",{width:n.width,height:n.height,fill:"#999"},null,8,tt),(a(!0),r(C,null,I(s(p)?.channels,i=>(a(),r("g",{class:"channel",key:i}))),128)),e("line",{x1:n.progress,x2:n.progress,y1:0,y2:n.height,stroke:"black"},null,8,et),(a(!0),r(C,null,I(s(v),i=>(a(),r("g",{key:i,transform:`translate(${n.width*i[0].split("-")[0]/s(v).length})`},[e("line",{y2:n.height,stroke:"black","stroke-width":"0.1"},null,8,it),e("text",nt,l(Number(i[0].split("-")[0])+1),1)],8,st))),128))],8,K))]),e("div",ot,l(b),1),e("div",lt,[e("pre",null,l(s(y)),1),e("pre",null,l(s(u)),1),e("pre",null,[t[15]||(t[15]=O()),e("p",null," "+l(s($)),1),e("p",null,l(s(w)),1),e("p",null,l(s(p).note),1)])])]))}},pt=JSON.parse('{"title":"MIDI Rows","description":"Measurewise MIDI recorder","frontmatter":{"title":"MIDI Rows","description":"Measurewise MIDI recorder","date":"2020-02-02T00:00:00.000Z","layout":"app"},"headers":[],"relativePath":"practice/experiments/rows/index.md","filePath":"practice/experiments/rows/index.md","lastUpdated":1761369785000}'),at={name:"practice/experiments/rows/index.md"};function dt(T,_,p,w,y,d){const v=rt,x=W("client-only");return a(),r("div",null,[D(x,null,{default:Y(()=>[D(v)]),_:1})])}const vt=z(at,[["render",dt]]);export{pt as __pageData,vt as default};
