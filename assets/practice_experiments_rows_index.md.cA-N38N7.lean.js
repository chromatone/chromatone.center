import{W as T,X as N,Y as F,Z as R,$ as B,e as y,F as h,a0 as P}from"./chunks/theme.C1cSeBFq.js";import{r as g,d as k,w as S,v as a,x as d,z as e,D as r,u as s,F as b,A as $,a5 as q,_ as O,Q as M,J as V,Y as z}from"./chunks/framework.BMHKg3V0.js";const E={class:"flex flex-col"},J={class:"text-2xl"},Q={class:"flex flex-wrap"},W={key:0,class:"i-la-circle"},Y={key:1,class:"i-mdi-checkbox-blank-circle"},Z={key:0,class:"i-la-play"},A={key:1,class:"i-la-pause"},L={class:"p-1"},U={class:"p-1"},X={class:"flex flex-col"},j=["viewBox"],G=["width","height"],H=["x1","x2","y2"],K=["transform"],tt=["y2"],et={y:"3",x:"1","font-size":"2"},st={class:"flex text-xs p-4"},it={class:"grid grid-cols-3 text-xs gap-2"},nt={__name:"MidiRows",setup(C){const _=T(),{midi:m}=N(),{seq:o}=F(null,1,"row"),u=R(),n=g({width:100,height:30,progress:k(()=>n.width*o.progress),recording:!1}),v=k(()=>o.meter.over*_.PPQ*4/o.meter.under),c=k(()=>u.ticks%v.value),I=new B((l,t)=>{console.log(t),y(h(t.midi,"midi").toNote())}).set({loop:!0,loopEnd:"800i",loopStart:0,playbackRate:1,probability:1}).start(0),x=g({}),f=g([]),{track:w,midiFile:rt}=D();S(()=>m.note,l=>{if(y(h(l.midi,"midi").toNote()),!(!n.recording||!u.playing))if(l.velocity>0)x[l.number]=c.value;else{const t=x==null?void 0:x[l.number],p=c.value;let i;p>t?i=p-t:i=v.value-t+p,f.push({ticks:c.value,midi:l.number,channel:l.channel,start:t,stop:p,duration:i}),I.add({time:c.value+"i",midi:l.number,duration:i})}});function D(){const l=new P.Midi;l.name="Chromatone recording";const t=l.addTrack();return{midiFile:l,track:t}}return(l,t)=>{var p;return a(),d("div",E,[e("div",J,"MIDI ROWS "+r(c.value)+"/"+r(v.value),1),e("div",Q,[e("button",{onClick:t[0]||(t[0]=i=>n.recording=!n.recording)},[n.recording?(a(),d("div",Y)):(a(),d("div",W))]),e("button",{onClick:t[1]||(t[1]=i=>s(u).playing=!s(u).playing)},[s(u).playing?(a(),d("div",A)):(a(),d("div",Z))]),e("button",{onClick:t[2]||(t[2]=i=>s(u).stopped=Date.now())},t[8]||(t[8]=[e("div",{class:"i-la-stop"},null,-1)])),e("button",{onClick:t[3]||(t[3]=i=>s(w).notes=[])},t[9]||(t[9]=[e("div",{class:"i-la-trash-alt"},null,-1)])),e("button",{onClick:t[4]||(t[4]=i=>s(o).meter.over++)},t[10]||(t[10]=[e("div",{class:"i-la-plus"},null,-1)])),e("div",L,r(s(o).meter.over),1),e("button",{onClick:t[5]||(t[5]=i=>s(o).meter.over--)},t[11]||(t[11]=[e("div",{class:"i-la-minus"},null,-1)])),t[14]||(t[14]=e("div",{class:"p-1"},"/",-1)),e("button",{onClick:t[6]||(t[6]=i=>s(o).meter.under++)},t[12]||(t[12]=[e("div",{class:"i-la-plus"},null,-1)])),e("div",U,r(s(o).meter.under),1),e("button",{onClick:t[7]||(t[7]=i=>s(o).meter.under--)},t[13]||(t[13]=[e("div",{class:"i-la-minus"},null,-1)]))]),e("div",X,[(a(),d("svg",{viewBox:`0 0 ${n.width} ${n.height}`},[e("rect",{width:n.width,height:n.height,fill:"#999"},null,8,G),(a(!0),d(b,null,$((p=s(m))==null?void 0:p.channels,i=>(a(),d("g",{class:"channel",key:i}))),128)),e("line",{x1:n.progress,x2:n.progress,y1:0,y2:n.height,stroke:"black"},null,8,H),(a(!0),d(b,null,$(s(o).steps,i=>(a(),d("g",{key:i,transform:`translate(${n.width*i[0].split("-")[0]/s(o).steps.length})`},[e("line",{y2:n.height,stroke:"black","stroke-width":"0.1"},null,8,tt),e("text",et,r(Number(i[0].split("-")[0])+1),1)],8,K))),128))],8,j))]),e("div",st,r(f),1),e("div",it,[e("pre",null,r(s(o)),1),e("pre",null,r(s(u)),1),e("pre",null,[t[15]||(t[15]=q()),e("p",null," "+r(s(w)),1),e("p",null,r(s(m).clock),1),e("p",null,r(s(m).note),1)])])])}}},ut=JSON.parse('{"title":"MIDI Rows","description":"Measurewise MIDI recorder","frontmatter":{"title":"MIDI Rows","description":"Measurewise MIDI recorder","date":"2020-02-02T00:00:00.000Z","layout":"app"},"headers":[],"relativePath":"practice/experiments/rows/index.md","filePath":"practice/experiments/rows/index.md","lastUpdated":1725366960000}'),ot={name:"practice/experiments/rows/index.md"};function lt(C,_,m,o,u,n){const v=nt,c=z("client-only");return a(),d("div",null,[M(c,null,{default:V(()=>[M(v)]),_:1})])}const ct=O(ot,[["render",lt]]);export{ut as __pageData,ct as default};
