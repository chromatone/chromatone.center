import{U as D,u as T,ap as N,aq as F,T as R,ar as S,x as w,F as y,as as B}from"./chunks/theme.4UhWGhT9.js";import{b as x,c as k,d as P,E as a,F as c,G as e,I as r,C as s,V as b,W as $,$ as q,D as O,O as M,X as V,a4 as E}from"./chunks/framework.Rugf828X.js";const U={class:"flex flex-col"},W={class:"text-2xl"},z={class:"flex flex-wrap"},G={key:0,class:"i-la-circle"},J={key:1,class:"i-mdi-checkbox-blank-circle"},L={key:0,class:"i-la-play"},Q={key:1,class:"i-la-pause"},X=e("div",{class:"i-la-stop"},null,-1),Z=[X],j=e("div",{class:"i-la-trash-alt"},null,-1),A=[j],H=e("div",{class:"i-la-plus"},null,-1),K=[H],Y={class:"p-1"},ee=e("div",{class:"i-la-minus"},null,-1),te=[ee],se=e("div",{class:"p-1"},"/",-1),ie=e("div",{class:"i-la-plus"},null,-1),oe=[ie],ne={class:"p-1"},le=e("div",{class:"i-la-minus"},null,-1),re=[le],ae={class:"flex flex-col"},ce=["viewBox"],de=["width","height"],ue=["x1","x2","y2"],pe=["transform"],_e=["y2"],he={y:"3",x:"1","font-size":"2"},me={class:"flex text-xs p-4"},ve={class:"grid grid-cols-3 text-xs gap-2"},xe={__name:"MidiRows",setup(C){D();const{midi:_}=T(),{seq:n}=N(null,1,"row"),d=F(),o=x({width:100,height:30,progress:k(()=>o.width*n.progress),recording:!1}),h=k(()=>n.meter.over*R.PPQ*4/n.meter.under),u=k(()=>d.ticks%h.value),v=new S((l,t)=>{console.log(t),w(y(t.midi,"midi").toNote(),t.duration+"i")}).set({loop:!0,loopEnd:"800i",loopStart:0,playbackRate:1,probability:1}).start(0),m=x({}),g=x([]),{track:f,midiFile:fe}=I();P(()=>_.note,l=>{if(w(y(l.number,"midi").toNote()+"","196i"),!(!o.recording||!d.playing))if(l.velocity>0)m[l.number]=u.value;else{const t=m==null?void 0:m[l.number],p=u.value;let i;p>t?i=p-t:i=h.value-t+p,g.push({ticks:u.value,midi:l.number,channel:l.channel,start:t,stop:p,duration:i}),v.add({time:u.value+"i",midi:l.number,duration:i})}});function I(){const l=new B.Midi;l.name="Chromatone recording";const t=l.addTrack();return{midiFile:l,track:t}}return(l,t)=>{var p;return a(),c("div",U,[e("div",W,"MIDI ROWS "+r(u.value)+"/"+r(h.value),1),e("div",z,[e("button",{onClick:t[0]||(t[0]=i=>o.recording=!o.recording)},[o.recording?(a(),c("div",J)):(a(),c("div",G))]),e("button",{onClick:t[1]||(t[1]=i=>s(d).playing=!s(d).playing)},[s(d).playing?(a(),c("div",Q)):(a(),c("div",L))]),e("button",{onClick:t[2]||(t[2]=i=>s(d).stopped=Date.now())},Z),e("button",{onClick:t[3]||(t[3]=i=>s(f).notes=[])},A),e("button",{onClick:t[4]||(t[4]=i=>s(n).meter.over++)},K),e("div",Y,r(s(n).meter.over),1),e("button",{onClick:t[5]||(t[5]=i=>s(n).meter.over--)},te),se,e("button",{onClick:t[6]||(t[6]=i=>s(n).meter.under++)},oe),e("div",ne,r(s(n).meter.under),1),e("button",{onClick:t[7]||(t[7]=i=>s(n).meter.under--)},re)]),e("div",ae,[(a(),c("svg",{viewBox:`0 0 ${o.width} ${o.height}`},[e("rect",{width:o.width,height:o.height,fill:"#999"},null,8,de),(a(!0),c(b,null,$((p=s(_))==null?void 0:p.channels,i=>(a(),c("g",{class:"channel",key:i}))),128)),e("line",{x1:o.progress,x2:o.progress,y1:0,y2:o.height,stroke:"black"},null,8,ue),(a(!0),c(b,null,$(s(n).steps,i=>(a(),c("g",{key:i,transform:`translate(${o.width*i[0].split("-")[0]/s(n).steps.length})`},[e("line",{y2:o.height,stroke:"black","stroke-width":"0.1"},null,8,_e),e("text",he,r(Number(i[0].split("-")[0])+1),1)],8,pe))),128))],8,ce))]),e("div",me,r(g),1),e("div",ve,[e("pre",null,r(s(n)),1),e("pre",null,r(s(d)),1),e("pre",null,[q(),e("p",null," "+r(s(f)),1),e("p",null,r(s(_).clock),1),e("p",null,r(s(_).note),1)])])])}}},be=JSON.parse('{"title":"MIDI Rows","description":"Measurewise MIDI recorder","frontmatter":{"title":"MIDI Rows","description":"Measurewise MIDI recorder","date":"2020-02-02T00:00:00.000Z","layout":"app"},"headers":[],"relativePath":"practice/experiments/rows/index.md","filePath":"practice/experiments/rows/index.md","lastUpdated":1706343679000}'),ke={name:"practice/experiments/rows/index.md"};function ge(C,_,n,d,o,h){const u=xe,v=E("client-only");return a(),c("div",null,[M(v,null,{default:V(()=>[M(u)]),_:1})])}const $e=O(ke,[["render",ge]]);export{be as __pageData,$e as default};
