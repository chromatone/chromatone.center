import{_ as ne,r as v,J as X,E as T,G as M,q as d,f as u,s as a,k as oe,u as l,z as w,F as $,Q as P,a7 as Y,ak as le,l as ae}from"./chunks/framework.D01lOa8K.js";import{N as ie,L as O,g as y,D as G,P as j,n as B,O as q,x as N,u as x,c as A,S,a8 as se,a9 as re}from"./chunks/theme.CwHwVffe.js";const ce=["viewBox"],de=["transform"],ue=["transform"],fe=["height","width","fill"],he=["x","y"],ve=["transform","stroke"],ge=["transform"],me=["transform"],we=["width","height"],ye=["y"],xe=["transform","opacity"],ke=["transform"],Oe=["transform"],be=["height","width"],$e=["y"],Pe=["transform"],De=["height","width"],Ce=["x","y"],Te=["data-note","transform","onPointerdown","onPointerenter","onPointerleave","onPointerup","onPointercancel"],Me=["fill","height","width"],Ne={"dominant-baseline":"middle",y:25,x:10,"font-size":"24"},Se=["y","x"],Ee={class:"intervals"},_e=["transform"],pe=["x"],Ie={__name:"MidiGrid",props:{width:{type:Number,default:900},height:{type:Number,default:400},controlOffset:{type:Number,default:100},slotOffset:{type:Number,default:0}},setup(t){const{activeNotes:E}=ie(),{roundBegin:D,roundEnd:_,beginControl:W,endControl:p,keys:F}=U(),R=v(),z=v(),k=v(!1);O({onPointerdown(e){k.value=!0},onPointerleave(e){k.value=!1},onPointercancel(e){k.value=!1},onPointerup(e){k.value=!1}},{domTarget:R});const J=v(),C=v(y.tonic*100);X(C,e=>{y.tonic=Math.round((e/100%12+12)%12)}),O({onDrag(e){e.event.preventDefault(),C.value+=e.delta[0]},onWheel(e){e.event.preventDefault(),C.value-=e.velocities[0]}},{domTarget:J,eventOptions:{passive:!1}});const L=v(),b=G(T("midikeys-scale",1),1,j().length-1);O({onDrag(e){e.event.preventDefault(),b.value+=e.delta[0]/5},onWheel(e){e.event.preventDefault(),b.value-=e.velocities[0]/5}},{domTarget:L,eventOptions:{passive:!1}});const K=j(),I=M(()=>{let e=Math.round(b.value);return K[e]});X(I,e=>{y.chroma=e.chroma});const Q=T("filter-keys",!0);M(()=>Q.value?F.value.filter(e=>y.isIn(B[(e+3)%12])):F.value);function U(){const e=G(T("midi-grid-begins",2),0,6),o=G(T("midi-grid-ends",5),()=>e.value+1,7),n=q(e),s=q(o),i=v(),h=v(),g=M(()=>Array(s.value+1-n.value).fill(0).map((c,te)=>te+n.value));return O({onDrag(r){r.event.preventDefault();let c=e.value+r.delta[0]/5;c+1<=o.value&&(e.value=Math.round(c))},onWheel(r){r.event.preventDefault();let c=e.value-r.velocities[0]/5;c+1<=o.value&&(e.value=Math.round(c))}},{domTarget:i,eventOptions:{passive:!1}}),O({onDrag(r){r.event.preventDefault();let c=o.value+r.delta[0]/5;c>e.value&&(o.value=c)},onWheel(r){r.event.preventDefault();let c=o.value-r.velocities[0]/5;c-1>e.value&&(o.value=c)}},{domTarget:h,eventOptions:{passive:!1}}),{begin:e,end:o,roundBegin:n,roundEnd:s,beginControl:i,endControl:h,keys:g}}const Z=(e="101011010101",o=0,n=2,s=5)=>Array(s-n).fill(1).map((i,h)=>e.split("").map((g,r)=>21+o+r+(h+n)*12).filter((g,r)=>e.split("")[r]==1)),f=M(()=>Z(I.value.chroma,y.tonic,D.value,_.value));v(null);const m=new Map;O({onTouchstart:H,onTouchmove:ee,onTouchend:V,onTouchcancel:V},{domTarget:z,eventOptions:{passive:!1}});function H({event:e}){e.preventDefault(),Array.from(e.changedTouches).forEach(o=>{const n=document.elementFromPoint(o.clientX,o.clientY);if(!n)return;const s=n.closest(".note-cell");if(!s)return;const i=parseInt(s.dataset.note);m.set(o.identifier,i),N(i)})}function ee({event:e}){e.preventDefault(),Array.from(e.changedTouches).forEach(o=>{const n=m.get(o.identifier),s=document.elementFromPoint(o.clientX,o.clientY);if(!s){n!==void 0&&(x(n),m.delete(o.identifier));return}const i=s.closest(".note-cell");if(!i){n!==void 0&&(x(n),m.delete(o.identifier));return}const h=parseInt(i.dataset.note);h!==n&&(n!==void 0&&x(n),m.set(o.identifier,h),N(h))})}function V({event:e}){e.preventDefault(),Array.from(e.changedTouches).forEach(o=>{const n=m.get(o.identifier);n!==void 0&&(x(n),m.delete(o.identifier))})}return(e,o)=>(u(),d("svg",{class:"w-full cursor-pointer fullscreen-container overflow-hidden select-none touch-none",viewBox:`0 -${t.controlOffset+t.slotOffset} ${t.width} ${t.height+t.controlOffset}`,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},ref_key:"svg",ref:R},[a("g",{class:"slot",transform:`translate(0,${-t.slotOffset-t.controlOffset})`},[oe(e.$slots,"default",{},void 0,!0)],8,de),a("g",{class:"offset",transform:`translate(0,${-t.controlOffset})`},[a("g",{class:"tonic",ref_key:"tonicControl",ref:J},[a("rect",{height:t.controlOffset,width:t.width/4,fill:l(A)(l(y).tonic,2,.8)},null,8,fe),a("text",{class:"font-bold text-5xl",x:t.width/8,"text-anchor":"middle",y:t.controlOffset*.75},w(l(B)[l(y).tonic%12]),9,he),(u(!0),d($,null,P(l(B),(n,s)=>(u(),d("line",{transform:`translate(${(s/12+1/24)*t.width/4},0)`,y2:16,"stroke-width":"6","stroke-linecap":"round",stroke:l(A)(s,5,.4)},null,8,ve))),256)),a("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${(C.value/1200%1+1)%1*t.width/5+t.width/120},0)`,stroke:"white"},null,8,ge)],512),a("g",{class:"scale",ref_key:"scaleControl",ref:L,transform:`translate(${t.width/4},0)`},[a("rect",{width:t.width*2/4,height:t.controlOffset,fill:"#aaa"},null,8,we),a("text",{class:"text-3xl",x:10,y:t.controlOffset*.75},w(I.value.name),9,ye),(u(!0),d($,null,P(l(S).all().length,(n,s)=>(u(),d("line",{transform:`translate(${(s/l(S).all().length+1/l(S).all().length)*t.width*2/4},0)`,y2:36,opacity:n==Math.round(l(b))?1:.2,"stroke-width":"2","stroke-linecap":"round",stroke:"currentColor"},null,8,xe))),256)),a("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${l(b)/l(S).all().length*t.width*2/4},0)`,stroke:"white"},null,8,ke)],8,me),a("g",{class:"begin",ref_key:"beginControl",ref:W,transform:`translate(${t.width*6/8},0)`},[a("rect",{height:t.controlOffset,width:t.width/8,fill:"#777"},null,8,be),a("text",{class:"font-bold text-5xl pointer-events-none",x:10,y:t.controlOffset*.75},w(l(D)),9,$e)],8,Oe),a("g",{class:"end",ref_key:"endControl",ref:p,transform:`translate(${t.width*7/8},0)`},[a("rect",{height:t.controlOffset,width:t.width/8,fill:"#999"},null,8,De),a("text",{class:"font-bold text-5xl pointer-events-none",x:t.width/8-20,"text-anchor":"end",y:t.controlOffset*.75},w(l(_)),9,Ce)],8,Pe)],8,ue),a("g",{class:"grid",ref_key:"area",ref:z},[(u(!0),d($,null,P(f.value,(n,s)=>(u(),d("g",{class:"row",key:s},[(u(!0),d($,null,P(n,(i,h)=>(u(),d("g",{class:"note-cell",key:i,"data-note":i,transform:`translate(${h*t.width/f.value[0].length} ${t.height-(s+1)*(t.height/f.value.length)})`,onPointerdown:Y(g=>l(N)(i),["prevent"]),onPointerenter:g=>k.value?l(N)(i):null,onPointerleave:g=>k.value?l(x)(i):null,onPointerup:Y(g=>l(x)(i),["prevent"]),onPointercancel:g=>l(x)(i)},[a("rect",{fill:l(A)(i-9,null,1,l(E)[i]?1:.4),height:t.height/f.value.length,width:t.width/f.value[0].length},null,8,Me),a("text",Ne,w(l(se).fromMidi(i)),1),a("text",{"dominant-baseline":"middle","text-anchor":"end",opacity:".3",y:t.height/f.value.length-10,x:t.width/f.value[0].length-10},[a("tspan",null,w(i),1)],8,Se)],40,Te))),128))]))),128)),a("g",Ee,[(u(!0),d($,null,P(f.value[0],(n,s)=>(u(),d("g",{class:"interval",key:n,transform:`translate(${s*t.width/f.value[0].length+10} 20)`},[a("text",{"text-anchor":"end","font-weight":"bold",y:10,x:t.width/f.value[0].length-20},w(l(re).fromSemitones(n-f.value[0][0])),9,pe)],8,_e))),128))])],512)],8,ce))}},Ge=ne(Ie,[["__scopeId","data-v-7935f234"]]),Fe=JSON.parse('{"title":"MIDI Grid","description":"Reactive colorful notes grid as a performance instrument","frontmatter":{"title":"MIDI Grid","description":"Reactive colorful notes grid as a performance instrument","date":"2024-10-23T00:00:00.000Z","layout":"app","cover":"cover.png"},"headers":[],"relativePath":"practice/midi/grid/index.md","filePath":"practice/midi/grid/index.md","lastUpdated":1741086826000}'),Be={name:"practice/midi/grid/index.md"},Re=Object.assign(Be,{setup(t){const{width:E,height:D}=le();return(_,W)=>{const p=Ge;return u(),d("div",null,[ae(p,{width:l(E),height:l(D)},null,8,["width","height"])])}}});export{Fe as __pageData,Re as default};
