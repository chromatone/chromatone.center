import{q as X,r as v,d as F,u as P,c as D,x as c,y as d,A as l,J as Y,E as n,G as g,F as k,B as O,z as ee,S as J,an as te,P as ne}from"./chunks/framework.CQBrk0Ry.js";import{N as le,L as $,g as m,D as G,P as L,n as I,O as V,c as T,S as _,u as j,x as p,a9 as ae,aa as oe}from"./chunks/theme.Dd_Fb62b.js";const se=["viewBox"],re=["transform"],ie=["transform"],ce=["height","width","fill"],de=["x","y"],ue=["transform","stroke"],he=["transform"],fe=["transform"],ve=["width","height"],ge=["y"],me=["transform","opacity"],we=["transform"],ye=["transform"],xe=["height","width"],ke=["y"],Oe=["transform"],$e=["height","width"],be=["x","y"],Ce=["transform","onPointerdown","onPointerenter","onPointerleave","onPointerup","onPointercancel"],Pe=["fill","height","width"],De=["y"],_e={class:"text-2xl"},Me={dy:"30",x:"10"},Ne={class:"intervals"},Se=["transform"],Be={__name:"MidiGrid",props:{width:{type:Number,default:900},height:{type:Number,default:400},controlOffset:{type:Number,default:100},slotOffset:{type:Number,default:0}},setup(e){const{activeNotes:M}=le(),{roundBegin:b,roundEnd:N,beginControl:W,endControl:S,keys:E}=Z(),R=v(),q=v(),y=v(!1);$({onPointerdown(t){y.value=!0},onPointerleave(t){y.value=!1},onPointercancel(t){y.value=!1},onPointerup(t){y.value=!1}},{domTarget:R});const z=v(),C=v(m.tonic*100);F(C,t=>{m.tonic=Math.round((t/100%12+12)%12)}),$({onDrag(t){t.event.preventDefault(),C.value+=t.delta[0]},onWheel(t){t.event.preventDefault(),C.value-=t.velocities[0]}},{domTarget:z,eventOptions:{passive:!1}});const A=v(),x=G(P("midikeys-scale",1),1,L().length-1);$({onDrag(t){t.event.preventDefault(),x.value+=t.delta[0]/5},onWheel(t){t.event.preventDefault(),x.value-=t.velocities[0]/5}},{domTarget:A,eventOptions:{passive:!1}});const K=L(),B=D(()=>{let t=Math.round(x.value);return K[t]});F(B,t=>{m.chroma=t.chroma});const U=P("filter-keys",!0);D(()=>U.value?E.value.filter(t=>m.isIn(I[(t+3)%12])):E.value);function Z(){const t=G(P("midi-grid-begins",2),0,6),u=G(P("midi-grid-ends",5),()=>t.value+1,7),o=V(t),s=V(u),r=v(),w=v(),f=D(()=>Array(s.value+1-o.value).fill(0).map((i,Q)=>Q+o.value));return $({onDrag(a){a.event.preventDefault();let i=t.value+a.delta[0]/5;i+1<=u.value&&(t.value=Math.round(i))},onWheel(a){a.event.preventDefault();let i=t.value-a.velocities[0]/5;i+1<=u.value&&(t.value=Math.round(i))}},{domTarget:r,eventOptions:{passive:!1}}),$({onDrag(a){a.event.preventDefault();let i=u.value+a.delta[0]/5;i>t.value&&(u.value=i)},onWheel(a){a.event.preventDefault();let i=u.value-a.velocities[0]/5;i-1>t.value&&(u.value=i)}},{domTarget:w,eventOptions:{passive:!1}}),{begin:t,end:u,roundBegin:o,roundEnd:s,beginControl:r,endControl:w,keys:f}}const H=(t="101011010101",u=0,o=2,s=5)=>Array(s-o).fill(1).map((r,w)=>t.split("").map((f,a)=>21+u+a+(w+o)*12).filter((f,a)=>t.split("")[a]==1)),h=D(()=>H(B.value.chroma,m.tonic,b.value,N.value));return(t,u)=>(c(),d("svg",{class:"w-full cursor-pointer fullscreen-container overflow-hidden select-none touch-none",viewBox:`0 -${e.controlOffset+e.slotOffset} ${e.width} ${e.height+e.controlOffset}`,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},ref_key:"svg",ref:R},[l("g",{class:"slot",transform:`translate(0,${-e.slotOffset-e.controlOffset})`},[Y(t.$slots,"default",{},void 0,!0)],8,re),l("g",{class:"offset",transform:`translate(0,${-e.controlOffset})`},[l("g",{class:"tonic",ref_key:"tonicControl",ref:z},[l("rect",{height:e.controlOffset,width:e.width/4,fill:n(T)(n(m).tonic,2,.8)},null,8,ce),l("text",{class:"font-bold text-5xl",x:e.width/8,"text-anchor":"middle",y:e.controlOffset*.75},g(n(I)[n(m).tonic%12]),9,de),(c(!0),d(k,null,O(n(I),(o,s)=>(c(),d("line",{transform:`translate(${(s/12+1/24)*e.width/4},0)`,y2:16,"stroke-width":"6","stroke-linecap":"round",stroke:n(T)(s,5,.4)},null,8,ue))),256)),l("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${(C.value/1200%1+1)%1*e.width/5+e.width/120},0)`,stroke:"white"},null,8,he)],512),l("g",{class:"scale",ref_key:"scaleControl",ref:A,transform:`translate(${e.width/4},0)`},[l("rect",{width:e.width*2/4,height:e.controlOffset,fill:"#aaa"},null,8,ve),l("text",{class:"text-3xl",x:10,y:e.controlOffset*.75},g(B.value.name),9,ge),(c(!0),d(k,null,O(n(_).all().length,(o,s)=>(c(),d("line",{transform:`translate(${(s/n(_).all().length+1/n(_).all().length)*e.width*2/4},0)`,y2:36,opacity:o==Math.round(n(x))?1:.2,"stroke-width":"2","stroke-linecap":"round",stroke:"currentColor"},null,8,me))),256)),l("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${n(x)/n(_).all().length*e.width*2/4},0)`,stroke:"white"},null,8,we)],8,fe),l("g",{class:"begin",ref_key:"beginControl",ref:W,transform:`translate(${e.width*6/8},0)`},[l("rect",{height:e.controlOffset,width:e.width/8,fill:"#777"},null,8,xe),l("text",{class:"font-bold text-5xl pointer-events-none",x:10,y:e.controlOffset*.75},g(n(b)),9,ke)],8,ye),l("g",{class:"end",ref_key:"endControl",ref:S,transform:`translate(${e.width*7/8},0)`},[l("rect",{height:e.controlOffset,width:e.width/8,fill:"#999"},null,8,$e),l("text",{class:"font-bold text-5xl pointer-events-none",x:e.width/8-20,"text-anchor":"end",y:e.controlOffset*.75},g(n(N)),9,be)],8,Oe)],8,ie),l("g",{class:"grid",ref_key:"area",ref:q},[(c(!0),d(k,null,O(h.value,(o,s)=>(c(),d("g",{class:"row",key:s},[(c(!0),d(k,null,O(o,(r,w)=>(c(),d("g",{class:ee(["cell",{"brightness-140":n(M)[r]}]),key:r,transform:`translate(${w*e.width/h.value[0].length} ${e.height-(s+1)*(e.height/h.value.length)})`,onPointerdown:J(f=>n(j)(r),["prevent"]),onPointerenter:f=>y.value?n(j)(r):null,onPointerleave:f=>n(p)(r),onPointerup:J(f=>n(p)(r),["prevent"]),onPointercancel:f=>n(p)(r)},[l("rect",{fill:n(T)(r-9),height:e.height/h.value.length,width:e.width/h.value[0].length},null,8,Pe),l("text",{"dominant-baseline":"middle",y:e.height/h.value.length/2,x:10},[l("tspan",_e,g(n(ae).fromMidi(r)),1),l("tspan",Me,g(r),1)],8,De)],42,Ce))),128))]))),128)),l("g",Ne,[(c(!0),d(k,null,O(h.value[0],(o,s)=>(c(),d("g",{class:"interval",key:o,transform:`translate(${s*e.width/h.value[0].length+10} 20)`},[l("text",null,g(n(oe).fromSemitones(o-h.value[0][0])),1)],8,Se))),128))])],512)],8,se))}},Ge=X(Be,[["__scopeId","data-v-01acf8e4"]]),We=JSON.parse('{"title":"MIDI Grid","description":"Reactive colorful notes grid as a performance instrument","frontmatter":{"title":"MIDI Grid","description":"Reactive colorful notes grid as a performance instrument","date":"2024-10-23T00:00:00.000Z","layout":"app","cover":"cover.png"},"headers":[],"relativePath":"practice/midi/grid/index.md","filePath":"practice/midi/grid/index.md","lastUpdated":1733224246000}'),Ie={name:"practice/midi/grid/index.md"},Ee=Object.assign(Ie,{setup(e){const{width:M,height:b}=te();return(N,W)=>{const S=Ge;return c(),d("div",null,[ne(S,{width:n(M),height:n(b)},null,8,["width","height"])])}}});export{We as __pageData,Ee as default};
