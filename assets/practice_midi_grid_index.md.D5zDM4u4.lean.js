import{z as X,a as v,w as U,e as P,B as c,C as d,E as l,M as Y,u as n,J as g,F as k,G as O,D as ee,U as A,R as te}from"./chunks/framework.B_b_ZswS.js";import{R as ne,P as $,g as m,F as G,U as J,u as D,n as T,T as V,c as I,S as M,v as j,y as R,ad as le,ae,af as oe}from"./chunks/theme.D4Q3pWNf.js";const se=["viewBox"],re=["transform"],ie=["transform"],ce=["height","width","fill"],de=["x","y"],ue=["transform","stroke"],he=["transform"],fe=["transform"],ve=["width","height"],ge=["y"],me=["transform","opacity"],we=["transform"],ye=["transform"],xe=["height","width"],ke=["y"],Oe=["transform"],$e=["height","width"],be=["x","y"],Ce=["transform","onPointerdown","onPointerenter","onPointerleave","onPointerup","onPointercancel"],Pe=["fill","height","width"],De=["y"],Me={class:"text-2xl"},_e={dy:"30",x:"10"},Ne={class:"intervals"},Se=["transform"],Be={__name:"MidiGrid",props:{width:{type:Number,default:900},height:{type:Number,default:400},controlOffset:{type:Number,default:100},slotOffset:{type:Number,default:0}},setup(e){const{activeNotes:_}=ne(),{roundBegin:b,roundEnd:N,beginControl:p,endControl:S,keys:W}=q(),E=v(),K=v(),y=v(!1);$({onPointerdown(t){y.value=!0},onPointerleave(t){y.value=!1},onPointercancel(t){y.value=!1},onPointerup(t){y.value=!1}},{domTarget:E});const z=v(),C=v(m.tonic*100);U(C,t=>{m.tonic=Math.round((t/100%12+12)%12)}),$({onDrag(t){t.event.preventDefault(),C.value+=t.delta[0]},onWheel(t){t.event.preventDefault(),C.value-=t.velocities[0]}},{domTarget:z,eventOptions:{passive:!1}});const F=v(),x=G(D("midikeys-scale",1),1,J().length-1);$({onDrag(t){t.event.preventDefault(),x.value+=t.delta[0]/5},onWheel(t){t.event.preventDefault(),x.value-=t.velocities[0]/5}},{domTarget:F,eventOptions:{passive:!1}});const L=J(),B=P(()=>{let t=Math.round(x.value);return L[t]});U(B,t=>{m.chroma=t.chroma});const Z=D("filter-keys",!0);P(()=>Z.value?W.value.filter(t=>m.isIn(T[(t+3)%12])):W.value);function q(){const t=G(D("midi-grid-begins",2),0,6),u=G(D("midi-grid-ends",5),()=>t.value+1,7),o=V(t),s=V(u),r=v(),w=v(),f=P(()=>Array(s.value+1-o.value).fill(0).map((i,Q)=>Q+o.value));return $({onDrag(a){a.event.preventDefault();let i=t.value+a.delta[0]/5;i+1<=u.value&&(t.value=Math.round(i))},onWheel(a){a.event.preventDefault();let i=t.value-a.velocities[0]/5;i+1<=u.value&&(t.value=Math.round(i))}},{domTarget:r,eventOptions:{passive:!1}}),$({onDrag(a){a.event.preventDefault();let i=u.value+a.delta[0]/5;i>t.value&&(u.value=i)},onWheel(a){a.event.preventDefault();let i=u.value-a.velocities[0]/5;i-1>t.value&&(u.value=i)}},{domTarget:w,eventOptions:{passive:!1}}),{begin:t,end:u,roundBegin:o,roundEnd:s,beginControl:r,endControl:w,keys:f}}const H=(t="101011010101",u=0,o=2,s=5)=>Array(s-o).fill(1).map((r,w)=>t.split("").map((f,a)=>21+u+a+(w+o)*12).filter((f,a)=>t.split("")[a]==1)),h=P(()=>H(B.value.chroma,m.tonic,b.value,N.value));return(t,u)=>(c(),d("svg",{class:"w-full cursor-pointer fullscreen-container overflow-hidden select-none touch-none",viewBox:`0 -${e.controlOffset+e.slotOffset} ${e.width} ${e.height+e.controlOffset}`,version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",style:{"touch-action":"none"},ref_key:"svg",ref:E},[l("g",{class:"slot",transform:`translate(0,${-e.slotOffset-e.controlOffset})`},[Y(t.$slots,"default",{},void 0,!0)],8,re),l("g",{class:"offset",transform:`translate(0,${-e.controlOffset})`},[l("g",{class:"tonic",ref_key:"tonicControl",ref:z},[l("rect",{height:e.controlOffset,width:e.width/4,fill:n(I)(n(m).tonic,2,.8)},null,8,ce),l("text",{class:"font-bold text-5xl",x:e.width/8,"text-anchor":"middle",y:e.controlOffset*.75},g(n(T)[n(m).tonic%12]),9,de),(c(!0),d(k,null,O(n(T),(o,s)=>(c(),d("line",{transform:`translate(${(s/12+1/24)*e.width/4},0)`,y2:16,"stroke-width":"6","stroke-linecap":"round",stroke:n(I)(s,5,.4)},null,8,ue))),256)),l("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${(C.value/1200%1+1)%1*e.width/5+e.width/120},0)`,stroke:"white"},null,8,he)],512),l("g",{class:"scale",ref_key:"scaleControl",ref:F,transform:`translate(${e.width/4},0)`},[l("rect",{width:e.width*2/4,height:e.controlOffset,fill:"#aaa"},null,8,ve),l("text",{class:"text-3xl",x:10,y:e.controlOffset*.75},g(B.value.name),9,ge),(c(!0),d(k,null,O(n(M).all().length,(o,s)=>(c(),d("line",{transform:`translate(${(s/n(M).all().length+1/n(M).all().length)*e.width*2/4},0)`,y2:36,opacity:o==Math.round(n(x))?1:.2,"stroke-width":"2","stroke-linecap":"round",stroke:"currentColor"},null,8,me))),256)),l("line",{y2:20,"stroke-width":"8","stroke-linecap":"round",transform:`translate(${n(x)/n(M).all().length*e.width*2/4},0)`,stroke:"white"},null,8,we)],8,fe),l("g",{class:"begin",ref_key:"beginControl",ref:p,transform:`translate(${e.width*6/8},0)`},[l("rect",{height:e.controlOffset,width:e.width/8,fill:"#777"},null,8,xe),l("text",{class:"font-bold text-5xl pointer-events-none",x:10,y:e.controlOffset*.75},g(n(b)),9,ke)],8,ye),l("g",{class:"end",ref_key:"endControl",ref:S,transform:`translate(${e.width*7/8},0)`},[l("rect",{height:e.controlOffset,width:e.width/8,fill:"#999"},null,8,$e),l("text",{class:"font-bold text-5xl pointer-events-none",x:e.width/8-20,"text-anchor":"end",y:e.controlOffset*.75},g(n(N)),9,be)],8,Oe)],8,ie),l("g",{class:"grid",ref_key:"area",ref:K},[(c(!0),d(k,null,O(h.value,(o,s)=>(c(),d("g",{class:"row",key:s},[(c(!0),d(k,null,O(o,(r,w)=>(c(),d("g",{class:ee(["cell",{"brightness-140":n(_)[r]}]),key:r,transform:`translate(${w*e.width/h.value[0].length} ${e.height-(s+1)*(e.height/h.value.length)})`,onPointerdown:A(f=>n(j)(r),["prevent"]),onPointerenter:f=>y.value?n(j)(r):null,onPointerleave:f=>n(R)(r),onPointerup:A(f=>n(R)(r),["prevent"]),onPointercancel:f=>n(R)(r)},[l("rect",{fill:n(I)(r-9),height:e.height/h.value.length,width:e.width/h.value[0].length},null,8,Pe),l("text",{"dominant-baseline":"middle",y:e.height/h.value.length/2,x:10},[l("tspan",Me,g(n(le).fromMidi(r)),1),l("tspan",_e,g(r),1)],8,De)],42,Ce))),128))]))),128)),l("g",Ne,[(c(!0),d(k,null,O(h.value[0],(o,s)=>(c(),d("g",{class:"interval",key:o,transform:`translate(${s*e.width/h.value[0].length+10} 20)`},[l("text",null,g(n(ae).fromSemitones(o-h.value[0][0])),1)],8,Se))),128))])],512)],8,se))}},Ge=X(Be,[["__scopeId","data-v-01acf8e4"]]),pe=JSON.parse('{"title":"MIDI Grid","description":"Reactive colorful notes grid as a performance instrument","frontmatter":{"title":"MIDI Grid","description":"Reactive colorful notes grid as a performance instrument","date":"2024-10-23T00:00:00.000Z","layout":"app","cover":"cover.png"},"headers":[],"relativePath":"practice/midi/grid/index.md","filePath":"practice/midi/grid/index.md","lastUpdated":1735118541000}'),Te={name:"practice/midi/grid/index.md"},We=Object.assign(Te,{setup(e){const{width:_,height:b}=oe();return(N,p)=>{const S=Ge;return c(),d("div",null,[te(S,{width:n(_),height:n(b)},null,8,["width","height"])])}}});export{pe as __pageData,We as default};
