import{M as w}from"./chunks/Midi.6fTTQsck.js";import{n as b}from"./chunks/colors.hHBI9fPI.js";import{ae as x,a as I}from"./chunks/index.RYxauP_R.js";import{c as $}from"./chunks/midi.91UwWBqe.js";import{u as T}from"./chunks/audio.pG3RnClx.js";import{_ as k,k as _,j as M,w as S,o as n,c as l,a,A as C,F as g,r as v,g as R,p as j,d as B,f as y,m as D,B as P,n as N}from"./chunks/framework.KnxPB1sj.js";import{P as z}from"./chunks/synth.TVJKhjDp.js";import"./chunks/commonjsHelpers.4gQjN7DL.js";import"./chunks/index.kn6emmbE.js";import"./chunks/calculations.uITx2GSi.js";import"./chunks/theory.c9f85u7m.js";import"./chunks/index.bnjSkgpl.js";import"./chunks/index._4u9I4xi.js";import"./chunks/index.QyW-2vQe.js";import"./chunks/Scale.nioafpJK.js";import"./chunks/Subtract.6yvEFIfU.js";import"./chunks/PingPongDelay.a3-runAV.js";import"./chunks/AutoPanner.02Sltg0b.js";import"./chunks/MonoSynth.pp_JS1sF.js";import"./chunks/Filter.CUstuK5R.js";const h=d=>(j("data-v-f83e2a2a"),d=d(),B(),d),A={class:"flex flex-col items-center"},E=h(()=>a("div",{class:"text-2xl"},"MIDI Recorder",-1)),V={class:"flex flex-wrap"},F={key:0,class:"i-la-play"},L={key:1,class:"i-la-stop"},W=h(()=>a("div",{class:"i-la-trash-alt"},null,-1)),J=[W],O=h(()=>a("div",{class:"i-la-download"},null,-1)),U=[O],X=["viewBox"],Y=["x","y","width","height","fill"],Z={__name:"MidiRecorder",setup(d){new w.Midi;const e=_({title:"",author:"",header:"",duration:M(()=>e.latest-e.started),tracks:{},first:0,last:1e3,top:61,bottom:60}),o=_({width:1e3,height:500,playing:!1,recording:!1,hiddenTracks:[]});S(()=>$.note,t=>{var s,i,r;if(o.recording)if(e.tracks[t.channel]||(e.tracks[t.channel]={active:{},notes:[]}),e.first==0&&(e.first=t.timestamp),t.number>=e.top&&(e.top=t.number),t.number<=e.bottom&&(e.bottom=t.number),t.type=="noteon")e.tracks[t.channel].active[t.number]=t;else{e.last=t.timestamp;let c=(r=(i=(s=e.tracks)==null?void 0:s[t.channel].active)==null?void 0:i[t.number])==null?void 0:r.timestamp;t.duration=t.timestamp-c,delete e.tracks[t.channel].active[t.number],e.tracks[t.channel].notes.push(t)}});function u(t){let s=t-e.first,i=e.last-e.first||1;return s/i*o.width}function f(t){let s=e.top-t,i=t-e.bottom-1;return s/(i+s)*o.height}const m=[];function p(){o.playing=!o.playing;const{master:t}=T();if(o.playing){const s=x()+.5;e.filteredTracks.forEach(i=>{const r=new z(I,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).connect(t.limiter);m.push(r),i.notes.forEach(c=>{r.triggerAttackRelease(c.name,c.duration,c.time+s,c.velocity)})})}else for(;m.length;)m.shift().dispose()}return(t,s)=>(n(),l("div",A,[E,a("div",V,[a("button",{onClick:s[0]||(s[0]=i=>p())},[o.playing?(n(),l("div",L)):(n(),l("div",F))]),a("button",{onClick:s[1]||(s[1]=i=>o.recording=!o.recording)},[a("div",{class:"i-la-circle",style:C({color:o.recording?"red":""})},null,4)]),a("button",{onClick:s[2]||(s[2]=i=>t.clear())},J),a("button",{onClick:s[3]||(s[3]=(...i)=>t.download&&t.download(...i))},U)]),(n(),l("svg",{class:"h-30em w-full",version:"1.1",baseProfile:"full",viewBox:`0 0 ${o.width} ${o.height}`,xmlns:"http://www.w3.org/2000/svg"},[(n(!0),l(g,null,v(e.tracks,i=>(n(),l("g",{key:i},[(n(!0),l(g,null,v(i.notes,r=>(n(),l("rect",{key:r,rx:"0.4",x:u(r.timestamp),y:f(r.number),width:r.duration*1e3/(e.last-e.first),height:o.height/(e.top-e.bottom),fill:R(b)((r.number+3)%12)},null,8,Y))),128))]))),128))],8,X))]))}},q=k(Z,[["__scopeId","data-v-f83e2a2a"]]),kt=JSON.parse('{"title":"MIDI Recorder","description":"Record MIDI as you play – visualize and save your music","frontmatter":{"title":"MIDI Recorder","description":"Record MIDI as you play – visualize and save your music","date":"2021-08-04T00:00:00.000Z","layout":"app","sources":["https://github.com/1j01/midi-recorder/","https://github.com/Tonejs/Midi","https://github.com/Tonejs/Tone.js/wiki/TransportTime","https://webmidijs.org/docs/v3.0.0-alpha.10/index.html"],"status":"alpha","version":0.1},"headers":[],"relativePath":"practice/midi/recorder/index.md","filePath":"practice/midi/recorder/index.md","lastUpdated":1705134317000}'),G={name:"practice/midi/recorder/index.md"},H=a("h2",{id:"work-in-progress",tabindex:"-1"},[P("Work in progress "),a("a",{class:"header-anchor",href:"#work-in-progress","aria-label":'Permalink to "Work in progress"'},"​")],-1),K=a("p",null,"This app is a draft to be iterated on. The idea is to make a tool to record some kind of visual midi sketches and store them as mid files and also directly in the browser.",-1);function Q(d,e,o,u,f,m){const p=q,t=N("client-only");return n(),l("div",null,[y(t,null,{default:D(()=>[y(p)]),_:1}),H,K])}const wt=k(G,[["render",Q]]);export{kt as __pageData,wt as default};
