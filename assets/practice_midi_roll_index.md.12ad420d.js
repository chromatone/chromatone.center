import{_ as $}from"./chunks/panel.2101aa87.js";import{P,i as y,r as I,q as T,e as E,j as N,v as r,b as d,F as a,C as O,O as D,L as j,B as g,N as m,X as B,Z as F,T as w,R as Z,M as q}from"./chunks/framework.7e747cd7.js";import{_ as z}from"./chunks/start.3be170db.js";import{b,i as A}from"./chunks/index.c0ca431c.js";import{m as s,k as x}from"./chunks/midi.290fabf9.js";import{u as L}from"./chunks/index.0b97d2b2.js";import"./chunks/colors.abbc28c6.js";import"./chunks/index.654bd828.js";import"./chunks/calculations.3384a913.js";import"./chunks/index.83aed4fc.js";import"./chunks/synth.220fb0dd.js";import"./chunks/audio.170dbcbf.js";import"./chunks/Scale.7b617051.js";import"./chunks/Subtract.f0fef764.js";import"./chunks/PingPongDelay.38a34857.js";import"./chunks/AutoPanner.94a306f8.js";import"./chunks/MonoSynth.4cac63d2.js";import"./chunks/Filter.2b531c53.js";import"./chunks/theory.61e5aadb.js";import"./chunks/index.b30cd6d2.js";import"./chunks/index.86652af6.js";import"./chunks/index.b77db23e.js";import"./chunks/tempo.fceb0f15.js";import"./chunks/Loop.b192c9c2.js";import"./chunks/commonjsHelpers.de833af9.js";const H={class:"flex flex-col items-center w-full touch-none select-none"},J={class:"fullscreen-container rounded-3xl",id:"screen"},U={key:0,class:"i-la-arrow-up"},V={key:1,class:"i-la-arrow-left"},X={key:0,class:"i-la-play"},G={key:1,class:"i-la-pause"},K=a("div",{class:"i-la-stop"},null,-1),Q=[K],W={class:"absolute top-2 left-2 text-white p-2"},Y={class:"text-lg"},tt=["width","height"],et={__name:"roll",setup(k){P();const c=y({notes:I(()=>{let i=[];for(let e in s.channels)for(let n in s.channels[e].notes){let h=s.channels[e].notes[n];h.velocity>0&&i.push(h)}return i}),startTime:Date.now(),endTime:Date.now()});T(()=>s.playing,i=>{var e,n;i?c.startTime=((e=s.note)==null?void 0:e.timestamp)||Date.now():c.endTime=((n=s.note)==null?void 0:n.timestamp)||Date.now()});let p,o,l,f;const t=y({initiated:!1,width:1200,height:800,speed:I(()=>Math.round(t.rawSpeed*2)/2),rawSpeed:L(b("midi-roll-speed",1),1,3),direction:b("midi-roll-direction",1)});E(()=>{p=document.getElementById("spectrogram"),o=p.getContext("2d"),l=document.createElement("canvas"),f=l.getContext("2d"),l.width=t.width,l.height=t.height,o.fillStyle="#333",o.fillRect(0,0,t.width,t.height),v()});function v(){t.initiated||(t.initiated=!0,A(M))}function M(){t.direction==1?R():S()}function R(){f.drawImage(p,0,0,t.width,t.height),o.fillStyle="#333333",o.fillRect(0,t.height-t.speed,t.width,t.speed);for(let i=0;i<127;i++){let e=i*t.width/127;o.fillStyle=_((i+3)%12,1,.1),o.fillRect(e,t.height-t.speed,1,t.speed)}o.translate(0,-t.speed),o.drawImage(l,0,0,t.width,t.height),c.notes.forEach(i=>{const e=16-i.channel;o.fillStyle=_((i.number+3)%12,1),o.fillRect(i.number*t.width/127-e/2,t.height-t.speed,e,t.speed*2)}),o.setTransform(1,0,0,1,0,0)}function S(){f.drawImage(p,0,0,t.width,t.height),o.fillStyle="#333333",o.fillRect(t.width-t.speed,0,t.speed,t.height),c.notes.forEach(i=>{o.fillStyle=_((i.number+3)%12,1),o.fillRect(t.width-t.speed,t.height-i.number*t.height/127,t.speed,12-i.channel/2)}),o.translate(-t.speed,0),o.drawImage(l,0,0,t.width,t.height),o.setTransform(1,0,0,1,0,0)}function _(i=0,e=1,n=1){return`hsla(${i*30}, ${e*100}%, ${e*60}%, ${n})`}function C(i){let e=i.delta[0]-i.delta[1];e!=0?t.rawSpeed+=e/500:i.active&&(s.playing=!s.playing)}return(i,e)=>{const n=z,h=N("drag");return r(),d("div",H,[a("div",J,[t.initiated?g("",!0):(r(),O(n,{key:0,class:"absolute",onClick:e[0]||(e[0]=u=>v())},{default:D(()=>[j("Start")]),_:1})),a("button",{class:"p-2 absolute top-2 right-2",onClick:e[1]||(e[1]=u=>t.direction?t.direction=0:t.direction=1)},[t.direction==1?(r(),d("div",U)):g("",!0),t.direction==0?(r(),d("div",V)):g("",!0)]),a("button",{class:"absolute bottom-2 right-2 p-2",onClick:e[2]||(e[2]=u=>m(s).playing=!m(s).playing)},[m(s).playing?(r(),d("div",G)):(r(),d("div",X))]),a("button",{class:"absolute bottom-2 left-2 p-2",onClick:e[3]||(e[3]=u=>m(x)())},Q),a("div",W,[a("div",Y,"x"+B(t.speed),1)]),F(a("canvas",{class:"max-h-100vh w-full rounded-3xl cursor-pointer",id:"spectrogram",width:t.width,height:t.height,onDblclick:e[4]||(e[4]=u=>m(x)())},null,40,tt),[[h,C]])])])}}},it=Z('<ol><li>Play some notes on your MIDI controller or computer keyboard and watch them appear on the endless roll.</li><li>Drag or scroll over the canvas to change the roll speed.</li><li>Press the <i class="p-3 mr-1 i-la-arrow-up"></i> (<i class="p-3 mr-1 i-la-arrow-left"></i> ) button to change the plot direction</li><li>Press the <i class="p-3 mr-1 i-la-expand"></i> button to expand the app to full screen</li><li>Press the <i class="p-3 mr-1 i-la-play"></i>/<i class="p-3 mr-1 i-la-pause"></i> icon or anywhere on the canvas to send MIDI play/pause signal to all connected MIDI devices</li><li>Press the <i class="p-3 mr-1 i-la-stop"></i> icon or double click on the canvas to send MIDI play/pause signal to all connected MIDI devices</li><li>Use MIDI channel filter to show only the desired channels.</li></ol>',1),Ct=JSON.parse('{"title":"MIDI Roll","description":"Record all MIDI notes on an infinite roll","frontmatter":{"title":"MIDI Roll","description":"Record all MIDI notes on an infinite roll","cover":"midi-roll.png","date":"2022-06-16T00:00:00.000Z"},"headers":[],"relativePath":"practice/midi/roll/index.md","filePath":"practice/midi/roll/index.md"}'),ot={name:"practice/midi/roll/index.md"},$t=Object.assign(ot,{setup(k){return(c,p)=>{const o=$,l=q("client-only");return r(),d("div",null,[w(l,null,{default:D(()=>[w(et),w(o,{style:{"margin-top":"1em"}})]),_:1}),it])}}});export{Ct as __pageData,$t as default};
