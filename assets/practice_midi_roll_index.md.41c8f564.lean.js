import{_ as R}from"./chunks/panel.672cf12c.js";import{_ as $}from"./chunks/start.513900a4.js";import{b as y,c as P}from"./chunks/index.0e8b6fce.js";import{m as l,k as I}from"./chunks/midi.8add1e1a.js";import{u as N}from"./chunks/index.87a1f89e.js";import{l as V,C as D,j as b,B,k as E,n as A,o as r,c,a,b as z,z as x,h as j,f as g,u as m,t as O,w as U,D as F,d as w,e as H}from"./chunks/framework.233ced2b.js";import"./chunks/colors.4eba5607.js";import"./chunks/index.654bd828.js";import"./chunks/calculations.65ee336d.js";import"./chunks/index.cccf7ef0.js";import"./chunks/synth.b0a1456c.js";import"./chunks/audio.0b0a52c9.js";import"./chunks/index.fb02c716.js";import"./chunks/Scale.f9a07a23.js";import"./chunks/Subtract.e7604129.js";import"./chunks/PingPongDelay.33c16f88.js";import"./chunks/AutoPanner.30f7ef90.js";import"./chunks/MonoSynth.3cdcc469.js";import"./chunks/Filter.e19ab36f.js";import"./chunks/theory.61e5aadb.js";import"./chunks/index.b30cd6d2.js";import"./chunks/index.86652af6.js";import"./chunks/index.c9980755.js";import"./chunks/tempo.b5a67d34.js";import"./chunks/Loop.4db2aa01.js";import"./chunks/commonjsHelpers.de833af9.js";const J={class:"flex flex-col items-center w-full touch-none select-none"},Z={class:"fullscreen-container rounded-3xl",id:"screen"},q={key:0,class:"i-la-arrow-up"},G={key:1,class:"i-la-arrow-left"},K={key:0,class:"i-la-play"},L={key:1,class:"i-la-pause"},Q=a("div",{class:"i-la-stop"},null,-1),W=[Q],X={class:"absolute top-2 left-2 text-white p-2"},Y={class:"text-lg"},ee=["width","height"],te={__name:"roll",setup(S){V();const d=D({notes:b(()=>{let i=[];for(let t in l.channels)for(let s in l.channels[t].notes){let h=l.channels[t].notes[s];h.velocity>0&&i.push(h)}return i}),startTime:Date.now(),endTime:Date.now()});B(()=>l.playing,i=>{var t,s;i?d.startTime=((t=l.note)==null?void 0:t.timestamp)||Date.now():d.endTime=((s=l.note)==null?void 0:s.timestamp)||Date.now()});let p,o,n,_;const e=D({initiated:!1,width:1200,height:800,speed:b(()=>Math.round(e.rawSpeed*2)/2),rawSpeed:N(y("midi-roll-speed",1),1,3),direction:y("midi-roll-direction",1)});E(()=>{p=document.getElementById("spectrogram"),o=p.getContext("2d"),n=document.createElement("canvas"),_=n.getContext("2d"),n.width=e.width,n.height=e.height,o.fillStyle="#333",o.fillRect(0,0,e.width,e.height),v()});function v(){e.initiated||(e.initiated=!0,P(k))}function k(){e.direction==1?C():T()}function C(){_.drawImage(p,0,0,e.width,e.height),o.fillStyle="#333333",o.fillRect(0,e.height-e.speed,e.width,e.speed);for(let i=0;i<127;i++){let t=i*e.width/127;o.fillStyle=f((i+3)%12,1,.1),o.fillRect(t,e.height-e.speed,1,e.speed)}o.translate(0,-e.speed),o.drawImage(n,0,0,e.width,e.height),d.notes.forEach(i=>{const t=16-i.channel;o.fillStyle=f((i.number+3)%12,1),o.fillRect(i.number*e.width/127-t/2,e.height-e.speed,t,e.speed*2)}),o.setTransform(1,0,0,1,0,0)}function T(){_.drawImage(p,0,0,e.width,e.height),o.fillStyle="#333333",o.fillRect(e.width-e.speed,0,e.speed,e.height),d.notes.forEach(i=>{o.fillStyle=f((i.number+3)%12,1),o.fillRect(e.width-e.speed,e.height-i.number*e.height/127,e.speed,12-i.channel/2)}),o.translate(-e.speed,0),o.drawImage(n,0,0,e.width,e.height),o.setTransform(1,0,0,1,0,0)}function f(i=0,t=1,s=1){return`hsla(${i*30}, ${t*100}%, ${t*60}%, ${s})`}function M(i){let t=i.delta[0]-i.delta[1];t!=0?e.rawSpeed+=t/500:i.active&&(l.playing=!l.playing)}return(i,t)=>{const s=$,h=A("drag");return r(),c("div",J,[a("div",Z,[e.initiated?g("",!0):(r(),z(s,{key:0,class:"absolute",onClick:t[0]||(t[0]=u=>v())},{default:x(()=>[j("Start")]),_:1})),a("button",{class:"p-2 absolute top-2 right-2",onClick:t[1]||(t[1]=u=>e.direction?e.direction=0:e.direction=1)},[e.direction==1?(r(),c("div",q)):g("",!0),e.direction==0?(r(),c("div",G)):g("",!0)]),a("button",{class:"absolute bottom-2 right-2 p-2",onClick:t[2]||(t[2]=u=>m(l).playing=!m(l).playing)},[m(l).playing?(r(),c("div",L)):(r(),c("div",K))]),a("button",{class:"absolute bottom-2 left-2 p-2",onClick:t[3]||(t[3]=u=>m(I)())},W),a("div",X,[a("div",Y,"x"+O(e.speed),1)]),U(a("canvas",{class:"max-h-100vh w-full rounded-3xl cursor-pointer",id:"spectrogram",width:e.width,height:e.height,onDblclick:t[4]||(t[4]=u=>m(I)())},null,40,ee),[[h,M]])])])}}},ie=H("",1),Re=JSON.parse('{"title":"MIDI Roll","description":"Record all MIDI notes on an infinite roll","frontmatter":{"title":"MIDI Roll","description":"Record all MIDI notes on an infinite roll","cover":"midi-roll.png","date":"2022-06-16T00:00:00.000Z"},"headers":[],"relativePath":"practice/midi/roll/index.md","filePath":"practice/midi/roll/index.md","lastUpdated":1689843676000}'),oe={name:"practice/midi/roll/index.md"},$e=Object.assign(oe,{setup(S){return(d,p)=>{const o=R,n=F("client-only");return r(),c("div",null,[w(n,null,{default:x(()=>[w(te),w(o,{style:{"margin-top":"1em"}})]),_:1}),ie])}}});export{Re as __pageData,$e as default};
