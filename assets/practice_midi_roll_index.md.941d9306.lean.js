import{_ as M}from"./chunks/MidiPanel.6a301327.js";import{_ as R}from"./chunks/ControlStart.1293a848.js";import{x as P,r as I,b as x,H as N,L as D,v as V,O as B,A as E,o as r,c,a as s,g as A,w as S,e as z,l as v,u as m,t as H,B as O,_ as U,I as F,f as y,h as J}from"./chunks/framework.c1cedef0.js";import{m as l,k as b}from"./chunks/midi.1606ad4f.js";import{u as L}from"./chunks/index.15d43a61.js";import"./chunks/colors.de92a8a1.js";import"./chunks/index.654bd828.js";import"./chunks/calculations.65ee336d.js";import"./chunks/synth.22724927.js";import"./chunks/audio.cfce7ac5.js";import"./chunks/Scale.9e7ce0e4.js";import"./chunks/Subtract.5ea10851.js";import"./chunks/PingPongDelay.676d5ea9.js";import"./chunks/AutoPanner.29670d9f.js";import"./chunks/MonoSynth.f53f33a9.js";import"./chunks/Filter.40ffebb0.js";import"./chunks/theory.61e5aadb.js";import"./chunks/index.b30cd6d2.js";import"./chunks/index.86652af6.js";import"./chunks/index.44753b72.js";import"./chunks/tempo.d28d1b61.js";import"./chunks/Loop.ec9616fc.js";import"./chunks/commonjsHelpers.de833af9.js";const Z={class:"flex flex-col items-center w-full touch-none select-none"},j={class:"fullscreen-container rounded-3xl",id:"screen"},q={key:0,class:"i-la-arrow-up"},G={key:1,class:"i-la-arrow-left"},K={key:0,class:"i-la-play"},Q={key:1,class:"i-la-pause"},W=s("div",{class:"i-la-stop"},null,-1),X=[W],Y={class:"absolute top-2 left-2 text-white p-2"},ee={class:"text-lg"},te=["width","height"],ie={__name:"MidiRoll",setup(k){P();const d=I({notes:x(()=>{let i=[];for(let t in l.channels)for(let n in l.channels[t].notes){let _=l.channels[t].notes[n];_.velocity>0&&i.push(_)}return i}),startTime:Date.now(),endTime:Date.now()});N(()=>l.playing,i=>{var t,n;i?d.startTime=((t=l.note)==null?void 0:t.timestamp)||Date.now():d.endTime=((n=l.note)==null?void 0:n.timestamp)||Date.now()});let p,o,a,h;const e=I({initiated:!1,width:1200,height:800,speed:x(()=>Math.round(e.rawSpeed*2)/2),rawSpeed:L(D("midi-roll-speed",1),1,3),direction:D("midi-roll-direction",1)});V(()=>{p=document.getElementById("spectrogram"),o=p.getContext("2d"),a=document.createElement("canvas"),h=a.getContext("2d"),a.width=e.width,a.height=e.height,o.fillStyle="#333",o.fillRect(0,0,e.width,e.height),u()});function u(){e.initiated||(e.initiated=!0,B(g))}function g(){e.direction==1?C():$()}function C(){h.drawImage(p,0,0,e.width,e.height),o.fillStyle="#333333",o.fillRect(0,e.height-e.speed,e.width,e.speed);for(let i=0;i<127;i++){let t=i*e.width/127;o.fillStyle=w((i+3)%12,1,.1),o.fillRect(t,e.height-e.speed,1,e.speed)}o.translate(0,-e.speed),o.drawImage(a,0,0,e.width,e.height),d.notes.forEach(i=>{const t=16-i.channel;o.fillStyle=w((i.number+3)%12,1),o.fillRect(i.number*e.width/127-t/2,e.height-e.speed,t,e.speed*2)}),o.setTransform(1,0,0,1,0,0)}function $(){h.drawImage(p,0,0,e.width,e.height),o.fillStyle="#333333",o.fillRect(e.width-e.speed,0,e.speed,e.height),d.notes.forEach(i=>{o.fillStyle=w((i.number+3)%12,1),o.fillRect(e.width-e.speed,e.height-i.number*e.height/127,e.speed,12-i.channel/2)}),o.translate(-e.speed,0),o.drawImage(a,0,0,e.width,e.height),o.setTransform(1,0,0,1,0,0)}function w(i=0,t=1,n=1){return`hsla(${i*30}, ${t*100}%, ${t*60}%, ${n})`}function T(i){let t=i.delta[0]-i.delta[1];t!=0?e.rawSpeed+=t/500:i.active&&(l.playing=!l.playing)}return(i,t)=>{const n=R,_=E("drag");return r(),c("div",Z,[s("div",j,[e.initiated?v("",!0):(r(),A(n,{key:0,class:"absolute",onClick:t[0]||(t[0]=f=>u())},{default:S(()=>[z("Start")]),_:1})),s("button",{class:"p-2 absolute top-2 right-2",onClick:t[1]||(t[1]=f=>e.direction?e.direction=0:e.direction=1)},[e.direction==1?(r(),c("div",q)):v("",!0),e.direction==0?(r(),c("div",G)):v("",!0)]),s("button",{class:"absolute bottom-2 right-2 p-2",onClick:t[2]||(t[2]=f=>m(l).playing=!m(l).playing)},[m(l).playing?(r(),c("div",Q)):(r(),c("div",K))]),s("button",{class:"absolute bottom-2 left-2 p-2",onClick:t[3]||(t[3]=f=>m(b)())},X),s("div",Y,[s("div",ee,"x"+H(e.speed),1)]),O(s("canvas",{class:"max-h-100vh w-full rounded-3xl cursor-pointer",id:"spectrogram",width:e.width,height:e.height,onDblclick:t[4]||(t[4]=f=>m(b)())},null,40,te),[[_,T]])])])}}},Te=JSON.parse('{"title":"MIDI Roll","description":"Record all MIDI notes on an infinite roll","frontmatter":{"title":"MIDI Roll","description":"Record all MIDI notes on an infinite roll","cover":"midi-roll.png","date":"2022-06-16T00:00:00.000Z"},"headers":[],"relativePath":"practice/midi/roll/index.md","filePath":"practice/midi/roll/index.md","lastUpdated":1694022443000}'),oe={name:"practice/midi/roll/index.md"},le=J("",1);function ne(k,d,p,o,a,h){const e=ie,u=M,g=F("client-only");return r(),c("div",null,[y(g,null,{default:S(()=>[y(e),y(u,{style:{"margin-top":"1em"}})]),_:1}),le])}const Me=U(oe,[["render",ne]]);export{Te as __pageData,Me as default};
