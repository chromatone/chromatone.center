import{_ as T}from"./chunks/ControlStart.d8eyaEXz.js";import{i as R,k as v,j as y,w as P,v as I,E as N,M as V,x as E,o as r,c,a as s,e as B,n as b,B as A,b as w,g as h,t as z,y as U,_ as j,m as F,f as x,h as H}from"./chunks/framework.zmD4b-eB.js";import{c as o,k as D}from"./chunks/midi.RNICv3HM.js";import{u as J}from"./chunks/index.qXrjdxB9.js";import"./chunks/commonjsHelpers.4gQjN7DL.js";const O={class:"flex flex-col items-center w-full touch-none select-none"},Z={class:"fullscreen-container rounded-3xl",id:"screen"},q={key:0,class:"i-la-arrow-up"},G={key:1,class:"i-la-arrow-left"},K={key:0,class:"i-la-play"},L={key:1,class:"i-la-pause"},Q=s("div",{class:"i-la-stop"},null,-1),W=[Q],X={class:"absolute top-2 left-2 text-white p-2"},Y={class:"text-lg"},ee=["width","height"],te={__name:"MidiRoll",setup(S){R();const d=v({notes:y(()=>{let i=[];for(let t in o.channels)for(let n in o.channels[t].notes){let f=o.channels[t].notes[n];f.velocity>0&&i.push(f)}return i}),startTime:Date.now(),endTime:Date.now()});P(()=>o.playing,i=>{var t,n;i?d.startTime=((t=o.note)==null?void 0:t.timestamp)||Date.now():d.endTime=((n=o.note)==null?void 0:n.timestamp)||Date.now()});let p,l,a,m;const e=v({initiated:!1,width:1200,height:800,speed:y(()=>Math.round(e.rawSpeed*2)/2),rawSpeed:J(I("midi-roll-speed",1),1,3),direction:I("midi-roll-direction",1)});N(()=>{p=document.getElementById("spectrogram"),l=p.getContext("2d"),a=document.createElement("canvas"),m=a.getContext("2d"),a.width=e.width,a.height=e.height,l.fillStyle="#333",l.fillRect(0,0,e.width,e.height),u()});function u(){e.initiated||(e.initiated=!0,V(k))}function k(){e.direction==1?C():$()}function C(){m.drawImage(p,0,0,e.width,e.height),l.fillStyle="#333333",l.fillRect(0,e.height-e.speed,e.width,e.speed);for(let i=0;i<127;i++){let t=i*e.width/127;l.fillStyle=g((i+3)%12,1,.1),l.fillRect(t,e.height-e.speed,1,e.speed)}l.translate(0,-e.speed),l.drawImage(a,0,0,e.width,e.height),d.notes.forEach(i=>{const t=16-i.channel;l.fillStyle=g((i.number+3)%12,1),l.fillRect(i.number*e.width/127-t/2,e.height-e.speed,t,e.speed*2)}),l.setTransform(1,0,0,1,0,0)}function $(){m.drawImage(p,0,0,e.width,e.height),l.fillStyle="#333333",l.fillRect(e.width-e.speed,0,e.speed,e.height),d.notes.forEach(i=>{l.fillStyle=g((i.number+3)%12,1),l.fillRect(e.width-e.speed,e.height-i.number*e.height/127,e.speed,12-i.channel/2)}),l.translate(-e.speed,0),l.drawImage(a,0,0,e.width,e.height),l.setTransform(1,0,0,1,0,0)}function g(i=0,t=1,n=1){return`hsla(${i*30}, ${t*100}%, ${t*60}%, ${n})`}function M(i){let t=i.delta[0]-i.delta[1];t!=0?e.rawSpeed+=t/500:i.active&&(o.playing=!o.playing)}return(i,t)=>{const n=T,f=E("drag");return r(),c("div",O,[s("div",Z,[e.initiated?w("",!0):(r(),B(n,{key:0,class:"absolute",onClick:t[0]||(t[0]=_=>u())},{default:b(()=>[A("Start")]),_:1})),s("button",{class:"p-2 absolute top-2 right-2",onClick:t[1]||(t[1]=_=>e.direction?e.direction=0:e.direction=1)},[e.direction==1?(r(),c("div",q)):w("",!0),e.direction==0?(r(),c("div",G)):w("",!0)]),s("button",{class:"absolute bottom-2 right-2 p-2",onClick:t[2]||(t[2]=_=>h(o).playing=!h(o).playing)},[h(o).playing?(r(),c("div",L)):(r(),c("div",K))]),s("button",{class:"absolute bottom-2 left-2 p-2",onClick:t[3]||(t[3]=_=>h(D)())},W),s("div",X,[s("div",Y,"x"+z(e.speed),1)]),U(s("canvas",{class:"max-h-100vh w-full rounded-3xl cursor-pointer",id:"spectrogram",width:e.width,height:e.height,onDblclick:t[4]||(t[4]=_=>h(D)())},null,40,ee),[[f,M]])])])}}},de=JSON.parse('{"title":"MIDI Roll","description":"Record all MIDI notes on an infinite roll","frontmatter":{"title":"MIDI Roll","description":"Record all MIDI notes on an infinite roll","layout":"app","cover":"midi-roll.png","date":"2022-06-16T00:00:00.000Z"},"headers":[],"relativePath":"practice/midi/roll/index.md","filePath":"practice/midi/roll/index.md","lastUpdated":1702976349000}'),ie={name:"practice/midi/roll/index.md"},le=H('<ol><li>Play some notes on your MIDI controller or computer keyboard and watch them appear on the endless roll.</li><li>Drag or scroll over the canvas to change the roll speed.</li><li>Press the <i class="p-3 mr-1 i-la-arrow-up"></i> (<i class="p-3 mr-1 i-la-arrow-left"></i> ) button to change the plot direction</li><li>Press the <i class="p-3 mr-1 i-la-expand"></i> button to expand the app to full screen</li><li>Press the <i class="p-3 mr-1 i-la-play"></i>/<i class="p-3 mr-1 i-la-pause"></i> icon or anywhere on the canvas to send MIDI play/pause signal to all connected MIDI devices</li><li>Press the <i class="p-3 mr-1 i-la-stop"></i> icon or double click on the canvas to send MIDI play/pause signal to all connected MIDI devices</li><li>Use MIDI channel filter to show only the desired channels.</li></ol>',1);function oe(S,d,p,l,a,m){const e=te,u=F("client-only");return r(),c("div",null,[x(u,null,{default:b(()=>[x(e)]),_:1}),le])}const pe=j(ie,[["render",oe]]);export{de as __pageData,pe as default};
