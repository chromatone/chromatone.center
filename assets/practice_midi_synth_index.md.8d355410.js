import{c as a,e as n,u as l,b as e,o,$ as t,P as p}from"./chunks/framework.eba39b59.js";const r=e(`<h2 id="modular-synth" tabindex="-1">Modular synth <a class="header-anchor" href="#modular-synth" aria-label="Permalink to &quot;Modular synth&quot;">​</a></h2><p>Built with JS, but operated by WASM lib in a separate audio thread. Construction started around June 2023 and is ongoing till then. Supposed to be gradually substituting the sitewide Tone.js synth used by now.</p><h2 id="links" tabindex="-1">Links <a class="header-anchor" href="#links" aria-label="Permalink to &quot;Links&quot;">​</a></h2><ul><li><a href="https://www.elementary.audio/docs/guides/Understanding_Keys" target="_blank" rel="noreferrer">https://www.elementary.audio/docs/guides/Understanding_Keys</a></li><li><a href="https://www.elementary.audio/docs/reference/Math" target="_blank" rel="noreferrer">https://www.elementary.audio/docs/reference/Math</a></li><li><a href="https://github.com/elemaudio/web-examples" target="_blank" rel="noreferrer">https://github.com/elemaudio/web-examples</a></li><li><a href="https://github.com/bgins/coincident-spectra/blob/main/src/lib/audio/audio.ts" target="_blank" rel="noreferrer">https://github.com/bgins/coincident-spectra/blob/main/src/lib/audio/audio.ts</a></li><li><a href="https://github.com/teetow/elementary_grid" target="_blank" rel="noreferrer">https://github.com/teetow/elementary_grid</a></li><li><a href="https://www.nickwritesablog.com/drum-synthesis-in-javascript/" target="_blank" rel="noreferrer">https://www.nickwritesablog.com/drum-synthesis-in-javascript/</a></li><li><a href="https://github.com/elemaudio/web-examples/blob/master/planets/app.js" target="_blank" rel="noreferrer">https://github.com/elemaudio/web-examples/blob/master/planets/app.js</a></li><li><a href="https://github.com/teetow/elementary_grid/blob/master/src/lib/useSynth.tsx" target="_blank" rel="noreferrer">https://github.com/teetow/elementary_grid/blob/master/src/lib/useSynth.tsx</a></li></ul><h2 id="resources" tabindex="-1">Resources <a class="header-anchor" href="#resources" aria-label="Permalink to &quot;Resources&quot;">​</a></h2><ul><li><a href="https://signalsmith-audio.co.uk/writing/2021/lets-write-a-reverb/" target="_blank" rel="noreferrer">https://signalsmith-audio.co.uk/writing/2021/lets-write-a-reverb/</a></li><li><a href="https://ccrma.stanford.edu/~jos/" target="_blank" rel="noreferrer">https://ccrma.stanford.edu/~jos/</a></li><li><a href="https://jackschaedler.github.io/circles-sines-signals/" target="_blank" rel="noreferrer">https://jackschaedler.github.io/circles-sines-signals/</a></li><li><a href="https://www.soundonsound.com/synthesizers/synth-secrets" target="_blank" rel="noreferrer">https://www.soundonsound.com/synthesizers/synth-secrets</a></li><li><a href="https://www.theaudioprogrammer.com/" target="_blank" rel="noreferrer">https://www.theaudioprogrammer.com/</a></li><li><a href="https://www.dsprelated.com/" target="_blank" rel="noreferrer">https://www.dsprelated.com/</a></li><li><a href="https://www.earlevel.com/main/" target="_blank" rel="noreferrer">https://www.earlevel.com/main/</a></li><li><a href="http://www.willpirkle.com/" target="_blank" rel="noreferrer">http://www.willpirkle.com/</a></li><li><a href="https://www.hackaudio.com/" target="_blank" rel="noreferrer">https://www.hackaudio.com/</a></li><li><a href="https://maxgraf.space/code/2020/04/22/e2e-piano-epiano.html" target="_blank" rel="noreferrer">https://maxgraf.space/code/2020/04/22/e2e-piano-epiano.html</a></li><li><a href="https://maxgraf.space/code/2020/06/05/pitch-aware-granular-synth.html" target="_blank" rel="noreferrer">https://maxgraf.space/code/2020/06/05/pitch-aware-granular-synth.html</a></li><li><a href="https://maxgraf.space/code/2020/06/05/karplus-strong-synth.html" target="_blank" rel="noreferrer">https://maxgraf.space/code/2020/06/05/karplus-strong-synth.html</a></li><li><a href="https://ccrma.stanford.edu/~jos/pasp/Feedback_Comb_Filters.html" target="_blank" rel="noreferrer">https://ccrma.stanford.edu/~jos/pasp/Feedback_Comb_Filters.html</a></li></ul><h2 id="snippets" tabindex="-1">Snippets <a class="header-anchor" href="#snippets" aria-label="Permalink to &quot;Snippets&quot;">​</a></h2><h3 id="mic-input" tabindex="-1">Mic input <a class="header-anchor" href="#mic-input" aria-label="Permalink to &quot;Mic input&quot;">​</a></h3><p>When you use el.in() you have to be specific about which channel you want to tap, i.e. el.in({channel: 0}), but then you need to make sure that your WebAudioNode running elementary&#39;s engine actually has input signals. So you would need to call core.initialize to declare that input channels are expected, and then you would need to actually connect your web audio input nodes to the node returned by core.initialize. Does that make sense?</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> node </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> core</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">initialize</span><span style="color:#A6ACCD;">(audioContext</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">numberOfInputs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">numberOfOutputs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">inputChannelCount</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// Notice, it&#39;s a mono input</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">outputChannelCount</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (navigator</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">mediaDevices </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> navigator</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">mediaDevices</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getUserMedia) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">micStream</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">navigator</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">mediaDevices</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getUserMedia</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">audio</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">streamSource</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">audioContext</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createMediaStreamSource</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">micStream</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">streamSource</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">connect</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="skew-by-upheaver" tabindex="-1">Skew by <a href="https://discord.com/channels/826071713426178078/834787928688689172/1123676571279048875" target="_blank" rel="noreferrer">upheaver</a> <a class="header-anchor" href="#skew-by-upheaver" aria-label="Permalink to &quot;Skew by [upheaver](https://discord.com/channels/826071713426178078/834787928688689172/1123676571279048875)&quot;">​</a></h3><p>Sharing a useful snippet. JUCE&#39;s logskew function in Typescript, if anyone wants to scale their parameter values (for example convert 0-1 range to 20-20000 hz in a non linear way) :</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> clamp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">min</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">max</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">num</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">min</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">max</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">num</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">min</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">max</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> skew </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">min</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">max</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">centerPoint</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0.5</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">((</span><span style="color:#A6ACCD;">centerPoint</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">min</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">max</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">min</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> logskew </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">centerPoint</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proportion</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">clamp</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">time</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sk</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">skew</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">centerPoint</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">v</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exp</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">proportion</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sk</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">v</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">logskew</span><span style="color:#A6ACCD;">( </span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20000</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.5</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;">)) </span><span style="color:#676E95;font-style:italic;">// will output 1000</span></span></code></pre></div><h2 id="metronome" tabindex="-1">Metronome <a class="header-anchor" href="#metronome" aria-label="Permalink to &quot;Metronome&quot;">​</a></h2><p><a href="https://discord.com/channels/826071713426178078/834787928688689172/1127958693695205387" target="_blank" rel="noreferrer">Yea long story short</a> I think metro was maybe not a great idea and it&#39;s worth considering to deprecate it. More effective in my opinion is to take el.time() which monotonically increases, counting the number of elapsed samples, and derive a quarter-note phasor from el.time(). (From bpm you calculate seconds per beat, from which you calculate samples per beat, which you can use to convert el.time() into a phasor running at exactly quarter-note rate). Then of course if you want to change bpm you just change the numbers in your calculation but it will all be perfectly time-synced because it&#39;s derived from the actual time signal. And then you can turn your quarter-note phasor into a pulse train with el.le(phasor, 0.5)</p>`,15),C=JSON.parse('{"title":"Elementary synth","description":"MIDI enabled synthesizer built with Elementary audio library","frontmatter":{"title":"Elementary synth","description":"MIDI enabled synthesizer built with Elementary audio library","date":"2023-06-23T00:00:00.000Z","cover":"lockup.svg"},"headers":[],"relativePath":"practice/midi/synth/index.md","filePath":"practice/midi/synth/index.md"}'),c={name:"practice/midi/synth/index.md"},A=Object.assign(c,{setup(y){const s=t(()=>p(()=>import("./chunks/ElemAudio.915b4184.js"),["assets/chunks/ElemAudio.915b4184.js","assets/chunks/rotary.ea9e10ea.js","assets/chunks/midi.68daa94b.js","assets/chunks/index.c81389a1.js","assets/chunks/framework.eba39b59.js","assets/chunks/index.8bc6f05c.js","assets/chunks/commonjsHelpers.de833af9.js","assets/chunks/index.b30cd6d2.js","assets/chunks/tuner.757320a0.js","assets/chunks/colors.c545afb8.js","assets/chunks/index.e34dd531.js","assets/chunks/calculations.3384a913.js","assets/chunks/index.83aed4fc.js","assets/chunks/synth.052d6c0a.js","assets/chunks/audio.67e1b582.js","assets/chunks/Scale.7b617051.js","assets/chunks/Subtract.f0fef764.js","assets/chunks/PingPongDelay.a045a173.js","assets/chunks/AutoPanner.62e583a4.js","assets/chunks/MonoSynth.4cac63d2.js","assets/chunks/Filter.2b531c53.js","assets/chunks/theory.61e5aadb.js","assets/chunks/index.86652af6.js","assets/chunks/loop.7639678b.js","assets/chunks/tempo.b659399a.js","assets/chunks/Loop.b192c9c2.js","assets/chunks/midiRender.ec262f64.js","assets/chunks/Midi.1f918097.js","assets/chunks/Sequence.a9c1c185.js","assets/chunks/mic.b7a34294.js","assets/chunks/UserMedia.4741de0f.js","assets/chunks/OnePoleFilter.2d0525f8.js","assets/chunks/noise.6ba2eb52.js","assets/chunks/FFT.23f2abfd.js","assets/chunks/BitCrusher.75089fd0.js","assets/chunks/sequence.a2a8e1a6.js"]));return(i,F)=>(o(),a("div",null,[n(l(s)),r]))}});export{C as __pageData,A as default};
