import{_ as T}from"./chunks/SaveSvg.IiHHgxnx.js";import{M as z}from"./chunks/Midi.6fTTQsck.js";import{n as D}from"./chunks/colors.DQ3Nq55L.js";import{ae as M,a as S}from"./chunks/index.RYxauP_R.js";import{c as b}from"./chunks/midiRender.uVc9GHxZ.js";import{_ as $,k as I,j as f,o as s,c as n,a,F as h,r as v,z as B,t as y,g as F,f as k,p as A,d as P,m as N,n as R}from"./chunks/framework.1uYGFCry.js";import{P as E}from"./chunks/synth.CftW3DNb.js";import"./chunks/commonjsHelpers.4gQjN7DL.js";import"./chunks/index.kn6emmbE.js";import"./chunks/calculations.uITx2GSi.js";import"./chunks/midi.JUoUGMo3.js";import"./chunks/index.Br-81dzg.js";import"./chunks/theory.dOWEiwk1.js";import"./chunks/index.PseKhLT9.js";import"./chunks/index.dVM4alBU.js";import"./chunks/tempo.tDAToNwG.js";import"./chunks/audio.MFPk3EpQ.js";import"./chunks/Loop.bmxnTff3.js";import"./chunks/Scale.nioafpJK.js";import"./chunks/Subtract.6yvEFIfU.js";import"./chunks/PingPongDelay.cuD3qQq0.js";import"./chunks/AutoPanner.gYtD10Of.js";import"./chunks/MonoSynth.pp_JS1sF.js";import"./chunks/Filter.CUstuK5R.js";const g=d=>(A("data-v-d9e04fd1"),d=d(),P(),d),V={class:"flex flex-col items-center"},J={class:"flex flex-wrap"},O=g(()=>a("label",{for:"upload"},[a("div",{class:"i-la-upload"})],-1)),j={key:0,class:"i-la-play"},L={key:1,class:"i-la-stop"},U=g(()=>a("div",{class:"i-la-trash-alt"},null,-1)),Z=[U],q=g(()=>a("div",{class:"i-la-download"},null,-1)),G=[q],H={class:"flex flex-wrap"},K=["onClick"],Q=["viewBox"],W=["x","y","width","fill"],X={__name:"MidiVisualizer",setup(d){let p;const t=I({title:"",author:"",header:"",duration:0,tracks:[],filteredTracks:f(()=>t.tracks.filter((o,r)=>!i.hiddenTracks[r]))}),i=I({width:f(()=>t.duration),height:f(()=>i.upper-i.lower),upper:127,lower:0,playing:!1,hiddenTracks:[]});function w(o){let r=o.target.files[0],c=new FileReader;c.onload=e=>{p=new z.Midi(e.target.result),x(p)},c.readAsArrayBuffer(r)}async function x(o){t.title=o.tracks[0].name,t.header=o.header,t.duration=o.duration,t.ticks=o.durationTicks,t.tracks=o.toJSON().tracks}function u(){t.title="",t.header="",t.duration=0,t.tracks=[],t.ticks=0}function m(){b(p.toArray(),"chromatone")}const _=[];function C(){if(i.playing=!i.playing,i.playing){const o=M()+.5;t.filteredTracks.forEach(r=>{const c=new E(S,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();_.push(c),r.notes.forEach(e=>{c.triggerAttackRelease(e.name,e.duration,e.time+o,e.velocity)})})}else for(;_.length;)_.shift().dispose()}return(o,r)=>{const c=T;return s(),n("div",V,[a("div",J,[a("button",null,[O,a("input",{class:"p-2 w-18em cursor-pointer",id:"upload",type:"file",accept:"audio/midi",onChange:w},null,32)]),a("button",{onClick:r[0]||(r[0]=e=>C())},[i.playing?(s(),n("div",L)):(s(),n("div",j))]),a("button",{onClick:r[1]||(r[1]=e=>u())},Z),a("button",{onClick:m},G)]),a("div",H,[(s(!0),n(h,null,v(t.tracks,(e,l)=>(s(),n("div",{class:"p-1",key:e},[a("div",{class:B(["track",{active:!i.hiddenTracks[l]}]),onClick:it=>i.hiddenTracks[l]=!i.hiddenTracks[l]},y(e.channel)+": "+y(e.name)+" "+y(e.instrument.family),11,K)]))),128))]),(s(),n("svg",{class:"max-h-70vh",id:"visual",version:"1.1",baseProfile:"full",viewBox:`0 0 ${i.width} ${i.height}`,xmlns:"http://www.w3.org/2000/svg"},[(s(!0),n(h,null,v(t.filteredTracks,e=>(s(),n("g",{key:e},[(s(!0),n(h,null,v(e.notes,l=>(s(),n("rect",{key:l,rx:"0.4",x:l.time,y:127-l.midi,width:l.duration,height:"1",fill:F(D)((l.midi+3)%12)},null,8,W))),128))]))),128))],8,Q)),k(c,{svg:"visual"})])}}},Y=$(X,[["__scopeId","data-v-d9e04fd1"]]),zt=JSON.parse('{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","frontmatter":{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","date":"2021-05-20T00:00:00.000Z","layout":"app","cover":"midi-visual.svg"},"headers":[],"relativePath":"practice/midi/visualizer/index.md","filePath":"practice/midi/visualizer/index.md","lastUpdated":1702998731000}'),tt={name:"practice/midi/visualizer/index.md"};function et(d,p,t,i,w,x){const u=Y,m=N("client-only");return s(),n("div",null,[k(m,null,{default:R(()=>[k(u)]),_:1})])}const Dt=$(tt,[["render",et]]);export{zt as __pageData,Dt as default};
