import{_ as I,i as k,r as _,v as a,b as n,F as o,a as m,H as f,z,X as h,N as M,T as v,A as D,c as A,O as C,M as F}from"./chunks/framework.7e747cd7.js";import{_ as S}from"./chunks/svg.af3016f3.js";import{M as $}from"./chunks/Midi.1f918097.js";import{n as O}from"./chunks/colors.abbc28c6.js";import{af as P,S as B}from"./chunks/index.83aed4fc.js";import{c as N}from"./chunks/midiRender.6c0c3f09.js";import{P as R}from"./chunks/synth.220fb0dd.js";import"./chunks/commonjsHelpers.de833af9.js";import"./chunks/index.c0ca431c.js";import"./chunks/index.654bd828.js";import"./chunks/calculations.3384a913.js";import"./chunks/midi.290fabf9.js";import"./chunks/index.0b97d2b2.js";import"./chunks/index.b30cd6d2.js";import"./chunks/theory.61e5aadb.js";import"./chunks/index.86652af6.js";import"./chunks/index.b77db23e.js";import"./chunks/tempo.fceb0f15.js";import"./chunks/audio.170dbcbf.js";import"./chunks/Loop.b192c9c2.js";import"./chunks/Scale.7b617051.js";import"./chunks/Subtract.f0fef764.js";import"./chunks/PingPongDelay.38a34857.js";import"./chunks/AutoPanner.94a306f8.js";import"./chunks/MonoSynth.4cac63d2.js";import"./chunks/Filter.2b531c53.js";const y=d=>(D("data-v-5be87f46"),d=d(),A(),d),E={class:"flex flex-col items-center"},H={class:"flex flex-wrap"},J=y(()=>o("label",{for:"upload"},[o("div",{class:"i-la-upload"})],-1)),j={key:0,class:"i-la-play"},V={key:1,class:"i-la-stop"},X=y(()=>o("div",{class:"i-la-trash-alt"},null,-1)),Z=[X],q=y(()=>o("div",{class:"i-la-download"},null,-1)),G=[q],K={class:"flex flex-wrap"},L=["onClick"],Q=["viewBox"],U=["x","y","width","fill"],W={__name:"visualizer",setup(d){let p;const t=k({title:"",author:"",header:"",duration:0,tracks:[],filteredTracks:_(()=>t.tracks.filter((s,r)=>!e.hiddenTracks[r]))}),e=k({width:_(()=>t.duration),height:_(()=>e.upper-e.lower),upper:127,lower:0,playing:!1,hiddenTracks:[]});function w(s){let r=s.target.files[0],c=new FileReader;c.onload=i=>{p=new $.Midi(i.target.result),g(p)},c.readAsArrayBuffer(r)}async function g(s){t.title=s.tracks[0].name,t.header=s.header,t.duration=s.duration,t.ticks=s.durationTicks,t.tracks=s.toJSON().tracks}function x(){t.title="",t.header="",t.duration=0,t.tracks=[],t.ticks=0}function b(){N(p.toArray(),"chromatone")}const u=[];function T(){if(e.playing=!e.playing,e.playing){const s=P()+.5;t.filteredTracks.forEach(r=>{const c=new R(B,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();u.push(c),r.notes.forEach(i=>{c.triggerAttackRelease(i.name,i.duration,i.time+s,i.velocity)})})}else for(;u.length;)u.shift().dispose()}return(s,r)=>{const c=S;return a(),n("div",E,[o("div",H,[o("button",null,[J,o("input",{class:"p-2 w-18em cursor-pointer",id:"upload",type:"file",accept:"audio/midi",onChange:w},null,32)]),o("button",{onClick:r[0]||(r[0]=i=>T())},[e.playing?(a(),n("div",V)):(a(),n("div",j))]),o("button",{onClick:r[1]||(r[1]=i=>x())},Z),o("button",{onClick:b},G)]),o("div",K,[(a(!0),n(m,null,f(t.tracks,(i,l)=>(a(),n("div",{class:"p-1",key:i},[o("div",{class:z(["track",{active:!e.hiddenTracks[l]}]),onClick:it=>e.hiddenTracks[l]=!e.hiddenTracks[l]},h(i.channel)+": "+h(i.name)+" "+h(i.instrument.family),11,L)]))),128))]),(a(),n("svg",{class:"max-h-70vh",id:"visual",version:"1.1",baseProfile:"full",viewBox:`0 0 ${e.width} ${e.height}`,xmlns:"http://www.w3.org/2000/svg"},[(a(!0),n(m,null,f(t.filteredTracks,i=>(a(),n("g",{key:i},[(a(!0),n(m,null,f(i.notes,l=>(a(),n("rect",{key:l,rx:"0.4",x:l.time,y:127-l.midi,width:l.duration,height:"1",fill:M(O)((l.midi+3)%12)},null,8,U))),128))]))),128))],8,Q)),v(c,{svg:"visual"})])}}},Y=I(W,[["__scopeId","data-v-5be87f46"]]),Dt=JSON.parse('{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","frontmatter":{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","date":"2021-05-20T00:00:00.000Z","cover":"midi-visual.svg"},"headers":[],"relativePath":"practice/midi/visualizer/index.md","filePath":"practice/midi/visualizer/index.md"}'),tt={name:"practice/midi/visualizer/index.md"},At=Object.assign(tt,{setup(d){return(p,t)=>{const e=F("client-only");return a(),n("div",null,[v(e,null,{default:C(()=>[v(Y)]),_:1})])}}});export{Dt as __pageData,At as default};
