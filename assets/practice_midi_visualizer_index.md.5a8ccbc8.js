import{_ as C}from"./chunks/svg.b514f607.js";import{M as z}from"./chunks/Midi.1f918097.js";import{n as D}from"./chunks/colors.4eba5607.js";import{af as T,S}from"./chunks/index.cccf7ef0.js";import{c as B}from"./chunks/midiRender.8f6dc326.js";import{_ as M,C as k,j as m,o as a,c as r,a as s,F as _,r as f,q as F,t as h,u as $,d as v,p as A,i as P,D as N,z as R}from"./chunks/framework.233ced2b.js";import{P as E}from"./chunks/synth.b0a1456c.js";import"./chunks/commonjsHelpers.de833af9.js";import"./chunks/index.0e8b6fce.js";import"./chunks/index.fb02c716.js";import"./chunks/index.654bd828.js";import"./chunks/calculations.65ee336d.js";import"./chunks/midi.8add1e1a.js";import"./chunks/index.87a1f89e.js";import"./chunks/index.b30cd6d2.js";import"./chunks/theory.61e5aadb.js";import"./chunks/index.86652af6.js";import"./chunks/index.c9980755.js";import"./chunks/tempo.b5a67d34.js";import"./chunks/audio.0b0a52c9.js";import"./chunks/Loop.4db2aa01.js";import"./chunks/Scale.f9a07a23.js";import"./chunks/Subtract.e7604129.js";import"./chunks/PingPongDelay.33c16f88.js";import"./chunks/AutoPanner.30f7ef90.js";import"./chunks/MonoSynth.3cdcc469.js";import"./chunks/Filter.e19ab36f.js";const y=d=>(A("data-v-5be87f46"),d=d(),P(),d),O={class:"flex flex-col items-center"},V={class:"flex flex-wrap"},j=y(()=>s("label",{for:"upload"},[s("div",{class:"i-la-upload"})],-1)),J={key:0,class:"i-la-play"},q={key:1,class:"i-la-stop"},L=y(()=>s("div",{class:"i-la-trash-alt"},null,-1)),U=[L],Z=y(()=>s("div",{class:"i-la-download"},null,-1)),G=[Z],H={class:"flex flex-wrap"},K=["onClick"],Q=["viewBox"],W=["x","y","width","fill"],X={__name:"visualizer",setup(d){let p;const t=k({title:"",author:"",header:"",duration:0,tracks:[],filteredTracks:m(()=>t.tracks.filter((o,n)=>!i.hiddenTracks[n]))}),i=k({width:m(()=>t.duration),height:m(()=>i.upper-i.lower),upper:127,lower:0,playing:!1,hiddenTracks:[]});function g(o){let n=o.target.files[0],c=new FileReader;c.onload=e=>{p=new z.Midi(e.target.result),w(p)},c.readAsArrayBuffer(n)}async function w(o){t.title=o.tracks[0].name,t.header=o.header,t.duration=o.duration,t.ticks=o.durationTicks,t.tracks=o.toJSON().tracks}function x(){t.title="",t.header="",t.duration=0,t.tracks=[],t.ticks=0}function I(){B(p.toArray(),"chromatone")}const u=[];function b(){if(i.playing=!i.playing,i.playing){const o=T()+.5;t.filteredTracks.forEach(n=>{const c=new E(S,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();u.push(c),n.notes.forEach(e=>{c.triggerAttackRelease(e.name,e.duration,e.time+o,e.velocity)})})}else for(;u.length;)u.shift().dispose()}return(o,n)=>{const c=C;return a(),r("div",O,[s("div",V,[s("button",null,[j,s("input",{class:"p-2 w-18em cursor-pointer",id:"upload",type:"file",accept:"audio/midi",onChange:g},null,32)]),s("button",{onClick:n[0]||(n[0]=e=>b())},[i.playing?(a(),r("div",q)):(a(),r("div",J))]),s("button",{onClick:n[1]||(n[1]=e=>x())},U),s("button",{onClick:I},G)]),s("div",H,[(a(!0),r(_,null,f(t.tracks,(e,l)=>(a(),r("div",{class:"p-1",key:e},[s("div",{class:F(["track",{active:!i.hiddenTracks[l]}]),onClick:et=>i.hiddenTracks[l]=!i.hiddenTracks[l]},h(e.channel)+": "+h(e.name)+" "+h(e.instrument.family),11,K)]))),128))]),(a(),r("svg",{class:"max-h-70vh",id:"visual",version:"1.1",baseProfile:"full",viewBox:`0 0 ${i.width} ${i.height}`,xmlns:"http://www.w3.org/2000/svg"},[(a(!0),r(_,null,f(t.filteredTracks,e=>(a(),r("g",{key:e},[(a(!0),r(_,null,f(e.notes,l=>(a(),r("rect",{key:l,rx:"0.4",x:l.time,y:127-l.midi,width:l.duration,height:"1",fill:$(D)((l.midi+3)%12)},null,8,W))),128))]))),128))],8,Q)),v(c,{svg:"visual"})])}}},Y=M(X,[["__scopeId","data-v-5be87f46"]]),St=JSON.parse('{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","frontmatter":{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","date":"2021-05-20T00:00:00.000Z","cover":"midi-visual.svg"},"headers":[],"relativePath":"practice/midi/visualizer/index.md","filePath":"practice/midi/visualizer/index.md","lastUpdated":1689843676000}'),tt={name:"practice/midi/visualizer/index.md"},Bt=Object.assign(tt,{setup(d){return(p,t)=>{const i=N("client-only");return a(),r("div",null,[v(i,null,{default:R(()=>[v(Y)]),_:1})])}}});export{St as __pageData,Bt as default};
