import{_ as D}from"./chunks/SaveSvg.yl29PpdS.js";import{n as S,a1 as z,an as B,ao as N,ap as b,J as E}from"./chunks/theme.CjOXjCIt.js";import{B as I,g as M,b as $,c as m,C as n,D as r,F as o,a0 as _,R,S as T,ar as A,N as F,G as y,H as k,E as P,L as g,K as O,P as J,Q as L,a6 as U}from"./chunks/framework.D0WAkjk4.js";const V=u=>(J("data-v-f88e731b"),u=u(),L(),u),G={class:"flex flex-col items-center"},H={class:"flex flex-wrap items-center"},K={class:"flex items-center"},Q=V(()=>o("label",{for:"upload"},[o("div",{class:"i-la-upload"})],-1)),W={key:0,class:"i-la-play"},Z={key:1,class:"i-la-stop"},j=V(()=>o("div",{class:"i-la-trash-alt"},null,-1)),q=[j],X={class:"flex w-full"},Y={class:"flex flex-col max-h-60vh overflow-scroll",style:{flex:"1 1 50px"}},ee=["onClick"],te={class:"flex-1",style:{flex:"10 1 500px"}},ae=["viewBox"],ie=["x","y","width","fill"],se={__name:"MidiVisualizer",setup(u){const f=M(),e=$({title:"",author:"",header:"",duration:0,tracks:[],filteredTracks:m(()=>e.tracks.filter((i,a)=>!t.hiddenTracks[a]))}),p=m(()=>{let i=0,a=127;return e.filteredTracks.forEach(d=>{d.notes.forEach(s=>{i<s.midi&&(i=s.midi),a>s.midi&&(a=s.midi)})}),{lower:a,upper:i}}),t=$({width:m(()=>e.duration),height:m(()=>p.value.upper-p.value.lower),playing:!1,hiddenTracks:[],start:0,end:e.duration});function w(i){let a=i.target.files[0],d=new FileReader;d.onload=s=>{f.value=new z.Midi(s.target.result),h(f.value)},d.readAsArrayBuffer(a)}async function h(i){e.title=i.tracks[0].name,e.header=i.header,t.end=e.duration=i.duration,e.ticks=i.durationTicks,e.tracks=i.toJSON().tracks}function v(){e.title="",e.header="",e.duration=0,e.tracks=[],e.ticks=0}const x=[];function C(){if(t.playing=!t.playing,t.playing){const i=B()+.5;e.filteredTracks.forEach(a=>{const d=new N(b,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();x.push(d),a.notes.forEach(s=>{d.triggerAttackRelease(s.name,s.duration,s.time+i,s.velocity)})})}else for(;x.length;)x.shift().dispose()}return(i,a)=>{const d=E,s=D;return n(),r("div",G,[o("div",H,[o("div",K,[Q,o("input",{class:"p-2 w-18em cursor-pointer",id:"upload",type:"file",accept:"audio/midi",onChange:w},null,32)]),o("button",{onClick:a[0]||(a[0]=l=>C())},[t.playing?(n(),r("div",Z)):(n(),r("div",W))]),o("button",{onClick:a[1]||(a[1]=l=>v())},q),_(d,{modelValue:t.start,"onUpdate:modelValue":a[2]||(a[2]=l=>t.start=l),min:0,max:t.end-1,param:"Start"},null,8,["modelValue","max"]),_(d,{modelValue:t.end,"onUpdate:modelValue":a[3]||(a[3]=l=>t.end=l),min:t.start+1,max:e.duration,param:"End"},null,8,["modelValue","min","max"]),e.duration?(n(),R(s,{key:0,svg:"visual",file:e==null?void 0:e.title},{default:T(()=>[A("DOWNLOAD SVG")]),_:1},8,["file"])):F("",!0)]),o("div",X,[o("div",Y,[(n(!0),r(y,null,k(e.tracks,(l,c)=>(n(),r("div",{class:"px-1",key:l},[o("div",{class:P(["track",{active:!t.hiddenTracks[c]}]),onClick:re=>t.hiddenTracks[c]=!t.hiddenTracks[c]},g(l.channel)+": "+g(l.name)+" "+g(l.instrument.family),11,ee)]))),128))]),o("div",te,[(n(),r("svg",{class:"max-h-70vh w-full",id:"visual",preserveAspectRatio:"none",version:"1.1",baseProfile:"full",viewBox:`${t.start} ${127-p.value.upper} ${t.end-t.start} ${t.height}`,xmlns:"http://www.w3.org/2000/svg"},[(n(!0),r(y,null,k(e.filteredTracks,l=>(n(),r("g",{key:l},[(n(!0),r(y,null,k(l.notes,c=>(n(),r("rect",{key:c,rx:"0.1",x:c.time,y:127-c.midi,width:c.duration,height:"1",fill:O(S)((c.midi+3)%12)},null,8,ie))),128))]))),128))],8,ae))])])])}}},le=I(se,[["__scopeId","data-v-f88e731b"]]),pe=JSON.parse('{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","frontmatter":{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","date":"2021-05-20T00:00:00.000Z","layout":"app","cover":"midi-visual.svg"},"headers":[],"relativePath":"practice/midi/visualizer/index.md","filePath":"practice/midi/visualizer/index.md","lastUpdated":1720603521000}'),ne={name:"practice/midi/visualizer/index.md"};function oe(u,f,e,p,t,w){const h=le,v=U("client-only");return n(),r("div",null,[_(v,null,{default:T(()=>[_(h)]),_:1})])}const me=I(ne,[["render",oe]]);export{pe as __pageData,me as default};
