import{_ as C}from"./chunks/SaveSvg.BK7kgDBz.js";import{ar as z,c as I,Z as M,an as B,ao as E,ap as N}from"./chunks/theme.DKUtGHOP.js";import{_ as $,J as S,D as w,M as p,q as r,f as o,s as n,l as m,e as R,t as b,j as T,aw as A,F as x,Y as y,y as F,z as k,u as O,i as P}from"./chunks/framework.Bbwy4zmA.js";const J={class:"flex flex-col items-center"},U={class:"flex flex-wrap items-center"},L={class:"flex items-center"},Z={key:0,class:"i-la-play"},j={key:1,class:"i-la-stop"},q={class:"flex w-full"},G={class:"flex flex-col max-h-60vh overflow-scroll",style:{flex:"1 1 50px"}},W=["onClick"],Y={class:"flex-1",style:{flex:"10 1 500px"}},H=["viewBox"],K=["x","y","width","fill"],Q={__name:"MidiVisualizer",setup(V){const f=S(),t=w({title:"",author:"",header:"",duration:0,tracks:[],filteredTracks:p(()=>t.tracks.filter((a,e)=>!i.hiddenTracks[e]))}),u=p(()=>{let a=0,e=127;return t.filteredTracks.forEach(d=>{d.notes.forEach(s=>{a<s.midi&&(a=s.midi),e>s.midi&&(e=s.midi)})}),{lower:e,upper:a}}),i=w({width:p(()=>t.duration),height:p(()=>u.value.upper-u.value.lower),playing:!1,hiddenTracks:[],start:0,end:t.duration});function g(a){let e=a.target.files[0],d=new FileReader;d.onload=s=>{f.value=new M.Midi(s.target.result),_(f.value)},d.readAsArrayBuffer(e)}async function _(a){t.title=a.tracks[0].name,t.header=a.header,i.end=t.duration=a.duration,t.ticks=a.durationTicks,t.tracks=a.toJSON().tracks}function v(){t.title="",t.header="",t.duration=0,t.tracks=[],t.ticks=0}const h=[];function D(){if(i.playing=!i.playing,i.playing){const a=B()+.5;t.filteredTracks.forEach(e=>{const d=new E(N,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();h.push(d),e.notes.forEach(s=>{d.triggerAttackRelease(s.name,s.duration,s.time+a,s.velocity)})})}else for(;h.length;)h.shift().dispose()}return(a,e)=>{const d=z,s=C;return o(),r("div",J,[n("div",U,[n("div",L,[e[4]||(e[4]=n("label",{for:"upload"},[n("div",{class:"i-la-upload"})],-1)),n("input",{class:"p-2 w-18em cursor-pointer",id:"upload",type:"file",accept:"audio/midi",onChange:g},null,32)]),n("button",{onClick:e[0]||(e[0]=l=>D())},[i.playing?(o(),r("div",j)):(o(),r("div",Z))]),n("button",{onClick:e[1]||(e[1]=l=>v())},e[5]||(e[5]=[n("div",{class:"i-la-trash-alt"},null,-1)])),m(d,{modelValue:i.start,"onUpdate:modelValue":e[2]||(e[2]=l=>i.start=l),min:0,max:i.end-1,param:"Start"},null,8,["modelValue","max"]),m(d,{modelValue:i.end,"onUpdate:modelValue":e[3]||(e[3]=l=>i.end=l),min:i.start+1,max:t.duration,param:"End"},null,8,["modelValue","min","max"]),t.duration?(o(),R(s,{key:0,svg:"visual",file:t?.title},{default:T(()=>e[6]||(e[6]=[A("DOWNLOAD SVG")])),_:1},8,["file"])):b("",!0)]),n("div",q,[n("div",G,[(o(!0),r(x,null,y(t.tracks,(l,c)=>(o(),r("div",{class:"px-1",key:l},[n("div",{class:F(["track",{active:!i.hiddenTracks[c]}]),onClick:ie=>i.hiddenTracks[c]=!i.hiddenTracks[c]},k(l.channel)+": "+k(l.name)+" "+k(l.instrument.family),11,W)]))),128))]),n("div",Y,[(o(),r("svg",{class:"max-h-70vh w-full",id:"visual",preserveAspectRatio:"none",version:"1.1",baseProfile:"full",viewBox:`${i.start} ${127-u.value.upper} ${i.end-i.start} ${i.height}`,xmlns:"http://www.w3.org/2000/svg"},[(o(!0),r(x,null,y(t.filteredTracks,l=>(o(),r("g",{key:l},[(o(!0),r(x,null,y(l.notes,c=>(o(),r("rect",{key:c,rx:"0.1",x:c.time,y:127-c.midi,width:c.duration,height:"1",fill:O(I)((c.midi+3)%12)},null,8,K))),128))]))),128))],8,H))])])])}}},X=$(Q,[["__scopeId","data-v-ba9555f2"]]),ne=JSON.parse('{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","frontmatter":{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","date":"2021-05-20T00:00:00.000Z","layout":"app","cover":"midi-visual.svg"},"headers":[],"relativePath":"practice/midi/visualizer/index.md","filePath":"practice/midi/visualizer/index.md","lastUpdated":1752981864000}'),ee={name:"practice/midi/visualizer/index.md"};function te(V,f,t,u,i,g){const _=X,v=P("client-only");return o(),r("div",null,[m(v,null,{default:T(()=>[m(_)]),_:1})])}const oe=$(ee,[["render",te]]);export{ne as __pageData,oe as default};
