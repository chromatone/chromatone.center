import{_ as D}from"./chunks/SaveSvg.CcHtvEVS.js";import{n as T,ap as b,aA as z,av as S,aw as B,ax as M}from"./chunks/theme.idtb9tEs.js";import{D as C,b as I,c as f,E as n,F as o,G as s,V as m,W as v,P as A,I as y,C as F,O as k,J as P,K as E,X as N,a4 as R}from"./chunks/framework.BilnkUFq.js";const w=d=>(P("data-v-d9e04fd1"),d=d(),E(),d),V={class:"flex flex-col items-center"},J={class:"flex flex-wrap"},O=w(()=>s("label",{for:"upload"},[s("div",{class:"i-la-upload"})],-1)),G={key:0,class:"i-la-play"},K={key:1,class:"i-la-stop"},L=w(()=>s("div",{class:"i-la-trash-alt"},null,-1)),U=[L],W=w(()=>s("div",{class:"i-la-download"},null,-1)),X=[W],Z={class:"flex flex-wrap"},j=["onClick"],q=["viewBox"],H=["x","y","width","fill"],Q={__name:"MidiVisualizer",setup(d){let u;const e=I({title:"",author:"",header:"",duration:0,tracks:[],filteredTracks:f(()=>e.tracks.filter((a,l)=>!i.hiddenTracks[l]))}),i=I({width:f(()=>e.duration),height:f(()=>i.upper-i.lower),upper:127,lower:0,playing:!1,hiddenTracks:[]});function g(a){let l=a.target.files[0],c=new FileReader;c.onload=t=>{u=new b.Midi(t.target.result),x(u)},c.readAsArrayBuffer(l)}async function x(a){e.title=a.tracks[0].name,e.header=a.header,e.duration=a.duration,e.ticks=a.durationTicks,e.tracks=a.toJSON().tracks}function p(){e.title="",e.header="",e.duration=0,e.tracks=[],e.ticks=0}function _(){z(u.toArray(),"chromatone")}const h=[];function $(){if(i.playing=!i.playing,i.playing){const a=S()+.5;e.filteredTracks.forEach(l=>{const c=new B(M,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();h.push(c),l.notes.forEach(t=>{c.triggerAttackRelease(t.name,t.duration,t.time+a,t.velocity)})})}else for(;h.length;)h.shift().dispose()}return(a,l)=>{const c=D;return n(),o("div",V,[s("div",J,[s("button",null,[O,s("input",{class:"p-2 w-18em cursor-pointer",id:"upload",type:"file",accept:"audio/midi",onChange:g},null,32)]),s("button",{onClick:l[0]||(l[0]=t=>$())},[i.playing?(n(),o("div",K)):(n(),o("div",G))]),s("button",{onClick:l[1]||(l[1]=t=>p())},U),s("button",{onClick:_},X)]),s("div",Z,[(n(!0),o(m,null,v(e.tracks,(t,r)=>(n(),o("div",{class:"p-1",key:t},[s("div",{class:A(["track",{active:!i.hiddenTracks[r]}]),onClick:ie=>i.hiddenTracks[r]=!i.hiddenTracks[r]},y(t.channel)+": "+y(t.name)+" "+y(t.instrument.family),11,j)]))),128))]),(n(),o("svg",{class:"max-h-70vh",id:"visual",version:"1.1",baseProfile:"full",viewBox:`0 0 ${i.width} ${i.height}`,xmlns:"http://www.w3.org/2000/svg"},[(n(!0),o(m,null,v(e.filteredTracks,t=>(n(),o("g",{key:t},[(n(!0),o(m,null,v(t.notes,r=>(n(),o("rect",{key:r,rx:"0.4",x:r.time,y:127-r.midi,width:r.duration,height:"1",fill:F(T)((r.midi+3)%12)},null,8,H))),128))]))),128))],8,q)),k(c,{svg:"visual"})])}}},Y=C(Q,[["__scopeId","data-v-d9e04fd1"]]),oe=JSON.parse('{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","frontmatter":{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","date":"2021-05-20T00:00:00.000Z","layout":"app","cover":"midi-visual.svg"},"headers":[],"relativePath":"practice/midi/visualizer/index.md","filePath":"practice/midi/visualizer/index.md","lastUpdated":1714020874000}'),ee={name:"practice/midi/visualizer/index.md"};function te(d,u,e,i,g,x){const p=Y,_=R("client-only");return n(),o("div",null,[k(_,null,{default:N(()=>[k(p)]),_:1})])}const le=C(ee,[["render",te]]);export{oe as __pageData,le as default};
