import{_ as D}from"./chunks/SaveSvg.BzyHdSNX.js";import{c as I,V as z,ai as B,aj as E,ak as M,am as N}from"./chunks/theme.BCAJ9CZC.js";import{_ as $,X as S,H as w,G as p,c as o,h as r,i as n,t as m,e as R,s as V,aI as b,k as A,F as x,Q as y,m as F,B as k,u as O,f as P}from"./chunks/framework.DqGUeSFU.js";const U={class:"flex flex-col items-center"},G={class:"flex flex-wrap items-center"},J={class:"flex items-center"},L={key:0,class:"i-la-play"},j={key:1,class:"i-la-stop"},H={class:"flex w-full"},Q={class:"flex flex-col max-h-60vh overflow-scroll",style:{flex:"1 1 50px"}},W=["onClick"],X={class:"flex-1",style:{flex:"10 1 500px"}},Z=["viewBox"],q=["x","y","width","fill"],K={__name:"MidiVisualizer",setup(T){const f=S(),t=w({title:"",author:"",header:"",duration:0,tracks:[],filteredTracks:p(()=>t.tracks.filter((i,e)=>!a.hiddenTracks[e]))}),u=p(()=>{let i=0,e=127;return t.filteredTracks.forEach(d=>{d.notes.forEach(s=>{i<s.midi&&(i=s.midi),e>s.midi&&(e=s.midi)})}),{lower:e,upper:i}}),a=w({width:p(()=>t.duration),height:p(()=>u.value.upper-u.value.lower),playing:!1,hiddenTracks:[],start:0,end:t.duration});function g(i){let e=i.target.files[0],d=new FileReader;d.onload=s=>{f.value=new z.Midi(s.target.result),_(f.value)},d.readAsArrayBuffer(e)}async function _(i){t.title=i.tracks[0].name,t.header=i.header,a.end=t.duration=i.duration,t.ticks=i.durationTicks,t.tracks=i.toJSON().tracks}function v(){t.title="",t.header="",t.duration=0,t.tracks=[],t.ticks=0}const h=[];function C(){if(a.playing=!a.playing,a.playing){const i=B()+.5;t.filteredTracks.forEach(e=>{const d=new E(M,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();h.push(d),e.notes.forEach(s=>{d.triggerAttackRelease(s.name,s.duration,s.time+i,s.velocity)})})}else for(;h.length;)h.shift().dispose()}return(i,e)=>{const d=N,s=D;return o(),r("div",U,[n("div",G,[n("div",J,[e[4]||(e[4]=n("label",{for:"upload"},[n("div",{class:"i-la-upload"})],-1)),n("input",{class:"p-2 w-18em cursor-pointer",id:"upload",type:"file",accept:"audio/midi",onChange:g},null,32)]),n("button",{onClick:e[0]||(e[0]=l=>C())},[a.playing?(o(),r("div",j)):(o(),r("div",L))]),n("button",{onClick:e[1]||(e[1]=l=>v())},e[5]||(e[5]=[n("div",{class:"i-la-trash-alt"},null,-1)])),m(d,{modelValue:a.start,"onUpdate:modelValue":e[2]||(e[2]=l=>a.start=l),min:0,max:a.end-1,param:"Start"},null,8,["modelValue","max"]),m(d,{modelValue:a.end,"onUpdate:modelValue":e[3]||(e[3]=l=>a.end=l),min:a.start+1,max:t.duration,param:"End"},null,8,["modelValue","min","max"]),t.duration?(o(),R(s,{key:0,svg:"visual",file:t==null?void 0:t.title},{default:V(()=>e[6]||(e[6]=[b("DOWNLOAD SVG")])),_:1},8,["file"])):A("",!0)]),n("div",H,[n("div",Q,[(o(!0),r(x,null,y(t.tracks,(l,c)=>(o(),r("div",{class:"px-1",key:l},[n("div",{class:F(["track",{active:!a.hiddenTracks[c]}]),onClick:ae=>a.hiddenTracks[c]=!a.hiddenTracks[c]},k(l.channel)+": "+k(l.name)+" "+k(l.instrument.family),11,W)]))),128))]),n("div",X,[(o(),r("svg",{class:"max-h-70vh w-full",id:"visual",preserveAspectRatio:"none",version:"1.1",baseProfile:"full",viewBox:`${a.start} ${127-u.value.upper} ${a.end-a.start} ${a.height}`,xmlns:"http://www.w3.org/2000/svg"},[(o(!0),r(x,null,y(t.filteredTracks,l=>(o(),r("g",{key:l},[(o(!0),r(x,null,y(l.notes,c=>(o(),r("rect",{key:c,rx:"0.1",x:c.time,y:127-c.midi,width:c.duration,height:"1",fill:O(I)((c.midi+3)%12)},null,8,q))),128))]))),128))],8,Z))])])])}}},Y=$(K,[["__scopeId","data-v-ba9555f2"]]),ne=JSON.parse('{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","frontmatter":{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","date":"2021-05-20T00:00:00.000Z","layout":"app","cover":"midi-visual.svg"},"headers":[],"relativePath":"practice/midi/visualizer/index.md","filePath":"practice/midi/visualizer/index.md","lastUpdated":1738735655000}'),ee={name:"practice/midi/visualizer/index.md"};function te(T,f,t,u,a,g){const _=Y,v=P("client-only");return o(),r("div",null,[m(v,null,{default:V(()=>[m(_)]),_:1})])}const oe=$(ee,[["render",te]]);export{ne as __pageData,oe as default};
