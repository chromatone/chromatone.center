import{_ as C}from"./chunks/SaveSvg.CJRJ8WJk.js";import{c as I,a0 as z,ar as B,as as M,at as N,av as S}from"./chunks/theme.C1cSeBFq.js";import{_ as $,s as A,r as w,d as p,v as o,x as r,z as n,Q as m,I as E,J as T,a5 as R,G as b,F as x,A as y,y as F,D as k,u as O,Y as P}from"./chunks/framework.BMHKg3V0.js";const J={class:"flex flex-col items-center"},U={class:"flex flex-wrap items-center"},G={class:"flex items-center"},L={key:0,class:"i-la-play"},Q={key:1,class:"i-la-stop"},W={class:"flex w-full"},Y={class:"flex flex-col max-h-60vh overflow-scroll",style:{flex:"1 1 50px"}},Z=["onClick"],j={class:"flex-1",style:{flex:"10 1 500px"}},q=["viewBox"],H=["x","y","width","fill"],K={__name:"MidiVisualizer",setup(V){const f=A(),t=w({title:"",author:"",header:"",duration:0,tracks:[],filteredTracks:p(()=>t.tracks.filter((i,e)=>!a.hiddenTracks[e]))}),u=p(()=>{let i=0,e=127;return t.filteredTracks.forEach(d=>{d.notes.forEach(s=>{i<s.midi&&(i=s.midi),e>s.midi&&(e=s.midi)})}),{lower:e,upper:i}}),a=w({width:p(()=>t.duration),height:p(()=>u.value.upper-u.value.lower),playing:!1,hiddenTracks:[],start:0,end:t.duration});function g(i){let e=i.target.files[0],d=new FileReader;d.onload=s=>{f.value=new z.Midi(s.target.result),_(f.value)},d.readAsArrayBuffer(e)}async function _(i){t.title=i.tracks[0].name,t.header=i.header,a.end=t.duration=i.duration,t.ticks=i.durationTicks,t.tracks=i.toJSON().tracks}function v(){t.title="",t.header="",t.duration=0,t.tracks=[],t.ticks=0}const h=[];function D(){if(a.playing=!a.playing,a.playing){const i=B()+.5;t.filteredTracks.forEach(e=>{const d=new M(N,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();h.push(d),e.notes.forEach(s=>{d.triggerAttackRelease(s.name,s.duration,s.time+i,s.velocity)})})}else for(;h.length;)h.shift().dispose()}return(i,e)=>{const d=S,s=C;return o(),r("div",J,[n("div",U,[n("div",G,[e[4]||(e[4]=n("label",{for:"upload"},[n("div",{class:"i-la-upload"})],-1)),n("input",{class:"p-2 w-18em cursor-pointer",id:"upload",type:"file",accept:"audio/midi",onChange:g},null,32)]),n("button",{onClick:e[0]||(e[0]=l=>D())},[a.playing?(o(),r("div",Q)):(o(),r("div",L))]),n("button",{onClick:e[1]||(e[1]=l=>v())},e[5]||(e[5]=[n("div",{class:"i-la-trash-alt"},null,-1)])),m(d,{modelValue:a.start,"onUpdate:modelValue":e[2]||(e[2]=l=>a.start=l),min:0,max:a.end-1,param:"Start"},null,8,["modelValue","max"]),m(d,{modelValue:a.end,"onUpdate:modelValue":e[3]||(e[3]=l=>a.end=l),min:a.start+1,max:t.duration,param:"End"},null,8,["modelValue","min","max"]),t.duration?(o(),E(s,{key:0,svg:"visual",file:t==null?void 0:t.title},{default:T(()=>e[6]||(e[6]=[R("DOWNLOAD SVG")])),_:1},8,["file"])):b("",!0)]),n("div",W,[n("div",Y,[(o(!0),r(x,null,y(t.tracks,(l,c)=>(o(),r("div",{class:"px-1",key:l},[n("div",{class:F(["track",{active:!a.hiddenTracks[c]}]),onClick:ae=>a.hiddenTracks[c]=!a.hiddenTracks[c]},k(l.channel)+": "+k(l.name)+" "+k(l.instrument.family),11,Z)]))),128))]),n("div",j,[(o(),r("svg",{class:"max-h-70vh w-full",id:"visual",preserveAspectRatio:"none",version:"1.1",baseProfile:"full",viewBox:`${a.start} ${127-u.value.upper} ${a.end-a.start} ${a.height}`,xmlns:"http://www.w3.org/2000/svg"},[(o(!0),r(x,null,y(t.filteredTracks,l=>(o(),r("g",{key:l},[(o(!0),r(x,null,y(l.notes,c=>(o(),r("rect",{key:c,rx:"0.1",x:c.time,y:127-c.midi,width:c.duration,height:"1",fill:O(I)((c.midi+3)%12)},null,8,H))),128))]))),128))],8,q))])])])}}},X=$(K,[["__scopeId","data-v-f88e731b"]]),ne=JSON.parse('{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","frontmatter":{"title":"MIDI File visualizer","description":"Render a MIDI-file to a colorful picture","date":"2021-05-20T00:00:00.000Z","layout":"app","cover":"midi-visual.svg"},"headers":[],"relativePath":"practice/midi/visualizer/index.md","filePath":"practice/midi/visualizer/index.md","lastUpdated":1725366960000}'),ee={name:"practice/midi/visualizer/index.md"};function te(V,f,t,u,a,g){const _=X,v=P("client-only");return o(),r("div",null,[m(v,null,{default:T(()=>[m(_)]),_:1})])}const oe=$(ee,[["render",te]]);export{ne as __pageData,oe as default};
