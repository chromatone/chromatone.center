import{L as D,F as P,aD as z,p as N,a8 as S,Y as A,Z as O,$ as j,aE as V,aF as E,aG as B,aH as b,aI as F,az as H,aj as $,n as I,e as G,_ as U}from"./chunks/theme.NJ_Xky9a.js";import{b as T,u as x,c as g,s as R,q as W,d as f,k as Y,x as Z,r as L,E as p,F as h,G as i,L as y,C as n,I as v,V as q,W as k,a2 as J,O as w,D as K,X,aq as Q,a4 as ee}from"./chunks/framework.avS8w96o.js";const s=T({base:55,freq:D(x("drone-freq",110),27.5,220),started:!1,stopped:!0,filterFreq:x("drone-filter-freq",1e3),volume:x("drone-vol",.5),note:g(()=>P(s.freq).toNote()),pitch:g({get(){return Math.round((z(s.freq)+72)%12)},set(a){s.freq=N(a-36)}}),cents:g(()=>ae(s.freq)%1200),centDiff:g(()=>s.cents-s.pitch*100),color:g(()=>S(s.freq))}),d=R({initiated:!1});function M(){const{channel:a}=A("drone");d.channel=a,d.gain=new O(s.volume).connect(a),d.filter=new j(s.filterFreq).connect(d.gain)}function te(){return d.initiated||(M(),d.initiated=!0,s.started=!0,W(" ",a=>{a.preventDefault(),s.stopped=!s.stopped}),f(()=>s.volume,a=>{d.gain.gain.targetRampTo(a,1)}),f(()=>s.filterFreq,a=>{d.filter.frequency.targetRampTo(a,.1)})),s}let C=0;function oe(a){const e=R({}),t=T({play:!1,active:!1,vol:D(x(`drone-${a}-vol`,.8),0,1),pan:D(x(`drone-${a}-pan`,0),-1,1),freq:g(()=>s.freq*Math.pow(2,a/12)),note:g(()=>P(t.freq).toNote()),color:g(()=>S(t.freq)),lfo:0,panning:0}),m=V({param:`drone-${a}-vol`,number:5+C});f(m,r=>{t.vol=r,r>0&&(t.play=!0)});const l=V({param:`drone-${a}-pan`,number:6+C});f(l,r=>{t.pan=(r-.5)*2}),C+=2,f(()=>s.stopped,r=>{r?t.play=!1:t.active&&(t.play=!0)}),f(()=>t.play,r=>{r?(e.synth||(d.initiated||(M(),d.initiated=!0,s.started=!0),o(),c()),t.active=!0,s.stopped=!1,e.synth.triggerAttack(t.freq)):e.synth&&e.synth.triggerRelease()});function o(){e.meter=new E({normalRange:!0}),e.panner=new B({volume:b(s.volume)}).connect(d.filter),e.lfo=new F(Math.random()*.5+.01,-.25,.25).connect(e.panner.pan).start(),e.lfoVol=new F(Math.random()*.1+.001,-20,0).connect(e.panner.volume).connect(e.meter).start(),e.synth=new H({envelope:{attack:2,sustain:1,release:4},oscillator:{type:"sawtooth32"},volume:b(t.vol)-10}).connect(e.panner)}function c(){f(()=>t.freq,r=>{e.synth.frequency.targetRampTo(r)}),f(()=>t.vol,r=>{e.synth.volume.exponentialRampTo(b(r)-10,1)}),f(()=>t.pan,r=>{e.panner.pan.targetRampTo(r,1)}),Y(()=>{t.lfo=e.meter.getValue()})}return Z(()=>{e.synth&&e.synth.triggerRelease()}),t}function ne(a,e=s.base){return e*Math.pow(2,a/12)}function ae(a,e=0){return Math.floor(1200*Math.log(a/ne(e))/Math.log(2))}const re={class:"text-2xl z-100"},se={__name:"PitchDroneVoice",props:{interval:{type:Number,default:0}},setup(a){const t=oe(a.interval);function m(o,c){o.tap&&(t.play=!t.play,t.active=t.play),t.vol-=c[1]/400,t.pan+=c[0]/100}const l=L();return $({onDrag(o){var c;(c=o==null?void 0:o.event)==null||c.preventDefault(),m(o,o.delta)},onWheel(o){var c;(c=o==null?void 0:o.event)==null||c.preventDefault(),m(o,o.velocities.map(r=>-r))}},{domTarget:l,eventOptions:{passive:!1}}),(o,c)=>(p(),h("div",{class:"py-16 flex-1 relative cursor-pointer rounded-xl overflow-hidden text-center font-bold border-6 touch-none",ref_key:"control",ref:l,style:y({borderColor:n(t).play?n(t).color:"#3333"})},[i("div",{class:"vol -z-5 absolute left-0 right-0 bottom-0 bg-dark-100 bg-opacity-30 border-t-4",style:y({borderColor:n(t).color,height:n(t).vol*100+"%",opacity:n(t).play?1:.2})},null,4),i("div",{class:"vol -z-5 absolute left-0 right-0 bottom-0 bg-dark-900 bg-opacity-20 border-t-1",style:y({height:n(t).vol*100*n(t).lfo+"%",opacity:n(t).play?1:.2,backgroundColor:n(t).color})},null,4),i("div",{class:"pan -z-5 absolute left-0 top-0 bottom-0 border-r-2",style:y({width:n(t).pan*50+50+"%",opacity:n(t).play?1:.2})},null,4),i("div",re,v(n(t).note),1)],4))}},ie={class:"drone w-full flex-1 justify-center flex flex-col p-2"},le={class:"intervals my-2"},ce={class:"flex flex-wrap"},pe={class:"info my-4 flex flex-wrap justify-stretch items-center touch-none"},de={class:"p-1 text-4xl font-bold"},ue={class:"p-1"},he={class:"p-1"},fe={class:"p-1 text-xl"},me={class:"controls min-w-10em flex-1 my-2 p-2 flex flex-wrap items-center justify-center is-group gap-2"},ge={key:0,class:"i-la-stop"},_e={key:1,class:"i-la-play"},ye={class:"is-group flex p-2 gap-2"},ve={class:"notes w-full text-sm font-bold text-center flex flex-wrap"},xe=["onClick"],we={__name:"PitchDrone",setup(a){const e=te(),t=T({fifths:{title:"5P",voices:[7,19,31]},octave:{title:"8P",voices:[-12,0,12]}}),m=L();return $({onDrag(l){var o;(o=l==null?void 0:l.event)==null||o.preventDefault(),e.freq+=l.delta[0]/10},onWheel(l){var o;(o=l==null?void 0:l.event)==null||o.preventDefault(),e.freq-=l.velocities[0]/10}},{domTarget:m,eventOptions:{passive:!1}}),(l,o)=>{const c=se,r=U;return p(),h("div",{class:"flex flex-col items-stretch w-full transition-all duration-500 ease-out select-none rounded-3xl shadow-xl border-8",style:y({borderColor:n(e).color})},[i("div",ie,[i("div",le,[(p(!0),h(q,null,k(t,u=>(p(),h("div",{class:"interval flex flex-col m-1",key:u},[i("div",ce,[(p(!0),h(q,null,k(u.voices,_=>(p(),J(c,{class:"m-2",key:_,interval:_},null,8,["interval"]))),128))])]))),128))]),i("div",pe,[i("div",{class:"flex flex-wrap p-4 mx-2 flex-1 min-w-10em items-center rounded-xl text-white p-2 cursor-pointer transition-all duration-500 ease-out",ref_key:"pitchControl",ref:m,style:y({backgroundColor:n(e).color})},[i("div",de,v(n(e).note),1),i("div",ue,v(n(e).centDiff),1),i("div",he,v(n(e).cents)+" cents",1),i("div",fe,v(n(e).freq.toFixed(2))+" Hz",1)],4),i("div",me,[i("button",{class:"text-button text-3xl",onClick:o[0]||(o[0]=u=>n(e).stopped=!n(e).stopped)},[n(e).stopped?(p(),h("div",_e)):(p(),h("div",ge))]),i("div",ye,[w(r,{class:"w-4em",modelValue:n(e).volume,"onUpdate:modelValue":o[1]||(o[1]=u=>n(e).volume=u),min:0,max:1,step:.05,param:"VOL"},null,8,["modelValue"]),w(r,{class:"w-4em",modelValue:n(e).filterFreq,"onUpdate:modelValue":o[2]||(o[2]=u=>n(e).filterFreq=u),min:55,max:12e3,step:.05,fixed:0,param:"LP"},null,8,["modelValue"])])])]),i("div",ve,[(p(!0),h(q,null,k(n(G),(u,_)=>(p(),h("div",{class:"p-2 m-1 flex-1 cursor-pointer rounded-xl",key:u,style:y({backgroundColor:n(I)(_,3,n(e).pitch==_?1:.2,n(e).pitch==_?1:.4)}),onClick:Ce=>n(e).pitch=_},v(u),13,xe))),128))])])],4)}}},Ve=JSON.parse('{"title":"Drone","description":"Digital shruti box or tanpura tool online","frontmatter":{"title":"Drone","description":"Digital shruti box or tanpura tool online","layout":"app","date":"2022-06-06T00:00:00.000Z","cover":"drone.png"},"headers":[],"relativePath":"practice/pitch/drone/index.md","filePath":"practice/pitch/drone/index.md","lastUpdated":1708536366000}'),be={name:"practice/pitch/drone/index.md"},qe=Q("",4);function ke(a,e,t,m,l,o){const c=we,r=ee("client-only");return p(),h("div",null,[w(r,null,{default:X(()=>[w(c,{class:"max-w-55ch mx-auto"})]),_:1}),qe])}const Fe=K(be,[["render",ke]]);export{Ve as __pageData,Fe as default};
