import{_ as N}from"./chunks/ControlRotary.f6d92b27.js";import{b as A,p as j,f as P}from"./chunks/calculations.65ee336d.js";import{u as T,F as S,G as B,Y as E,s as b,S as O}from"./chunks/index.ecadaa1f.js";import{D,I as x,i as f,a1 as $,V as H,C as h,M as I,W as U,m as M,n as R,o as i,c as l,a as s,v as _,h as o,t as y,F as q,r as k,f as G,g as w,_ as W,E as Y,z as J,B as K}from"./chunks/framework.02c15fb1.js";import{c as Z,b as Q}from"./chunks/audio.cd4fd50f.js";import{l as F}from"./chunks/midi.3cded2a1.js";import{a as V}from"./chunks/AutoPanner.e7dc9f35.js";import{F as X}from"./chunks/Filter.0c504ab2.js";import{n as ee}from"./chunks/colors.556678ec.js";import{n as te}from"./chunks/theory.61e5aadb.js";import"./chunks/commonjsHelpers.de833af9.js";import"./chunks/index.b30cd6d2.js";import"./chunks/Scale.c2a3e98f.js";import"./chunks/index.654bd828.js";import"./chunks/synth.91fa66d8.js";import"./chunks/Subtract.690bd439.js";import"./chunks/PingPongDelay.dcb48e49.js";import"./chunks/MonoSynth.dbabbee5.js";import"./chunks/index.27fe08f8.js";import"./chunks/index.86652af6.js";const r=D({base:55,freq:T(x("drone-freq",110),27.5,220),started:!1,stopped:!0,filterFreq:x("drone-filter-freq",1e3),volume:x("drone-vol",.5),note:f(()=>S(r.freq).toNote()),pitch:f({get(){return Math.round((A(r.freq)+72)%12)},set(n){r.freq=j(n-36)}}),cents:f(()=>ae(r.freq)%1200),centDiff:f(()=>r.cents-r.pitch*100),color:f(()=>P(r.freq))}),c=$({initiated:!1});function z(){const{channel:n}=Z("drone");c.channel=n,c.gain=new B(r.volume).connect(n),c.filter=new X(r.filterFreq).connect(c.gain)}function oe(){return c.initiated||(z(),c.initiated=!0,r.started=!0,H(" ",n=>{n.preventDefault(),r.stopped=!r.stopped}),h(()=>r.volume,n=>{c.gain.gain.targetRampTo(n,1)}),h(()=>r.filterFreq,n=>{c.filter.frequency.targetRampTo(n,.1)})),r}let C=0;function ne(n){const e=$({}),t=D({play:!1,active:!1,vol:T(x(`drone-${n}-vol`,.8),0,1),pan:T(x(`drone-${n}-pan`,0),-1,1),freq:f(()=>r.freq*Math.pow(2,n/12)),note:f(()=>S(t.freq).toNote()),color:f(()=>P(t.freq)),lfo:0,panning:0}),g=F({param:`drone-${n}-vol`,number:5+C});h(g,a=>{t.vol=a,a>0&&(t.play=!0)});const p=F({param:`drone-${n}-pan`,number:6+C});h(p,a=>{t.pan=(a-.5)*2}),C+=2,h(()=>r.stopped,a=>{a?t.play=!1:t.active&&(t.play=!0)}),h(()=>t.play,a=>{a?(e.synth||(c.initiated||(z(),c.initiated=!0,r.started=!0),d(),m()),t.active=!0,r.stopped=!1,e.synth.triggerAttack(t.freq)):e.synth&&e.synth.triggerRelease()});function d(){e.meter=new Q({normalRange:!0}),e.panner=new E({volume:b(r.volume)}).connect(c.filter),e.lfo=new V(Math.random()*.5+.01,-.25,.25).connect(e.panner.pan).start(),e.lfoVol=new V(Math.random()*.1+.001,-20,0).connect(e.panner.volume).connect(e.meter).start(),e.synth=new O({envelope:{attack:2,sustain:1,release:4},oscillator:{type:"sawtooth32"},volume:b(t.vol)-10}).connect(e.panner)}function m(){h(()=>t.freq,a=>{e.synth.frequency.targetRampTo(a)}),h(()=>t.vol,a=>{e.synth.volume.exponentialRampTo(b(a)-10,1)}),h(()=>t.pan,a=>{e.panner.pan.targetRampTo(a,1)}),I(()=>{t.lfo=e.meter.getValue()})}return U(()=>{e.synth&&e.synth.triggerRelease()}),t}function re(n,e=r.base){return e*Math.pow(2,n/12)}function ae(n,e=0){return Math.floor(1200*Math.log(n/re(e))/Math.log(2))}const se={class:"text-2xl z-100"},ie={__name:"PitchDroneVoice",props:{interval:{type:Number,default:0}},setup(n){const t=ne(n.interval);function g(p){p.tap&&(t.play=!t.play,t.active=t.play),t.vol-=p.delta[1]/400,t.pan+=p.delta[0]/100}return(p,d)=>{const m=M("drag");return R((i(),l("div",{class:"py-16 flex-1 relative cursor-pointer rounded-xl overflow-hidden text-center font-bold border-6 touch-none",style:_({borderColor:o(t).play?o(t).color:"#3333"})},[s("div",{class:"vol -z-5 absolute left-0 right-0 bottom-0 bg-dark-100 bg-opacity-30 border-t-4",style:_({borderColor:o(t).color,height:o(t).vol*100+"%",opacity:o(t).play?1:.2})},null,4),s("div",{class:"vol -z-5 absolute left-0 right-0 bottom-0 bg-dark-900 bg-opacity-20 border-t-1",style:_({height:o(t).vol*100*o(t).lfo+"%",opacity:o(t).play?1:.2,backgroundColor:o(t).color})},null,4),s("div",{class:"pan -z-5 absolute left-0 top-0 bottom-0 border-r-2",style:_({width:o(t).pan*50+50+"%",opacity:o(t).play?1:.2})},null,4),s("div",se,y(o(t).note),1)],4)),[[m,g]])}}},le={class:"drone w-full flex-1 justify-center flex flex-col p-2"},ce={class:"intervals my-2"},pe={class:"flex flex-wrap"},de={class:"info my-4 flex flex-wrap justify-stretch items-center touch-none"},ue={class:"p-1 text-4xl font-bold"},he={class:"p-1"},fe={class:"p-1"},me={class:"p-1 text-xl"},ve={class:"controls min-w-10em flex-1 my-2 p-2 flex flex-wrap items-center justify-center is-group gap-2"},_e={key:0,class:"i-la-stop"},ge={key:1,class:"i-la-play"},ye={class:"is-group flex p-2 gap-2"},xe={class:"notes w-full text-sm font-bold text-center flex flex-wrap"},we=["onClick"],be={__name:"PitchDrone",setup(n){const e=oe();function t(p){e.freq+=p.delta[0]/10}const g=D({fifths:{title:"5P",voices:[7,19,31]},octave:{title:"8P",voices:[-12,0,12]}});return(p,d)=>{const m=ie,a=N,L=M("drag");return i(),l("div",{class:"flex flex-col items-stretch w-full transition-all duration-500 ease-out select-none rounded-3xl shadow-xl border-8",style:_({borderColor:o(e).color})},[s("div",le,[s("div",ce,[(i(!0),l(q,null,k(g,u=>(i(),l("div",{class:"interval flex flex-col m-1",key:u},[s("div",pe,[(i(!0),l(q,null,k(u.voices,v=>(i(),G(m,{class:"m-2",key:v,interval:v},null,8,["interval"]))),128))])]))),128))]),s("div",de,[R((i(),l("div",{class:"flex flex-wrap p-4 mx-2 flex-1 min-w-10em items-center rounded-xl text-white p-2 cursor-pointer transition-all duration-500 ease-out",style:_({backgroundColor:o(e).color})},[s("div",ue,y(o(e).note),1),s("div",he,y(o(e).centDiff),1),s("div",fe,y(o(e).cents)+" cents",1),s("div",me,y(o(e).freq.toFixed(2))+" Hz",1)],4)),[[L,t]]),s("div",ve,[s("button",{class:"text-button text-3xl",onClick:d[0]||(d[0]=u=>o(e).stopped=!o(e).stopped)},[o(e).stopped?(i(),l("div",ge)):(i(),l("div",_e))]),s("div",ye,[w(a,{class:"w-4em",modelValue:o(e).volume,"onUpdate:modelValue":d[1]||(d[1]=u=>o(e).volume=u),min:0,max:1,step:.05,param:"VOL"},null,8,["modelValue"]),w(a,{class:"w-4em",modelValue:o(e).filterFreq,"onUpdate:modelValue":d[2]||(d[2]=u=>o(e).filterFreq=u),min:55,max:12e3,step:.05,fixed:0,param:"LP"},null,8,["modelValue"])])])]),s("div",xe,[(i(!0),l(q,null,k(o(te),(u,v)=>(i(),l("div",{class:"p-2 m-1 flex-1 cursor-pointer rounded-xl",key:u,style:_({backgroundColor:o(ee)(v,3,o(e).pitch==v?1:.2,o(e).pitch==v?1:.4)}),onClick:Te=>o(e).pitch=v},y(u),13,we))),128))])])],4)}}},We=JSON.parse('{"title":"Drone","description":"Digital shruti box or tanpura tool online","frontmatter":{"title":"Drone","description":"Digital shruti box or tanpura tool online","date":"2022-06-06T00:00:00.000Z","cover":"drone.png"},"headers":[],"relativePath":"practice/pitch/drone/index.md","filePath":"practice/pitch/drone/index.md","lastUpdated":1694022443000}'),qe={name:"practice/pitch/drone/index.md"},ke=K("",4);function Ce(n,e,t,g,p,d){const m=be,a=Y("client-only");return i(),l("div",null,[w(a,null,{default:J(()=>[w(m,{class:"max-w-55ch"})]),_:1}),ke])}const Ye=W(qe,[["render",Ce]]);export{We as __pageData,Ye as default};
