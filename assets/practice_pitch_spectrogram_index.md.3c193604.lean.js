import{_ as Gt}from"./chunks/ControlStart.81abbde3.js";import{i as qt,m as zt}from"./chunks/audio.5ebf557e.js";import{b as Ht}from"./chunks/calculations.2bac3e9a.js";import{u as Pt}from"./chunks/mic.4cf05859.js";import{i as Xt,M as ft,k as Wt,j as Vt,H as Ut,x as $t,o as Be,c as Ge,a as Ie,y as Yt,f as jt,d as Kt,t as Qt,_ as Jt,m as Zt,g as _t,n as ei,b as ti}from"./chunks/framework.adad30f1.js";import{u as ii}from"./chunks/index.d12b1cdf.js";import"./chunks/UserMedia.7bc9bd48.js";import"./chunks/Subtract.61ab647b.js";import"./chunks/OnePoleFilter.33e84b6d.js";/**!
 * audioMotion-analyzer
 * High-resolution real-time graphic audio spectrum analyzer JS module
 *
 * @version 4.3.0
 * @author  Henrique Avila Vianna <hvianna@gmail.com> <https://henriquevianna.com>
 * @license AGPL-3.0-or-later
 */const si="4.3.0",ot=Math.PI,ke=2*ot,it=ot/2,ut=8.17579892,gt="dual-combined",Ve="dual-horizontal",we="single",ye="dual-vertical",pt="bar-index",mt="bar-level",Ue="gradient",wt=60,yt="click",ai="fullscreenchange",Ot="resize",ni="#111",Lt="",Rt="A",bt="B",vt="C",St="D",xt="468",$e="sans-serif",ri="#0f0",oi="#7f7f7f22",Me=10,li="create",At="fschange",hi="lores",ci=Ot,st="user",di="#000c",Et="#fff",fi="#4f4",Ct="#888",_i="#555",at="bark",He="linear",Fe="log",nt="mel",Tt=["#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b"],Bt=[["classic",{colorStops:["red",{color:"yellow",level:.85,pos:.6},{color:"lime",level:.475}]}],["prism",{colorStops:Tt}],["rainbow",{dir:"h",colorStops:["#817",...Tt,"#639"]}],["orangered",{bgColor:"#3e2f29",colorStops:["OrangeRed"]}],["steelblue",{bgColor:"#222c35",colorStops:["SteelBlue"]}]],ui=["ERR_AUDIO_CONTEXT_FAIL","Could not create audio context. Web Audio API not supported?"],gi=["ERR_INVALID_AUDIO_CONTEXT","Provided audio context is not valid"],pi=["ERR_UNKNOWN_GRADIENT","Unknown gradient"],rt=["ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1"],mi=["ERR_INVALID_MODE","Invalid mode"],wi=["ERR_REFLEX_OUT_OF_RANGE","Reflex ratio must be >= 0 and < 1"],yi=["ERR_INVALID_AUDIO_SOURCE","Audio source must be an instance of HTMLMediaElement or AudioNode"],Li=["ERR_GRADIENT_INVALID_NAME","Gradient name must be a non-empty string"],Ri=["ERR_GRADIENT_NOT_AN_OBJECT","Gradient options must be an object"],bi=["ERR_GRADIENT_MISSING_COLOR","Gradient colorStops must be a non-empty array"];class ce extends Error{constructor(e,i){const[s,l]=e;super(l+(i!==void 0?`: ${i}`:"")),this.name="AudioMotionError",this.code=s}}const It=(le,e)=>console.warn(`${le} is deprecated. Use ${e} instead.`),Ye=(le,e,i="toLowerCase")=>e[Math.max(0,e.indexOf((""+le)[i]()))],vi=(le,e,i,s,l)=>e+(s-e)*(l-le)/(i-le);Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(le){let e=this.length;for(;e-- >0;)if(le(this[e]))return e;return-1});class Si{constructor(e,i={}){this._ready=!1,this._aux={},this._canvasGradients=[],this._destroyed=!1,this._energy={val:0,peak:0,hold:0},this._flg={},this._fps=0,this._gradients={},this._last=0,this._outNodes=[],this._ownContext=!1,this._selectedGrads=[],this._sources=[];for(const[u,A]of Bt)this.registerGradient(u,A);this._container=e||document.body,this._defaultWidth=this._container.clientWidth||640,this._defaultHeight=this._container.clientHeight||270;let s;if(!(i.source&&(s=i.source.context))){if(!(s=i.audioCtx))try{s=new(window.AudioContext||window.webkitAudioContext),this._ownContext=!0}catch{throw new ce(ui)}}if(!s.createGain)throw new ce(gi);const l=this._analyzer=[s.createAnalyser(),s.createAnalyser()],h=this._splitter=s.createChannelSplitter(2),o=this._merger=s.createChannelMerger(2);this._input=s.createGain(),this._output=s.createGain(),i.source&&this.connectInput(i.source);for(const u of[0,1])h.connect(l[u],u);o.connect(this._output),i.connectSpeakers!==!1&&this.connectOutput();const a=document.createElement("canvas");a.style="max-width: 100%;",this._ctx=a.getContext("2d");for(const u of["_scaleX","_scaleR"])this[u]=document.createElement("canvas").getContext("2d");this._fsEl=i.fsElement||a;const d=()=>{this._fsTimeout||(this._fsTimeout=window.setTimeout(()=>{this._fsChanging||(this._setCanvas(ci),this._fsTimeout=0)},wt))};window.ResizeObserver&&(this._observer=new ResizeObserver(d),this._observer.observe(this._container)),this._controller=new AbortController;const r=this._controller.signal;window.addEventListener(Ot,d,{signal:r}),a.addEventListener(ai,()=>{this._fsChanging=!0,this._fsTimeout&&window.clearTimeout(this._fsTimeout),this._setCanvas(At),this._fsTimeout=window.setTimeout(()=>{this._fsChanging=!1,this._fsTimeout=0},wt)},{signal:r});const w=()=>{s.state=="suspended"&&s.resume(),window.removeEventListener(yt,w)};window.addEventListener(yt,w),document.addEventListener("visibilitychange",()=>{document.visibilityState!="hidden"&&(this._frames=0,this._time=performance.now())},{signal:r}),this._setProps(i,!0),this.useCanvas&&this._container.appendChild(a),this._ready=!0,this._setCanvas(li)}get alphaBars(){return this._alphaBars}set alphaBars(e){this._alphaBars=!!e,this._calcBars()}get ansiBands(){return this._ansiBands}set ansiBands(e){this._ansiBands=!!e,this._calcBars()}get barSpace(){return this._barSpace}set barSpace(e){this._barSpace=+e||0,this._calcBars()}get channelLayout(){return this._chLayout}set channelLayout(e){this._chLayout=Ye(e,[we,Ve,ye,gt]),this._input.disconnect(),this._input.connect(this._chLayout!=we?this._splitter:this._analyzer[0]),this._analyzer[0].disconnect(),this._outNodes.length&&this._analyzer[0].connect(this._chLayout!=we?this._merger:this._output),this._calcBars(),this._makeGrad()}get colorMode(){return this._colorMode}set colorMode(e){this._colorMode=Ye(e,[Ue,pt,mt])}get fftSize(){return this._analyzer[0].fftSize}set fftSize(e){for(const s of[0,1])this._analyzer[s].fftSize=e;const i=this._analyzer[0].frequencyBinCount;this._fftData=[new Float32Array(i),new Float32Array(i)],this._calcBars()}get frequencyScale(){return this._frequencyScale}set frequencyScale(e){this._frequencyScale=Ye(e,[Fe,at,nt,He]),this._calcBars()}get gradient(){return this._selectedGrads[0]}set gradient(e){this._setGradient(e)}get gradientLeft(){return this._selectedGrads[0]}set gradientLeft(e){this._setGradient(e,0)}get gradientRight(){return this._selectedGrads[1]}set gradientRight(e){this._setGradient(e,1)}get height(){return this._height}set height(e){this._height=e,this._setCanvas(st)}get ledBars(){return this._showLeds}set ledBars(e){this._showLeds=!!e,this._calcBars()}get linearAmplitude(){return this._linearAmplitude}set linearAmplitude(e){this._linearAmplitude=!!e}get linearBoost(){return this._linearBoost}set linearBoost(e){this._linearBoost=e>=1?+e:1}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=+e||0}get loRes(){return this._loRes}set loRes(e){this._loRes=!!e,this._setCanvas(hi)}get lumiBars(){return this._lumiBars}set lumiBars(e){this._lumiBars=!!e,this._calcBars(),this._makeGrad()}get maxDecibels(){return this._analyzer[0].maxDecibels}set maxDecibels(e){for(const i of[0,1])this._analyzer[i].maxDecibels=e}get maxFPS(){return this._maxFPS}set maxFPS(e){this._maxFPS=e<0?0:+e||0}get maxFreq(){return this._maxFreq}set maxFreq(e){if(e<1)throw new ce(rt);this._maxFreq=Math.min(e,this.audioCtx.sampleRate/2),this._calcBars()}get minDecibels(){return this._analyzer[0].minDecibels}set minDecibels(e){for(const i of[0,1])this._analyzer[i].minDecibels=e}get minFreq(){return this._minFreq}set minFreq(e){if(e<1)throw new ce(rt);this._minFreq=+e,this._calcBars()}get mirror(){return this._mirror}set mirror(e){this._mirror=Math.sign(e)|0,this._calcBars(),this._makeGrad()}get mode(){return this._mode}set mode(e){const i=e|0;if(i>=0&&i<=10&&i!=9)this._mode=i,this._calcBars(),this._makeGrad();else throw new ce(mi,e)}get noteLabels(){return this._noteLabels}set noteLabels(e){this._noteLabels=!!e,this._createScales()}get outlineBars(){return this._outlineBars}set outlineBars(e){this._outlineBars=!!e,this._calcBars()}get peakLine(){return this._peakLine}set peakLine(e){this._peakLine=!!e}get radial(){return this._radial}set radial(e){this._radial=!!e,this._calcBars(),this._makeGrad()}get reflexRatio(){return this._reflexRatio}set reflexRatio(e){if(e=+e||0,e<0||e>=1)throw new ce(wi);this._reflexRatio=e,this._calcBars(),this._makeGrad()}get roundBars(){return this._roundBars}set roundBars(e){this._roundBars=!!e,this._calcBars()}get smoothing(){return this._analyzer[0].smoothingTimeConstant}set smoothing(e){for(const i of[0,1])this._analyzer[i].smoothingTimeConstant=e}get spinSpeed(){return this._spinSpeed}set spinSpeed(e){e=+e||0,(this._spinSpeed===void 0||e==0)&&(this._spinAngle=-it),this._spinSpeed=e}get splitGradient(){return this._splitGradient}set splitGradient(e){this._splitGradient=!!e,this._makeGrad()}get stereo(){return It("stereo","channelLayout"),this._chLayout!=we}set stereo(e){It("stereo","channelLayout"),this.channelLayout=e?ye:we}get trueLeds(){return this._trueLeds}set trueLeds(e){this._trueLeds=!!e}get volume(){return this._output.gain.value}set volume(e){this._output.gain.value=e}get weightingFilter(){return this._weightingFilter}set weightingFilter(e){this._weightingFilter=Ye(e,[Lt,Rt,bt,vt,St,xt],"toUpperCase")}get width(){return this._width}set width(e){this._width=e,this._setCanvas(st)}get audioCtx(){return this._input.context}get canvas(){return this._ctx.canvas}get canvasCtx(){return this._ctx}get connectedSources(){return this._sources}get connectedTo(){return this._outNodes}get fps(){return this._fps}get fsHeight(){return this._fsHeight}get fsWidth(){return this._fsWidth}get isAlphaBars(){return this._flg.isAlpha}get isBandsMode(){return this._flg.isBands}get isDestroyed(){return this._destroyed}get isFullscreen(){return this._fsEl&&(document.fullscreenElement||document.webkitFullscreenElement)===this._fsEl}get isLedBars(){return this._flg.isLeds}get isLumiBars(){return this._flg.isLumi}get isOctaveBands(){return this._flg.isOctaves}get isOn(){return!!this._runId}get isOutlineBars(){return this._flg.isOutline}get pixelRatio(){return this._pixelRatio}get isRoundBars(){return this._flg.isRound}static get version(){return si}connectInput(e){const i=e instanceof HTMLMediaElement;if(!(i||e.connect))throw new ce(yi);const s=i?this.audioCtx.createMediaElementSource(e):e;return this._sources.includes(s)||(s.connect(this._input),this._sources.push(s)),s}connectOutput(e=this.audioCtx.destination){if(!this._outNodes.includes(e)&&(this._output.connect(e),this._outNodes.push(e),this._outNodes.length==1))for(const i of[0,1])this._analyzer[i].connect(this._chLayout==we&&!i?this._output:this._merger,0,i)}destroy(){if(!this._ready)return;const{audioCtx:e,canvas:i,_controller:s,_input:l,_merger:h,_observer:o,_ownContext:a,_splitter:d}=this;this._destroyed=!0,this._ready=!1,this.stop(),s.abort(),o&&o.disconnect(),this.onCanvasResize=null,this.onCanvasDraw=null,this._fsEl=null,this.disconnectInput(),this.disconnectOutput(),l.disconnect(),d.disconnect(),h.disconnect(),a&&e.close(),i.remove(),this._calcBars()}disconnectInput(e,i){e?Array.isArray(e)||(e=[e]):e=Array.from(this._sources);for(const s of e){const l=this._sources.indexOf(s);if(i&&s.mediaStream)for(const h of s.mediaStream.getAudioTracks())h.stop();l>=0&&(s.disconnect(this._input),this._sources.splice(l,1))}}disconnectOutput(e){if(!(e&&!this._outNodes.includes(e))&&(this._output.disconnect(e),this._outNodes=e?this._outNodes.filter(i=>i!==e):[],this._outNodes.length==0))for(const i of[0,1])this._analyzer[i].disconnect()}getBars(){return Array.from(this._bars,({posX:e,freq:i,freqLo:s,freqHi:l,hold:h,peak:o,value:a})=>({posX:e,freq:i,freqLo:s,freqHi:l,hold:h,peak:o,value:a}))}getEnergy(e,i){if(e===void 0)return this._energy.val;if(e!=+e){if(e=="peak")return this._energy.peak;const a={bass:[20,250],lowMid:[250,500],mid:[500,2e3],highMid:[2e3,4e3],treble:[4e3,16e3]};if(!a[e])return null;[e,i]=a[e]}const s=this._freqToBin(e),l=i?this._freqToBin(i):s,h=this._chLayout==we?1:2;let o=0;for(let a=0;a<h;a++)for(let d=s;d<=l;d++)o+=this._normalizedB(this._fftData[a][d]);return o/(l-s+1)/h}registerGradient(e,i){if(typeof e!="string"||e.trim().length==0)throw new ce(Li);if(typeof i!="object")throw new ce(Ri);const{colorStops:s}=i;if(!Array.isArray(s)||!s.length)throw new ce(bi);const l=s.length,h=o=>+o!=o||o<0||o>1;s.forEach((o,a)=>{const d=a/Math.max(1,l-1);typeof o!="object"?s[a]={pos:d,color:o}:h(o.pos)&&(o.pos=d),h(o.level)&&(s[a].level=1-a/l)}),s.sort((o,a)=>o.level<a.level?1:o.level>a.level?-1:0),s[0].level=1,this._gradients[e]={bgColor:i.bgColor||ni,dir:i.dir,colorStops:s},this._selectedGrads.includes(e)&&this._makeGrad()}setCanvasSize(e,i){this._width=e,this._height=i,this._setCanvas(st)}setFreqRange(e,i){if(e<1||i<1)throw new ce(rt);this._minFreq=Math.min(e,i),this.maxFreq=Math.max(e,i)}setLedParams(e){let i,s,l;e&&(i=e.maxLeds|0,s=+e.spaceV,l=+e.spaceH),this._ledParams=i>0&&s>0&&l>=0?[i,s,l]:void 0,this._calcBars()}setOptions(e){this._setProps(e)}setSensitivity(e,i){for(const s of[0,1])this._analyzer[s].minDecibels=Math.min(e,i),this._analyzer[s].maxDecibels=Math.max(e,i)}start(){this.toggleAnalyzer(!0)}stop(){this.toggleAnalyzer(!1)}toggleAnalyzer(e){const i=this.isOn;return e===void 0&&(e=!i),i&&!e?(cancelAnimationFrame(this._runId),this._runId=0):!i&&e&&!this._destroyed&&(this._frames=0,this._time=performance.now(),this._runId=requestAnimationFrame(s=>this._draw(s))),this.isOn}toggleFullscreen(){if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{const e=this._fsEl;if(!e)return;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}}_binToFreq(e){return e*this.audioCtx.sampleRate/this.fftSize||1}_calcBars(){const e=this._bars=[];if(!this._ready){this._flg={isAlpha:!1,isBands:!1,isLeds:!1,isLumi:!1,isOctaves:!1,isOutline:!1,isRound:!1,noLedGap:!1};return}const{_ansiBands:i,_barSpace:s,canvas:l,_chLayout:h,_maxFreq:o,_minFreq:a,_mirror:d,_mode:r,_radial:w,_reflexRatio:u}=this,A=l.width>>1,q=l.height>>1,x=h==ye&&!w,g=h==Ve,m=r%10!=0,$=m&&this._frequencyScale==Fe,G=this._showLeds&&m&&!w,v=this._lumiBars&&m&&!w,Z=this._alphaBars&&!v&&r!=Me,_e=this._outlineBars&&m&&!v&&!G,Q=this._roundBars&&m&&!v&&!G,y=h!=ye||u>0&&!v,ee=l.height-(x&&!G?.5:0)>>x,k=ee*(v||w?1:1-u)|0,J=l.width-A*(g||d!=0),t=x?l.height-ee*2:0,Y=A*(d==-1&&!g&&!w),Le=Math.min(l.width,l.height)*(h==ye?.375:.125)|0,X=Math.min(A,q),O=B=>e.push({...B,peak:[0,0],hold:[0],value:[0]}),T=B=>{const D=this._freqToBin(B,"floor"),L=this._binToFreq(D),S=this._binToFreq(D+1),F=Math.log2(B/L)/Math.log2(S/L);return[D,F]};let _,z,I;if($){const B=(C,H,ne)=>+C.toPrecision(ne?Math.max(H,1+Math.log10(C)|0):H),D=C=>{const H=[1,1.12,1.25,1.4,1.6,1.8,2,2.24,2.5,2.8,3.15,3.55,4,4.5,5,5.6,6.3,7.1,8,9,10],ne=Math.log10(C)|0,se=C/10**ne;let re=1;for(;re<H.length&&se>H[re];)re++;return se-H[re-1]<H[re]-se&&re--,(H[re]*10**(ne+5)|0)/1e5},L=[0,24,12,8,6,4,3,2,1][r],S=i?10**(3/(L*10)):2**(1/L),F=S**.5;let W=i?7.94328235/(L%2?1:F):ut;do{let C=W;const H=B(C/F,4,!0),ne=B(C*F,4,!0),[se,re]=T(H),[Oe,pe]=T(ne);i?C=L<4?D(C):B(C,C.toString()[0]<5?3:2):C=B(C,4,!0),C>=a&&O({posX:0,freq:C,freqLo:H,freqHi:ne,binLo:se,binHi:Oe,ratioLo:re,ratioHi:pe}),W*=S}while(W<=o);_=J/e.length,e.forEach((C,H)=>C.posX=Y+H*_);const N=e[0],R=e[e.length-1];z=this._freqScaling(N.freqLo),I=J/(this._freqScaling(R.freqHi)-z),N.freqLo<a&&(N.freqLo=a,[N.binLo,N.ratioLo]=T(a)),R.freqHi>o&&(R.freqHi=o,[R.binHi,R.ratioHi]=T(o))}else if(m){const B=[0,24,12,8,6,4,3,2,1][r]*10,D=L=>{switch(this._frequencyScale){case at:return 1960/(26.81/(L+.53)-1);case nt:return 700*(2**L-1);case He:return L}};_=J/B,z=this._freqScaling(a),I=J/(this._freqScaling(o)-z);for(let L=0,S=0;L<B;L++,S+=_){const F=D(z+S/I),W=D(z+(S+_/2)/I),N=D(z+(S+_)/I),[R,C]=T(F),[H,ne]=T(N);O({posX:Y+S,freq:W,freqLo:F,freqHi:N,binLo:R,binHi:H,ratioLo:C,ratioHi:ne})}}else{_=1,z=this._freqScaling(a),I=J/(this._freqScaling(o)-z);const B=this._freqToBin(a,"floor"),D=this._freqToBin(o);let L=-999;for(let S=B;S<=D;S++){const F=this._binToFreq(S),W=Y+Math.round(I*(this._freqScaling(F)-z));if(W>L)O({posX:W,freq:F,freqLo:F,freqHi:F,binLo:S,binHi:S,ratioLo:0,ratioHi:0}),L=W;else if(e.length){const N=e[e.length-1];N.binHi=S,N.freqHi=F,N.freq=(N.freqLo*F)**.5}}}let ie=0,U=0;if(G){const B=this._pixelRatio/(window.devicePixelRatio>1&&window.screen.height<=540?2:1),D=[[],[128,3,.45],[128,4,.225],[96,6,.225],[80,6,.225],[80,6,.125],[64,6,.125],[48,8,.125],[24,16,.125]],L=this._ledParams,[S,F,W]=L||D[r];let N,R=k;if(L){const C=2*B;let H;N=S+1;do N--,H=R/N/(1+F),U=H*F;while((H<C||U<C)&&N>1)}else{const C=540/F;U=Math.min(F*B,Math.max(2,R/C+.1|0))}y&&(R+=U),L||(N=Math.min(S,R/(U*2)|0)),ie=W>=1?W:_*W,this._leds=[N,ie,U,R/N-U]}const E=Math.min(_-1,s*(s>0&&s<1?_:1));m&&(_-=Math.max(G?ie:0,E)),e.forEach((B,D)=>{let L=B.posX,S=_;m&&(s==0&&!G?(L|=0,S|=0,D>0&&L>e[D-1].posX+e[D-1].width&&(L--,S++)):L+=Math.max(G?ie:0,E)/2,B.posX=L),B.barCenter=L+(_==1?0:S/2),B.width=S});const de=[];for(const B of[0,1]){const D=h==ye?(ee+t)*B:0,L=D+ee,S=D+k-(!G||y?0:U);de.push({channelTop:D,channelBottom:L,analyzerBottom:S})}this._aux={analyzerHeight:k,analyzerWidth:J,centerX:A,centerY:q,channelCoords:de,channelHeight:ee,channelGap:t,initialX:Y,innerRadius:Le,outerRadius:X,scaleMin:z,unitWidth:I},this._flg={isAlpha:Z,isBands:m,isLeds:G,isLumi:v,isOctaves:$,isOutline:_e,isRound:Q,noLedGap:y},this._createScales()}_createScales(){if(!this._ready)return;const{analyzerWidth:e,initialX:i,innerRadius:s,scaleMin:l,unitWidth:h}=this._aux,{canvas:o,_frequencyScale:a,_mirror:d,_noteLabels:r,_radial:w,_scaleX:u,_scaleR:A}=this,q=u.canvas,x=A.canvas,g=[],m=this._chLayout==Ve,$=this._chLayout==ye,G=["C",,"D",,"E","F",,"G",,"A",,"B"],v=Math.min(o.width,o.height)/34|0,Z=q.height>>1,_e=v>>1,Q=Z*(r?.7:1.5),y=_e*(r?1:2),ee=2**(1/12);if(!r&&(this._ansiBands||a!=Fe))g.push(16,31.5,63,125,250,500,1e3,2e3,4e3),a==He?g.push(6e3,8e3,1e4,12e3,14e3,16e3,18e3,2e4,22e3):g.push(8e3,16e3);else{let X=ut;for(let O=-1;O<11;O++)for(let T=0;T<12;T++){if(X>=this._minFreq&&X<=this._maxFreq){const _=G[T],z=_=="C";(_&&r&&!d&&!m||z)&&g.push(r?[X,_+(z?O:"")]:X)}X*=ee}}x.width=x.height=(s<<1)+$*v;const k=x.width>>1,J=k-v*.7,t=(X,O)=>{const T=ke*(X/o.width),_=T-it,z=J*Math.cos(_),I=J*Math.sin(_);A.save(),A.translate(k+z,k+I),A.rotate(T),A.fillText(O,0,0),A.restore()};q.width|=0,u.fillStyle=A.strokeStyle=di,u.fillRect(0,0,q.width,q.height),A.arc(k,k,k-v/2,0,ke),A.lineWidth=v,A.stroke(),u.fillStyle=A.fillStyle=Et,u.font=`${Z}px ${$e}`,A.font=`${_e}px ${$e}`,u.textAlign=A.textAlign="center";let Y=-Q/4,Le=-y;for(const X of g){const[O,T]=Array.isArray(X)?X:[X,X<1e3?X|0:`${(X/100|0)/10}k`],_=h*(this._freqScaling(O)-l),z=q.height*.75,I=T[0]=="C",ie=Z*(r&&!d&&!m?I?1.2:.6:3);if(u.fillStyle=A.fillStyle=I&&!d&&!m?fi:Et,r){const U=a==Fe,E=a==He;let de=["C"];if((U||O>2e3||!E&&O>250||(!w||$)&&(!E&&O>125||O>1e3))&&de.push("G"),(U||O>4e3||!E&&O>500||(!w||$)&&(!E&&O>250||O>2e3))&&de.push("E"),(E&&O>4e3||(!w||$)&&(U||O>2e3||!E&&O>500))&&de.push("D","F","A","B"),!de.includes(T[0]))continue}_>=Y+Q/2&&_<=e&&(u.fillText(T,m&&d==-1?e-_:i+_,z,ie),(m||d&&(_>Q||d==1))&&u.fillText(T,m&&d!=1?e+_:(i||o.width)-_,z,ie),Y=_+Math.min(ie,u.measureText(T).width)/2),_>=Le+y&&_<e-y&&(t(m&&d==1?e-_:_,T),(m||d&&(_>y||d==1))&&t(m&&d!=-1?e+_:-_,T),Le=_)}}_draw(e){this._runId=requestAnimationFrame(n=>this._draw(n));const i=e-this._time,s=e-this._last,l=this._maxFPS?975/this._maxFPS:0;if(s<l)return;this._last=e-(l?s%l:0),this._frames++,i>=1e3&&(this._fps=this._frames/i*1e3,this._frames=0,this._time=e);const{isAlpha:h,isBands:o,isLeds:a,isLumi:d,isOctaves:r,isOutline:w,isRound:u,noLedGap:A}=this._flg,{analyzerHeight:q,centerX:x,centerY:g,channelCoords:m,channelHeight:$,channelGap:G,initialX:v,innerRadius:Z,outerRadius:_e}=this._aux,{_bars:Q,canvas:y,_canvasGradients:ee,_chLayout:k,_colorMode:J,_ctx:t,_energy:Y,fillAlpha:Le,_fps:X,_linearAmplitude:O,_lineWidth:T,maxDecibels:_,minDecibels:z,_mirror:I,_mode:ie,overlay:U,_radial:E,showBgColor:de,showPeaks:B,useCanvas:D,_weightingFilter:L}=this,S=this._scaleX.canvas,F=this._scaleR.canvas,W=X>>1,N=k==gt,R=k==Ve,C=k==ye,H=k==we,ne=a&&this._trueLeds&&J==Ue,se=E?y.width:this._aux.analyzerWidth,re=v+se,Oe=B&&this._peakLine&&ie==Me,pe=E?_e-Z:q,[Dt,qi,qe,je]=this._leds||[];Y.val>0&&(this._spinAngle+=this._spinSpeed*ke/(60*X));const Nt=n=>{if(this._reflexRatio>0&&!d&&!E){let b,ue;this.reflexFit||C?(b=C&&n==0?$+G:0,ue=$-q):(b=y.height-q*2,ue=q),t.save(),t.globalAlpha=this.reflexAlpha,this.reflexBright!=1&&(t.filter=`brightness(${this.reflexBright})`),t.setTransform(1,0,0,-1,0,y.height),t.drawImage(y,0,m[n].channelTop,y.width,q,0,b,y.width,ue),t.restore()}},kt=()=>{this.showScaleX&&(E?(t.save(),t.translate(x,g),this._spinSpeed&&t.rotate(this._spinAngle+it),t.drawImage(F,-F.width>>1,-F.width>>1),t.restore()):t.drawImage(S,0,y.height-S.height))},Mt=n=>{const b=n**2,ue=424.36,j=11599.29,Pe=25122.25,Re=544496.41,me=148693636,xe=Ae=>20*Math.log10(Ae);switch(L){case Rt:const Ae=me*b**2/((b+ue)*Math.sqrt((b+j)*(b+Re))*(b+me));return 2+xe(Ae);case bt:const Ee=me*b*n/((b+ue)*Math.sqrt(b+Pe)*(b+me));return .17+xe(Ee);case vt:const Je=me*b/((b+ue)*(b+me));return .06+xe(Je);case St:const Xe=((103791848e-2-b)**2+108076816e-2*b)/((9837328-b)**2+11723776*b),Ze=n/68966888496476e-18*Math.sqrt(Xe/((b+79919.29)*(b+1345600)));return xe(Ze);case xt:const We=-4737338981378384e-39*n**6+2043828333606125e-30*n**4-1363894795463638e-22*b+1,Ce=1306612257412824e-34*n**5-2118150887518656e-26*n**3+.0005559488023498642*n,oe=.0001246332637532143*n/Math.hypot(We,Ce);return 18.2+xe(oe)}return 0},Ke=(n,b,ue)=>{t.beginPath(),t.moveTo(n,b),t.lineTo(n,ue),t.stroke()},Qe=n=>{if(n&&T){const b=t.globalAlpha;t.globalAlpha=1,t.stroke(),t.globalAlpha=b}},Se=n=>Math.max(0,(n*Dt|0)*(je+qe)-qe),Ft=n=>{Y.val=n,Y.peak>0&&(Y.hold--,Y.hold<0&&(Y.peak+=Y.hold/(W*W/2))),n>=Y.peak&&(Y.peak=n,Y.hold=W)};U&&t.clearRect(0,0,y.width,y.height);let lt=0;const ht=Q.length,ct=H?1:2;for(let n=0;n<ct;n++){const{channelTop:b,channelBottom:ue,analyzerBottom:j}=m[n],Pe=this._gradients[this._selectedGrads[n]],Re=Pe.colorStops,me=Re.length,xe=!de||a&&!U?"#000":Pe.bgColor,Ae=C&&E&&n?-1:1,Ee=!n&&I==-1||n&&I==1,Je=!R||n&&I!=1?0:se>>(n||!Ee),Xe=R&&Ee?-1:1,Ze=()=>{const c=S.height,p=c>>1,f=O?100:_,M=O?0:z,V=O?20:5,ae=q/(f-M),ge=I!=-1&&(!R||n==0||I==1),be=I!=1&&(!R||n!=I);t.save(),t.fillStyle=Ct,t.font=`${p}px ${$e}`,t.textAlign="right",t.lineWidth=1;for(let ve=f;ve>M;ve-=V){const De=b+(f-ve)*ae,K=ve%2==0|0;if(K){const te=De+p*(De==b?.8:.35);ge&&t.fillText(ve,c*.85,te),be&&t.fillText(ve,(R?se:y.width)-c*.1,te),t.strokeStyle=Ct,t.setLineDash([2,4]),t.lineDashOffset=0}else t.strokeStyle=_i,t.setLineDash([2,8]),t.lineDashOffset=1;t.beginPath(),t.moveTo(v+c*K*ge,~~De+.5),t.lineTo(re-c*K*be,~~De+.5),t.stroke()}t.restore()},We=(c,p)=>{const f=fe[c]+(c<fe.length-1?(fe[c+1]-fe[c])*p:0);return isNaN(f)?-1/0:f},Ce=(c,p=Xe)=>p*ke*((c+Je)/y.width)+this._spinAngle,oe=(c,p,f)=>{const M=Z+p*Ae,V=Ce(c,f);return[x+M*Math.cos(V),g+M*Math.sin(V)]},et=(c,p,f,M,V)=>{t.beginPath();for(const ae of I&&!R?[1,-1]:[Xe]){const[ge,be]=u?[Ce(c,ae),Ce(c+f,ae)]:[];t.moveTo(...oe(c,p,ae)),t.lineTo(...oe(c,p+M,ae)),u?t.arc(x,g,Z+(p+M)*Ae,ge,be,ae!=1):t.lineTo(...oe(c+f,p+M,ae)),t.lineTo(...oe(c+f,p,ae)),u&&!V&&t.arc(x,g,Z+p*Ae,be,ge,ae==1)}Qe(V),t.fill()},tt=(c=0,p=0)=>{let f;if(J==Ue&&!ne||ie==Me)f=ee[n];else{const M=J==pt?p%me:Re.findLastIndex(V=>a?Se(c)<=Se(V.level):c<=V.level);f=Re[M].color}t.fillStyle=t.strokeStyle=f};if(D){if(R&&!E){const c=se*(n+Ee),p=Ee?-1:1;t.setTransform(p,0,0,1,c,0)}if((!U||de)&&(U&&(t.globalAlpha=this.bgAlpha),t.fillStyle=xe,(n==0||!E&&!N)&&t.fillRect(v,b-G,se,(U&&this.reflexAlpha==1?q:$)+G),t.globalAlpha=1),this.showScaleY&&!d&&!E&&(n==0||!N)&&Ze(),a?(t.setLineDash([je,qe]),t.lineWidth=Q[0].width):t.lineWidth=w?Math.min(T,Q[0].width/2):T,t.save(),!E){const c=new Path2D;c.rect(0,b,y.width,q),t.clip(c)}}let fe=this._fftData[n];this._analyzer[n].getFloatFrequencyData(fe),L&&(fe=fe.map((c,p)=>c+Mt(this._binToFreq(p)))),t.beginPath();let ze=[];for(let c=0;c<ht;c++){const p=Q[c],{posX:f,barCenter:M,width:V,freq:ae,binLo:ge,binHi:be,ratioLo:ve,ratioHi:De}=p;let K=Math.max(We(ge,ve),We(be,De));for(let P=ge+1;P<be;P++)fe[P]>K&&(K=fe[P]);if(K=this._normalizedB(K),p.value[n]=K,lt+=K,p.peak[n]>0&&(p.hold[n]--,p.hold[n]<0&&(p.peak[n]+=p.hold[n]/(W*W/2))),K>=p.peak[n]&&(p.peak[n]=K,p.hold[n]=W),!D)continue;d||h?t.globalAlpha=K:w&&(t.globalAlpha=Le),tt(K,c);const te=d?pe:a?Se(K):K*pe|0;if(ie==Me){const P=c?0:(this._normalizedB(fe[Q[1].binLo])*pe+te)/2;if(E){if(c==0&&(R&&t.moveTo(...oe(0,0)),t.lineTo(...oe(0,f<0?P:te))),f>=0){const he=[f,te];t.lineTo(...oe(...he)),ze.push(he)}}else{if(c==0)if(I==-1&&!R)t.moveTo(v,j-(f<v?P:te));else{const he=ge?this._normalizedB(fe[ge-1])*pe:te;t.moveTo(v-T,j-he)}(R||I!=-1||f>=v)&&t.lineTo(f,j-te)}}else if(a){if(de&&!U&&(n==0||!N)){const P=t.globalAlpha;t.strokeStyle=oi,t.globalAlpha=1,Ke(M,b,j),t.strokeStyle=t.fillStyle,t.globalAlpha=P}if(ne){const P=d?0:Re.findLastIndex(Te=>Se(K)<=Se(Te.level));let he=j;for(let Te=me-1;Te>=P;Te--){t.strokeStyle=Re[Te].color;let dt=j-(Te==P?te:Se(Re[Te].level));Ke(M,he,dt),he=dt-qe}}else Ke(M,j,j-te)}else if(f>=v)if(E)et(f,0,V,te,w);else if(u){const P=V/2,he=j+P;t.beginPath(),t.moveTo(f,he),t.lineTo(f,he-te),t.arc(M,he-te,P,ot,ke),t.lineTo(f+V,he),Qe(w),t.fill()}else{const P=w?t.lineWidth:0;t.beginPath(),t.rect(f,j+P,V,-te-P),Qe(w),t.fill()}const Ne=p.peak[n];if(Ne>0&&B&&!Oe&&!d&&f>=v&&f<re)if(w&&T>0?t.globalAlpha=1:h&&(t.globalAlpha=Ne),(J==mt||ne)&&tt(Ne),a){const P=Se(Ne);P>=qe&&t.fillRect(f,j-P,V,je)}else E?ie!=Me&&et(f,Ne*pe,V,-2):t.fillRect(f,j-Ne*pe,V,2)}if(D){if(t.globalAlpha=1,ie==Me){if(tt(),E&&!R){if(I){let c;for(;c=ze.pop();)t.lineTo(...oe(...c,-1))}t.closePath()}if(T>0&&t.stroke(),Le>0){if(E){const c=R?Ce(se>>1):0,p=R?Ce(se):ke;t.moveTo(...oe(R?se>>1:0,0)),t.arc(x,g,Z,c,p,R?!Ee:!0)}else t.lineTo(re,j),t.lineTo(v,j);t.globalAlpha=Le,t.fill(),t.globalAlpha=1}if((Oe||E&&B)&&(ze=[],t.beginPath(),Q.forEach((c,p)=>{let f=c.posX,M=c.peak[n],V=p?"lineTo":"moveTo";if(E&&f<0){const ae=Q[p+1];M=vi(f,M,ae.posX,ae.peak[n],0),f=0}M*=pe,Oe?(t[V](...E?oe(f,M):[f,j-M]),E&&I&&!R&&ze.push([f,M])):M>0&&et(f,M,1,-2)}),Oe)){let c;for(;c=ze.pop();)t.lineTo(...oe(...c,-1));t.lineWidth=1,t.stroke()}}t.restore(),R&&!E&&t.setTransform(1,0,0,1,0,0),(!R&&!N||n)&&Nt(n)}}if(Ft(lt/(ht<<ct-1)),D&&(I&&!E&&!R&&(t.setTransform(-1,0,0,1,y.width-v,0),t.drawImage(y,v,0,x,y.height,0,0,x,y.height),t.setTransform(1,0,0,1,0,0)),t.setLineDash([]),kt()),this.showFPS){const n=S.height;t.font=`bold ${n}px ${$e}`,t.fillStyle=ri,t.textAlign="right",t.fillText(Math.round(X),y.width-n,n*2)}this.onCanvasDraw&&(t.save(),t.fillStyle=t.strokeStyle=ee[0],this.onCanvasDraw(this,{timestamp:e,_canvasGradients:ee}),t.restore())}_freqScaling(e){switch(this._frequencyScale){case Fe:return Math.log2(e);case at:return 26.81*e/(1960+e)-.53;case nt:return Math.log2(1+e/700);case He:return e}}_freqToBin(e,i="round"){const s=this._analyzer[0].frequencyBinCount-1,l=Math[i](e*this.fftSize/this.audioCtx.sampleRate);return l<s?l:s}_makeGrad(){if(!this._ready)return;const{canvas:e,_ctx:i,_radial:s,_reflexRatio:l}=this,{analyzerWidth:h,centerX:o,centerY:a,initialX:d,innerRadius:r,outerRadius:w}=this._aux,{isLumi:u}=this._flg,A=this._chLayout==ye,q=1-l,x=u?e.height:e.height*(1-l*!A)|0;for(const g of[0,1]){const m=this._gradients[this._selectedGrads[g]],$=m.colorStops,G=m.dir=="h";let v;if(s?v=i.createRadialGradient(o,a,w,o,a,r-(w-r)*A):v=i.createLinearGradient(...G?[d,0,d+h,0]:[0,0,0,x]),$){const Z=A&&!this._splitGradient&&(!G||s);for(let _e=0;_e<1+Z;_e++){const Q=$.length-1;$.forEach((y,ee)=>{let k=y.pos;if(Z&&(k/=2),A&&!u&&!s&&!G&&(k*=q,!Z&&k>.5*q&&(k+=.5*l)),_e==1)if(s||u){const J=Q-ee;y=$[J],k=1-y.pos/2}else ee==0&&k>0&&v.addColorStop(.5,y.color),k+=.5;v.addColorStop(k,y.color),A&&ee==Q&&k<.5&&v.addColorStop(.5,y.color)})}}this._canvasGradients[g]=v}}_normalizedB(e){const i=this._linearAmplitude,s=i?1/this._linearBoost:1,l=(d,r,w)=>d<=r?r:d>=w?w:d,h=d=>10**(d/20);let o=this.maxDecibels,a=this.minDecibels;return i&&(o=h(o),a=h(a),e=h(e)**s),l((e-a)/(o-a)**s,0,1)}_setCanvas(e){if(!this._ready)return;const{canvas:i,_ctx:s}=this,l=this._scaleX.canvas,h=window.devicePixelRatio/(this._loRes+1);let o=window.screen.width*h,a=window.screen.height*h;Math.abs(window.orientation)==90&&o<a&&([o,a]=[a,o]);const d=this.isFullscreen,r=d&&this._fsEl==i,w=r?o:(this._width||this._container.clientWidth||this._defaultWidth)*h|0,u=r?a:(this._height||this._container.clientHeight||this._defaultHeight)*h|0;this._pixelRatio=h,this._fsWidth=o,this._fsHeight=a,!(i.width==w&&i.height==u)&&(i.width=w,i.height=u,this.overlay||(s.fillStyle="#000",s.fillRect(0,0,w,u)),s.lineJoin="bevel",l.width=w,l.height=Math.max(20*h,Math.min(w,u)/32|0),this._calcBars(),this._makeGrad(),this._fsStatus!==void 0&&this._fsStatus!==d&&(e=At),this._fsStatus=d,this.onCanvasResize&&this.onCanvasResize(e,this))}_setGradient(e,i){if(!this._gradients.hasOwnProperty(e))throw new ce(pi,e);[0,1].includes(i)||(this._selectedGrads[1]=e,i=0),this._selectedGrads[i]=e,this._makeGrad()}_setProps(e,i){const s={alphaBars:!1,ansiBands:!1,barSpace:.1,bgAlpha:.7,channelLayout:we,colorMode:Ue,fftSize:8192,fillAlpha:1,frequencyScale:Fe,gradient:Bt[0][0],ledBars:!1,linearAmplitude:!1,linearBoost:1,lineWidth:0,loRes:!1,lumiBars:!1,maxDecibels:-25,maxFPS:0,maxFreq:22e3,minDecibels:-85,minFreq:20,mirror:0,mode:0,noteLabels:!1,outlineBars:!1,overlay:!1,peakLine:!1,radial:!1,reflexAlpha:.15,reflexBright:1,reflexFit:!0,reflexRatio:0,roundBars:!1,showBgColor:!0,showFPS:!1,showPeaks:!0,showScaleX:!0,showScaleY:!1,smoothing:.5,spinSpeed:0,splitGradient:!1,start:!0,trueLeds:!1,useCanvas:!0,volume:1,weightingFilter:Lt},l=["onCanvasDraw","onCanvasResize"],h=["gradientLeft","gradientRight","height","width","stereo"],o=Object.keys(s).filter(a=>a!="start").concat(l,h);(i||e===void 0)&&(e={...s,...e});for(const a of Object.keys(e))l.includes(a)&&typeof e[a]!="function"?this[a]=void 0:o.includes(a)&&(this[a]=e[a]);e.start!==void 0&&this.toggleAnalyzer(e.start)}}const xi={class:"flex flex-col justify-center text-white"},Ai={class:"fullscreen-container rounded-3xl overflow-hidden m-4",id:"screen"},Ei=["width","height"],Ci={class:"absolute top-4 left-4 text-xl select-none"},Ti={key:0,class:"i-la-play"},Bi={key:1,class:"i-la-pause"},Ii={key:0,class:"i-la-arrow-left"},Oi={key:1,class:"i-la-arrow-down"},Di=Ie("div",{class:"i-la-trash-alt"},null,-1),Ni=[Di],ki={__name:"PitchSpectrogram",setup(le){const{mic:e,input:i}=Pt(),s=Xt(!1);ft(" ",x=>{s.value=!s.value,x.preventDefault()}),ft("Enter",x=>{d(),x.preventDefault()});let l,h,o,a;function d(){h.fillStyle="#000",h.fillRect(0,0,r.width,r.height)}const r=Wt({initiated:!1,width:800,height:240,speed:Vt(()=>Math.floor(r.speedCount/100)),speedCount:ii(100,100,300),vertical:!0});function w(x){x.tap&&(s.value=!s.value),r.speedCount-=x.delta[0]/2}Ut(()=>{qt(),l=document.getElementById("spectrogram"),h=l.getContext("2d"),o=document.createElement("canvas"),a=o.getContext("2d"),o.width=r.width,o.height=r.height,h.fillStyle="#000",h.fillRect(0,0,r.width,r.height)});let u;function A(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(()=>{r.initiated=!0,u=new Si(null,{mode:1,connectSpeakers:!1,volume:0,useCanvas:!1,source:zt.meter,onCanvasDraw(x){if(s.value)return;a.drawImage(l,0,0,r.width,r.height);let g=x.getBars();for(let m=0;m<g.length;m++)h.fillStyle=q((g[m].freqLo+g[m].freqHi)/2,g[m].value[0]),r.vertical?h.fillRect(m*(r.width/g.length),0,r.width/g.length,r.speed):h.fillRect(r.width-r.speed,r.height-(m+1)*(r.height/g.length),r.speed,r.height/g.length);r.vertical?h.translate(0,r.speed):h.translate(-r.speed,0),h.drawImage(o,0,0,r.width,r.height),h.setTransform(1,0,0,1,0,0)}}),e.open=!0,u.connectInput(i)}).catch(x=>{console.log("mic denied",x)})}function q(x,g){return`hsl(${Ht(x)*30}, ${g*100}%, ${g*80}%)`}return(x,g)=>{const m=Gt,$=$t("drag");return Be(),Ge("div",xi,[Ie("div",Ai,[Yt(Ie("canvas",{class:"h-full min-h-30em w-full rounded-md cursor-pointer",id:"spectrogram",width:r.width,height:r.height},null,8,Ei),[[$,w]]),r.initiated?Kt("",!0):(Be(),jt(m,{key:0,class:"absolute",onClick:g[0]||(g[0]=G=>A())})),Ie("div",Ci,"x"+Qt(r.speed),1),Ie("button",{class:"absolute bottom-4 left-4 text-xl select-none cursor-pointer",onMousedown:g[1]||(g[1]=G=>s.value=!s.value)},[s.value?(Be(),Ge("div",Ti)):(Be(),Ge("div",Bi))],32),Ie("button",{class:"absolute bottom-4 right-4 text-xl select-none cursor-pointer",onMousedown:g[2]||(g[2]=G=>r.vertical=!r.vertical)},[r.vertical?(Be(),Ge("div",Oi)):(Be(),Ge("div",Ii))],32),Ie("button",{class:"absolute top-4 right-4 text-xl select-none cursor-pointer",onMousedown:g[3]||(g[3]=G=>d())},Ni,32)])])}}},ji=JSON.parse('{"title":"Spectrogram","description":"2.5D representation on frequency domain in time","frontmatter":{"title":"Spectrogram","description":"2.5D representation on frequency domain in time","date":"2022-06-16T00:00:00.000Z","cover":"spectrogram.png","usefulLinks":["https://codepen.io/hvianna/pen/ZEKWWJb","https://www.npmjs.com/package/audiomotion-analyzer","https://github.com/ListeningToWaves/SpectrogramTesting/blob/master/src/components/spectrogram.js"]},"headers":[],"relativePath":"practice/pitch/spectrogram/index.md","filePath":"practice/pitch/spectrogram/index.md","lastUpdated":1693938056000}'),Mi={name:"practice/pitch/spectrogram/index.md"},Fi=ti("",3);function Gi(le,e,i,s,l,h){const o=ki,a=Zt("client-only");return Be(),Ge("div",null,[_t(a,null,{default:ei(()=>[_t(o,{class:"mb-8"})]),_:1}),Fi])}const Ki=Jt(Mi,[["render",Gi]]);export{ji as __pageData,Ki as default};
