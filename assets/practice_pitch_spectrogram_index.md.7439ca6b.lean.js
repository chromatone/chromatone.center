import{_ as Gt}from"./chunks/ControlStart.169ed1a4.js";import{i as qt,m as zt}from"./chunks/audio.63c56e5f.js";import{b as Ht}from"./chunks/calculations.97c9b876.js";import{u as Pt}from"./chunks/mic.9346757b.js";import{k as Xt,V as ft,C as Wt,i as Vt,j as Ut,m as $t,o as ze,c as Ye,a as Me,n as Yt,f as jt,d as Kt,t as Qt,_ as Jt,D as Zt,g as _t,z as ei,b as ti}from"./chunks/framework.7e580a04.js";import{u as ii}from"./chunks/index.b4e3491a.js";import"./chunks/UserMedia.33ab5181.js";import"./chunks/Subtract.cbe15ceb.js";import"./chunks/OnePoleFilter.77f5e9bf.js";/**!
 * audioMotion-analyzer
 * High-resolution real-time graphic audio spectrum analyzer JS module
 *
 * @version 4.3.0
 * @author  Henrique Avila Vianna <hvianna@gmail.com> <https://henriquevianna.com>
 * @license AGPL-3.0-or-later
 */const si="4.3.0",ot=Math.PI,De=2*ot,it=ot/2,ut=8.17579892,gt="dual-combined",We="dual-horizontal",we="single",Le="dual-vertical",pt="bar-index",mt="bar-level",Ve="gradient",wt=60,Lt="click",ai="fullscreenchange",Ot="resize",ni="#111",yt="",Rt="A",bt="B",St="C",vt="D",At="468",Ue="sans-serif",ri="#0f0",oi="#7f7f7f22",Ne=10,li="create",Et="fschange",hi="lores",ci=Ot,st="user",di="#000c",xt="#fff",fi="#4f4",Ct="#888",_i="#555",at="bark",qe="linear",ke="log",nt="mel",Tt=["#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b"],Bt=[["classic",{colorStops:["red",{color:"yellow",level:.85,pos:.6},{color:"lime",level:.475}]}],["prism",{colorStops:Tt}],["rainbow",{dir:"h",colorStops:["#817",...Tt,"#639"]}],["orangered",{bgColor:"#3e2f29",colorStops:["OrangeRed"]}],["steelblue",{bgColor:"#222c35",colorStops:["SteelBlue"]}]],ui=["ERR_AUDIO_CONTEXT_FAIL","Could not create audio context. Web Audio API not supported?"],gi=["ERR_INVALID_AUDIO_CONTEXT","Provided audio context is not valid"],pi=["ERR_UNKNOWN_GRADIENT","Unknown gradient"],rt=["ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1"],mi=["ERR_INVALID_MODE","Invalid mode"],wi=["ERR_REFLEX_OUT_OF_RANGE","Reflex ratio must be >= 0 and < 1"],Li=["ERR_INVALID_AUDIO_SOURCE","Audio source must be an instance of HTMLMediaElement or AudioNode"],yi=["ERR_GRADIENT_INVALID_NAME","Gradient name must be a non-empty string"],Ri=["ERR_GRADIENT_NOT_AN_OBJECT","Gradient options must be an object"],bi=["ERR_GRADIENT_MISSING_COLOR","Gradient colorStops must be a non-empty array"];class ce extends Error{constructor(e,i){const[s,o]=e;super(o+(i!==void 0?`: ${i}`:"")),this.name="AudioMotionError",this.code=s}}const It=(le,e)=>console.warn(`${le} is deprecated. Use ${e} instead.`),$e=(le,e,i="toLowerCase")=>e[Math.max(0,e.indexOf((""+le)[i]()))],Si=(le,e,i,s,o)=>e+(s-e)*(o-le)/(i-le);Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(le){let e=this.length;for(;e-- >0;)if(le(this[e]))return e;return-1});class vi{constructor(e,i={}){this._ready=!1,this._aux={},this._canvasGradients=[],this._destroyed=!1,this._energy={val:0,peak:0,hold:0},this._flg={},this._fps=0,this._gradients={},this._last=0,this._outNodes=[],this._ownContext=!1,this._selectedGrads=[],this._sources=[];for(const[u,E]of Bt)this.registerGradient(u,E);this._container=e||document.body,this._defaultWidth=this._container.clientWidth||640,this._defaultHeight=this._container.clientHeight||270;let s;if(!(i.source&&(s=i.source.context))){if(!(s=i.audioCtx))try{s=new(window.AudioContext||window.webkitAudioContext),this._ownContext=!0}catch{throw new ce(ui)}}if(!s.createGain)throw new ce(gi);const o=this._analyzer=[s.createAnalyser(),s.createAnalyser()],l=this._splitter=s.createChannelSplitter(2),r=this._merger=s.createChannelMerger(2);this._input=s.createGain(),this._output=s.createGain(),i.source&&this.connectInput(i.source);for(const u of[0,1])l.connect(o[u],u);r.connect(this._output),i.connectSpeakers!==!1&&this.connectOutput();const a=document.createElement("canvas");a.style="max-width: 100%;",this._ctx=a.getContext("2d");for(const u of["_scaleX","_scaleR"])this[u]=document.createElement("canvas").getContext("2d");this._fsEl=i.fsElement||a;const d=()=>{this._fsTimeout||(this._fsTimeout=window.setTimeout(()=>{this._fsChanging||(this._setCanvas(ci),this._fsTimeout=0)},wt))};window.ResizeObserver&&(this._observer=new ResizeObserver(d),this._observer.observe(this._container)),this._controller=new AbortController;const h=this._controller.signal;window.addEventListener(Ot,d,{signal:h}),a.addEventListener(ai,()=>{this._fsChanging=!0,this._fsTimeout&&window.clearTimeout(this._fsTimeout),this._setCanvas(Et),this._fsTimeout=window.setTimeout(()=>{this._fsChanging=!1,this._fsTimeout=0},wt)},{signal:h});const p=()=>{s.state=="suspended"&&s.resume(),window.removeEventListener(Lt,p)};window.addEventListener(Lt,p),document.addEventListener("visibilitychange",()=>{document.visibilityState!="hidden"&&(this._frames=0,this._time=performance.now())},{signal:h}),this._setProps(i,!0),this.useCanvas&&this._container.appendChild(a),this._ready=!0,this._setCanvas(li)}get alphaBars(){return this._alphaBars}set alphaBars(e){this._alphaBars=!!e,this._calcBars()}get ansiBands(){return this._ansiBands}set ansiBands(e){this._ansiBands=!!e,this._calcBars()}get barSpace(){return this._barSpace}set barSpace(e){this._barSpace=+e||0,this._calcBars()}get channelLayout(){return this._chLayout}set channelLayout(e){this._chLayout=$e(e,[we,We,Le,gt]),this._input.disconnect(),this._input.connect(this._chLayout!=we?this._splitter:this._analyzer[0]),this._analyzer[0].disconnect(),this._outNodes.length&&this._analyzer[0].connect(this._chLayout!=we?this._merger:this._output),this._calcBars(),this._makeGrad()}get colorMode(){return this._colorMode}set colorMode(e){this._colorMode=$e(e,[Ve,pt,mt])}get fftSize(){return this._analyzer[0].fftSize}set fftSize(e){for(const s of[0,1])this._analyzer[s].fftSize=e;const i=this._analyzer[0].frequencyBinCount;this._fftData=[new Float32Array(i),new Float32Array(i)],this._calcBars()}get frequencyScale(){return this._frequencyScale}set frequencyScale(e){this._frequencyScale=$e(e,[ke,at,nt,qe]),this._calcBars()}get gradient(){return this._selectedGrads[0]}set gradient(e){this._setGradient(e)}get gradientLeft(){return this._selectedGrads[0]}set gradientLeft(e){this._setGradient(e,0)}get gradientRight(){return this._selectedGrads[1]}set gradientRight(e){this._setGradient(e,1)}get height(){return this._height}set height(e){this._height=e,this._setCanvas(st)}get ledBars(){return this._showLeds}set ledBars(e){this._showLeds=!!e,this._calcBars()}get linearAmplitude(){return this._linearAmplitude}set linearAmplitude(e){this._linearAmplitude=!!e}get linearBoost(){return this._linearBoost}set linearBoost(e){this._linearBoost=e>=1?+e:1}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=+e||0}get loRes(){return this._loRes}set loRes(e){this._loRes=!!e,this._setCanvas(hi)}get lumiBars(){return this._lumiBars}set lumiBars(e){this._lumiBars=!!e,this._calcBars(),this._makeGrad()}get maxDecibels(){return this._analyzer[0].maxDecibels}set maxDecibels(e){for(const i of[0,1])this._analyzer[i].maxDecibels=e}get maxFPS(){return this._maxFPS}set maxFPS(e){this._maxFPS=e<0?0:+e||0}get maxFreq(){return this._maxFreq}set maxFreq(e){if(e<1)throw new ce(rt);this._maxFreq=Math.min(e,this.audioCtx.sampleRate/2),this._calcBars()}get minDecibels(){return this._analyzer[0].minDecibels}set minDecibels(e){for(const i of[0,1])this._analyzer[i].minDecibels=e}get minFreq(){return this._minFreq}set minFreq(e){if(e<1)throw new ce(rt);this._minFreq=+e,this._calcBars()}get mirror(){return this._mirror}set mirror(e){this._mirror=Math.sign(e)|0,this._calcBars(),this._makeGrad()}get mode(){return this._mode}set mode(e){const i=e|0;if(i>=0&&i<=10&&i!=9)this._mode=i,this._calcBars(),this._makeGrad();else throw new ce(mi,e)}get noteLabels(){return this._noteLabels}set noteLabels(e){this._noteLabels=!!e,this._createScales()}get outlineBars(){return this._outlineBars}set outlineBars(e){this._outlineBars=!!e,this._calcBars()}get peakLine(){return this._peakLine}set peakLine(e){this._peakLine=!!e}get radial(){return this._radial}set radial(e){this._radial=!!e,this._calcBars(),this._makeGrad()}get reflexRatio(){return this._reflexRatio}set reflexRatio(e){if(e=+e||0,e<0||e>=1)throw new ce(wi);this._reflexRatio=e,this._calcBars(),this._makeGrad()}get roundBars(){return this._roundBars}set roundBars(e){this._roundBars=!!e,this._calcBars()}get smoothing(){return this._analyzer[0].smoothingTimeConstant}set smoothing(e){for(const i of[0,1])this._analyzer[i].smoothingTimeConstant=e}get spinSpeed(){return this._spinSpeed}set spinSpeed(e){e=+e||0,(this._spinSpeed===void 0||e==0)&&(this._spinAngle=-it),this._spinSpeed=e}get splitGradient(){return this._splitGradient}set splitGradient(e){this._splitGradient=!!e,this._makeGrad()}get stereo(){return It("stereo","channelLayout"),this._chLayout!=we}set stereo(e){It("stereo","channelLayout"),this.channelLayout=e?Le:we}get trueLeds(){return this._trueLeds}set trueLeds(e){this._trueLeds=!!e}get volume(){return this._output.gain.value}set volume(e){this._output.gain.value=e}get weightingFilter(){return this._weightingFilter}set weightingFilter(e){this._weightingFilter=$e(e,[yt,Rt,bt,St,vt,At],"toUpperCase")}get width(){return this._width}set width(e){this._width=e,this._setCanvas(st)}get audioCtx(){return this._input.context}get canvas(){return this._ctx.canvas}get canvasCtx(){return this._ctx}get connectedSources(){return this._sources}get connectedTo(){return this._outNodes}get fps(){return this._fps}get fsHeight(){return this._fsHeight}get fsWidth(){return this._fsWidth}get isAlphaBars(){return this._flg.isAlpha}get isBandsMode(){return this._flg.isBands}get isDestroyed(){return this._destroyed}get isFullscreen(){return this._fsEl&&(document.fullscreenElement||document.webkitFullscreenElement)===this._fsEl}get isLedBars(){return this._flg.isLeds}get isLumiBars(){return this._flg.isLumi}get isOctaveBands(){return this._flg.isOctaves}get isOn(){return!!this._runId}get isOutlineBars(){return this._flg.isOutline}get pixelRatio(){return this._pixelRatio}get isRoundBars(){return this._flg.isRound}static get version(){return si}connectInput(e){const i=e instanceof HTMLMediaElement;if(!(i||e.connect))throw new ce(Li);const s=i?this.audioCtx.createMediaElementSource(e):e;return this._sources.includes(s)||(s.connect(this._input),this._sources.push(s)),s}connectOutput(e=this.audioCtx.destination){if(!this._outNodes.includes(e)&&(this._output.connect(e),this._outNodes.push(e),this._outNodes.length==1))for(const i of[0,1])this._analyzer[i].connect(this._chLayout==we&&!i?this._output:this._merger,0,i)}destroy(){if(!this._ready)return;const{audioCtx:e,canvas:i,_controller:s,_input:o,_merger:l,_observer:r,_ownContext:a,_splitter:d}=this;this._destroyed=!0,this._ready=!1,this.stop(),s.abort(),r&&r.disconnect(),this.onCanvasResize=null,this.onCanvasDraw=null,this._fsEl=null,this.disconnectInput(),this.disconnectOutput(),o.disconnect(),d.disconnect(),l.disconnect(),a&&e.close(),i.remove(),this._calcBars()}disconnectInput(e,i){e?Array.isArray(e)||(e=[e]):e=Array.from(this._sources);for(const s of e){const o=this._sources.indexOf(s);if(i&&s.mediaStream)for(const l of s.mediaStream.getAudioTracks())l.stop();o>=0&&(s.disconnect(this._input),this._sources.splice(o,1))}}disconnectOutput(e){if(!(e&&!this._outNodes.includes(e))&&(this._output.disconnect(e),this._outNodes=e?this._outNodes.filter(i=>i!==e):[],this._outNodes.length==0))for(const i of[0,1])this._analyzer[i].disconnect()}getBars(){return Array.from(this._bars,({posX:e,freq:i,freqLo:s,freqHi:o,hold:l,peak:r,value:a})=>({posX:e,freq:i,freqLo:s,freqHi:o,hold:l,peak:r,value:a}))}getEnergy(e,i){if(e===void 0)return this._energy.val;if(e!=+e){if(e=="peak")return this._energy.peak;const a={bass:[20,250],lowMid:[250,500],mid:[500,2e3],highMid:[2e3,4e3],treble:[4e3,16e3]};if(!a[e])return null;[e,i]=a[e]}const s=this._freqToBin(e),o=i?this._freqToBin(i):s,l=this._chLayout==we?1:2;let r=0;for(let a=0;a<l;a++)for(let d=s;d<=o;d++)r+=this._normalizedB(this._fftData[a][d]);return r/(o-s+1)/l}registerGradient(e,i){if(typeof e!="string"||e.trim().length==0)throw new ce(yi);if(typeof i!="object")throw new ce(Ri);const{colorStops:s}=i;if(!Array.isArray(s)||!s.length)throw new ce(bi);const o=s.length,l=r=>+r!=r||r<0||r>1;s.forEach((r,a)=>{const d=a/Math.max(1,o-1);typeof r!="object"?s[a]={pos:d,color:r}:l(r.pos)&&(r.pos=d),l(r.level)&&(s[a].level=1-a/o)}),s.sort((r,a)=>r.level<a.level?1:r.level>a.level?-1:0),s[0].level=1,this._gradients[e]={bgColor:i.bgColor||ni,dir:i.dir,colorStops:s},this._selectedGrads.includes(e)&&this._makeGrad()}setCanvasSize(e,i){this._width=e,this._height=i,this._setCanvas(st)}setFreqRange(e,i){if(e<1||i<1)throw new ce(rt);this._minFreq=Math.min(e,i),this.maxFreq=Math.max(e,i)}setLedParams(e){let i,s,o;e&&(i=e.maxLeds|0,s=+e.spaceV,o=+e.spaceH),this._ledParams=i>0&&s>0&&o>=0?[i,s,o]:void 0,this._calcBars()}setOptions(e){this._setProps(e)}setSensitivity(e,i){for(const s of[0,1])this._analyzer[s].minDecibels=Math.min(e,i),this._analyzer[s].maxDecibels=Math.max(e,i)}start(){this.toggleAnalyzer(!0)}stop(){this.toggleAnalyzer(!1)}toggleAnalyzer(e){const i=this.isOn;return e===void 0&&(e=!i),i&&!e?(cancelAnimationFrame(this._runId),this._runId=0):!i&&e&&!this._destroyed&&(this._frames=0,this._time=performance.now(),this._runId=requestAnimationFrame(s=>this._draw(s))),this.isOn}toggleFullscreen(){if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{const e=this._fsEl;if(!e)return;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}}_binToFreq(e){return e*this.audioCtx.sampleRate/this.fftSize||1}_calcBars(){const e=this._bars=[];if(!this._ready){this._flg={isAlpha:!1,isBands:!1,isLeds:!1,isLumi:!1,isOctaves:!1,isOutline:!1,isRound:!1,noLedGap:!1};return}const{_ansiBands:i,_barSpace:s,canvas:o,_chLayout:l,_maxFreq:r,_minFreq:a,_mirror:d,_mode:h,_radial:p,_reflexRatio:u}=this,E=o.width>>1,G=o.height>>1,A=l==Le&&!p,w=l==We,m=h%10!=0,$=m&&this._frequencyScale==ke,q=this._showLeds&&m&&!p,S=this._lumiBars&&m&&!p,Z=this._alphaBars&&!S&&h!=Ne,_e=this._outlineBars&&m&&!S&&!q,Q=this._roundBars&&m&&!S&&!q,L=l!=Le||u>0&&!S,ee=o.height-(A&&!q?.5:0)>>A,k=ee*(S||p?1:1-u)|0,J=o.width-E*(w||d!=0),t=A?o.height-ee*2:0,Y=E*(d==-1&&!w&&!p),ye=Math.min(o.width,o.height)*(l==Le?.375:.125)|0,X=Math.min(E,G),O=B=>e.push({...B,peak:[0,0],hold:[0],value:[0]}),T=B=>{const D=this._freqToBin(B,"floor"),y=this._binToFreq(D),v=this._binToFreq(D+1),F=Math.log2(B/y)/Math.log2(v/y);return[D,F]};let _,z,I;if($){const B=(C,H,ne)=>+C.toPrecision(ne?Math.max(H,1+Math.log10(C)|0):H),D=C=>{const H=[1,1.12,1.25,1.4,1.6,1.8,2,2.24,2.5,2.8,3.15,3.55,4,4.5,5,5.6,6.3,7.1,8,9,10],ne=Math.log10(C)|0,se=C/10**ne;let re=1;for(;re<H.length&&se>H[re];)re++;return se-H[re-1]<H[re]-se&&re--,(H[re]*10**(ne+5)|0)/1e5},y=[0,24,12,8,6,4,3,2,1][h],v=i?10**(3/(y*10)):2**(1/y),F=v**.5;let W=i?7.94328235/(y%2?1:F):ut;do{let C=W;const H=B(C/F,4,!0),ne=B(C*F,4,!0),[se,re]=T(H),[Be,pe]=T(ne);i?C=y<4?D(C):B(C,C.toString()[0]<5?3:2):C=B(C,4,!0),C>=a&&O({posX:0,freq:C,freqLo:H,freqHi:ne,binLo:se,binHi:Be,ratioLo:re,ratioHi:pe}),W*=v}while(W<=r);_=J/e.length,e.forEach((C,H)=>C.posX=Y+H*_);const N=e[0],R=e[e.length-1];z=this._freqScaling(N.freqLo),I=J/(this._freqScaling(R.freqHi)-z),N.freqLo<a&&(N.freqLo=a,[N.binLo,N.ratioLo]=T(a)),R.freqHi>r&&(R.freqHi=r,[R.binHi,R.ratioHi]=T(r))}else if(m){const B=[0,24,12,8,6,4,3,2,1][h]*10,D=y=>{switch(this._frequencyScale){case at:return 1960/(26.81/(y+.53)-1);case nt:return 700*(2**y-1);case qe:return y}};_=J/B,z=this._freqScaling(a),I=J/(this._freqScaling(r)-z);for(let y=0,v=0;y<B;y++,v+=_){const F=D(z+v/I),W=D(z+(v+_/2)/I),N=D(z+(v+_)/I),[R,C]=T(F),[H,ne]=T(N);O({posX:Y+v,freq:W,freqLo:F,freqHi:N,binLo:R,binHi:H,ratioLo:C,ratioHi:ne})}}else{_=1,z=this._freqScaling(a),I=J/(this._freqScaling(r)-z);const B=this._freqToBin(a,"floor"),D=this._freqToBin(r);let y=-999;for(let v=B;v<=D;v++){const F=this._binToFreq(v),W=Y+Math.round(I*(this._freqScaling(F)-z));if(W>y)O({posX:W,freq:F,freqLo:F,freqHi:F,binLo:v,binHi:v,ratioLo:0,ratioHi:0}),y=W;else if(e.length){const N=e[e.length-1];N.binHi=v,N.freqHi=F,N.freq=(N.freqLo*F)**.5}}}let ie=0,U=0;if(q){const B=this._pixelRatio/(window.devicePixelRatio>1&&window.screen.height<=540?2:1),D=[[],[128,3,.45],[128,4,.225],[96,6,.225],[80,6,.225],[80,6,.125],[64,6,.125],[48,8,.125],[24,16,.125]],y=this._ledParams,[v,F,W]=y||D[h];let N,R=k;if(y){const C=2*B;let H;N=v+1;do N--,H=R/N/(1+F),U=H*F;while((H<C||U<C)&&N>1)}else{const C=540/F;U=Math.min(F*B,Math.max(2,R/C+.1|0))}L&&(R+=U),y||(N=Math.min(v,R/(U*2)|0)),ie=W>=1?W:_*W,this._leds=[N,ie,U,R/N-U]}const x=Math.min(_-1,s*(s>0&&s<1?_:1));m&&(_-=Math.max(q?ie:0,x)),e.forEach((B,D)=>{let y=B.posX,v=_;m&&(s==0&&!q?(y|=0,v|=0,D>0&&y>e[D-1].posX+e[D-1].width&&(y--,v++)):y+=Math.max(q?ie:0,x)/2,B.posX=y),B.barCenter=y+(_==1?0:v/2),B.width=v});const de=[];for(const B of[0,1]){const D=l==Le?(ee+t)*B:0,y=D+ee,v=D+k-(!q||L?0:U);de.push({channelTop:D,channelBottom:y,analyzerBottom:v})}this._aux={analyzerHeight:k,analyzerWidth:J,centerX:E,centerY:G,channelCoords:de,channelHeight:ee,channelGap:t,initialX:Y,innerRadius:ye,outerRadius:X,scaleMin:z,unitWidth:I},this._flg={isAlpha:Z,isBands:m,isLeds:q,isLumi:S,isOctaves:$,isOutline:_e,isRound:Q,noLedGap:L},this._createScales()}_createScales(){if(!this._ready)return;const{analyzerWidth:e,initialX:i,innerRadius:s,scaleMin:o,unitWidth:l}=this._aux,{canvas:r,_frequencyScale:a,_mirror:d,_noteLabels:h,_radial:p,_scaleX:u,_scaleR:E}=this,G=u.canvas,A=E.canvas,w=[],m=this._chLayout==We,$=this._chLayout==Le,q=["C",,"D",,"E","F",,"G",,"A",,"B"],S=Math.min(r.width,r.height)/34|0,Z=G.height>>1,_e=S>>1,Q=Z*(h?.7:1.5),L=_e*(h?1:2),ee=2**(1/12);if(!h&&(this._ansiBands||a!=ke))w.push(16,31.5,63,125,250,500,1e3,2e3,4e3),a==qe?w.push(6e3,8e3,1e4,12e3,14e3,16e3,18e3,2e4,22e3):w.push(8e3,16e3);else{let X=ut;for(let O=-1;O<11;O++)for(let T=0;T<12;T++){if(X>=this._minFreq&&X<=this._maxFreq){const _=q[T],z=_=="C";(_&&h&&!d&&!m||z)&&w.push(h?[X,_+(z?O:"")]:X)}X*=ee}}A.width=A.height=(s<<1)+$*S;const k=A.width>>1,J=k-S*.7,t=(X,O)=>{const T=De*(X/r.width),_=T-it,z=J*Math.cos(_),I=J*Math.sin(_);E.save(),E.translate(k+z,k+I),E.rotate(T),E.fillText(O,0,0),E.restore()};G.width|=0,u.fillStyle=E.strokeStyle=di,u.fillRect(0,0,G.width,G.height),E.arc(k,k,k-S/2,0,De),E.lineWidth=S,E.stroke(),u.fillStyle=E.fillStyle=xt,u.font=`${Z}px ${Ue}`,E.font=`${_e}px ${Ue}`,u.textAlign=E.textAlign="center";let Y=-Q/4,ye=-L;for(const X of w){const[O,T]=Array.isArray(X)?X:[X,X<1e3?X|0:`${(X/100|0)/10}k`],_=l*(this._freqScaling(O)-o),z=G.height*.75,I=T[0]=="C",ie=Z*(h&&!d&&!m?I?1.2:.6:3);if(u.fillStyle=E.fillStyle=I&&!d&&!m?fi:xt,h){const U=a==ke,x=a==qe;let de=["C"];if((U||O>2e3||!x&&O>250||(!p||$)&&(!x&&O>125||O>1e3))&&de.push("G"),(U||O>4e3||!x&&O>500||(!p||$)&&(!x&&O>250||O>2e3))&&de.push("E"),(x&&O>4e3||(!p||$)&&(U||O>2e3||!x&&O>500))&&de.push("D","F","A","B"),!de.includes(T[0]))continue}_>=Y+Q/2&&_<=e&&(u.fillText(T,m&&d==-1?e-_:i+_,z,ie),(m||d&&(_>Q||d==1))&&u.fillText(T,m&&d!=1?e+_:(i||r.width)-_,z,ie),Y=_+Math.min(ie,u.measureText(T).width)/2),_>=ye+L&&_<e-L&&(t(m&&d==1?e-_:_,T),(m||d&&(_>L||d==1))&&t(m&&d!=-1?e+_:-_,T),ye=_)}}_draw(e){this._runId=requestAnimationFrame(n=>this._draw(n));const i=e-this._time,s=e-this._last,o=this._maxFPS?975/this._maxFPS:0;if(s<o)return;this._last=e-(o?s%o:0),this._frames++,i>=1e3&&(this._fps=this._frames/i*1e3,this._frames=0,this._time=e);const{isAlpha:l,isBands:r,isLeds:a,isLumi:d,isOctaves:h,isOutline:p,isRound:u,noLedGap:E}=this._flg,{analyzerHeight:G,centerX:A,centerY:w,channelCoords:m,channelHeight:$,channelGap:q,initialX:S,innerRadius:Z,outerRadius:_e}=this._aux,{_bars:Q,canvas:L,_canvasGradients:ee,_chLayout:k,_colorMode:J,_ctx:t,_energy:Y,fillAlpha:ye,_fps:X,_linearAmplitude:O,_lineWidth:T,maxDecibels:_,minDecibels:z,_mirror:I,_mode:ie,overlay:U,_radial:x,showBgColor:de,showPeaks:B,useCanvas:D,_weightingFilter:y}=this,v=this._scaleX.canvas,F=this._scaleR.canvas,W=X>>1,N=k==gt,R=k==We,C=k==Le,H=k==we,ne=a&&this._trueLeds&&J==Ve,se=x?L.width:this._aux.analyzerWidth,re=S+se,Be=B&&this._peakLine&&ie==Ne,pe=x?_e-Z:G,[Dt,Fi,Fe,je]=this._leds||[];Y.val>0&&(this._spinAngle+=this._spinSpeed*De/(60*X));const Nt=n=>{if(this._reflexRatio>0&&!d&&!x){let b,ue;this.reflexFit||C?(b=C&&n==0?$+q:0,ue=$-G):(b=L.height-G*2,ue=G),t.save(),t.globalAlpha=this.reflexAlpha,this.reflexBright!=1&&(t.filter=`brightness(${this.reflexBright})`),t.setTransform(1,0,0,-1,0,L.height),t.drawImage(L,0,m[n].channelTop,L.width,G,0,b,L.width,ue),t.restore()}},kt=()=>{this.showScaleX&&(x?(t.save(),t.translate(A,w),this._spinSpeed&&t.rotate(this._spinAngle+it),t.drawImage(F,-F.width>>1,-F.width>>1),t.restore()):t.drawImage(v,0,L.height-v.height))},Mt=n=>{const b=n**2,ue=424.36,j=11599.29,He=25122.25,Re=544496.41,me=148693636,Ae=Ee=>20*Math.log10(Ee);switch(y){case Rt:const Ee=me*b**2/((b+ue)*Math.sqrt((b+j)*(b+Re))*(b+me));return 2+Ae(Ee);case bt:const xe=me*b*n/((b+ue)*Math.sqrt(b+He)*(b+me));return .17+Ae(xe);case St:const Je=me*b/((b+ue)*(b+me));return .06+Ae(Je);case vt:const Pe=((103791848e-2-b)**2+108076816e-2*b)/((9837328-b)**2+11723776*b),Ze=n/68966888496476e-18*Math.sqrt(Pe/((b+79919.29)*(b+1345600)));return Ae(Ze);case At:const Xe=-4737338981378384e-39*n**6+2043828333606125e-30*n**4-1363894795463638e-22*b+1,Ce=1306612257412824e-34*n**5-2118150887518656e-26*n**3+.0005559488023498642*n,oe=.0001246332637532143*n/Math.hypot(Xe,Ce);return 18.2+Ae(oe)}return 0},Ke=(n,b,ue)=>{t.beginPath(),t.moveTo(n,b),t.lineTo(n,ue),t.stroke()},Qe=n=>{if(n&&T){const b=t.globalAlpha;t.globalAlpha=1,t.stroke(),t.globalAlpha=b}},ve=n=>Math.max(0,(n*Dt|0)*(je+Fe)-Fe),Ft=n=>{Y.val=n,Y.peak>0&&(Y.hold--,Y.hold<0&&(Y.peak+=Y.hold/(W*W/2))),n>=Y.peak&&(Y.peak=n,Y.hold=W)};U&&t.clearRect(0,0,L.width,L.height);let lt=0;const ht=Q.length,ct=H?1:2;for(let n=0;n<ct;n++){const{channelTop:b,channelBottom:ue,analyzerBottom:j}=m[n],He=this._gradients[this._selectedGrads[n]],Re=He.colorStops,me=Re.length,Ae=!de||a&&!U?"#000":He.bgColor,Ee=C&&x&&n?-1:1,xe=!n&&I==-1||n&&I==1,Je=!R||n&&I!=1?0:se>>(n||!xe),Pe=R&&xe?-1:1,Ze=()=>{const c=v.height,g=c>>1,f=O?100:_,M=O?0:z,V=O?20:5,ae=G/(f-M),ge=I!=-1&&(!R||n==0||I==1),be=I!=1&&(!R||n!=I);t.save(),t.fillStyle=Ct,t.font=`${g}px ${Ue}`,t.textAlign="right",t.lineWidth=1;for(let Se=f;Se>M;Se-=V){const Ie=b+(f-Se)*ae,K=Se%2==0|0;if(K){const te=Ie+g*(Ie==b?.8:.35);ge&&t.fillText(Se,c*.85,te),be&&t.fillText(Se,(R?se:L.width)-c*.1,te),t.strokeStyle=Ct,t.setLineDash([2,4]),t.lineDashOffset=0}else t.strokeStyle=_i,t.setLineDash([2,8]),t.lineDashOffset=1;t.beginPath(),t.moveTo(S+c*K*ge,~~Ie+.5),t.lineTo(re-c*K*be,~~Ie+.5),t.stroke()}t.restore()},Xe=(c,g)=>{const f=fe[c]+(c<fe.length-1?(fe[c+1]-fe[c])*g:0);return isNaN(f)?-1/0:f},Ce=(c,g=Pe)=>g*De*((c+Je)/L.width)+this._spinAngle,oe=(c,g,f)=>{const M=Z+g*Ee,V=Ce(c,f);return[A+M*Math.cos(V),w+M*Math.sin(V)]},et=(c,g,f,M,V)=>{t.beginPath();for(const ae of I&&!R?[1,-1]:[Pe]){const[ge,be]=u?[Ce(c,ae),Ce(c+f,ae)]:[];t.moveTo(...oe(c,g,ae)),t.lineTo(...oe(c,g+M,ae)),u?t.arc(A,w,Z+(g+M)*Ee,ge,be,ae!=1):t.lineTo(...oe(c+f,g+M,ae)),t.lineTo(...oe(c+f,g,ae)),u&&!V&&t.arc(A,w,Z+g*Ee,be,ge,ae==1)}Qe(V),t.fill()},tt=(c=0,g=0)=>{let f;if(J==Ve&&!ne||ie==Ne)f=ee[n];else{const M=J==pt?g%me:Re.findLastIndex(V=>a?ve(c)<=ve(V.level):c<=V.level);f=Re[M].color}t.fillStyle=t.strokeStyle=f};if(D){if(R&&!x){const c=se*(n+xe),g=xe?-1:1;t.setTransform(g,0,0,1,c,0)}if((!U||de)&&(U&&(t.globalAlpha=this.bgAlpha),t.fillStyle=Ae,(n==0||!x&&!N)&&t.fillRect(S,b-q,se,(U&&this.reflexAlpha==1?G:$)+q),t.globalAlpha=1),this.showScaleY&&!d&&!x&&(n==0||!N)&&Ze(),a?(t.setLineDash([je,Fe]),t.lineWidth=Q[0].width):t.lineWidth=p?Math.min(T,Q[0].width/2):T,t.save(),!x){const c=new Path2D;c.rect(0,b,L.width,G),t.clip(c)}}let fe=this._fftData[n];this._analyzer[n].getFloatFrequencyData(fe),y&&(fe=fe.map((c,g)=>c+Mt(this._binToFreq(g)))),t.beginPath();let Ge=[];for(let c=0;c<ht;c++){const g=Q[c],{posX:f,barCenter:M,width:V,freq:ae,binLo:ge,binHi:be,ratioLo:Se,ratioHi:Ie}=g;let K=Math.max(Xe(ge,Se),Xe(be,Ie));for(let P=ge+1;P<be;P++)fe[P]>K&&(K=fe[P]);if(K=this._normalizedB(K),g.value[n]=K,lt+=K,g.peak[n]>0&&(g.hold[n]--,g.hold[n]<0&&(g.peak[n]+=g.hold[n]/(W*W/2))),K>=g.peak[n]&&(g.peak[n]=K,g.hold[n]=W),!D)continue;d||l?t.globalAlpha=K:p&&(t.globalAlpha=ye),tt(K,c);const te=d?pe:a?ve(K):K*pe|0;if(ie==Ne){const P=c?0:(this._normalizedB(fe[Q[1].binLo])*pe+te)/2;if(x){if(c==0&&(R&&t.moveTo(...oe(0,0)),t.lineTo(...oe(0,f<0?P:te))),f>=0){const he=[f,te];t.lineTo(...oe(...he)),Ge.push(he)}}else{if(c==0)if(I==-1&&!R)t.moveTo(S,j-(f<S?P:te));else{const he=ge?this._normalizedB(fe[ge-1])*pe:te;t.moveTo(S-T,j-he)}(R||I!=-1||f>=S)&&t.lineTo(f,j-te)}}else if(a){if(de&&!U&&(n==0||!N)){const P=t.globalAlpha;t.strokeStyle=oi,t.globalAlpha=1,Ke(M,b,j),t.strokeStyle=t.fillStyle,t.globalAlpha=P}if(ne){const P=d?0:Re.findLastIndex(Te=>ve(K)<=ve(Te.level));let he=j;for(let Te=me-1;Te>=P;Te--){t.strokeStyle=Re[Te].color;let dt=j-(Te==P?te:ve(Re[Te].level));Ke(M,he,dt),he=dt-Fe}}else Ke(M,j,j-te)}else if(f>=S)if(x)et(f,0,V,te,p);else if(u){const P=V/2,he=j+P;t.beginPath(),t.moveTo(f,he),t.lineTo(f,he-te),t.arc(M,he-te,P,ot,De),t.lineTo(f+V,he),Qe(p),t.fill()}else{const P=p?t.lineWidth:0;t.beginPath(),t.rect(f,j+P,V,-te-P),Qe(p),t.fill()}const Oe=g.peak[n];if(Oe>0&&B&&!Be&&!d&&f>=S&&f<re)if(p&&T>0?t.globalAlpha=1:l&&(t.globalAlpha=Oe),(J==mt||ne)&&tt(Oe),a){const P=ve(Oe);P>=Fe&&t.fillRect(f,j-P,V,je)}else x?ie!=Ne&&et(f,Oe*pe,V,-2):t.fillRect(f,j-Oe*pe,V,2)}if(D){if(t.globalAlpha=1,ie==Ne){if(tt(),x&&!R){if(I){let c;for(;c=Ge.pop();)t.lineTo(...oe(...c,-1))}t.closePath()}if(T>0&&t.stroke(),ye>0){if(x){const c=R?Ce(se>>1):0,g=R?Ce(se):De;t.moveTo(...oe(R?se>>1:0,0)),t.arc(A,w,Z,c,g,R?!xe:!0)}else t.lineTo(re,j),t.lineTo(S,j);t.globalAlpha=ye,t.fill(),t.globalAlpha=1}if((Be||x&&B)&&(Ge=[],t.beginPath(),Q.forEach((c,g)=>{let f=c.posX,M=c.peak[n],V=g?"lineTo":"moveTo";if(x&&f<0){const ae=Q[g+1];M=Si(f,M,ae.posX,ae.peak[n],0),f=0}M*=pe,Be?(t[V](...x?oe(f,M):[f,j-M]),x&&I&&!R&&Ge.push([f,M])):M>0&&et(f,M,1,-2)}),Be)){let c;for(;c=Ge.pop();)t.lineTo(...oe(...c,-1));t.lineWidth=1,t.stroke()}}t.restore(),R&&!x&&t.setTransform(1,0,0,1,0,0),(!R&&!N||n)&&Nt(n)}}if(Ft(lt/(ht<<ct-1)),D&&(I&&!x&&!R&&(t.setTransform(-1,0,0,1,L.width-S,0),t.drawImage(L,S,0,A,L.height,0,0,A,L.height),t.setTransform(1,0,0,1,0,0)),t.setLineDash([]),kt()),this.showFPS){const n=v.height;t.font=`bold ${n}px ${Ue}`,t.fillStyle=ri,t.textAlign="right",t.fillText(Math.round(X),L.width-n,n*2)}this.onCanvasDraw&&(t.save(),t.fillStyle=t.strokeStyle=ee[0],this.onCanvasDraw(this,{timestamp:e,_canvasGradients:ee}),t.restore())}_freqScaling(e){switch(this._frequencyScale){case ke:return Math.log2(e);case at:return 26.81*e/(1960+e)-.53;case nt:return Math.log2(1+e/700);case qe:return e}}_freqToBin(e,i="round"){const s=this._analyzer[0].frequencyBinCount-1,o=Math[i](e*this.fftSize/this.audioCtx.sampleRate);return o<s?o:s}_makeGrad(){if(!this._ready)return;const{canvas:e,_ctx:i,_radial:s,_reflexRatio:o}=this,{analyzerWidth:l,centerX:r,centerY:a,initialX:d,innerRadius:h,outerRadius:p}=this._aux,{isLumi:u}=this._flg,E=this._chLayout==Le,G=1-o,A=u?e.height:e.height*(1-o*!E)|0;for(const w of[0,1]){const m=this._gradients[this._selectedGrads[w]],$=m.colorStops,q=m.dir=="h";let S;if(s?S=i.createRadialGradient(r,a,p,r,a,h-(p-h)*E):S=i.createLinearGradient(...q?[d,0,d+l,0]:[0,0,0,A]),$){const Z=E&&!this._splitGradient&&(!q||s);for(let _e=0;_e<1+Z;_e++){const Q=$.length-1;$.forEach((L,ee)=>{let k=L.pos;if(Z&&(k/=2),E&&!u&&!s&&!q&&(k*=G,!Z&&k>.5*G&&(k+=.5*o)),_e==1)if(s||u){const J=Q-ee;L=$[J],k=1-L.pos/2}else ee==0&&k>0&&S.addColorStop(.5,L.color),k+=.5;S.addColorStop(k,L.color),E&&ee==Q&&k<.5&&S.addColorStop(.5,L.color)})}}this._canvasGradients[w]=S}}_normalizedB(e){const i=this._linearAmplitude,s=i?1/this._linearBoost:1,o=(d,h,p)=>d<=h?h:d>=p?p:d,l=d=>10**(d/20);let r=this.maxDecibels,a=this.minDecibels;return i&&(r=l(r),a=l(a),e=l(e)**s),o((e-a)/(r-a)**s,0,1)}_setCanvas(e){if(!this._ready)return;const{canvas:i,_ctx:s}=this,o=this._scaleX.canvas,l=window.devicePixelRatio/(this._loRes+1);let r=window.screen.width*l,a=window.screen.height*l;Math.abs(window.orientation)==90&&r<a&&([r,a]=[a,r]);const d=this.isFullscreen,h=d&&this._fsEl==i,p=h?r:(this._width||this._container.clientWidth||this._defaultWidth)*l|0,u=h?a:(this._height||this._container.clientHeight||this._defaultHeight)*l|0;this._pixelRatio=l,this._fsWidth=r,this._fsHeight=a,!(i.width==p&&i.height==u)&&(i.width=p,i.height=u,this.overlay||(s.fillStyle="#000",s.fillRect(0,0,p,u)),s.lineJoin="bevel",o.width=p,o.height=Math.max(20*l,Math.min(p,u)/32|0),this._calcBars(),this._makeGrad(),this._fsStatus!==void 0&&this._fsStatus!==d&&(e=Et),this._fsStatus=d,this.onCanvasResize&&this.onCanvasResize(e,this))}_setGradient(e,i){if(!this._gradients.hasOwnProperty(e))throw new ce(pi,e);[0,1].includes(i)||(this._selectedGrads[1]=e,i=0),this._selectedGrads[i]=e,this._makeGrad()}_setProps(e,i){const s={alphaBars:!1,ansiBands:!1,barSpace:.1,bgAlpha:.7,channelLayout:we,colorMode:Ve,fftSize:8192,fillAlpha:1,frequencyScale:ke,gradient:Bt[0][0],ledBars:!1,linearAmplitude:!1,linearBoost:1,lineWidth:0,loRes:!1,lumiBars:!1,maxDecibels:-25,maxFPS:0,maxFreq:22e3,minDecibels:-85,minFreq:20,mirror:0,mode:0,noteLabels:!1,outlineBars:!1,overlay:!1,peakLine:!1,radial:!1,reflexAlpha:.15,reflexBright:1,reflexFit:!0,reflexRatio:0,roundBars:!1,showBgColor:!0,showFPS:!1,showPeaks:!0,showScaleX:!0,showScaleY:!1,smoothing:.5,spinSpeed:0,splitGradient:!1,start:!0,trueLeds:!1,useCanvas:!0,volume:1,weightingFilter:yt},o=["onCanvasDraw","onCanvasResize"],l=["gradientLeft","gradientRight","height","width","stereo"],r=Object.keys(s).filter(a=>a!="start").concat(o,l);(i||e===void 0)&&(e={...s,...e});for(const a of Object.keys(e))o.includes(a)&&typeof e[a]!="function"?this[a]=void 0:r.includes(a)&&(this[a]=e[a]);e.start!==void 0&&this.toggleAnalyzer(e.start)}}const Ai={class:"flex flex-col justify-center text-white"},Ei={class:"fullscreen-container rounded-3xl overflow-hidden m-4",id:"screen"},xi=["width","height"],Ci={class:"absolute top-4 left-4 text-xl select-none"},Ti={key:0,class:"i-la-play"},Bi={key:1,class:"i-la-pause"},Ii=Me("div",{class:"i-la-trash-alt"},null,-1),Oi=[Ii],Di={__name:"PitchSpectrogram",setup(le){const{mic:e,input:i}=Pt(),s=Xt(!1);ft(" ",A=>{s.value=!s.value,A.preventDefault()}),ft("Enter",A=>{d(),A.preventDefault()});let o,l,r,a;function d(){l.fillStyle="#000",l.fillRect(0,0,h.width,h.height)}const h=Wt({initiated:!1,width:800,height:240,speed:Vt(()=>Math.floor(h.speedCount/100)),speedCount:ii(100,100,300)});function p(A){A.tap&&(s.value=!s.value),h.speedCount-=A.delta[0]/2}Ut(()=>{qt(),o=document.getElementById("spectrogram"),l=o.getContext("2d"),r=document.createElement("canvas"),a=r.getContext("2d"),r.width=h.width,r.height=h.height,l.fillStyle="#000",l.fillRect(0,0,h.width,h.height)});let u;function E(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(()=>{h.initiated=!0,u=new vi(null,{mode:1,connectSpeakers:!1,volume:0,useCanvas:!1,source:zt.meter,onCanvasDraw(A){if(s.value)return;a.drawImage(o,0,0,h.width,h.height);let w=A.getBars();for(let m=0;m<w.length;m++)l.fillStyle=G((w[m].freqLo+w[m].freqHi)/2,w[m].value[0]),l.fillRect(h.width-h.speed,h.height-m*(h.height/w.length),h.speed,1);l.translate(-h.speed,0),l.drawImage(r,0,0,h.width,h.height),l.setTransform(1,0,0,1,0,0)}}),e.open=!0,u.connectInput(i)}).catch(A=>{console.log("mic denied",A)})}function G(A,w){return`hsl(${Ht(A)*30}, ${w*100}%, ${w*80}%)`}return(A,w)=>{const m=Gt,$=$t("drag");return ze(),Ye("div",Ai,[Me("div",Ei,[Yt(Me("canvas",{class:"h-full min-h-30em w-full rounded-md cursor-pointer",id:"spectrogram",width:h.width,height:h.height},null,8,xi),[[$,p]]),h.initiated?Kt("",!0):(ze(),jt(m,{key:0,class:"absolute",onClick:w[0]||(w[0]=q=>E())})),Me("div",Ci,"x"+Qt(h.speed),1),Me("button",{class:"absolute bottom-4 left-4 text-xl select-none cursor-pointer",onMousedown:w[1]||(w[1]=q=>s.value=!s.value)},[s.value?(ze(),Ye("div",Ti)):(ze(),Ye("div",Bi))],32),Me("button",{class:"absolute top-4 right-4 text-xl select-none cursor-pointer",onMousedown:w[2]||(w[2]=q=>d())},Oi,32)])])}}},$i=JSON.parse('{"title":"Spectrogram","description":"2.5D representation on frequency domain in time","frontmatter":{"title":"Spectrogram","description":"2.5D representation on frequency domain in time","date":"2022-06-16T00:00:00.000Z","cover":"spectrogram.png","usefulLinks":["https://codepen.io/hvianna/pen/ZEKWWJb","https://www.npmjs.com/package/audiomotion-analyzer","https://github.com/ListeningToWaves/SpectrogramTesting/blob/master/src/components/spectrogram.js"]},"headers":[],"relativePath":"practice/pitch/spectrogram/index.md","filePath":"practice/pitch/spectrogram/index.md","lastUpdated":1693938056000}'),Ni={name:"practice/pitch/spectrogram/index.md"},ki=ti("",3);function Mi(le,e,i,s,o,l){const r=Di,a=Zt("client-only");return ze(),Ye("div",null,[_t(a,null,{default:ei(()=>[_t(r,{class:"mb-8"})]),_:1}),ki])}const Yi=Jt(Ni,[["render",Mi]]);export{$i as __pageData,Yi as default};
