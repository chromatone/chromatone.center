import{r as f,O as k,b as D,c as V,u as g,o as $,W as q,v as c,x as h,z as n,B as I,L as M,H as R,E as A,X as m,_ as O,q as B,M as N,as as U,a5 as W}from"./chunks/framework.BiLeRUvw.js";import{aD as j,R as F,aE as L,aF as z,au as H,M as J}from"./chunks/theme.DT5mKq_f.js";import{_ as K}from"./chunks/ControlStart.D-byAZ-6.js";const Y={class:"flex flex-col justify-center"},Z={class:"fullscreen-container text-white max-h-90svh",id:"screen"},G=["width","height"],X={class:"absolute top-4 left-4 text-xl select-none"},Q={key:0,class:"i-la-play"},ee={key:1,class:"i-la-pause"},te={key:0,class:"i-la-arrow-left"},oe={key:1,class:"i-la-arrow-down"},ae=n("div",{class:"i-la-trash-alt"},null,-1),se=[ae],ne={class:"flex items-center gap-2 px-2 flex-wrap"},ie={class:"is-group flex flex-wrap gap-2 flex-1 p-2"},re={class:"max-w-120 scale-75 max-h-60 overflow-clip relative text-white"},le=n("div",{class:"absolute p-2 opacity-70 touch-none select-none text-md"},"Right click here to enter Picture-In-Picture mode",-1),ce={__name:"PitchSpectrogram",setup(S){const v=f(),d=f(),{mic:_,input:w}=j(),r=f(!1);k(" ",a=>{r.value=!r.value,a.preventDefault()}),k("Enter",a=>{x(),a.preventDefault()});let p,s,u,y;function x(){s.fillStyle="#000",s.fillRect(0,0,e.width,e.height)}const e=D({initiated:!1,width:1600,height:1600,speed:V(()=>Math.floor(e.speedCount/100)),speedCount:F(100,100,500),vertical:g("spectrogram-vertical",!1),pow:g("spectrogram-power",1),offset:g("spectrogram-offset",0)});function P(a){a.tap&&(r.value=!r.value),e.speedCount-=a.delta[0]/2}$(()=>{L(),p=document.getElementById("spectrogram"),s=p.getContext("2d"),u=document.createElement("canvas"),y=u.getContext("2d"),u.width=e.width,u.height=e.height,s.fillStyle="#000",s.fillRect(0,0,e.width,e.height);const a=p.captureStream();d.value.srcObject=a,d.value.play().then(()=>{var t,o;return(o=(t=d.value)==null?void 0:t.requestPictureInPicture)==null?void 0:o.call(t)}).catch(t=>console.error(t))});let b;function C(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(async()=>{const{AudioMotionAnalyzer:a}=await O(async()=>{const{AudioMotionAnalyzer:t}=await import("./chunks/audioMotion-analyzer.7XoESQPH.js");return{AudioMotionAnalyzer:t}},[]);b=new a(null,{mode:1,connectSpeakers:!1,volume:0,useCanvas:!1,source:z.meter,onCanvasDraw(t){if(r.value)return;y.drawImage(p,0,0,e.width,e.height);let o=t.getBars();for(let i=0;i<o.length;i++)s.fillStyle=T((o[i].freqLo+o[i].freqHi)/2,o[i].value[0]),e.vertical?s.fillRect(i*(e.width/o.length),0,e.width/o.length,e.speed):s.fillRect(e.width-e.speed,e.height-(i+1)*(e.height/o.length),e.speed,e.height/o.length);e.vertical?s.translate(0,e.speed):s.translate(-e.speed,0),s.drawImage(u,0,0,e.width,e.height),s.setTransform(1,0,0,1,0,0)}}),e.initiated=!0,_.open=!0,b.connectInput(w)}).catch(a=>{console.log("mic denied",a)})}function T(a,t){let o=Math.pow(t+e.offset,e.pow);return`hsl(${H(a)*30}, ${o*100}%, ${o*70}%)`}return(a,t)=>{const o=K,i=J,E=q("drag");return c(),h("div",Y,[n("div",Z,[I(n("canvas",{class:"h-full min-h-70svh w-full cursor-pointer",id:"spectrogram",ref_key:"canvasElement",ref:v,width:e.width,height:e.height},null,8,G),[[E,P]]),e.initiated?R("",!0):(c(),M(o,{key:0,class:"absolute",onClick:t[0]||(t[0]=l=>C())})),n("div",X,"x"+A(e.speed),1),n("button",{class:"absolute bottom-4 left-4 text-xl select-none cursor-pointer",onMousedown:t[1]||(t[1]=l=>r.value=!r.value)},[r.value?(c(),h("div",Q)):(c(),h("div",ee))],32),n("button",{class:"absolute bottom-4 right-4 text-xl select-none cursor-pointer",onMousedown:t[2]||(t[2]=l=>e.vertical=!e.vertical)},[e.vertical?(c(),h("div",oe)):(c(),h("div",te))],32),n("button",{class:"absolute top-4 right-4 text-xl select-none cursor-pointer",onMousedown:t[3]||(t[3]=l=>x())},se,32)]),n("div",ne,[n("div",ie,[m(i,{modelValue:e.pow,"onUpdate:modelValue":t[4]||(t[4]=l=>e.pow=l),min:1,max:10,step:1,fixed:0,param:"POW"},null,8,["modelValue"]),m(i,{modelValue:e.offset,"onUpdate:modelValue":t[5]||(t[5]=l=>e.offset=l),min:-.5,max:.5,step:1e-4,param:"OFFSET",fixed:2},null,8,["modelValue"])]),n("div",re,[le,n("video",{class:"max-h-50",ref_key:"video",ref:d},null,512)])])])}}},ge=JSON.parse('{"title":"Spectrogram","description":"2.5D representation on frequency domain in time","frontmatter":{"title":"Spectrogram","description":"2.5D representation on frequency domain in time","layout":"app","date":"2022-06-16T00:00:00.000Z","cover":"spectrogram.png","usefulLinks":["https://codepen.io/hvianna/pen/ZEKWWJb","https://www.npmjs.com/package/audiomotion-analyzer","https://github.com/ListeningToWaves/SpectrogramTesting/blob/master/src/components/spectrogram.js"]},"headers":[],"relativePath":"practice/pitch/spectrogram/index.md","filePath":"practice/pitch/spectrogram/index.md","lastUpdated":1719568105000}'),pe={name:"practice/pitch/spectrogram/index.md"},he=U('<p>The colorful spectrogram is a powerful tool for visual audio analysis. Each particular frequency in the spectrum gets it&#39;s own position on the vertical axis along with the corresponding Chromatone color. The pitch spectrum is continous and the graph shows all the partials in a rather high resolution. The colors of the lines help differentiate pitches and overtones in any incoming audio signal. The quality of analysis is based primarily on the quality of the signal – thus a good microphone is recommended for best experience.</p><h2 id="how-to-use-the-spectrogram" tabindex="-1">How to use the spectrogram <a class="header-anchor" href="#how-to-use-the-spectrogram" aria-label="Permalink to &quot;How to use the spectrogram&quot;">​</a></h2><ol><li>Drag across <i class="p-3 mr-1 i-la-hand-rock"></i> the spectrogram top change the roll speed. The actual setting is at the top-left corner.</li><li>Press the <i class="p-3 mr-1 i-la-expand"></i> icon at the bottom-right corner make the spectrogram go full screen. Very useful mode for deep explorations and teaching.</li><li>You can pause <i class="p-3 mr-1 i-la-pause"></i> and resume <i class="p-3 mr-1 i-la-play"></i> the roll either by clicking anywhere at the spectrogram or by pressing the <code>Spacebar</code> button on your keyboard. Useful when comparing two or more sound spectrums – record a sound spectrum on the roll, then pause it, take another instrument and record another. The roll can fit up to 10 segments or even more.</li><li>Clear the canvas with the <i class="p-3 mr-1 i-la-trash-alt"></i> button at the top-right corner or by pressing the <code>Enter</code> button on your keyboard.</li><li>POW control changes the Power to which we raise the value of each band. It accentuates louder frequencies and dampens noise.</li><li>OFFSET control is for tuning the values before the raising to the power. It can help adjust the brightness and sensitivity of the spectroscope.</li><li>Right click the small video to open the spectrogram in Picture-In-Picture mode. You may need to press play in the floating window to see the spectrogram running.</li></ol>',3);function de(S,v,d,_,w,r){const p=ce,s=W("client-only");return c(),h("div",null,[m(s,null,{default:N(()=>[m(p)]),_:1}),he])}const ve=B(pe,[["render",de]]);export{ge as __pageData,ve as default};
