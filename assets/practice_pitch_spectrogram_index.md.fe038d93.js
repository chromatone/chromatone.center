import{_ as wt}from"./chunks/start.513900a4.js";import{i as Rt,m as yt}from"./chunks/audio.0b0a52c9.js";import{b as bt}from"./chunks/calculations.65ee336d.js";import{u as Lt}from"./chunks/mic.8d51b4ab.js";import{e as Ke}from"./chunks/index.0e8b6fce.js";import{u as vt}from"./chunks/index.87a1f89e.js";import{l as xt,C as At,j as St,k as Ct,n as Et,o as Ce,c as De,a as xe,w as Bt,b as Tt,f as It,t as Ot,D as Mt,d as Je,z as Dt,e as Nt}from"./chunks/framework.233ced2b.js";import"./chunks/index.cccf7ef0.js";import"./chunks/index.fb02c716.js";import"./chunks/UserMedia.c8f7c51a.js";import"./chunks/Subtract.e7604129.js";import"./chunks/OnePoleFilter.771f13b4.js";/**!
 * audioMotion-analyzer
 * High-resolution real-time graphic audio spectrum analyzer JS module
 *
 * @version 4.1.1
 * @author  Henrique Avila Vianna <hvianna@gmail.com> <https://henriquevianna.com>
 * @license AGPL-3.0-or-later
 */const kt="4.1.1",Ae=2*Math.PI,ze=Math.PI/2,Ft=Ae/3600,Ze=8.17579892,Te="dual-combined",ue="single",$="dual-vertical",et="bar-index",tt="bar-level",Ie="gradient",Gt="#111",it="",st="A",at="B",nt="C",rt="D",ot="468",Oe="sans-serif",qt="#0f0",zt="#7f7f7f22",Ht="create",lt="fschange",Pt="lores",Xt="resize",He="user",Wt="#000c",ht="#fff",Ut="#4f4",ct="#888",Vt="#555",Pe="bark",fe="linear",me="log",Xe="mel",dt=["#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b"],ft=[["classic",{colorStops:["red",{color:"yellow",level:.85,pos:.6},{color:"lime",level:.475}]}],["prism",{colorStops:dt}],["rainbow",{dir:"h",colorStops:["#817",...dt,"#639"]}],["orangered",{bgColor:"#3e2f29",colorStops:["OrangeRed"]}],["steelblue",{bgColor:"#222c35",colorStops:["SteelBlue"]}]],$t=["ERR_AUDIO_CONTEXT_FAIL","Could not create audio context. Web Audio API not supported?"],Yt=["ERR_INVALID_AUDIO_CONTEXT","Provided audio context is not valid"],jt=["ERR_UNKNOWN_GRADIENT","Unknown gradient"],We=["ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1"],Qt=["ERR_INVALID_MODE","Invalid mode"],Kt=["ERR_REFLEX_OUT_OF_RANGE","Reflex ratio must be >= 0 and < 1"],Jt=["ERR_INVALID_AUDIO_SOURCE","Audio source must be an instance of HTMLMediaElement or AudioNode"],Zt=["ERR_GRADIENT_INVALID_NAME","Gradient name must be a non-empty string"],ei=["ERR_GRADIENT_NOT_AN_OBJECT","Gradient options must be an object"],ti=["ERR_GRADIENT_MISSING_COLOR","Gradient colorStops must be a non-empty array"];class oe extends Error{constructor(e,i){const[s,d]=e;super(d+(i!==void 0?`: ${i}`:"")),this.name="AudioMotionError",this.code=s}}const _t=(_e,e)=>console.warn(`${_e} is deprecated. Use ${e} instead.`),Me=(_e,e,i="toLowerCase")=>e[Math.max(0,e.indexOf((""+_e)[i]()))];Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(_e){let e=this.length;for(;e-- >0;)if(_e(this[e]))return e;return-1});class ii{constructor(e,i={}){this._ready=!1,this._aux={},this._flg={},this._gradients={},this._selectedGrads=[],this._canvasGradients=[];for(const[t,f]of ft)this.registerGradient(t,f);this._container=e||document.body,this._defaultWidth=this._container.clientWidth||640,this._defaultHeight=this._container.clientHeight||270;let s;if(!(i.source&&(s=i.source.context))){if(!(s=i.audioCtx))try{s=new(window.AudioContext||window.webkitAudioContext)}catch{throw new oe($t)}}if(!s.createGain)throw new oe(Yt);const d=this._analyzer=[s.createAnalyser(),s.createAnalyser()],o=this._splitter=s.createChannelSplitter(2),l=this._merger=s.createChannelMerger(2);this._input=s.createGain(),this._output=s.createGain(),this._sources=[],i.source&&this.connectInput(i.source);for(const t of[0,1])o.connect(d[t],t);l.connect(this._output),this._outNodes=[],i.connectSpeakers!==!1&&this.connectOutput(),this._energy={val:0,peak:0,hold:0};const a=document.createElement("canvas");a.style="max-width: 100%;",this._canvasCtx=a.getContext("2d");for(const t of["_scaleX","_scaleR"])this[t]=document.createElement("canvas").getContext("2d");this._fsEl=i.fsElement||a;const c=()=>{this._fsTimeout||(this._fsTimeout=window.setTimeout(()=>{this._fsChanging||(this._setCanvas(Xt),this._fsTimeout=0)},60))};window.ResizeObserver&&new ResizeObserver(c).observe(this._container),window.addEventListener("resize",c),a.addEventListener("fullscreenchange",()=>{this._fsChanging=!0,this._fsTimeout&&window.clearTimeout(this._fsTimeout),this._setCanvas(lt),this._fsTimeout=window.setTimeout(()=>{this._fsChanging=!1,this._fsTimeout=0},60)});const h=()=>{s.state=="suspended"&&s.resume(),window.removeEventListener("click",h)};window.addEventListener("click",h),this._setProps(i,!0),this.useCanvas&&this._container.appendChild(a),this._ready=!0,this._setCanvas(Ht)}get alphaBars(){return this._alphaBars}set alphaBars(e){this._alphaBars=!!e,this._calcBars()}get ansiBands(){return this._ansiBands}set ansiBands(e){this._ansiBands=!!e,this._calcBars()}get barSpace(){return this._barSpace}set barSpace(e){this._barSpace=+e||0,this._calcBars()}get channelLayout(){return this._chLayout}set channelLayout(e){this._chLayout=Me(e,[ue,$,Te]),this._input.disconnect(),this._input.connect(this._chLayout!=ue?this._splitter:this._analyzer[0]),this._analyzer[0].disconnect(),this._outNodes.length&&this._analyzer[0].connect(this._chLayout!=ue?this._merger:this._output),this._calcBars(),this._makeGrad()}get colorMode(){return this._colorMode}set colorMode(e){this._colorMode=Me(e,[Ie,et,tt])}get fftSize(){return this._analyzer[0].fftSize}set fftSize(e){for(const s of[0,1])this._analyzer[s].fftSize=e;const i=this._analyzer[0].frequencyBinCount;this._fftData=[new Float32Array(i),new Float32Array(i)],this._calcBars()}get frequencyScale(){return this._frequencyScale}set frequencyScale(e){this._frequencyScale=Me(e,[me,Pe,Xe,fe]),this._calcBars()}get gradient(){return this._selectedGrads[0]}set gradient(e){this._setGradient(e)}get gradientLeft(){return this._selectedGrads[0]}set gradientLeft(e){this._setGradient(e,0)}get gradientRight(){return this._selectedGrads[1]}set gradientRight(e){this._setGradient(e,1)}get height(){return this._height}set height(e){this._height=e,this._setCanvas(He)}get ledBars(){return this._showLeds}set ledBars(e){this._showLeds=!!e,this._calcBars()}get linearAmplitude(){return this._linearAmplitude}set linearAmplitude(e){this._linearAmplitude=!!e}get linearBoost(){return this._linearBoost}set linearBoost(e){this._linearBoost=e>=1?+e:1}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=+e||0}get loRes(){return this._loRes}set loRes(e){this._loRes=!!e,this._setCanvas(Pt)}get lumiBars(){return this._lumiBars}set lumiBars(e){this._lumiBars=!!e,this._calcBars(),this._makeGrad()}get maxDecibels(){return this._analyzer[0].maxDecibels}set maxDecibels(e){for(const i of[0,1])this._analyzer[i].maxDecibels=e}get maxFreq(){return this._maxFreq}set maxFreq(e){if(e<1)throw new oe(We);this._maxFreq=Math.min(e,this.audioCtx.sampleRate/2),this._calcBars()}get minDecibels(){return this._analyzer[0].minDecibels}set minDecibels(e){for(const i of[0,1])this._analyzer[i].minDecibels=e}get minFreq(){return this._minFreq}set minFreq(e){if(e<1)throw new oe(We);this._minFreq=+e,this._calcBars()}get mirror(){return this._mirror}set mirror(e){this._mirror=Math.sign(e)|0,this._calcBars(),this._makeGrad()}get mode(){return this._mode}set mode(e){const i=e|0;if(i>=0&&i<=10&&i!=9)this._mode=i,this._calcBars(),this._makeGrad();else throw new oe(Qt,e)}get noteLabels(){return this._noteLabels}set noteLabels(e){this._noteLabels=!!e,this._createScales()}get outlineBars(){return this._outlineBars}set outlineBars(e){this._outlineBars=!!e,this._calcBars()}get radial(){return this._radial}set radial(e){this._radial=!!e,this._calcBars(),this._makeGrad()}get reflexRatio(){return this._reflexRatio}set reflexRatio(e){if(e=+e||0,e<0||e>=1)throw new oe(Kt);this._reflexRatio=e,this._calcBars(),this._makeGrad()}get roundBars(){return this._roundBars}set roundBars(e){this._roundBars=!!e,this._calcBars()}get smoothing(){return this._analyzer[0].smoothingTimeConstant}set smoothing(e){for(const i of[0,1])this._analyzer[i].smoothingTimeConstant=e}get spinSpeed(){return this._spinSpeed}set spinSpeed(e){e=+e||0,(this._spinSpeed===void 0||e==0)&&(this._spinAngle=-ze),this._spinSpeed=e}get splitGradient(){return this._splitGradient}set splitGradient(e){this._splitGradient=!!e,this._makeGrad()}get stereo(){return _t("stereo","channelLayout"),this._chLayout!=ue}set stereo(e){_t("stereo","channelLayout"),this.channelLayout=e?$:ue}get trueLeds(){return this._trueLeds}set trueLeds(e){this._trueLeds=!!e}get volume(){return this._output.gain.value}set volume(e){this._output.gain.value=e}get weightingFilter(){return this._weightingFilter}set weightingFilter(e){this._weightingFilter=Me(e,[it,st,at,nt,rt,ot],"toUpperCase")}get width(){return this._width}set width(e){this._width=e,this._setCanvas(He)}get audioCtx(){return this._input.context}get canvas(){return this._canvasCtx.canvas}get canvasCtx(){return this._canvasCtx}get connectedSources(){return this._sources}get connectedTo(){return this._outNodes}get fps(){return this._fps}get fsHeight(){return this._fsHeight}get fsWidth(){return this._fsWidth}get isAlphaBars(){return this._flg.isAlpha}get isBandsMode(){return this._flg.isBands}get isFullscreen(){return(document.fullscreenElement||document.webkitFullscreenElement)===this._fsEl}get isLedBars(){return this._flg.isLeds}get isLumiBars(){return this._flg.isLumi}get isOctaveBands(){return this._flg.isOctaves}get isOn(){return this._runId!==void 0}get isOutlineBars(){return this._flg.isOutline}get pixelRatio(){return this._pixelRatio}get isRoundBars(){return this._flg.isRound}static get version(){return kt}connectInput(e){const i=e instanceof HTMLMediaElement;if(!(i||e.connect))throw new oe(Jt);const s=i?this.audioCtx.createMediaElementSource(e):e;return this._sources.includes(s)||(s.connect(this._input),this._sources.push(s)),s}connectOutput(e=this.audioCtx.destination){if(!this._outNodes.includes(e)&&(this._output.connect(e),this._outNodes.push(e),this._outNodes.length==1))for(const i of[0,1])this._analyzer[i].connect(this._chLayout==ue&&!i?this._output:this._merger,0,i)}disconnectInput(e){e?Array.isArray(e)||(e=[e]):e=Array.from(this._sources);for(const i of e){const s=this._sources.indexOf(i);s>=0&&(i.disconnect(this._input),this._sources.splice(s,1))}}disconnectOutput(e){if(!(e&&!this._outNodes.includes(e))&&(this._output.disconnect(e),this._outNodes=e?this._outNodes.filter(i=>i!==e):[],this._outNodes.length==0))for(const i of[0,1])this._analyzer[i].disconnect()}getBars(){return Array.from(this._bars,({posX:e,freq:i,freqLo:s,freqHi:d,hold:o,peak:l,value:a})=>({posX:e,freq:i,freqLo:s,freqHi:d,hold:o,peak:l,value:a}))}getEnergy(e,i){if(e===void 0)return this._energy.val;if(e!=+e){if(e=="peak")return this._energy.peak;const a={bass:[20,250],lowMid:[250,500],mid:[500,2e3],highMid:[2e3,4e3],treble:[4e3,16e3]};if(!a[e])return null;[e,i]=a[e]}const s=this._freqToBin(e),d=i?this._freqToBin(i):s,o=this._chLayout==ue?1:2;let l=0;for(let a=0;a<o;a++)for(let c=s;c<=d;c++)l+=this._normalizedB(this._fftData[a][c]);return l/(d-s+1)/o}registerGradient(e,i){if(typeof e!="string"||e.trim().length==0)throw new oe(Zt);if(typeof i!="object")throw new oe(ei);const{colorStops:s}=i;if(!Array.isArray(s)||!s.length)throw new oe(ti);const d=s.length,o=l=>+l!=l||l<0||l>1;s.forEach((l,a)=>{const c=a/Math.max(1,d-1);typeof l!="object"?s[a]={pos:c,color:l}:o(l.pos)&&(l.pos=c),o(l.level)&&(s[a].level=1-a/d)}),s.sort((l,a)=>l.level<a.level?1:l.level>a.level?-1:0),s[0].level=1,this._gradients[e]={bgColor:i.bgColor||Gt,dir:i.dir,colorStops:s},this._selectedGrads.includes(e)&&this._makeGrad()}setCanvasSize(e,i){this._width=e,this._height=i,this._setCanvas(He)}setFreqRange(e,i){if(e<1||i<1)throw new oe(We);this._minFreq=Math.min(e,i),this.maxFreq=Math.max(e,i)}setLedParams(e){let i,s,d;e&&(i=e.maxLeds|0,s=+e.spaceV,d=+e.spaceH),this._ledParams=i>0&&s>0&&d>=0?[i,s,d]:void 0,this._calcBars()}setOptions(e){this._setProps(e)}setSensitivity(e,i){for(const s of[0,1])this._analyzer[s].minDecibels=Math.min(e,i),this._analyzer[s].maxDecibels=Math.max(e,i)}toggleAnalyzer(e){const i=this.isOn;return e===void 0&&(e=!i),i&&!e?(cancelAnimationFrame(this._runId),this._runId=void 0):!i&&e&&(this._frame=this._fps=0,this._time=performance.now(),this._runId=requestAnimationFrame(s=>this._draw(s))),this.isOn}toggleFullscreen(){if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{const e=this._fsEl;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}}_binToFreq(e){return e*this.audioCtx.sampleRate/this.fftSize||1}_calcBars(){const e=this._bars=[];if(!this._ready)return;const i=this._barSpace,s=this.canvas,d=s.width>>1,o=this._chLayout,l=this._ansiBands,a=this._radial,c=o==$&&!a,h=this._maxFreq,t=this._minFreq,f=this._mode,m=f%10!=0,G=m&&this._frequencyScale==me,p=this._showLeds&&m&&!a,u=this._lumiBars&&m&&!a,y=this._alphaBars&&!u&&f!=10,K=this._outlineBars&&m&&!u&&!p,x=this._roundBars&&m&&!u&&!p,j=o!=$||this._reflexRatio>0&&!u,W=s.height-(c&&!p?.5:0)>>c,J=W*(u||a?1:1-this._reflexRatio)|0,E=s.width-d*(this._mirror!=0),N=c?s.height-W*2:0,B=d*(this._mirror==-1&&!a),Y=Math.min(s.width,s.height)*(o==$?.375:.125)|0,ee=R=>e.push({...R,peak:[0,0],hold:[0],value:[0]}),q=R=>{const b=this._freqToBin(R,"floor"),g=this._binToFreq(b),v=this._binToFreq(b+1),k=Math.log2(R/g)/Math.log2(v/g);return[b,k]};let T,L,w;if(G){const R=(S,O,te)=>+S.toPrecision(te?Math.max(O,1+Math.log10(S)|0):O),b=S=>{const O=[1,1.12,1.25,1.4,1.6,1.8,2,2.24,2.5,2.8,3.15,3.55,4,4.5,5,5.6,6.3,7.1,8,9,10],te=Math.log10(S)|0,we=S/10**te;let le=1;for(;le<O.length&&we>O[le];)le++;return we-O[le-1]<O[le]-we&&le--,(O[le]*10**(te+5)|0)/1e5},g=[0,24,12,8,6,4,3,2,1][this._mode],v=l?10**(3/(g*10)):2**(1/g),k=v**.5;let X=l?7.94328235/(g%2?1:k):Ze;do{let S=X;const O=R(S/k,4,!0),te=R(S*k,4,!0),[we,le]=q(O),[Ne,ke]=q(te);l?S=g<4?b(S):R(S,S.toString()[0]<5?3:2):S=R(S,4,!0),S>=t&&ee({posX:0,freq:S,freqLo:O,freqHi:te,binLo:we,binHi:Ne,ratioLo:le,ratioHi:ke}),X*=v}while(X<=h);T=E/e.length,e.forEach((S,O)=>S.posX=B+O*T);const D=e[0],Q=e[e.length-1];L=this._freqScaling(D.freqLo),w=E/(this._freqScaling(Q.freqHi)-L),D.freqLo<t&&(D.freqLo=t,[D.binLo,D.ratioLo]=q(t)),Q.freqHi>h&&(Q.freqHi=h,[Q.binHi,Q.ratioHi]=q(h))}else if(m){const R=[0,24,12,8,6,4,3,2,1][this._mode]*10,b=g=>{switch(this._frequencyScale){case Pe:return 1960/(26.81/(g+.53)-1);case Xe:return 700*(2**g-1);case fe:return g}};T=E/R,L=this._freqScaling(t),w=E/(this._freqScaling(h)-L);for(let g=0,v=0;g<R;g++,v+=T){const k=b(L+v/w),X=b(L+(v+T/2)/w),D=b(L+(v+T)/w),[Q,S]=q(k),[O,te]=q(D);ee({posX:B+v,freq:X,freqLo:k,freqHi:D,binLo:Q,binHi:O,ratioLo:S,ratioHi:te})}}else{T=1,L=this._freqScaling(t),w=E/(this._freqScaling(h)-L);const R=this._freqToBin(t,"floor"),b=this._freqToBin(h);let g=-999;for(let v=R;v<=b;v++){const k=this._binToFreq(v),X=B+Math.round(w*(this._freqScaling(k)-L));if(X>g)ee({posX:X,freq:k,freqLo:k,freqHi:k,binLo:v,binHi:v,ratioLo:0,ratioHi:0}),g=X;else if(e.length){const D=e[e.length-1];D.binHi=v,D.freqHi=k,D.freq=(D.freqLo*k)**.5}}}let I=0,_=0;if(p){const R=this._pixelRatio/(window.devicePixelRatio>1&&window.screen.height<=540?2:1),b=[[],[128,3,.45],[128,4,.225],[96,6,.225],[80,6,.225],[80,6,.125],[64,6,.125],[48,8,.125],[24,16,.125]],g=this._ledParams,[v,k,X]=g||b[f];let D,Q=J;if(g){const S=2*R;let O;D=v+1;do D--,O=Q/D/(1+k),_=O*k;while((O<S||_<S)&&D>1)}else{const S=540/k;_=Math.min(k*R,Math.max(2,Q/S+.1|0))}j&&(Q+=_),g||(D=Math.min(v,Q/(_*2)|0)),I=X>=1?X:T*X,this._leds=[D,I,_,Q/D-_]}const U=Math.min(T-1,i*(i>0&&i<1?T:1));m&&(T-=Math.max(p?I:0,U)),e.forEach((R,b)=>{let g=R.posX,v=T;m&&(i==0&&!p?(g|=0,v|=0,b>0&&g>e[b-1].posX+e[b-1].width&&(g--,v++)):g+=Math.max(p?I:0,U)/2,R.posX=g),R.barCenter=g+(T==1?0:v/2),R.width=v});const ce=[];for(const R of[0,1]){const b=o==$?(W+N)*R:0,g=b+W,v=b+J-(!p||j?0:_);ce.push({channelTop:b,channelBottom:g,analyzerBottom:v})}this._aux={analyzerHeight:J,analyzerWidth:E,channelCoords:ce,channelHeight:W,channelGap:N,initialX:B,radius:Y,scaleMin:L,unitWidth:w},this._flg={isAlpha:y,isBands:m,isLeds:p,isLumi:u,isOctaves:G,isOutline:K,isRound:x,noLedGap:j},this._createScales()}_createScales(){if(!this._ready)return;const{analyzerWidth:e,initialX:i,radius:s,scaleMin:d,unitWidth:o}=this._aux,l=this._canvasCtx.canvas,a=this._scaleX,c=this._scaleR,h=a.canvas,t=c.canvas,f=[],m=this._frequencyScale,G=this._noteLabels,p=this._radial,u=this._chLayout==$,y=this._mirror,K=["C",,"D",,"E","F",,"G",,"A",,"B"],x=Math.min(l.width,l.height)/34|0,j=h.height>>1,W=x>>1,J=j*(G?.7:1.5),E=W*(G?1:2),N=2**(1/12);if(!G&&(this._ansiBands||m!=me))f.push(16,31.5,63,125,250,500,1e3,2e3,4e3),m==fe?f.push(6e3,8e3,1e4,12e3,14e3,16e3,18e3,2e4,22e3):f.push(8e3,16e3);else{let L=Ze;for(let w=-1;w<11;w++)for(let I=0;I<12;I++){if(L>=this._minFreq&&L<=this._maxFreq){const _=K[I],U=_=="C";(_&&G&&!y||U)&&f.push(G?[L,_+(U?w:"")]:L)}L*=N}}t.width=t.height=(s<<1)+u*x;const B=t.width>>1,Y=B-x*.7,ee=(L,w)=>{const I=Ae*(L/l.width),_=I-ze,U=Y*Math.cos(_),ce=Y*Math.sin(_);c.save(),c.translate(B+U,B+ce),c.rotate(I),c.fillText(w,0,0),c.restore()};h.width|=0,a.fillStyle=c.strokeStyle=Wt,a.fillRect(0,0,h.width,h.height),c.arc(B,B,B-x/2,0,Ae),c.lineWidth=x,c.stroke(),a.fillStyle=c.fillStyle=ht,a.font=`${j}px ${Oe}`,c.font=`${W}px ${Oe}`,a.textAlign=c.textAlign="center";let q=-J/4,T=-E;for(const L of f){const[w,I]=Array.isArray(L)?L:[L,L<1e3?L|0:`${(L/100|0)/10}k`],_=o*(this._freqScaling(w)-d),U=h.height*.75,ce=I[0]=="C",R=j*(G&&!y?ce?1.2:.6:3);if(a.fillStyle=c.fillStyle=ce&&!y?Ut:ht,G){let b=["C"];if((m==me||w>2e3||m!=fe&&w>250||(!p||u)&&(m!=fe&&w>125||w>1e3))&&b.push("G"),(m==me||w>4e3||m!=fe&&w>500||(!p||u)&&(m!=fe&&w>250||w>2e3))&&b.push("E"),(m==fe&&w>4e3||(!p||u)&&(m==me||w>2e3||m!=fe&&w>500))&&b.push("D","F","A","B"),!b.includes(I[0]))continue}_>=q+J/2&&_<=e&&(a.fillText(I,i+_,U,R),y&&(_>J||y==1)&&a.fillText(I,(i||l.width)-_,U,R),q=_+Math.min(R,a.measureText(I).width)/2),_>=T+E&&_<e-E&&(ee(_,I),y&&(_>E||y==1)&&ee(-_,I),T=_)}}_draw(e){const{isAlpha:i,isBands:s,isLeds:d,isLumi:o,isOctaves:l,isOutline:a,isRound:c,noLedGap:h}=this._flg,t=this._canvasCtx,f=t.canvas,m=this._scaleX.canvas,G=this._scaleR.canvas,p=this._canvasGradients,u=f.width>>1,y=f.height>>1,K=this._colorMode,x=this._energy,j=this.fillAlpha,W=this._mode,J=this._linearAmplitude,E=this.overlay,N=this._radial,B=d&&this._trueLeds&&K==Ie,Y=this._chLayout,ee=this._lineWidth,q=this._mirror,{analyzerHeight:T,channelCoords:L,channelHeight:w,channelGap:I,initialX:_,radius:U}=this._aux,ce=N?f.width:this._aux.analyzerWidth,R=_+ce,b=this.showBgColor,g=N?Math.min(u,y)-U:T,v=this.maxDecibels,k=this.minDecibels,X=this.useCanvas,D=this._weightingFilter,[Q,S,O,te]=this._leds||[];x.val>0&&(this._spinAngle+=this._spinSpeed*Ft);const we=n=>{if(this._reflexRatio>0&&!o){let r,z;this.reflexFit||Y==$?(r=Y==$&&n==0?w+I:0,z=w-T):(r=f.height-T*2,z=T),t.save(),t.globalAlpha=this.reflexAlpha,this.reflexBright!=1&&(t.filter=`brightness(${this.reflexBright})`),t.setTransform(1,0,0,-1,0,f.height),t.drawImage(f,0,L[n].channelTop,f.width,T,0,r,f.width,z),t.restore()}},le=()=>{this.showScaleX&&(N?(t.save(),t.translate(u,y),this._spinSpeed&&t.rotate(this._spinAngle+ze),t.drawImage(G,-G.width>>1,-G.width>>1),t.restore()):t.drawImage(m,0,f.height-m.height))},Ne=n=>{const r=m.height,z=r>>1,A=J?100:v,ie=J?0:k,H=J?20:5,Z=T/(A-ie);t.save(),t.fillStyle=ct,t.font=`${z}px ${Oe}`,t.textAlign="right",t.lineWidth=1;for(let V=A;V>ie;V-=H){const he=n+(A-V)*Z,ge=V%2==0|0;if(ge){const pe=he+z*(he==n?.8:.35);q!=-1&&t.fillText(V,r*.85,pe),q!=1&&t.fillText(V,f.width-r*.1,pe),t.strokeStyle=ct,t.setLineDash([2,4]),t.lineDashOffset=0}else t.strokeStyle=Vt,t.setLineDash([2,8]),t.lineDashOffset=1;t.beginPath(),t.moveTo(_+r*ge*(q!=-1),~~he+.5),t.lineTo(R-r*ge*(q!=1),~~he+.5),t.stroke()}t.restore()},ke=n=>{const r=n**2,z=424.36,A=11599.29,ie=25122.25,H=544496.41,Z=148693636,V=he=>20*Math.log10(he);switch(D){case st:const he=Z*r**2/((r+z)*Math.sqrt((r+A)*(r+H))*(r+Z));return 2+V(he);case at:const ge=Z*r*n/((r+z)*Math.sqrt(r+ie)*(r+Z));return .17+V(ge);case nt:const pe=Z*r/((r+z)*(r+Z));return .06+V(pe);case rt:const se=((103791848e-2-r)**2+108076816e-2*r)/((9837328-r)**2+11723776*r),Ee=n/68966888496476e-18*Math.sqrt(se/((r+79919.29)*(r+1345600)));return V(Ee);case ot:const M=-4737338981378384e-39*n**6+2043828333606125e-30*n**4-1363894795463638e-22*r+1,P=1306612257412824e-34*n**5-2118150887518656e-26*n**3+.0005559488023498642*n,C=.0001246332637532143*n/Math.hypot(M,P);return 18.2+V(C)}return 0},Fe=(n,r,z)=>{t.beginPath(),t.moveTo(n,r),t.lineTo(n,z),t.stroke()},Ge=n=>{if(n&&ee){const r=t.globalAlpha;t.globalAlpha=1,t.stroke(),t.globalAlpha=r}},qe=(n,r)=>r*Ae*(n/f.width)+this._spinAngle,Re=(n,r,z)=>{const A=U+r,ie=qe(n,z);return[u+A*Math.cos(ie),y+A*Math.sin(ie)]},Ue=(n,r,z,A,ie)=>{t.beginPath();for(const H of q?[1,-1]:[1]){const[Z,V]=c?[qe(n,H),qe(n+z,H)]:[];t.moveTo(...Re(n,r,H)),t.lineTo(...Re(n,r+A,H)),c?t.arc(u,y,U+r+A,Z,V,H!=1):t.lineTo(...Re(n+z,r+A,H)),t.lineTo(...Re(n+z,r,H)),c&&!ie&&t.arc(u,y,U+r,V,Z,H==1)}Ge(ie),t.fill()},ye=n=>Math.max(0,(n*Q|0)*(te+O)-O),ut=n=>{x.val=n,n>=x.peak?(x.peak=n,x.hold=30):x.hold>0?x.hold--:x.peak>0&&(x.peak*=(30+x.hold--)/30)},gt=()=>{this._frame++;const n=e-this._time;if(n>=1e3&&(this._fps=this._frame/(n/1e3),this._frame=0,this._time=e),this.showFPS){const r=m.height;t.font=`bold ${r}px ${Oe}`,t.fillStyle=qt,t.textAlign="right",t.fillText(Math.round(this._fps),f.width-r,r*2)}};let Ve=0;const Se=this._bars,$e=Se.length,Ye=Y==ue?1:2;for(let n=0;n<Ye;n++){const{channelTop:r,channelBottom:z,analyzerBottom:A}=L[n],ie=this._gradients[this._selectedGrads[n]],H=ie.colorStops,Z=H.length,V=!b||d&&!E?"#000":ie.bgColor,he=n==0||!N&&Y!=Te,ge=(M,P)=>{const C=se[M]+(M<se.length-1?(se[M+1]-se[M])*P:0);return isNaN(C)?-1/0:C},pe=(M=0,P=0)=>{let C;if(K==Ie&&!B||W==10)C=p[n];else{const Le=K==et?P%Z:H.findLastIndex(de=>d?ye(M)<=ye(de.level):M<=de.level);C=H[Le].color}t.fillStyle=t.strokeStyle=C};if(X&&(E&&he&&t.clearRect(0,r-I,f.width,w+I),(!E||b)&&(E&&(t.globalAlpha=this.bgAlpha),t.fillStyle=V,he&&t.fillRect(_,r-I,ce,(E&&this.reflexAlpha==1?T:w)+I),t.globalAlpha=1),this.showScaleY&&!o&&!N&&(n==0||Y!=Te)&&Ne(r),d?(t.setLineDash([te,O]),t.lineWidth=Se[0].width):t.lineWidth=a?Math.min(ee,Se[0].width/2):ee,t.save(),!N)){const M=new Path2D;M.rect(0,r,f.width,T),t.clip(M)}let se=this._fftData[n];this._analyzer[n].getFloatFrequencyData(se),D&&(se=se.map((M,P)=>M+ke(this._binToFreq(P)))),t.beginPath();let Ee=[];for(let M=0;M<$e;M++){const P=Se[M],{posX:C,barCenter:Le,width:de,freq:ui,binLo:Be,binHi:je,ratioLo:pt,ratioHi:mt}=P;let ae=Math.max(ge(Be,pt),ge(je,mt));for(let F=Be+1;F<je;F++)se[F]>ae&&(ae=se[F]);if(ae=this._normalizedB(ae),P.value[n]=ae,Ve+=ae,P.peak[n]>0&&(P.hold[n]--,P.hold[n]<0&&(P.peak[n]+=P.hold[n]/g)),ae>=P.peak[n]&&(P.peak[n]=ae,P.hold[n]=30),!X)continue;o||i?t.globalAlpha=ae:a&&(t.globalAlpha=j),pe(ae,M);let ne=o?g:d?ye(ae):ae*g|0;if(N&&n==1&&Y==$&&(ne*=-1),W==10){const F=M?0:(this._normalizedB(se[Se[1].binLo])*g*(n&&N&&Y==$?-1:1)+ne)/2;if(N){if(M==0&&t.lineTo(...Re(0,C<0?F:ne,1)),C>=0){const re=[C,ne];t.lineTo(...Re(...re,1)),Ee.push(re)}}else{if(M==0)if(q!=-1){const re=Be?this._normalizedB(se[Be-1])*g:ne;t.moveTo(_-ee,A-re)}else t.moveTo(_,A-(C<_?F:ne));(q!=-1||C>=_)&&t.lineTo(C,A-ne)}}else if(d){if(b&&!E&&(n==0||Y!=Te)){const F=t.globalAlpha;t.strokeStyle=zt,t.globalAlpha=1,Fe(Le,r,A),t.strokeStyle=t.fillStyle,t.globalAlpha=F}if(B){const F=o?0:H.findLastIndex(be=>ye(ae)<=ye(be.level));let re=A;for(let be=Z-1;be>=F;be--){t.strokeStyle=H[be].color;let Qe=A-(be==F?ne:ye(H[be].level));Fe(Le,re,Qe),re=Qe-O}}else Fe(Le,A,A-ne)}else if(C>=_)if(N)Ue(C,0,de,ne,a);else if(c){const F=de/2,re=A+F;t.beginPath(),t.moveTo(C,re),t.lineTo(C,re-ne),t.arc(Le,re-ne,F,Math.PI,Ae),t.lineTo(C+de,re),Ge(a),t.fill()}else{const F=a?t.lineWidth:0;t.beginPath(),t.rect(C,A+F,de,-ne-F),Ge(a),t.fill()}const ve=P.peak[n];if(ve>0&&this.showPeaks&&!o&&C>=_&&C<R)if(a&&ee>0?t.globalAlpha=1:i&&(t.globalAlpha=ve),(K==tt||B)&&pe(ve),d){const F=ye(ve);F>=O&&t.fillRect(C,A-F,de,te)}else N?W!=10&&Ue(C,ve*g*(n&&Y==$?-1:1),de,-2):t.fillRect(C,A-ve*g,de,2)}if(X){if(t.restore(),t.globalAlpha=1,W==10){if(pe(),N){if(q){let M;for(;M=Ee.pop();)t.lineTo(...Re(...M,-1))}t.closePath()}ee>0&&t.stroke(),j>0&&(N?(t.moveTo(u+U,y),t.arc(u,y,U,0,Ae,!0)):(t.lineTo(R,A),t.lineTo(_,A)),t.globalAlpha=j,t.fill(),t.globalAlpha=1)}we(n)}}ut(Ve/($e<<Ye-1)),X&&(q&&!N&&(t.setTransform(-1,0,0,1,f.width-_,0),t.drawImage(f,_,0,u,f.height,0,0,u,f.height),t.setTransform(1,0,0,1,0,0)),t.setLineDash([]),le()),gt(),this.onCanvasDraw&&(t.save(),t.fillStyle=t.strokeStyle=p[0],this.onCanvasDraw(this,{timestamp:e,canvasGradients:p}),t.restore()),this._runId=requestAnimationFrame(n=>this._draw(n))}_freqScaling(e){switch(this._frequencyScale){case me:return Math.log2(e);case Pe:return 26.81*e/(1960+e)-.53;case Xe:return Math.log2(1+e/700);case fe:return e}}_freqToBin(e,i="round"){const s=this._analyzer[0].frequencyBinCount-1,d=Math[i](e*this.fftSize/this.audioCtx.sampleRate);return d<s?d:s}_makeGrad(){if(!this._ready)return;const e=this._canvasCtx,i=e.canvas,s=this._chLayout,{isLumi:d}=this._flg,o=this._radial,l=d?i.height:i.height*(1-this._reflexRatio*(s!=$))|0,a=1-this._reflexRatio,{analyzerWidth:c,initialX:h,radius:t}=this._aux,f=i.width>>1,m=i.height>>1,G=Math.min(f,m);for(const p of[0,1]){const u=this._gradients[this._selectedGrads[p]],y=u.colorStops,K=u.dir=="h";let x;if(o?x=e.createRadialGradient(f,m,G,f,m,t-(G-t)*(s==$)):x=e.createLinearGradient(...K?[h,0,h+c,0]:[0,0,0,l]),y){const j=s==$&&!this._splitGradient&&(!K||o);for(let W=0;W<1+j;W++){const J=y.length-1;y.forEach((E,N)=>{let B=E.pos;if(j&&(B/=2),s==$&&!d&&!o&&!K&&(B*=a,!j&&B>.5*a&&(B+=.5*this._reflexRatio)),W==1)if(o||d){const Y=J-N;E=y[Y],B=1-E.pos/2}else N==0&&B>0&&x.addColorStop(.5,E.color),B+=.5;x.addColorStop(B,E.color),s==$&&N==J&&B<.5&&x.addColorStop(.5,E.color)})}}this._canvasGradients[p]=x}}_normalizedB(e){const i=this._linearAmplitude,s=i?1/this._linearBoost:1,d=(c,h,t)=>c<=h?h:c>=t?t:c,o=c=>10**(c/20);let l=this.maxDecibels,a=this.minDecibels;return i&&(l=o(l),a=o(a),e=o(e)**s),d((e-a)/(l-a)**s,0,1)}_setCanvas(e){if(!this._ready)return;const i=this._canvasCtx,s=i.canvas,d=this._scaleX.canvas,o=window.devicePixelRatio/(this._loRes+1);let l=window.screen.width*o,a=window.screen.height*o;Math.abs(window.orientation)==90&&l<a&&([l,a]=[a,l]);const c=this.isFullscreen,h=c&&this._fsEl==s,t=h?l:(this._width||this._container.clientWidth||this._defaultWidth)*o|0,f=h?a:(this._height||this._container.clientHeight||this._defaultHeight)*o|0;this._pixelRatio=o,this._fsWidth=l,this._fsHeight=a,!(s.width==t&&s.height==f)&&(s.width=t,s.height=f,this.overlay||(i.fillStyle="#000",i.fillRect(0,0,t,f)),i.lineJoin="bevel",d.width=t,d.height=Math.max(20*o,Math.min(t,f)/32|0),this._calcBars(),this._makeGrad(),this._fsStatus!==void 0&&this._fsStatus!==c&&(e=lt),this._fsStatus=c,this.onCanvasResize&&this.onCanvasResize(e,this))}_setGradient(e,i){if(!this._gradients.hasOwnProperty(e))throw new oe(jt,e);[0,1].includes(i)||(this._selectedGrads[1]=e,i=0),this._selectedGrads[i]=e,this._makeGrad()}_setProps(e,i){const s={alphaBars:!1,ansiBands:!1,barSpace:.1,bgAlpha:.7,channelLayout:ue,colorMode:Ie,fftSize:8192,fillAlpha:1,frequencyScale:me,gradient:ft[0][0],ledBars:!1,linearAmplitude:!1,linearBoost:1,lineWidth:0,loRes:!1,lumiBars:!1,maxDecibels:-25,maxFreq:22e3,minDecibels:-85,minFreq:20,mirror:0,mode:0,noteLabels:!1,outlineBars:!1,overlay:!1,radial:!1,reflexAlpha:.15,reflexBright:1,reflexFit:!0,reflexRatio:0,roundBars:!1,showBgColor:!0,showFPS:!1,showPeaks:!0,showScaleX:!0,showScaleY:!1,smoothing:.5,spinSpeed:0,splitGradient:!1,start:!0,trueLeds:!1,useCanvas:!0,volume:1,weightingFilter:it},d=["onCanvasDraw","onCanvasResize"],o=["gradientLeft","gradientRight","height","width","stereo"],l=Object.keys(s).filter(a=>a!="start").concat(d,o);(i||e===void 0)&&(e={...s,...e});for(const a of Object.keys(e))d.includes(a)&&typeof e[a]!="function"?this[a]=void 0:l.includes(a)&&(this[a]=e[a]);e.start!==void 0&&this.toggleAnalyzer(e.start)}}const si={class:"flex flex-col justify-center text-white"},ai={class:"fullscreen-container rounded-3xl overflow-hidden m-4",id:"screen"},ni=["width","height"],ri={class:"absolute top-4 left-4 text-xl select-none"},oi={key:0,class:"i-la-play"},li={key:1,class:"i-la-pause"},hi=xe("div",{class:"i-la-trash-alt"},null,-1),ci=[hi],di={__name:"spectrogram",setup(_e){const{mic:e,input:i}=Lt(),s=xt(!1);Ke(" ",p=>{s.value=!s.value,p.preventDefault()}),Ke("Enter",p=>{c(),p.preventDefault()});let d,o,l,a;function c(){o.fillStyle="#000",o.fillRect(0,0,h.width,h.height)}const h=At({initiated:!1,width:800,height:240,speed:St(()=>Math.floor(h.speedCount/100)),speedCount:vt(100,100,300)});function t(p){p.tap&&(s.value=!s.value),h.speedCount-=p.delta[0]/2}Ct(()=>{Rt(),d=document.getElementById("spectrogram"),o=d.getContext("2d"),l=document.createElement("canvas"),a=l.getContext("2d"),l.width=h.width,l.height=h.height,o.fillStyle="#000",o.fillRect(0,0,h.width,h.height)});let f;function m(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(()=>{h.initiated=!0,f=new ii(null,{mode:1,connectSpeakers:!1,volume:0,useCanvas:!1,source:yt.meter,onCanvasDraw(p){if(s.value)return;a.drawImage(d,0,0,h.width,h.height);let u=p.getBars();for(let y=0;y<u.length;y++)o.fillStyle=G((u[y].freqLo+u[y].freqHi)/2,u[y].value[0]),o.fillRect(h.width-h.speed,h.height-y*(h.height/u.length),h.speed,1);o.translate(-h.speed,0),o.drawImage(l,0,0,h.width,h.height),o.setTransform(1,0,0,1,0,0)}}),e.open=!0,f.connectInput(i)}).catch(p=>{console.log("mic denied",p)})}function G(p,u){return`hsl(${bt(p)*30}, ${u*100}%, ${u*80}%)`}return(p,u)=>{const y=wt,K=Et("drag");return Ce(),De("div",si,[xe("div",ai,[Bt(xe("canvas",{class:"h-full min-h-30em w-full rounded-md cursor-pointer",id:"spectrogram",width:h.width,height:h.height},null,8,ni),[[K,t]]),h.initiated?It("",!0):(Ce(),Tt(y,{key:0,class:"absolute",onClick:u[0]||(u[0]=x=>m())})),xe("div",ri,"x"+Ot(h.speed),1),xe("button",{class:"absolute bottom-4 left-4 text-xl select-none cursor-pointer",onMousedown:u[1]||(u[1]=x=>s.value=!s.value)},[s.value?(Ce(),De("div",oi)):(Ce(),De("div",li))],32),xe("button",{class:"absolute top-4 right-4 text-xl select-none cursor-pointer",onMousedown:u[2]||(u[2]=x=>c())},ci,32)])])}}},fi=Nt('<p>The colorful spectrogram is a powerful tool for visual audio analysis. Each particular frequency in the spectrum gets it&#39;s own position on the vertical axis along with the corresponding Chromatone color. The pitch spectrum is continous and the graph shows all the partials in a rather high resolution. The colors of the lines help differentiate pitches and overtones in any incoming audio signal. The quality of analysis is based primarily on the quality of the signal – thus a good microphone is recommended for best experience.</p><h2 id="how-to-use-the-spectrogram" tabindex="-1">How to use the spectrogram <a class="header-anchor" href="#how-to-use-the-spectrogram" aria-label="Permalink to &quot;How to use the spectrogram&quot;">​</a></h2><ol><li>Drag across <i class="p-3 mr-1 i-la-hand-rock"></i> the spectrogram top change the roll speed. The actual setting is at the top-left corner.</li><li>Press the <i class="p-3 mr-1 i-la-expand"></i> icon at the bottom-right corner make the spectrogram go full screen. Very useful mode for deep explorations and teaching.</li><li>You can pause <i class="p-3 mr-1 i-la-pause"></i> and resume <i class="p-3 mr-1 i-la-play"></i> the roll either by clicking anywhere at the spectrogram or by pressing the <code>Spacebar</code> button on your keyboard. Useful when comparing two or more sound spectrums – record a sound spectrum on the roll, then pause it, take another instrument and record another. The roll can fit up to 10 segments or even more.</li><li>Clear the canvas with the <i class="p-3 mr-1 i-la-trash-alt"></i> button at the top-right corner or by pressing the <code>Enter</code> button on your keyboard.</li></ol>',3),Ci=JSON.parse('{"title":"Spectrogram","description":"2.5D representation on frequency domain in time","frontmatter":{"title":"Spectrogram","description":"2.5D representation on frequency domain in time","date":"2022-06-16T00:00:00.000Z","cover":"spectrogram.png","usefulLinks":["https://codepen.io/hvianna/pen/ZEKWWJb","https://www.npmjs.com/package/audiomotion-analyzer","https://github.com/ListeningToWaves/SpectrogramTesting/blob/master/src/components/spectrogram.js"]},"headers":[],"relativePath":"practice/pitch/spectrogram/index.md","filePath":"practice/pitch/spectrogram/index.md","lastUpdated":1676883357000}'),_i={name:"practice/pitch/spectrogram/index.md"},Ei=Object.assign(_i,{setup(_e){return(e,i)=>{const s=Mt("client-only");return Ce(),De("div",null,[Je(s,null,{default:Dt(()=>[Je(di,{class:"mb-8"})]),_:1}),fi])}}});export{Ci as __pageData,Ei as default};
