import{aV as L,a2 as W,c as G,g as B,y as Q,i as X,ao as Y,aW as Z,ai as ee,t as te,v as oe,aX as se,aI as ae,n as b,ak as T,B as ne,J as ie}from"./chunks/theme.EZv__huw.js";import{B as j,U as re,b as E,u as f,c as q,l as le,w as pe,o as ue,d as x,q as de,Y as ce,C as p,D as u,F as i,G as M,H as D,M as P,K as g,L as I,E as A,$ as H,I as d,a0 as _,T as me,a2 as ve,N as R,P as fe,Q as ge}from"./chunks/framework.BmjQO8gg.js";const w=h=>(fe("data-v-4254363d"),h=h(),ge(),h),_e={class:"flex flex-col"},he=w(()=>i("div",{class:"row"},[i("div",{class:"title"})],-1)),ye=["id","onMousedown","onMouseenter"],be={class:"flex flex-wrap items-center justify-center mx-2 gap-2"},xe={class:"flex flex-wrap items-center justify-center bg-light-900 p-4 rounded-2xl dark-bg-dark-800 gap-2",style:{flex:"5 1 200px"}},we=["value"],ke={class:"is-group flex flex-wrap p-2"},qe={class:"is-group flex items-center"},Ve=w(()=>i("div",{class:"i-la-trash-alt"},null,-1)),Ce=[Ve],Se={class:"is-group flex items-center"},$e=w(()=>i("div",{class:"i-la-play"},null,-1)),Ee=[$e],Me=w(()=>i("div",{class:"i-la-pause"},null,-1)),De=[Me],Pe=w(()=>i("div",{class:"i-la-stop"},null,-1)),Ue=[Pe],ze={__name:"StepSequencer",setup(h){const{isDark:V}=re(),U=L(),C=W(),t=E({started:!1,playing:!1,hover:!1,mounted:!1,current:0,octave:f("seq-octave",3),bpm:f("seq-bpm",120),steps:f("seq-steps",16),type:f("seq-type","up"),probability:f("seq-prob",1),humanize:f("seq-human",!1),interval:f("seq-interval","8n"),note:q(()=>G[B.tonic]),range:q(()=>Q.rangeOf(t.note+t.octave+" "+B.set.name)(t.note+t.octave,t.note+(t.octave+2)).map(o=>X.simplify(o)).reverse()),midi:q(()=>t.range.map(o=>Y.toMidi(o))),pitches:q(()=>t.midi.map(o=>(o+3)%12)),progress:0}),z=["up","down","upDown","downUp","alternateUp","alternateDown","random","randomWalk","randomOnce"],n=E([]),y=E([]);let c=[];le(" ",o=>{o.preventDefault(),t.playing=!t.playing}),pe(()=>{t.range.forEach((o,e)=>{n[e]=n[e]||[],n[e].length=t.steps,n.length=t.range.length,Array.apply(null,n[e]).forEach((s,r)=>{n[e][r]={row:e,cell:r,note:o,active:(s==null?void 0:s.active)||!1}})})}),ue(()=>{t.mounted=!0,Z(),S()}),x(()=>t.steps,()=>{t.mounted&&S()},{immediate:!0});function S(){c.forEach(o=>{o.stop(0),o.dispose()}),c=[],n.forEach((o,e)=>{c[e]=new ee((m,s)=>{U.schedule(()=>{y[e]=s==null?void 0:s.cell,s!=null&&s.active&&te(s==null?void 0:s.note)},m),s!=null&&s.active&&(oe(s.note,t.interval,m),se(s.note,t.interval,m))},n[e],t.type).start(0),c[e].interval=t.interval})}let N;function O(o,e,m,s){!t.hover&&!m||!m&&N==s.target.id||(N=s.target.id,n[o][e].active?n[o][e].active=!1:n[o][e].active=!0)}function F(){n.forEach((o,e)=>{o.forEach((m,s)=>n[e][s].active=!1)})}x(()=>t.playing,o=>{o?(c.forEach(e=>{e.start(0)}),C.start(),t.started||(ae(),t.started=!0)):(c.forEach(e=>{e.stop()}),C.stop())}),x(()=>t.type,o=>{c.forEach(e=>{e.pattern=o})},{immediate:!0}),x(()=>t.probability,o=>{c.forEach(e=>{e.probability=o})},{immediate:!0}),x(()=>t.humanize,o=>{c.forEach(e=>{e.humanize=o})},{immediate:!0});function J(){t.playing=!1,S()}de(()=>{c.forEach(o=>{o.stop(0),o.dispose()})});function K(o,e){return o.active?b(t.pitches[e]):o.cell==y[e]?V.value?"#eee7":"#3337":"#4444"}return(o,e)=>{const m=ne,s=ie,r=ce("tooltip");return p(),u("div",_e,[i("div",{class:"rows",onMousedown:e[0]||(e[0]=a=>t.hover=!0),onMouseleave:e[1]||(e[1]=H(a=>t.hover=!1,["self"])),onMouseup:e[2]||(e[2]=a=>t.hover=!1)},[he,(p(!0),u(M,null,D(n,(a,l)=>(p(),u("div",{class:"row",key:a},[i("div",{class:"title m-1 rounded-md shadow",style:P({color:g(b)(t.pitches[l]),backgroundColor:t.range[l].length>2?"#0005":"#aaa5"})},I(t.range[l]),5),(p(!0),u(M,null,D(a,(v,k)=>(p(),u("div",{class:A(["cell",{active:v==null?void 0:v.active,current:v.cell==y[l]}]),id:`c${l}-${k}`,key:v,style:P({color:g(b)(t.pitches[l]),borderColor:K(v,l),backgroundColor:v.cell==y[l]?v.active?g(b)(t.pitches[l],3):g(V)?"#0005":"#fff5":"transparent",marginRight:k%4==3?"12px":"1px"}),onMousedown:H($=>O(l,k,!0,$),["prevent"]),onMouseenter:$=>O(l,k,!1,$)},[i("div",{class:"dot",style:P({backgroundColor:v.active?g(b)(t.pitches[l]):v.cell==y[l]?"currentColor":"#4448"})},null,4)],46,ye))),128))]))),128))],32),i("div",be,[d(_(m,{style:{flex:"1 1 100px"}},null,512),[[r,"Select root note and scale",void 0,{top:!0}]]),i("div",xe,[d((p(),u("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>t.type=a)},[(p(),u(M,null,D(z,a=>i("option",{key:a,value:a},I(a),9,we)),64))])),[[me,t.type],[r,"Pattern type",void 0,{top:!0}]]),i("div",ke,[d(_(s,{modelValue:t.octave,"onUpdate:modelValue":e[4]||(e[4]=a=>t.octave=a),max:4,min:2,fixed:0,param:"OCTAVE"},null,8,["modelValue"]),[[r,"Octave",void 0,{top:!0}]]),d(_(s,{modelValue:t.steps,"onUpdate:modelValue":e[5]||(e[5]=a=>t.steps=a),max:32,min:4,step:1,fixed:0,param:"steps"},null,8,["modelValue"]),[[r,"Number of steps",void 0,{top:!0}]]),d(_(s,{modelValue:t.probability,"onUpdate:modelValue":e[6]||(e[6]=a=>t.probability=a),max:1,min:0,step:.01,fixed:2,param:"prob"},null,8,["modelValue"]),[[r,"Probability",void 0,{top:!0}]]),d(_(s,{modelValue:g(T).bpm,"onUpdate:modelValue":e[7]||(e[7]=a=>g(T).bpm=a),step:1,max:400,min:10,fixed:0,param:"BPM"},null,8,["modelValue"]),[[r,"Set tempo",void 0,{top:!0}]])]),i("div",qe,[d((p(),u("button",{class:A(["text-button",{active:t.humanize}]),onClick:e[8]||(e[8]=a=>t.humanize=!t.humanize)},[ve("HMN")],2)),[[r,"Humanize rhythm",void 0,{bottom:!0}]]),d((p(),u("button",{class:"text-button",onClick:e[9]||(e[9]=a=>F())},Ce)),[[r,"Clear pattern",void 0,{bottom:!0}]])]),i("div",Se,[t.playing?R("",!0):d((p(),u("button",{key:0,class:"text-button",onClick:e[10]||(e[10]=a=>t.playing=!0)},Ee)),[[r,"Play",void 0,{bottom:!0}]]),t.playing?d((p(),u("button",{key:1,class:"text-button",onClick:e[11]||(e[11]=a=>t.playing=!1)},De)),[[r,"Pause",void 0,{bottom:!0}]]):R("",!0),d((p(),u("button",{class:"text-button",onClick:e[12]||(e[12]=a=>J())},Ue)),[[r,"Stop",void 0,{bottom:!0}]])])])])])}}},Ne=j(ze,[["__scopeId","data-v-4254363d"]]),Ae=JSON.parse('{"title":"Step sequencer","description":"A simple tool to build up melodies and chord progressions","frontmatter":{"title":"Step sequencer","description":"A simple tool to build up melodies and chord progressions","layout":"app","date":"2021-08-19T00:00:00.000Z","cover":"sequencer.png"},"headers":[],"relativePath":"practice/sequencing/sequencer/index.md","filePath":"practice/sequencing/sequencer/index.md","lastUpdated":1720255337000}'),Oe={name:"practice/sequencing/sequencer/index.md"};function Be(h,V,U,C,t,z){const n=Ne;return p(),u("div",null,[_(n)])}const He=j(Oe,[["render",Be]]);export{Ae as __pageData,He as default};
