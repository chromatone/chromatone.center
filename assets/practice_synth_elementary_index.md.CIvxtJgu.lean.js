import{_ as E}from"./chunks/MidiKeys.plPqulRM.js";import{u as V,aU as M,w as P,ae as A,_ as U}from"./chunks/theme.Rq0zd7o2.js";import{_ as C}from"./chunks/AnalysisScope.BL9Y3rz2.js";import{_ as I}from"./chunks/AnalysisFFT.zuG6Nfet.js";import{b as j,d as N,o as z,x as B,c as D,E as p,F as g,G as y,O as x,V as k,W as $,L as F,C as l,Q as S,I as T,a2 as O,D as K,X as L,a4 as G}from"./chunks/framework.CAro41Y4.js";import{s as e,u as J}from"./chunks/useAudio.D94y2qdK.js";import{u as Q}from"./chunks/useUI.CiRkOrxZ.js";function R(f,s){return e.mul(440,e.pow(2,e.smooth(e.tau2pole(.001),e.const({key:`${s}:frequency`,value:(f-69)/12}))))}const W={"main:volume":{value:.2,min:0,max:1,step:.01},"osc:gain":{value:.5,min:0,max:1,step:.01},"osc:cut-off":{value:4,min:1,max:8,step:.5},"osc:cut-q":{value:1.1,min:0,max:5,step:.01},"osc:attack":{value:.01,min:.001,max:5,step:.01},"osc:decay":{value:.01,min:.001,max:4,step:.01},"osc:sustain":{value:.5,min:0,max:1,step:.01},"osc:release":{value:.01,min:.001,max:10,step:.01},"noise:gain":{value:.5,min:0,max:1,step:.01},"noise:band-q":{value:50,min:0,max:100,step:.1},"noise:attack":{value:.01,min:.001,max:5,step:.01},"noise:decay":{value:.01,min:.001,max:4,step:.01},"noise:sustain":{value:.5,min:0,max:1,step:.01},"noise:release":{value:.01,min:.001,max:10,step:.01},"fx:pingPong":{value:.3,min:0,max:1,step:.01}};function X(f=12){const s=j({list:Array(f).fill(!0).map((t,i)=>({key:`v${i}`,gate:0,midi:69,vel:0})),next:0,overflow:0});function c(t=60,i=0){if(i){do if(s.next++,s.next>=s.list.length&&(s.next=0,s.overflow++),s.overflow>3)break;while(s.list[s.next].gate==1);s.overflow=0,s.list[s.next].gate=1,s.list[s.next].midi=t,s.list[s.next].vel=i/127}else s.list.forEach(u=>{u.midi==t&&(u.gate=0)})}function _(t){s.list.forEach(i=>i.gate=0)}return{voices:s,cycleNote:c,stopAll:_}}function Z(){const{audio:f,render:s}=J(),{controls:c,groups:_,cv:t}=Q(W,"synth"),{voices:i,cycleNote:u,stopAll:v}=X();N([i,c],()=>{f.layers.synth={volume:1,signal:w(e.scope({name:"synth",size:512},b(i.list)))},s("synth")});const{midi:m}=V();N(()=>m.note,o=>u(o.number,o.velocity));function a(o){let n=R(o.midi,o.key),r=e.mul(t["osc:gain"],e.adsr(t["osc:attack"],t["osc:decay"],t["osc:sustain"],t["osc:release"],e.const({key:`${o.key}:gate`,value:o.gate})),e.lowpass(e.mul(t["osc:cut-off"],n),t["osc:cut-q"],e.blepsaw(n))),d=e.mul(t["noise:gain"],e.adsr(t["noise:attack"],t["noise:decay"],t["noise:sustain"],t["noise:release"],e.const({key:`${o.key}:gate`,value:o.gate})),e.bandpass(n,t["noise:band-q"],e.noise()));return e.mul(e.const({key:`${o.key}:vel`,value:o.vel}),e.add(r,d))}function b(o=i.list){return e.mul(t["main:volume"],e.mul(e.sqrt(e.const({key:"voice-count",value:1/o.length})),e.add(...o.map(n=>a(n)))))}function w(o){return Array(2).fill(null).map((n,r)=>e.add(o,e.mul(t["fx:pingPong"],e.delay({size:44100},e.ms2samps(300*(1+r*.75)),.2,o))))}return{groups:_,controls:c,voices:i,cycleNote:u,stopAll:v}}const H={class:"flex flex-col gap-2 is-group p-2 bg-light-200 dark-bg-dark-200 shadow rounded gap-6 select-none"},Y={class:"flex flex-col relative select-none gap-4"},ee={class:"flex flex-wrap gap-1 font-mono w-full justify-around"},te=["onMousedown","onMouseup","onMouseleave"],se={class:"flex flex-wrap gap-2 flex-1"},ne=y("div",{class:"i-la-play"},null,-1),oe=[ne],ae=y("div",{class:"i-la-stop"},null,-1),ie=[ae],le={class:"text-sm uppercase absolute -top-4 bg-light-300 dark-bg-dark-300 p-1 rounded"},re={__name:"SynthMain",setup(f){z(()=>M.state.midi=!1),B(()=>M.state.midi=!0);const{groups:s,controls:c,voices:_,cycleNote:t,stopAll:i}=Z(),{midi:u}=V(),v=D(()=>Object.entries(u.activeNotes).reduce((m,a)=>(m=P(m).mix(A((Number(a[0])-9)%12),Number(a[1])/3).toRgbString(),m),"#888"));return(m,a)=>{const b=I,w=C,o=U;return p(),g("div",H,[y("div",Y,[x(b),x(w,{class:"absolute top-8 pointer-events-none",name:"synth",color:v.value},null,8,["color"])]),y("div",ee,[(p(!0),g(k,null,$(l(_).list,(n,r)=>(p(),g("div",{class:"text-sm flex min-w-6 min-h-4 flex-1 text-center rounded-full justify-center items-center transition cursor-pointer",key:r,style:F({backgroundColor:l(A)(n.midi-9-24,3,void 0,n.gate?1:.2),opacity:n.gate?1:.5}),onMousedown:d=>n.gate=1,onMouseup:d=>n.gate=0,onMouseleave:d=>n.gate=0},null,44,te))),128))]),y("div",se,[y("button",{class:"text-button",onMousedownPassive:a[0]||(a[0]=n=>l(t)(69,120)),onMouseupPassive:a[1]||(a[1]=n=>l(t)(69)),onTouchstart:a[2]||(a[2]=S(n=>l(t)(69,120),["prevent","stop"])),onTouchend:a[3]||(a[3]=S(n=>l(t)(69),["prevent","stop"])),onMouseleave:a[4]||(a[4]=n=>l(t)(69))},oe,32),y("button",{class:"text-button",onClick:a[5]||(a[5]=n=>l(i)())},ie),(p(!0),g(k,null,$(l(s),(n,r)=>(p(),g("div",{class:"flex flex-wrap is-group p-2 gap-2 items-center relative",key:r},[y("div",le,T(r),1),(p(!0),g(k,null,$(n,(d,h)=>(p(),O(o,{key:h,step:d.step,modelValue:l(c)[`${r}:${h}`],"onUpdate:modelValue":q=>l(c)[`${r}:${h}`]=q,min:d.min,max:d.max,param:h},null,8,["step","modelValue","onUpdate:modelValue","min","max","param"]))),128))]))),128))])])}}},ve=JSON.parse('{"title":"Elementary synth","description":"MIDI enabled synthesizer built with Elementary audio library","frontmatter":{"title":"Elementary synth","description":"MIDI enabled synthesizer built with Elementary audio library","date":"2023-06-23T00:00:00.000Z","cover":"lockup.svg","layout":"app","links":["https://www.elementary.audio/docs/guides/Understanding_Keys","https://www.elementary.audio/docs/reference/Math","https://github.com/elemaudio/web-examples","https://github.com/bgins/coincident-spectra/blob/main/src/lib/audio/audio.ts","https://github.com/teetow/elementary_grid","https://www.nickwritesablog.com/drum-synthesis-in-javascript/","https://github.com/elemaudio/web-examples/blob/master/planets/app.js","https://github.com/teetow/elementary_grid/blob/master/src/lib/useSynth.tsx"]},"headers":[],"relativePath":"practice/synth/elementary/index.md","filePath":"practice/synth/elementary/index.md","lastUpdated":1713511530000}'),ue={name:"practice/synth/elementary/index.md"};function ce(f,s,c,_,t,i){const u=re,v=E,m=G("client-only");return p(),g("div",null,[x(m,null,{default:L(()=>[x(u),x(v)]),_:1})])}const xe=K(ue,[["render",ce]]);export{ve as __pageData,xe as default};
