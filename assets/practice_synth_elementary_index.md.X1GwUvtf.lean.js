import{_ as E}from"./chunks/MidiKeys.DKhgVPFn.js";import{ao as P,u as S,aU as M,w as U,ad as A,_ as C}from"./chunks/theme.b27VEtjn.js";import{_ as I}from"./chunks/AnalysisScope.CGxapQwA.js";import{_ as j}from"./chunks/AnalysisFFT.BK2KFl3Y.js";import{b as z,d as q,o as B,x as D,c as F,E as d,F as x,G as p,O as _,V as k,W as $,L as T,C as r,Q as N,I as O,a2 as K,D as L,X as G,a4 as J}from"./chunks/framework.YjWD1Pnt.js";import{s as e,u as Q}from"./chunks/useAudio.B-rGWFDw.js";import{u as R}from"./chunks/useUI.BRahGOw8.js";import"./chunks/index.DqntPscu.js";function W(m,n){return e.mul(440,e.pow(2,e.smooth(e.tau2pole(.001),e.const({key:`${n}:frequency`,value:(m-69)/12}))))}const X={"main:volume":{value:.2,min:0,max:1,step:.01},"osc:shape":{value:0,min:0,max:1,step:.01},"osc:gain":{value:.5,min:0,max:1,step:.01},"osc:cut-off":{value:4,min:1,max:8,step:.5},"osc:cut-q":{value:1.1,min:0,max:5,step:.01},"osc:attack":{value:.01,min:.001,max:5,step:.01},"osc:decay":{value:.01,min:.001,max:4,step:.01},"osc:sustain":{value:.5,min:0,max:1,step:.01},"osc:release":{value:.01,min:.001,max:10,step:.01},"noise:gain":{value:.5,min:0,max:1,step:.01},"noise:band-q":{value:50,min:0,max:100,step:.1},"noise:attack":{value:.01,min:.001,max:5,step:.01},"noise:decay":{value:.01,min:.001,max:4,step:.01},"noise:sustain":{value:.5,min:0,max:1,step:.01},"noise:release":{value:.01,min:.001,max:10,step:.01},"fx:pingPong":{value:.3,min:0,max:1,step:.01},"fx:feedback":{value:.3,min:0,max:1,step:.01},"fx:shift":{value:.25,min:0,max:1,step:.01}};function Z(m=12){const n=z({list:Array(m).fill(!0).map((i,s)=>({key:`v${s}`,gate:0,midi:69,vel:0})),next:0,overflow:0});function f(i=60,s=0){if(s){do if(n.next++,n.next>=n.list.length&&(n.next=0,n.overflow++),n.overflow>3)break;while(n.list[n.next].gate==1);n.overflow=0,n.list[n.next].gate=1,n.list[n.next].midi=i,n.list[n.next].vel=s/127}else n.list.forEach(l=>{l.midi==i&&(l.gate=0)})}function y(i){n.list.forEach(s=>s.gate=0)}return{voices:n,cycleNote:f,stopAll:y}}function H(){const m=P(),{audio:n,render:f}=Q(),{controls:y,groups:i,cv:s}=R(X,"synth"),{voices:l,cycleNote:g,stopAll:c}=Z();q([l,y],()=>{n.layers.synth={volume:1,signal:w(e.scope({name:"synth",size:512},b(l.list)))},f("synth")});const{midi:o}=S();q(()=>o.note,t=>g(t.number,t.velocity));function h(t){let a=W(t.midi,t.key),u=e.mul(s["osc:gain"],e.adsr(s["osc:attack"],s["osc:decay"],s["osc:sustain"],s["osc:release"],e.const({key:`${t.key}:gate`,value:t.gate})),e.lowpass(e.mul(s["osc:cut-off"],a),s["osc:cut-q"],e.add(e.mul(e.sub(1,s["osc:shape"]),e.blepsquare(a)),e.mul(s["osc:shape"],e.blepsaw(a))))),v=e.mul(s["noise:gain"],e.adsr(s["noise:attack"],s["noise:decay"],s["noise:sustain"],s["noise:release"],e.const({key:`${t.key}:gate`,value:t.gate})),e.bandpass(a,s["noise:band-q"],e.noise()));return e.mul(e.const({key:`${t.key}:vel`,value:t.vel}),e.add(u,v))}function b(t=l.list){return e.mul(s["main:volume"],e.mul(e.sqrt(e.const({key:"voice-count",value:1/t.length})),e.add(...t.map(a=>h(a)))))}function w(t){return Array(2).fill(null).map((a,u)=>e.add(t,e.mul(s["fx:pingPong"],s["fx:feedback"],e.delay({size:44100},e.ms2samps(e.mul(6e4/(m==null?void 0:m.bpm),e.add(1,e.mul(u==0?-.5:.5,s["fx:shift"])))),s["fx:feedback"],t))))}return{groups:i,controls:y,voices:l,cycleNote:g,stopAll:c}}const Y={class:"flex flex-col gap-2 is-group p-2 bg-light-200 dark-bg-dark-200 shadow rounded gap-6 select-none"},ee={class:"flex flex-col relative select-none gap-4"},te={class:"flex flex-wrap gap-1 font-mono w-full justify-around"},se=["onMousedown","onMouseup","onMouseleave"],ne={class:"flex flex-wrap gap-2 flex-1"},oe=p("div",{class:"i-la-play"},null,-1),ae=[oe],ie=p("div",{class:"i-la-stop"},null,-1),le=[ie],re={class:"text-sm uppercase absolute -top-4 bg-light-300 dark-bg-dark-300 p-1 rounded"},ue={__name:"SynthMain",setup(m){B(()=>M.state.midi=!1),D(()=>M.state.midi=!0);const{groups:n,controls:f,voices:y,cycleNote:i,stopAll:s}=H(),{midi:l}=S(),g=F(()=>Object.entries(l.activeNotes).reduce((c,o)=>(c=U(c).mix(A((Number(o[0])-9)%12),Number(o[1])/3).toRgbString(),c),"#888"));return(c,o)=>{const h=j,b=I,w=C;return d(),x("div",Y,[p("div",ee,[_(h),_(b,{class:"absolute top-8 pointer-events-none",name:"synth",color:g.value},null,8,["color"])]),p("div",te,[(d(!0),x(k,null,$(r(y).list,(t,a)=>(d(),x("div",{class:"text-sm flex min-w-6 min-h-4 flex-1 text-center rounded-full justify-center items-center transition cursor-pointer",key:a,style:T({backgroundColor:r(A)(t.midi-9-24,3,void 0,t.gate?1:.2),opacity:t.gate?1:.5}),onMousedown:u=>t.gate=1,onMouseup:u=>t.gate=0,onMouseleave:u=>t.gate=0},null,44,se))),128))]),p("div",ne,[p("button",{class:"text-button",onMousedownPassive:o[0]||(o[0]=t=>r(i)(69,120)),onMouseupPassive:o[1]||(o[1]=t=>r(i)(69)),onTouchstart:o[2]||(o[2]=N(t=>r(i)(69,120),["prevent","stop"])),onTouchend:o[3]||(o[3]=N(t=>r(i)(69),["prevent","stop"])),onMouseleave:o[4]||(o[4]=t=>r(i)(69))},ae,32),p("button",{class:"text-button",onClick:o[5]||(o[5]=t=>r(s)())},le),(d(!0),x(k,null,$(r(n),(t,a)=>(d(),x("div",{class:"flex flex-wrap is-group p-2 gap-2 items-center relative",key:a},[p("div",re,O(a),1),(d(!0),x(k,null,$(t,(u,v)=>(d(),K(w,{key:v,step:u.step,modelValue:r(f)[`${a}:${v}`],"onUpdate:modelValue":V=>r(f)[`${a}:${v}`]=V,min:u.min,max:u.max,param:v},null,8,["step","modelValue","onUpdate:modelValue","min","max","param"]))),128))]))),128))])])}}},he=JSON.parse('{"title":"Elementary synth","description":"MIDI enabled synthesizer built with Elementary audio library","frontmatter":{"title":"Elementary synth","description":"MIDI enabled synthesizer built with Elementary audio library","date":"2024-06-23T00:00:00.000Z","cover":"lockup.svg","layout":"app","links":["https://www.elementary.audio/docs/guides/Understanding_Keys","https://www.elementary.audio/docs/reference/Math","https://github.com/elemaudio/web-examples","https://github.com/bgins/coincident-spectra/blob/main/src/lib/audio/audio.ts","https://github.com/teetow/elementary_grid","https://www.nickwritesablog.com/drum-synthesis-in-javascript/","https://github.com/elemaudio/web-examples/blob/master/planets/app.js","https://github.com/teetow/elementary_grid/blob/master/src/lib/useSynth.tsx"]},"headers":[],"relativePath":"practice/synth/elementary/index.md","filePath":"practice/synth/elementary/index.md","lastUpdated":1716213785000}'),me={name:"practice/synth/elementary/index.md"};function ce(m,n,f,y,i,s){const l=ue,g=E,c=J("client-only");return d(),x("div",null,[_(c,null,{default:G(()=>[_(l),_(g)]),_:1})])}const be=L(me,[["render",ce]]);export{he as __pageData,be as default};
