import{a as S,_ as V}from"./chunks/InputMic.8669b378.js";import{_ as P}from"./chunks/ControlRotary.64f87b82.js";import{k as j,w as $,j as B,o as p,c as _,a as c,f as x,F as w,r as k,x as I,g as r,t as M,l as A,e as U,A as z,B as C,_ as F,m as D,n as T}from"./chunks/framework.f277db28.js";import"./chunks/tuner.f3d8e340.js";import"./chunks/audio.aba48680.js";import{a as E}from"./chunks/calculations.2bac3e9a.js";import"./chunks/colors.a5d5ae39.js";import{u as q}from"./chunks/midi.36560961.js";import"./chunks/loop.5f39f706.js";import"./chunks/mic.a8597eff.js";import"./chunks/midiRender.affeda4e.js";import"./chunks/Midi.1f918097.js";import"./chunks/tempo.4e2f4c38.js";import"./chunks/noise.50c0df1a.js";import"./chunks/index.e98b5e67.js";import"./chunks/sequence.23b98f68.js";import{c as N}from"./chunks/synth.8a2ee66e.js";import{n as O}from"./chunks/theory.61e5aadb.js";import{_ as J}from"./chunks/AnalysisScope.af71c368.js";import{s as t,u as K}from"./chunks/useAudio.be0f0d23.js";import{u as L}from"./chunks/useUI.49d6d591.js";import{w as R}from"./chunks/index.654bd828.js";import"./chunks/index.911cb71e.js";import"./chunks/index.8dc0b613.js";import"./chunks/index.64a8684b.js";import"./chunks/commonjsHelpers.de833af9.js";import"./chunks/index.b30cd6d2.js";import"./chunks/index.9f721bc0.js";import"./chunks/Sequence.873f0209.js";import"./chunks/Loop.14cab9e9.js";import"./chunks/UserMedia.9dadeb85.js";import"./chunks/Subtract.109130cb.js";import"./chunks/OnePoleFilter.8566943f.js";import"./chunks/BitCrusher.1d797f1b.js";import"./chunks/Filter.ca6be54c.js";import"./chunks/AutoPanner.a9d5a784.js";import"./chunks/Scale.b6214b1d.js";import"./chunks/PingPongDelay.719d1232.js";import"./chunks/MonoSynth.c00b1270.js";import"./chunks/index.86652af6.js";function Z(d,s){return t.mul(440,t.pow(2,t.smooth(t.tau2pole(.001),t.const({key:`${s}:frequency`,value:(d-69)/12}))))}const G={"main:volume":{value:.2,min:0,max:1,step:.01},"osc:gain":{value:.5,min:0,max:1,step:.01},"osc:cut-off":{value:4,min:1,max:8,step:.5},"osc:cut-q":{value:1.1,min:0,max:5,step:.01},"osc:attack":{value:.01,min:.001,max:5,step:.01},"osc:decay":{value:.01,min:.001,max:4,step:.01},"osc:sustain":{value:.5,min:0,max:1,step:.01},"osc:release":{value:.01,min:.001,max:10,step:.01},"noise:gain":{value:.5,min:0,max:1,step:.01},"noise:band-q":{value:50,min:0,max:100,step:.1},"noise:attack":{value:.01,min:.001,max:5,step:.01},"noise:decay":{value:.01,min:.001,max:4,step:.01},"noise:sustain":{value:.5,min:0,max:1,step:.01},"noise:release":{value:.01,min:.001,max:10,step:.01},"fx:pingPong":{value:.3,min:0,max:1,step:.01}};function H(d=12){const s=j({list:Array(d).fill(!0).map((e,i)=>({key:`v${i}`,gate:0,midi:69,vel:0})),next:0,overflow:0});function m(e=60,i=0){if(i){do if(s.next++,s.next>=s.list.length&&(s.next=0,s.overflow++),s.overflow>3)break;while(s.list[s.next].gate==1);s.overflow=0,s.list[s.next].gate=1,s.list[s.next].midi=e,s.list[s.next].vel=i/127}else s.list.forEach(u=>{u.midi==e&&(u.gate=0)})}function f(e){s.list.forEach(i=>i.gate=0)}return{voices:s,cycleNote:m,stopAll:f}}function Q(){const{audio:d,render:s}=K(),{controls:m,groups:f,cv:e}=L(G,"synth"),{voices:i,cycleNote:u,stopAll:v}=H();$([i,m],()=>{d.layers.synth={volume:1,signal:a(t.scope({name:"synth",size:512},h(i.list)))},s("synth")});const{midi:g}=q();$(()=>g.note,o=>u(o.number,o.velocity));function n(o){let l=Z(o.midi,o.key),y=t.mul(e["osc:gain"],t.adsr(e["osc:attack"],e["osc:decay"],e["osc:sustain"],e["osc:release"],t.const({key:`${o.key}:gate`,value:o.gate})),t.lowpass(t.mul(e["osc:cut-off"],l),e["osc:cut-q"],t.blepsaw(l))),b=t.mul(e["noise:gain"],t.adsr(e["noise:attack"],e["noise:decay"],e["noise:sustain"],e["noise:release"],t.const({key:`${o.key}:gate`,value:o.gate})),t.bandpass(l,e["noise:band-q"],t.noise()));return t.mul(t.const({key:`${o.key}:vel`,value:o.vel}),t.add(y,b))}function h(o=i.list){return t.mul(e["main:volume"],t.mul(t.sqrt(t.const({key:"voice-count",value:1/o.length})),t.add(...o.map(l=>n(l)))))}function a(o){return Array(2).fill(null).map((l,y)=>t.add(o,t.mul(e["fx:pingPong"],t.delay({size:44100},t.ms2samps(300*(1+y*.75)),.2,o))))}return{groups:f,controls:m,voices:i,cycleNote:u,stopAll:v}}const W={class:"flex flex-col gap-2 is-group p-2 bg-light-200 dark-bg-dark-200 shadow rounded gap-4"},X={class:"flex flex-col relative mb-3 select-none"},Y={class:"flex flex-wrap gap-1 font-mono w-full justify-around"},ee=["onMousedown","onMouseup","onMouseleave"],te={class:"flex flex-wrap gap-2 flex-1"},se=c("div",{class:"i-la-play"},null,-1),oe=[se],ne=c("div",{class:"i-la-stop"},null,-1),ae=[ne],ie={class:"text-sm uppercase absolute -top-4 bg-light-300 dark-bg-dark-300 p-1 rounded"},le=c("div",{class:"flex gap-4 flex-1"},null,-1),re={__name:"SynthMain",setup(d){const{groups:s,controls:m,voices:f,cycleNote:e,stopAll:i}=Q(),{midi:u}=q(),v=B(()=>Object.entries(u.activeNotes).reduce((g,n)=>(g=R(g).mix(E((Number(n[0])-9)%12),Number(n[1])/3).toRgbString(),g),"#888"));return(g,n)=>{const h=P;return p(),_("div",W,[c("div",X,[x(J,{class:"absolute -top-4 pointer-events-none",name:"synth",color:v.value},null,8,["color"]),c("div",Y,[(p(!0),_(w,null,k(r(f).list,(a,o)=>(p(),_("div",{class:"text-md flex w-8 h-8 text-center rounded-full justify-center items-center transition cursor-pointer",key:o,style:I({backgroundColor:r(E)(a.midi-9-24,3,void 0,a.gate?1:.2),opacity:a.gate?1:.5}),onMousedown:l=>a.gate=1,onMouseup:l=>a.gate=0,onMouseleave:l=>a.gate=0},M(r(O)[(a.midi-9)%12]),45,ee))),128))])]),c("div",te,[c("button",{class:"text-button",onMousedownPassive:n[0]||(n[0]=a=>r(e)(69,120)),onMouseupPassive:n[1]||(n[1]=a=>r(e)(69)),onTouchstart:n[2]||(n[2]=A(a=>r(e)(69,120),["prevent","stop"])),onTouchend:n[3]||(n[3]=A(a=>r(e)(69),["prevent","stop"])),onMouseleave:n[4]||(n[4]=a=>r(e)(69))},oe,32),c("button",{class:"text-button",onClick:n[5]||(n[5]=a=>r(i)())},ae),(p(!0),_(w,null,k(r(s),(a,o)=>(p(),_("div",{class:"flex flex-wrap is-group p-2 gap-2 items-center relative",key:o},[c("div",ie,M(o),1),(p(!0),_(w,null,k(a,(l,y)=>(p(),U(h,{key:y,step:l.step,modelValue:r(m)[`${o}:${y}`],"onUpdate:modelValue":b=>r(m)[`${o}:${y}`]=b,min:l.min,max:l.max,param:y},null,8,["step","modelValue","onUpdate:modelValue","min","max","param"]))),128))]))),128)),le])])}}},me={class:"flex flex-col gap-4"},ue={__name:"ElemAudio",setup(d){return z(()=>{N.state.midi=!1}),C(()=>{N.state.midi=!0}),(s,m)=>{const f=re,e=S,i=V;return p(),_("div",me,[x(f),x(e),x(i)])}}},Ye=JSON.parse('{"title":"Elementary synth","description":"MIDI enabled synthesizer built with Elementary audio library","frontmatter":{"title":"Elementary synth","description":"MIDI enabled synthesizer built with Elementary audio library","date":"2023-06-23T00:00:00.000Z","cover":"lockup.svg","layout":"app","links":["https://www.elementary.audio/docs/guides/Understanding_Keys","https://www.elementary.audio/docs/reference/Math","https://github.com/elemaudio/web-examples","https://github.com/bgins/coincident-spectra/blob/main/src/lib/audio/audio.ts","https://github.com/teetow/elementary_grid","https://www.nickwritesablog.com/drum-synthesis-in-javascript/","https://github.com/elemaudio/web-examples/blob/master/planets/app.js","https://github.com/teetow/elementary_grid/blob/master/src/lib/useSynth.tsx"]},"headers":[],"relativePath":"practice/synth/elementary/index.md","filePath":"practice/synth/elementary/index.md","lastUpdated":1698940336000}'),pe={name:"practice/synth/elementary/index.md"};function ce(d,s,m,f,e,i){const u=ue,v=D("client-only");return p(),_("div",null,[x(v,null,{default:T(()=>[x(u)]),_:1})])}const et=F(pe,[["render",ce]]);export{Ye as __pageData,et as default};
