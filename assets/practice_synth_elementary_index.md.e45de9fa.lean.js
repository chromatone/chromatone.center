import{_ as V}from"./chunks/ControlRotary.fd7ee63d.js";import{_ as E}from"./chunks/AnalysisFFT.eef93760.js";import{k as P,w as $,A as j,B,j as U,o as p,c as f,a as c,f as h,F as w,r as k,x as z,g as l,l as M,t as C,e as F,_ as I,m as D,n as T}from"./chunks/framework.88db3c26.js";import"./chunks/tuner.5a4b9afc.js";import"./chunks/audio.e7507cf6.js";import{a as N}from"./chunks/calculations.2bac3e9a.js";import"./chunks/colors.71e97f2b.js";import{u as A}from"./chunks/midi.b5556f9f.js";import"./chunks/loop.88bd9d68.js";import"./chunks/mic.dc5fa472.js";import"./chunks/midiRender.1914f0ed.js";import"./chunks/Midi.1f918097.js";import"./chunks/tempo.84043c62.js";import"./chunks/noise.4e878d58.js";import"./chunks/index.e98b5e67.js";import"./chunks/sequence.8d866e24.js";import{c as q}from"./chunks/synth.9919606b.js";import"./chunks/theory.f78bd4d6.js";import{_ as O}from"./chunks/AnalysisScope.5358985a.js";import{s as t,u as J}from"./chunks/useAudio.7050d810.js";import{u as K}from"./chunks/useUI.7a6b15f9.js";import{w as L}from"./chunks/index.654bd828.js";import"./chunks/index.c020f286.js";import"./chunks/index.edce5462.js";import"./chunks/index.70261d75.js";import"./chunks/commonjsHelpers.de833af9.js";import"./chunks/index.78e9bb27.js";import"./chunks/Sequence.873f0209.js";import"./chunks/Loop.14cab9e9.js";import"./chunks/UserMedia.9dadeb85.js";import"./chunks/Subtract.109130cb.js";import"./chunks/OnePoleFilter.8566943f.js";import"./chunks/BitCrusher.b9cad20b.js";import"./chunks/Filter.ca6be54c.js";import"./chunks/AutoPanner.fd8dabdc.js";import"./chunks/Scale.b6214b1d.js";import"./chunks/PingPongDelay.7799470c.js";import"./chunks/MonoSynth.c00b1270.js";import"./chunks/index.28e8ae3d.js";function R(d,o){return t.mul(440,t.pow(2,t.smooth(t.tau2pole(.001),t.const({key:`${o}:frequency`,value:(d-69)/12}))))}const Z={"main:volume":{value:.2,min:0,max:1,step:.01},"osc:gain":{value:.5,min:0,max:1,step:.01},"osc:cut-off":{value:4,min:1,max:8,step:.5},"osc:cut-q":{value:1.1,min:0,max:5,step:.01},"osc:attack":{value:.01,min:.001,max:5,step:.01},"osc:decay":{value:.01,min:.001,max:4,step:.01},"osc:sustain":{value:.5,min:0,max:1,step:.01},"osc:release":{value:.01,min:.001,max:10,step:.01},"noise:gain":{value:.5,min:0,max:1,step:.01},"noise:band-q":{value:50,min:0,max:100,step:.1},"noise:attack":{value:.01,min:.001,max:5,step:.01},"noise:decay":{value:.01,min:.001,max:4,step:.01},"noise:sustain":{value:.5,min:0,max:1,step:.01},"noise:release":{value:.01,min:.001,max:10,step:.01},"fx:pingPong":{value:.3,min:0,max:1,step:.01}};function G(d=12){const o=P({list:Array(d).fill(!0).map((s,a)=>({key:`v${a}`,gate:0,midi:69,vel:0})),next:0,overflow:0});function u(s=60,a=0){if(a){do if(o.next++,o.next>=o.list.length&&(o.next=0,o.overflow++),o.overflow>3)break;while(o.list[o.next].gate==1);o.overflow=0,o.list[o.next].gate=1,o.list[o.next].midi=s,o.list[o.next].vel=a/127}else o.list.forEach(m=>{m.midi==s&&(m.gate=0)})}function y(s){o.list.forEach(a=>a.gate=0)}return{voices:o,cycleNote:u,stopAll:y}}function H(){const{audio:d,render:o}=J(),{controls:u,groups:y,cv:s}=K(Z,"synth"),{voices:a,cycleNote:m,stopAll:x}=G();$([a,u],()=>{d.layers.synth={volume:1,signal:b(t.scope({name:"synth",size:512},_(a.list)))},o("synth")});const{midi:g}=A();$(()=>g.note,e=>m(e.number,e.velocity));function n(e){let i=R(e.midi,e.key),r=t.mul(s["osc:gain"],t.adsr(s["osc:attack"],s["osc:decay"],s["osc:sustain"],s["osc:release"],t.const({key:`${e.key}:gate`,value:e.gate})),t.lowpass(t.mul(s["osc:cut-off"],i),s["osc:cut-q"],t.blepsaw(i))),v=t.mul(s["noise:gain"],t.adsr(s["noise:attack"],s["noise:decay"],s["noise:sustain"],s["noise:release"],t.const({key:`${e.key}:gate`,value:e.gate})),t.bandpass(i,s["noise:band-q"],t.noise()));return t.mul(t.const({key:`${e.key}:vel`,value:e.vel}),t.add(r,v))}function _(e=a.list){return t.mul(s["main:volume"],t.mul(t.sqrt(t.const({key:"voice-count",value:1/e.length})),t.add(...e.map(i=>n(i)))))}function b(e){return Array(2).fill(null).map((i,r)=>t.add(e,t.mul(s["fx:pingPong"],t.delay({size:44100},t.ms2samps(300*(1+r*.75)),.2,e))))}return{groups:y,controls:u,voices:a,cycleNote:m,stopAll:x}}const Q={class:"flex flex-col gap-2 is-group p-2 bg-light-200 dark-bg-dark-200 shadow rounded gap-6 select-none"},W={class:"flex flex-col relative select-none gap-4"},X={class:"flex flex-wrap gap-1 font-mono w-full justify-around"},Y=["onMousedown","onMouseup","onMouseleave"],ee={class:"flex flex-wrap gap-2 flex-1"},te=c("div",{class:"i-la-play"},null,-1),se=[te],oe=c("div",{class:"i-la-stop"},null,-1),ne=[oe],ae={class:"text-sm uppercase absolute -top-4 bg-light-300 dark-bg-dark-300 p-1 rounded"},ie={__name:"SynthMain",setup(d){j(()=>{q.state.midi=!1}),B(()=>{q.state.midi=!0});const{groups:o,controls:u,voices:y,cycleNote:s,stopAll:a}=H(),{midi:m}=A(),x=U(()=>Object.entries(m.activeNotes).reduce((g,n)=>(g=L(g).mix(N((Number(n[0])-9)%12),Number(n[1])/3).toRgbString(),g),"#888"));return(g,n)=>{const _=E,b=V;return p(),f("div",Q,[c("div",W,[h(_),h(O,{class:"absolute top-8 pointer-events-none",name:"synth",color:x.value},null,8,["color"])]),c("div",X,[(p(!0),f(w,null,k(l(y).list,(e,i)=>(p(),f("div",{class:"text-sm flex min-w-6 min-h-4 flex-1 text-center rounded-full justify-center items-center transition cursor-pointer",key:i,style:z({backgroundColor:l(N)(e.midi-9-24,3,void 0,e.gate?1:.2),opacity:e.gate?1:.5}),onMousedown:r=>e.gate=1,onMouseup:r=>e.gate=0,onMouseleave:r=>e.gate=0},null,44,Y))),128))]),c("div",ee,[c("button",{class:"text-button",onMousedownPassive:n[0]||(n[0]=e=>l(s)(69,120)),onMouseupPassive:n[1]||(n[1]=e=>l(s)(69)),onTouchstart:n[2]||(n[2]=M(e=>l(s)(69,120),["prevent","stop"])),onTouchend:n[3]||(n[3]=M(e=>l(s)(69),["prevent","stop"])),onMouseleave:n[4]||(n[4]=e=>l(s)(69))},se,32),c("button",{class:"text-button",onClick:n[5]||(n[5]=e=>l(a)())},ne),(p(!0),f(w,null,k(l(o),(e,i)=>(p(),f("div",{class:"flex flex-wrap is-group p-2 gap-2 items-center relative",key:i},[c("div",ae,C(i),1),(p(!0),f(w,null,k(e,(r,v)=>(p(),F(b,{key:v,step:r.step,modelValue:l(u)[`${i}:${v}`],"onUpdate:modelValue":S=>l(u)[`${i}:${v}`]=S,min:r.min,max:r.max,param:v},null,8,["step","modelValue","onUpdate:modelValue","min","max","param"]))),128))]))),128))])])}}},Ge=JSON.parse('{"title":"Elementary synth","description":"MIDI enabled synthesizer built with Elementary audio library","frontmatter":{"title":"Elementary synth","description":"MIDI enabled synthesizer built with Elementary audio library","date":"2023-06-23T00:00:00.000Z","cover":"lockup.svg","layout":"app","links":["https://www.elementary.audio/docs/guides/Understanding_Keys","https://www.elementary.audio/docs/reference/Math","https://github.com/elemaudio/web-examples","https://github.com/bgins/coincident-spectra/blob/main/src/lib/audio/audio.ts","https://github.com/teetow/elementary_grid","https://www.nickwritesablog.com/drum-synthesis-in-javascript/","https://github.com/elemaudio/web-examples/blob/master/planets/app.js","https://github.com/teetow/elementary_grid/blob/master/src/lib/useSynth.tsx"]},"headers":[],"relativePath":"practice/synth/elementary/index.md","filePath":"practice/synth/elementary/index.md","lastUpdated":1698940336000}'),le={name:"practice/synth/elementary/index.md"};function re(d,o,u,y,s,a){const m=ie,x=D("client-only");return p(),f("div",null,[h(x,null,{default:T(()=>[h(m)]),_:1})])}const He=I(le,[["render",re]]);export{Ge as __pageData,He as default};
